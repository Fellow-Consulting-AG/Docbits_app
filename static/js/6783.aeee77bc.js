"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[6783],{86783:(e,t,o)=>{o.r(t),o.d(t,{default:()=>it});var a=o(61758),i=o(58790);const s=e=>((0,a.Qi)("data-v-7c8c41e6"),e=e(),(0,a.jt)(),e),l={class:"row q-pb-md"},n={class:"col-12 q-pl-sm q-mt-sm"},r={key:0,class:"row"},d={key:1,class:"full-width"},u={class:"row"},_={class:"po-nav-width q-pr-md row"},c={class:"q-mr-auto q-mt-sm"},m={style:{"vertical-align":"middle","margin-left":"10px","font-size":"20px",cursor:"pointer"}},h={class:"q-ml-auto q-mt-sm"},p={class:"h-m-r-10",id:"po-container-parrent",style:{"border-right":"1px solid #9f9d9d"}},g={class:"row ml-10 po-page-height scrolle-y"},f={class:"col-sm-12"},b={class:"full-width scrolle-y"},v={key:0,class:"row q-mt-md q-mb-md input-text-28px"},y={class:"row"},k={class:"col-sm-12 col-md-12 col-lg-12"},w={class:"col-sm-12 col-md-12 col-lg-12"},L={class:"full-width q-pt-md"},D={style:{"margin-left":"-13px",top:"10px"}},C={style:{"margin-left":"-5.5px",top:"40%"}},A={class:""},I={class:"po-right-container q-pr-md q-mt-sm",id:"po-image-container"},F=s((()=>(0,a.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1)));function O(e,t,o,s,O,E){const R=(0,a.g2)("DocumentLock"),x=(0,a.g2)("MessageBanner"),S=(0,a.g2)("SubHeader"),T=(0,a.g2)("ErrorDocumentView"),V=(0,a.g2)("q-icon"),P=(0,a.g2)("q-btn"),q=(0,a.g2)("f-btn"),j=(0,a.g2)("q-input"),N=(0,a.g2)("q-separator"),z=(0,a.g2)("LineItems"),W=(0,a.g2)("ImageComponent"),Q=(0,a.g2)("q-splitter"),K=(0,a.g2)("q-inner-loading");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(R,{document_version:e.document_version,trigger_document_lock:e.trigger_document_lock,doc_id:e.docId},null,8,["document_version","trigger_document_lock","doc_id"]),e.is_view_readonly?((0,a.uX)(),(0,a.Wv)(x,{key:0,message:e.error_message,messageCategoryClass:"error-banner"},null,8,["message"])):(0,a.Q3)("",!0),(0,a.bF)(S,{name:"quote_details",label:e.$t("quote_details"),show_expiry_alert:!0,onSearch:!1},null,8,["label"]),(0,a.Lk)("div",l,[(0,a.Lk)("div",n,[e.doc_fetch_error?((0,a.uX)(),(0,a.CE)("div",r,[(0,a.bF)(T)])):((0,a.uX)(),(0,a.CE)("div",d,[(0,a.bF)(Q,{limits:[30,100],modelValue:e.imageFieldSplitter,"onUpdate:modelValue":[t[2]||(t[2]=t=>e.imageFieldSplitter=t),t[3]||(t[3]=t=>e.splitterChanged())],class:"po-left-container"},{before:(0,a.k6)((()=>[(0,a.Lk)("div",u,[(0,a.Lk)("div",_,[(0,a.Lk)("div",c,[(0,a.bF)(P,{flat:"",rounded:"",color:"primary",onClick:t[0]||(t[0]=t=>e.routeToBack())},{default:(0,a.k6)((()=>[(0,a.bF)(V,{name:"fa-solid fa-circle-arrow-left",size:"sm"}),(0,a.Lk)("label",m,(0,i.v_)(e.$t("back")),1)])),_:1})]),(0,a.Lk)("div",h,[(0,a.bF)(q,{class:"q-mr-sm",icon:"save"})])])]),(0,a.Lk)("div",p,[(0,a.Lk)("div",g,[(0,a.Lk)("div",f,[(0,a.Lk)("div",b,[e.documentFieldsConfig&&e.documentFieldsConfig.length>0?((0,a.uX)(),(0,a.CE)("div",v,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.documentFieldsConfig,((t,o)=>((0,a.uX)(),(0,a.CE)("div",{key:o,class:"col-sm-4 col-md-4 col-lg-4 q-pa-sm"},[(0,a.Lk)("div",y,[(0,a.Lk)("div",k,(0,i.v_)(e.getFieldLabelFromAllPrefixes(t)),1),(0,a.Lk)("div",w,[(0,a.bF)(j,{outlined:"",dense:"",modelValue:e.documentFields[t.field_name].formatted_value,"onUpdate:modelValue":o=>e.documentFields[t.field_name].formatted_value=o,disable:!0},null,8,["modelValue","onUpdate:modelValue"])])])])))),128))])):(0,a.Q3)("",!0),(0,a.bF)(N),(0,a.Lk)("div",L,[(0,a.bF)(z,{ref:"lineItemsPoV3",isReadOnly:e.is_view_readonly,defaultValues:e.defalutAttributes},null,8,["isReadOnly","defaultValues"])])])])])])])),separator:(0,a.k6)((()=>[(0,a.Lk)("div",D,[(0,a.bF)(P,{round:"",unelevated:"",size:"xs",icon:e.imageFieldSplitter>=90?"chevron_left":"chevron_right",class:"panel-expand-button highlighted-back shadow-2",onClick:t[1]||(t[1]=t=>e.toggleImageArea())},null,8,["icon"])]),(0,a.Lk)("div",C,[(0,a.bF)(V,{name:"drag_handle",size:"md",class:"icon-grey rotate-90"})])])),after:(0,a.k6)((()=>[(0,a.Lk)("div",A,[(0,a.Lk)("div",I,[(0,a.bF)(W,{renderOpenWindoIcon:!0,dynamicWidth:e.dynamicWidth,docName:e.record.filename,docImages:e.record.images},null,8,["dynamicWidth","docName","docImages"])])])])),_:1},8,["modelValue"])]))])]),(0,a.bF)(K,{class:"main-loader",showing:e.processing,style:{"z-index":"2"}},{default:(0,a.k6)((()=>[F])),_:1},8,["showing"])],64)}var E=o(1659),R=o(24622),x=o(60521),S=o(45938),T=o(38734),V=o(46162),P=o(76956),q=o(92162),j=o(94124),N=o(51476),z=o(11470),W=o(21984),Q=o(25891),K=o(84857),M=o(18859),X=o(29104);const U={key:0},$={key:1},B={class:"row back-white q-mt-md input-text-28px"},J={class:"row"},H={class:"col-sm-12 col-md-12 col-lg-12"},G={class:"col-sm-12 col-md-12 col-lg-12"},Y={class:"row items-center justify-end"},Z={key:0},ee=["onClick"],te={key:0,class:"col-sm-12 col-md-12 col-lg-12 q-pt-md"},oe={class:"row float-right"};function ae(e,t,o,s,l,n){const r=(0,a.g2)("q-tooltip"),d=(0,a.g2)("q-icon"),u=(0,a.g2)("q-th"),_=(0,a.g2)("q-tr"),c=(0,a.g2)("q-table"),m=(0,a.g2)("q-spinner"),h=(0,a.g2)("q-markup-table"),p=(0,a.g2)("q-separator"),g=(0,a.g2)("q-btn"),f=(0,a.g2)("q-date"),b=(0,a.g2)("q-popup-proxy"),v=(0,a.g2)("q-item-section"),y=(0,a.g2)("q-item"),k=(0,a.g2)("q-list"),w=(0,a.g2)("q-menu"),L=(0,a.g2)("q-input"),D=(0,a.g2)("q-select"),C=(0,a.g2)("q-spinner-ios"),A=(0,a.g2)("q-avatar"),I=(0,a.g2)("f-btn"),F=(0,a.g2)("masterDataLookup"),O=(0,a.g2)("dialog-draggable"),E=(0,a.g2)("Loader"),R=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)(a.FK,null,[((0,a.uX)(),(0,a.CE)("div",{class:"row q-pa-sm back-white",key:e.renderKey},[e.hasLineItems()?((0,a.uX)(),(0,a.Wv)(c,{key:0,rows:e.tableRows,columns:e.tableColumns,flat:"","row-key":"id","no-data-label":e.$t("pages.messages.no_record_found"),"rows-per-page-options":[0],id:"line_item_table",ref:"el",class:"text-uppercase sticky-header transparent-header table_height resizable",style:{"table-layout":"fixed !important",width:"100%"},onRowClick:e.onRowClick},{header:(0,a.k6)((t=>[(0,a.bF)(_,{props:t},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.cols,((o,s)=>((0,a.uX)(),(0,a.Wv)(u,{key:o.name,props:t,class:"table-column-header",draggable:e.allowedColumnSorting(o),dropzone:e.allowedColumnSorting(o),"data-index":s,direction:"horizontal",onDragstart:t=>e.onDragStart(t,e.tableColumns,s),onDrop:(0,X.D$)((t=>e.handleDrop(t,s)),["prevent"]),onDragover:(0,X.D$)((t=>e.onDragOverWrapper(t,s,o.name)),["prevent"]),onDragenter:(0,X.D$)(e.onDragEnter,["prevent"]),onDragleave:(0,X.D$)(e.onDragLeave,["prevent"]),style:(0,i.Tr)({cursor:e.getIsDragging&&e.allowedColumnSorting(o)?"pointer":"move"})},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(o.label)+" ",1),o.error?((0,a.uX)(),(0,a.Wv)(d,{key:0,title:e.$t("pages.screen2b.in_valid_column_error"),name:"priority_high",class:"headerError"},{default:(0,a.k6)((()=>[(0,a.bF)(r,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("pages.screen2b.in_valid_column_error")),1)])),_:1})])),_:1},8,["title"])):(0,a.Q3)("",!0)])),_:2},1032,["props","draggable","dropzone","data-index","onDragstart","onDrop","onDragover","onDragenter","onDragleave","style"])))),128))])),_:2},1032,["props"])])),_:1},8,["rows","columns","no-data-label","onRowClick"])):((0,a.uX)(),(0,a.Wv)(h,{key:1,style:{height:"'200px'"},class:"full-width"},{default:(0,a.k6)((()=>[(0,a.Lk)("thead",null,[!1===e.lineItemsloading?((0,a.uX)(),(0,a.CE)("tr",U,[(0,a.Lk)("th",null,(0,i.v_)(e.$t("no_line_items_found")),1)])):(0,a.Q3)("",!0),!0===e.lineItemsloading?((0,a.uX)(),(0,a.CE)("tr",$,[(0,a.Lk)("th",null,[(0,a.bF)(m,{color:"primary",size:"3em",thickness:10})])])):(0,a.Q3)("",!0)])])),_:1}))])),e.selectedRow&&Object.entries(e.selectedRow).length>0?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.bF)(p,{class:"q-mt-md"}),(0,a.Lk)("div",B,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.tableColumns,((t,o)=>((0,a.uX)(),(0,a.CE)("div",{key:o,class:"col-sm-3 col-md-3 col-lg-3 q-pa-sm"},[(0,a.Lk)("div",J,[(0,a.Lk)("div",H,(0,i.v_)(t.label),1),(0,a.Lk)("div",G,["DATE"==e.lineItemLayout[t.name].column_type?((0,a.uX)(),(0,a.Wv)(L,{key:0,outlined:"",dense:"",modelValue:e.selectedRow[t.name],"onUpdate:modelValue":[o=>e.selectedRow[t.name]=o,o=>{e.changeEvent(t.name,o)}],mask:"date",disable:e.isReadOnly||e.lineItemLayout[t.name].is_readonly,class:"p-b-0"},{append:(0,a.k6)((()=>[e.fieldErros[t.name]?((0,a.uX)(),(0,a.Wv)(d,{key:0,flat:"",dense:"",name:"error",size:"22px",color:"red"},{default:(0,a.k6)((()=>[(0,a.bF)(r,{class:"bg-red",anchor:"bottom left",self:"top left"},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.fieldErros[t.name]),1)])),_:2},1024)])),_:2},1024)):(0,a.Q3)("",!0),(0,a.bF)(d,{name:"event",class:"cursor-pointer"},{default:(0,a.k6)((()=>[(0,a.bF)(b,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.k6)((()=>[(0,a.bF)(f,{modelValue:e.selectedRow[t.name],"onUpdate:modelValue":o=>e.selectedRow[t.name]=o,mask:"YYYY-MM-DD"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",Y,[(0,a.bo)((0,a.bF)(g,{label:"Close",color:"primary",flat:""},null,512),[[R]])])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)])),default:(0,a.k6)((()=>[(0,a.bF)(w,{"touch-position":"","context-menu":""},{default:(0,a.k6)((()=>[(0,a.bF)(k,{dense:"",style:{"min-width":"100px"}},{default:(0,a.k6)((()=>[(0,a.bo)(((0,a.uX)(),(0,a.Wv)(y,{clickable:"",onClick:o=>e.setValueAsDefault(t.name)},{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)("Select as Default")])),_:1})])),_:2},1032,["onClick"])),[[R]]),(0,a.bF)(p),(0,a.bo)(((0,a.uX)(),(0,a.Wv)(y,{clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("close")),1)])),_:1})])),_:1})),[[R]])])),_:2},1024)])),_:2},1024)])),_:2},1032,["modelValue","onUpdate:modelValue","disable"])):e.lovFields.hasOwnProperty(t.name)?((0,a.uX)(),(0,a.Wv)(D,{key:1,outlined:"",dense:"","emit-value":"","map-options":"",modelValue:e.selectedRow[t.name],"onUpdate:modelValue":[o=>e.selectedRow[t.name]=o,o=>{e.dropDownChange(t.name,o)}],options:e.lovFieldsList[e.getKey(t.name)],disable:e.isReadOnly||e.lineItemLayout[t.name].is_readonly},{append:(0,a.k6)((()=>[e.fieldErros[t.name]?((0,a.uX)(),(0,a.Wv)(d,{key:0,flat:"",dense:"",name:"error",size:"22px",color:"red"},{default:(0,a.k6)((()=>[(0,a.bF)(r,{class:"bg-red",anchor:"bottom left",self:"top left"},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.fieldErros[t.name]),1)])),_:2},1024)])),_:2},1024)):(0,a.Q3)("",!0)])),default:(0,a.k6)((()=>[(0,a.bF)(w,{"touch-position":"","context-menu":""},{default:(0,a.k6)((()=>[(0,a.bF)(k,{dense:"",style:{"min-width":"100px"}},{default:(0,a.k6)((()=>[(0,a.bo)(((0,a.uX)(),(0,a.Wv)(y,{clickable:"",onClick:o=>e.setValueAsDefault(t.name)},{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)("Select as Default")])),_:1})])),_:2},1032,["onClick"])),[[R]]),(0,a.bF)(p),(0,a.bo)(((0,a.uX)(),(0,a.Wv)(y,{clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("close")),1)])),_:1})])),_:1})),[[R]])])),_:2},1024)])),_:2},1024)])),_:2},1032,["modelValue","onUpdate:modelValue","options","disable"])):((0,a.uX)(),(0,a.Wv)(L,{key:2,outlined:"",dense:"",modelValue:e.selectedRow[t.name],"onUpdate:modelValue":[o=>e.selectedRow[t.name]=o,o=>{e.changeEvent(t.name,o)}],maxlength:e.getFieldLength(t.name),counter:!!e.getFieldLength(t.name),disable:e.isReadOnly||e.lineItemLayout[t.name].is_readonly},{append:(0,a.k6)((()=>[e.lookup_loading_fields.hasOwnProperty(t.name)?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[e.lookup_loading_fields[t.name].lookup_loading?((0,a.uX)(),(0,a.CE)("div",Z,[(0,a.bF)(C,{color:"primary",size:"0.86em"})])):(0,a.Q3)("",!0),1==e.lookup_loading_fields[t.name].lookup_found?((0,a.uX)(),(0,a.Wv)(d,{key:1,flat:"",dense:"",name:"check_circle",size:"22px",class:"cursor-pointer text-light-green-8",tabindex:"0"},{default:(0,a.k6)((()=>[(0,a.bF)(r,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("lookup_record_found")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0),0==e.lookup_loading_fields[t.name].lookup_found?((0,a.uX)(),(0,a.Wv)(d,{key:2,flat:"",dense:"",name:"warning",size:"22px",class:"cursor-pointer text-orange",tabindex:"0"},{default:(0,a.k6)((()=>[(0,a.bF)(r,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.interpolate(t.name,e.$t("no_lookup_record_found_for_list"))),1)])),_:2},1024)])),_:2},1024)):(0,a.Q3)("",!0)],64)):(0,a.Q3)("",!0),e.lookup_configurations.has(t.name)?((0,a.uX)(),(0,a.Wv)(A,{key:1,class:"cursor-pointer fuzzy-field",size:"18px"},{default:(0,a.k6)((()=>[(0,a.Lk)("img",{src:"images/fuzzy-search.svg",onClick:o=>{o.stopPropagation(),o.preventDefault(),e.masterDataSearchByField(e.selectedRow.id,e.lineDataObj[e.selectedRow.id]["columns"][t.name])}},null,8,ee)])),_:2},1024)):(0,a.Q3)("",!0),e.fieldErros[t.name]?((0,a.uX)(),(0,a.Wv)(d,{key:2,flat:"",dense:"",name:"error",size:"22px",color:"red"},{default:(0,a.k6)((()=>[(0,a.bF)(r,{class:"bg-red",anchor:"bottom left",self:"top left"},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.fieldErros[t.name]),1)])),_:2},1024)])),_:2},1024)):(0,a.Q3)("",!0)])),default:(0,a.k6)((()=>[(0,a.bF)(w,{"touch-position":"","context-menu":""},{default:(0,a.k6)((()=>[(0,a.bF)(k,{dense:"",style:{"min-width":"100px"}},{default:(0,a.k6)((()=>[(0,a.bo)(((0,a.uX)(),(0,a.Wv)(y,{clickable:"",onClick:o=>e.setValueAsDefault(t.name)},{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)("Select as Default")])),_:1})])),_:2},1032,["onClick"])),[[R]]),(0,a.bF)(p),(0,a.bo)(((0,a.uX)(),(0,a.Wv)(y,{clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("close")),1)])),_:1})])),_:1})),[[R]])])),_:2},1024)])),_:2},1024)])),_:2},1032,["modelValue","onUpdate:modelValue","maxlength","counter","disable"]))])])])))),128)),e.isReadOnly?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",te,[(0,a.Lk)("div",oe,[(0,a.bF)(I,{label:e.$t("cancel"),onClick:t[0]||(t[0]=t=>e.selectedRow={}),appearance:"cancel",class:"q-ma-xs"},null,8,["label"]),e.tableRows.length!=e.selectedIndex+1?((0,a.uX)(),(0,a.Wv)(I,{key:0,label:e.$t("save_and_next"),onClick:t[1]||(t[1]=t=>e.saveAndNext()),class:"q-ma-xs"},null,8,["label"])):(0,a.Q3)("",!0),(0,a.bF)(I,{label:e.$t("save"),onClick:t[2]||(t[2]=t=>e.saveChanges(!0,!0,!0)),class:"q-ma-xs"},null,8,["label"])])]))])],64)):(0,a.Q3)("",!0),(0,a.bF)(O,{modelValue:e.fuzzyDialog,"onUpdate:modelValue":t[3]||(t[3]=t=>e.fuzzyDialog=t),seamless:"","full-width":"",position:"left",persistent:"",onKeydown:(0,X.jR)(e.closeMsDialog,["esc"]),title:e.$t("pages.screen2a.validation"),onOnHide:e.closeMsDialog,isResizeAble:!0,draggable:e.isDraggle},{default:(0,a.k6)((()=>[(0,a.bF)(F)])),_:1},8,["modelValue","onKeydown","title","onOnHide","draggable"]),(0,a.bF)(E)],64)}var ie=o(53500),se=o(85192),le=o(46736),ne=o(96056),re=o(8420),de=o(91298),ue=o(18505),_e=o(57366),ce=o(86633),me=o(10739),he=o(68450),pe=o(36801),ge=o(82080),fe=o(10145),be=o(9342),ve=function(e,t,o,a){function i(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function l(e){try{r(a.next(e))}catch(t){s(t)}}function n(e){try{r(a["throw"](e))}catch(t){s(t)}}function r(e){e.done?o(e.value):i(e.value).then(l,n)}r((a=a.apply(e,t||[])).next())}))};let ye=new Map;const ke=(0,a.pM)({el:"#app",mixins:[ce.A,ue.A,ne.A,R.A,ge.A,_e.A,Q.A,le.A,me.A],components:{Loader:re.A,masterDataLookup:be.A,dialogDraggable:fe.A},watch:{populate_row_to_view:{handler:function(e,t){0!=e&&this.populateMSDataFromPopup()}}},updated(){let e=this.user_settings.LINE_ITEM_TABLE_SETTING,t=200;e&&(e=JSON.parse(e),t=e.height);const o=document.getElementById("line_item_table");o&&(t<200&&(t=200),o.style.height=t+"px")},props:{isReadOnly:{type:Boolean,default:!1},defaultValues:{type:Object,default:{}}},data(){return{docId:"",renderKey:0,validation_done:!0,dropdownColumns:[],lovFields:(0,T.KR)({}),AI_table_extraction_setting:P.N1,line_table_columns:P.iS,triggerSave:(0,T.KR)(!1)}},mounted:function(){document.addEventListener("init_line_items",this.lineItemDataLoaded),document.addEventListener("line_item_table-column-drop",this.savedSortedColumns),this.init(),this.initailizeDragColumnsById("line_item_table"),window.vlqd=this},unmounted:function(){document.removeEventListener("init_line_items",this.lineItemDataLoaded),document.removeEventListener("line_item_table-column-drop",this.savedSortedColumns)},methods:{init(){this.checkAITableSetting()},onDragOverWrapper(e,t,o){this.onDragOver(e,t)},allowedColumnSorting(e){return"id"!==e.name&&"action_column"!==e.name},lineItemDataLoaded(e){if(!e||!e.detail)return;this.lineItemsloading=!1;let t=e.detail;this.resetRows(),this.apiData=t,this.docId=this.apiData&&this.apiData.doc_id?this.apiData.doc_id:"",this.refactorApiData(),this.triggerLineItemDataLoadedEvent(),this.createAutoTriggerDebounceFunc(),this.setupLookup()},triggerLineItemDataLoadedEvent(){const e=new CustomEvent("line_items_loaded",{});document.dispatchEvent(e)},savedSortedColumns(){const e=[];this.tableColumns.forEach(((t,o)=>{e[t.name]=t,e[t.name]&&(e[t.name]["org_index"]=o)})),this.updatedLineColumns(this.tableColumns)},updatedLineColumns(e){return ve(this,void 0,void 0,(function*(){try{this.showLoading();let t=this.line_table_columns+"_"+this.doctype;yield this.updateSetting(t,JSON.stringify(e))}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},resetRows(){this.tableRows=[],this.lineDataObj={}},refactorApiData(){this.is_ai_table=this.isAI_TableExit(this.apiData),this.setFormatOptions(),this.table_name=this.apiData.tables&&this.apiData.tables.length>0&&this.apiData.tables[0].hasOwnProperty("name")?this.apiData.tables[0].name:"",this.prepareTableLayoutObj(),this.prepareTableColumn(),this.prepareTableRowsAndRowObj(),this.validateLineItemColumns(),this.triggerSave&&this.saveChanges(!1,!1,!0)},setFormatOptions(){this.formatting_options={},this.apiData.tables[0]&&this.apiData.tables[0].hasOwnProperty("formatting_options")&&(this.formatting_options=this.apiData.tables[0].formatting_options),this.apiData.tables[0].formatting_options=this.formatting_options,this.formatting_options.hasOwnProperty("columns_to_hide")&&null!==this.formatting_options.columns_to_hide&&(this.columns_to_hide=Object.assign([],this.formatting_options.columns_to_hide)),this.formatting_options.hasOwnProperty("custom_columns_to_hide")&&null!==this.formatting_options.custom_columns_to_hide&&(this.custom_columns_to_hide=Object.assign([],this.formatting_options.custom_columns_to_hide)),this.formatting_options.hasOwnProperty("column_origins")&&!(0,he.z)(this.formatting_options.column_origins)&&(0,he.Gv)(this.formatting_options.column_origins)||(this.apiData.tables[0].formatting_options.column_origins={},this.formatting_options.column_origins={})},prepareTableLayoutObj(){this.dropdownColumns=[];let e={};this.lineItemLayout={},this.apiData.tables&&this.apiData.tables.length>0&&this.apiData.tables[0].hasOwnProperty("layout")&&Array.from(this.apiData.tables[0].layout).forEach((t=>{e.hasOwnProperty(t.column_name)||(t["lbl_to_display"]=this.getLabelToDisplay(t),this.lineItemLayout[t.column_name]=t,0==t.is_hidden&&(e[t.column_name]=!0,this.dropdownColumns.push({header:t.lbl_to_display,techName:t.column_name})))}))},prepareTableRowsAndRowObj(){this.tableRows=[],this.lineDataObj={};let e={};this.apiData.tables&&0!=this.apiData.tables.length&&this.apiData.tables[0].hasOwnProperty("rows")&&0!=this.apiData.tables[0].rows.length&&(Array.from(this.apiData.tables[0].rows).forEach((t=>{if(!1===t.is_deleted){let o={};e[t.id]=JSON.parse(JSON.stringify(t)),e[t.id].locations_list=[],t.locations_list&&Array.from(t.locations_list).forEach((o=>{e[t.id].locations_list["page_"+o.page]=o})),delete e[t.id].columns,e[t.id]["columns"]=[],Array.from(t.columns).forEach((a=>{e[t.id].columns[a.name]=JSON.parse(JSON.stringify(a)),e[t.id].columns[a.name].locations_list=[],a.locations_list&&Array.from(a.locations_list).forEach((o=>{e[t.id].columns[a.name].locations_list["page_"+o.page]=o})),((0,he.z)(a.formatted_value)||""==a.formatted_value)&&(a.formatted_value="",this.defaultValues&&this.defaultValues.table&&this.defaultValues.table[a.name]&&this.defaultValues.table[a.name]["UI_DEFAULT_VALUE"]&&(a.value=this.defaultValues.table[a.name]["UI_DEFAULT_VALUE"],a.formatted_value=a.value,a.extraction_method="UD",this.triggerSave=!0)),o[a.name]=a.formatted_value,this.prepareMapOfColumnHavingData(a)})),this.addExtraColumnsInRow(e,o,t.id),o["id"]=t.id,o["show_charges"]=!1;const a=t.hasOwnProperty("is_additional_cost")&&!0===t.is_additional_cost;a||this.tableRows.push(o)}})),Object.assign(this.lineDataObj,e))},prepareMapOfColumnHavingData(e){ye.has(e.name)?!1===ye.get(e.name)&&e.formatted_value&&null!=e.formatted_value&&""!=e.formatted_value&&ye.set(e.name,!0):e.formatted_value&&null!=e.formatted_value&&""!=e.formatted_value?ye.set(e.name,!0):ye.set(e.name,!1)},addExtraColumnsInRow(e,t,o){for(let a of this.layoutExtraColumns){let i={name:a,value:"",content:"",locations:[],locations_list:[],formatted_value:"",is_extra_column:!0};e[o].columns[a]=i,ye.set(a,!1),t[a]=""}},sortTableColumn_old(){let e=JSON.parse(JSON.stringify(this.tableColumns)),t=[];this.tableColumns=[],Array.from(e).forEach(((e,o)=>{1!=this.hasOriginalIndex(e.org_index,e)&&ye.has(e.name)&&!1===ye.get(e.name)?t.push(Object.assign({},e)):this.tableColumns.push(Object.assign({},e))})),t.sort(((e,t)=>{let o=e.field.toLowerCase(),a=t.field.toLowerCase();return o<a?-1:o>a?1:0})),Array.from(t).forEach(((e,t)=>{this.tableColumns.push(Object.assign({},e))}))},sortTableColumn(){this.tableColumns.sort(((e,t)=>e.sortOrder<t.sortOrder?-1:e.sortOrder>t.sortOrder?1:0))},prepareTableColumn(){this.tableColumns=[],this.apiData.tables&&this.apiData.tables.length>0&&this.apiData.tables[0].hasOwnProperty("rows")&&(this.is_ai_table?this.AI_TableColumns():this.normalTableColumns(),this.sortTableColumn())},normalTableColumns(){const e=this.apiData.tables[0].rows[0];if(!e)return;let t={},o=JSON.parse(JSON.stringify(this.lineItemLayout));Array.from(e.columns).forEach((a=>{let i=this.isColumnHidden(e,a);if(i){let e=a.name,i="",s=9999;this.lineItemLayout.hasOwnProperty(a.name)&&(e=this.lineItemLayout[a.name].lbl_to_display,i=this.lineItemLayout[a.name].column_type,s=this.lineItemLayout[a.name].sort_order,delete o[a.name]);let l="";null!=a.org_index&&void 0!=a.org_index&&(l=String(a.org_index));let n={name:a.name,field:a.name,align:"left",label:e,is_mapped:!!a.is_mapped&&a.is_mapped,org_index:l,col_origin:"auto",dataType:i?i.toLowerCase():"string",sortable:!0,sortOrder:s};n.col_origin=this.getColumnOrigin(this.apiData.tables[0],a.name),a.hasOwnProperty("org_index")&&null!=a.org_index?this.tableColumns.push(n):t[a.name]=n}}));for(let[a,i]of Object.entries(t))this.tableColumns.push(Object.assign({},i));for(let a in o){const e=o[a];let t=!this.isCustomColumnHidden(e.name);if(!t){delete o[e.name];continue}const i=this.lineItemLayout[e.column_name].column_type;let s={name:e.column_name,field:e.column_name,align:"left",label:e.lbl_to_display,is_mapped:!!e.is_mapped&&e.is_mapped,org_index:"",is_extra_column:!0,col_origin:"auto",dataType:i?i.toLowerCase():"string",sortable:!0};s.col_origin=this.getColumnOrigin(this.apiData.tables[0],e.column_name),this.tableColumns.push(Object.assign({},s)),this.layoutExtraColumns.push(e.column_name)}},getOrignalColumnName(e){return!e.hasOwnProperty("original_name")||(0,he.z)(e.original_name)?"":String(e.original_name)},is_AI_ColumnVisible(e){let t=!0,o=this.getOrignalColumnName(e);return o&&this.formatting_options&&this.formatting_options.hasOwnProperty("columns_to_hide")&&this.formatting_options.columns_to_hide&&0!=this.formatting_options.columns_to_hide.length?((this.formatting_options.columns_to_hide.includes(o)||"UUID"==e.name)&&(t=!1),t):t},is_AI_isColumnHidden(e,t){let o="";null!=t.original_name&&void 0!=t.original_name&&(o=String(t.original_name));let a=!0;return""!==o&&(a=this.is_AI_ColumnVisible(t)),""===o&&(a=!this.isCustomColumnHidden(t.name)),a&&this.lineItemLayout[t.name]&&(a=!this.lineItemLayout[t.name].is_hidden),a},AI_TableColumns(){let e={},t=[];Array.from(this.apiData.tables[0].rows).forEach((o=>{Array.from(o.columns).forEach((a=>{let i=this.is_AI_isColumnHidden(o,a);if(i&&!e.hasOwnProperty(a.name)){e[a.name]=!0;let o=a.name,i="",s="",l="",n=9999;this.lineItemLayout.hasOwnProperty(a.name)&&(o=this.lineItemLayout[a.name].lbl_to_display,i=this.lineItemLayout[a.name].column_type,s=this.lineItemLayout[a.name].is_required,l=this.lineItemLayout[a.name].always_visible,n=this.lineItemLayout[a.name].sort_order);let r="";null!=a.org_index&&void 0!=a.org_index&&(r=String(a.org_index));let d={name:a.name,field:a.name,align:"left",label:o,is_mapped:!!a.is_mapped&&a.is_mapped,org_index:""!==r?r:"",dataType:i?i.toLowerCase():"string",sortable:!0,is_required:s,always_visible:l,is_extra_column:!!a.hasOwnProperty("is_extra_column")&&a.is_extra_column,original_name:this.getOrignalColumnName(a),sortOrder:n};const u=d.is_mapped||!this.remove_unmapped_columns&&!d.is_mapped;a.hasOwnProperty("org_index")&&null!=a.org_index&&u?this.tableColumns.push(d):t[a.name]=d}}))}));for(let[o,a]of Object.entries(t)){const e=a;(e.hasOwnProperty("is_extra_column")&&!0===e.is_extra_column||e.always_visible||e.is_required)&&this.tableColumns.push(e)}},isCustomColumnHidden(e){let t=!1;if(!this.custom_columns_to_hide||0==this.custom_columns_to_hide.length)return t;for(const o of this.custom_columns_to_hide)if(o===e){t=!0;break}return t},isColumnHidden(e,t){let o="";null!=t.org_index&&void 0!=t.org_index&&(o=String(t.org_index));let a=!0;return""!==o&&(a=this.isColumnVisible(o,t)),a&&this.lineItemLayout[t.name]&&(a=!this.lineItemLayout[t.name].is_hidden),a},isColumnVisible(e,t){if(this.is_ai_table)return this.is_AI_ColumnVisible(t);let o=!0;return e&&this.formatting_options&&this.formatting_options.hasOwnProperty("columns_to_hide")&&this.formatting_options.columns_to_hide&&0!=this.formatting_options.columns_to_hide.length?((this.formatting_options.columns_to_hide.includes(e)||"UUID"==t.name)&&(o=!1),o):o},validateLineItemColumns(){let e=!1;if(void 0===this.tableColumns)return;for(const o of this.tableColumns){let t=this.isColumnNameValid(o);t||(o.error=!0,e=!0)}let t=!e;this.validation_done!==t&&(this.validation_done=t)},isColumnNameValid(e){let t=!1;for(const o of this.dropdownColumns)if(e.name===o.techName||"id"==e.name||"action_column"==e.name){t=!0;break}return t},hasOriginalIndex(e,t){let o=!1;return""!==e&&(o=!0),o},hasLineItems(){return!(!this.tableRows||0===Object.keys(this.tableRows).length)},goTolineItemsPage(){this.removeCache(),this.is_ai_table?this.$router.push("/field_validation_v1/"+this.apiData.doc_id):this.$router.push("/tbl_ext_v3/"+this.apiData.doc_id)},goToDashboard(){this.$router.push("/dashboard")},setValueAsDefault(e){return ve(this,void 0,void 0,(function*(){if(this.selectedRow[e])try{const t=new FormData;t.append("doc_type",this.doctype),t.append("table_key",this.apiData.tables[0].name),t.append("column_name",e),t.append("attribute_name","UI_DEFAULT_VALUE"),t.append("attribute_value",this.selectedRow[e]),t.append("is_organization_default","true"),yield z.M8.setTableAdditionalAttribute(t)}catch(t){if(null!=t&&"object"==typeof t&&t.hasOwnProperty("message"))return void this.showErrorToast(t.message);this.showErrorToast("Error while displaying Page. Please reload again or contact admistrator")}}))},checkAITableSetting(){this.ai_table_setting_flag=!1,this.user_settings[this.AI_table_extraction_setting]&&(this.ai_table_setting_flag=this.user_settings[this.AI_table_extraction_setting])},onRowClick(e,t,o){return ve(this,void 0,void 0,(function*(){this.selectedRow=JSON.parse(JSON.stringify(t)),this.selectedIndex=o,yield this.triggerlookupLovs("",!0,"",!1),yield this.triggerlookupLovsHavingData()}))},saveAndNext(){return ve(this,void 0,void 0,(function*(){let e=yield this.saveChanges(!0,!0,!1);if(!e)return;this.selectedIndex++;const t=this.tableRows[this.selectedIndex];this.onRowClick({},t,this.selectedIndex)}))},saveChanges(e,t,o){return ve(this,void 0,void 0,(function*(){let a=!1;if(this.isReadOnly)return a;if(t&&!this.validateData())return a;try{e&&this.showLoading(),this.tableRows[this.selectedIndex]=this.selectedRow,this.updateJsonForLineItems();const t=yield this.saveDocument(this.docId);if(!1===t.success)return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void this.showErrorToast(t.message);this.$forceUpdate(),this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),a=!0}catch(i){return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void(a=!1)}finally{this.hideLoading(),o&&(this.selectedRow={},this.selectedIndex=null)}return a}))},updateJsonForLineItems(){Array.from(this.apiData.tables[0].rows).forEach(((e,t)=>{this.selectedRow.id===e.id&&Array.from(e.columns).forEach(((e,o)=>{this.apiData.tables[0].rows[t].columns[o].value=this.selectedRow[e.name],this.apiData.tables[0].rows[t].columns[o].content=this.selectedRow[e.name],this.apiData.tables[0].rows[t].columns[o].formatted_value=this.selectedRow[e.name]}))}))},validateData(){let e=!0;for(let[t,o]of Object.entries(this.selectedRow))if(this.lineItemLayout[t]&&this.lineItemLayout[t].is_required&&!o)e=!1,this.fieldErros[t]=this.$t("field_required");else{const a=this.getFieldLength(t);a&&String(o).length>a&&(e=!1,this.fieldErros[t]=this.$t("invalid_field_length"))}return e},dropDownChange(e,t){return ve(this,void 0,void 0,(function*(){try{this.showLoading(),this.updateTableValues(e,t),yield this.triggerlookupLovs(e,!1,t,!0),t&&this.fieldErros[e]&&delete this.fieldErros[e]}catch(o){}finally{this.hideLoading()}}))},changeEvent(e,t){this.updateTableValues(e,t),this.handleLookupAutoTrigger(e),t&&this.fieldErros[e]&&delete this.fieldErros[e]},handleLookupAutoTrigger(e){if((0,he.z)(e)||(0,he.jw)(e))return;let t=this.get_lookup_type_for_changed_field(e);1==t&&(this.get_groups_to_change(),this.updateLookupFieldsStatusInGroups(),this.debounceLookupAutoTriggerFunc())},get_lookup_type_for_changed_field(e){this.changed_fields=[],this.groups_to_update=[];let t=!1;for(let o of this.apiData.tables[0].lookup_configurations)if(!(0,he.z)(o.lookup_dataset_name)&&!(0,he.jw)(o.lookup_dataset_name))for(let a in o.fields)if(o.fields[a].column_name==e){this.groups_to_update.push({group:o,field_name:e,lookup_field:o.fields[a].lookup_field});for(let e of o.fields)this.changed_fields.push(e);this.trigger_lookup_flow=o.lookup_dataset_name,t=!0}return t},createAutoTriggerDebounceFunc(){this.debounceLookupAutoTriggerFunc=(0,ie.A)((()=>{null!=this.trigger_lookup_flow&&""!=this.trigger_lookup_flow&&this.preparing_group_change_call()}),3e3)},triggerlookupLovsHavingData(){return ve(this,void 0,void 0,(function*(){const e=this.apiData.tables[0].lookup_lov_configurations;if(e)for(const[t,o]of Object.entries(this.selectedRow))if(this.lovFields.hasOwnProperty(t)){let e=this.lovFields[t].fields[0].column_name;e&&this.selectedRow[e]&&(yield this.triggerlookupLovs(e,!1,this.selectedRow[e],!1))}}))},triggerlookupLovs(e,t,o,a){return ve(this,void 0,void 0,(function*(){const i=this.apiData.tables[0].lookup_lov_configurations;if(i)e:for(let s of i)if(s.fields&&0!=s.fields.length){this.lovFieldsList[s.column_name]||(this.lovFields[s.column_name]=s,this.lovFieldsList[s.column_name]=[]);for(let i of s.fields)if(t)null==i.column_name&&(this.lovFieldsList[s.column_name]=yield z.SY.getLookupLov(s.id,null));else if(e==i.column_name){const e={[i["lookup_field"]]:o},t=s.column_name+"_"+o;this.lovFieldsList[t]=yield z.SY.getLookupLov(s.id,JSON.stringify(e)),a&&(this.selectedRow[s.column_name]="");break e}}}))},getKey(e){let t=e,o=this.lovFields[e].fields[0].column_name;return o&&this.selectedRow[o]&&(t=e+"_"+this.selectedRow[o]),t},getFieldLength(e){let t=null;return this.defaultValues&&this.defaultValues.table&&this.defaultValues.table[e]&&this.defaultValues.table[e]["UI_MAX_LENGTH"]&&(t=this.defaultValues.table[e]["UI_MAX_LENGTH"]),t},setupLookup(){try{if(this.lookup_configurations=new Map,!this.apiData.tables[0].lookup_configurations)return;for(const[e,t]of this.apiData.tables[0].lookup_configurations.entries())if(t.hasOwnProperty("fields")&&Array.isArray(t.fields))for(const[o,a]of t.fields.entries())a.is_searchable&&this.lookup_configurations.set(a.column_name,Object.assign(JSON.parse(JSON.stringify(a)),{lookup_dataset_name:t.lookup_dataset_name,fields:JSON.parse(JSON.stringify(t.fields))}));this.check_for_auto_trigger()}catch(e){}},check_for_auto_trigger(){this.fields_with_autotrigger=[];for(let e of this.apiData.tables[0].lookup_configurations)if(!(0,he.z)(e.lookup_dataset_name)&&!(0,he.jw)(e.lookup_dataset_name))for(let t in e.fields)!0!==e.fields[t].auto_trigger||this.fields_with_autotrigger.some((o=>o.field_name.toLowerCase()===e.fields[t].column_name.toLowerCase()&&o.lookup_field.toLowerCase()===e.fields[t].lookup_field.toLowerCase()&&o.group===e))||this.fields_with_autotrigger.push({field_name:e.fields[t].column_name,lookup_field:e.fields[t].lookup_field,group:e})},masterDataSearchByField(e,t){try{const o=t.name,a=this.lookup_configurations.get(o);if(!a)return;const i=(0,se.A)(),s=Object.values(this.ms_advance_filters).find((e=>e.field_name===t.name));if(!s&&(this.ms_advance_filters[i]={fuzzy_field:a.lookup_field.toLowerCase(),search_text:t.formatted_value,field_name:o,primary:!0},this.master_lookup_type=a.lookup_dataset_name,this.master_data_fields_map=new Map,this.master_data_fields_map.set(this.master_lookup_type,a),this.master_data_popup_width=this.calculateWidthForMSPopuup(),a.parent_field_id&&""!=a.parent_field_id)){let t=null;for(const[e,o]of a.fields.entries())if(a.parent_field_id==o.field_id){t=o;break}if(t){const o=(0,se.A)();this.ms_advance_filters[o]={fuzzy_field:t.lookup_field.toLowerCase(),search_text:this.lineDataObj[e]["columns"][t.field_name].formatted_value,field_name:t.field_name,primary:!1}}}this.fuzzyDialog=!0}catch(o){}},calculateWidthForMSPopuup(){let e="700";const t=document.querySelector(".field_validation");if(!t)return e;const o=document.querySelector("#field_scrolle");if(!o)return e;const a=o.offsetWidth;return a<=0?e:String(a)},closeMsDialog(){this.fuzzyDialog=!1,this.ms_advance_filters={}},get_changed_fields(e){const t=e.fields;for(let[o,a]of t.entries())this.changed_fields.push(a)},get_groups_to_change(){for(let e of this.fields_with_autotrigger)for(let t of this.changed_fields)t.column_name.toLowerCase()!=e.field_name.toLowerCase()&&t.lookup_field.toLowerCase()!=e.lookup_field.toLowerCase()||this.groups_to_update.some((o=>o.group===e.group&&o.field_name.toLowerCase()===t.column_name.toLowerCase()&&o.lookup_field.toLowerCase()===t.lookup_field.toLowerCase()))||this.groups_to_update.push({group:e.group,field_name:e.field_name,lookup_field:e.lookup_field})},removeCurrentSelectedGroup(e){this.groups_to_update=this.groups_to_update.filter((t=>t.group.lookup_dataset_name!==e))},updateLookupFieldsStatusInGroups(e=!0,t=!0){for(let o in this.groups_to_update){const a=this.groups_to_update[o].group;for(let[o,i]of a.fields.entries())this.handleLookupFieldStatus(i.column_name,e,t)}},handleLookupFieldStatus(e,t,o=!0){this.lineDataObj[this.selectedRow.id]["columns"].hasOwnProperty(e)&&(this.lookup_loading_fields.hasOwnProperty(e)||(this.lookup_loading_fields[e]={}),this.lookup_loading_fields[e].lookup_loading=t,o&&(this.lookup_loading_fields[e].lookup_found=null,this.lookup_loading_fields[e].lookup_found_name=null))},populateMSDataFromPopup(){this.changed_fields=[],this.groups_to_update=[];let e=this.master_data_fields_map.get(this.master_lookup_type);this.get_changed_fields(e),this.get_groups_to_change(),this.removeCurrentSelectedGroup(this.master_lookup_type),this.populateMasterDataFields(e,this.master_lookup_type,this.master_data_row),this.updateLookupFieldsStatusInGroups(),this.preparing_group_change_call()},preparing_group_change_call(){return ve(this,void 0,void 0,(function*(){const e={};for(let t in this.groups_to_update){const o=this.groups_to_update[t].group;if((0,he.z)(this.groups_to_update[t].group.lookup_dataset_name)||(0,he.jw)(this.groups_to_update[t].group.lookup_dataset_name)||e.hasOwnProperty(this.groups_to_update[t].group.id))continue;const a=this.groups_to_update[t].group.lookup_dataset_name;e[this.groups_to_update[t].group.id]=!0;const i={},s=(0,se.A)();let l=this.groups_to_update[t].field_name,n=this.groups_to_update[t].lookup_field;i[s]={field:{field:n},operator:this.getFieldOperator(l,this.groups_to_update[t]),search_text:this.lineDataObj[this.selectedRow.id]["columns"][l].formatted_value};let r=yield this.autoTriggerSearchByField(i,a);if(null!=r){const e=JSON.stringify(r.data[0]);this.populateMasterDataFields(o,a,e),this.lookup_loading_fields[l].lookup_found=!0}else this.lookup_loading_fields[l].lookup_found=!1,this.lookup_loading_fields[l].lookup_found_name=a}this.trigger_lookup_flow="",this.updateLookupFieldsStatusInGroups(!1,!1)}))},populateMasterDataFields(e,t,o){try{this.closeMsDialog(),this.showLoading(),this.freeze_fields_change_event=!0;let t=JSON.parse(o);const a=e.fields;for(let[e,o]of a.entries()){const e=o.column_name,a=o.lookup_field.toLowerCase();if(!this.lineDataObj[this.selectedRow.id]["columns"].hasOwnProperty(e))continue;if(0==t.hasOwnProperty(a)||null==t[a])continue;let i=t[a];t.hasOwnProperty(a+"_formatted_value")&&(i=t[a+"_formatted_value"]),this.updateTableValues(e,i)}this.resetMasterDataStore()}catch(a){}finally{this.hideLoading(),this.freeze_fields_change_event=!1}},updateTableValues(e,t){this.lineDataObj[this.selectedRow.id]["columns"][e].value=t,this.lineDataObj[this.selectedRow.id]["columns"][e].content=t,this.lineDataObj[this.selectedRow.id]["columns"][e].formatted_value=t,this.selectedRow[e]=t},getFieldOperator(e,t){for(let o of t.group.fields)if(o.field_name==e&&o.hasOwnProperty("search_operator")&&!(0,he.z)(o.search_operator)&&!(0,he.jw)(o.search_operator))return o.search_operator;return"contains"}},setup(){const e=(0,T.KR)(null);let t=[],o={};const a=(0,j.q3)(),{record:i,doctype:s,remove_unmapped_columns:l}=(0,E.bP)(a),{removeCache:n,isAI_TableExit:r,saveDocument:d,saveFieldsStateForAutotrigger:u}=a;(0,de.wYm)(e,(0,ie.A)((e=>{const t=e[0];if(c.value.LINE_ITEM_TABLE_SETTING){const e=JSON.parse(c.value.LINE_ITEM_TABLE_SETTING);if(e&&e.height==t.contentRect.height)return}t.contentRect.width<20||t.contentRect.height<20||((0,pe.wd)("LINE_ITEM_TABLE_SETTING",JSON.stringify(t.contentRect)),(0,N._Y)("LINE_ITEM_TABLE_SETTING",JSON.stringify(t.contentRect),!0),c.value["LINE_ITEM_TABLE_SETTING"]=JSON.stringify(t.contentRect))}),1e3));const _=(0,j.Bu)(),{user_settings:c}=(0,E.bP)(_),{updateSetting:m}=_,h=(0,j.vm)(),{searchByField:p,interpolate:g}=h,{lookup_loading_fields:f,trigger_lookup_flow:b}=(0,E.bP)(h),v=(0,j.Ox)(),{model:y,advance_filters:k,master_lookup_type:w,changed_fields:L,groups_to_update:D,fields_with_autotrigger:C,selected_row:A,populate_row_to_view:I,master_data_fields_map:F,isDraggle:O}=(0,E.bP)(v),{resetMasterDataStore:R,isContentChanged:x,isCurrentFieldPrimary:S}=v;return{saveDocument:d,user_settings:c,updateSetting:m,remove_unmapped_columns:l,ai_table_setting_flag:(0,T.KR)(!1),record:i,doctype:s,el:e,removeCache:n,isAI_TableExit:r,is_ai_table:(0,T.KR)(!1),lineItemsloading:(0,T.KR)(!0),tableColumns:(0,T.KR)(t),tableRows:(0,T.KR)(t),apiData:(0,T.KR)(t),table_name:(0,T.KR)(""),lineDataObj:{},lovFieldsList:(0,T.KR)({}),lineItemLayout:(0,T.KR)(t),formatting_options:(0,T.KR)(o),custom_columns_to_hide:(0,T.KR)(t),columns_to_hide:(0,T.KR)(t),layoutExtraColumns:(0,T.KR)([]),selectedRow:(0,T.KR)({}),fieldErros:(0,T.KR)({}),selectedIndex:(0,T.KR)(),resetMasterDataStore:R,isDraggle:O,changed_fields:L,master_data_row:A,groups_to_update:D,master_lookup_type:w,ms_advance_filters:k,populate_row_to_view:I,master_data_fields_map:F,fields_with_autotrigger:C,interpolate:g,autoTriggerSearchByField:p,saveFieldsStateForAutotrigger:u,trigger_lookup_flow:b,lookup_loading_fields:f,debounceLookupAutoTriggerFunc:{},master_data_popup_width:(0,T.KR)("700"),lookup_configurations:new Map,fuzzyDialog:(0,T.KR)(!1),freeze_fields_change_event:!1}}});var we=o(12807),Le=o(42315),De=o(44488),Ce=o(57722),Ae=o(50492),Ie=o(97410),Fe=o(857),Oe=o(58210),Ee=o(10386),Re=o(67837),xe=o(48975),Se=o(93692),Te=o(56384),Ve=o(84436),Pe=o(53999),qe=o(90124),je=o(25173),Ne=o(94940),ze=o(82157),We=o(3952),Qe=o(18301),Ke=o(67156),Me=o(88672),Xe=o(98582),Ue=o.n(Xe);const $e=(0,we.A)(ke,[["render",ae],["__scopeId","data-v-258aff3a"]]),Be=$e;Ue()(ke,"components",{QTable:Le.A,QTr:De.A,QTh:Ce.A,QIcon:Ae.A,QTooltip:Ie.A,QMarkupTable:Fe.A,QSpinner:Oe.A,QSeparator:Ee.A,QInput:Re.A,QPopupProxy:xe.A,QDate:Se.A,QBtn:Te.A,QMenu:Ve.A,QList:Pe.A,QItem:qe.A,QItemSection:je.A,QSelect:Ne.A,QSpinnerIos:ze.A,QAvatar:We.A,QBtnDropdown:Qe.A,QField:Ke.A}),Ue()(ke,"directives",{ClosePopup:Me.A});var Je=o(94822),He=o(95488),Ge=o(12566),Ye=function(e,t,o,a){function i(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function l(e){try{r(a.next(e))}catch(t){s(t)}}function n(e){try{r(a["throw"](e))}catch(t){s(t)}}function r(e){e.done?o(e.value):i(e.value).then(l,n)}r((a=a.apply(e,t||[])).next())}))};M.A.table.arrowUp="arrow_drop_down";const Ze=(0,a.pM)({el:"#app",mixins:[R.A,x.A,Q.A],components:{SubHeader:He.A,LineItems:Be,DocumentLock:W.A,MessageBanner:K.A,ImageComponent:Je["default"],ErrorDocumentView:Ge.A},data(){return{docId:"",error_message:"",dynamicWidth:(0,T.KR)(0),imageFieldSplitter:(0,T.KR)(76),defalutAttributes:(0,T.KR)({})}},mounted(){this.docId=this.$route.params.id,this.record=[],this.init(),window.vqd=this},methods:{init(){return Ye(this,void 0,void 0,(function*(){try{if(this.processing=!0,yield this.getDocumentById(this.docId),!this.record||0===Object.keys(this.record).length||!1===this.record.success)return;const e=yield z.M8.getAdditionalAttributes(this.doctype);e.success&&this.prepareDefaultVaueObj(e),this.makeModel(),this.handleReadOnly(),this.initPage()}catch(e){if(null!=e&&"object"==typeof e&&e.hasOwnProperty("message"))return void this.showErrorToast(e.message);this.showErrorToast("Error while displaying Page. Please reload again or contact admistrator")}finally{this.processing=!1}}))},prepareDefaultVaueObj(e){if(this.defalutAttributes["fields"]={},this.defalutAttributes["table"]={},e.field_attributes)for(const[t,o]of Object.entries(e.field_attributes)){this.defalutAttributes["fields"][t]=[];for(const[e,a]of Object.entries(o))this.defalutAttributes["fields"][t][e]=a}if(e.table_attributes)for(const[t,o]of Object.entries(e.table_attributes)){for(const[e,t]of Object.entries(o)){this.defalutAttributes["table"][e]=[];for(const[o,a]of Object.entries(t))this.defalutAttributes["table"][e][o]=a}break}},makeModel(){for(let t of this.record.fields)t.formatted_value&&(this.checkForDefaultValues(t),this.documentFields[t.name]=t);let e=this.record.layout.groups;e.forEach(((e,t)=>{e.rows.forEach(((e,t)=>{e.forEach(((e,t)=>{this.documentFields[e.field_name]&&this.documentFieldsConfig.push(e)}))}))}))},checkForDefaultValues(e){if(e.formatted_value)return;if(!this.defalutAttributes["fields"][e.name]&&!this.defalutAttributes["fields"][e.name]["UI_DEFAULT_VALUE"])return;const t=this.defalutAttributes["fields"][e.name]["UI_DEFAULT_VALUE"];t&&(e.value=t,e.formatted_value=t,e.extraction_method="UD")},splitterChanged(){let e=window.innerWidth,t=e*(100-this.imageFieldSplitter)/100;this.dynamicWidth=t},handleReadOnly(){if(this.record.status!=P.aH.ready_for_validation)return this.is_view_readonly=!0,this.trigger_document_lock=!1,void(this.error_message=this.$t("pages.messages.READ_ONLY_MSG"));this.trigger_document_lock=!0;const e=S.tH.hasAccess("update");e||(this.is_view_readonly=!0)},initLineItems(){const e=new CustomEvent("init_line_items",{detail:this.record});document.dispatchEvent(e)},initPage(){this.record&&this.record.fields&&(this.table_name=this.record.tables&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("name")?this.record.tables[0].name:"",this.setDataToCache(),this.initLineItems())},getLineItemsPoV3Ref(){let e=this.$refs.lineItemsPoV3;return e&&Array.isArray(e)?e[0]:e},toggleImageArea(){this.imageFieldSplitter>=90?this.imageFieldSplitter=70:this.imageFieldSplitter=100},togglePoImage(){"chevron_left"===this.togglerIcon?this.togglerIcon="chevron_right":this.togglerIcon="chevron_left",(0,q.$)("#po-image-container").classList.toggle("hidden"),(0,q.$)("#po-container-parrent").classList.toggle("po-container-parrent"),(0,q.$)("#po-container-parrent").classList.toggle("po-container-parrent-full-width")},routeToBack(){try{if(history.state.back)return void this.$router.back();this.$router.push("/field_validation_v1/"+this.docId)}catch(e){this.$router.push("/field_validation_v1/"+this.docId)}}},setup(){const e=(0,j.q3)(),{record:t,error:o,processing:a,doctype:i,document_version:s}=(0,E.bP)(e),{getDocumentById:l,saveDocument:n,removeCache:r,setDataToCache:d}=e;return{removeCache:r,saveDocument:n,setWithExpiry:N._Y,setDataToCache:d,getDocumentById:l,saveUserPrefToServer:pe.wd,record:t,doctype:i,processing:a,document_version:s,doc_fetch_error:(0,T.KR)(o),trigger_document_lock:(0,T.KR)(!1),is_view_readonly:(0,T.KR)(!1),documentFields:(0,T.KR)([]),documentFieldsConfig:(0,T.KR)([]),togglerIcon:(0,T.KR)("chevron_right"),baseUrl:V.VA,table_name:(0,T.KR)("")}}});var et=o(98072),tt=o(39035),ot=o(71746);const at=(0,we.A)(Ze,[["render",O],["__scopeId","data-v-7c8c41e6"]]),it=at;Ue()(Ze,"components",{QSplitter:et.A,QBtn:Te.A,QIcon:Ae.A,QInput:Re.A,QSeparator:Ee.A,QInnerLoading:tt.A,QField:Ke.A,QTabPanel:ot.A})}}]);