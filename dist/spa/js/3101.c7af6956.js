"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[3101],{3101:(e,t,a)=>{a.r(t),a.d(t,{default:()=>J});var l=a(61758),i=a(58790);const o=e=>((0,l.Qi)("data-v-f324a92a"),e=e(),(0,l.jt)(),e),s={class:"row"},n={class:"col-3 q-pt-sm q-pl-lg"},d={class:""},r={class:""},m={class:""},u={key:0},p={class:"col-9 q-pt-sm q-pl-lg q-pr-lg",ref:"editorContainer",style:{height:"calc(100vh - 200px)"}},c={key:0,class:"editor-wrapper"},_={key:1},h={class:"text-weight-bold"},g={class:"row"},b={style:{width:"100%"}},f=o((()=>(0,l.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1)));function v(e,t,a,o,v,y){const k=(0,l.g2)("SubHeader"),E=(0,l.g2)("f-btn"),F=(0,l.g2)("BackToSettings"),T=(0,l.g2)("q-input"),V=(0,l.g2)("q-select"),C=(0,l.g2)("q-tooltip"),w=(0,l.g2)("q-icon"),S=(0,l.g2)("q-editor"),$=(0,l.g2)("Editor"),q=(0,l.g2)("q-form"),A=(0,l.g2)("q-toolbar-title"),D=(0,l.g2)("q-btn"),U=(0,l.g2)("q-toolbar"),L=(0,l.g2)("q-card-section"),x=(0,l.g2)("q-card-actions"),I=(0,l.g2)("q-card"),K=(0,l.g2)("q-dialog"),Q=(0,l.g2)("q-inner-loading"),j=(0,l.gN)("close-popup");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(k,{name:"add_email_templates",label:e.$t("edit_template")},null,8,["label"]),(0,l.bF)(F,{label:e.$t("email_templates"),back_to_rotue:"/settings/supplier/email_templates"},{default:(0,l.k6)((()=>[(0,l.bF)(E,{class:"float-right",label:e.$t("save"),onClick:e.submitForm},null,8,["label","onClick"]),(0,l.bF)(E,{class:"float-right q-mr-sm",label:e.$t("send_test"),onClick:e.sendTest},null,8,["label","onClick"])])),_:1},8,["label"]),(0,l.bF)(q,{onSubmit:e.submit,ref:"editForm"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",s,[(0,l.Lk)("div",n,[(0,l.Lk)("div",d,[(0,l.bF)(T,{outlined:"",dense:"",label:e.$t("name"),modelValue:e.email_template_data.name,"onUpdate:modelValue":t[0]||(t[0]=t=>e.email_template_data.name=t),"lazy-rules":"",rules:[t=>t&&t.length>0||e.$t("please_input_name")]},null,8,["label","modelValue","rules"])]),(0,l.Lk)("div",r,[(0,l.bF)(T,{outlined:"",dense:"",label:e.$t("subject"),modelValue:e.email_template_data.subject,"onUpdate:modelValue":t[1]||(t[1]=t=>e.email_template_data.subject=t),"lazy-rules":"",rules:[t=>t&&t.length>0||e.$t("please_input_name")]},null,8,["label","modelValue","rules"])]),(0,l.Lk)("div",m,[(0,l.bF)(V,{label:e.$t("select_email_template"),"map-options":"",dense:"",outlined:"",modelValue:e.email_template_data.email_type,"onUpdate:modelValue":[t[2]||(t[2]=t=>e.email_template_data.email_type=t),e.selectEmailChange],options:e.supplierEmailOptions,"emit-value":"",disable:!0},null,8,["label","modelValue","options","onUpdate:modelValue"])]),e.filteredDataKey.length?((0,l.uX)(),(0,l.CE)("div",u,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.filteredDataKey,(t=>((0,l.uX)(),(0,l.CE)("div",{key:t.index},[(0,l.bF)(T,{style:{"margin-top":"20px"},outlined:"",dense:"",label:t.name,modelValue:e.filteredDataValues[t.key],"onUpdate:modelValue":a=>e.filteredDataValues[t.key]=a},{append:(0,l.k6)((()=>[(0,l.bF)(w,{name:"content_copy",style:{"font-size":"16px"},class:"cursor-pointer",onClick:a=>e.clickToCopyKey(t.key)},{default:(0,l.k6)((()=>[(0,l.bF)(C,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.$t("click_to_copy_key")),1)])),_:1})])),_:2},1032,["onClick"])])),_:2},1032,["label","modelValue","onUpdate:modelValue"])])))),128))])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",p,[e.view_source?((0,l.uX)(),(0,l.CE)("div",_,[(0,l.bF)(w,{name:"code",style:{"font-size":"18px"},class:"q-pb-sm cursor-pointer",onClick:e.backToEditor},null,8,["onClick"]),(0,l.bF)(w,{name:"edit_note",class:"format-icon cursor-pointer q-pb-sm",onClick:e.formatCode},{default:(0,l.k6)((()=>[(0,l.bF)(C,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.$t("format_button")),1)])),_:1})])),_:1},8,["onClick"]),(0,l.bF)($,{editorValue:e.email_template_data.value,formatCode:e.is_format_code,onUpdatedValue:e.updateValue,onFormatComplete:e.afterFormatted},null,8,["editorValue","formatCode","onUpdatedValue","onFormatComplete"])])):((0,l.uX)(),(0,l.CE)("div",c,[(0,l.bF)(S,{style:(0,i.Tr)(`min-height:28rem;height: ${e.editorHeight}px;max-height: ${e.editorHeight}px;`),modelValue:e.email_template_data.value,"onUpdate:modelValue":t[3]||(t[3]=t=>e.email_template_data.value=t),definitions:{upload:{tip:"Upload to cloud",icon:"cloud_upload",label:"Upload",handler:e.openFileDialog},viewsource:{icon:"code",handler:e.openViewSource}},toolbar:[["left","center","right","justify"],["quote","unordered","ordered","outdent","indent"],["viewsource"],["bold","italic","strike","underline"],["undo","redo"],["upload"]]},null,8,["style","modelValue","definitions"]),(0,l.Lk)("input",{type:"file",ref:"fileInput",style:{display:"none"},onChange:t[4]||(t[4]=(...t)=>e.handleFileUpload&&e.handleFileUpload(...t))},null,544)]))],512)])])),_:1},8,["onSubmit"]),(0,l.bF)(K,{modelValue:e.send_test_dialog,"onUpdate:modelValue":t[6]||(t[6]=t=>e.send_test_dialog=t),persistent:""},{default:(0,l.k6)((()=>[(0,l.bF)(I,{style:{width:"500px"}},{default:(0,l.k6)((()=>[(0,l.bF)(U,{class:"text-white secondary-toolbar"},{default:(0,l.k6)((()=>[(0,l.bF)(A,null,{default:(0,l.k6)((()=>[(0,l.Lk)("span",h,(0,i.v_)(e.$t("send_test")),1)])),_:1}),(0,l.bo)((0,l.bF)(D,{flat:"",round:"",dense:"",icon:"close"},null,512),[[j]])])),_:1}),(0,l.bF)(q,{onSubmit:e.submitSendTest},{default:(0,l.k6)((()=>[(0,l.bF)(L,null,{default:(0,l.k6)((()=>[(0,l.Lk)("div",g,[(0,l.Lk)("div",b,[(0,l.bF)(T,{outlined:"",dense:"",label:e.$t("receiver_email"),modelValue:e.receiver_email,"onUpdate:modelValue":t[5]||(t[5]=t=>e.receiver_email=t),rules:[t=>t&&t.length>0||e.$t("please_input_email"),t=>e.isValidEmail(t)||e.$t("invalid_email")]},null,8,["label","modelValue","rules"])])])])),_:1}),(0,l.bF)(x,{align:"right"},{default:(0,l.k6)((()=>[(0,l.bo)((0,l.bF)(E,{appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[j]]),(0,l.bF)(E,{class:"q-mr-sm","data-cy":"setvatfield",label:e.$t("send"),type:"submit"},null,8,["label"])])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"]),(0,l.bF)(Q,{showing:e.loading,style:{"z-index":"2"}},{default:(0,l.k6)((()=>[f])),_:1},8,["showing"])],64)}var y=a(38734),k=a(95488),E=a(60894),F=a(94124),T=a(1659),V=a(64775),C=a(24622),w=a(23537),S=a(78652),$=a(25577),q=function(e,t,a,l){function i(e){return e instanceof a?e:new a((function(t){t(e)}))}return new(a||(a=Promise))((function(a,o){function s(e){try{d(l.next(e))}catch(t){o(t)}}function n(e){try{d(l["throw"](e))}catch(t){o(t)}}function d(e){e.done?a(e.value):i(e.value).then(s,n)}d((l=l.apply(e,t||[])).next())}))};const A=(0,l.pM)({el:"#app",mixins:[C.A],components:{SubHeader:k.A,BackToSettings:E.A,Editor:$.A},mounted(){this.init(),this.getSampleTemplatedata(),this.setEditorHeight(),window.addEventListener("resize",this.setEditorHeight)},unmounted(){window.removeEventListener("resize",this.setEditorHeight)},computed:{filteredEmailItem(){const e=this.sample_data.filter((e=>e.email_type===this.email_template_data.email_type));return e.length>0&&e.map((e=>{this.filteredDataKey=e.data_key})),""}},watch:{filteredEmailItem(e){this.filteredDataKey=e}},methods:{setEditorHeight(){this.$nextTick((function(){const e=this.$refs.editorContainer;if(e){const t=e.getBoundingClientRect().height;this.editorHeight=t}}))},formatCode(){this.is_format_code=!0},afterFormatted(e){this.is_format_code=e},isValidEmail(e){const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)},updateValue(e){this.email_template_data.value=e},openViewSource(){this.view_source=!0},backToEditor(){this.view_source=!1},init(){return q(this,void 0,void 0,(function*(){yield this.getEmailTemplateId()}))},getEmailTemplateId(){return q(this,void 0,void 0,(function*(){try{this.loading=!0,this.email_template_id=this.$route.params.id,this.email_template_id&&(yield this.getOneEmailTemplate(this.email_template_id))}catch(e){}finally{this.loading=!1}}))},getSampleTemplatedata(){return q(this,void 0,void 0,(function*(){try{yield this.getSampleData()}catch(e){}}))},submitForm(){const e=this.$refs.editForm;e.submit()},submit(){return q(this,void 0,void 0,(function*(){try{if(!this.email_template_data.value.trim())return void this.$q.notify({type:"negative",message:"Email content cannot be empty"});{this.loading=!0;const e=yield this.updateEmailTemplate(this.email_template_id,this.email_template_data);e&&(yield this.getEmailTemplateId(),this.showSuccessToast(this.t("email_template_updated_success")))}}catch(e){const t=V.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},sendTest(){this.send_test_dialog=!0},submitSendTest(){return q(this,void 0,void 0,(function*(){try{this.send_test_dialog=!1,this.loading=!0,this.prepareDataSend={receiver_email:this.receiver_email,subject:this.email_template_data.subject,body:this.email_template_data.value,data:Object.assign({},this.filteredDataValues)};const e=yield this.sendTestEmail(this.prepareDataSend);e&&this.showSuccessToast(this.t("email_send_successfully")),this.receiver_email=""}catch(e){const t=V.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},openFileDialog(){const e=this.$refs.fileInput;e&&e.click()},handleFileUpload(e){return q(this,void 0,void 0,(function*(){const t=e.target;if(t.files&&t.files[0]){const e=t.files[0];yield this.onUploadFile(e),e.type.startsWith("image/")?this.insertImageToEditor(this.stream_file_data):this.insertFileLinkToEditor(this.stream_file_data,e.name)}}))},insertImageToEditor(e){this.email_template_data.value+=`<img src="${e}" alt="Uploaded Image" />`},insertFileLinkToEditor(e,t){const a=`<a class="cursor-pointer" href="${e}" target="_blank">${t}</a>`;this.email_template_data.value+=a},selectEmailChange(e){this.email_template_data.email_type=e},resetSendEmailData(){this.receiver_email="",this.filteredDataValues=[]},clickToCopyKey(e){return q(this,void 0,void 0,(function*(){const t=`{{${e}}}`;yield(0,S.A)(t),this.showSuccessToast(this.t("copy_key_successfully"))}))}},data(){return{files:(0,y.KR)(null),email_template_id:(0,y.KR)(""),receiver_email:(0,y.KR)(""),filteredDataKey:(0,y.KR)([]),filteredDataValues:(0,y.KR)([]),prepareDataSend:{},view_source:(0,y.KR)(!1),is_format_code:(0,y.KR)(!1),editorHeight:0}},setup(){const e=(0,F.M_)(),{loading:t,email_template_data:a,send_test_dialog:l,sample_data:i,stream_file_data:o}=(0,T.bP)(e),{getOneEmailTemplate:s,updateEmailTemplate:n,onUploadFile:d,getSampleData:r,sendTestEmail:m}=e,{t:u}=(0,w.s9)();return{t:u,onUploadFile:d,getOneEmailTemplate:s,updateEmailTemplate:n,getSampleData:r,sendTestEmail:m,email_template_data:a,loading:t,send_test_dialog:l,sample_data:i,stream_file_data:o,supplierEmailOptions:[{label:"Supplier Invitation Email",value:"supplier_invite"},{label:"Supplier Registration Completion Email",value:"supplier_register"},{label:"Supplier Approval Email",value:"supplier_approve"},{label:"Supplier Rejection Email",value:"supplier_reject"}]}}});var D=a(12807),U=a(49200),L=a(67837),x=a(94940),I=a(50492),K=a(97410),Q=a(79075),j=a(82156),H=a(23316),R=a(36914),z=a(39150),O=a(56384),X=a(44189),B=a(62669),M=a(39035),P=a(88672),W=a(98582),N=a.n(W);const G=(0,D.A)(A,[["render",v],["__scopeId","data-v-f324a92a"]]),J=G;N()(A,"components",{QForm:U.A,QInput:L.A,QSelect:x.A,QIcon:I.A,QTooltip:K.A,QEditor:Q.A,QDialog:j.A,QCard:H.A,QToolbar:R.A,QToolbarTitle:z.A,QBtn:O.A,QCardSection:X.A,QCardActions:B.A,QInnerLoading:M.A}),N()(A,"directives",{ClosePopup:P.A})}}]);