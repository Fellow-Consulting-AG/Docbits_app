"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[2933],{22933:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ki});var o=i(61758),s=i(58790),a=i(29104);const r=e=>((0,o.Qi)("data-v-27871c44"),e=e(),(0,o.jt)(),e),l={class:"row highlighted-back q-pl-md top-back-button-bar"},n={class:"row full-width"},d={class:"primary-dashboard"},c={key:2,class:"row q-pl-md q-pb-xs",id:"validation_view"},h={class:"full-width scroll-area-height-validation",id:"right_section",ref:"right_section"},u={class:"q-pr-sm q-pa-sm"},p={class:"coa-fields-content-height"},_={class:"scroll-area-height-validation"},m={id:"image_container"},f={class:"full-width",id:"image_scrolle",style:{position:"relative"}},g=r((()=>(0,o.Lk)("div",{class:"img-magnifier-glass"},null,-1))),v={id:"validate-container",class:""},b=["src","width"],y=["width","height","viewBox"],w={id:"marquee",ref:"marquee",x:"450",y:"420",width:"150",height:"150"},k={id:"boxes",ref:"boxes"},C={class:"hidden",id:"left_section",ref:"left_section"},F={key:0,class:"scroll-area-height-validation max-width-240"},E={class:"row justify-center q-pl-md q-pr-md q-pt-md"},L={class:"secondary-c-text text-h6 text-weight-bold"},x={class:"row"},M={class:"page-numbers center-inner"},S={class:"full-width pages-left-scroll-area-height scrolle-y pages-section-padding row justify-center"},T=["data-id","src"],A={key:1},D={key:2,class:"scroll-area-height-validation max-width-240 relative-position"},I={key:3,class:"row bg-grey-2 q-pl-md q-pr-md q-pb-md"},O=r((()=>(0,o.Lk)("div",{class:"text-h6 text-bold"},"Need help deciding?",-1))),R={class:"row"},B={class:"text-weight-bold"},P={class:""},V={class:"text-weight-bold"},N={class:"row",style:{"border-radius":"5px"}},q={class:"full-width"},$=r((()=>(0,o.Lk)("div",{class:"full-width"}," MONITOR 1 ",-1))),U={class:"full-width"},W=r((()=>(0,o.Lk)("div",{class:"full-width"}," MONITOR 2 ",-1))),K={class:"footer-filename"},z={class:"footer-status-message"},Q={class:"next-prev-buttons float-right q-ml-auto"},X=r((()=>(0,o.Lk)("img",{width:"24",src:"images/back_new_2.svg"},null,-1))),j=r((()=>(0,o.Lk)("img",{width:"24",src:"images/forward_new.svg"},null,-1))),H={class:"footer-status-message"},G={key:3},J={key:4,class:"q-ml-auto"},Y={key:6,class:"footer-status-message q-px-md"};function Z(e,t,i,r,Z,ee){const te=(0,o.g2)("DocumentLock"),ie=(0,o.g2)("InvoiceDuplicateLock"),oe=(0,o.g2)("MessageBanner"),se=(0,o.g2)("SubHeader"),ae=(0,o.g2)("q-icon"),re=(0,o.g2)("f-btn"),le=(0,o.g2)("timeSpentTimer"),ne=((0,o.g2)("AISeverityLevel"),(0,o.g2)("CoaFields")),de=(0,o.g2)("q-btn"),ce=(0,o.g2)("q-resize-observer"),he=(0,o.g2)("AnnotationView"),ue=(0,o.g2)("q-splitter"),pe=(0,o.g2)("supportForm"),_e=(0,o.g2)("TaskList"),me=(0,o.g2)("ErrorDocumentView"),fe=(0,o.g2)("Loader"),ge=(0,o.g2)("q-space"),ve=(0,o.g2)("q-card-section"),be=(0,o.g2)("q-card"),ye=(0,o.g2)("q-dialog"),we=(0,o.g2)("SplitDocument"),ke=(0,o.g2)("q-toolbar-title"),Ce=(0,o.g2)("q-toolbar"),Fe=(0,o.g2)("ScriptLogs"),Ee=(0,o.g2)("q-card-actions"),Le=(0,o.g2)("q-select"),xe=(0,o.g2)("q-separator"),Me=(0,o.g2)("q-badge"),Se=(0,o.g2)("q-tooltip"),Te=(0,o.g2)("NonMappedColumnsBtn"),Ae=(0,o.g2)("BlockSupplier"),De=(0,o.g2)("IgnoreTableValidation"),Ie=(0,o.g2)("UnBlockSupplier"),Oe=(0,o.g2)("q-slider"),Re=(0,o.g2)("q-footer"),Be=(0,o.gN)("close-popup");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bF)(te,{document_version:e.document_version,trigger_document_lock:e.trigger_document_lock,doc_id:e.docId,onSetTriggerDocumentLock:e.setTriggerDocumentLock},null,8,["document_version","trigger_document_lock","doc_id","onSetTriggerDocumentLock"]),!e.trigger_document_lock&&e.isInvoiceDuplicate?((0,o.uX)(),(0,o.Wv)(ie,{key:0,doc_id:e.docId,doc_type:e.docType,onSetInvoiceDuplicateStatus:e.setInvoiceDuplicateStatus},null,8,["doc_id","doc_type","onSetInvoiceDuplicateStatus"])):(0,o.Q3)("",!0),!e.isReadOnly||e.trigger_document_lock||e.isInvoiceDuplicate?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.Wv)(oe,{key:1,message:e.error_message,messageCategoryClass:"error-banner"},null,8,["message"])),(0,o.bF)(se,{name:"certificate_of_analysis",onSearch:!1,label:e.$t("pages.coa.certificate_of_analysis"),show_expiry_alert:!0},null,8,["label"]),(0,o.Lk)("div",l,[(0,o.Lk)("div",n,[(0,o.Lk)("div",{class:"secondary-c-text text-h6",style:(0,s.Tr)("width:"+e.imageFieldSplitter+"%")},[(0,o.Lk)("div",null,[(0,o.bF)(re,{appearance:"tertiary","data-cy":"dashboard",onClick:e.goRouteBack},{default:(0,o.k6)((()=>[(0,o.bF)(ae,{name:"fa-solid fa-circle-arrow-left",size:"sm"}),(0,o.Lk)("label",d,(0,s.v_)(e.$t("back")),1)])),_:1},8,["onClick"])])],4),(0,o.Lk)("div",{class:"q-pt-sm q-pl-md filename-container",style:(0,s.Tr)("width:"+(100-e.imageFieldSplitter)+"%")},[(0,o.bF)(le)],4)]),(0,o.Q3)("",!0)]),e.doc_fetch_error?((0,o.uX)(),(0,o.CE)("div",I,[(0,o.bF)(me)])):((0,o.uX)(),(0,o.CE)("div",c,[(0,o.Lk)("div",h,[(0,o.bF)(ue,{limits:[30,80],modelValue:e.imageFieldSplitter,"onUpdate:modelValue":[t[2]||(t[2]=t=>e.imageFieldSplitter=t),t[3]||(t[3]=t=>e.splitterChanged())],class:"medi-right-content-height"},{before:(0,o.k6)((()=>[(0,o.Lk)("div",u,[(0,o.Lk)("div",p,[e.hasApiData()?((0,o.uX)(),(0,o.Wv)(ne,{key:0,ref:"fieldsView",page:e.page,isPanelSection:!1,renderOpenWindoIcon:!0,onGetImageDetails:e.getImageDetails,onSetSplitterModel:e.setSplitterModel,onHandleScroll:e.removeOverlayandLines,onShowConnectionFromField:e.showConnectionFromField,onRefreshCanvasAfterSelection:e.refreshCanvasAfterSelection,onRemoveOldMapiingsAndDrawNew:e.removeOldMapiingsAndDrawNew,onEnableOrDisableExportButton:e.enableOrDisableExportButton,onCheckFieldInvalid:e.checkFieldInvalid},null,8,["page","onGetImageDetails","onSetSplitterModel","onHandleScroll","onShowConnectionFromField","onRefreshCanvasAfterSelection","onRemoveOldMapiingsAndDrawNew","onEnableOrDisableExportButton","onCheckFieldInvalid"])):(0,o.Q3)("",!0)])])])),separator:(0,o.k6)((()=>[(0,o.bF)(de,{round:"",unelevated:"",size:"xs",icon:"swap_horiz",class:"panel-expand-button highlighted-back z-index-1",onClick:t[0]||(t[0]=t=>e.toggleSplitter())})])),after:(0,o.k6)((()=>[(0,o.bF)(ce,{onResize:e.onResize,debounce:0},null,8,["onResize"]),(0,o.Lk)("div",_,[(0,o.Lk)("div",m,[(0,o.Lk)("div",f,[g,"annotate"==e.field_view_mode?((0,o.uX)(),(0,o.Wv)(he,{key:0,ref:"child_comp",enableEditing:e.enable_editing,cropUrl:e.image+"?"+e.tokenQueryParam,width:e.imageWidth,selectFont:e.selectFont,selectFontSize:e.selectFontSize,selectColor:e.selectColor,screenmode:"annotate"},null,8,["enableEditing","cropUrl","width","selectFont","selectFontSize","selectColor"])):(0,o.Q3)("",!0),(0,o.Lk)("div",v,[(0,o.Lk)("img",{class:"screenshot",src:e.image+"?"+e.tokenQueryParam,width:e.imageWidth,id:"screenshot",ref:"screenshot",draggable:"false",onLoad:t[1]||(t[1]=t=>{e.imageLoaded=!0,e.getImageDetails()})},null,40,b),((0,o.uX)(),(0,o.CE)("svg",{width:e.imageWidth,height:e.imageHeight,viewBox:e.viewBox,id:"draw",ref:"draw",xmlns:"http://www.w3.org/2000/svg",style:{height:"auto","border-bottom":"5px dotted"}},[(0,o.Lk)("rect",w,null,512),(0,o.Lk)("g",k,null,512)],8,y))])])])])])),_:1},8,["modelValue"])],512),(0,o.Lk)("div",C,["pages"==e.current_sidebar?((0,o.uX)(),(0,o.CE)("div",F,[(0,o.Lk)("div",E,[(0,o.Lk)("span",L,(0,s.v_)(e.$t("pages.screen2a.pages")),1)]),(0,o.Lk)("div",x,[(0,o.Lk)("div",M,(0,s.v_)(e.currentPage())+"/"+(0,s.v_)(e.images.length),1)]),(0,o.Lk)("div",S,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.images,((i,a)=>((0,o.uX)(),(0,o.CE)("img",{"data-id":a,key:a,src:e.baseUrl+"/"+i.path+"?"+e.tokenQueryParam,class:(0,s.C4)(["q-pa-xs shadow-5 max-width-120 q-ma-sm cursor-pointer",a===e.page-1?"active":""]),style:{height:"160px"},onClick:t[4]||(t[4]=(...t)=>e.imageclicked&&e.imageclicked(...t))},null,10,T)))),128))])])):(0,o.Q3)("",!0),"support"==e.current_sidebar?((0,o.uX)(),(0,o.CE)("div",A,[(0,o.bF)(pe)])):(0,o.Q3)("",!0),"tasks"==e.current_sidebar?((0,o.uX)(),(0,o.CE)("div",D,[(0,o.bF)(_e,{onBtnClicked:t[5]||(t[5]=t=>e.toggleSideBar("tasks"))})])):(0,o.Q3)("",!0)],512)])),(0,o.bF)(fe),(0,o.bF)(ye,{modelValue:e.showDialog,"onUpdate:modelValue":t[7]||(t[7]=t=>e.showDialog=t)},{default:(0,o.k6)((()=>[(0,o.bF)(be,null,{default:(0,o.k6)((()=>[(0,o.bF)(ve,{class:"row items-center q-pb-none"},{default:(0,o.k6)((()=>[O,(0,o.bF)(ge),(0,o.bo)((0,o.bF)(de,{icon:"close",flat:"",round:"",dense:""},null,512),[[Be]])])),_:1}),(0,o.bF)(ve,null,{default:(0,o.k6)((()=>[(0,o.eW)(" Don't think too much and just contact us to learn more about the application! ")])),_:1}),(0,o.Lk)("div",R,[(0,o.bF)(ge),(0,o.bF)(de,{flat:"",color:"primary",label:"Contact us",onClick:t[6]||(t[6]=t=>e.goFormular())})])])),_:1})])),_:1},8,["modelValue"]),(0,o.bF)(ye,{modelValue:e.split_document,"onUpdate:modelValue":t[8]||(t[8]=t=>e.split_document=t),persistent:""},{default:(0,o.k6)((()=>[(0,o.bF)(we)])),_:1},8,["modelValue"]),(0,o.bF)(ye,{modelValue:e.display_doc_script_logs,"onUpdate:modelValue":t[9]||(t[9]=t=>e.display_doc_script_logs=t)},{default:(0,o.k6)((()=>[(0,o.bF)(be,{style:{width:"900px","max-width":"50vw","min-height":"500px","max-height":"50vw"}},{default:(0,o.k6)((()=>[(0,o.bF)(Ce,{class:"text-white secondary-toolbar"},{default:(0,o.k6)((()=>[(0,o.bF)(ke,null,{default:(0,o.k6)((()=>[(0,o.Lk)("span",B,(0,s.v_)(e.$t("doc_script_logs")),1)])),_:1}),(0,o.bo)((0,o.bF)(de,{flat:"",round:"",dense:"",icon:"close"},null,512),[[Be]])])),_:1}),(0,o.bF)(ve,{class:""},{default:(0,o.k6)((()=>[(0,o.bF)(Fe)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Lk)("div",P,[(0,o.bF)(ye,{modelValue:e.textConfirmation,"onUpdate:modelValue":t[14]||(t[14]=t=>e.textConfirmation=t),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:(0,o.k6)((()=>[(0,o.bF)(be,{style:{width:"440px"}},{default:(0,o.k6)((()=>[(0,o.bF)(Ce,{class:"secondary-toolbar"},{default:(0,o.k6)((()=>[(0,o.bF)(ke,null,{default:(0,o.k6)((()=>[(0,o.Lk)("span",V,(0,s.v_)(e.$t("pages.screen2a.confirmation")),1)])),_:1}),(0,o.bo)((0,o.bF)(de,{flat:"",round:"",dense:"",icon:"close"},null,512),[[Be]])])),_:1}),(0,o.bF)(ve,{class:"q-pt-none"},{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.textConfirmationMsg),1)])),_:1}),(0,o.bF)(Ee,{align:"right",class:"text-teal"},{default:(0,o.k6)((()=>[(0,o.bo)((0,o.bF)(de,{color:"grey",label:e.$t("pages.screen2a.cancel"),"data-cy":"cancel",onClick:t[10]||(t[10]=t=>e.cancelOverlayDiv())},null,8,["label"]),[[Be]]),(0,o.bo)((0,o.bF)(de,{color:"grey","data-cy":"no",label:"Don't ask again",onClick:t[11]||(t[11]=t=>e.askLater())},null,512),[[Be]]),(0,o.bo)((0,o.bF)(de,{color:"grey","data-cy":"no",label:e.$t("re_select"),onClick:t[12]||(t[12]=t=>e.enableDrawing(!0))},null,8,["label"]),[[Be]]),(0,o.bo)((0,o.bF)(de,{color:"primary","data-cy":"yes",label:e.$t("pages.screen2a.yes"),onClick:t[13]||(t[13]=t=>e.updateFieldData())},null,8,["label"]),[[Be]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.bF)(ye,{modelValue:e.saveInstant,"onUpdate:modelValue":t[15]||(t[15]=t=>e.saveInstant=t)},{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.updateFieldData()),1)])),_:1},8,["modelValue"])]),(0,o.bF)(ye,{modelValue:e.selectMonitor,"onUpdate:modelValue":t[18]||(t[18]=t=>e.selectMonitor=t),position:"top"},{default:(0,o.k6)((()=>[(0,o.bF)(be,{style:{width:"600px"}},{default:(0,o.k6)((()=>[(0,o.Lk)("div",N,[(0,o.Lk)("div",{style:{padding:"10px","text-align":"center"},class:"col-sm-6 col-md-6 col-lg-6 cursor-pointer",onClick:t[16]||(t[16]=t=>e.openComponentInSeparateWindow(0))},[(0,o.bF)(ve,{class:"screenhover",style:{border:"1px solid #d8d8d8","border-radius":"5px"}},{default:(0,o.k6)((()=>[(0,o.Lk)("div",q,[(0,o.bF)(ae,{name:"desktop_windows",size:"xl",style:{"font-size":"150px"}})]),$])),_:1})]),(0,o.Lk)("div",{style:{padding:"10px","text-align":"center"},class:"col-sm-6 col-md-6 col-lg-6 cursor-pointer",onClick:t[17]||(t[17]=t=>e.openComponentInSeparateWindow(1))},[(0,o.bF)(ve,{class:"screenhover",style:{border:"1px solid #d8d8d8","border-radius":"5px"}},{default:(0,o.k6)((()=>[(0,o.Lk)("div",U,[(0,o.bF)(ae,{name:"desktop_windows",size:"xl",style:{"font-size":"150px"}})]),W])),_:1})])])])),_:1})])),_:1},8,["modelValue"]),(0,o.bF)(ye,{modelValue:e.display_barcode_assignment,"onUpdate:modelValue":t[19]||(t[19]=t=>e.display_barcode_assignment=t),onKeydown:t[20]||(t[20]=(0,a.jR)((t=>e.display_barcode_assignment=!1),["esc"]))},{default:(0,o.k6)((()=>[(0,o.bF)(be,{style:{"min-width":"320px","max-width":"1000px"}},{default:(0,o.k6)((()=>[(0,o.bF)(ve,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.$t("Barcode Mapping (currently reverse order)")),1)])),_:1}),e.barcode_amount>0?((0,o.uX)(),(0,o.Wv)(ve,{key:0},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.barcode_data,((t,i)=>((0,o.uX)(),(0,o.CE)("div",{style:{"margin-top":"15px"},key:t},[(0,o.eW)(" Barcode "+(0,s.v_)(i)+" : "+(0,s.v_)(t)+" ",1),(0,o.bF)(Le,{outlined:"",dense:"",clearable:"",modelValue:e.barcode_field_set[i],"onUpdate:modelValue":[t=>e.barcode_field_set[i]=t,o=>e.setFieldData(t,e.barcode_field_set[i],i)],options:e.doc_fields},null,8,["modelValue","onUpdate:modelValue","options"])])))),128))])),_:1})):((0,o.uX)(),(0,o.Wv)(ve,{key:1},{default:(0,o.k6)((()=>[(0,o.Lk)("div",null,(0,s.v_)(e.$t("No Barcodes extracted/found")),1)])),_:1}))])),_:1})])),_:1},8,["modelValue"]),(0,o.bF)(Re,{class:"validation-status-bar back-white"},{default:(0,o.k6)((()=>[(0,o.bF)(Ce,{class:(0,s.C4)(["row justify-start",""==e.current_sidebar?"":"opened-right-padding"])},{default:(0,o.k6)((()=>[(0,o.Lk)("span",K,(0,s.v_)(e.record.filename),1),(0,o.bF)(de,{size:"md",flat:"",dense:"",class:"q-ml-xs",onClick:t[21]||(t[21]=t=>e.downloadFile())},{default:(0,o.k6)((()=>[(0,o.bF)(ae,{name:"download",style:{color:"#8a8a8a"}})])),_:1}),(0,o.bF)(xe,{vertical:"",class:"q-mx-md"}),(0,o.Lk)("span",z,(0,s.v_)(e.currentDisplayedMessage),1),e.currentDisplayedMessage?((0,o.uX)(),(0,o.Wv)(xe,{key:0,vertical:"",class:"q-mx-md"})):(0,o.Q3)("",!0),e.script_error_count>0?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[e.DOC_SCRIPT_MODULE?((0,o.uX)(),(0,o.CE)("span",{key:0,class:"footer-status-message text-red cursor-pointer",onClick:t[22]||(t[22]=t=>e.display_doc_script_logs=!0)},[(0,o.eW)((0,s.v_)(e.$t("error_in_document_script"))+" ",1),(0,o.bF)(Me,{align:"top",rounded:"",color:"red"},{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.script_error_count),1)])),_:1})])):(0,o.Q3)("",!0),(0,o.bF)(xe,{vertical:"",class:"q-mx-md"})],64)):(0,o.Q3)("",!0),(0,o.Lk)("div",Q,[(0,o.bF)(re,{appearance:"tertiary","data-cy":"previous",onClick:t[23]||(t[23]=t=>e.routeToNextDoc("previous"))},{default:(0,o.k6)((()=>[(0,o.bF)(ae,{class:"text-red-13",size:"sm"},{default:(0,o.k6)((()=>[X])),_:1}),(0,o.bF)(Se,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.$t("Previous_Document")),1)])),_:1})])),_:1}),(0,o.bF)(re,{appearance:"tertiary","data-cy":"next",onClick:t[24]||(t[24]=t=>e.routeToNextDoc("next"))},{default:(0,o.k6)((()=>[(0,o.bF)(Se,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.$t("Next_Document")),1)])),_:1}),(0,o.bF)(ae,{class:"text-red-13",size:"sm",style:{"margin-left":"7px"}},{default:(0,o.k6)((()=>[j])),_:1})])),_:1})]),(0,o.bF)(ge),e.record.table_blocked?((0,o.uX)(),(0,o.CE)(o.FK,{key:2},[(0,o.bF)(xe,{vertical:"",class:"q-mx-md"}),(0,o.bF)(ae,{class:"text-blue",style:{"font-size":"22px"},name:"info"}),(0,o.Lk)("span",H,(0,s.v_)(e.$t("block_supplier_warning")),1)],64)):(0,o.Q3)("",!0),(0,o.bF)(xe,{vertical:"",class:"q-mx-xs"}),e.record.table_blocked?((0,o.uX)(),(0,o.CE)("div",J,[(0,o.bF)(Ie,{isReadOnly:e.isReadOnly},null,8,["isReadOnly"])])):((0,o.uX)(),(0,o.CE)("div",G,[(0,o.bF)(de,{flat:"",dense:"",icon:"img:images/table_extraction.svg",class:"icon-grey validation-footer-table-button",onClick:e.goToTableExtraction},{default:(0,o.k6)((()=>[(0,o.bF)(Se,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.$t("go_to_table_extraction_view")),1)])),_:1})])),_:1},8,["onClick"]),e.has_ai_table?((0,o.uX)(),(0,o.Wv)(de,{key:0,flat:"",dense:"",icon:"img:images/Add_column.svg",class:"icon-grey-svg validation-footer-table-button",onClick:t[25]||(t[25]=t=>e.showNonMappedColumnsDialog())},{default:(0,o.k6)((()=>[(0,o.bF)(Se,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.$t("add_empty_mapped_columns")),1)])),_:1})])),_:1})):(0,o.Q3)("",!0),(0,o.bF)(Te),(0,o.bF)(Ae),e.has_ai_table?((0,o.uX)(),(0,o.Wv)(de,{key:1,flat:"",dense:"",icon:"img:images/table_delete.svg",class:"icon-grey validation-footer-table-button",onClick:e.deleteTable},{default:(0,o.k6)((()=>[(0,o.bF)(Se,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.$t("delete_table")),1)])),_:1})])),_:1},8,["onClick"])):(0,o.Q3)("",!0),e.has_ai_table?((0,o.uX)(),(0,o.Wv)(de,{key:2,flat:"",dense:"",icon:"img:images/column.svg",class:"icon-grey validation-footer-table-button",onClick:t[26]||(t[26]=t=>e.addColumnInLineItems())},{default:(0,o.k6)((()=>[(0,o.bF)(Se,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.$t("add_new_table_column")),1)])),_:1})])),_:1})):(0,o.Q3)("",!0),(0,o.bF)(De,{class:"q-mx-xs"}),e.has_ai_table?((0,o.uX)(),(0,o.Wv)(de,{key:3,flat:"",dense:"",icon:"repartition",class:"icon-grey validation-footer-table-button",onClick:t[27]||(t[27]=t=>e.restoreDeleteColumn())},{default:(0,o.k6)((()=>[(0,o.bF)(Se,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.$t("restore_table_column")),1)])),_:1})])),_:1})):(0,o.Q3)("",!0)])),e.images.length?((0,o.uX)(),(0,o.Wv)(xe,{key:5,vertical:"",class:"q-mx-xs"})):(0,o.Q3)("",!0),e.images.length?((0,o.uX)(),(0,o.CE)("span",Y,(0,s.v_)(e.currentPage())+" / "+(0,s.v_)(e.images.length),1)):(0,o.Q3)("",!0),"annotate"!==e.field_view_mode?((0,o.uX)(),(0,o.CE)(o.FK,{key:7},[(0,o.bF)(xe,{vertical:"",class:"q-mx-xs"}),(0,o.bF)(de,{flat:"",dense:"",icon:"remove",class:"icon-grey validation-footer-button",onClick:e.ZoomOut},null,8,["onClick"]),(0,o.bF)(Oe,{class:"zoom-slider",dense:"",modelValue:e.zoom_value,"onUpdate:modelValue":[t[28]||(t[28]=t=>e.zoom_value=t),t[29]||(t[29]=t=>{e.zoom(t)})],min:.3,max:.8,step:.005},null,8,["modelValue"]),(0,o.bF)(de,{flat:"",dense:"",icon:"add",class:"icon-grey validation-footer-plus-button",onClick:e.ZoomIn},null,8,["onClick"])],64)):(0,o.Q3)("",!0)])),_:1},8,["class"])])),_:1})],64)}var ee=i(1659),te=i(6044),ie=i(24622),oe=i(45938),se=i(38734),ae=i(46162),re=i(11470),le=i(96056),ne=i(8420),de=i(64233),ce=i(18505),he=i(57366),ue=i(28684),pe=i(42300),_e=i(31018),me=i(21984),fe=i(14907),ge=i(41903),ve=i(54885),be=i(25891),ye=i(84857),we=i(7080);const ke=e=>((0,o.Qi)("data-v-4ef0ceb6"),e=e(),(0,o.jt)(),e),Ce={class:"mb-4 image_control_panel"},Fe={class:"row panel-right justify-start"},Ee={class:"medi-classification col-9 q-mr-auto"},Le=ke((()=>(0,o.Lk)("img",{width:"24",height:"24",src:"images/save.svg"},null,-1))),xe={class:"col-auto"},Me=ke((()=>(0,o.Lk)("img",{width:"24",height:"24",class:"invert-100 icon-dark-grey-svg",src:"images/refresh.svg"},null,-1))),Se={key:0,class:"col-auto"},Te={class:"scrolle-y white-inputs row","data-section":"fields",id:"field_scrolle"},Ae={key:0,class:"col-6"},De={class:"secondary-c-text text-weight-bold ellipsify",style:{"font-size":"22px"}},Ie={class:"full-width q-mb-lg"},Oe={class:"col-12 secondary-c-text text-h6 text-weight-bold ellipsify"},Re={class:"q-ml-sm q-pt-sm"},Be={class:"display-block field-padding full-width"},Pe={key:1,class:"col-6"},Ve={class:"secondary-c-text text-weight-bold ellipsify",style:{"font-size":"22px"}},Ne={class:"full-width q-mb-lg"},qe={class:"col-12 secondary-c-text text-h6 text-weight-bold"},$e={class:"q-ml-sm q-pt-sm"},Ue={class:"display-block field-padding full-width"},We={key:2,class:"q-mb-md full-width row"},Ke={class:"q-ml-auto float-right"},ze={class:""},Qe={class:"text-weight-bold"},Xe={class:"q-ml-sm"};function je(e,t,i,r,l,n){const d=(0,o.g2)("DocumentClassification"),c=(0,o.g2)("q-tooltip"),h=(0,o.g2)("q-btn"),u=(0,o.g2)("scriptBtn"),p=(0,o.g2)("q-separator"),_=(0,o.g2)("q-icon"),m=(0,o.g2)("q-input"),f=(0,o.g2)("draggable"),g=(0,o.g2)("f-btn"),v=(0,o.g2)("masterDataLookup"),b=(0,o.g2)("dialog-draggable"),y=(0,o.g2)("q-toolbar-title"),w=(0,o.g2)("q-toolbar"),k=(0,o.g2)("q-card-section"),C=(0,o.g2)("q-card"),F=(0,o.g2)("q-dialog"),E=(0,o.g2)("export-dialog"),L=(0,o.g2)("selection-popup"),x=(0,o.g2)("q-avatar"),M=(0,o.g2)("q-card-actions"),S=(0,o.g2)("Loader"),T=(0,o.g2)("q-spinner-hourglass"),A=(0,o.g2)("q-inner-loading"),D=(0,o.gN)("close-popup");return(0,o.uX)(),(0,o.CE)(o.FK,null,[e.isModelReady()?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("div",Ce,[(0,o.Lk)("div",Fe,[(0,o.Lk)("div",Ee,[(0,o.bF)(d,{isReadOnly:e.isReadOnly,hide_reclassify_btn:!0},null,8,["isReadOnly"])]),(0,o.bF)(h,{flat:"",class:"pr-6 pl-6 float-right q-ml-auto",onClick:e.saveData},{default:(0,o.k6)((()=>[Le,(0,o.bF)(c,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.$t("save")),1)])),_:1})])),_:1},8,["onClick"]),(0,o.Lk)("div",xe,[(0,o.bF)(h,{flat:"",class:"pr-6 pl-6 float-right q-ml-auto",onClick:e.getCoaFields},{default:(0,o.k6)((()=>[Me,(0,o.bF)(c,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.$t("pages.coa.refresh_api_data")),1)])),_:1})])),_:1},8,["onClick"])]),!0===e.is_admin&&!e.isReadOnly&&e.DOC_SCRIPT_MODULE?((0,o.uX)(),(0,o.CE)("div",Se,[(0,o.bF)(u)])):(0,o.Q3)("",!0)])]),(0,o.bF)(p),(0,o.Lk)("div",Te,[e.renderComponent?((0,o.uX)(),(0,o.CE)("div",Ae,[(0,o.Lk)("span",De,(0,s.v_)(e.$t("pages.coa.table_fields")),1),(0,o.bF)(p,{class:"q-mb-md"}),(0,o.Lk)("div",Ie,[(0,o.bF)(f,{onChange:e.dragEnd,list:e.tableFields,animation:200,"ghost-class":"ghost-card",class:"row q-pr-sm cursor-move"},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.tableFields,((t,i)=>((0,o.uX)(),(0,o.CE)("div",{key:`div-${i}`,class:"full-width col-12"},[(0,o.Lk)("div",Oe,[t["CHARACTERISTIC"]?((0,o.uX)(),(0,o.Wv)(_,{key:0,name:"drag_indicator",class:"cursor-move",size:"sm"})):(0,o.Q3)("",!0),(0,o.Lk)("span",Re,(0,s.v_)(t["CHARACTERISTIC"].value),1)]),(0,o.Lk)("div",Be,[(0,o.Lk)("div",null,[(0,o.eW)((0,s.v_)(e.$t("pages.coa.minimum"))+" ",1),(0,o.bF)(m,{class:"input-field",outlined:"",dense:"",modelValue:t["MIN"].value,"onUpdate:modelValue":e=>t["MIN"].value=e,readonly:"",disable:""},null,8,["modelValue","onUpdate:modelValue"]),(0,o.eW)(" "+(0,s.v_)(e.$t("pages.coa.maximum"))+" ",1),(0,o.bF)(m,{class:"input-field",outlined:"",dense:"",modelValue:t["MAX"].value,"onUpdate:modelValue":e=>t["MAX"].value=e,readonly:"",disable:""},null,8,["modelValue","onUpdate:modelValue"]),(0,o.eW)(" "+(0,s.v_)(e.$t("pages.coa.target"))+" ",1),(0,o.bF)(m,{class:(0,s.C4)(["input-field",t["RESULT"]["error"]?"error-border-left invalid-input":"success-border-left valid-input"]),outlined:"",dense:"",modelValue:t["RESULT"].value,"onUpdate:modelValue":e=>t["RESULT"].value=e,readonly:"",disable:""},null,8,["modelValue","onUpdate:modelValue","class"])])]),(0,o.bF)(p,{size:"2px",class:"q-my-lg q-ma-sm full-width"})])))),128))])),_:1},8,["onChange","list"])])])):(0,o.Q3)("",!0),e.renderComponent?((0,o.uX)(),(0,o.CE)("div",Pe,[(0,o.Lk)("span",Ve,(0,s.v_)(e.$t("pages.coa.api_data_fields")),1),(0,o.bF)(p,{class:"q-mb-md"}),(0,o.Lk)("div",Ne,[(0,o.bF)(f,{onChange:e.dragEnd,list:e.coaFields,animation:200,"ghost-class":"ghost-card",class:"row q-pr-sm"},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.coaFields,((t,i)=>((0,o.uX)(),(0,o.CE)("div",{key:`div-${i}`,class:"full-width col-12"},[(0,o.Lk)("div",qe,[t["CHARACTERISTIC"]?((0,o.uX)(),(0,o.Wv)(_,{key:0,name:"drag_indicator",class:"cursor-pointer",size:"sm"})):(0,o.Q3)("",!0),(0,o.Lk)("span",$e,(0,s.v_)(t["CHARACTERISTIC"].value),1)]),(0,o.Lk)("div",Ue,[(0,o.Lk)("div",null,[(0,o.eW)((0,s.v_)(e.$t("pages.coa.minimum"))+" ",1),(0,o.bF)(m,{class:"input-field",outlined:"",dense:"",modelValue:t["MIN"].value,"onUpdate:modelValue":e=>t["MIN"].value=e,readonly:"",disable:""},null,8,["modelValue","onUpdate:modelValue"]),(0,o.eW)(" "+(0,s.v_)(e.$t("pages.coa.maximum"))+" ",1),(0,o.bF)(m,{class:"input-field",outlined:"",dense:"",modelValue:t["MAX"].value,"onUpdate:modelValue":e=>t["MAX"].value=e,readonly:"",disable:""},null,8,["modelValue","onUpdate:modelValue"]),(0,o.eW)(" "+(0,s.v_)(e.$t("pages.coa.target"))+" ",1),(0,o.bF)(m,{class:"input-field",outlined:"",dense:"",modelValue:t["RESULT"].value,"onUpdate:modelValue":e=>t["RESULT"].value=e,readonly:"",disable:""},null,8,["modelValue","onUpdate:modelValue"])])]),(0,o.bF)(p,{size:"2px",class:"q-my-lg q-ma-sm full-width"})])))),128))])),_:1},8,["onChange","list"])])])):(0,o.Q3)("",!0),0!=e.coaFields.length?((0,o.uX)(),(0,o.CE)("div",We,[(0,o.Lk)("div",Ke,[(0,o.bF)(g,{appearance:"negative",class:"on-left",label:e.$t("reject"),onClick:e.openMailPopUp},null,8,["label","onClick"]),(0,o.bF)(g,{appearance:"primary",label:e.$t("approve"),onClick:e.onAccept},null,8,["label","onClick"])])])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",ze,[(0,o.bF)(b,{modelValue:e.fuzzyDialog,"onUpdate:modelValue":t[0]||(t[0]=t=>e.fuzzyDialog=t),seamless:"","full-width":"",position:"left",persistent:"",onKeydown:(0,a.jR)(e.closeMsDialog,["esc"]),title:e.$t("pages.screen2a.validation"),onOnHide:e.closeMsDialog,isResizeAble:!0,draggable:e.isDraggle},{default:(0,o.k6)((()=>[(0,o.Lk)("div",null,[(0,o.bF)(v)])])),_:1},8,["modelValue","onKeydown","title","onOnHide","draggable"])])],64)):(0,o.Q3)("",!0),(0,o.bF)(F,{modelValue:e.showEmailPopUp,"onUpdate:modelValue":t[3]||(t[3]=t=>e.showEmailPopUp=t)},{default:(0,o.k6)((()=>[(0,o.bF)(C,{style:{width:"25%"}},{default:(0,o.k6)((()=>[(0,o.bF)(w,{class:"text-white secondary-toolbar"},{default:(0,o.k6)((()=>[(0,o.bF)(y,null,{default:(0,o.k6)((()=>[(0,o.Lk)("span",Qe,(0,s.v_)(e.$t("pages.coa.reject_document")),1)])),_:1}),(0,o.bo)((0,o.bF)(h,{flat:"",round:"",dense:"",icon:"close"},null,512),[[D]])])),_:1}),(0,o.bF)(k,null,{default:(0,o.k6)((()=>[(0,o.bF)(m,{dense:"",outlined:"",modelValue:e.rejectData["email"],"onUpdate:modelValue":t[1]||(t[1]=t=>e.rejectData["email"]=t),label:e.$t("email"),type:"email"},{prepend:(0,o.k6)((()=>[(0,o.bF)(_,{name:"email"})])),_:1},8,["modelValue","label"]),(0,o.bF)(m,{dense:"",outlined:"",modelValue:e.rejectData["reason"],"onUpdate:modelValue":t[2]||(t[2]=t=>e.rejectData["reason"]=t),label:e.$t("pages.coa.reason"),class:"q-mt-md",type:"textarea"},null,8,["modelValue","label"])])),_:1}),(0,o.bF)(k,{class:"float-right"},{default:(0,o.k6)((()=>[(0,o.bo)((0,o.bF)(g,{label:e.$t("cancel"),appearance:"cancel",class:"on-left"},null,8,["label"]),[[D]]),(0,o.bF)(g,{label:e.$t("confirm"),appearance:"primary",onClick:e.sendRejectEmail},null,8,["label","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.bF)(F,{modelValue:e.display_config_dialog,"onUpdate:modelValue":t[4]||(t[4]=t=>e.display_config_dialog=t),position:"top",class:"export-dialog",persistent:""},{default:(0,o.k6)((()=>[(0,o.bF)(E)])),_:1},8,["modelValue"]),(0,o.bF)(F,{modelValue:e.showSelectionPopupDialog,"onUpdate:modelValue":t[5]||(t[5]=t=>e.showSelectionPopupDialog=t),position:"top",persistent:""},{default:(0,o.k6)((()=>[(0,o.bF)(L,{data:e.selection_popup_data},null,8,["data"])])),_:1},8,["modelValue"]),(0,o.bF)(F,{modelValue:e.showPoMatchWarning,"onUpdate:modelValue":t[7]||(t[7]=t=>e.showPoMatchWarning=t),persistent:""},{default:(0,o.k6)((()=>[(0,o.bF)(C,null,{default:(0,o.k6)((()=>[(0,o.bF)(k,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,o.k6)((()=>[(0,o.bF)(x,{icon:"warning",color:"primary"})])),_:1}),(0,o.bF)(k,{class:"row items-center"},{default:(0,o.k6)((()=>[(0,o.Lk)("span",Xe,(0,s.v_)(e.$t("pages.messages.WARNING_EXPORT_FROM_PO_MATCH")),1)])),_:1}),(0,o.bF)(M,{align:"right"},{default:(0,o.k6)((()=>[(0,o.bo)((0,o.bF)(h,{flat:"",label:e.$t("cancel"),color:"primary"},null,8,["label"]),[[D]]),(0,o.bo)((0,o.bF)(h,{flat:"",label:e.$t("po_matching"),color:"primary",onClick:t[6]||(t[6]=t=>e.navigateToPOMatch())},null,8,["label"]),[[D]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),e.is_sep_view?((0,o.uX)(),(0,o.Wv)(S,{key:1})):(0,o.Q3)("",!0),(0,o.bF)(A,{showing:e.script_loading},{default:(0,o.k6)((()=>[(0,o.bF)(T,{color:"primary",size:"6em"})])),_:1},8,["showing"])],64)}var He=i(82303),Ge=i(68450),Je=i(39231),Ye=i(53500),Ze=i(85192),et=i(36801),tt=i(153),it=i(39281),ot=i(82080),st=i(62107),at=i(9342),rt=i(76956),lt=i(94124),nt=i(1435),dt=i(4225),ct=i(66916),ht=i(74368),ut=i(86224),pt=i(10145),_t=i(64775),mt=i(73937),ft=i(40057),gt=i(85487),vt=function(e,t,i,o){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function r(e){try{n(o.next(e))}catch(t){a(t)}}function l(e){try{n(o["throw"](e))}catch(t){a(t)}}function n(e){e.done?i(e.value):s(e.value).then(r,l)}n((o=o.apply(e,t||[])).next())}))};const bt=document.querySelector.bind(document);new Map;const yt=(0,o.pM)({el:"#app",mixins:[ce.A,le.A,he.A,ut.A,ie.A,tt.A,ot.A,be.A,_e.A,ct.A],props:{renderOpenWindoIcon:{type:Boolean,default:!1},isPanelSection:{type:Boolean,default:!1},page:{type:Number,default:1}},emits:["removeOldMapiingsAndDrawNew","showConnectionFromField","refreshCanvasAfterSelection","setSplitterModel","handleScroll","setApiData","setDocVersion","getImageDetails","enableOrDisableExportButton","checkFieldInvalid"],components:{ExportDialog:st.A,scriptBtn:nt.A,Loader:ne.A,draggable:Je.H,DocumentClassification:ht.A,masterDataLookup:at.A,dialogDraggable:pt.A,SelectionPopup:it.A},watch:{config_saved:{handler:function(e,t){!0===t&&!1===e||(this.display_config_dialog=!1)}},populate_row_to_view:{handler:function(e,t){0!=e&&this.populateMSDataFromPopup()}}},data(){return{docId:"",imageWidth:0,imageHeight:0,connectionId:"",charges:rt.P.charges,itemsData:{},conversionFields:[],showPoMatchWarning:(0,se.KR)(!1),highlightFieldsMode:(0,se.KR)(!1),origin_warning_alert:{},showAllChargesFields:(0,se.KR)(!1),showSelectionPopupDialog:!1,selection_popup_data:{},format_warning_dismiss:{},classification_method_icons:{EDI:"images/EDI.svg",FACTURX:"images/FACTURX.svg",XRECHNUNG:"images/XRECHNUNG.svg",PEPPOL:"images/PEPPOL.svg"},amount_fields_confidence_count:0,debounceScriptCalculateFunc:{},doc_script_module_setting:rt.$B,excluded_field_types:["Label","ExportButton","HorizontalSeparator"]}},mounted:function(){this.initDefaultValues(),this.docId=this.$route.params.id,this.is_admin=(0,mt.N6)(),this.isViewSeparateComponent(),this.init(),window.CoaFields=this;const e=bt("#validation_view");e&&e.addEventListener("keydown",this.keydownEventWrapper),document.addEventListener("script_calculate_func",this.scriptCalculateFuncWrapper),document.addEventListener("model_updated",this.updateModelAttribute),document.addEventListener("reload_tables",this.reloadTable),window.addEventListener("resize",this.windowResize),document.body.addEventListener("click",this.mouseClicked,!0),document.addEventListener("selection_popup_closed",this.selectionPopupClosed),document.addEventListener("selection_popup_selected",this.selectionPopupSelected),document.addEventListener("display_fields_errors",this.displayFieldErrors),document.addEventListener("element_click",this.elementClick),document.addEventListener("splitter_changed",this.windowResize)},unmounted:function(){const e=bt("#validation_view");e&&e.removeEventListener("keydown",this.keydownEventWrapper),document.removeEventListener("script_calculate_func",this.scriptCalculateFuncWrapper),document.removeEventListener("selection_popup_selected",this.selectionPopupSelected),document.removeEventListener("selection_popup_closed",this.selectionPopupClosed),document.removeEventListener("model_updated",this.updateModelAttribute),document.removeEventListener("reload_tables",this.reloadTable),document.body.removeEventListener("click",this.mouseClicked,!0),document.removeEventListener("display_fields_errors",this.displayFieldErrors),document.removeEventListener("element_click",this.elementClick),document.removeEventListener("splitter_changed",this.windowResize)},methods:{onAccept(e){e.stopPropagation(),this.record["export_parameters"]={doc_export_status:"export",validate:!1},this.exportData()},resetValidatedFields(){this.tableFields.forEach((e=>{e["RESULT"].error=!1}))},dragEnd(e){this.resetValidatedFields(),this.compareAndMatchFields()},validateEmailFields(){if(!this.rejectData["email"])throw{message:"email_required"};if(!this.rejectData["reason"])throw{message:"pages.coa.reason_required"}},sendRejectEmail(){return vt(this,void 0,void 0,(function*(){this.showLoading();try{if(this.validateEmailFields(),this.record.fields.forEach((e=>{"supplier_name"==e.name&&""!=e.content&&(this.rejectData["supplier_name"]=e.content)})),!this.rejectData["supplier_name"])throw{message:"pages.messages.SUPPLIER_NAME_MISSING"};const e=yield this.rejectCoa(this.rejectData);if(!e.success)throw{message:e.message};if(this.isReadOnly)return;this.rejectDocument(this.record.doc_id),this.showSuccessToast(this.$t("rejected_successfully")),this.routeToDashboard()}catch(e){const t=_t.t.getErrorMessage(e);this.showErrorToast(this.$t(t))}finally{this.hideLoading()}}))},openMailPopUp(){this.showEmailPopUp=!0},formatCoaFields(){this.coaFields.forEach((e=>{e["MIN"].value=parseFloat(e["MIN"].value),e["MAX"].value=parseFloat(e["MAX"].value),e["RESULT"].value=parseFloat(e["RESULT"].value)})),this.tableFields.forEach(((e,t)=>{const i=parseFloat(e["MIN"].value),o=parseFloat(e["MAX"].value),s=parseFloat(e["RESULT"].value);e["MIN"].value=isNaN(i)?e["MIN"].value:i,e["MAX"].value=isNaN(o)?e["MAX"].value:o,e["RESULT"].value=isNaN(s)?e["RESULT"].value:s}))},compareAndMatchFields(){this.tableFields.forEach(((e,t)=>{if(this.coaFields.length<t+1)return;if(this.tableFields.length<t+1)return;const i=this.coaFields[t];let o=i["MIN"].value,s=i["MAX"].value;""!=e["RESULT"].value&&(e["RESULT"].value>s&&(e["RESULT"].error=!0),e["RESULT"].value<o&&(e["RESULT"].error=!0))}))},loadCoaFields(){return vt(this,void 0,void 0,(function*(){if(this.record.coa_item&&this.record.coa_item.length>0)return this.coaFields=this.record.coa_item,void this.hideLoading();yield this.getCoaFields()}))},getCoaFields(){return vt(this,void 0,void 0,(function*(){this.showLoading();try{this.coaFields=[];let e="";if(this.record.fields.forEach((t=>{"ITNO"!=t.name&&"customer_product_code"!=t.name||""!=t.content&&(e=t.content)})),!e)throw{message:"invalid_item_number"};const t=yield this.getResponseCoa(e);if(!t.success)throw{message:t.message};t.data[0].records.forEach((e=>{const t={CHARACTERISTIC:{value:e["TX40"],error:!1},MIN:{value:e["EVMN"],error:!1},MAX:{value:e["EVMX"],error:!1},RESULT:{value:e["EVTG"],error:!1}};this.coaFields.push(t)}))}catch(e){const t=_t.t.getErrorMessage(e);this.showErrorToast(this.$t(t))}finally{this.compareAndMatchFields(),this.formatCoaFields(),this.hideLoading()}}))},downloadFile(){try{let e=ae.VA+"/"+this.record["doc_path"]+"?"+this.tokenQueryParam;if(!e)return;fetch(e).then((e=>e.blob())).then((e=>{const t=URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download=this.record["filename"],document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)})).catch((e=>{}))}catch(e){}},initDefaultValues(){this.isFormBuilderMode=!1,this.formBuilderModel={},this.formBuilderConfigModel={},this.lookup_loading_fields={},this.freeze_fields_change_event=!1},reloadTable(){this.renderKey++},init(){return vt(this,void 0,void 0,(function*(){if(this.is_sep_view&&this.get_cached_data_id===this.docId&&(yield this.setRecordFromCache()),rt.B2.includes(this.record.status)&&(this.isReadOnly=!0),yield this.getLayoutTemplateID(),yield this.getFormBuilderLayout(),yield this.populateListsAndValues(),!this.isModelReady())return this.showErrorToast("Document does not have layout. Please contact administrator"),void this.hideLoading();"INVOICE"==this.record.doc_type&&(this.setConversionFields(),this.fieldCaluclations()),this.initTableFields(),yield this.loadCoaFields(),this.createAutoTriggerDebounceFunc(),this.renderComponent=!0,this.$emit("getImageDetails"),this.setLineItemDetails(),this.createScriptCalculateDebounceFunc(),this.$nextTick((function(){this.viewLoadCompleted()})),this.DOC_SCRIPT_MODULE=(0,et.PL)(this.doc_script_module_setting)}))},initTableFields(){this.tableFields=[],this.record.tables.forEach((e=>{e.rows.forEach((e=>{let t={};e.columns.forEach((e=>{if("CHARACTERISTIC"!=e.name)if("RESULT"!=e.name)if("MIN"!=e.name)if("MAX"!=e.name);else{if(t["MAX"]===e.value)return;t["MAX"]={value:e.value,error:!1}}else{if(t["MIN"]===e.value)return;t["MIN"]={value:e.value,error:!1}}else{if(t["RESULT"]===e.value)return;t["RESULT"]={value:e.value,error:!1}}else{if(t["CHARACTERISTIC"]===e.value)return;t["CHARACTERISTIC"]={value:e.value,error:!1}}})),this.tableFields.push(t)}))}))},createScriptCalculateDebounceFunc(){this.debounceScriptCalculateFunc=(0,Ye.A)((()=>{this.applyScript()}),3e3)},updateScriptRequest(){this.updateRequestId(),this.debounceScriptCalculateFunc.cancel()},createNewScriptRequest(){this.createScriptCalculateDebounceFunc(),this.debounceScriptCalculateFunc()},viewLoadCompleted(){const e=bt(".validation-sticky-area"),t=bt(".not-sticky-area");e&&t&&(t.style.paddingTop=e.clientHeight+20+"px");const i=bt("#field_scrolle");i&&i.addEventListener("scroll",this.handleScroll)},prepareMediTable(e){if(this.formBuilderConfigModel[e.name]=Object.assign({},e),!this.record.tables||!this.record.tables[0]){this.record.tables=[];let t={name:e.name,rows:[]};return void(this.formBuilderModel[e.name]=Object.assign({},t))}let t={};this.record.tables.forEach((i=>{(i.name=e.name)&&(t=Object.assign({},i))})),this.formBuilderModel[e.name]=Object.assign({},t)},prepareMultiCheckBox(e,t,i){if(this.formBuilderConfigModel[e.name]=Object.assign({},e),!t)return this.formBuilderModel[i]=[],this.formBuilderModel[i].page="",this.formBuilderModel[i].color="",this.formBuilderModel[i].score="",this.formBuilderModel[i].value="",this.formBuilderModel[i].coords=[],this.formBuilderModel[i].groupList=[],this.formBuilderModel[i].confidence="",void(this.formBuilderModel[i].formatted_value="");t.highlight_field&&(t.highlight_field=!1,this.addFieldToHighlight(i)),this.formBuilderModel[i]=Object.assign({},t)},prepareCheckboxesTable(e,t,i){e.tableBodyRows.forEach(((e,o)=>{e.forEach(((e,o)=>{let s=e.name;i.hasOwnProperty(s)&&Object.assign(e,this.cleanLayoutSettings(i[s])),this.prepareModel(e,t[s],s)}))}))},makeModel(){return this.fieldListToHighlight=[],new Promise(((e,t)=>{let i={};if(void 0!==this.record){this.record.fields.forEach(((e,t)=>{i[e.name]=e,this.fieldsNotDisplayed[e.name]=e}));let e=this.getUpdatedFieldSettings(),t="";for(const[o,s]of this.formLayout.entries()){s.short_cut_key_2&&(t=s.short_cut_key_1+s.short_cut_key_2,this.groupShortCutMap.set(t,o));for(let t of s.rows){let o=t.name?t.name:t.field_name;t.fieldType!==dt.VV.TABLE_OF_CHECKBOXES?t.fieldType!==dt.VV.EXTRACTED_TABLE?t.fieldType!==dt.VV.MULTI_CHECK_BOX?(e.hasOwnProperty(o)&&(t=Object.assign(t,this.cleanLayoutSettings(e[o]))),this.prepareModel(t,i[o],o)):this.prepareMultiCheckBox(t,i[o],o):this.prepareMediTable(t):this.prepareCheckboxesTable(t,i,e)}s.name===rt.P.charges&&this.handleChargesFieldsVisibility(s)}Object.keys(this.fieldsNotDisplayed).length>=0&&this.record.fields.forEach(((e,t)=>{this.fieldsNotDisplayed.hasOwnProperty(e.name)&&(this.record.fields[t].is_valid=!0,delete this.fieldsNotDisplayed[e.name])})),this.prepareLayoutForTemplate(),this.handleConfidenceAlert(),this.setupLookup(),this.$forceUpdate()}this.prepareLayoutData(),e("done"),this.highlightFieldsMode&&setTimeout((()=>{this.highlightFields()}),500)}))},prepareModel(e,t,i){t?this.setColor(t,e):t=this.createEmptyField(i,e.input_type);let o=e.input_type?e.input_type:e.fieldType;o&&("INVOICE"==this.record.doc_type&&this.countAmountFieldsConfidence(t),this.cleanCheckboxValue(t,o.toLowerCase()),e.hasOwnProperty("tabIndex")&&!(0,Ge.z)(e.tabIndex)||(e.tabIndex=0),t.highlight_field&&(t.highlight_field=!1,this.addFieldToHighlight(i)),this.formBuilderModel[i]=[],this.formBuilderConfigModel[i]=[],this.formBuilderModel[i]=Object.assign({},t),this.formBuilderConfigModel[i]=Object.assign({},e),t.hasOwnProperty("is_required")&&(this.formBuilderConfigModel[i].is_required=t.is_required),t.hasOwnProperty("force_validation")&&(this.formBuilderConfigModel[i].force_validation=t.force_validation,1==t.force_validation&&(this.formBuilderModel[i].validation_code="FORCED_VALIDATION",this.formBuilderModel[i].validation_message="Validation required")),this.setTabIndexInList(e),this.handleListofValues(i),this.broadcastFieldChange(i),this.setFieldError(i),!1===e.is_hidden&&this.fieldsNotDisplayed.hasOwnProperty(i)&&delete this.fieldsNotDisplayed[i])},setupLookup(){try{if(this.lookup_configurations=new Map,!this.record.hasOwnProperty("layout")||!this.record.layout.hasOwnProperty("lookup_configurations"))return;if(!this.record.layout.lookup_configurations)return;for(const[e,t]of this.record.layout.lookup_configurations.entries())if(t.hasOwnProperty("fields")&&Array.isArray(t.fields))for(const[i,o]of t.fields.entries())o.is_searchable&&this.lookup_configurations.set(o.field_name,Object.assign(JSON.parse(JSON.stringify(o)),{lookup_dataset_name:t.lookup_dataset_name,fields:JSON.parse(JSON.stringify(t.fields))}));this.check_for_auto_trigger()}catch(e){}},handleListofValues(e){this.formBuilderConfigModel[e].hasOwnProperty("list_of_values")&&this.addNameToLovList(this.formBuilderConfigModel[e].list_of_values)},addFieldToHighlight(e){this.fieldListToHighlight.push(e)},highlightFields(){var e;this.highlightFieldsMode=!1;for(const t of this.fieldListToHighlight){let i=bt("#"+t);(null===(e=i.parentElement)||void 0===e?void 0:e.classList.contains("q-td"))&&(i=i.parentElement),i&&(i.classList.add("light-yellow-with-effect"),setTimeout((()=>{i.classList.remove("light-yellow-with-effect")}),4e3))}},getUpdatedFieldSettings(){let e={},t=JSON.parse(JSON.stringify(this.record.layout.groups));return t.forEach(((t,i)=>{t.rows.forEach(((t,i)=>{t.forEach(((t,i)=>{let o=t.field_name;e[o]=t}))}))})),e},cleanLayoutSettings(e){return delete e.name,delete e.field,delete e.field_name,delete e.field_type,delete e.title,delete e.translation_key,e},setTabIndexInList(e){if(this.excluded_field_types.includes(e.fieldType)||1==e.is_readonly||1==e.is_hidden||1==e.isDisabled)return;let t=e.field_name||e.name;const i=Number(e.tabIndex);this.fields_tabindex_mapping.hasOwnProperty(i)||(this.fields_tabindex_mapping[i]=[]),this.fields_tabindex_mapping[i].push(t)},cleanCheckboxValue(e,t){"checkbox"!=t&&"CheckBox"!=e.fieldType||("true"==e.formatted_value||1==e.formatted_value||"Y"==e.formatted_value?e.formatted_value=!0:e.formatted_value=!1)},setFieldError(e){if(!this.formBuilderModel.hasOwnProperty(e))return;const t=this.formBuilderModel[e];if(t.hasOwnProperty("is_valid")&&1==t.is_valid)return;let i="";t.hasOwnProperty("validation_code")&&t.validation_code&&""!==t.validation_code&&(i=t.validation_code),t.hasOwnProperty("validation_message")&&t.validation_message&&""!==t.validation_message&&(i=t.validation_message),this.setFieldInputError(e,i)},setColor(e,t){t.color="",e.hasOwnProperty("is_valid")&&("MD"==e.extraction_method?t.color="extraction_method-border-left":e.is_valid?t.color=rt.aH.success_border_left:t.color="error-border-left")},setConversionFields(){this.conversionFields=this.getConversionFields()},getField(e){let t={};if(void 0!==this.record)for(const i in this.record.fields){let o=this.record.fields[i];if(o.name==e){t=o;break}}return t},createEmptyField(e,t){let i="checkbox"!=t&&"";return{confidence:0,name:e,field_name:e,value:i,formatted_value:i,content:i}},saveMediImageFields(){let e={};if(ge.A.has("table_data")&&null!=ge.A.getItem("table_data")&&""!=ge.A.getItem("table_data")){let t=ge.A.getItem("table_data");e=JSON.parse(t)}else e={columns:[],table_areas:[]}},prepareTableJson(){Object.keys(this.formBuilderModel).forEach((e=>{this.formBuilderConfigModel[e].fieldType===dt.VV.EXTRACTED_TABLE?(this.record["tables"]=[],this.record.tables.push(Object.assign({},this.formBuilderModel[e]))):this.formBuilderConfigModel[e].fieldType===dt.VV.MULTI_CHECK_BOX&&(this.record.fields.push(Object.assign({},this.formBuilderModel[e])),this.record.fields[this.record.fields.length-1].name=e)}))},downloadXML(){},saveData(){return vt(this,void 0,void 0,(function*(){try{if(this.isReadOnly)return;this.debounceScriptCalculateFunc.cancel(),this.prepareTableJson(),this.saveMediImageFields(),this.showLoading(),this.cleanupTableData(this.record);const e=yield this.saveDocumentWithCoaFields(this.docId,this.coaFields);if(!1===e.success)return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void this.showErrorToast(e.message);this.setDataToCache(),yield this.makeModel(),this.setFieldErrors(!0);const t=new CustomEvent("prepare_rows",{});document.dispatchEvent(t),this.triggerOnSave(),this.refreshCanvas(),this.$forceUpdate(),this.showSuccessToast(this.$t("pages.messages.MSG_SAVE"));let i=new FormData,o=yield(0,ae.L3)();i.append("doc_id",this.record.doc_id),i.append("org_id",(0,gt.I)()),i.append("action_type","UPDATED"),i.append("current_status",this.record.status),i.append("previous_status",this.record.status),i.append("action_description","Modified the document and saved it."),yield He.A.post(ae.FH.update_document_log+this.record.doc_id,i,{headers:{Authorization:o}})}catch(e){return void this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},exportData(){return vt(this,void 0,void 0,(function*(){if(!this.isReadOnly)try{const e=yield this.confirmExportConfiguration();if(!e)return void(this.display_config_dialog=!0);yield this.callExportApi()}catch(e){return void this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}}))},confirmExportConfiguration(){return vt(this,void 0,void 0,(function*(){let e,t=new FormData;t.append("doc_type",this.record.doc_type);const i=yield re.M8.export_configuration_existence(t);return e=i.valid,e}))},validateRequiredFieldRules(){let e=!0;return this.record.hasOwnProperty("required_field_pairs")&&Array.isArray(this.record.required_field_pairs)&&0!=this.record.required_field_pairs.length?(Array.from(this.record.required_field_pairs).forEach((t=>{let i=!1;for(let e of t)this.formBuilderModel[e].formatted_value&&(i=!0);if(!i){e=!1;const i=this.getRequirdFieldsErrorMessage(t);for(let e of t)this.setFieldInputError(e,i)}})),e):e},getRequirdFieldsErrorMessage(e){const t=[];for(let o of e)t.push(this.getLabelForFormBuilder(this.formBuilderConfigModel[o],"form_builder."));let i=this.$t("atleast_fill_one_field");return i=i.replace("#",t.join(", ")),i},callExportApi(){return vt(this,void 0,void 0,(function*(){let e;try{if(yield this.validateExportData())return;yield this.saveAndValidate();let t=JSON.parse(JSON.stringify(this.record));this.cleanupTableData(t),this.showLoading(),t.hasOwnProperty("table_data_copy")&&delete t["table_data_copy"];let i=new FormData;if(i.append("data",JSON.stringify(t)),e=yield re.M8.validate_and_export(this.docId,i),!0===e.success)return yield this.dashboardFiltersAfterExport(),void this.routeToDashboard();this.showErrorToast(e.message),e.hasOwnProperty("data")&&(this.record=e.data,this.record.hasOwnProperty("doc_id")&&!this.record.hasOwnProperty("layout")&&(this.record.layout=t.layout),this.setDocDataVariables(),yield this.handleExportError())}catch(t){const e=_t.t.getErrorMessage(t);this.showErrorToast(e)}finally{this.hideLoading()}}))},cleanupTableData(e){if(!(e.tables&&e.tables.length>0&&e.tables[0].hasOwnProperty("rows")&&e.tables[0].rows.length>0))return;let t=new Map;Array.from(e.tables[0].rows).forEach((e=>{Array.from(e.columns).forEach((e=>{e.isExtraColumn&&(t.has(e.name)?!1===t.get(e.name)&&e.formatted_value&&t.set(e.name,!0):e.formatted_value?t.set(e.name,!0):t.set(e.name,!1))}))})),Array.from(e.tables[0].rows).forEach((e=>{e.columns=e.columns.filter((e=>!(t.has(e.name)&&!1===t.get(e.name))))}))},handlePoMatch(){return vt(this,void 0,void 0,(function*(){(yield this.isPoSettingActivate(this.doctype))&&(this.showPoMatchWarning=!1,this.navigateToPOMatch())}))},handleCOA(){return vt(this,void 0,void 0,(function*(){const e=yield this.saveAndValidate();if(!1===e.success)return this.displayFieldErrors(),void this.showErrorToast(e.message);this.$router.push("/certificate-of-analysis/"+this.record.doc_id)}))},navigateToPOMatch(){return vt(this,void 0,void 0,(function*(){const e=yield this.saveAndValidate();if(!1===e.success)return this.displayFieldErrors(),void this.showErrorToast(e.message);this.$router.push("/po-matching-v3/"+this.record.doc_id)}))},setLineItemDetails(){let e="";"XML_INVOICE"!=this.record.doc_type&&(e=(0,et.PL)("TBL_EXT_VERSION")),this.record.tables&&0!=this.record.tables.length&&!(0,Ge.dd)(this.record.tables)?this.record.tables[0].hasOwnProperty("version")&&"v3"==this.record.tables[0].version&&(this.tb_version="v3"):void 0!==e&&""!=e&&"Version3"==e&&(this.tb_version="v3")},routeToDashboard(){this.$router.push("/dashboard")},displayFieldErrors(){this.handleExportError()},validateExportData(e=!0){return vt(this,void 0,void 0,(function*(){this.handleScroll(),this.updateFieldErrors();const e=this.setFieldErrors(!0),t=yield this.checkValidationError(),i=!this.validateRequiredFieldRules();return e||t||i}))},handleExportError(){return vt(this,void 0,void 0,(function*(){this.setDataToCache(),yield this.makeModel(),this.refreshCanvas();this.setFieldErrors(!1)}))},updateFieldErrors(){for(const[e,t]of Object.entries(this.formBuilderModel))this.formBuilderConfigModel[e].is_required&&t.formatted_value&&"REQUIRED"===t.validation_code&&(t.validation_code="")},setFieldInputError(e,t){this.formBuilderModel[e].input_error=t},setFieldErrors(e){let t=!1;for(const[i,o]of Object.entries(this.formBuilderModel)){if(this.setFieldInputError(i,""),this.formBuilderConfigModel[i].is_required&&!o.formatted_value){t=!0,this.setFieldInputError(i,this.$t("field_required"));continue}if(o.is_valid)continue;if(!o.validation_code||e&&rt.Cx.includes(o.validation_code))continue;let s=this.formBuilderModel[i].validation_message;s||(s=this.$t("pages.api_user_messages."+o.validation_code)),t=!0,this.setFieldInputError(i,s)}return t},checkValidationError(){return vt(this,void 0,void 0,(function*(){let e=!1;for(const[t,i]of Object.entries(this.formBuilderModel)){if("TextInput"!==this.formBuilderConfigModel[t].fieldType)continue;let o=i.formatted_value;if(!o||""==o)continue;const s=this.formBuilderConfigModel[t];let a=!0,r="";({is_valid:a,input_error:r}=yield ft.m.init(i,s)),a||(this.formBuilderModel[t].formatted_value="",this.setFieldInputError(t,r),e=!0)}return e}))},isModelReady(){return 0!==(0,Ge.Ns)(this.formBuilderModel)},getLowerConfidence(e){if(e.confidence&&e.score){let t=e.confidence<1?(100*e.confidence.toFixed(2)).toFixed(0):e.confidence.toFixed(2),i=e.score<=1?(100*e.score.toFixed(2)).toFixed(0):e.score.toFixed(2);return t=Number(t),i=Math.floor(Number(i)),t<i?t:i}return e.confidence?e.confidence<1?(100*e.confidence.toFixed(2)).toFixed(0):e.confidence.toFixed(2):null},openComponentInSeparateWindow(){this.setDataToCache();let e=this.$router.resolve({path:"/simple_fields_comp/"+this.docId});window.open(e.href,"_blank","toolbar=yes,scrollbars=yes,resizable=yes,left=500,width=1500,height=1000")},isViewSeparateComponent(){this.$route.fullPath.match(/simple_fields_comp/g)&&(this.is_sep_view=!0)},updateModelAttribute(e){e.detail&&e.detail.field_name&&this.updateImportJson(e.detail.field_name)},createAutoTriggerDebounceFunc(){this.debounceLookupAutoTriggerFunc=(0,Ye.A)((()=>{null!=this.trigger_lookup_flow&&""!=this.trigger_lookup_flow&&this.preparing_group_change_call()}),3e3)},inputValueChanges(e){this.updateLocalModel(e),this.updateImportJson(e),this.handleScriptCalculatedFields(e),this.fieldCaluclations(),this.broadcastFieldChange(e)},handleLookupAutoTrigger(e){if((0,Ge.z)(e)||(0,Ge.jw)(e))return;let t=this.get_lookup_type_for_changed_field(e);1==t&&(this.get_groups_to_change(),this.updateLookupFieldsStatusInGroups(),this.debounceLookupAutoTriggerFunc())},triggerOnSave(){this.changed_fields=[],this.groups_to_update=[];for(const e of this.fields_with_autotrigger)if(this.checkifFieldChangedForTrigger(e.field_name))this.changed_fields.push(e),this.trigger_lookup_flow=e.group.lookup_dataset_name;else{let t=this.fields_with_autotrigger.indexOf(e);this.fields_with_autotrigger.splice(t,t)}this.get_groups_to_change(),this.updateLookupFieldsStatusInGroups(),this.debounceLookupAutoTriggerFunc()},get_field_lookup_name(e){for(let t in this.record.layout.lookup_configurations)for(let i in this.record.layout.lookup_configurations[t].fields)if(this.record.layout.lookup_configurations[t].fields[i].field_name==e){let e=this.record.layout.lookup_configurations[t].fields[i].lookup_field;return e}return e},updateLocalModel(e){this.formBuilderModel[e].value=this.formBuilderModel[e].formatted_value},broadcastFieldChange(e){const t=new CustomEvent("field_value_updated",{detail:{field_name:e}});document.dispatchEvent(t)},masterDataSearchByField(e){try{const t=e.name,i=this.lookup_configurations.get(t);if(!i)return;const o=(0,Ze.A)(),s=Object.values(this.ms_advance_filters).find((t=>t.field_name===e.name));if(!s&&(this.ms_advance_filters[o]={fuzzy_field:i.lookup_field.toLowerCase(),search_text:this.formBuilderModel[t].formatted_value,field_name:t,primary:!0},this.master_lookup_type=i.lookup_dataset_name,this.ms_view_model=this.formBuilderConfigModel,this.master_data_fields_map=new Map,this.master_data_fields_map.set(this.master_lookup_type,i),this.master_data_popup_width=this.calculateWidthForMSPopuup(),i.parent_field_id&&""!=i.parent_field_id)){let e=null;for(const[t,o]of i.fields.entries())if(i.parent_field_id==o.field_id){e=o;break}if(e){const t=(0,Ze.A)();this.ms_advance_filters[t]={fuzzy_field:e.lookup_field.toLowerCase(),search_text:this.formBuilderModel[e.field_name].formatted_value,field_name:e.field_name,primary:!1}}}this.fuzzyDialog=!0}catch(t){}},closeMsDialog(){this.fuzzyDialog=!1,this.ms_advance_filters={}},calculateWidthForMSPopuup(){let e="700";const t=document.querySelector(".field_validation");if(!t)return e;const i=document.querySelector("#field_scrolle");if(!i)return e;const o=i.offsetWidth;return o<=0?e:String(o)},windowResize(){this.fuzzyDialog&&(this.master_data_popup_width=this.calculateWidthForMSPopuup())},handleSingleSelection(e){let t=["stuck_checkbox","paar_checkbox","hose_checkbox"];t.includes(e)&&t.forEach(((t,i)=>{t!==e&&(this.formBuilderModel[t].formatted_value=!1,this.formBuilderModel[t].value=!1)}))},showConnectionFromField(e){dt.iS.includes(this.formBuilderConfigModel[e].fieldType)&&(this.connectionId=e,this.$emit("showConnectionFromField",e))},exportWithSonderWunsch(){this.record["export_parameters"]={doc_export_status:"export_with_sonderwunsche",validate:!1},this.exportData()},clickExport(){this.record["export_parameters"]={doc_export_status:"export"},this.exportData()},elementClick(e){this.htmlElementClick(e.detail)},htmlElementClick(e){if(this.formBuilderConfigModel[e].fieldType===dt.VV.EXPORT_BUTTON)return void this.handleButtons(e);const t=bt("#"+e);t&&t.closest(".validation-sticky-area")?this.handleScroll():this.showConnectionFromField(e)},handleButtons(e){this.formBuilderConfigModel[e].exportType!=rt.aH.reject?this.formBuilderConfigModel[e].exportType!=rt.aH.save?this.formBuilderConfigModel[e].exportType!=rt.aH.po_match?this.formBuilderConfigModel[e].exportType!=rt.aH.coa?this.formBuilderConfigModel[e].exportType!=rt.aH.save_rules&&(this.formBuilderConfigModel[e].exportType!=rt.aH.quotes_detail?(this.record["export_parameters"]={doc_export_status:this.formBuilderConfigModel[e].exportType},this.exportData()):this.$router.push("/quote-details/"+this.record.doc_id)):this.handleCOA():this.handlePoMatch():this.saveData():this.rejectDocument(this.record.doc_id)},poMatchButtonClicked(){this.tb_version},updateFieldInFormBuilder(e,t){let i=e.querySelector("."+this.connectionId+"_input");if(!i)return;const o=new CustomEvent("update_field_value",{detail:{input_class:this.connectionId+"_input",val:t.formatted_value}});i.dispatchEvent(o)},updateFieldData(e){let t=bt("#"+this.connectionId);if(t.setAttribute("pageno",this.page.toString()),"INVOICE"==this.record.doc_type&&e.extracted_value&&0!==Object.keys(e.extracted_value).length)return void this.openSelectionPopup(JSON.parse(JSON.stringify(e)));t&&this.updateFieldInFormBuilder(t,e);const i=this.getInputType(t);this.formBuilderModel[this.connectionId].value=e.value,this.formBuilderModel[this.connectionId].formatted_value=e.formatted_value,this.formBuilderModel[this.connectionId].content=e.text,this.formBuilderModel[this.connectionId].api_save=!0,this.formBuilderModel[this.connectionId].score_description="",this.formBuilderModel[this.connectionId].coords=e.coords,e&&!0===e.multi_line?this.formBuilderModel[this.connectionId].multi_line=!0:this.formBuilderModel[this.connectionId].multi_line=!1,"checkbox"===i&&(this.formBuilderModel[this.connectionId].value=!1,this.formBuilderModel[this.connectionId].formatted_value=!1,this.formBuilderModel[this.connectionId].content=!1,e.formatted_value&&"x"===e.formatted_value.toLowerCase()&&(this.handleSingleSelection(this.connectionId),this.formBuilderModel[this.connectionId].value=!0,this.formBuilderModel[this.connectionId].content=!0,this.formBuilderModel[this.connectionId].formatted_value=!0)),this.valueChangesOnRedraw(this.connectionId,e.coords,this.page),this.$emit("enableOrDisableExportButton"),this.$forceUpdate()},valueChangesOnRedraw(e,t,i){let o=["stuck_checkbox","paar_checkbox","hose_checkbox"],s=[];o.includes(e)?s=o:s.push(e),t&&i?this.prepareImportJson(s,t,i,"AI"):this.prepareImportJson(s),this.$emit("removeOldMapiingsAndDrawNew",e),this.$forceUpdate()},prepareImportJson(e,t,i,o){e.forEach((e=>{this.updateImportJson(e,t,i,o)}))},updateImportJson(e,t,i,o=""){let s=!1;if(this.record.fields.forEach(((a,r)=>vt(this,void 0,void 0,(function*(){if(a.name===e){s=!0,a.hasOwnProperty("original")||(a["original"]=Object.assign({},a)),a.hasOwnProperty("original_value")||(a["original_value"]=a.value),(t||null===t)&&(a.coords=t),i&&(a.page=i),o&&(a.extraction_method=o),a.is_valid=!0,a.is_validated=!0;let r=this.formBuilderModel[e];return a.formatted_value=r.formatted_value,a.value=r.value?r.value:r.formatted_value,a.content=r.content,r.input_error&&(a.is_valid=!1,a.is_validated=!1),r.hasOwnProperty("api_save")&&r.api_save||(a.value=r.formatted_value),""==a.value||r.hasOwnProperty("api_save")&&r.api_save||!this.conversionFields.includes(r.name)||"en_US"==this.amount_format_locale||(a.value=yield this.convertValueAccordingToLocale(a.value,this.amount_format_locale,"en_US"),a.float_value=+a.value),a.color=rt.aH.success_border_left,"MD"==a.extraction_method&&(a.color="extraction_method-border-left"),!a.is_required||""!=a.formatted_value&&null!=a.formatted_value||(a.color="error-border-left"),((0,Ge.z)(a.formatted_value)||(0,Ge.jw)(a.formatted_value))&&(a.content=a.formatted_value),this.formBuilderModel[this.connectionId]&&this.formBuilderModel[this.connectionId].hasOwnProperty("multi_line")&&!0===this.formBuilderModel[this.connectionId].multi_line?a.multi_line=!0:a.multi_line=!1,this.formBuilderModel[e].is_valid=a.is_valid,this.formBuilderModel[e].is_validated=a.is_validated,void this.$emit("checkFieldInvalid",a)}})))),!s){this.record.fields.push({});const s=this.record.fields.length-1;this.record.fields[s].name=e,this.record.fields[s].content=this.formBuilderModel[e].content,this.record.fields[s].formatted_value=this.formBuilderModel[e].formatted_value,this.record.fields[s].value=this.formBuilderModel[e].value,this.record.fields[s].original_value="",this.record.fields[s].validation_code="",this.record.fields[s].extraction_method=o,this.record.fields[s].is_validated=!0,this.record.fields[s].is_valid=!0,this.record.fields[s].color=rt.aH.success_border_left,!0===this.formBuilderModel[this.connectionId].multi_line?this.record.fields[s].multi_line=!0:this.record.fields[s].multi_line=!1,t&&(this.record.fields[s].coords=t),i&&(this.record.fields[s].page=i),this.$emit("checkFieldInvalid",this.record.fields[s])}},initTempFieldDelete(){this.record.fields.forEach(((e,t)=>{if(e.name===this.connectionId){const e={color:null,coords:null,confidence:0,validation_code:null,value:"",formatted_value:"",content:"",page:null};this.formBuilderModel[this.connectionId]=Object.assign(this.formBuilderModel[this.connectionId],e),this.record.fields[t]=Object.assign(this.record.fields[t],e)}})),this.fieldCaluclations(),this.handleLookupFieldStatus(this.connectionId,!1,!0),this.saveOneFieldStateForAutotrigger(this.record,this.connectionId);let e=bt("#"+this.connectionId);e&&e.setAttribute("pageno","")},handleScroll(){this.$emit("handleScroll")},getInputType(e){return e.getAttribute("child_type")},onInputValueChanges(e,t){if(!this.freeze_fields_change_event)if("delete_rule"!==t){if("calculated"===t?this.updateImportJson(e,null,this.page,"calculated"):"purchase_order"==e&&(this.record.is_purchase_order_changed=!0),this.removeSelectedAreaOnImage(e),this.isFieldScriptCalculated(e))this.updateScriptRequest();else{const t=this.handleScriptForNonCalcField();t||this.handleLookupAutoTrigger(e)}this.inputValueChanges(e),this.startTimer()}else this.deleteRule(e)},removeSelectedAreaOnImage(e){if(this.isConfirmationBoxDisable){const t=new CustomEvent("removeSelectedAreaOnImage",{});document.dispatchEvent(t),this.connectionId=e,this.removeConnectionFromModel(this.connectionId)}},removeConnectionFromModel(e){this.record.fields.forEach(((e,t)=>{if(e.name===this.connectionId){e.hasOwnProperty("original")||(e["original"]=Object.assign({},JSON.parse(JSON.stringify(e))));const i={color:null,coords:null,confidence:0,validation_code:null};this.formBuilderModel[this.connectionId]=Object.assign(this.formBuilderModel[this.connectionId],i),this.record.fields[t]=Object.assign(this.record.fields[t],i)}}))},getLayoutTemplateID(){return vt(this,void 0,void 0,(function*(){try{let e={};this.record.doc_type&&(e["doc_type_key"]=this.record.doc_type),this.record.sub_doc_type&&(e["sub_doc_type_key"]=this.record.sub_doc_type),this.record.doc_origin&&(e["doc_origin"]=this.record.doc_origin);const t=yield re.H7.getLayoutTemplates(e);if(!t||t.hasOwnProperty("success")&&!1===t.success)throw t;if(!t.data||!Array.isArray(t.data)||0===t.data.length||!t.data[0].hasOwnProperty("id"))throw{message:"Layout Template ID Not Found"};this.layout_template_id=t.data[0].id}catch(e){const t=_t.t.getErrorMessage(e);this.showErrorToast(t)}}))},getFormBuilderLayout(){return vt(this,void 0,void 0,(function*(){let e;this.formLayout=[];try{if(!this.layout_template_id)return;e=yield re.H7.getDocumentLayoutTemplateById(this.layout_template_id);let t=JSON.parse(e.layout_json);t&&(this.formLayout=t.hasOwnProperty("layout")?t.layout:[],this.formLayout&&(yield this.makeModel()),this.isExtenedPanel=!!t.isExtenedPanelEnabled,this.setGeneralSettings(t),this.$emit("setSplitterModel",this.isExtenedPanel))}catch(t){return void this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}}))},updateModel(e){},isFieldScriptCalculated(e){return!(!this.formBuilderConfigModel[e].hasOwnProperty("run_script_on_change")||!0!==this.formBuilderConfigModel[e].run_script_on_change)},isFieldhasWorkflowEnabled(e){return!(!this.formBuilderConfigModel[e].hasOwnProperty("run_workflow_on_change")||!0!==this.formBuilderConfigModel[e].run_workflow_on_change)},handleScriptCalculatedFields(e){try{if(!this.isFieldScriptCalculated(e))return;this.record.apply_script_triggered_on_field=e,this.createNewScriptRequest()}catch(t){}},handleScriptForNonCalcField(){return!(""===this.api_request_id||!this.record.hasOwnProperty("apply_script_triggered_on_field")||!this.record.apply_script_triggered_on_field)&&(this.updateScriptRequest(),this.createNewScriptRequest(),!0)},scriptCalculateFuncWrapper(e){let t="",i="";e.detail.columnName&&(i=e.detail.columnName),e.detail.rowId&&(t=e.detail.rowId),this.record.apply_script_triggered_on_table_row=t,this.record.apply_script_triggered_on_table_field=i,this.debounceScriptCalculateFunc()},applyScript(){return vt(this,void 0,void 0,(function*(){try{this.auto_saved_done=!1,this.auto_saving=!0,this.script_api_timestamp=Date.now();const e=yield this.applyScriptOnDocument();if(!e)return;let t=!1;for(const[o,s]of Object.entries(this.formBuilderModel)){let e=0;s.hasOwnProperty("update_timestamp")&&(e=s.update_timestamp),e>this.script_api_timestamp&&(t=!0)}if(t)return this.updateRequestId(),void this.createNewScriptRequest();yield this.updateRecordAfterScript(),this.$emit("setDocVersion"),this.setDataToCache(),this.highlightFieldsMode=!0,yield this.makeModel(),this.handleLookupAutoTrigger(this.record.apply_script_triggered_on_field),this.setFieldErrors(!1),this.refreshCanvas();const i=new CustomEvent("prepare_rows",{});document.dispatchEvent(i)}catch(e){}finally{this.auto_saving=!1,this.auto_saved_done=!0,setTimeout((()=>{this.auto_saved_done=!1}),1e4)}}))},get_lookup_type_for_changed_field(e){if(this.changed_fields=[],this.groups_to_update=[],!this.checkifFieldChangedForTrigger(e))return!1;let t=!1;for(let i of this.record.layout.lookup_configurations)if(!(0,Ge.z)(i.lookup_dataset_name)&&!(0,Ge.jw)(i.lookup_dataset_name))for(let o in i.fields)if(i.fields[o].field_name==e&&!0===i.fields[o].auto_trigger){this.groups_to_update.push({group:i,field_name:e,lookup_field:i.fields[o].lookup_field});for(let e of i.fields)this.changed_fields.push(e);this.trigger_lookup_flow=i.lookup_dataset_name,t=!0}return t},preparing_group_change_call(){return vt(this,void 0,void 0,(function*(){const e={};for(let t in this.groups_to_update){const i=this.groups_to_update[t].group;if((0,Ge.z)(this.groups_to_update[t].group.lookup_dataset_name)||(0,Ge.jw)(this.groups_to_update[t].group.lookup_dataset_name)||e.hasOwnProperty(this.groups_to_update[t].group.id))continue;const o=this.groups_to_update[t].group.lookup_dataset_name;e[this.groups_to_update[t].group.id]=!0;const s={},a=(0,Ze.A)();let r=this.groups_to_update[t].field_name,l=this.groups_to_update[t].lookup_field;s[a]={field:{field:l},operator:this.getFieldOperator(r,this.groups_to_update[t]),search_text:this.formBuilderModel[r].formatted_value};let n=yield this.autoTriggerSearchByField(s,o);if(null!=n){const e=JSON.stringify(n.data[0]);this.populateMasterDataFields(i,o,e),this.lookup_loading_fields[r].lookup_found=!0}else this.lookup_loading_fields[r].lookup_found=!1,this.lookup_loading_fields[r].lookup_found_name=o}this.trigger_lookup_flow="",this.saveFieldsStateForAutotrigger(this.record.fields),this.updateScriptRequest(),this.record.apply_script_triggered_on_field="",this.debounceScriptCalculateFunc(),this.updateLookupFieldsStatusInGroups(!1,!1)}))},getFieldOperator(e,t){for(let i of t.group.fields)if(i.field_name==e&&i.hasOwnProperty("search_operator")&&!(0,Ge.z)(i.search_operator)&&!(0,Ge.jw)(i.search_operator))return i.search_operator;return"contains"},updateLookupFieldsStatusInGroups(e=!0,t=!0){for(let i in this.groups_to_update){const o=this.groups_to_update[i].group;for(let[i,s]of o.fields.entries())this.handleLookupFieldStatus(s.field_name,e,t)}},handleLookupFieldStatus(e,t,i=!0){this.formBuilderModel.hasOwnProperty(e)&&(this.lookup_loading_fields.hasOwnProperty(e)||(this.lookup_loading_fields[e]={}),this.lookup_loading_fields[e].lookup_loading=t,i&&(this.lookup_loading_fields[e].lookup_found=null,this.lookup_loading_fields[e].lookup_found_name=null))},get_changed_fields(e){const t=e.fields;for(let[i,o]of t.entries())this.changed_fields.push(o)},removeCurrentSelectedGroup(e){this.groups_to_update=this.groups_to_update.filter((t=>t.group.lookup_dataset_name!==e))},get_groups_to_change(){for(let e of this.fields_with_autotrigger)for(let t of this.changed_fields)t.field_name.toLowerCase()!=e.field_name.toLowerCase()&&t.lookup_field.toLowerCase()!=e.lookup_field.toLowerCase()||this.groups_to_update.some((i=>i.group===e.group&&i.field_name.toLowerCase()===t.field_name.toLowerCase()&&i.lookup_field.toLowerCase()===t.lookup_field.toLowerCase()))||this.groups_to_update.push({group:e.group,field_name:e.field_name,lookup_field:e.lookup_field})},check_for_auto_trigger(){this.fields_with_autotrigger=[];for(let e of this.record.layout.lookup_configurations)if(!(0,Ge.z)(e.lookup_dataset_name)&&!(0,Ge.jw)(e.lookup_dataset_name))for(let t in e.fields)!0!==e.fields[t].auto_trigger||this.fields_with_autotrigger.some((i=>i.field_name.toLowerCase()===e.fields[t].field_name.toLowerCase()&&i.lookup_field.toLowerCase()===e.fields[t].lookup_field.toLowerCase()&&i.group===e))||this.fields_with_autotrigger.push({field_name:e.fields[t].field_name,lookup_field:e.fields[t].lookup_field,group:e})},populateMSDataFromPopup(){this.changed_fields=[],this.groups_to_update=[];let e=this.master_data_fields_map.get(this.master_lookup_type);this.get_changed_fields(e),this.get_groups_to_change(),this.removeCurrentSelectedGroup(this.master_lookup_type),this.populateMasterDataFields(e,this.master_lookup_type,this.master_data_row),this.updateLookupFieldsStatusInGroups(),this.preparing_group_change_call()},populateMasterDataFields(e,t,i){return vt(this,void 0,void 0,(function*(){try{this.closeMsDialog(),this.showLoading(),this.freeze_fields_change_event=!0;let t=JSON.parse(i);const o=[],s=e.fields;for(let[e,i]of s.entries()){const e=i.field_name,s=i.lookup_field.toLowerCase();t.hasOwnProperty(s)&&this.conversionFields.includes(e)&&null!=t[s]&&o.push({key:t[s],value:t[s]})}let a=[];o.length>0&&(a=yield this.formatMultiValues(o,"en_US",this.amount_format_locale));const r="MD";for(let[e,i]of s.entries()){const e=i.field_name,o=i.lookup_field.toLowerCase();if(!this.formBuilderModel.hasOwnProperty(e))continue;if(0==t.hasOwnProperty(o)||null==t[o])continue;let s=t[o];this.conversionFields.includes(e)&&null!=t[o]&&(s=this.searchValueByKey(s,a)),t.hasOwnProperty(o+"_formatted_value")&&(s=t[o+"_formatted_value"]),this.formBuilderModel[e].formatted_value=s,this.formBuilderModel[e].value=t[o],this.formBuilderModel[e].color="extraction_method-border-left",this.formBuilderModel[e].extraction_method=r,this.formBuilderModel[e].formatted_value&&this.setFieldInputError(e,""),!this.isCurrentFieldPrimary(e)&&this.isContentChanged(this.formBuilderModel[e].content,t[o])&&(this.formBuilderModel[e].content=t[o],this.formBuilderModel[e].confidence=0,this.formBuilderModel[e].validation_code=null,this.formBuilderModel[e].coords=null),this.setColor(this.formBuilderModel[e],this.formBuilderConfigModel[e]),this.updateImportJson(e,this.formBuilderModel[e].coords,this.page,r)}this.resetMasterDataStore(),this.refreshCanvas(),this.validateExportData(!1),setTimeout((()=>{this.$emit("enableOrDisableExportButton")}),5)}catch(t){}finally{this.hideLoading(),this.freeze_fields_change_event=!1}}))},jumpToTable(e){e.preventDefault();for(const[t,i]of this.formLayout.entries())if(this.isGroupTable(t)){this.focusOnTableGroup(t);break}},triggerTableAddRow(e){for(const[t,i]of this.formLayout.entries()){if(!this.isGroupTable(t))continue;const e=this.formLayout[t].rows[0];let i=document.querySelector("."+e.name);if(!i)return;const o=new CustomEvent("trigger_add_row",{detail:{}});i.dispatchEvent(o);break}e.preventDefault()},findGroupShortcutkey(e){const t=e.key,i=["shift","alt"],o=i.find((e=>{const i=e+t;return this.groupShortCutMap.has(i)}));return o},focusOnGroupFromMap(e){if(0===this.groupShortCutMap.size)return;const t=this.findGroupShortcutkey(e);if(!t)return;const i=t+e.key,o=this.groupShortCutMap.get(i);null!==o&&void 0!==o&&""!==o&&e.preventDefault()},isGroupTable(e){return!!this.formLayout[e].rows[0]&&"ExtractedTable"===this.formLayout[e].rows[0].fieldType},getFirstFieldOfGroup(e){let t="",i=["CheckBox","TableOfCheckboxes"];i=i.concat(this.excluded_field_types);const o=this.formLayout[e].rows.find((e=>!i.includes(e.fieldType)));return o?(t=o.name,o.hasOwnProperty("field_name")&&(t=o.field_name),t||""):t},focusOnTableGroup(e){const t=this.formLayout[e].rows[0];this.focusOnTable(t.name)},validateAllSectionFields(e){if(this.isReadOnly)return;const t=this.formLayout[e];if(t.hasOwnProperty("rows"))for(const i of t.rows)this.validateField(i.field_name)},getNextTabIndex(e){let t=!1,i=0;for(const[s,a]of Object.entries(this.fields_tabindex_mapping)){const o=Number(s);if(!0===t){i=o;break}e===o&&(t=!0)}const o=this.fields_tabindex_mapping[i];return o&&Array.isArray(o)?i:this.getNextTabIndex(i)},isFieldAvailableToFocus(e){const t=bt("#"+e);return!!t},getNextTabIndexField(e,t){try{const i=this.fields_tabindex_mapping[e],o=i.indexOf(t);if(o===i.length-1){const t=this.getNextTabIndex(e),i=String(this.fields_tabindex_mapping[t][0]),o=this.isFieldAvailableToFocus(i);return o?i:this.getNextTabIndexField(t,i)}const s=o+1,a=String(i[s]),r=this.isFieldAvailableToFocus(a);return r?a:this.getNextTabIndexField(e,a)}catch(i){return""}},focusOnTable(e){let t=document.querySelector("."+e);if(!t)return;const i=new CustomEvent("focus_first_row_column",{detail:{}});t.dispatchEvent(i)},getComponentType(e){let t="";const i=bt("#"+e);return i?(t=this.getInputType(i),"checkbox"==t||""==t?"":t):""},validateField(e){if(!this.formBuilderModel[e])return;let t=this.formBuilderConfigModel[e];this.formBuilderModel[e].color=rt.aH.success_border_left,this.formBuilderModel[e].is_valid=!0,this.formBuilderModel[e].validation_code=null,this.formBuilderModel[e].validation_message=null,this.setFieldInputError(e,""),this.formBuilderModel[e].is_validated=!0,this.setColor(this.formBuilderModel[e],t),this.updateImportJson(e)},startTimer(){const e=new CustomEvent("start_time_spent_on_validation",{});document.dispatchEvent(e)},findGroupToFocus(e){if(0===this.formLayout[String(e)].rows.length)return this.findGroupToFocus(e+1);if(this.formLayout[String(e)].is_stcky_group)return this.findGroupToFocus(e+1);const t=this.getFirstFieldOfGroup(String(e));return t?e:this.findGroupToFocus(e+1)},keydownEventWrapper(e){this.keyDownEvent(e)},getConfidence(e){return e?e<1?(100*+e.toFixed(2)).toFixed(0):+e.toFixed(2):""},fieldCaluclations(){return vt(this,void 0,void 0,(function*(){for(const e of this.formLayout)for(const t of e.rows)t.calculation_formula&&(yield this.performCalulations(t.field_name,t.calculation_formula,this.amount_format_locale,t.field_type),this.updateImportJson(t.field_name))}))},countAmountFieldsConfidence(e){let t=["net_amount","tax_amount","tax_rate","net_amount_2","tax_amount_2","tax_rate_2","net_amount_3","tax_amount_3","tax_rate_3","total_amount","total_amount","total_net_amount","total_tax_amount"];t.includes(e.name)&&1==+e.confidence&&this.amount_fields_confidence_count++},addAdditionalAmountPanelInRows(){let e=!1,t={},i={};const o=[{selected:!1,is_hidden:!1,name:"additional_amount",icon:"images/AdditionalAmount.svg",field:"additional_amount",label:"additional_amount"},{selected:!1,is_hidden:!1,name:"additional_amount_2",icon:"images/AdditionalAmount.svg",field:"additional_amount_2",label:"additional_amount_2"},{selected:!1,is_hidden:!1,name:"additional_amount_3",icon:"images/AdditionalAmount.svg",field:"additional_amount_3",label:"additional_amount_3"},{selected:!1,is_hidden:!1,name:"negative_amount",icon:"images/NegativeAmount.svg",field:"negative_amount",label:"negative_amount"},{selected:!1,is_hidden:!1,name:"negative_amount_2",icon:"images/NegativeAmount.svg",field:"negative_amount_2",label:"negative_amount_2"},{selected:!1,is_hidden:!1,name:"negative_amount_3",icon:"images/NegativeAmount.svg",field:"negative_amount_3",label:"negative_amount_3"}];for(const[s,a]of this.formLayout.entries())if(a.name===rt.P.tax_details)for(const[r,l]of a.rows.entries()){const s=l.field_name;"fields_group"==s&&(e=!0),"additional_amount"!=s||e||(a.rows.splice(r,0,{field_name:"fields_group",def:o}),e=!0);for(const[e,a]of o.entries()){let e=a.field;e===s&&(a.label=this.displayFieldLabelFor2a(l),l.is_hidden?i[a.name]=s:this.formBuilderModel[s].value?(l.visibile=!0,t[a.name]=!0,this.formBuilderConfigModel[s].visibile=!0):(l.visibile=!1,this.formBuilderConfigModel[s].visibile=!1))}}for(const[s,a]of this.formLayout.entries())if(a.name===rt.P.tax_details)for(const[e,o]of a.rows.entries()){const e=o.field_name;if("fields_group"==e)for(const[s,a]of o.def.entries())!0===t[a.name]?a.selected=!0:a.selected=!1,i[a.name]||(a.is_hidden=!0)}},handleChargesFieldsVisibility(e){this.showAllChargesFields=!1;for(let i=0;i<e.rows.length;i+=2)try{const t=e.rows[i].field_name;if(i+1>=e.rows.length)break;const o=e.rows[i+1].field_name;this.formBuilderModel[t].value||this.formBuilderModel[o].value||(e.rows[i].visibile=!1,e.rows[i+1].visibile=!1)}catch(t){}},toggleChargesFieldsVisibility(e,t){if(t){this.showAllChargesFields=!0;for(const[t,i]of e.rows.entries())i.visibile=!0}else this.handleChargesFieldsVisibility(e)},handleConfidenceAlert(){this.amount_fields_confidence_count>1&&(this.origin_warning_alert=this.showWarningAlert(this.$t("selection_popup_origin_warning"),5e3))},toggleGroupFieldsVisibility(e,t,i,o,s){if(!this.isButtonToggleDisable(this.record.status)){for(const a of this.formLayout)if(a.name==s)for(const s of a.rows){let a=s.field_name;a==t.field_name&&(s.def[i].selected=!o),e===a&&(s.visibile=!o)}this.prepareLayoutForTemplate()}},handleTabGroupLabels(e,t){let i=!1,o={};if(0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype||t!==rt.P.tax_details)return o;for(let s of e.buttons)if("full"==s.name&&!0===s.selected){i=!0;break}if(i)return o;for(let s of e.buttons)if("full"!==s.name&&!0===s.selected){o=s.alt_translation_keys;break}return o},openSelectionPopup(e){this.selection_popup_data["title"]=this.$t("selection_popup_heading"),this.selection_popup_data["data"]=e,this.selection_popup_data["value_1"]={key:"suggested",value:e.formatted_value,disable:!e.value||""==e.value,label:this.$t("suggested_value")};let t=e.extracted_value;this.selection_popup_data["value_2"]={key:"extracted",value:t.formatted_value,disable:!t.value||""==t.value,message:t.message&&""!=t.message?t.message:"",label:this.$t("extracted_value")},this.showSelectionPopupDialog=!0},selectionPopupSelected(e){if(!e.detail||!e.detail.data||!e.detail.data.data||!e.detail.selected)return;this.showSelectionPopupDialog=!1;let t=e.detail.data.data,i=t.coords;"extracted"==e.detail.selected&&(t=t.extracted_value),this.formBuilderModel[this.connectionId].value=t.value,this.formBuilderModel[this.connectionId].formatted_value=t.formatted_value,this.formBuilderModel[this.connectionId].content=t.text,this.formBuilderModel[this.connectionId].api_save=!0,this.updateCoordinates(i),this.inputValueChanges(this.connectionId),this.$forceUpdate(),this.hideLoading()},updateCoordinates(e){this.record.fields.forEach(((t,i)=>{t.name===this.connectionId&&(t.coords=e,t.page=this.page)})),this.$emit("refreshCanvasAfterSelection",this.connectionId)},selectionPopupClosed(){this.showSelectionPopupDialog=!1},deleteRule(e){this.record.hasOwnProperty("clear_rules_fields_for_user")||(this.record.clear_rules_fields_for_user=[]),this.record.fields.forEach(((t,i)=>{t.name===e&&(this.record.clear_rules_fields_for_user.push(e),this.record.fields.splice(i,1))})),this.formBuilderConfigModel[e].color=null,this.formBuilderModel[e]=Object.assign(this.formBuilderModel[e],{deleted:!0,color:null,value:"",confidence:0,formatted_value:"",content:null,validation_code:null,coords:null}),this.refreshCanvas(),this.handleLookupFieldStatus(e,!1,!0),this.saveOneFieldStateForAutotrigger(this.record,e),this.handleScroll(),setTimeout((()=>{this.$emit("enableOrDisableExportButton")}),5)},refreshCanvas(){const e=new CustomEvent("refresh_canvas",{});document.dispatchEvent(e)}},setup(){let e=[],t=new Map;const i=(0,lt.t8)(),{clearStateForExportDialog:o}=i,{display_config_dialog:s,config_saved:a}=(0,ee.bP)(i),r=(0,lt.ky)(),{tableRows:l}=(0,ee.bP)(r),n=(0,lt.uL)(),{freeze_fields_change_event:d,formBuilderModel:c,formLayout:h,isExtenedPanel:u,isFormBuilderMode:p,formBuilderConfigModel:_,renderComponent:m,docType:f,fieldListToHighlight:g}=(0,ee.bP)(n),{getElementWidth:v,prepareLayoutData:b,performCalulations:y,isFieldHidden:w}=n,k=(0,lt.q3)(),{record:C,script_api_timestamp:F,doc_loaded:E,layout_template_id:L,get_cached_data_id:x,auto_saving:M,auto_saved_done:S,amount_format_locale:T,fieldsNotDisplayed:A,lookup_configurations:D,po_items:I}=(0,ee.bP)(k),{saveFieldsStateForAutotrigger:O,getResponseCoa:R,rejectCoa:B,rejectDocument:P,saveOneFieldStateForAutotrigger:V,checkifFieldChangedForTrigger:N,saveDocumentWithCoaFields:q,applyScriptOnDocument:$,updateRecordAfterScript:U,setDataToCache:W,setRecordFromCache:K,saveAndValidate:z,setDocDataVariables:Q,updateRequestId:X}=k,j=(0,lt.Ox)(),{model:H,advance_filters:G,master_lookup_type:J,changed_fields:Y,groups_to_update:Z,fields_with_autotrigger:te,selected_row:ie,populate_row_to_view:oe,master_data_fields_map:ae,isDraggle:re}=(0,ee.bP)(j),{resetMasterDataStore:le,isContentChanged:ne,isCurrentFieldPrimary:de}=j,ce=(0,lt.yM)(),{populateListsAndValues:he,getListOfValuesAsSelectList:ue,addNameToLovList:pe}=ce,_e=(0,lt.XB)(),{setGeneralSettings:me}=_e,{isConfirmationBoxDisable:fe}=(0,ee.bP)(_e),ge=(0,lt.oI)(),{releaseDocLock:ve}=ge,be=(0,lt.fX)(),{dashboardFiltersAfterExport:ye}=be,we=(0,lt.gP)(),{formatMultiValues:ke,searchValueByKey:Ce}=we,Fe=(0,lt._6)(),{tokenQueryParam:Ee}=(0,ee.bP)(Fe);Fe.getTokenQueryParam();const Le=(0,lt.vm)(),{searchByField:xe}=Le,{lookup_loading_fields:Me,trigger_lookup_flow:Se}=(0,ee.bP)(Le);return{po_items:I,saveOneFieldStateForAutotrigger:V,trigger_lookup_flow:Se,autoTriggerSearchByField:xe,lookup_loading_fields:Me,saveFieldsStateForAutotrigger:O,checkifFieldChangedForTrigger:N,freeze_fields_change_event:d,lookup_configurations:D,tokenQueryParam:Ee,script_api_timestamp:F,updateRecordAfterScript:U,isCurrentFieldPrimary:de,formatMultiValues:ke,searchValueByKey:Ce,config_saved:a,addNameToLovList:pe,isFieldHidden:w,doc_loaded:E,setDocDataVariables:Q,saveAndValidate:z,performCalulations:y,amount_format_locale:T,dashboardFiltersAfterExport:ye,setRecordFromCache:K,updateRequestId:X,setDataToCache:W,saveDocumentWithCoaFields:q,releaseDocLock:ve,setGeneralSettings:me,resetMasterDataStore:le,applyScriptOnDocument:$,populateListsAndValues:he,clearStateForExportDialog:o,getListOfValuesAsSelectList:ue,getResponseCoa:R,rejectCoa:B,rejectDocument:P,master_lookup_type:J,changed_fields:Y,groups_to_update:Z,fields_with_autotrigger:te,isDraggle:re,tableRows:l,ms_advance_filters:G,isConfirmationBoxDisable:fe,master_data_fields_map:ae,populate_row_to_view:oe,isContentChanged:ne,master_data_row:ie,ms_view_model:H,record:C,coaFields:(0,se.KR)([]),apiData:(0,se.KR)(e),tableAreasStr:(0,se.KR)(""),is_sep_view:(0,se.KR)(!1),fuzzyDialog:(0,se.KR)(!1),selectedRow:(0,se.KR)([]),tableFields:(0,se.KR)([]),oldIndex:(0,se.KR)(0),showEmailPopUp:(0,se.KR)(!1),rejectData:(0,se.KR)({email:"",reason:""}),isDragging:(0,se.KR)(!1),indexToMove:(0,se.KR)(0),tableFieldsOriginal:(0,se.KR)([]),renderKey:0,isColumnDragging:(0,se.KR)(!1),isReadOnly:(0,se.KR)(!1),display_config_dialog:s,formBuilderModel:c,formLayout:h,isExtenedPanel:u,isFormBuilderMode:p,formBuilderConfigModel:_,layout_template_id:L,get_cached_data_id:x,renderComponent:m,docType:f,groupShortCutMap:t,fieldListToHighlight:g,fieldsNotDisplayed:A,tb_version:"default",getElementWidth:v,prepareLayoutData:b,is_admin:(0,se.KR)(!1),master_data_popup_width:(0,se.KR)("700"),fields_tabindex_mapping:(0,se.KR)({}),script_loading:(0,se.KR)(!1),auto_saving:M,auto_saved_done:S,DOC_SCRIPT_MODULE:(0,se.KR)(!1),debounceLookupAutoTriggerFunc:{}}}});var wt=i(12807),kt=i(56384),Ct=i(97410),Ft=i(10386),Et=i(50492),Lt=i(67837),xt=i(82156),Mt=i(23316),St=i(36914),Tt=i(39150),At=i(44189),Dt=i(3952),It=i(62669),Ot=i(39035),Rt=i(63194),Bt=i(45262),Pt=i(67156),Vt=i(80460),Nt=i(42315),qt=i(88672),$t=i(98582),Ut=i.n($t);const Wt=(0,wt.A)(yt,[["render",je],["__scopeId","data-v-4ef0ceb6"]]),Kt=Wt;Ut()(yt,"components",{QBtn:kt.A,QTooltip:Ct.A,QSeparator:Ft.A,QIcon:Et.A,QInput:Lt.A,QDialog:xt.A,QCard:Mt.A,QToolbar:St.A,QToolbarTitle:Tt.A,QCardSection:At.A,QAvatar:Dt.A,QCardActions:It.A,QInnerLoading:Ot.A,QSpinnerHourglass:Rt.A,QTd:Bt.A,QField:Pt.A,QCheckbox:Vt.A,QTable:Nt.A}),Ut()(yt,"directives",{ClosePopup:qt.A});var zt=i(95488),Qt=i(56254),Xt=i(12566),jt=i(96075),Ht=i(56653),Gt=i(46687),Jt=i(80204),Yt=i(72608),Zt=i(64500),ei=i(31191),ti=i(4924),ii=i(90467),oi=i(42643),si=i(92867),ai=i(38888),ri=i(80637),li=i(97752),ni=i(6315),di=i(23403),ci=function(e,t,i,o){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function r(e){try{n(o.next(e))}catch(t){a(t)}}function l(e){try{n(o["throw"](e))}catch(t){a(t)}}function n(e){e.done?i(e.value):s(e.value).then(r,l)}n((o=o.apply(e,t||[])).next())}))};const hi=document.querySelector.bind(document),ui=(0,o.pM)({el:"#app",mixins:[ie.A,le.A,ce.A,de.A,he.A,pe.A,_e.A,be.A,Zt.A,ti.A,ot.A,Gt.A,ei.A,ut.A,ue.A,te.A],components:{Loader:ne.A,supportForm:Ht.A,SubHeader:zt.A,ScriptLogs:di.A,IgnoreTableValidation:si.A,BlockSupplier:ai.A,DocumentLock:me.A,MessageBanner:ye.A,CoaFields:Kt,AISeverityLevel:we.A,SplitDocument:Qt.A,ErrorDocumentView:Xt.A,InvoiceDuplicateLock:Jt.A,timeSpentTimer:li.A,AnnotationView:ni.A,TaskList:ii.A,UnBlockSupplier:ri.A,NonMappedColumnsBtn:oi.A},watch:{$route(e,t){if(!e.hasOwnProperty("path")||!t.hasOwnProperty("path"))return;const i=e.path.split("/"),o=t.path.split("/");i.length>2&&o.length>2&&i[1]===o[1]&&this.get_cached_data_id!=this.docId&&window.location.reload()}},data(){return{docId:"",contact:this.$t("pages.screen2a.confirm"),showDialog:!1,showExportDialog:!1,zoom_value:(0,se.KR)(.6),showArticlePage:!1,disableSelectionButton:!0,loading:!1,shownButtonsLength:0,showExpandButton:!1,saveInstant:!1,magnifyGlass:{},allowedDoctypes:rt.Gk,format_warning_dismiss:{},excluded_fields:["fields_group"],account_block:"",error_message:"",currentDisplayedMessage:(0,se.KR)(""),trigger_document_lock:(0,se.KR)(!1),isInvoiceDuplicate:(0,se.KR)(!1),split_document:(0,se.KR)(!1),headerFabIcon:(0,se.KR)(!1),dropdownModel:(0,se.KR)(!1),imageLoaded:(0,se.KR)(!1),textConfirmation:!1,selectMonitor:(0,se.KR)(!1),doc_script_module_setting:rt.$B,barcode_amount:(0,se.KR)(0),barcode_data:(0,se.KR)({}),display_barcode_assignment:(0,se.KR)(!1),barcode_field_set:(0,se.KR)({}),doc_fields:(0,se.KR)([])}},beforeRouteLeave:function(e,t,i){return ci(this,void 0,void 0,(function*(){this.setDataToCache(),this.removeBordersFromRectangles(),this.removeAllConnectionLines(),this.removeExistingConfirmationOverlays(),this.removeMagnifier(),this.removeAllNotifications(),this.page=1,this.external_window&&this.external_window.close(),"function"===typeof this.format_warning_dismiss&&this.format_warning_dismiss(),yield this.releaseDocLock({doc_id:this.record.doc_id}),this.resetDocStore(e.fullPath),this.resetStoreOnRouteChange(),i()}))},showDialog1:function(){setTimeout((()=>{this.showDialog=!0}),2e3)},beforeMount:function(){this.renderComponent=!1,this.isExtenedPanel=!1},mounted:function(){this.showLoading(),this.connectWebSocket(),this.init(),this.show_all_menu_btns=!0,this.isDebugFlagHandler(),this.is_admin=(0,mt.N6)();let e=this.$route.params.id;this.getDocAnnotations(e),window.addEventListener("resize",this.windowResize),document.body.addEventListener("click",this.mouseClicked,!0);const t=hi(".img-magnifier-container");t&&t.addEventListener("scroll",this.removeOverlayandLines);const i=hi(".q-splitter__after");i&&i.addEventListener("scroll",this.removeOverlayandLines),document.addEventListener("dispatch_status_bar_message",this.dispatchTaskbarMessage),document.addEventListener("highlight_table_row",this.highlightTableRowArea),document.addEventListener("refresh_canvas",this.refreshCanvas),document.addEventListener("set_splitter_model",this.setSplitterModelWrapper),window.FieldValidationView=this,window.addEventListener("beforeunload",this.unLockDoc)},unmounted:function(){window.removeEventListener("resize",this.windowResize),window.removeEventListener("beforeunload",this.unLockDoc),window.removeEventListener("keydown",this.keydownEvent),document.removeEventListener("dispatch_status_bar_message",this.dispatchTaskbarMessage),document.removeEventListener("highlight_table_row",this.highlightTableRowArea),document.removeEventListener("removeSelectedAreaOnImage",this.removeSelectedAreaOnImage);const e=hi(".img-magnifier-container");e&&e.removeEventListener("scroll",this.removeOverlayandLines);const t=hi(".q-splitter__after");t&&t.removeEventListener("scroll",this.removeOverlayandLines);try{this.screenshot=hi(".screenshot"),this.screenshot&&(this.screenshot.removeEventListener("dblclick",this.dblClickToSelect),this.screenshot.removeEventListener("pointerdown",this.startDrag))}catch(i){}document.removeEventListener("refresh_canvas",this.refreshCanvas),document.removeEventListener("set_splitter_model",this.setSplitterModelWrapper)},methods:{goRouteBack(){this.$router.go(-1)},prepareBarcodeData(){this.record.hasOwnProperty("barcode_mapping")||(this.record.barcode_mapping={}),this.barcode_field_set=JSON.parse(JSON.stringify(this.record.barcode_mapping)),this.doc_fields=[],this.barcode_amount=Object.keys(JSON.parse(JSON.stringify(this.record.barcode_data))).length;let e=JSON.parse(JSON.stringify(this.record.barcode_data)),t=1;for(const[i,o]of Object.entries(e))o.forEach((e=>{this.barcode_data[t]=e,t+=1}));for(let i in this.formBuilderConfigModel){let e=this.formBuilderConfigModel[i];"TextInput"!=e.fieldType&&"AmountFields"!=e.fieldType||e.hasOwnProperty("id")&&(e["value"]=e["field_id"],e["label"]=this.$t(e["field_name"]),this.doc_fields.push(e))}this.display_barcode_assignment=!0},setFieldData(e,t,i){if(null!=this.record.barcode_mapping[i]&&void 0!=this.record.barcode_mapping[i]){let e=this.record.barcode_mapping[i].field_name;this.formBuilderModel[e].formatted_value="",this.$refs.fieldsView.inputValueChanges(e)}null!=t&&void 0!=t&&(this.record.barcode_mapping[i]=t,this.formBuilderModel[t.field_name].formatted_value=e,this.$refs.fieldsView.inputValueChanges(t.field_name))},dispatchTaskbarMessage(e){e.detail.message&&(this.currentDisplayedMessage=e.detail.message)},showNonMappedColumnsDialog(){if(this.isFormBuilderMode||this.isReadOnly)return;const e=new CustomEvent("show_non_mapped_columns_dialog",{});document.dispatchEvent(e)},deleteTable(){if(this.isFormBuilderMode||this.isReadOnly)return;this.record.tables=[];const e=new CustomEvent("delete_table",{});document.dispatchEvent(e)},addColumnInLineItems(){if(this.isFormBuilderMode||this.isReadOnly)return;const e=new CustomEvent("add_ai_new_column",{});document.dispatchEvent(e)},ZoomIn(){this.zoom_value>=.79||(this.zoom_value=this.zoom_value+.1,this.zoom(this.zoom_value))},ZoomOut(){this.zoom_value<=.3||(this.zoom_value=this.zoom_value-.1,this.zoom(this.zoom_value))},toggleSideBar(e){if(this.current_sidebar==e)return this.toggleMenu(),void(this.current_sidebar="");""==this.current_sidebar&&this.toggleMenu(),this.current_sidebar=e},improveDocuments(){return ci(this,void 0,void 0,(function*(){try{if(this.isReadOnly)return;yield re.M8.improve_document_quality(this.docId)}catch(e){return this.hideLoading(),void this.showErrorToast("There was an error improving the document")}}))},init(){return ci(this,void 0,void 0,(function*(){try{if(this.docId=this.$route.params.id,this.setAppType(),yield this.getOrgSettings(),yield this.getInvoiceDataByDocId(this.docId),!this.record||0===Object.keys(this.record).length||!1===this.record.success||this.doc_fetch_error)return void this.hideLoading();this.handleReadOnly(),this.handleDocLockSubscribe(),this.getSplitterValueFromStorage(),this.handleDiplicateInvoiceSettings(),this.isReadOnly?(this.error_message=this.$t("pages.messages.READ_ONLY_MSG"),this.trigger_document_lock=!1):this.trigger_document_lock=!0,this.initPage()}catch(e){}finally{this.hideLoading()}}))},handleDiplicateInvoiceSettings(){return ci(this,void 0,void 0,(function*(){yield this.getDocTypeSettings(),this.isInvoiceDuplicate=this.model[rt.aH.DUPLICATE_DETECTION],this.isInvoiceDuplicate||(this.isInvoiceDuplicate=this.model[rt.aH.DUPLICATE_INVOICE_DETECTION])}))},setInvoiceDuplicateStatus(e){this.isInvoiceDuplicate=e},setTriggerDocumentLock(e){this.trigger_document_lock=e},setCurrentPage(){this.lastPageItem=this.record.images.length},setAppType(){this.$route.params.id||this.goToDashboard(),setTimeout((()=>{this.showDialog=!1}),1e4)},handleDocLockSubscribe(){const e=(0,lt.oI)();e.$subscribe(((e,t)=>{this.isReadOnly=!this.doc_lock.success,this.handleReadOnly()}))},handleReadOnly(){if(rt.B2.includes(this.record.status))return void(this.isReadOnly=!0);const e=oe.tH.hasAccess("update");e||(this.isReadOnly=!0)},getInvoiceDataByDocId(e){return ci(this,void 0,void 0,(function*(){try{if((yield this.setRecordFromCache())&&this.record.doc_id===e)return;this.record=[],this.clearSelectedSessionStorage(),yield this.getDocumentById(e)}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}}))},getConfidence(e){return e?e<1?(100*+e.toFixed(2)).toFixed(0):+e.toFixed(2):""},initPage(){this.handleFormatWarning(),this.docType=this.record.doc_type,this.setImage(),this.initImageArea(),window.addEventListener("keydown",this.keydownEvent),document.addEventListener("removeSelectedAreaOnImage",this.removeSelectedAreaOnImage),this.getAI_IndicatorData(),this.enableOrDisableExportButton(),setTimeout((()=>{this.setCurrentPage()}),200),this.DOC_SCRIPT_MODULE=this.user_settings[this.doc_script_module_setting]},changeContentScroll(e){const t=document.querySelector("#validation_bar_content");var i=t.scrollTop;t.scrollTop=i+e},onScrollUp(){this.changeContentScroll(-110);const e=document.querySelector("#validation_bar_content"),t=e.scrollHeight-e.clientHeight;var i=e.scrollTop;this.showScrollDownButton=i!=t,this.showScrollUpButton=0!=i},onScrollDown(){this.changeContentScroll(110);const e=document.querySelector("#validation_bar_content"),t=e.scrollHeight-e.clientHeight;var i=e.scrollTop;this.showScrollDownButton=i!=t,this.showScrollUpButton=0!=i},openPDfWindoByDefault(){this.user_settings["DUAL_MONITOR_MODE_SETTING"]&&this.isMultiScreen()&&0==this.pdf_in_window&&this.selectBetweenMonitor()},isElementLoaded(e){return ci(this,void 0,void 0,(function*(){while(null===document.querySelector(e))yield new Promise((e=>requestAnimationFrame(e)));return document.querySelector(e)}))},selectBetweenMonitor(){return ci(this,void 0,void 0,(function*(){if(0!=this.pdf_in_window)this.external_window.close(),this.pdf_in_window=!1,this.splitterModel=80,this.prepareRectangles();else if(this.isMultiScreen()){const e=yield re.jD.getUserPreference({key:"MONITOR_PREFERENCE"});if(e){let t=e.slice(-1),i=isNaN(t)?0:+t-1;this.openComponentInSeparateWindow(i)}else this.selectMonitor=!0}else this.showErrorToast(this.$t("pages.messages.MULTI_SCREENS_NOT_FOUND"))}))},openComponentInSeparateWindow(e){this.pdf_in_window=!0,this.selectMonitor=!1,this.splitterModel=0,this.setDataToCache(),this.removeOverlayandLines();let t=this.$router.resolve({path:"/show_pdf/"+this.docId});this.openWindowOnSelectedMonitor(e,t.href)},routeToNextDoc(e){return ci(this,void 0,void 0,(function*(){let t;this.showLoading();try{let e=yield this.makeQueryParamFromFilters(),i=this.docId+"?sort_attr=created_on"+e+"&doc_type="+this.docType;t=yield re.M8.get_next_document(i)}catch(i){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}!0===t.success?!0===t.has_next&&"next"===e?(this.showSuccessToast(this.$t("pages.messages.NEXT_DOC_LOADED")),window.removeEventListener("beforeunload",this.onTabClose),this.resetAllStoreData(),this.$router.push("/field_validation_v1/"+t.next_id)):!0===t.has_previous&&"previous"===e?(this.showSuccessToast(this.$t("pages.messages.PREVIOUS_DOC_LOADED")),window.removeEventListener("beforeunload",this.onTabClose),this.resetAllStoreData(),this.$router.push("/field_validation_v1/"+t.previous_id)):this.showErrorToast(this.$t("pages.messages.NO_NEXT_DOC")):this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}))},onTabClose(e){let t=ge.A.has("event_name")?ge.A.getItem("event_name"):null;t&&"language_change"===t||(e.preventDefault(),e.returnValue="",this.clearSelectedSessionStorage())},keydownEvent(e){try{"Escape"===e.key?(this.removeBordersFromRectangles(),this.removeAllConnectionLines(),this.removeExistingConfirmationOverlays(),this.restrictDrawing(),this.removeMagnifier()):"Enter"===e.key?(this.removeExistingConfirmationOverlays(),this.removeBordersFromRectangles(),this.removeAllConnectionLines(),this.connectionId=""):"ArrowDown"===e.key&&(this.removeExistingConfirmationOverlays(),this.removeBordersFromRectangles(),this.removeAllConnectionLines(),this.$refs["fieldsView"].selectNextField(this.connectionId),setTimeout((()=>{this.enableOrDisableExportButton()}),5),this.connectionId="")}catch(e){}},getAI_IndicatorData(){return ci(this,void 0,void 0,(function*(){try{let e;if(this.ai_fields=this.record&&this.record.fields&&Array.isArray(this.record.fields)?this.record.fields.length:0,!this.record.filter_values||!(this.record.filter_values.length>0)||!Array.isArray(this.record.filter_values))throw"getAI_IndicatorData () no filter_values or doc_type to proceed";let t="?doc_type="+this.record.doc_type+"&filter_values="+this.record.filter_values.join();if(e=yield re.M8.get_ai_score(t),!1===e.success)throw e.message;if(!0===e.success){this.ai_rules=e.rules,this.mean_effective_weight=e.mean_effective_weight;const t=new CustomEvent("FV_gauge_calculation",{detail:e});document.dispatchEvent(t)}}catch(e){}}))},imageclicked(e){this.image=this.baseUrl+"/"+(0,jt.v)(this.record.images[e.target.dataset.id].path),this.page=parseInt(e.target.dataset.id)+1,this.pdf_in_window?this.pdfInChildPage():this.pdfInSamePage()},movePageUp(){this.page!=this.lastPageItem?(this.page++,this.quickActionClicked(this.page)):this.showErrorToast(this.$t("pages.screen2a.page_limit_reached"))},movePageDown(){1!=this.page&&(this.page--,this.quickActionClicked(this.page))},downloadFile(){try{let e=ae.VA+"/resource/document/"+this.docId+"/"+this.docId+".pdf?"+this.tokenQueryParam;if(!e)return;fetch(e).then((e=>e.blob())).then((e=>{const t=URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download=this.record.filename,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)})).catch((e=>{}))}catch(e){}},validatePageNumber(){this.page?(this.page>this.lastPageItem&&(this.page=this.lastPageItem),this.quickActionClicked(this.page)):this.page=1},quickActionClicked(e){!e||0==e||e>this.lastPageItem||(this.image=this.baseUrl+"/"+(0,jt.v)(this.record.images[e-1].path),this.pdf_in_window?this.pdfInChildPage():this.pdfInSamePage())},pdfInSamePage(){this.removeOverlayandLines(),this.getImageDetails()},pdfInChildPage(){this.external_window.PdfView.image=this.image,this.external_window.PdfView.removeOverlayandLines(),this.$nextTick((()=>{this.external_window.PdfView.prepareRectangles()}))},getImageDetails(){if(0==this.renderComponent||0==this.imageLoaded)return;let e=this.screenshot;0==this.screenshot.offsetWidth&&(e=hi("#screenshot2")),this.imageWidth=e.offsetWidth,this.imageHeight=e.offsetHeight,this.viewBox="0 0 "+String(this.imageWidth)+" "+String(this.imageHeight),this.$nextTick((()=>{this.prepareRectangles()})),this.hideLoading(),this.enableOrDisableExportButton()},assignImageDimenions(){let e=hi("#image_container");if(e){e.querySelector(".q-splitter__before");this.imageWidth=e.offsetWidth-90,this.imageHeight=e.offsetHeight-32}this.viewBox="0 0 "+String(this.imageWidth)+" "+String(this.imageHeight)},showConnectionFromRect(e){this.removeBordersFromRectangles(),this.removeAllConnectionLines(),this.removeExistingConfirmationOverlays(),this.restrictDrawing();const t=e.target.getAttribute("connectionId"),i=e.target,o=this.getElementToConnect(hi("#"+t));this.scrollInToViewCenter(o),this.scrollInToViewCenter(i),document.documentElement.scrollTop=0,setTimeout((()=>{if(t.startsWith(rt.Al))return i.classList.add("border"),void this.dsiplayFieldInToView(t);this.showConnection(t,i,o)}),50)},highlightTableRowArea(e){this.showConnectionFromField(e.detail,!0)},showConnectionFromField(e,t=!1){if("annotate"===this.field_view_mode)return void this.showNotification(this.$t("annotation_mode_is_on_warning"));this.pdf_in_window?(this.external_window.PdfView.removeOverlayandLines(),this.external_window.PdfView.restrictDrawing()):(this.removeOverlayandLines(),this.restrictDrawing());let i=this.getElementToConnect(hi("#"+e));if(!i)return;let o=Number(i.getAttribute("pageno"));o=isNaN(o)?this.page:o;let s=!1;o&&o!==this.page&&(s=!0,this.page=o,this.image=this.baseUrl+"/"+(0,jt.v)(this.record.images[this.page-1].path),this.pdf_in_window&&this.sendMessegeToChildWindow("image",this.image,!0),this.getImageDetails(),this.$forceUpdate()),this.connectionId=e,this.$nextTick((()=>{setTimeout((()=>{this.pdf_in_window?this.external_window.PdfView.proceedForReactFinding(e,i,t):this.proceedForReactFinding(e,i,t)}),s?300:100)}))},proceedForReactFinding(e,t,i){let o=hi("#"+e+"_rect");o&&(this.scrollInToViewCenter(o),document.documentElement.scrollTop=0),setTimeout((()=>{i?this.highlightRow(o):o?this.showConnection(e,o,t):this.proceedIfReactNotFound(t)}),50)},proceedIfReactNotFound(e){if("ELECTRONIC_DOCUMENT"===this.record.extraction_method)return;this.componentType=e.getAttribute("child_type");let t="";if("checkbox"===this.componentType)t=e.getAttribute("aria-checked")?"true":"";else{let i=e.querySelector(this.componentType);i&&(t=i.value)}if(""!=t){this.showNotification(this.$t("pages.messages.SELECT_AREA_NO_COORDINATES"));const e=new CustomEvent("dispatch_status_bar_message",{detail:{message:this.$t("pages.messages.SELECT_AREA")}});document.dispatchEvent(e)}else{this.showNotification(this.$t("pages.messages.SELECT_AREA"));const e=new CustomEvent("dispatch_status_bar_message",{detail:{message:this.$t("pages.messages.SELECT_AREA")}});document.dispatchEvent(e)}this.pdf_in_window?(this.external_window.PdfView.enableDrawing(),this.external_window.PdfView.connectionId=this.connectionId):this.enableDrawing()},showConnection(e,t,i){this.pdf_in_window?this.external_window.PdfView.proceedForReactFinding(e,i,!1):t&&i?(this.drawOverlay(e,t),t.classList.add("border"),this.connect(t,i,"#26a69a",2)):alert(this.$t("pages.messages.NO_MAPPING_AVAILABLE"))},saveOverlayResult(){this.cleanRectangles(),this.pdf_in_window?this.external_window.PdfView.redraw():this.redraw(),this.getTextByCoordinates(this.rectCordinate)},connect(e,t,i,o){const s=this.getOffset(e),a=this.getOffset(t),r=s.left,l=s.top+s.height/2,n=a.right,d=a.top+a.height/2,c=Math.sqrt((n-r)*(n-r)+(d-l)*(d-l)),h=(r+n)/2-c/2,u=(l+d)/2-o/2,p=Math.atan2(l-d,r-n)*(180/Math.PI);this.removeAllConnectionLines();const _=document.createElement("div");_.setAttribute("id","connection_line"),_.style.cssText="z-index: 102;padding:0px; margin:0px; height:"+o+"px; background-color:"+i+"; line-height:1px; position:absolute; left:"+h+"px; top:"+u+"px; width:"+c+"px; -moz-transform:rotate("+p+"deg); -webkit-transform:rotate("+p+"deg); -o-transform:rotate("+p+"deg); -ms-transform:rotate("+p+"deg); transform:rotate("+p+"deg);",document.body.appendChild(_)},getTextByCoordinates(e){return ci(this,void 0,void 0,(function*(){const t=this.record;let i,o=new FormData,s=e.startX/this.imageWidth,a=e.startY/this.imageHeight,r=e.endX/this.imageWidth,l=e.endY/this.imageHeight;o.append("x0",s.toString()),o.append("y0",a.toString()),o.append("x1",r.toString()),o.append("y1",l.toString()),o.append("doc_id",t.doc_id),o.append("page",this.page.toString()),o.append("field_name",this.connectionId),this.showLoading();try{i=yield re.M8.get_field_value(o)}catch(d){return void this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}this.textApiResponse=i;const n=i.coords;if(!n||0===n[0].x&&0===n[0].y&&""===i.formatted_value)return this.showErrorToast(this.$t("pages.messages.EMPTY_MAPPING_NOT_ALLOWED")),void(this.pdf_in_window?(this.external_window.PdfView.prepareRectangles(),this.external_window.PdfView.enableDrawing()):(this.prepareRectangles(),this.enableDrawing()));"INVOICE"==this.record.doc_type?this.dontAsk?(this.textApiResponse.multi_line?this.textConfirmationMsg=this.$t("isMultiLineConfirm"):this.textConfirmationMsg=this.$t("isdrawcorrect"),this.textConfirmation=!0):this.saveInstant=!0:this.updateFieldData()}))},updateFieldData(){this.$refs["fieldsView"].updateFieldData(this.textApiResponse),this.saveInstant=!1,this.textApiResponse=null},enableOrDisableExportButton(e){this.enableExportButton=!0,this.fieldErrors={},this.record.fields.forEach(((e,t)=>{this.checkFieldInvalid(e,!1)})),e&&this.printFieldsNeedToBeValidated(this.fieldErrors)},checkFieldInvalid(e,t=!0){if(!1===e.is_valid&&!this.isFieldCalcualtedFromLayout(e.name)&&this.isfieldsNotDisplayed(e.name))return this.enableExportButton=!1,void(this.fieldErrors[e.name]=this.getLabelForFormBuilder(this.formBuilderConfigModel[e.name],"form_builder."));this.fieldErrors.hasOwnProperty(e.name)&&delete this.fieldErrors[e.name],t&&0===(0,Ge.Ns)(this.fieldErrors)&&(this.enableExportButton=!0)},printFieldsNeedToBeValidated(e){},isFieldCalcualtedFromLayout(e){let t=!1;for(const i of this.formLayout)for(const o of i.rows)o.field_name==e&&o.calculation_formula&&(t=!0);return t},isfieldsNotDisplayed(e){let t=!0;return this.fieldsNotDisplayed.hasOwnProperty(e)&&(t=!1),t},setApiData(e){this.record=e,this.$forceUpdate()},windowResize(){this.assignImageDimenions(),setTimeout((()=>{this.removeBordersFromRectangles(),this.removeAllConnectionLines(),this.removeExistingConfirmationOverlays(),this.getImageDetails(),this.removeMagnifier()}),20)},refreshCanvas(){this.prepareRectangles(),this.$forceUpdate(),this.removeBordersFromRectangles(),this.removeAllConnectionLines(),this.removeExistingConfirmationOverlays(),this.getImageDetails(),this.redraw()},refreshCanvasAfterSelection(e){this.refreshCanvas(),this.showConnectionFromField(e)},removeSelectedAreaOnImage(e){this.rectangles.pop(),this.refreshCanvas(),this.restrictDrawing()},handleFormatWarning(){"XML_INVOICE"!=this.record.doc_type&&(this.format_warning_dismiss=this.showRulesNotFoundToast(this.record,window.location.href))},isDebugFlagHandler(){this.is_debug=!1,this.$route.query&&"true"===this.$route.query.is_debug&&(this.is_debug=!0)},viewOCRDocument(){let e=this.$router.resolve({path:"/ocr-document/"+this.docId+"/"+this.page});window.open(e.href,"_blank","location=yes,toolbar=yes,scrollbars=yes,resizable=yes,left=500,width=1500,height=1000")},fieldValidationError(e){let t="REQUIRED";return e&&(t=e),t},hasApiData(){return 0!==(0,Ge.Ns)(this.record)&&!this.doc_fetch_error},removeOldMapiingsAndDrawNew(e){if(this.pdf_in_window)return this.external_window.PdfView.restrictDrawing(),this.external_window.PdfView.record=this.record,void this.external_window.PdfView.prepareRectangles();this.removeBordersFromRectangles(),this.removeAllConnectionLines(),this.removeExistingConfirmationOverlays(),this.restrictDrawing(),this.prepareRectangles();let t=this.getElementToConnect(hi("#"+e)),i=hi("#"+e+"_rect");i&&t&&this.showConnection(e,i,t)},getElementToConnect(e){return this.componentType=e.getAttribute("child_type"),"checkbox"===this.componentType?e.querySelector(".q-checkbox__bg"):e},toggleSplitter(){this.imageFieldSplitter>=50?this.imageFieldSplitter=30:this.imageFieldSplitter=80},setSplitterModelWrapper(e){this.setSplitterModel(e.detail.data)},setSplitterModel(e){this.splitterModel=100,this.setAfterPanelHeight(e)},setAfterPanelHeight(e){e&&this.isElementLoaded("#afterSlot").then((e=>{const t=hi("#afterSlot"),i=hi("#image_scrolle");if(t&&i){let e=t.offsetHeight/i.offsetHeight*100;this.splitterModel=100-e-5,this.openPDfWindoByDefault()}}))},displaySplitDocumentView(){this.isReadOnly||(this.split_document=!0)},onResize(e){this.windowResize()},goToLayoutTemplate(){try{if(!this.doc_loaded)return;const e=Yt.Z.getDetailViewRoute({doc_type_key:this.record.doc_type||"",layout_template_id:this.layout_template_id||"",sub_doc_type_key:this.record.sub_doc_type||""});window.open(e,"_blank").focus()}catch(e){}},toFlowScreen(e){this.$router.push("/doc_flow/"+e)},askLater(){ve.A.set("dontAsk","neverAsk"),ve.A.get("dontAsk")},restartExport(e){return ci(this,void 0,void 0,(function*(){try{return yield re.M8.restart_document(e),!0}catch(t){throw t}}))},getSupplier(){let e="supplier_name",t="";for(let i of this.record.fields)if(i.name===e&&i.formatted_value){t=i.formatted_value;break}return t},goToDashboard(){this.$router.push("/dashboard")},splitterChanged(){this.saveSplitterValueInStorage();const e=new CustomEvent("splitter_changed",{detail:this.splitterModel});document.dispatchEvent(e)},getOverlayHeadings(){const e=hi("#"+this.connectionId);if(!e)return"";const t=e.getAttribute("child_type");if(!t)return"";this.componentType=t;let i="",o="";if("checkbox"===this.componentType)o=e.getAttribute("aria-label"),i="Un-Checked","true"===e.getAttribute("aria-checked")&&(i="Checked");else{const t=hi("."+this.connectionId);o=t.innerHTML;const s=e.querySelector(this.componentType);i=s.value}return i+rt.Tr+o},selectNextField(e){this.$refs["fieldsView"].selectNextField(e),setTimeout((()=>{this.enableOrDisableExportButton()}),5)},initTempFieldDelete(){this.$refs["fieldsView"].initTempFieldDelete()},getFieldByIndex(e){return this.formBuilderModel[e]},getHTMLField(e){const t=hi("#"+e.name);return t&&e.page&&null!=e.page&&e.coords&&t.setAttribute("pageno",e.page),t},initiateMagnifyGlass(){this.pdf_in_window?this.external_window.PdfView.initMagnifyGlass():this.initMagnifyGlass()},sendMessegeToChildWindow(e,t,i){this.external_window.PdfView.getDataFromParent({key:e,value:t,redraw:i})},changeScreenMode(){if(!this.isReadOnly){if("validate"==this.field_view_mode){this.field_view_mode="annotate",hi("#validate-container").classList.add("hidden"),this.screenshot.classList.remove("cursor-crosshair"),this.removeOverlayandLines(),this.screenshot.removeEventListener("dblclick",this.dblClickToSelect),this.screenshot.removeEventListener("pointerdown",this.startDrag),this.screenshot.removeEventListener("pointerdown",this.startDrag),document.body.removeEventListener("click",this.mouseClicked,!0);const e=hi(".img-magnifier-container");e&&e.removeEventListener("scroll",this.removeOverlayandLines);const t=hi(".q-splitter__after");t&&t.removeEventListener("scroll",this.removeOverlayandLines),this.enable_editing=!0}else{hi("#validate-container").classList.remove("hidden"),this.field_view_mode="validate",this.screenshot.addEventListener("dblclick",this.dblClickToSelect),this.screenshot.addEventListener("pointerdown",this.startDrag),this.screenshot.addEventListener("pointerdown",this.startDrag),document.body.addEventListener("click",this.mouseClicked,!0);const e=hi(".img-magnifier-container");e&&e.addEventListener("scroll",this.removeOverlayandLines);const t=hi(".q-splitter__after");t&&t.addEventListener("scroll",this.removeOverlayandLines),this.enable_editing=!1,this.getImageDetails()}this.screenshot.classList.remove("cursor-crosshair")}},enableEditing(){this.enable_editing,this.screenshot.classList.add("cursor-crosshair")},unLockDoc(e){this.releaseDocLock({doc_id:this.record.doc_id})},goToTableExtraction(){this.$router.push("/tbl_ext_v3/"+this.$route.params.id)},restoreDeleteColumn(){if(this.isFormBuilderMode||this.isReadOnly)return;const e=new CustomEvent("restore_delete_column",{});document.dispatchEvent(e)}},setup(){const e=(0,fe.A)(),t=(ve.A.set("dontAsk",""),ve.A.get("dontAsk"),(0,lt.q3)());t.$reset();const{record:i,get_cached_data_id:o,doc_loaded:s,confirmationForPoConnectionReset:a,error:r,notifications:l,layout_template_id:n,show_all_menu_btns:d,has_ai_table:c,fieldErrors:h,enableExportButton:u,page:p,document_version:_,doc_annotations:m,fieldsNotDisplayed:f,script_error_count:g}=(0,ee.bP)(t),{getDocumentById:v,resetDocStore:b,resetAllStoreData:y,setRecordFromCache:w,setDataToCache:k,removeCache:C,getDocAnnotations:F}=t,E=(0,lt.uL)(),{formLayout:L,isExtenedPanel:x,formBuilderModel:M,formBuilderConfigModel:S,renderComponent:T,docType:A}=(0,ee.bP)(E),{getElementWidth:D,isFieldHidden:I}=E;let O=[],R=[],B=(0,se.KR)(!1),P=(0,se.KR)(!1),V=(0,se.KR)(!1);const N=(0,lt.oI)(),{releaseDocLock:q}=N,{doc_lock:$}=(0,ee.bP)(N),U=(0,lt.XB)(),{isConfirmationBoxDisable:W}=(0,ee.bP)(U),{resetStoreOnRouteChange:K}=U,z=(0,lt.fX)(),{makeQueryParamFromFilters:Q}=z,X=(0,lt.Bu)(),{user_settings:j}=(0,ee.bP)(X),{getOrgSettings:H}=X,G=(0,lt._6)(),{tokenQueryParam:J}=(0,ee.bP)(G);G.getTokenQueryParam();const Y=(0,lt.G6)(),{connect:Z}=Y,te=(0,lt.wt)(),{model:ie}=(0,ee.bP)(te),{getDocTypeSettings:oe}=te;let re=[],le={startX:0,startY:0,endX:0,endY:0};const ne={x:0,y:0,width:0,height:0,connectionId:""};let de=0,ce=0,he=hi(".screenshot"),ue=hi("#marquee"),pe=(hi("#foreignObject"),hi("#boxes")),_e=hi(".areas");return{getDocTypeSettings:oe,resetAllStoreData:y,resetDocStore:b,isFieldHidden:I,doc_annotations:m,connectWebSocket:Z,show_all_menu_btns:d,get_cached_data_id:o,has_ai_table:c,doc_loaded:s,removeCache:C,setDataToCache:k,releaseDocLock:q,getDocumentById:v,setRecordFromCache:w,resetStoreOnRouteChange:K,isConfirmationBoxDisable:W,fields_pending_load_count:(0,se.KR)(0),fields_loaded_count:(0,se.KR)(0),notifications:l,record:i,docType:A,confirmationForPoConnectionReset:a,doc_fetch_error:(0,se.KR)(r),doc_lock:$,page:p,showTooltip:B,showTooltipWithHide:P,showTooltipWithClose:V,tableRows:O,fieldsNotDisplayed:f,image:(0,se.KR)(""),current_sidebar:(0,se.KR)(""),layout:R,images:(0,se.KR)({}),baseUrl:ae.VA,isReadOnly:(0,se.KR)(!1),componentType:"input",lastPageItem:(0,se.KR)(0),lineitem_count:0,lineitem_error:(0,se.KR)(!1),is_debug:(0,se.KR)(!1),tb_version:"default",document_version:_,showScrollDownButton:(0,se.KR)(!1),showScrollUpButton:(0,se.KR)(!1),splitterModel:(0,se.KR)(60),imageFieldSplitter:(0,se.KR)(76),showNotification(t){e.notify({message:t,color:"primary",position:"top"})},doc_type_list:R,ai_rules:(0,se.KR)(0),ai_fields:(0,se.KR)(0),mean_effective_weight:(0,se.KR)(0),textConfirmationMsg:(0,se.KR)(""),formLayout:L,isExtenedPanel:x,renderComponent:T,enableExportButton:u,getElementWidth:D,imageHeight:(0,se.KR)(0),imageWidth:(0,se.KR)(0),viewBox:(0,se.KR)("0 0 0 0"),textApiResponse:(0,se.KR)(),connectionId:(0,se.KR)(""),is_admin:(0,se.KR)(!1),layout_template_id:n,pdf_in_window:!1,external_window:(0,se.KR)(),makeQueryParamFromFilters:Q,rectangles:re,rectCordinate:le,marqueeRect:ne,startX:de,startY:ce,screenshot:he,marquee:ue,boxes:pe,areas:_e,formBuilderModel:M,formBuilderConfigModel:S,user_settings:j,getOrgSettings:H,getDocAnnotations:F,tokenQueryParam:J,screen_mode:(0,se.KR)(!1),field_view_mode:(0,se.KR)("validate"),enable_editing:(0,se.KR)(!1),fieldErrors:h,selectFont:(0,se.KR)("Helvetica"),selectFontSize:(0,se.KR)(12),selectColor:(0,se.KR)("#000000"),DOC_SCRIPT_MODULE:(0,se.KR)(!1),display_doc_script_logs:(0,se.KR)(!1),script_error_count:g,model:ie}}});var pi=i(98072),_i=i(1096),mi=i(76056),fi=i(93676),gi=i(94940),vi=i(57092),bi=i(23954),yi=i(1444);const wi=(0,wt.A)(ui,[["render",Z],["__scopeId","data-v-27871c44"]]),ki=wi;Ut()(ui,"components",{QIcon:Et.A,QSplitter:pi.A,QBtn:kt.A,QResizeObserver:_i.A,QSeparator:Ft.A,QTooltip:Ct.A,QInput:Lt.A,QDrawer:mi.A,QDialog:xt.A,QCard:Mt.A,QCardSection:At.A,QSpace:fi.A,QToolbar:St.A,QToolbarTitle:Tt.A,QCardActions:It.A,QSelect:gi.A,QFooter:vi.A,QBadge:bi.A,QSlider:yi.A,QCheckbox:Vt.A,QField:Pt.A,QTable:Nt.A}),Ut()(ui,"directives",{ClosePopup:qt.A})}}]);