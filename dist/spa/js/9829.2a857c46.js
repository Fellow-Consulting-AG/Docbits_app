"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[9829],{29829:(e,t,o)=>{o.r(t),o.d(t,{default:()=>xi});var a=o(61758),i=o(58790),s=o(29104);const l=e=>((0,a.Qi)("data-v-0a9bc945"),e=e(),(0,a.jt)(),e),r={class:"row q-pl-md q-pr-md highlighted-back"},n={class:"width-100-percent"},d={style:{"vertical-align":"middle","margin-left":"10px","font-size":"20px",cursor:"pointer"}},c={key:1,class:"q-btn invisible",style:{"min-height":"1.572em"}},u={class:"align-right2"},h={class:"mode-banner"},m={key:0,class:"table-mode mode-on"},g={key:1,class:"column-mode mode-on"},_={key:2,class:"table-row-mode mode-on"},p={key:1,class:"row q-pl-md q-pr-md"},b={key:2,class:"text-center text-h3 q-pl-xl q-pr-md"},f={style:{"padding-left":"5px"}},v={key:3,class:"row q-pl-md q-pr-md"},w={class:"width-120 q-mt-sm",id:"left_section",ref:"left_section"},y={class:"full-width back-white full-height"},k={class:"row justify-center q-pl-md q-pr-md q-pt-md"},C={class:"secondary-c-text text-h6 text-weight-bold"},x={class:"full-width left-scroll-area-height scrolle-y q-pa-sm"},A=["data-id","src"],E={class:"right_section_2a q-pl-sm",id:"right_section",ref:"right_section"},S={class:"row"},F={class:"full-width"},L={class:"image_control_panel"},D={class:"row"},I={class:"panel-left col-sm-6 col-md-6 col-lg-6"},T={class:"row"},R={class:"panel-middle col-sm-1 col-md-1 col-lg-1 mt-8"},O={class:"page-numbers"},P={class:"panel-right col-sm-5 col-md-5 col-lg-5"},$=l((()=>(0,a.Lk)("img",{src:"images/edit.svg",width:"20"},null,-1))),q=l((()=>(0,a.Lk)("img",{src:"images/cancel.svg",width:"20"},null,-1))),V=l((()=>(0,a.Lk)("img",{src:"images/save.svg",width:"20"},null,-1))),M=l((()=>(0,a.Lk)("img",{src:"images/magic_wand.svg",width:"25",class:"icon-grey-svg"},null,-1))),N=l((()=>(0,a.Lk)("img",{src:"images/restore_ext_cols.svg",width:"26"},null,-1))),X=l((()=>(0,a.Lk)("img",{src:"images/all-columns.svg",width:"28"},null,-1))),W=l((()=>(0,a.Lk)("img",{src:"images/column.svg",width:"24"},null,-1))),Q=l((()=>(0,a.Lk)("img",{src:"images/blocked_column2.svg",width:"24"},null,-1))),z=l((()=>(0,a.Lk)("img",{src:"images/trash-bin-default.svg",width:"21"},null,-1))),K=l((()=>(0,a.Lk)("img",{width:"24",height:"24",src:"images/zoom_in.svg"},null,-1))),U=l((()=>(0,a.Lk)("img",{width:"24",height:"24",src:"images/zoom_out.svg"},null,-1))),j=l((()=>(0,a.Lk)("img",{width:"24",height:"24",src:"images/ocr_icon.svg"},null,-1))),B={class:"float-right"},H={class:"full-width table-extraction-view scroll-area-height-img-tbl-ext scrolle-y",id:"image_container"},Y={class:"full-width"},J={class:"image_control_panel"},G={class:"row"},Z={class:"col-sm-12 col-md-12 col-lg-12"},ee={style:{display:"inline-table",position:"relative",top:"-1px"}},te={class:"text-center"},oe=l((()=>(0,a.Lk)("br",null,null,-1))),ae={class:"ai-indicator"},ie={class:"text-center"},se=l((()=>(0,a.Lk)("br",null,null,-1))),le={class:"ai-indicator"},re={key:0,class:"text-center"},ne=l((()=>(0,a.Lk)("span",null," Training Mode ",-1))),de=l((()=>(0,a.Lk)("br",null,null,-1))),ce={class:"switch-training-mode"},ue=l((()=>(0,a.Lk)("span",{class:"slider"},null,-1))),he={class:"float-right p-t-0"},me={class:"mode-toggle"},ge=l((()=>(0,a.Lk)("img",{src:"images/refresh_dark.svg",width:"22"},null,-1))),_e=l((()=>(0,a.Lk)("img",{src:"images/settings_dark.svg",width:"24"},null,-1))),pe=l((()=>(0,a.Lk)("img",{src:"images/column.svg",width:"24"},null,-1))),be=l((()=>(0,a.Lk)("img",{src:"images/blocked_column2.svg",width:"24"},null,-1))),fe=l((()=>(0,a.Lk)("img",{src:"images/plus_circle_black.svg",width:"24"},null,-1))),ve=l((()=>(0,a.Lk)("img",{src:"images/trash-bin-default.svg",width:"22"},null,-1))),we={key:0},ye={class:"full-width",id:"change-locale"},ke=["innerHTML"],Ce={class:"full-width back-white",id:"table"},xe={key:0,class:"row q-pt-xl full-width",style:{display:"flex"}},Ae={class:"q-ml-sm",style:{width:"30%"}},Ee={style:{width:"50%"},class:"q-ml-sm"},Se={style:{width:"82%"},class:"q-ml-sm q-mt-sm"},Fe={class:"q-ml-sm"},Le={class:"row q-mb-md"};function De(e,t,o,l,De,Ie){const Te=(0,a.g2)("DocumentLock"),Re=(0,a.g2)("MessageBanner"),Oe=(0,a.g2)("q-icon"),Pe=(0,a.g2)("q-btn"),$e=(0,a.g2)("ErrorDocumentView"),qe=(0,a.g2)("q-tooltip"),Ve=(0,a.g2)("autoTesting"),Me=(0,a.g2)("MultiSelectAreasImageTblV3"),Ne=(0,a.g2)("AIDialGauge"),Xe=(0,a.g2)("q-toggle"),We=(0,a.g2)("IgnoreTableValidation"),Qe=(0,a.g2)("scriptBtn"),ze=(0,a.g2)("Classification"),Ke=(0,a.g2)("q-item-label"),Ue=(0,a.g2)("q-item-section"),je=(0,a.g2)("q-item"),Be=(0,a.g2)("q-select"),He=(0,a.g2)("LineItemsTblExtV3"),Ye=(0,a.g2)("DeleteRulesBtn"),Je=(0,a.g2)("invoice-save-export"),Ge=(0,a.g2)("q-splitter"),Ze=(0,a.g2)("q-avatar"),et=(0,a.g2)("q-card-section"),tt=(0,a.g2)("f-btn"),ot=(0,a.g2)("q-card-actions"),at=(0,a.g2)("q-card"),it=(0,a.g2)("q-dialog"),st=(0,a.g2)("q-space"),lt=(0,a.g2)("Loader"),rt=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(Te,{document_version:e.document_version,trigger_document_lock:e.trigger_document_lock},null,8,["document_version","trigger_document_lock"]),""!==e.error_message?((0,a.uX)(),(0,a.Wv)(Re,{key:0,back_route:!0,message:e.error_message,messageCategoryClass:e.error_class},null,8,["message","messageCategoryClass"])):(0,a.Q3)("",!0),(0,a.Lk)("div",r,[(0,a.Lk)("div",n,[!1===e.table_train?((0,a.uX)(),(0,a.Wv)(Pe,{key:0,flat:"",rounded:"",color:"primary",class:"secondary-c-text",onClick:e.back},{default:(0,a.k6)((()=>[(0,a.bF)(Oe,{name:"fa-solid fa-circle-arrow-left",size:"sm"}),(0,a.Lk)("label",d,(0,i.v_)(e.$t("back")),1)])),_:1},8,["onClick"])):((0,a.uX)(),(0,a.CE)("div",c)),(0,a.Lk)("span",u,[(0,a.Lk)("span",h,[e.enableEditing?((0,a.uX)(),(0,a.CE)("span",m,(0,i.v_)(e.$t("table_mode")),1)):(0,a.Q3)("",!0),e.enableColumnEditing?((0,a.uX)(),(0,a.CE)("span",g,(0,i.v_)(e.$t("column_mode")),1)):(0,a.Q3)("",!0),e.isRowMode?((0,a.uX)(),(0,a.CE)("span",_,(0,i.v_)(e.$t("row_mode_on")),1)):(0,a.Q3)("",!0)]),(0,a.bF)(Pe,{flat:"",rounded:"",class:"helpbtn",color:"primary",icon:"help",onClick:t[0]||(t[0]=t=>e.goHelp()),label:e.$t("help"),target:"_blank"},null,8,["label"])])])]),e.doc_fetch_error?((0,a.uX)(),(0,a.CE)("div",p,[(0,a.bF)($e)])):e.account_block?((0,a.uX)(),(0,a.CE)("div",b,[(0,a.bF)(Oe,{class:"text-blue",style:{"font-size":"32px"},name:"info"}),(0,a.Lk)("span",f,(0,i.v_)(e.$t("block_supplier_warning")),1)])):((0,a.uX)(),(0,a.CE)("div",v,[(0,a.Lk)("div",w,[(0,a.Lk)("div",y,[(0,a.Lk)("div",k,[(0,a.Lk)("span",C,(0,i.v_)(e.$t("form_builder.pages")),1)]),(0,a.Lk)("div",x,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.images,((o,s)=>((0,a.uX)(),(0,a.CE)("img",{"data-id":s,key:s,src:e.baseUrl+"/"+o.path+"?"+e.tokenQueryParam,class:(0,i.C4)(["q-pa-sm shadow-5 full-width q-ma-sm cursor-pointer",s===this.page-1?"active":""]),style:{height:"auto"},onClick:t[1]||(t[1]=(...t)=>e.imageClicked&&e.imageClicked(...t))},null,10,A)))),128))])])],512),(0,a.Lk)("div",E,[(0,a.Lk)("div",S,[(0,a.bF)(Ge,{modelValue:e.splitterModel,"onUpdate:modelValue":[t[22]||(t[22]=t=>e.splitterModel=t),t[23]||(t[23]=t=>e.windowResize())],limits:[30,100],class:"scroll-area-height-table full-width"},{before:(0,a.k6)((()=>[(0,a.Lk)("div",F,[(0,a.Lk)("div",L,[(0,a.Lk)("div",D,[(0,a.Lk)("div",I,[(0,a.Lk)("div",T,(0,i.v_)(e.record.filename),1)]),(0,a.Lk)("div",R,[(0,a.Lk)("span",O,(0,i.v_)(e.currentPage())+"/"+(0,i.v_)(e.images.length),1)]),(0,a.Lk)("div",P,[e.training_mode?((0,a.uX)(),(0,a.Wv)(Pe,{key:0,flat:"",class:"p-4 float-right",onClick:t[2]||(t[2]=t=>{t.stopPropagation(),e.enableDrawing()})},{default:(0,a.k6)((()=>[$,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("edit")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0),e.enableEditing&&e.training_mode?((0,a.uX)(),(0,a.Wv)(Pe,{key:1,flat:"",class:"p-4 float-right",onClick:t[3]||(t[3]=t=>{t.stopPropagation(),e.restrictDrawing()})},{default:(0,a.k6)((()=>[q,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("cancel_edit")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0),(e.enableEditing||e.enableColumnEditing)&&e.training_mode?((0,a.uX)(),(0,a.Wv)(Pe,{key:2,flat:"",class:"p-4 float-right",onClick:t[4]||(t[4]=t=>{t.stopPropagation(),e.saveTableCoordinates()})},{default:(0,a.k6)((()=>[V,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("save")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0),e.training_mode?((0,a.uX)(),(0,a.Wv)(Pe,{key:3,flat:"",class:"p-4 float-right",onClick:e.autoDetectTables},{default:(0,a.k6)((()=>[M,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("autodetect_tables")),1)])),_:1})])),_:1},8,["onClick"])):(0,a.Q3)("",!0),e.training_mode&&e.extracted_columns&&0!==Object.keys(e.extracted_columns).length?((0,a.uX)(),(0,a.Wv)(Pe,{key:4,flat:"",class:"p-4 float-right",onClick:t[5]||(t[5]=t=>e.toggleExtractedColumnMode(!0))},{default:(0,a.k6)((()=>[N,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("restore_extracted_columns")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0),e.enableColumnEditing&&e.training_mode?((0,a.uX)(),(0,a.Wv)(Pe,{key:5,flat:"",class:"p-4 float-right",onClick:e.addColumnForAll},{default:(0,a.k6)((()=>[X,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("use_same_column_for_all")),1)])),_:1})])),_:1},8,["onClick"])):(0,a.Q3)("",!0),e.training_mode?((0,a.uX)(),(0,a.Wv)(Pe,{key:6,flat:"",class:"p-4 float-right",onClick:e.addColumn},{default:(0,a.k6)((()=>[W,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("add_column")),1)])),_:1})])),_:1},8,["onClick"])):(0,a.Q3)("",!0),e.isColumnSelectedForDelete()&&e.training_mode?((0,a.uX)(),(0,a.Wv)(Pe,{key:7,flat:"",class:"p-4 float-right",onClick:e.removeSelectedColumn},{default:(0,a.k6)((()=>[Q,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("delete_selected_column")),1)])),_:1})])),_:1},8,["onClick"])):(0,a.Q3)("",!0),e.enableColumnEditing&&e.training_mode?((0,a.uX)(),(0,a.Wv)(Pe,{key:8,flat:"",class:"p-4 float-right highlight-text",onClick:t[6]||(t[6]=t=>{t.stopPropagation(),e.removeAllColumns()})},{default:(0,a.k6)((()=>[z,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("remove_all_columns")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0),(0,a.bF)(Pe,{flat:"",class:"p-4 float-right",onClick:e.zoomIn},{default:(0,a.k6)((()=>[K,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("zoom_in")),1)])),_:1})])),_:1},8,["onClick"]),(0,a.bF)(Pe,{flat:"",class:"p-4 float-right",onClick:e.zoomOut},{default:(0,a.k6)((()=>[U,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("zoom_out")),1)])),_:1})])),_:1},8,["onClick"]),!1!==e.table_train||e.isReadOnly?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(Pe,{key:9,flat:"",class:"float-right pr-6 pl-6",onClick:e.viewOCRDocument},{default:(0,a.k6)((()=>[j,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("ocr_view")),1)])),_:1})])),_:1},8,["onClick"])),(0,a.Lk)("span",B,[(0,a.bF)(Ve,{onSetApiData:e.setApiData},null,8,["onSetApiData"])])])])])]),(0,a.Lk)("div",H,[(0,a.bF)(Pe,{id:"menu_btn",round:"",icon:"chevron_left",size:"xs",class:"text-grey-6 toggler-right m-t-5",onClick:t[7]||(t[7]=t=>e.toggler())}),(0,a.bF)(Me,{"pos-correction":!1,width:e.imageWidth,cropUrl:e.image+"?"+this.tokenQueryParam,enableEditing:e.enableEditing,tableAreas:e.tableAreasStr,isRowMode:e.isRowMode,onSaveColumnCoords:e.saveColumnCoords,onToggleExtractedColumnMode:e.toggleExtractedColumnMode},null,8,["width","cropUrl","enableEditing","tableAreas","isRowMode","onSaveColumnCoords","onToggleExtractedColumnMode"])])])),after:(0,a.k6)((()=>[(0,a.Lk)("div",Y,[(0,a.Lk)("div",J,[(0,a.Lk)("div",G,[(0,a.Lk)("div",Z,[(0,a.bF)(Ne),(0,a.Lk)("table",ee,[(0,a.Lk)("tr",null,[(0,a.Lk)("td",te,[(0,a.Lk)("span",null,(0,i.v_)(e.$t("ai_tables")),1),oe,(0,a.Lk)("span",ae,(0,i.v_)(e.ai_tables),1)]),(0,a.Lk)("td",ie,[(0,a.Lk)("span",null,(0,i.v_)(e.$t("ai_rules")),1),se,(0,a.Lk)("span",le,(0,i.v_)(e.ai_rules),1)]),e.isReadOnly||!1===e.extractable?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("td",re,[ne,de,(0,a.Lk)("label",ce,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=t=>e.training_mode=t)},null,512),[[s.lH,e.training_mode]]),ue])]))])]),(0,a.Lk)("span",he,[(0,a.Lk)("span",me,[this.record.tables&&null!=this.record.tables&&e.training_mode?((0,a.uX)(),(0,a.Wv)(Xe,{key:0,modelValue:e.isRowMode,"onUpdate:modelValue":[t[9]||(t[9]=t=>e.isRowMode=t),t[10]||(t[10]=t=>e.setRowMode())],color:"primary"},{default:(0,a.k6)((()=>[(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("row_mode")),1)])),_:1})])),_:1},8,["modelValue"])):(0,a.Q3)("",!0)]),this.record.tables&&null!=this.record.tables&&e.training_mode?((0,a.uX)(),(0,a.Wv)(Pe,{key:0,flat:"",class:"p-4",color:"grey-8",onClick:t[11]||(t[11]=t=>{t.stopPropagation(),e.revertChanges()})},{default:(0,a.k6)((()=>[ge,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("revert_changes")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0),this.record.tables&&null!=this.record.tables&&e.training_mode?((0,a.uX)(),(0,a.Wv)(Pe,{key:1,flat:"",class:"p-4",onClick:t[12]||(t[12]=t=>{t.stopPropagation(),e.openLineItemAdvanceSettings()})},{default:(0,a.k6)((()=>[_e,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("table_settings")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0),(0,a.bF)(We),e.training_mode||!this.record.tables||null==this.record.tables||e.isReadOnly?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(Pe,{key:2,flat:"",dense:"",icon:"repartition",class:"icon-grey validation-footer-table-button",onClick:t[13]||(t[13]=t=>e.restoreDeleteColumn())},{default:(0,a.k6)((()=>[(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("restore_table_column")),1)])),_:1})])),_:1})),(0,a.bF)(Qe),this.record.tables&&null!=this.record.tables&&e.training_mode?((0,a.uX)(),(0,a.Wv)(Pe,{key:3,flat:"",class:"p-4",color:"primary",onClick:t[14]||(t[14]=t=>{t.stopPropagation(),e.addColumnInLineItems()})},{default:(0,a.k6)((()=>[pe,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("add_new_table_column")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0),this.record.tables&&null!=this.record.tables&&!e.isReadOnly?((0,a.uX)(),(0,a.Wv)(Pe,{key:4,flat:"",class:"p-4",color:"grey-6",onClick:t[15]||(t[15]=t=>e.disabledCustomColumnsDialog())},{default:(0,a.k6)((()=>[be,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("diabled_custom_columns")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0),e.training_mode||!this.record.tables||null==this.record.tables||e.isReadOnly?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(Pe,{key:5,flat:"",class:"p-4",color:"grey-6",onClick:t[16]||(t[16]=t=>e.addNewLineItem())},{default:(0,a.k6)((()=>[fe,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("add_row")),1)])),_:1})])),_:1})),e.training_mode?((0,a.uX)(),(0,a.Wv)(Pe,{key:6,flat:"",class:"p-4",color:"primary",onClick:t[17]||(t[17]=t=>{t.stopPropagation(),e.deleteAllExtractedData()})},{default:(0,a.k6)((()=>[ve,(0,a.bF)(qe,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("delete_all_data")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0),!1===e.table_train&&e.isOcrButtonEnabled()?((0,a.uX)(),(0,a.Wv)(ze,{key:7,show_btn:!e.isReadOnly,force_ocr:!0,language_origin:this.record.doc_origin,doctype:this.record.doc_type},null,8,["show_btn","language_origin","doctype"])):(0,a.Q3)("",!0)])]),!0===e.is_debug?((0,a.uX)(),(0,a.CE)("div",we,(0,i.v_)(e.record.filter_values&&Array.isArray(e.record.filter_values)&&e.record.filter_values.length>0?"FILTER VALUES: "+e.record.filter_values.join():"FILTER VALUES:  NOT FOUND"),1)):(0,a.Q3)("",!0)])])]),(0,a.Lk)("div",ye,[!0===e.table_train?((0,a.uX)(),(0,a.Wv)(Be,{key:0,modelValue:e.languageOrigin,"onUpdate:modelValue":[t[18]||(t[18]=t=>e.languageOrigin=t),t[19]||(t[19]=t=>{e.changeOriginConfirmDialog=!0})],class:"q-pl-sm",options:e.language_origin_list,"emit-value":"","map-options":"",label:e.$t("update_amount_date_format"),disable:e.isReadOnly},{option:(0,a.k6)((e=>[(0,a.bF)(je,(0,i._B)((0,a.Ng)(e.itemProps)),{default:(0,a.k6)((()=>[(0,a.bF)(Ue,null,{default:(0,a.k6)((()=>[(0,a.bF)(Ke,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.opt.label),1)])),_:2},1024),e.opt.description?((0,a.uX)(),(0,a.Wv)(qe,{key:0},{default:(0,a.k6)((()=>[(0,a.Lk)("span",{innerHTML:e.opt.description},null,8,ke)])),_:2},1024)):(0,a.Q3)("",!0)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options","label","disable"])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",Ce,[(0,a.bF)(He,{apiDataProp:e.record,extractedData:e.extractedData,currentPageNo:e.page,isRowMode:e.isRowMode,isReadOnly:e.isReadOnly,onUpdateExtractionDataForSave:e.updateExtractionDataForSave,onLoadNewPageImage:e.loadNewPageImage,onSetTableRowCorrdinates:e.setTableRowCorrdinates,training_mode:e.training_mode},null,8,["apiDataProp","extractedData","currentPageNo","isRowMode","isReadOnly","onUpdateExtractionDataForSave","onLoadNewPageImage","onSetTableRowCorrdinates","training_mode"]),!0===e.table_train?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[e.isReadOnly?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",xe,[(0,a.Lk)("div",Ae,[(0,a.bF)(Pe,{color:"primary",label:e.$t("save"),class:"full-width",onClick:t[20]||(t[20]=t=>e.saveDataForV3())},null,8,["label"])]),(0,a.Lk)("div",Ee,[(0,a.bF)(Pe,{color:"primary",label:e.$t("save_re_extract"),class:"full-width",onClick:t[21]||(t[21]=t=>e.saveDataForV3(!0))},null,8,["label"])]),(0,a.Lk)("div",Se,[(0,a.bF)(Ye,{docId:e.record.doc_id,onAutoDetectTables:e.autoDetectTables,token:e.token},null,8,["docId","onAutoDetectTables","token"])])]))],64)):((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[e.isReadOnly?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(Je,{key:0,enableExportButton:e.enableExportButton,onSetApiData:e.setFieldsData,onAutoDetectTables:e.autoDetectTables},null,8,["enableExportButton","onSetApiData","onAutoDetectTables"]))],64))])])),_:1},8,["modelValue"])])],512)])),(0,a.bF)(it,{modelValue:e.changeOriginConfirmDialog,"onUpdate:modelValue":t[26]||(t[26]=t=>e.changeOriginConfirmDialog=t),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(at,null,{default:(0,a.k6)((()=>[(0,a.bF)(et,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,a.k6)((()=>[(0,a.bF)(Ze,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,a.bF)(et,{class:"row items-center"},{default:(0,a.k6)((()=>[(0,a.Lk)("span",Fe,(0,i.v_)(e.$t("split_text_confirm")),1)])),_:1}),(0,a.bF)(ot,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(tt,{appearance:"cancel",label:e.$t("cancel"),onClick:t[24]||(t[24]=t=>e.setLanguage())},null,8,["label"]),[[rt]]),(0,a.bF)(tt,{label:e.$t("proceed"),class:"q-mr-sm",onClick:t[25]||(t[25]=t=>e.changeOrigin())},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(it,{modelValue:e.ai_table_warning,"onUpdate:modelValue":t[29]||(t[29]=t=>e.ai_table_warning=t),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(at,null,{default:(0,a.k6)((()=>[(0,a.bF)(et,{class:"row items-center q-pb-none"},{default:(0,a.k6)((()=>[(0,a.bF)(Oe,{name:"warning",size:"md",color:"warning","text-color":"white"}),(0,a.bF)(st)])),_:1}),(0,a.bF)(et,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("ai_table_override_warning")),1)])),_:1}),(0,a.Lk)("div",Le,[(0,a.bF)(st),(0,a.bF)(Pe,{flat:"",color:"grey",label:e.$t("back"),onClick:t[27]||(t[27]=t=>e.back())},null,8,["label"]),(0,a.bF)(Pe,{flat:"",color:"primary",label:e.$t("continue"),onClick:t[28]||(t[28]=t=>e.doManualTraining())},null,8,["label"])])])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(lt)],64)}var Ie=o(82303),Te=o(46162),Re=o(1659),Oe=o(6044),Pe=o(24622),$e=o(45938),qe=o(38734),Ve=o(8420),Me=o(64233),Ne=o(18505);const Xe={key:1,class:"row q-pt-xl full-width",style:{display:"flex"}},We={key:0,class:"col-sm-12 col-md-12 col-lg-12 q-pb-sm q-pl-sm"},Qe={class:"col-sm-12 col-md-4 col-lg-4 q-pb-sm q-pl-sm"},ze={class:"col-sm-12 col-md-4 col-lg-4 q-pl-sm q-pb-sm"},Ke={class:"col-sm-12 col-md-4 col-lg-4 q-pl-sm q-pb-sm"},Ue={key:2,class:"col-sm-12 col-md-5 col-lg-5 q-pb-sm q-pl-sm"},je=(0,a.Lk)("br",null,null,-1),Be=(0,a.Lk)("br",null,null,-1),He={class:"q-ml-sm"},Ye={class:"q-ml-sm"},Je={class:"q-ml-sm"},Ge=(0,a.Lk)("span",{class:"q-ml-sm"},"You have made some changes related to line Item/PO on saving you may lost PO connections",-1),Ze=(0,a.Lk)("span",{class:"q-ml-sm"},"You have Some Unmapped PO. Do you still want to continue with export?",-1),et={class:"q-ml-sm"},tt=(0,a.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1);function ot(e,t,o,s,l,r){const n=(0,a.g2)("q-tooltip"),d=(0,a.g2)("q-btn"),c=(0,a.g2)("q-item-label"),u=(0,a.g2)("q-item-section"),h=(0,a.g2)("q-item"),m=(0,a.g2)("q-list"),g=(0,a.g2)("q-btn-dropdown"),_=(0,a.g2)("f-btn"),p=(0,a.g2)("DeleteRulesBtn"),b=(0,a.g2)("export-dialog"),f=(0,a.g2)("q-dialog"),v=(0,a.g2)("q-avatar"),w=(0,a.g2)("q-card-section"),y=(0,a.g2)("q-card-actions"),k=(0,a.g2)("q-card"),C=(0,a.g2)("q-toolbar-title"),x=(0,a.g2)("q-toolbar"),A=(0,a.g2)("q-inner-loading"),E=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)(a.FK,null,[e.isPOView?((0,a.uX)(),(0,a.Wv)(d,{key:0,round:"",color:"amber-9",padding:"xs",id:"export_po_btn",onClick:t[0]||(t[0]=t=>e.confirmAndExport()),icon:"import_export",class:"q-ma-sm po_iterateable_item"},{default:(0,a.k6)((()=>[(0,a.bF)(n,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("confirm_export")),1)])),_:1})])),_:1})):((0,a.uX)(),(0,a.CE)("div",Xe,[e.isValidationView?((0,a.uX)(),(0,a.CE)("div",We,[(0,a.bF)(g,{split:"",class:"glossy full-width",color:"primary",label:e.$t("save"),onClick:t[3]||(t[3]=t=>e.confirmationForSave(!1))},{default:(0,a.k6)((()=>[(0,a.bF)(m,{class:"text-center"},{default:(0,a.k6)((()=>[(0,a.bo)(((0,a.uX)(),(0,a.Wv)(h,{clickable:"",onClick:t[1]||(t[1]=t=>{e.confirmRuleSave=!0}),class:"border-bottom-bdbdbd min-height-38"},{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("form_builder.saveRules")),1)])),_:1})])),_:1})])),_:1})),[[E]]),(0,a.bo)(((0,a.uX)(),(0,a.Wv)(h,{clickable:"",onClick:t[2]||(t[2]=t=>e.confirmationForSave(!0)),class:"border-bottom-bdbdbd min-height-38"},{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("save_and_close")),1)])),_:1})])),_:1})])),_:1})),[[E]])])),_:1})])),_:1},8,["label"])])):((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.Lk)("div",Qe,[(0,a.bF)(_,{label:e.$t("pages.import.save"),class:"full-width",onClick:t[4]||(t[4]=t=>e.confirmationForSave(!1))},null,8,["label"])]),(0,a.Lk)("div",ze,[(0,a.bF)(_,{label:e.$t("form_builder.saveRules"),class:(0,i.C4)((e.is_line_item_validated?"":"btn-disabled")+" full-width"),onClick:t[5]||(t[5]=t=>e.confirmationRuleSave())},{default:(0,a.k6)((()=>[e.is_line_item_validated?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(n,{key:0},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("missing_mapping_warning")),1)])),_:1}))])),_:1},8,["label","class"])]),(0,a.Lk)("div",Ke,[(0,a.bF)(p,{docId:e.docId,onAutoDetectTables:e.autoDetectTables},null,8,["docId","onAutoDetectTables"])])],64)),e.po_enable?((0,a.uX)(),(0,a.CE)("div",Ue,[(0,a.bF)(_,{label:e.$t("po_matching"),class:"full-width",onClick:t[6]||(t[6]=t=>{e.isPoView=!0,e.confirmationForSave()})},null,8,["label"])])):(0,a.Q3)("",!0),(0,a.Lk)("div",{class:(0,i.C4)([e.po_enable?"col-sm-12 col-md-7 col-lg-7":"col-sm-12 col-md-12 col-lg-12","q-pl-sm"])},[(0,a.bF)(g,{split:"",class:(0,i.C4)(["full-width",e.enableExportButton?"":"disabled"]),unelevated:"",color:"primary",onClick:t[8]||(t[8]=t=>e.confirmAndExport())},{label:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("confirm"))+" ",1),e.hasErrors?((0,a.uX)(),(0,a.Wv)(n,{key:0},{default:(0,a.k6)((()=>[(0,a.eW)(" Following fields need to be validated before export:"),je,((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.fieldErrors,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e},[(0,a.eW)((0,i.v_)(e),1),Be])))),128))])),_:1})):(0,a.Q3)("",!0)])),default:(0,a.k6)((()=>[(0,a.bF)(m,{class:"text-center"},{default:(0,a.k6)((()=>[(0,a.bo)(((0,a.uX)(),(0,a.Wv)(h,{clickable:"",onClick:t[7]||(t[7]=t=>e.validateConfigurationAndExport(1)),class:"border-bottom-bdbdbd min-height-38"},{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("confirm_export_next")),1)])),_:1})])),_:1})])),_:1})),[[E]])])),_:1})])),_:1},8,["class"])],2)])),(0,a.bF)(f,{modelValue:e.display_config_dialog,"onUpdate:modelValue":t[9]||(t[9]=t=>e.display_config_dialog=t),position:"top",class:"export-dialog",persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(b)])),_:1},8,["modelValue"]),(0,a.bF)(f,{modelValue:e.confirmRuleSave,"onUpdate:modelValue":t[11]||(t[11]=t=>e.confirmRuleSave=t),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(k,null,{default:(0,a.k6)((()=>[(0,a.bF)(w,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,a.k6)((()=>[(0,a.bF)(v,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,a.bF)(w,{class:"row items-center",style:{"justify-content":"center",display:"flex"}},{default:(0,a.k6)((()=>[(0,a.Lk)("span",He,(0,i.v_)(e.$t("pages.messages.SAVE_RULES_WARNING")),1),(0,a.Lk)("span",Ye,(0,i.v_)(e.$t("pages.messages.SAVE_RULES_WARNING_2")),1)])),_:1}),(0,a.bF)(y,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(_,{appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[E]]),(0,a.bo)((0,a.bF)(_,{label:e.$t("done"),onClick:t[10]||(t[10]=t=>e.saveRules())},null,8,["label"]),[[E]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(f,{modelValue:e.confirmRedirection,"onUpdate:modelValue":t[13]||(t[13]=t=>e.confirmRedirection=t),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(k,null,{default:(0,a.k6)((()=>[(0,a.bF)(x,{class:"text-white secondary-toolbar"},{default:(0,a.k6)((()=>[(0,a.bF)(C,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("confirm")),1)])),_:1}),(0,a.bo)((0,a.bF)(d,{flat:"",round:"",dense:"",icon:"close"},null,512),[[E]])])),_:1}),(0,a.bF)(w,{class:"row items-center"},{default:(0,a.k6)((()=>[(0,a.Lk)("span",Je,(0,i.v_)(e.$t("pages.messages.NO_NEXT_DOCUMENT")),1)])),_:1}),(0,a.bF)(y,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(_,{appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[E]]),(0,a.bo)((0,a.bF)(d,{label:e.$t("done"),onClick:t[12]||(t[12]=t=>e.routeToDashboard())},null,8,["label"]),[[E]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(f,{modelValue:e.showConfirmation,"onUpdate:modelValue":t[15]||(t[15]=t=>e.showConfirmation=t),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(k,null,{default:(0,a.k6)((()=>[(0,a.bF)(x,{class:"text-white secondary-toolbar"},{default:(0,a.k6)((()=>[(0,a.bF)(C,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("confirm")),1)])),_:1}),(0,a.bo)((0,a.bF)(d,{flat:"",round:"",dense:"",icon:"close"},null,512),[[E]])])),_:1}),(0,a.bF)(w,{class:"row items-center"},{default:(0,a.k6)((()=>[Ge])),_:1}),(0,a.bF)(y,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(_,{appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[E]]),(0,a.bo)((0,a.bF)(_,{label:e.$t("done"),onClick:t[14]||(t[14]=t=>e.proceedToSave())},null,8,["label"]),[[E]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(f,{modelValue:e.showUnmatchedPoWarring,"onUpdate:modelValue":t[17]||(t[17]=t=>e.showUnmatchedPoWarring=t),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(k,null,{default:(0,a.k6)((()=>[(0,a.bF)(x,{class:"text-white secondary-toolbar"},{default:(0,a.k6)((()=>[(0,a.bF)(C,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("confirm")),1)])),_:1}),(0,a.bo)((0,a.bF)(d,{flat:"",round:"",dense:"",icon:"close"},null,512),[[E]])])),_:1}),(0,a.bF)(w,{class:"row items-center"},{default:(0,a.k6)((()=>[Ze])),_:1}),(0,a.bF)(y,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(_,{appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[E]]),(0,a.bo)((0,a.bF)(_,{label:e.$t("done"),onClick:t[16]||(t[16]=t=>{e.validateConfigurationAndExport(e.routeType)})},null,8,["label"]),[[E]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(f,{modelValue:e.showPoMatchWarning,"onUpdate:modelValue":t[19]||(t[19]=t=>e.showPoMatchWarning=t),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(k,null,{default:(0,a.k6)((()=>[(0,a.bF)(w,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,a.k6)((()=>[(0,a.bF)(v,{icon:"warning",color:"primary"})])),_:1}),(0,a.bF)(w,{class:"row items-center"},{default:(0,a.k6)((()=>[(0,a.Lk)("span",et,(0,i.v_)(e.$t("pages.messages.WARNING_EXPORT_FROM_PO_MATCH")),1)])),_:1}),(0,a.bF)(y,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(_,{appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[E]]),(0,a.bo)((0,a.bF)(_,{label:e.$t("po_matching"),onClick:t[18]||(t[18]=t=>e.navigateToPOMatch())},null,8,["label"]),[[E]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(A,{showing:e.export_config_processing},{default:(0,a.k6)((()=>[tt])),_:1},8,["showing"])],64)}var at=o(41903),it=o(68450),st=o(76956),lt=o(57366),rt=o(25891);const nt={class:"q-ml-sm"};function dt(e,t,o,s,l,r){const n=(0,a.g2)("f-btn"),d=(0,a.g2)("q-avatar"),c=(0,a.g2)("q-card-section"),u=(0,a.g2)("q-card-actions"),h=(0,a.g2)("q-card"),m=(0,a.g2)("q-dialog"),g=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(n,{label:e.$t("form_builder.deleteRule"),class:"full-width",onClick:t[0]||(t[0]=t=>{e.confirmDelete=!0})},null,8,["label"]),(0,a.bF)(m,{modelValue:e.confirmDelete,"onUpdate:modelValue":t[2]||(t[2]=t=>e.confirmDelete=t),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.bF)(c,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,a.k6)((()=>[(0,a.bF)(d,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,a.bF)(c,{class:"row items-center"},{default:(0,a.k6)((()=>[(0,a.Lk)("span",nt,(0,i.v_)(e.$t("pages.messages.msg_delete")),1)])),_:1}),(0,a.bF)(u,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(n,{appearance:"cancel",label:e.$t("pages.user.cancel")},null,8,["label"]),[[g]]),(0,a.bo)((0,a.bF)(n,{label:e.$t("pages.user.done"),onClick:t[1]||(t[1]=t=>e.deleteRules())},null,8,["label"]),[[g]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var ct=o(94124),ut=o(85487),ht=function(e,t,o,a){function i(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function l(e){try{n(a.next(e))}catch(t){s(t)}}function r(e){try{n(a["throw"](e))}catch(t){s(t)}}function n(e){e.done?o(e.value):i(e.value).then(l,r)}n((a=a.apply(e,t||[])).next())}))};const mt=(0,a.pM)({el:"#app",mixins:[Ne.A,Pe.A],props:{docId:{type:String,required:!0},token:{type:String,default:""}},components:{},data(){return{}},computed:{},methods:{deleteRules(){return ht(this,void 0,void 0,(function*(){const e=yield this.hasActionAcquiredLock();if(!e)return;this.confirmDelete=!1;let t,o=new FormData;o.append("doc_id",this.docId),this.showLoading();try{let e=yield this.getToken();o.append("org_id",(0,ut.I)()),t=yield Ie.A.post(Te.FH.delete_table_rules,o,{headers:{Authorization:e}})}catch(a){return this.hideLoading(),void this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}if(this.hideLoading(),!1===t.data.success)this.showErrorToast(this.$t("pages.messages.error_internal_occur")),this.showErrorToast(t.data.message);else{this.showSuccessToast(this.$t("pages.messages.RULES_DELETED_SUCESSFULLY"));const e=new CustomEvent("rules_deleted",{});document.dispatchEvent(e),this.$emit("autoDetectTables")}}))},getToken(){return ht(this,void 0,void 0,(function*(){let e=this.token&&null!=this.token&&""!=this.token?this.token:yield(0,Te.L3)();return e}))}},setup(){const e=(0,ct.oI)(),{hasActionAcquiredLock:t}=e;return{confirmDelete:(0,qe.KR)(!1),hasActionAcquiredLock:t}}});var gt=o(12807),_t=o(82156),pt=o(23316),bt=o(44189),ft=o(3952),vt=o(62669),wt=o(88672),yt=o(98582),kt=o.n(yt);const Ct=(0,gt.A)(mt,[["render",dt]]),xt=Ct;kt()(mt,"components",{QDialog:_t.A,QCard:pt.A,QCardSection:bt.A,QAvatar:ft.A,QCardActions:vt.A}),kt()(mt,"directives",{ClosePopup:wt.A});var At=o(62107),Et=function(e,t,o,a){function i(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function l(e){try{n(a.next(e))}catch(t){s(t)}}function r(e){try{n(a["throw"](e))}catch(t){s(t)}}function n(e){e.done?o(e.value):i(e.value).then(l,r)}n((a=a.apply(e,t||[])).next())}))};const St=(0,a.pM)({el:"#app",mixins:[Ne.A,Pe.A,lt.A,rt.A,Oe.A],props:{enableExportButton:Boolean,isValidationView:{type:Boolean,default:!1},isPOView:{type:Boolean,default:!1}},components:{ExportDialog:At.A,DeleteRulesBtn:xt},watch:{config_saved:{handler:function(e,t){!0===t&&!1===e||(this.display_config_dialog=!1)}}},computed:{hasErrors:function(){return(0,it.Ns)(this.fieldErrors)>0}},data(){return{docId:"",routeType:(0,qe.KR)(0),isPoView:(0,qe.KR)(!1),moveToDashboard:(0,qe.KR)(!1),showConfirmation:(0,qe.KR)(!1),allowedDoctypes:st.Gk,po_module_activate:(0,qe.KR)(!1),showPoMatchWarning:(0,qe.KR)(!1),showUnmatchedPoWarring:(0,qe.KR)(!1)}},mounted:function(){window.addEventListener("beforeunload",this.onTabClose),document.addEventListener("save_data",this.triggerSaveData),this.docId=this.$route.params.id},unmounted:function(){window.removeEventListener("beforeunload",this.onTabClose),document.removeEventListener("save_data",this.triggerSaveData)},methods:{cleanupDataforApi(e){e&&e.hasOwnProperty("doc_type")&&-1===this.allowedDoctypes.indexOf(e.doc_type)&&e.hasOwnProperty("tables")},cleanupTableData(e){if(!(e.tables&&e.tables.length>0&&e.tables[0].hasOwnProperty("rows")&&e.tables[0].rows.length>0))return;let t=new Map;Array.from(e.tables[0].rows).forEach((e=>{Array.from(e.columns).forEach((e=>{e.isExtraColumn&&(t.has(e.name)?!1===t.get(e.name)&&e.formatted_value&&t.set(e.name,!0):e.formatted_value?t.set(e.name,!0):t.set(e.name,!1))}))})),Array.from(e.tables[0].rows).forEach((e=>{e.columns=e.columns.filter((e=>!(t.has(e.name)&&!1===t.get(e.name))))}))},triggerSaveData(e){this.confirmationForSave()},confirmationForSave(e=!1){this.confirmationForPoConnectionReset?(this.moveToDashboard=e,this.showConfirmation=!0):this.decideNextOperation()},proceedToSave(){this.record.po_multi_matched=[],this.decideNextOperation()},decideNextOperation(){this.confirmationForPoConnectionReset=!1,this.isPoView?this.viewPurchaseOrder():this.saveData(this.moveToDashboard)},saveData(e){return Et(this,void 0,void 0,(function*(){const t=yield this.hasActionAcquiredLock();if(!t)return;let o=this.record;this.showLoading(),this.cleanupDataforApi(o),this.cleanupTableData(o),o.hasOwnProperty("table_data_copy")&&delete o["table_data_copy"];let a,i=new FormData;i.append("data",JSON.stringify(this.record)),i.append("org_id",(0,ut.I)());try{let e=yield(0,Te.L3)();a=yield Ie.A.post(Te.FH.save_document+this.docId,i,{headers:{Authorization:e}})}catch(s){return this.hideLoading(),void this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}if(this.hideLoading(),!1===a.data.success)this.showErrorToast(this.$t("pages.messages.error_internal_occur")),this.showErrorToast(a.data.message);else{this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),e&&this.routeToDashboard();const t=a.data.data;t.hasOwnProperty("layout")||(t.layout=this.record.layout),this.record=t,this.removeCache(),this.setDataToCache()}}))},routeToDashboard(){window.removeEventListener("beforeunload",this.onTabClose),this.releaseDocLock({doc_id:this.record.doc_id}),this.$router.push("/dashboard")},confirmationRuleSave(){this.is_line_item_validated&&(this.confirmRuleSave=!0)},saveRules(){return Et(this,void 0,void 0,(function*(){const e=yield this.hasActionAcquiredLock();if(!e)return;let t=this.record;this.confirmRuleSave=!1,this.showLoading(),t.hasOwnProperty("table_data_copy")&&delete t["table_data_copy"];let o,a=yield(0,Te.L3)(),i=new FormData;i.append("data",JSON.stringify(t)),i.append("org_id",(0,ut.I)());try{o=yield Ie.A.post(Te.FH.save_rules,i,{headers:{Authorization:a}})}catch(s){return this.hideLoading(),void this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}this.hideLoading(),!1===o.data.success?(this.showErrorToast(this.$t("pages.messages.error_internal_occur")),this.showErrorToast(o.data.message)):(this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),this.$emit("autoDetectTables"))}))},validateConfigurationAndExport(e){return Et(this,void 0,void 0,(function*(){const t=yield this.hasActionAcquiredLock();if(!t)return;let o;try{let e=new FormData;e.append("doc_type",this.record.doc_type),e.append("org_id",(0,ut.I)());let t=yield(0,Te.L3)();const a=yield Ie.A.post(Te.FH.export_configuration_existence,e,{headers:{Authorization:t}});o=a.data.valid}catch(a){return void this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}o?this.exportData(e).catch():this.display_config_dialog=!0}))},exportData(e){return Et(this,void 0,void 0,(function*(){let t,o=this.record;if(this.cleanupDataforApi(o),this.cleanupTableData(o),this.display_config_dialog=!1,(yield this.isPoSettingActivate(this.doctype))&&!this.isPOView)return void(this.showPoMatchWarning=!0);this.showLoading(),o.hasOwnProperty("table_data_copy")&&delete o["table_data_copy"];try{this.removeAllNotifications();let e=new FormData;e.append("data",JSON.stringify(o)),e.append("org_id",(0,ut.I)());let a=yield(0,Te.L3)();t=yield Ie.A.post(Te.FH.validate_and_export+this.docId,e,{headers:{Authorization:a}})}catch(i){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}if(!0===t.data.success)return void(0===e?(yield this.dashboardFiltersAfterExport(),this.routeToDashboard()):this.routeToNextInvoice(o.doc_type));let a=t.data.validation_error_codes;a?a.forEach((e=>{let t=e.split(":"),o=this.displayFieldLabelFor2a({translation_key:t[0]});this.showErrorToast(o+" "+this.$t("pages.api_user_messages."+t[1]),!0)})):this.showErrorToast(t.data.message),this.$emit("setApiData",t.data.data),this.$emit("handleExportError")}))},routeToNextInvoice(e){return Et(this,void 0,void 0,(function*(){let t;this.showLoading();try{let o=yield(0,Te.L3)();t=yield Ie.A.get((0,ut.MV)(Te.FH.get_next_document+this.docId+"?doc_type="+e+"&sort_attr=created_on"),{headers:{Authorization:o}})}catch(o){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}!0===t.data.success?!0===t.data.has_next?(this.showSuccessToast(this.$t("pages.messages.NEXT_DOC_LOADED")),window.removeEventListener("beforeunload",this.onTabClose),this.$router.push("/field_validation_v1/"+t.data.next_id)):this.confirmRedirection=!0:this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}))},viewPurchaseOrder(){this.isPoView=!1,null!==this.tb_version&&this.decidePORoute()},navigateToPOMatch(){this.validateLineItemTable(this.record.tables,this.record.doc_type)&&this.decidePORoute()},decidePORoute(){return Et(this,void 0,void 0,(function*(){const e=yield this.saveAndValidate();if(!1===e.success){const t=new CustomEvent("display_fields_errors",{});return document.dispatchEvent(t),void this.showErrorToast(e.message)}this.$router.push("/po-matching-v3/"+this.record.doc_id)}))},onTabClose(e){this.releaseDocLock({doc_id:this.record.doc_id});let t=at.A.has("event_name")?at.A.getItem("event_name"):null;t&&"language_change"===t||(e.preventDefault(),e.returnValue="",this.clearSelectedSessionStorage())},autoDetectTables(){this.$emit("autoDetectTables")},confirmAndExport(){this.enableExportButton&&this.validateConfigurationAndExport(0)}},setup(){const e=(0,ct.q3)(),{record:t,tb_version:o,po_enable:a,doctype:i,language_origin:s,confirmationForPoConnectionReset:l,notifications:r,fieldErrors:n}=(0,Re.bP)(e),{saveAndValidate:d,setDataToCache:c,removeCache:u}=e,h=(0,ct.oI)(),{hasActionAcquiredLock:m,releaseDocLock:g}=h,_=(0,ct.t8)(),{clearStateForExportDialog:p}=_,{display_config_dialog:b,processing:f,config_saved:v}=(0,Re.bP)(_),w=(0,ct.ky)(),{validation_done:y}=(0,Re.bP)(w),k=(0,ct.fX)(),{dashboardFiltersAfterExport:C}=k;return{fieldErrors:n,removeCache:u,setDataToCache:c,saveAndValidate:d,dashboardFiltersAfterExport:C,is_line_item_validated:y,record:t,doctype:i,language_origin:s,confirmationForPoConnectionReset:l,notifications:r,releaseDocLock:g,exportButtonWidth:(0,qe.KR)("61"),confirmRuleSave:(0,qe.KR)(!1),po_enable:a,tb_version:o,hasActionAcquiredLock:m,clearStateForExportDialog:p,display_config_dialog:b,export_config_processing:f,config_saved:v,confirmRedirection:(0,qe.KR)(!1)}}});var Ft=o(56384),Lt=o(97410),Dt=o(18301),It=o(53999),Tt=o(90124),Rt=o(25173),Ot=o(13796),Pt=o(36914),$t=o(39150),qt=o(39035);const Vt=(0,gt.A)(St,[["render",ot]]),Mt=Vt;kt()(St,"components",{QBtn:Ft.A,QTooltip:Lt.A,QBtnDropdown:Dt.A,QList:It.A,QItem:Tt.A,QItemSection:Rt.A,QItemLabel:Ot.A,QDialog:_t.A,QCard:pt.A,QCardSection:bt.A,QAvatar:ft.A,QCardActions:vt.A,QToolbar:Pt.A,QToolbarTitle:$t.A,QInnerLoading:qt.A}),kt()(St,"directives",{ClosePopup:wt.A});var Nt=o(98859),Xt=o(51476);const Wt=e=>((0,a.Qi)("data-v-a255977a"),e=e(),(0,a.jt)(),e),Qt={class:"ai_indicator_header"},zt={class:"text"},Kt=Wt((()=>(0,a.Lk)("div",{id:"speedometer"},[(0,a.Lk)("span",{class:"barometer"}),(0,a.Lk)("span",{class:"needle"})],-1)));function Ut(e,t,o,s,l,r){return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("span",Qt,[(0,a.Lk)("span",zt,(0,i.v_)(e.$t("ai_indicator")),1)]),Kt],64)}const jt=(0,a.pM)({el:"#app",mixins:[],props:{},components:{},data(){return{gauge_data:{},needle:{},prop:null}},mounted:function(){document.addEventListener("TE_gauge_calculation",this.TEGaugeCalculation),document.addEventListener("FV_gauge_calculation",this.FVGaugeCalculation),this.initGauge()},unmounted:function(){document.removeEventListener("TE_gauge_calculation",this.TEGaugeCalculation),document.removeEventListener("FV_gauge_calculation",this.FVGaugeCalculation)},watch:{},methods:{initGauge(){this.value=0,this.renderGauge()},TEGaugeCalculation(e){e&&e.detail&&e.detail.hasOwnProperty("min_table_effective_weight")&&e.detail.min_table_effective_weight!==this.value&&(this.value=e.detail.min_table_effective_weight,this.renderGauge())},FVGaugeCalculation(e){e&&e.detail&&e.detail.hasOwnProperty("mean_effective_weight")&&e.detail.mean_effective_weight!==this.value&&(this.value=e.detail.mean_effective_weight,this.renderGauge())},renderGauge(){const e=this.makeWithInRange(this.value);this.needle=document.querySelector(".needle"),this.needle.style.transform="rotate("+e+"deg)"},makeWithInRange(e){let t=10,o=0,a=0,i=0;return 5==e?1:(e>5&&(a=89,i=1),e<5&&(a=357,i=272),(e-o)/(t-o)*(a-i)+i)},getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)}},setup(){return{value:(0,qe.KR)(0)}}}),Bt=(0,gt.A)(jt,[["render",Ut],["__scopeId","data-v-a255977a"]]),Ht=Bt;var Yt=o(80884),Jt=o(36801),Gt=o(21984),Zt=o(84857),eo=o(53500);const to=(0,a.Lk)("img",{width:"18",height:"18",src:"images/trash-bin-default.svg"},null,-1),oo=(0,a.Lk)("img",{width:"18",height:"18",src:"images/trash-bin-default.svg"},null,-1),ao=(0,a.Lk)("img",{width:"18",height:"18",src:"images/globe.svg"},null,-1),io={key:0,class:"back-white"},so={key:1},lo={key:2},ro={style:{"padding-left":"5px"}},no={style:{"padding-left":"5px"}},co={style:{"padding-left":"5px"}},uo={style:{"padding-left":"5px"}},ho={key:0,class:"q-pa-md q-gutter-sm"},mo={class:"text-weight-bold"},go={class:"row items-center"},_o={style:{width:"40%",margin:"auto"}},po={class:"input-text validation-icon",style:{width:"60%"}},bo={class:"row items-center q-mb-md"},fo={style:{width:"40%",margin:"auto"}},vo={style:{width:"60%"}},wo={class:"q-pa-md"},yo={class:"row items-center"},ko={style:{width:"40%",margin:"auto"}},Co={style:{width:"60%"}},xo={class:"row items-center"},Ao={style:{width:"40%",margin:"auto"}},Eo={style:{width:"60%"}},So={class:"row items-center"},Fo={style:{width:"40%",margin:"auto"}},Lo={style:{width:"60%"}},Do={class:"row items-center"},Io={style:{width:"40%",margin:"auto"}},To={style:{width:"60%"}},Ro={class:"row items-center"},Oo={style:{width:"40%",margin:"auto"}},Po={style:{width:"60%"}},$o={key:0,class:"row items-center"},qo={style:{width:"1000%",margin:"auto"}},Vo={class:"bg-grey-3"},Mo={class:"text-h4 text-uppercase text-left"},No={class:"text-h4 text-uppercase text-left"},Xo={class:"text-h4 text-uppercase text-left"},Wo={class:"text-h4 text-uppercase text-left"},Qo=(0,a.Lk)("img",{src:"images/trash-bin-default.svg",width:"20"},null,-1),zo={class:"text-weight-bold"},Ko={style:{"margin-bottom":"20px"},class:"row full-width mb-10 mt-8"},Uo={style:{width:"50%"}},jo=(0,a.Lk)("div",{style:{width:"50%"},class:"pl-20"},null,-1),Bo={style:{"margin-bottom":"20px"},class:"row full-width mb-10"},Ho={style:{width:"50%"}},Yo={style:{width:"50%"},class:"pl-20"},Jo={key:0,style:{"margin-bottom":"20px"},class:"row full-width mb-10"},Go={style:{width:"100%"}},Zo={style:{"margin-bottom":"20px"},class:"row full-width mb-10"},ea={style:{width:"100%"}},ta={class:"q-ml-sm"},oa={class:"q-ml-sm"},aa={class:"text-weight-bold"},ia={class:"q-ml-sm"},sa={class:"q-ml-sm"};function la(e,t,o,l,r,n){const d=(0,a.g2)("q-th"),c=(0,a.g2)("q-item-section"),u=(0,a.g2)("q-item-label"),h=(0,a.g2)("q-item"),m=(0,a.g2)("q-icon"),g=(0,a.g2)("q-separator"),_=(0,a.g2)("ColumnOrigin"),p=(0,a.g2)("q-list"),b=(0,a.g2)("q-btn-dropdown"),f=(0,a.g2)("q-input"),v=(0,a.g2)("q-tooltip"),w=(0,a.g2)("q-tr"),y=(0,a.g2)("q-btn"),k=(0,a.g2)("q-td"),C=(0,a.g2)("q-table"),x=(0,a.g2)("q-spinner"),A=(0,a.g2)("q-markup-table"),E=(0,a.g2)("q-toolbar-title"),S=(0,a.g2)("q-toolbar"),F=(0,a.g2)("q-select"),L=(0,a.g2)("q-checkbox"),D=(0,a.g2)("q-expansion-item"),I=(0,a.g2)("q-card-section"),T=(0,a.g2)("f-btn"),R=(0,a.g2)("q-card-actions"),O=(0,a.g2)("q-card"),P=(0,a.g2)("q-dialog"),$=(0,a.g2)("q-avatar"),q=(0,a.g2)("CreateCustomColumn"),V=(0,a.g2)("BlockedColumns"),M=(0,a.g2)("ManageRuleRegexes"),N=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)(a.FK,null,[((0,a.uX)(),(0,a.CE)("div",{class:"row q-pa-sm",key:e.renderKey},[e.hasLineItems()?((0,a.uX)(),(0,a.Wv)(C,{key:0,rows:e.tableRows,columns:e.tableColumns,"no-data-label":e.$t("pages.messages.no_record_found"),"row-key":"id","table-header-style":{backgroundColor:"#d4d4d4"},"hide-bottom":"",style:{overflow:"scroll",height:"auto","min-height":"180px","max-height":"500px"},"rows-per-page-options":[0],id:"line_item_table",class:"sticky-header"},{header:(0,a.k6)((o=>[(0,a.bF)(w,{props:o,class:"bg-grey-3"},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.cols,((o,s)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:o.name},[""===o.label?((0,a.uX)(),(0,a.Wv)(d,{key:0})):((0,a.uX)(),(0,a.Wv)(d,{key:1},{default:(0,a.k6)((()=>[e.isReadOnly?((0,a.uX)(),(0,a.CE)("span",{key:1,class:(0,i.C4)("gridHeader "+(o.error?"column-error-border":"")+(!0===e.hasOriginalIndex(o.org_index,o)?"non-extractable-column-text ":" extractable-column-text")),style:{width:"100%","box-shadow":"none",padding:"8px 40px 8px 2px"}},(0,i.v_)(o.label),3)):((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.bF)(b,{"fab-mini":"",color:e.hasOriginalIndex(o.org_index,o)&&e.formatting_options.group_column===o.org_index?"primary":"grey-6",rounded:"",outline:"",class:"column-action-dropdown","dropdown-icon":"more_horiz"},{default:(0,a.k6)((()=>[(0,a.bF)(p,null,{default:(0,a.k6)((()=>[e.hasOriginalIndex(o.org_index,o)?(0,a.bo)(((0,a.uX)(),(0,a.Wv)(h,{key:0,onClick:t=>e.deleteLineItemColumn(o.org_index),clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(c,{avatar:"",class:"f-item-icon"},{default:(0,a.k6)((()=>[to])),_:1}),(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("delete_column")),1)])),_:1})])),_:1})])),_:2},1032,["onClick"])),[[N]]):(0,a.Q3)("",!0),e.hasOriginalIndex(o.org_index,o)&&e.formatting_options.group_column!==o.org_index?(0,a.bo)(((0,a.uX)(),(0,a.Wv)(h,{key:1,"text-color":o.is_mapped?"non-extractable-column-text":"black",onClick:t=>e.groupByColumn(o.org_index),clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(c,{avatar:"",class:"f-item-icon"},{default:(0,a.k6)((()=>[(0,a.bF)(m,{name:"lar la-object-group",size:"20px",class:"cursor-pointer"})])),_:1}),(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("group_rows")),1)])),_:1})])),_:1})])),_:2},1032,["text-color","onClick"])),[[N]]):(0,a.Q3)("",!0),e.hasOriginalIndex(o.org_index,o)&&e.formatting_options.group_column===o.org_index?(0,a.bo)(((0,a.uX)(),(0,a.Wv)(h,{key:2,onClick:t[0]||(t[0]=t=>e.resetFormating()),clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(c,{avatar:"",class:"f-item-icon"},{default:(0,a.k6)((()=>[(0,a.bF)(m,{name:"lar la-object-ungroup",size:"20px",class:"cursor-pointer"})])),_:1}),(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("reset_group_rows")),1)])),_:1})])),_:1})])),_:1})),[[N]]):(0,a.Q3)("",!0),o.is_mapped?(0,a.Q3)("",!0):(0,a.bo)(((0,a.uX)(),(0,a.Wv)(h,{key:3,onClick:t=>{e.prepareRegexData(o.name)},clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(c,{avatar:"",class:"f-item-icon"},{default:(0,a.k6)((()=>[(0,a.bF)(m,{name:"las la-infinity",size:"20px",class:"cursor-pointer"})])),_:1}),(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("regex")),1)])),_:1})])),_:1})])),_:2},1032,["onClick"])),[[N]]),e.hasOriginalIndex(o.org_index,o)?(0,a.Q3)("",!0):(0,a.bo)(((0,a.uX)(),(0,a.Wv)(h,{key:4,onClick:t=>e.disableCustomColumn(o.name),clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(c,{avatar:"",class:"f-item-icon"},{default:(0,a.k6)((()=>[oo])),_:1}),(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("disable_column")),1)])),_:1})])),_:1})])),_:2},1032,["onClick"])),[[N]]),(0,a.bF)(g),e.lineItemLayout[o.name]&&e.lineItemLayout[o.name].hasOwnProperty("column_type")&&"AMOUNT"==e.lineItemLayout[o.name].column_type?((0,a.uX)(),(0,a.Wv)(h,{key:5},{default:(0,a.k6)((()=>[(0,a.bF)(c,{avatar:"",class:"f-item-icon"},{default:(0,a.k6)((()=>[ao])),_:1}),(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(_,{class:"f-doc-screens-input-field",onUpdateColumnOrigin:e.updateColumnOrigin,origin:o.col_origin,column_name:o.name},null,8,["onUpdateColumnOrigin","origin","column_name"])])),_:2},1024)])),_:2},1024)):(0,a.Q3)("",!0)])),_:2},1024)])),_:2},1032,["color"]),(0,a.bF)(b,{flat:"",disable:1!=e.hasOriginalIndex(o.org_index,o),id:"button_"+s,class:(0,i.C4)("gridHeader "+(o.error?"column-error-border":"")+(!0===e.hasOriginalIndex(o.org_index,o)?"non-extractable-column-text ":" extractable-column-text")),label:o.label},{default:(0,a.k6)((()=>[(0,a.bF)(f,{outlined:"",modelValue:e.searchColumn,"onUpdate:modelValue":t[1]||(t[1]=t=>e.searchColumn=t),dense:"",style:{"line-height":"normal"}},{append:(0,a.k6)((()=>[(0,a.bF)(m,{name:"search"})])),_:1},8,["modelValue"]),(0,a.bF)(p,{filter:e.filter},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.filteredColumns,(t=>(0,a.bo)(((0,a.uX)(),(0,a.Wv)(h,{key:t.techName,clickable:"",onClick:a=>e.swapColumn(t,o.org_index,o.name,"button_"+s)},{default:(0,a.k6)((()=>[(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(t.header),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])),[[N]]))),128))])),_:2},1032,["filter"])])),_:2},1032,["disable","id","class","label"])],64)),o.error?((0,a.uX)(),(0,a.Wv)(m,{key:2,title:e.$t("pages.screen2b.in_valid_column_error"),name:"priority_high",class:"headerError"},{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("pages.screen2b.in_valid_column_error")),1)])),_:1})])),_:1},8,["title"])):(0,a.Q3)("",!0)])),_:2},1024))],64)))),128))])),_:2},1032,["props"])])),body:(0,a.k6)((t=>[(0,a.bF)(w,{props:t,id:"tbl_row_"+t.key},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.cols,(o=>((0,a.uX)(),(0,a.CE)(a.FK,{key:o.name},[""===o.label?((0,a.uX)(),(0,a.Wv)(k,{key:0,class:"secondary-c-text"},{default:(0,a.k6)((()=>[e.isReadOnly||e.training_mode?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[],64)):((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[e.rowHasErrors(t.key)?((0,a.uX)(),(0,a.Wv)(m,{key:0,title:e.$t("pages.screen2b.in_valid_column_error"),name:"priority_high",class:"headerError"},{default:(0,a.k6)((()=>[(0,a.bF)(v,{class:"bg-red line-error-tooltip"},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.lineItemsErrors[t.key],((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t},(0,i.v_)(e),1)))),128))])),_:2},1024)])),_:2},1032,["title"])):(0,a.Q3)("",!0),(0,a.bF)(y,{flat:"",color:"primary",onClick:o=>e.removeLineItem(t.key),icon:"fa fa-times"},null,8,["onClick"])],64))])),_:2},1024)):e.isColumnVisible(o.org_index,o)?((0,a.uX)(),(0,a.Wv)(k,{key:1,id:"input_"+o.name+"_"+t.key,onClick:a=>e.editColumnData(a,o.field,t.key),"data-score-description":e.getScoreDescription(e.lineDataObj[t.key]["columns"][o.name]),"data-column-value":e.lineDataObj[t.key]["columns"][o.name].formatted_value},{default:(0,a.k6)((()=>[(0,a.bF)(f,{disable:e.isReadOnly,class:(0,i.C4)("input-field "+e.addExtractionMethodClass(e.lineDataObj[t.key]["columns"][o.name])),style:(0,i.Tr)("background:"+e.getBackgroundColor(e.lineDataObj[t.key]["columns"][o.name])),borderless:"",onKeydown:e.inputKeyDown,onChange:a=>e.inputValueChanges(o.name,t.key),modelValue:e.lineDataObj[t.key]["columns"][o.name].formatted_value,"onUpdate:modelValue":a=>e.lineDataObj[t.key]["columns"][o.name].formatted_value=a},null,8,["disable","class","style","onKeydown","onChange","modelValue","onUpdate:modelValue"])])),_:2},1032,["id","onClick","data-score-description","data-column-value"])):(0,a.Q3)("",!0)],64)))),128))])),_:2},1032,["props","id"])])),_:1},8,["rows","columns","no-data-label"])):((0,a.uX)(),(0,a.Wv)(A,{key:1,class:"full-width"},{default:(0,a.k6)((()=>[(0,a.Lk)("thead",null,[!1===e.lineItemsloading?((0,a.uX)(),(0,a.CE)("tr",io,[(0,a.Lk)("th",null,(0,i.v_)(e.$t("no_line_items_found")),1)])):(0,a.Q3)("",!0),!0===e.lineItemsloading?((0,a.uX)(),(0,a.CE)("tr",so,[(0,a.Lk)("th",null,[(0,a.bF)(x,{color:"primary",size:"3em",thickness:10})])])):(0,a.Q3)("",!0)])])),_:1})),e.hasLineItems()?((0,a.uX)(),(0,a.CE)("div",lo,[(0,a.Lk)("div",null,[(0,a.bF)(m,{class:"non-extractable-column-text",style:{"font-size":"18px"},name:"rectangle"}),(0,a.Lk)("span",ro,(0,i.v_)(e.$t("non_extractable_column_text")),1)]),(0,a.Lk)("div",null,[(0,a.bF)(m,{class:"extractable-column-text",style:{"font-size":"18px"},name:"rectangle"}),(0,a.Lk)("span",no,(0,i.v_)(e.$t("extractable_column_text")),1)]),(0,a.Lk)("div",null,[(0,a.bF)(m,{style:(0,i.Tr)({"font-size":"18px",color:e.is_auto_filled_color}),name:"rectangle"},null,8,["style"]),(0,a.Lk)("span",co,(0,i.v_)(e.$t("values_auto_filled")),1)]),(0,a.Lk)("div",null,[(0,a.bF)(m,{style:(0,i.Tr)({"font-size":"18px",color:e.is_missing_color}),name:"rectangle"},null,8,["style"]),(0,a.Lk)("span",uo,(0,i.v_)(e.$t("doc_cannot_be_extracted")),1)])])):(0,a.Q3)("",!0)])),e.openAdvSettings?((0,a.uX)(),(0,a.CE)("div",ho,[(0,a.bF)(P,{modelValue:e.openAdvSettings,"onUpdate:modelValue":t[10]||(t[10]=t=>e.openAdvSettings=t),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(O,{style:{width:"700px","max-width":"50vw"}},{default:(0,a.k6)((()=>[(0,a.bF)(S,{class:"text-white secondary-toolbar"},{default:(0,a.k6)((()=>[(0,a.bF)(E,null,{default:(0,a.k6)((()=>[(0,a.Lk)("span",mo,(0,i.v_)(e.$t("layout.settings")),1)])),_:1}),(0,a.bo)((0,a.bF)(y,{flat:"",round:"",dense:"",icon:"close"},null,512),[[N]])])),_:1}),(0,a.bF)(I,{class:""},{default:(0,a.k6)((()=>[(0,a.Lk)("div",go,[(0,a.Lk)("div",_o,[(0,a.eW)((0,i.v_)(e.$t("pages.line_items.header_row_count_field"))+" ",1),(0,a.bF)(m,{name:"help_outline",class:"cursor-pointer"},{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("header_row_count")),1)])),_:1})])),_:1})]),(0,a.Lk)("div",po,[(0,a.bF)(f,{outlined:"",type:"number",rules:e.headerRowCountRules,modelValue:e.header_rows_count,"onUpdate:modelValue":t[2]||(t[2]=t=>e.header_rows_count=t)},null,8,["rules","modelValue"])])]),(0,a.Lk)("div",bo,[(0,a.Lk)("div",fo,[(0,a.eW)((0,i.v_)(e.$t("move_extra_rows_to"))+" ",1),(0,a.bF)(m,{name:"help_outline",class:"cursor-pointer"},{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("move_extra_rows_to_desc")),1)])),_:1})])),_:1})]),(0,a.Lk)("div",vo,[(0,a.bF)(F,{outlined:"",modelValue:e.move_extra_rows_to,"onUpdate:modelValue":t[3]||(t[3]=t=>e.move_extra_rows_to=t),options:e.advance_settings_columns,"emit-value":"","map-options":""},{option:(0,a.k6)((e=>[(0,a.bF)(h,(0,i._B)((0,a.Ng)(e.itemProps)),{default:(0,a.k6)((()=>[(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,{class:(0,i.C4)("__trash__"===e.opt.value?"text-red text-weight-bold":"")},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.opt.label),1)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options"])])]),(0,a.bF)(p,{bordered:"",class:"rounded-borders"},{default:(0,a.k6)((()=>[(0,a.bF)(D,{"expand-separator":"",icon:"description",label:e.$t("pages.line_items.adv_settings_header"),"header-class":"panel-header","default-closed":""},{default:(0,a.k6)((()=>[(0,a.bF)(g),(0,a.Lk)("div",wo,[(0,a.Lk)("div",yo,[(0,a.Lk)("div",ko,[(0,a.eW)((0,i.v_)(e.$t("pages.line_items.min_group_rows"))+" ",1),(0,a.bF)(m,{name:"help_outline",class:"cursor-pointer"},{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("minimum_grouped_rows")),1)])),_:1})])),_:1})]),(0,a.Lk)("div",Co,[(0,a.bF)(f,{class:"input-text validation-icon",outlined:"",type:"number",rules:e.headerRowCountRules,modelValue:e.min_group_rows,"onUpdate:modelValue":t[4]||(t[4]=t=>e.min_group_rows=t)},null,8,["rules","modelValue"])])]),(0,a.Lk)("div",xo,[(0,a.Lk)("div",Ao,[(0,a.eW)((0,i.v_)(e.$t("pages.line_items.max_group_rows"))+" ",1),(0,a.bF)(m,{name:"help_outline",class:"cursor-pointer"},{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("maximum_grouped_rows")),1)])),_:1})])),_:1})]),(0,a.Lk)("div",Eo,[(0,a.bF)(f,{class:"input-text validation-icon",outlined:"",type:"number",rules:e.headerRowCountRules,modelValue:e.max_group_rows,"onUpdate:modelValue":t[5]||(t[5]=t=>e.max_group_rows=t)},null,8,["rules","modelValue"])])]),(0,a.Lk)("div",So,[(0,a.Lk)("div",Fo,[(0,a.eW)((0,i.v_)(e.$t("pages.line_items.distinct_group_column"))+" ",1),(0,a.bF)(m,{name:"help_outline",class:"cursor-pointer"},{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("distinct_group_columns")),1)])),_:1})])),_:1})]),(0,a.Lk)("div",Lo,[(0,a.bF)(L,{modelValue:e.distinct_group_column,"onUpdate:modelValue":t[6]||(t[6]=t=>e.distinct_group_column=t)},null,8,["modelValue"])])]),(0,a.Lk)("div",Do,[(0,a.Lk)("div",Io,[(0,a.eW)((0,i.v_)(e.$t("pages.line_items.reverse_grouping"))+" ",1),(0,a.bF)(m,{name:"help_outline",class:"cursor-pointer"},{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("reverse_grouping")),1)])),_:1})])),_:1})]),(0,a.Lk)("div",To,[(0,a.bF)(L,{modelValue:e.reverse_grouping,"onUpdate:modelValue":t[7]||(t[7]=t=>e.reverse_grouping=t)},null,8,["modelValue"])])]),(0,a.Lk)("div",Ro,[(0,a.Lk)("div",Oo,[(0,a.eW)((0,i.v_)(e.$t("split_text"))+" ",1),(0,a.bF)(m,{name:"help_outline",class:"cursor-pointer"},{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("split_text_desc")),1)])),_:1})])),_:1})]),(0,a.Lk)("div",Po,[(0,a.bF)(L,{modelValue:e.split_text,"onUpdate:modelValue":t[8]||(t[8]=t=>e.split_text=t),onClick:t[9]||(t[9]=t=>e.split_text_confirm_dialog=!0)},null,8,["modelValue"])])]),e.extra_columns.length>0?((0,a.uX)(),(0,a.CE)("div",$o,[(0,a.Lk)("div",qo,[(0,a.bF)(A,null,{default:(0,a.k6)((()=>[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",Vo,[(0,a.Lk)("th",Mo,(0,i.v_)(e.$t("field_key")),1),(0,a.Lk)("th",No,(0,i.v_)(e.$t("source_field")),1),(0,a.Lk)("th",Xo,(0,i.v_)(e.$t("pattern")),1),(0,a.Lk)("th",Wo,(0,i.v_)(e.$t("actions")),1)])]),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.extra_columns,((t,o)=>((0,a.uX)(),(0,a.CE)("tr",{key:t["key"]},[(0,a.Lk)("td",null,(0,i.v_)(t["field_key"]),1),(0,a.Lk)("td",null,(0,i.v_)(t["source_field"]),1),(0,a.Lk)("td",null,(0,i.v_)(t["pattern"]),1),(0,a.Lk)("td",null,[(0,a.bF)(y,{flat:"",onClick:t=>{t.stopPropagation(),e.removeFieldFromSettings(o)}},{default:(0,a.k6)((()=>[Qo,(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("remove")),1)])),_:1})])),_:2},1032,["onClick"])])])))),128))])])),_:1})])])):(0,a.Q3)("",!0)])])),_:1},8,["label"])])),_:1})])),_:1}),(0,a.bF)(R,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(T,{appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[N]]),(0,a.bF)(T,{class:"q-mr-sm","data-cy":"setvatfield",label:e.$t("pages.line_items.proceed"),onClick:e.formatWthAdvSettings},null,8,["label","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(P,{modelValue:e.addFieldsDialog,"onUpdate:modelValue":t[19]||(t[19]=t=>e.addFieldsDialog=t),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.k6)((()=>[(0,a.bF)(O,{style:{width:"600px"}},{default:(0,a.k6)((()=>[(0,a.bF)(S,{class:"text-white secondary-toolbar"},{default:(0,a.k6)((()=>[(0,a.bF)(E,null,{default:(0,a.k6)((()=>[(0,a.Lk)("span",zo,(0,i.v_)(e.$t("add_field_view_header")),1)])),_:1}),(0,a.bo)((0,a.bF)(y,{flat:"",round:"",dense:"",icon:"close"},null,512),[[N]])])),_:1}),(0,a.bF)(I,{class:"q-pt-none"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",Ko,[(0,a.Lk)("div",Uo,[(0,a.bF)(F,{modelValue:e.new_field_model["source"],"onUpdate:modelValue":t[12]||(t[12]=t=>e.new_field_model["source"]=t),class:"col-sm-6 col-md-6 col-lg-6",options:e.adv_column_options,label:"Field Source*","bottom-slots":"","error-message":"Field is required",error:e.new_field_model["source_invalid"],"emit-value":"","map-options":""},{append:(0,a.k6)((()=>[(0,a.bF)(m,{name:"close",onClick:t[11]||(t[11]=(0,s.D$)((t=>e.new_field_model["source"]=""),["stop"])),class:"cursor-pointer"})])),option:(0,a.k6)((e=>[(0,a.bF)(h,(0,i._B)((0,a.Ng)(e.itemProps)),{default:(0,a.k6)((()=>[(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.opt.label),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options","error"])]),jo]),(0,a.Lk)("div",Bo,[(0,a.Lk)("div",Ho,[(0,a.bF)(f,{label:"Key*",modelValue:e.new_field_model["key"],"onUpdate:modelValue":t[13]||(t[13]=t=>e.new_field_model["key"]=t),outlined:"",class:"full-width","bottom-slots":"","error-message":"Field is required",error:e.new_field_model["key_invalid"]},null,8,["modelValue","error"])]),(0,a.Lk)("div",Yo,[(0,a.bF)(F,{modelValue:e.new_field_model["key_dropdown"],"onUpdate:modelValue":[t[15]||(t[15]=t=>e.new_field_model["key_dropdown"]=t),t[16]||(t[16]=t=>e.advSettingNewFieldColumnSelected("key","key_dropdown"))],class:"col-sm-6 col-md-6 col-lg-6",options:e.adv_column_options,label:e.$t("adv_column_options")},{append:(0,a.k6)((()=>[(0,a.bF)(m,{name:"close",onClick:t[14]||(t[14]=(0,s.D$)((t=>{e.new_field_model["key_dropdown"]="",e.advSettingNewFieldColumnSelected("key","key_dropdown")}),["stop"])),class:"cursor-pointer"})])),option:(0,a.k6)((e=>[(0,a.bF)(h,(0,i._B)((0,a.Ng)(e.itemProps)),{default:(0,a.k6)((()=>[(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.opt.label),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options","label"])])]),e.new_field_model["key_dropdown"]?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",Jo,[(0,a.Lk)("div",Go,[(0,a.bF)(f,{label:"Label",modelValue:e.new_field_model["label"],"onUpdate:modelValue":t[17]||(t[17]=t=>e.new_field_model["label"]=t),outlined:"",class:"full-width"},null,8,["modelValue"])])])),(0,a.Lk)("div",Zo,[(0,a.Lk)("div",ea,[(0,a.bF)(f,{label:"Pattern*",modelValue:e.new_field_model["pattern"],"onUpdate:modelValue":t[18]||(t[18]=t=>e.new_field_model["pattern"]=t),outlined:"",class:"full-width","bottom-slots":"","error-message":"Invalid Regex Pattern",error:e.new_field_model["pattern_invalid"]},null,8,["modelValue","error"])])])])),_:1}),(0,a.bF)(R,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bF)(y,{color:"primary",class:"q-mr-sm","data-cy":"setvatfield",label:e.$t("pages.line_items.proceed"),onClick:e.saveNewFieldForAdvSettings},null,8,["label","onClick"]),(0,a.bo)((0,a.bF)(T,{appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[N]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(P,{modelValue:e.split_text_confirm_dialog,"onUpdate:modelValue":t[21]||(t[21]=t=>e.split_text_confirm_dialog=t),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(O,null,{default:(0,a.k6)((()=>[(0,a.bF)(I,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,a.k6)((()=>[(0,a.bF)($,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,a.bF)(I,{class:"row items-center"},{default:(0,a.k6)((()=>[(0,a.Lk)("span",ta,(0,i.v_)(e.$t("split_text_confirm")),1)])),_:1}),(0,a.bF)(R,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(y,{label:e.$t("cancel"),class:"bg-grey-3"},null,8,["label"]),[[N]]),(0,a.bF)(y,{label:e.$t("proceed"),class:"q-mr-sm",color:"primary",onClick:t[20]||(t[20]=t=>e.TriggerSplitText())},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])):(0,a.Q3)("",!0),(0,a.bF)(P,{modelValue:e.addColumnDialog,"onUpdate:modelValue":t[22]||(t[22]=t=>e.addColumnDialog=t),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.k6)((()=>[(0,a.bF)(q,{is_table_training_doc:!!this.docStore.record.hasOwnProperty("is_table_training_doc"),table_name:this.docStore.record.tables&&this.docStore.record.tables.length>0?this.docStore.record.tables[0].name:"",tables:this.docStore.record.tables&&this.docStore.record.tables.length>0?this.docStore.record.tables[0]:{},columns_list:this.lineItemLayout,addColumnDialog:e.addColumnDialog},null,8,["is_table_training_doc","table_name","tables","columns_list","addColumnDialog"])])),_:1},8,["modelValue"]),(0,a.bF)(P,{modelValue:e.poEditRestrictDialog,"onUpdate:modelValue":t[23]||(t[23]=t=>e.poEditRestrictDialog=t),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(O,null,{default:(0,a.k6)((()=>[(0,a.bF)(I,{class:"row items-center"},{default:(0,a.k6)((()=>[(0,a.Lk)("span",oa,(0,i.v_)(e.poEditRestrictMessage),1)])),_:1}),(0,a.bF)(R,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bF)(y,{flat:"",label:e.$t("dashboard"),color:"primary",to:"/dashboard"},null,8,["label"]),(0,a.bF)(y,{flat:"",label:e.$t("table_extraction_view"),color:"primary",to:"/tbl_ext_v3/"+e.docStore.record.doc_id},null,8,["label","to"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(P,{modelValue:e.openDisableColumnListView,"onUpdate:modelValue":t[24]||(t[24]=t=>e.openDisableColumnListView=t)},{default:(0,a.k6)((()=>[(0,a.bF)(O,{style:{"min-width":"700px",width:"700px","max-width":"50vw"}},{default:(0,a.k6)((()=>[(0,a.bF)(S,{class:"text-white secondary-toolbar"},{default:(0,a.k6)((()=>[(0,a.bF)(E,null,{default:(0,a.k6)((()=>[(0,a.Lk)("span",aa,(0,i.v_)(e.$t("diabled_custom_columns")),1)])),_:1}),(0,a.bo)((0,a.bF)(y,{flat:"",round:"",dense:"",icon:"close"},null,512),[[N]])])),_:1}),(0,a.bF)(V,{rows:e.disableColumnList},null,8,["rows"])])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(P,{modelValue:e.revert_changes_confirm_dialog,"onUpdate:modelValue":t[27]||(t[27]=t=>e.revert_changes_confirm_dialog=t),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(O,null,{default:(0,a.k6)((()=>[(0,a.bF)(I,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,a.k6)((()=>[(0,a.bF)($,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,a.bF)(I,{tag:"span",class:"row items-center",style:{"justify-content":"center",display:"flex"}},{default:(0,a.k6)((()=>[(0,a.Lk)("span",ia,(0,i.v_)(e.$t("revert_changes_confirm")),1),(0,a.Lk)("span",sa,(0,i.v_)(e.$t("revert_changes_confirm_2")),1)])),_:1}),(0,a.bF)(R,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(T,{appearance:"cancel",label:e.$t("cancel"),onClick:t[25]||(t[25]=t=>e.revert_changes_confirm_dialog=!1)},null,8,["label"]),[[N]]),(0,a.bF)(T,{label:e.$t("proceed"),class:"q-mr-sm",onClick:t[26]||(t[26]=t=>e.revertChanges(!0))},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(M,{showRegexDlg:e.showRegexDlg,onSetShowRegexDlg:e.setShowRegexDlg,onUpdateRegexByRule:e.updateRegexByRule},null,8,["showRegexDlg","onSetShowRegexDlg","onUpdateRegexByRule"])],64)}var ra=o(96056),na=o(92162),da=o(14907),ca=o(42300),ua=o(64471),ha=o(30739),ma=o(13503),ga=o(82080),_a=o(57588),pa=o(44211),ba=o(89518),fa=o(86633),va=function(e,t,o,a){function i(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function l(e){try{n(a.next(e))}catch(t){s(t)}}function r(e){try{n(a["throw"](e))}catch(t){s(t)}}function n(e){e.done?o(e.value):i(e.value).then(l,r)}n((a=a.apply(e,t||[])).next())}))};let wa,ya=new Map;const ka=(0,a.pM)({el:"#app",mixins:[fa.A,Ne.A,Pe.A,ca.A,ua.A,Me.A,ra.A,ga.A],props:{apiDataProp:{},extractedData:{type:String,default:""},currentPageNo:{type:Number,default:1},isRowMode:{type:Boolean,default:!1},training_mode:{type:Boolean,default:!1},isReadOnly:{type:Boolean,default:!1}},emits:["updateExtractionDataForSave","setTableRowCorrdinates","loadNewPageImage"],components:{BlockedColumns:ma.A,ManageRuleRegexes:_a.A,CreateCustomColumn:pa.A,ColumnOrigin:ba.A},data(){return{docId:"",dropdownColumns:[],rows_to_delete:[],po_dragging:!1,dragging_data:{},coveredLineItem:[],validation_done:!0,connected_line_item:"",confirmDialog:(0,qe.KR)(!1),renderKey:0,is_po_view:!1,selectedColumn:(0,qe.KR)(""),showRegexDlg:(0,qe.KR)(!1),openAdvSettings:(0,qe.KR)(!1),oldSelectedColumnName:(0,qe.KR)(""),po_connected_line_items:{},is_auto_filled_color:"#c2dba6",is_missing_color:"#eed69e"}},mounted:function(){document.addEventListener("revert_changes",(()=>{this.revertChanges().then()})),document.addEventListener("add_new_row",this.createRowJson),document.addEventListener("add_new_column",this.addNewCustomColumn),document.addEventListener("reset_line_items",this.resetlintItems),document.addEventListener("init_line_items",this.lineItemDataLoaded),document.addEventListener("reload_line_items",this.reloadLineItemData),document.addEventListener("get_table_rows_areas",this.getTableRowsAreas),document.addEventListener("display_adv_settings_view",this.openAdvanceSettings),document.addEventListener("open_disabled_custom_columns_view",this.openDisabledCstmColumnsView),document.addEventListener("enable_custom_column",this.enableCustomColumn),document.addEventListener("custom_column_create",this.customColumnCreated),document.addEventListener("display_fields_errors",this.displayFieldErrors),document.addEventListener("restore_delete_column",this.restoreDeleteColumn),this.isViewPo(),window.lineItemsV3=this},unmounted:function(){document.removeEventListener("revert_changes",(()=>{this.revertChanges().then()})),document.removeEventListener("add_new_row",this.createRowJson),document.removeEventListener("add_new_column",this.addNewCustomColumn),document.removeEventListener("reset_line_items",this.resetlintItems),document.removeEventListener("init_line_items",this.lineItemDataLoaded),document.removeEventListener("reload_line_items",this.reloadLineItemData),document.removeEventListener("get_table_rows_areas",this.getTableRowsAreas),document.removeEventListener("display_adv_settings_view",this.openAdvanceSettings),document.removeEventListener("open_disabled_custom_columns_view",this.openDisabledCstmColumnsView),document.removeEventListener("enable_custom_column",this.enableCustomColumn),document.removeEventListener("custom_column_create",this.customColumnCreated),document.removeEventListener("display_fields_errors",this.displayFieldErrors),document.removeEventListener("restore_delete_column",this.restoreDeleteColumn)},watch:{extractedData(e){wa.value=e,wa.parentElement.classList.remove("active"),wa=null},currentPageNo(e){this.highliteFirstRowOfCurrentPage()}},methods:{addExtractionMethodClass(e){let t="";return e&&e.hasOwnProperty("extraction_method")&&""!==e.extraction_method&&(t="extraction_method"),t},reloadLineItemData(e){if(!e||!e.detail)return;this.lineItemsloading=!1;let t=e.detail.apiData;this.resetRows(),this.docStore.record=t,this.docId=this.docStore.record&&this.docStore.record.doc_id?this.docStore.record.doc_id:"",this.refactorApiData();let o={rowId:e.detail.currentRowId,columnName:e.detail.currentColumnName,onlySelectedRow:!0};this.getTableRowsAreas({detail:o}),setTimeout((()=>{const t=new CustomEvent("enable_column_selection",{detail:e.detail.currentRowId});document.dispatchEvent(t)}),10)},lineItemDataLoaded(e){if(!e||!e.detail)return;this.lineItemsloading=!1;let t=e.detail;this.resetRows(),this.docStore.record=t,this.docId=this.docStore.record&&this.docStore.record.doc_id?this.docStore.record.doc_id:"",this.refactorApiData()},isViewEditable(){return!this.is_po_view&&(!!this.training_mode||(this.showErrorToast("Please select training mode"),!1))},getToken(){return va(this,void 0,void 0,(function*(){let e=this.docStore.record.token&&null!=this.docStore.record.token&&""!=this.docStore.record.token?this.docStore.record.token:yield(0,Te.L3)();return e}))},groupByColumn(e){return va(this,void 0,void 0,(function*(){""!==e&&void 0!=e&&null!=e&&(this.group_column=e,yield this.requestReformate())}))},getColumnMappingIndexes(){let e={};for(const t in this.column_mapping_indexes){let o=this.column_mapping_indexes[t];e[t]=o}return e},resetFormating(){return va(this,void 0,void 0,(function*(){this.group_column="",yield this.requestReformate()}))},validateLineItemColumns(){let e=!1;if(this.docStore.record["table_has_error"]=!1,void 0===this.tableColumns)return;let t=[];for(const a of this.tableColumns){let o=this.isColumnNameValid(a);o||(this.docStore.record["table_has_error"]=!0,a.error=!0,e=!0,t.push(a.name))}let o=!e;this.is_line_item_validated=o,this.missing_mapping_column=t,this.validation_done!==o&&(this.validation_done,this.validation_done=o)},isColumnNameValid(e){let t=!(!this.column_mapping_indexes||null==this.column_mapping_indexes||!(0,it.dd)(this.column_mapping_indexes)),o=!1;if("id"==e.name)return!0;for(const a of this.dropdownColumns)if(e.name===a.techName){o=!0;break}return o&&t&&!0===this.hasOriginalIndex(e.org_index,e)&&this.addInMapping(e.org_index,e.name),o},addInMapping(e,t){this.column_mapping_indexes[t]=Number(e)},updateLineItemsForApi(){this.isReadOnly||this.$emit("updateExtractionDataForSave","mapping",this.getColumnMappingIndexes())},isColumnGroupBy(e){let t="";return this.group_column&&(t=this.group_column),null===t&&(t=""),t==e},getColumnGroupBy(){let e="";return this.group_column&&(e=this.group_column),null===e&&(e=""),e},isColumnVisible(e,t){let o=!0;return e&&this.columns_to_hide&&0!=this.columns_to_hide.length?((this.columns_to_hide.includes(e)||"UUID"==t.name)&&(o=!1),o):o},isCustomColumnHidden(e){let t=!1;if(!this.custom_columns_to_hide||0==this.custom_columns_to_hide.length)return t;for(const o of this.custom_columns_to_hide)if(o===e){t=!0;break}return t},isRowDeleted(e){let t=this.getLineUuid(e);return!this.rows_to_delete.includes(t)},getLineUuid(e){let t="";for(let[o,a]of e.entries())if("UUID"==a.techName){t=a.value;break}return t},getLineItemRowsToHide(){if(this.rows_to_delete=[],this.docStore.record&&this.docStore.record.tables&&this.docStore.record.tables[0]&&this.docStore.record.tables[0].hasOwnProperty("extraction_info")){for(let[e,t]of Object.entries(this.docStore.record.tables[0].extraction_info))this.docStore.record.tables[0].extraction_info[e].hasOwnProperty("rows_to_delete")&&(this.rows_to_delete=this.docStore.record.tables[0].extraction_info[e].rows_to_delete);Array.isArray(this.rows_to_delete)&&this.rows_to_delete.length>0?this.rows_to_delete=this.rows_to_delete[0].split(" "):this.rows_to_delete=[]}},addToRowToDelete(e){for(let[t,o]of e.entries())if("UUID"==o.techName){this.rows_to_delete.push(o.value);break}},setRowToDeleteForApi(){if(!this.docStore.record.tables[0]||!this.docStore.record.tables[0].hasOwnProperty("extraction_info"))return;let e=[this.rows_to_delete.join(" ")];this.$emit("updateExtractionDataForSave","rows_to_delete",e)},inputKeyDown(e){if(this.training_mode)return e.preventDefault(),e.target.blur(),void this.showErrorToast(this.$t("manual_change"))},inputValueChanges(e,t){return va(this,void 0,void 0,(function*(){const o=this.lineDataObj[t]["columns"][e].formatted_value;this.lineDataObj[t]["columns"][e].value=o;const a=this.docStore.record.amount_format_locale.split(".");"en_US"!=a[0]&&this.lineItemLayout.hasOwnProperty(e)&&"AMOUNT"===this.lineItemLayout[e].column_type&&(this.lineDataObj[t]["columns"][e].value=yield this.convertValueAccordingToLocale(o,a[0],"en_US"),this.lineDataObj[t]["columns"][e].content=o),this.updateJsonForLineItems(e,t)}))},updateJsonForLineItems(e,t){Array.from(this.docStore.record.tables[0].rows).forEach(((o,a)=>{t===o.id&&Array.from(o.columns).forEach(((t,i)=>{t.name!==e||(this.docStore.record.tables[0].rows[a].columns[i]=this.lineDataObj[o.id].columns[e])}))})),this.dispatchEventToSaveTableChanges()},setJsonForLineItems(){Array.from(this.docStore.record.tables[0].rows).forEach(((e,t)=>{const o=e.id,a=this.lineDataObj[o];this.docStore.record.tables[0].rows[t]=a})),this.dispatchEventToSaveTableChanges()},dispatchEventToSaveTableChanges(e=!1){this.docStore.confirmationForPoConnectionReset=!0;const t=new CustomEvent("update_table_data",{detail:{tables:this.docStore.record.tables,save_to_server:e}});document.dispatchEvent(t)},hasLineItems(){return!(!this.tableRows||0===Object.keys(this.tableRows).length||!this.is_manual_training_allowed)},openAdvanceSettings(){this.adv_column_options=[];for(const e of this.dropdownColumns)this.adv_column_options.push(Object.assign({},{value:e.techName,label:e.header}));this.setAdvSettings(),this.openAdvSettings=!0},setAdvSettings(){this.move_extra_rows_to="",this.header_rows_count=1,this.extra_columns=[],this.formatting_options&&(this.formatting_options.hasOwnProperty("merge_extra_lines_to")&&null!==this.formatting_options.merge_extra_lines_to&&(this.move_extra_rows_to=this.formatting_options.merge_extra_lines_to),this.formatting_options.hasOwnProperty("header_rows_count")&&null!==this.formatting_options.header_rows_count&&(this.header_rows_count=this.formatting_options.header_rows_count),this.formatting_options.hasOwnProperty("extra_cols")&&null!==this.formatting_options.extra_cols&&(this.extra_columns=this.formatting_options.extra_cols),this.formatting_options.hasOwnProperty("group_column")&&null!==this.formatting_options.group_column&&(this.group_column=this.formatting_options.group_column),this.formatting_options.hasOwnProperty("min_group_rows")&&null!==this.formatting_options.min_group_rows&&(this.min_group_rows=this.formatting_options.min_group_rows),this.formatting_options.hasOwnProperty("max_group_rows")&&null!==this.formatting_options.max_group_rows&&(this.max_group_rows=this.formatting_options.max_group_rows),this.formatting_options.hasOwnProperty("distinct_group_column")&&null!==this.formatting_options.distinct_group_column&&(this.distinct_group_column=this.formatting_options.distinct_group_column),this.formatting_options.hasOwnProperty("reverse_grouping")&&null!==this.formatting_options.reverse_grouping&&(this.reverse_grouping=this.formatting_options.reverse_grouping),this.formatting_options.hasOwnProperty("split_text")&&null!==this.formatting_options.split_text&&(this.split_text=this.formatting_options.split_text))},formatWthAdvSettings(){return va(this,void 0,void 0,(function*(){yield this.requestReformate(),this.openAdvSettings=!1}))},advSettingNewFieldColumnSelected(e,t){this.new_field_model[t]?this.new_field_model[e]=this.new_field_model[t].value:this.new_field_model[e]=""},saveNewFieldForAdvSettings(){this.new_field_model["pattern_invalid"]=!1,this.new_field_model["key_invalid"]=!1,this.new_field_model["source_invalid"]=!1;let e=!0;if(this.new_field_model["pattern"]&&!(0,ha.IN)(this.new_field_model["pattern"])&&(this.new_field_model["pattern_invalid"]=!0,e=!1),this.new_field_model["key"]&&""!=this.new_field_model["key"]||(this.new_field_model["key_invalid"]=!0,e=!1),this.new_field_model["source"]&&""!=this.new_field_model["source"]||(this.new_field_model["source_invalid"]=!0,e=!1),!e)return;let t=this.new_field_model["label"];t||(t=this.new_field_model["key"].toUpperCase()),this.extra_columns||(this.extra_columns=[]),this.extra_columns.push({field_key:this.new_field_model["key"].toUpperCase(),source_field:this.new_field_model["source"].toUpperCase(),label:t,pattern:this.new_field_model["pattern"].toUpperCase()}),this.addFieldsDialog=!1},addFieldForAdvSettings(){this.addFieldsDialog=!0,this.new_field_model={}},removeFieldFromSettings(e){e=Number(e),e>-1&&this.extra_columns.splice(e,1)},revertChanges(e=!1){return va(this,void 0,void 0,(function*(){!1!==e?(this.revert_changes_confirm_dialog=!1,this.resetFormatSettings(),yield this.requestReformate()):this.revert_changes_confirm_dialog=!0}))},isViewPo(){this.$route.fullPath.match(/po-matching/g)&&(this.is_po_view=!0)},refactorApiData(){this.resetFormatSettings(),this.setFormatOptions(),this.setAdvSettings(),this.prepareTableLayoutObj(),this.prepareTableColumn(),this.prepareTableRowsAndRowObj(),this.sortTableColumn(),this.validateLineItemColumns(),this.prepareDisabledCstmColumnsList(),setTimeout((()=>{let e=document.querySelector("#line_item_table");if(e){let t=e.querySelector("table");t&&this.resizableGrid(t)}}),1e3)},setFormatOptions(){this.formatting_options={},this.docStore.record.tables&&this.docStore.record.tables.length>0&&this.docStore.record.tables[0].hasOwnProperty("formatting_options")&&(this.formatting_options=this.docStore.record.tables[0].formatting_options),this.docStore.record.hasOwnProperty("tables")&&!(0,it.z)(this.docStore.record.tables)&&(this.docStore.record.tables[0].formatting_options=this.formatting_options),this.formatting_options.hasOwnProperty("mapping")&&null!==this.formatting_options.mapping&&(this.column_mapping_indexes=Object.assign({},this.formatting_options.mapping)),this.formatting_options.hasOwnProperty("columns_to_hide")&&null!==this.formatting_options.columns_to_hide&&(this.columns_to_hide=Object.assign([],this.formatting_options.columns_to_hide)),this.formatting_options.hasOwnProperty("custom_columns_to_hide")&&null!==this.formatting_options.custom_columns_to_hide&&(this.custom_columns_to_hide=Object.assign([],this.formatting_options.custom_columns_to_hide)),this.formatting_options.hasOwnProperty("column_origins")&&!(0,it.z)(this.formatting_options.column_origins)&&(0,it.Gv)(this.formatting_options.column_origins)||(this.docStore.record.hasOwnProperty("tables")&&!(0,it.z)(this.docStore.record.tables)&&(this.docStore.record.tables[0].formatting_options.column_origins={}),this.formatting_options.column_origins={})},resetRows(){this.tableRows=[],this.lineDataObj=[],this.lineItemsErrors={}},resetFormatSettings(){this.move_extra_rows_to="",this.header_rows_count=1,this.extra_columns=[],this.group_column="",this.min_group_rows=1,this.max_group_rows=null,this.distinct_group_column=!1,this.reverse_grouping=!1,this.column_mapping_indexes={},this.columns_to_hide=[],this.custom_columns_to_hide=[],this.split_text=!1},setTableData(e){this.docStore.record.tables[0]=e},prepareTableRowsAndRowObj(){this.docStore.confirmationForPoConnectionReset=!0,this.tableRows=[],this.lineDataObj=[];let e={};if(this.lineItemsErrors={},this.tableRowsLocationsMap.clear(),!this.docStore.record.tables||0==this.docStore.record.tables.length||!this.docStore.record.tables[0].hasOwnProperty("rows")||0==this.docStore.record.tables[0].rows.length)return;this.docStore.record.tables[0].rows[0].id;Array.from(this.docStore.record.tables[0].rows).forEach((t=>{if(!1===t.is_deleted){let o={};e[t.id]=JSON.parse(JSON.stringify(t)),e[t.id].locations_list=[],t.locations_list&&Array.from(t.locations_list).forEach((o=>{e[t.id].locations_list["page_"+o.page]=o,this.tableRowsLocationsMap.has("page_"+o.page)||this.tableRowsLocationsMap.set("page_"+o.page,t.id)})),delete e[t.id].columns,e[t.id]["columns"]=[],Array.from(t.columns).forEach((a=>{e[t.id].columns[a.name]=JSON.parse(JSON.stringify(a)),e[t.id].columns[a.name].locations_list=[],a.locations_list&&Array.from(a.locations_list).forEach((o=>{e[t.id].columns[a.name].locations_list["page_"+o.page]=o})),t.id,(0,it.z)(a.formatted_value)&&(a.formatted_value=""),o[a.name]=a.formatted_value,this.prepareMapOfColumnHavingData(a)})),this.addExtraColumnsInRow(e,o,t.id),o["id"]=t.id,t.id,this.tableRows.push(o),this.setRowErrors(t)}})),Object.assign(this.lineDataObj,e),this.addExtraColumnsInExportJson()},prepareMapOfColumnHavingData(e){ya.has(e.name)?!1===ya.get(e.name)&&e.formatted_value&&null!=e.formatted_value&&""!=e.formatted_value&&ya.set(e.name,!0):e.formatted_value&&null!=e.formatted_value&&""!=e.formatted_value?ya.set(e.name,!0):ya.set(e.name,!1)},addExtraColumnsInRow(e,t,o){for(let a of this.layoutExtraColumns){let i={name:a,value:"",content:"",locations:[],locations_list:[],formatted_value:"",isExtraColumn:!0};e[o].columns[a]=i,ya.set(a,!1),t[a]=""}},addExtraColumnsInExportJson(){let e=[];for(let t of this.layoutExtraColumns){let o={name:t,value:"",content:"",locations:[],locations_list:[],formatted_value:"",isExtraColumn:!0};e.push(o)}Array.from(this.docStore.record.tables[0].rows).forEach(((t,o)=>{for(let a of e)this.docStore.record.tables[0].rows[o].columns.push(a)}))},setRowErrors(e){if(this.lineItemsErrors[e.id]={},!e.messages||!Array.isArray(e.messages))return;let t={};for(const o in e.messages){let a=e.messages[o];"COLUMN_NOT_MAPPED"!=a.message_code&&(a.message&&""!=a.message&&(t[a.message_code]=a.message))}this.lineItemsErrors[e.id]=t},rowHasErrors(e){return!(!this.lineItemsErrors.hasOwnProperty(e)||null===this.lineItemsErrors[e]||(0,it.dd)(this.lineItemsErrors[e]))},prepareTableLayoutObj(){this.dropdownColumns=[];let e={};this.lineItemLayout={},this.initStandardColumns(),this.docStore.record.tables&&this.docStore.record.tables.length>0&&this.docStore.record.tables[0].hasOwnProperty("layout")&&(Array.from(this.docStore.record.tables[0].layout).forEach((t=>{e.hasOwnProperty(t.column_name)||0!=t.is_hidden||this.isCustomColumnHidden(t.column_name)||(e[t.column_name]=!0,t["lbl_to_display"]=this.getLabelToDisplay(t),this.lineItemLayout[t.column_name]=t,this.addStandardColumns(t),this.dropdownColumns.push({header:t.lbl_to_display,techName:t.column_name}))})),this.sortMappingColumns())},sortMappingColumns(){this.dropdownColumns.length>0&&this.dropdownColumns.sort((function(e,t){return e.header<t.header?-1:e.header>t.header?1:0}))},initStandardColumns(){this.advance_settings_columns=[],this.advance_settings_columns.push(Object.assign({},{value:"",label:this.$t("select")})),this.advance_settings_columns.push(Object.assign({},{value:"__trash__",label:this.$t("trash")}))},addStandardColumns(e){this.advance_settings_columns.push(Object.assign({},{value:e.column_name,label:e.column_name}))},prepareTableColumn(){this.tableColumns=[];let e={};if(this.layoutExtraColumns=[],!(this.docStore.record.tables&&this.docStore.record.tables.length>0&&this.docStore.record.tables[0].hasOwnProperty("rows")&&this.docStore.record.tables[0].rows.length>0))return;let t={name:"id",field:"id",align:"left",label:"",is_mapped:!0,org_index:""};this.tableColumns.push(t);const o=this.docStore.record.tables[0].rows[0];if(!o)return;let a=JSON.parse(JSON.stringify(this.lineItemLayout));Array.from(o.columns).forEach((t=>{let i=this.isColumnHidden(o,t);if(i){let o=t.name;this.lineItemLayout.hasOwnProperty(t.name)&&(o=this.lineItemLayout[t.name].lbl_to_display,delete a[t.name]);let i="";null!=t.org_index&&void 0!=t.org_index&&(i=String(t.org_index));let s={name:t.name,field:t.name,align:"left",label:o,is_mapped:!!t.is_mapped&&t.is_mapped,org_index:i,col_origin:"auto"};s.col_origin=this.getColumnOrigin(this.docStore.record.tables[0],t.name),t.hasOwnProperty("org_index")&&null!=t.org_index?this.tableColumns.push(s):e[t.name]=s}}));for(let[i,s]of Object.entries(e))this.tableColumns.push(Object.assign({},s));for(let i in a){const e=a[i];let t=!this.isCustomColumnHidden(e.name);if(!t){delete a[e.name];continue}let o={name:e.column_name,field:e.column_name,align:"left",label:e.lbl_to_display,is_mapped:!!e.is_mapped&&e.is_mapped,org_index:"",is_extra_column:!0,col_origin:"auto"};o.col_origin=this.getColumnOrigin(this.docStore.record.tables[0],e.column_name),this.tableColumns.push(Object.assign({},o)),this.layoutExtraColumns.push(e.column_name)}},sortTableColumn(){let e=JSON.parse(JSON.stringify(this.tableColumns)),t=[];this.tableColumns=[],Array.from(e).forEach(((e,o)=>{1!=this.hasOriginalIndex(e.org_index,e)&&ya.has(e.name)&&!1===ya.get(e.name)?t.push(Object.assign({},e)):this.tableColumns.push(Object.assign({},e))})),t.sort(((e,t)=>{let o=e.field.toLowerCase(),a=t.field.toLowerCase();return o<a?-1:o>a?1:0})),Array.from(t).forEach(((e,t)=>{this.tableColumns.push(Object.assign({},e))}))},isColumnHidden(e,t){let o="";null!=t.org_index&&void 0!=t.org_index&&(o=String(t.org_index));let a=!0;return""!==o&&(a=this.isColumnVisible(o,t)),""===o&&(a=!this.isCustomColumnHidden(t.name)),a},deleteLineItemColumn(e){return va(this,void 0,void 0,(function*(){this.columns_to_hide.push(e),null!=this.group_column&&this.group_column===e&&(this.group_column=""),yield this.requestReformate()}))},getColumnToHide(){return Array.isArray(this.columns_to_hide)?this.columns_to_hide.join():""},removeLineItem(e){Array.from(this.docStore.record.tables[0].rows).forEach((t=>{if(t.id===e)return t.is_deleted=!0,this.$forceUpdate(),void this.prepareTableRowsAndRowObj()})),this.dispatchEventToSaveTableChanges()},swapColumn(e,t,o,a){return va(this,void 0,void 0,(function*(){if(!this.isViewEditable())return;if(this.selectedColumnHasData(e.techName))return void this.showErrorToast(this.$t("column_has_value"));let i=!1,s=!1,l=t;if(this.column_mapping_indexes)for(const t in this.column_mapping_indexes){let a=this.column_mapping_indexes[t];if(t==e.techName&&a!=l){i=!0;break}if(t==o&&a==l){s=!0;break}}i?this.showErrorToast(this.$t("pages.messages.COLUMN_ALREADY_MAPPED")):(s&&delete this.column_mapping_indexes[o],this.addInMapping(l,e.techName),yield this.requestReformate(),setTimeout((()=>{this.scrollInToViewCenter(document.getElementById(a))}),10))}))},selectedColumnHasData(e){let t=!1;for(const o in this.tableRows){const a=this.tableRows[o];if(a.hasOwnProperty(e)&&null!=a[e]&&void 0!=a[e]&&""!=a[e]){t=!0;break}}return t},getTableData(){return this.docStore.record.tables&&this.docStore.record.tables.length>0?this.docStore.record.tables[0]:{}},restoreDeleteColumn(){this.columns_to_hide=[],this.requestReformate()},requestReformate(){return va(this,void 0,void 0,(function*(){this.lineItemsloading=!0,this.resetRows();try{let e,t=new FormData;t.append("doc_id",this.docId),t.append("group_column",this.getColumnGroupBy()),t.append("min_group_rows",this.min_group_rows.toString()),t.append("max_group_rows",this.max_group_rows?this.max_group_rows.toString():""),t.append("header_rows_count",this.header_rows_count.toString()),t.append("distinct_group_column",this.distinct_group_column.toString()),t.append("reverse_grouping",this.reverse_grouping.toString()),t.append("column_mapping_indexes",JSON.stringify(this.getColumnMappingIndexes())),t.append("move_extra_rows_to",this.move_extra_rows_to),t.append("extra_columns",JSON.stringify(this.extra_columns)),t.append("columns_to_hide",this.getColumnToHide()),t.append("data",JSON.stringify(this.getTableData())),t.append("column_origins",JSON.stringify(this.getColumnOrigins())),this.docStore.record.hasOwnProperty("is_table_training_doc")&&t.append("is_table_training_doc",(!0).toString()),t.append("org_id",(0,ut.I)());let o=yield this.getToken();if(e=yield Ie.A.post(Te.FH.reformat_table_table_v3,t,{headers:{Authorization:o}}),!1===e.data.success)throw e.data.message;this.setTableData(e.data),this.dispatchEventToSaveTableChanges(),this.refactorApiData(),this.lineItemsloading=!1}catch(e){return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void(this.lineItemsloading=!1)}this.renderKey++}))},getColumnOrigins(){return this.docStore.record.tables[0].formatting_options.column_origins},addNewCustomColumn(e){this.addColumnDialog=!0},editColumnData(e,t,o){if(!this.lineDataObj[o].hasOwnProperty("custom_row"))if(!0===this.isRowMode){let a,i=10;this.clearOldSelection(),e.target.closest("label")&&e.target.closest("label").classList.add("active-border-2px"),a=this.lineDataObj[o].columns[t];let s=!0;if(a&&a.locations_list){let e=a.locations_list;if(e.hasOwnProperty("page_"+this.currentPageNo))s=!1;else if(0!=Object.entries(e).length){i=200;for(const t in e){s=!1;let o=+e[t].page-1;this.$emit("loadNewPageImage",o);break}}else this.loadAppropriatePage(o)}setTimeout((()=>{if(!1===s){let s={rowId:o,columnName:t};this.getTableRowsAreas({detail:s}),setTimeout((()=>{let o=(0,na.$)("#draw_"+t);if(o){o.querySelector(".select-areas--outline").style.opacity="0";let i=o.querySelector(".select-areas--background_area");i.style.border="2px",i.style.borderStyle="solid",i.style.borderColor="#8800ff",this.oldSelectedColumnName=t,this.scrollInToViewCenter(i),this.removeExistingConfirmationOverlays(),a&&""!==this.addExtractionMethodClass(a)&&setTimeout((()=>{let t=e.target.closest("td").dataset.columnValue,o=e.target.closest("td").dataset.scoreDescription,a={value:t,score:o,selection:i};const s=new CustomEvent("prepare_overlay",{detail:a});document.dispatchEvent(s)}),20)}}),i)}else{this.showNotification(this.$t("pages.messages.SELECT_AREA"));let e={rowId:o,columnName:t,onlySelectedRow:!0};this.getTableRowsAreas({detail:e}),setTimeout((()=>{const e=new CustomEvent("enable_column_selection",{detail:o});document.dispatchEvent(e)}),10)}}),10)}else this.loadAppropriatePage(o),setTimeout((()=>{let e={rowId:o,columnName:t,onlySelectedRow:!0};this.drawSelectedRow({detail:e}),setTimeout((()=>{let e=(0,na.$)("#draw_"+o);if(e){this.oldSelectedColumnName=t;let o=e.querySelector(".select-areas--background_area");this.scrollInToViewCenter(o)}}),40)}),100)},clearOldSelection(){if(""!=this.oldSelectedColumnName){let e=(0,na.$)("#draw_"+this.oldSelectedColumnName);if(e){let t=e.querySelector(".select-areas--background_area"),o=t.style.background.split("100%)");t.style.background=st.I7+o[1]}}let e=document.querySelector("#line_item_table").querySelectorAll("label.active-border-2px");Array.from(e).forEach((e=>{e.classList.remove("active-border-2px")}));let t=document.querySelector("#screenshot_container"),o=t.querySelectorAll("div.select-areas--outline");Array.from(o).forEach((e=>{e.style.opacity="0.2",e.nextSibling&&(e.nextSibling.style.border="unset")}))},loadAppropriatePage(e){let t=this.lineDataObj[e],o="";for(const a in t.locations_list){if(t.locations_list[a].page===this.currentPageNo){o=a;break}o=a}if(""!=o){let e=+t.locations_list[o].page-1;this.$emit("loadNewPageImage",e)}},drawSelectedRow(e){let t="",o=null;void 0!=e.detail&&e.detail.columnName&&(t=e.detail.rowId,o=e.detail.columnName);let a=[];if(this.lineDataObj[t]){this.lineDataObj[t].locations_list&&this.lineDataObj[t].locations_list["page_"+this.currentPageNo]&&a.push({id:t,type:"row",row_id:"",background:st.je,opacity:"1",coord:this.lineDataObj[t].locations_list["page_"+this.currentPageNo].coords[0]});let i=this.lineDataObj[t].columns[o];i&&i.locations_list&&i.locations_list["page_"+this.currentPageNo]&&a.push({id:o,row_id:e.detail.rowId,type:"column",background:st.je,opacity:"1",coord:i.locations_list["page_"+this.currentPageNo].coords[0]})}let i={columns:[],table_areas:[]};i.table_areas=a,at.A.set("table_rows_data",JSON.stringify(i));const s=new CustomEvent("prepare_customized_areas");document.dispatchEvent(s)},getTableRowsAreas(e){let t="all_rows",o=null;void 0!=e.detail&&e.detail.columnName&&(t=e.detail.rowId,o=e.detail.columnName);let a=[];for(const i in this.lineDataObj)this.lineDataObj[i]&&this.lineDataObj[i].locations_list["page_"+this.currentPageNo]&&a.push({id:i,type:"row",row_id:"",background:void 0!=e.detail&&e.detail.rowId===i?"":"linear-gradient( rgba(211, 211, 211, 0.5) 100%, rgba(0, 0, 0, 0.5)100%),",opacity:(void 0!=e.detail&&e.detail.rowId,"1"),coord:this.lineDataObj[i].locations_list["page_"+this.currentPageNo].coords[0]});if(e.detail&&!e.detail.onlySelectedRow&&this.lineDataObj.hasOwnProperty(e.detail.rowId)){let t=this.lineDataObj[e.detail.rowId].columns;for(const o in t)t[o].locations_list&&t[o].locations_list.hasOwnProperty("page_"+this.currentPageNo)&&a.push({id:o,row_id:e.detail.rowId,type:"column",background:this.columnDefaultBackground(),opacity:1,coord:t[o].locations_list["page_"+this.currentPageNo].coords[0]})}this.$emit("setTableRowCorrdinates",JSON.stringify(a),o,t)},columnDefaultBackground(){return st.je},hasOriginalIndex(e,t){let o=!1;return""!==e&&(o=!0),o},getScoreDescription(e){let t="";return e&&e.hasOwnProperty("score_description")&&""!==e.score_description&&null!=e.score_description&&(t=e.score_description),String(t)},TriggerSplitText(){this.split_text_confirm_dialog=!1,this.openAdvSettings=!1;const e=new CustomEvent("perform_split_text",{detail:this.split_text});document.dispatchEvent(e)},disableCustomColumn(e){this.formatting_options.hasOwnProperty("custom_columns_to_hide")&&null!==this.formatting_options.custom_columns_to_hide||(this.formatting_options.custom_columns_to_hide=Object.assign([])),this.formatting_options.custom_columns_to_hide.push(e),this.refactorApiData(),this.$forceUpdate(),this.dispatchEventToSaveTableChanges(!0)},getLabelToDisplay(e){let t=e.title;return(0,it.z)(e.translation_key)||this.$t("pages.line_items_columns."+e.translation_key.toUpperCase())==="pages.line_items_columns."+e.translation_key.toUpperCase()||(t=this.$t("pages.line_items_columns."+e.translation_key.toUpperCase())),t},prepareDisabledCstmColumnsList(){this.disableColumnList=[],this.docStore.record.tables&&this.docStore.record.tables.length>0&&this.docStore.record.tables[0].hasOwnProperty("layout")&&Array.from(this.docStore.record.tables[0].layout).forEach((e=>{if(!0===this.isCustomColumnHidden(e.column_name)){let t={};t["name"]=e.column_name,t["label"]=this.getLabelToDisplay(e),this.disableColumnList.push(t)}}))},openDisabledCstmColumnsView(){this.docStore.record.tables&&this.docStore.record.tables.length>0&&this.docStore.record.tables[0].hasOwnProperty("layout")&&(this.openDisableColumnListView=!0)},enableCustomColumn(e){if(e&&e.detail){var t=this.formatting_options.custom_columns_to_hide.indexOf(e.detail);-1!==t&&this.formatting_options.custom_columns_to_hide.splice(t,1),this.refactorApiData(),this.dispatchEventToSaveTableChanges(!0)}},customColumnCreated(e){e&&e.detail&&e.detail.tables&&(this.addColumnDialog=!1,this.setTableData(e.detail.tables),this.dispatchEventToSaveTableChanges(),this.refactorApiData())},createRowJson(){let e=JSON.parse(JSON.stringify(this.docStore.record.tables[0].rows[0]));e.id=Date.now(),e.ids=[],e.content="",e.locations=[],e.locations_list=[],e.is_deleted=!1,e.messages=[],e.custom_row=!0,Array.from(e.columns).forEach(((e,t)=>{e.content="",e.locations=[],e.locations_list=[],e.value="",e.formatted_value=""})),this.docStore.record.tables[0].rows.push(e),this.$forceUpdate(),this.prepareTableRowsAndRowObj()},prepareRegexData(e){this.docStore.regex.clear(),this.selectedColumn=e,Array.from(this.docStore.record.tables[0].rows).forEach(((t,o)=>{Array.from(t.columns).forEach(((t,o)=>{t.name===e&&t.hasOwnProperty("rule")&&t.hasOwnProperty("valuePattern")&&this.docStore.regex.set(t.rule,t.valuePattern)}))})),this.showRegexDlg=!0},updateRegexByRule(){this.showRegexDlg=!1,Array.from(this.docStore.record.tables[0].rows).forEach(((e,t)=>{Array.from(e.columns).forEach(((e,o)=>{e.name===this.selectedColumn&&e.hasOwnProperty("rule")&&e.hasOwnProperty("valuePattern")&&(this.docStore.record.tables[0].rows[t].columns[o].valuePattern=this.docStore.regex.get(e.rule))}))})),this.refactorApiData()},setShowRegexDlg(e){this.showRegexDlg=e},highliteFirstRowOfCurrentPage(){if(this.tableRowsLocationsMap.has("page_"+this.currentPageNo)){const e=this.tableRowsLocationsMap.get("page_"+this.currentPageNo),t=(0,na.$)("#tbl_row_"+e);t&&(this.scrollInToViewStart(t),setTimeout((()=>{t.classList.add("light-grey-with-effect"),setTimeout((()=>{t.classList.remove("light-grey-with-effect")}),1400)}),500))}},getBackgroundColor(e){let t="";return e.hasOwnProperty("is_auto_filled")&&1==e.is_auto_filled?t=this.is_auto_filled_color:e.hasOwnProperty("is_missing")&&1==e.is_missing&&(t=this.is_missing_color),t},displayFieldErrors(){this.refactorApiData()},updateColumnOrigin(e){if(!e||!e.hasOwnProperty("column_name")||!e.hasOwnProperty("origin"))return;if(""==e.column_name)return;if(""==e.language_origin)return;let t=!1;Array.from(this.docStore.record.tables[0].rows).forEach(((o,a)=>{Array.from(o.columns).forEach(((o,a)=>{o.name===e.column_name&&(o.col_origin=e.origin,t=!0)}))})),this.docStore.record.tables[0].formatting_options.column_origins[e.column_name]=e.origin,t&&this.requestReformate()}},computed:{filteredColumns(){if(""===this.searchColumn)return this.dropdownColumns;let e=[];const t=this.searchColumn.toLowerCase();return e=this.dropdownColumns.filter((e=>e.header.toLowerCase().indexOf(t)>-1)),e}},setup(){const e=(0,da.A)(),t=(0,ct.q3)(),{is_manual_training_allowed:o}=(0,Re.bP)(t),a=(0,ct.ky)(),{validation_done:i,missing_mapping_column:s}=(0,Re.bP)(a);let l=[],r={};const n=(0,qe.KR)("");return{searchColumn:(0,qe.KR)(""),is_manual_training_allowed:o,is_line_item_validated:i,missing_mapping_column:s,filter:n,docStore:t,headers:(0,qe.KR)(),lineitems:(0,qe.KR)(),move_extra_rows_to:(0,qe.KR)(""),header_rows_count:(0,qe.KR)(1),min_group_rows:(0,qe.KR)(1),max_group_rows:(0,qe.KR)(),distinct_group_column:(0,qe.KR)(!1),reverse_grouping:(0,qe.KR)(!1),group_column:(0,qe.KR)(""),column_mapping_indexes:(0,qe.KR)(r),columns_to_hide:(0,qe.KR)(l),custom_columns_to_hide:(0,qe.KR)(l),addFieldsDialog:(0,qe.KR)(!1),extra_columns:(0,qe.KR)(l),poEditRestrictDialog:(0,qe.KR)(!1),poEditRestrictMessage:(0,qe.KR)(""),new_field_model:(0,qe.KR)(r),new_column_model:(0,qe.KR)(r),revert_changes_confirm_dialog:(0,qe.KR)(!1),adv_column_options:l,advance_settings_columns:(0,qe.KR)([]),headerRowCountRules:[e=>null!==e||"Please type number",e=>e>0&&e<100||"Please type number"],showNotification(t){e.notify({message:t,color:"primary",position:"bottom"})},lineDataObj:(0,qe.KR)(l),lineItemsErrors:(0,qe.KR)(r),lineItemLayout:(0,qe.KR)(l),tableColumns:(0,qe.KR)(l),tableRows:(0,qe.KR)(l),formatting_options:(0,qe.KR)(r),addColumnDialog:(0,qe.KR)(!1),headerKey:(0,qe.KR)(""),headerLable:(0,qe.KR)(""),lineItemsloading:(0,qe.KR)(!0),openDisableColumnListView:(0,qe.KR)(!1),disableColumnList:(0,qe.KR)(l),split_text:(0,qe.KR)(!1),split_text_confirm_dialog:(0,qe.KR)(!1),tableRowsLocationsMap:(0,qe.KR)(new Map),layoutExtraColumns:(0,qe.KR)([])}}});var Ca=o(42315),xa=o(44488),Aa=o(57722),Ea=o(50492),Sa=o(10386),Fa=o(67837),La=o(45262),Da=o(857),Ia=o(58210),Ta=o(94940),Ra=o(88841),Oa=o(80460),Pa=o(67156),$a=o(84436);const qa=(0,gt.A)(ka,[["render",la]]),Va=qa;kt()(ka,"components",{QTable:Ca.A,QTr:xa.A,QTh:Aa.A,QBtnDropdown:Dt.A,QList:It.A,QItem:Tt.A,QItemSection:Rt.A,QItemLabel:Ot.A,QIcon:Ea.A,QSeparator:Sa.A,QInput:Fa.A,QTooltip:Lt.A,QTd:La.A,QBtn:Ft.A,QMarkupTable:Da.A,QSpinner:Ia.A,QDialog:_t.A,QCard:pt.A,QToolbar:Pt.A,QToolbarTitle:$t.A,QCardSection:bt.A,QSelect:Ta.A,QExpansionItem:Ra.A,QCheckbox:Oa.A,QCardActions:vt.A,QAvatar:ft.A,QField:Pa.A,QMenu:$a.A}),kt()(ka,"directives",{ClosePopup:wt.A});var Ma=o(12566),Na=o(96075),Xa=o(1435);const Wa=e=>((0,a.Qi)("data-v-487e1c9a"),e=e(),(0,a.jt)(),e),Qa={class:"image-decorator",ref:"image-area",id:"image_area"},za={id:"screenshot_container"},Ka=["src","width"],Ua=["onMousedown","onMousemove","id"],ja=["onClick"],Ba=["onClick"],Ha=Wa((()=>(0,a.Lk)("div",{class:"select-areas--delete_area"},null,-1))),Ya=[Ha],Ja=["id"],Ga=["area-tag","area-type"],Za=["area-tag","area-type","onClick"],ei={class:"c-crop--hide_main"},ti=["src","width"],oi={class:"text-h6"};function ai(e,t,o,l,r,n){const d=(0,a.g2)("Resizable"),c=(0,a.g2)("q-card-section"),u=(0,a.g2)("q-btn"),h=(0,a.g2)("q-card-actions"),m=(0,a.g2)("q-card"),g=(0,a.g2)("q-dialog"),_=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)("div",Qa,[(0,a.Lk)("div",za,[e.url?((0,a.uX)(),(0,a.CE)("img",{key:0,onLoad:t[0]||(t[0]=(...t)=>e.prepareImageData&&e.prepareImageData(...t)),id:"screenshot",class:"original-image",src:e.url,alt:"Original Image",width:e.width},null,40,Ka)):(0,a.Q3)("",!0),(0,a.Lk)("div",{class:"select-areas--overlay",style:(0,i.Tr)({opacity:e.opacityOverlay,position:"absolute",width:e.originImgSize.w+"px",height:e.originImgSize.h+"px",display:"block"})},null,4),!1===e.isRowMode?((0,a.uX)(),(0,a.CE)("div",{key:1,class:"pointer-events-none",id:"draw",style:(0,i.Tr)({"background-color":"rgb(0, 0, 0)",opacity:0,position:"absolute",width:e.originImgSize.w+"px",height:e.originImgSize.h+"px"}),onMousedown:t[1]||(t[1]=(...t)=>e.mouseDown&&e.mouseDown(...t)),onMousemove:t[2]||(t[2]=(...t)=>e.mouseMove&&e.mouseMove(...t))},null,36)):((0,a.uX)(),(0,a.CE)("div",{key:2,class:"pointer-events-none",id:"draw",style:(0,i.Tr)({"background-color":"rgb(0, 0, 0)",opacity:0,position:"absolute",width:e.originImgSize.w+"px",height:e.originImgSize.h+"px"})},null,4)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.areas,(t=>((0,a.uX)(),(0,a.CE)("div",{key:t.id},[!1===e.isRowMode?((0,a.uX)(),(0,a.CE)("div",{key:0,onMousedown:(0,s.D$)((o=>e.startMove(t,o)),["stop","prevent"]),onMousemove:o=>e.doMove(t,o),id:"draw_"+t.areaTag},[(0,a.Lk)("div",{class:"select-areas--outline",style:(0,i.Tr)({opacity:"column"===t.areaType?"1":e.opacityOutline,position:"absolute",cursor:"default",width:t.width+4+"px",height:t.height+4+"px",left:e.areaDisplayPosX(t)-2+"px",top:e.areaDisplayPosY(t)-2+"px","z-index":"column"===t.areaType?"2":t.z})},null,4),(0,a.Lk)("div",{class:"select-areas--background_area",style:(0,i.Tr)({background:t.background+`#fff url('${e.url}') -${t.x}px -${t.y}px / ${e.originImgSize.w}px ${e.originImgSize.h}px no-repeat`,position:"absolute",cursor:!0===e.enableEditing?"move":"pointer",width:t.width+"px",height:t.height+"px",left:e.areaDisplayPosX(t)+"px",top:e.areaDisplayPosY(t)+"px","z-index":t.z+2}),onClick:o=>e.changeResizable(t.id)},null,12,ja),t.resizable&&!0===e.enableEditing?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"delete-area",style:(0,i.Tr)({display:"block",left:e.areaDisplayPosX(t)+t.width+"px",top:e.areaDisplayPosY(t)-25+"px","z-index":t.z+2}),onClick:o=>e.deleteSelected(t.id)},Ya,12,Ba)):(0,a.Q3)("",!0),!0===e.enableEditing?((0,a.uX)(),(0,a.Wv)(d,{key:1,item:t,posImg:e.posImg,"pos-correction":e.posCorrection,onStartDrag:e.startDrag,onDoDrag:e.doDrag},null,8,["item","posImg","pos-correction","onStartDrag","onDoDrag"])):(0,a.Q3)("",!0)],40,Ua)):((0,a.uX)(),(0,a.CE)("div",{key:1,id:"draw_"+t.areaTag},[(0,a.Lk)("div",{class:(0,i.C4)(["select-areas--outline","column"==t.areaType?"column_outline":"row_outline"]),"area-tag":t.areaTag+"_border","area-type":t.areaType+"_border",style:(0,i.Tr)({opacity:.2,position:"absolute",cursor:"default",width:t.width+("column"==t.areaType?2:4)+"px",height:t.height+4+"px",left:e.areaDisplayPosX(t)-2+"px",top:e.areaDisplayPosY(t)-2+"px","z-index":"unset"})},null,14,Ga),(0,a.Lk)("div",{class:(0,i.C4)(["select-areas--background_area","column"==t.areaType?"column_background_area":"row_background_area"]),"area-tag":t.areaTag+"_area","area-type":t.areaType+"_area",onClick:o=>e.decideAction(t),style:(0,i.Tr)({background:t.background+`#fff url('${e.url}') -${t.x}px -${t.y}px / ${e.originImgSize.w}px ${e.originImgSize.h}px no-repeat`,position:"absolute",cursor:"pointer",width:t.width-("column"==t.areaType?3:0)+"px",height:t.height+"px",left:e.areaDisplayPosX(t)+"px",top:e.areaDisplayPosY(t)+"px","z-index":"unset",opacity:t.opacity})},null,14,Za)],8,Ja))])))),128))]),(0,a.Lk)("div",ei,[(0,a.Lk)("img",{id:"c-crop--hide_img",src:e.url,alt:"",width:e.width},null,8,ti)]),(0,a.bF)(g,{modelValue:e.correctionDialog,"onUpdate:modelValue":t[6]||(t[6]=t=>e.correctionDialog=t),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.k6)((()=>[(0,a.bF)(m,{class:"bg-teal text-white",style:{width:"300px"}},{default:(0,a.k6)((()=>[(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.Lk)("div",oi,(0,i.v_)(e.$t("confirmation")),1)])),_:1}),(0,a.bF)(c,{class:"q-pt-none"},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("is_draw_correct")),1)])),_:1}),(0,a.bF)(h,{align:"right",class:"bg-white text-teal"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(u,{flat:"",label:e.$t("pages.screen2a.cancel"),onClick:t[3]||(t[3]=t=>e.cancelAreaSelection())},null,8,["label"]),[[_]]),(0,a.bo)((0,a.bF)(u,{flat:"","data-cy":"no",label:e.$t("pages.screen2a.no"),onClick:t[4]||(t[4]=t=>e.reSelectArea())},null,8,["label"]),[[_]]),(0,a.bo)((0,a.bF)(u,{flat:"","data-cy":"yes",label:e.$t("pages.screen2a.yes"),onClick:t[5]||(t[5]=t=>e.saveSelectionResult())},null,8,["label"]),[[_]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],512)}var ii=o(57034),si=function(e,t,o,a){function i(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function l(e){try{n(a.next(e))}catch(t){s(t)}}function r(e){try{n(a["throw"](e))}catch(t){s(t)}}function n(e){e.done?o(e.value):i(e.value).then(l,r)}n((a=a.apply(e,t||[])).next())}))};let li,ri,ni,di={columns:[],table_areas:[]};const ci=(0,a.pM)({mixins:[ca.A,Me.A],data(){return{mousedown:(0,qe.KR)(!1),originImgSize:{w:0,h:0,r:0},url:this.cropUrl,posImg:{top:0,left:0},areas:[{id:1,x:10,y:10,startX:10,startY:10,width:10,height:10,z:0,resizable:!1,opacity:"1",background:st.je,areaTag:"table",areaType:"table",rowId:""}],currentSelectedItem:(0,qe.KR)(),latestAreaItem:{startX:0,startY:0,endX:0,endY:0},scrollLeft:0,scrollTop:0,moveTempX:0,moveTempY:0,moveCurrentX:0,moveCurrentY:0,temp:0,dragdown:!1,move:!1,imageHeight:0,imageWidth:0,correctionDialog:!1,numberOfAreas:0,oldArea:"",disableImageRowsClick:!1,delay:170,clicks:0,timer:(0,qe.KR)(),delay2:(0,qe.KR)(170),timer2:(0,qe.KR)()}},props:{cropUrl:{type:String,default:"https://dev.doc2api.cloudintegration.eu/resource/image/1b90b6d5-63b5-446b-92a4-a60d57dc0edd/1.png"},width:{type:Number,default:1500},opacityOutline:{type:Number,default:.2},opacityOverlay:{type:Number,default:.2},posCorrection:{type:Boolean,default:!0},tableAreas:{type:String,default:""},isRowMode:{type:Boolean,default:!1},enableEditing:{type:Boolean,default:!1}},components:{Resizable:ii.A},emits:["saveColumnCoords","toggleExtractedColumnMode"],watch:{cropUrl(e){this.url=e,setTimeout((()=>{this.setSize()}),200)},tableAreas(e){this.prepareDataForAreas()},width(e){return si(this,void 0,void 0,(function*(){yield this.setSize(),this.prepareImageData()}))}},methods:{areaDisplayPosX(e){return e.x+(this.posCorrection?this.posImg.left:0)},areaDisplayPosY(e){return e.y+(this.posCorrection?this.posImg.top:0)},mousePosX(e){return e.pageX-this.posImg.left},mousePosY(e){return e.pageY-this.posImg.top},setSize(){return si(this,void 0,void 0,(function*(){if(!this.url)return;let e=yield this.getSize(this.url);this.originImgSize=e}))},getSize(e){let t=this.$el.querySelector("#c-crop--hide_img");return new Promise((o=>{e&&t?(t.onload=function(){const e=li.getSizeImg(t);o(e)},t.src=e):o({w:0,h:0,r:0})}))},getSizeImg(e){let t=e.width,o=e.height,a=0===t&&0===o?0:t/o;return{w:t,h:o,r:a}},calcPosOfBox(){let e=this.$refs["image-area"];this.scrollLeft=window.pageXOffset||document.documentElement.scrollLeft,this.scrollTop=window.pageYOffset||document.documentElement.scrollTop;let t=e.getBoundingClientRect().top,o=e.getBoundingClientRect().left;this.posImg.top=t+this.scrollTop,this.posImg.left=o+this.scrollLeft},manageEventsForColumns(e){this.clicks++,1===this.clicks?this.timer=setTimeout((()=>{this.clicks=0,this.mouseDown(e);let t=(0,na.$)("#draw_"+this.oldArea).querySelector(".select-areas--background_area");t.style.cursor="crosshair",t.addEventListener("mousemove",this.mouseMove)}),this.delay):(this.clicks=0,clearTimeout(this.timer),this.dblClickToSelect(e))},mouseDown(e){this.mousedown=!0;let t=null;if(t=this.areas.length>0?this.areas.slice(-1).pop().id+1:1,this.numberOfAreas=t,0!=this.latestAreaItem.startX&&0!=this.latestAreaItem.startY&&!1===this.isRowMode){let o=this.latestAreaItem.startX,a=this.latestAreaItem.startY,i=e.layerX,s=e.layerY,l=i-o,r=s-a;(l<0||r<0)&&(i=o,s=a,o=e.layerX,a=e.layerY,l=i-o,r=s-a);let n={id:t,x:o,y:a,startX:o,startY:a,width:l,height:r,z:0,resizable:!1,opacity:"1",background:this.isRowMode?st.je:"",areaTag:this.isRowMode?"column":"table",areaType:this.isRowMode?"column":"table",rowId:""};return this.temp=n.id,this.areas.push(n),void(this.latestAreaItem={startX:0,startY:0,endX:0,endY:0})}if(t){let o={id:t,x:this.mousePosX(e),y:this.mousePosY(e),startX:this.mousePosX(e),startY:this.mousePosY(e),width:0,height:0,z:0,resizable:!1,opacity:"1",background:this.isRowMode?st.je:"",areaTag:this.isRowMode?"column":"table",areaType:this.isRowMode?"column":"table",rowId:""};this.areas.push(o),this.temp=o.id,this.latestAreaItem.startX=this.mousePosX(e),this.latestAreaItem.startY=this.mousePosY(e),this.latestAreaItem.endX=0,this.latestAreaItem.endY=0}},mouseMove(e){this.mousedown&&(this.areas.filter((e=>e.id===this.temp)).map((t=>{let o=e.pageX-this.posImg.left,a=e.pageY-this.posImg.top,i=t.startX-o,s=t.startY-a;i<0&&(i*=-1,o-=i),s<0&&(s*=-1,a-=s),t.x=o,t.y=a,t.width=i,t.height=s})),this.latestAreaItem={startX:0,startY:0,endX:0,endY:0})},mouseUp(){!0===this.isRowMode&&!1===this.disableImageRowsClick||(this.timer2=setTimeout((()=>{this.mousedown=!1,this.areas=this.areas.filter((e=>e.width>=3&&e.height>=3)),this.endMove(),this.endDrag(),this.prepareTableArea(),!0===this.isRowMode&&!0===this.findAreaById(this.numberOfAreas)&&(this.correctionDialog=!0)}),this.delay2))},changeResizable(e){this.areas.filter((t=>t.id===e)).map((e=>{e.resizable=!0,e.z=100})),this.areas.filter((t=>t.id!==e)).map((e=>{e.resizable=!1,e.z=0}))},deleteSelected(e){this.areas=this.areas.filter((t=>t.id!==e)),this.prepareTableArea()},findAreaById(e){let t=!1;for(let o of this.areas)if(o.id===e){t=!0;break}return t},deleteSelectedColumn(e){const t=new CustomEvent("delete_select_area_column",{});document.dispatchEvent(t)},validateColumn(e){const t=new CustomEvent("validate_selected_column",{});document.dispatchEvent(t)},startDrag(){this.dragdown=!0},doDrag(e,t,o){if(this.dragdown)switch(t){case"w":o.pageX-this.posImg.left>=0&&(e.width=e.width+e.x-o.pageX+this.posImg.left,e.x=o.pageX-this.posImg.left),e.width<10&&(e.x=e.x-10,e.width=e.width+10);break;case"sw":o.pageX-this.posImg.left>=0&&(e.width=e.width+e.x-o.pageX+this.posImg.left,e.x=o.pageX-this.posImg.left),o.pageY-this.posImg.top<=this.originImgSize.h&&(e.height=o.pageY-this.posImg.top-e.y),e.width<10&&(e.x=e.x-10,e.width=e.width+10),e.height<10&&(e.height=e.height+10);break;case"s":o.pageY-this.posImg.top<=this.originImgSize.h&&(e.height=o.pageY-this.posImg.top-e.y),e.height<10&&(e.height=e.height+10);break;case"se":o.pageX-this.posImg.left<=this.originImgSize.w&&(e.width=o.pageX-this.posImg.left-e.x),o.pageY-this.posImg.top<=this.originImgSize.h&&(e.height=o.pageY-this.posImg.top-e.y),e.width<10&&(e.x=e.x-10,e.width=e.width+10),e.height<10&&(e.height=e.height+10);break;case"e":o.pageX-this.posImg.left<=this.originImgSize.w&&(e.width=o.pageX-this.posImg.left-e.x),e.width<10&&(e.x=e.x-10,e.width=e.width+10);break;case"ne":o.pageX-this.posImg.left<=this.originImgSize.w&&(e.width=o.pageX-this.posImg.left-e.x),o.pageY-this.posImg.top>=0&&(e.height=e.height+(e.y+this.posImg.top-o.pageY),e.y=o.pageY-this.posImg.top),e.width<10&&(e.x=e.x-10,e.width=e.width+10),e.height<10&&(e.height=e.height+10);break;case"n":o.pageY-this.posImg.top>=0&&(e.height=e.height+(e.y+this.posImg.top-o.pageY),e.y=o.pageY-this.posImg.top),e.height<10&&(e.height=e.height+10);break;case"nw":o.pageY-this.posImg.top>=0&&(e.height=e.height+(e.y+this.posImg.top-o.pageY),e.y=o.pageY-this.posImg.top),o.pageX-this.posImg.left>=0&&(e.width=e.width+e.x-o.pageX+this.posImg.left,e.x=o.pageX-this.posImg.left),e.width<10&&(e.x=e.x-10,e.width=e.width+10),e.height<10&&(e.height=e.height+10);break;default:break}},endDrag(){this.dragdown=!1},startMove(e,t){!0===this.enableEditing?(this.move=!0,this.moveTempX=t.clientX,this.moveTempY=t.clientY,this.moveCurrentX=e.x,this.moveCurrentY=e.y):this.move=!0},doMove(e,t){if(!1!==this.enableEditing&&this.move){let o=this.moveCurrentX+(t.clientX-this.moveTempX),a=this.moveCurrentY+(t.clientY-this.moveTempY),i=this.originImgSize.w-e.width,s=this.originImgSize.h-e.height;o>0&&a>0&&o<i&&a<s&&(e.x=o,e.y=a)}},endMove(){this.move=!1},creatReactangle(e,t,o,a,i,s,l,r,n){let d=null;if(d=this.areas.length>0?this.areas.slice(-1).pop().id+1:1,d){let c={id:d,x:e,y:t,startX:e,startY:t,width:o,height:a,z:0,resizable:!1,opacity:s,background:l,areaTag:i,areaType:n,rowId:r};this.areas.push(c),this.temp=c.id}},prepareImageData(){ni=(0,na.$)("#screenshot"),ni&&(this.imageWidth=ni.offsetWidth,this.imageHeight=ni.offsetHeight,this.prepareDataForAreas())},prepareDataForAreas(){this.removeExistingConfirmationOverlays(),this.areas=[],this.isRowMode?(this.delay2=170,this.disableImageRowsClick=!1,this.disableSelectionForRow(this.oldArea),this.prepareRowAreas()):(this.delay2=1,this.prepareTableAreas())},prepareCustomizedAreas(){this.areas=[],this.prepareTableAreas(),this.prepareRowAreas()},prepareRowAreas(){if(at.A.has("table_rows_data")&&null!=at.A.getItem("table_rows_data")&&""!=at.A.getItem("table_rows_data")){let e=at.A.getItem("table_rows_data");di=JSON.parse(e)}else di={columns:[],table_areas:[]};let e=[];di&&di.table_areas.length>0&&Array.from(di.table_areas).forEach((t=>{e=t.coord.split(",");let o=Math.round(this.imageWidth*e[0]),a=Math.round(this.imageHeight*e[1]),i=Math.round(this.imageWidth*e[2]),s=Math.round(this.imageHeight*e[3]),l=i-o,r=s-a,n=t.id,d=t.opacity,c=t.background,u=t.type,h=t.row_id;this.creatReactangle(o,a,l,r,n,d,c,h,u)}))},prepareTableAreas(){if(at.A.has("table_data")&&null!=at.A.getItem("table_data")&&""!=at.A.getItem("table_data")){let e=at.A.getItem("table_data");di=JSON.parse(e)}else di={columns:[],table_areas:[]};let e=[];di&&di.table_areas.length>0&&Array.from(di.table_areas).forEach((t=>{e=t.split(",");let o=this.getCoordinate(e[0]),a=this.getCoordinate(e[1]),i=this.getCoordinate(e[2]),s=this.getCoordinate(e[3]);o=Math.round(this.imageWidth*o),a=Math.round(this.imageHeight*a),i=Math.round(this.imageWidth*i),s=Math.round(this.imageHeight*s);let l=i-o,r=s-a;l<0&&(l*=-1,o-=l),r<0&&(r*=-1,a-=r);let n="table_"+Math.floor(1e5*Math.random());this.creatReactangle(o,a,l,r,n,"1","","","table")}))},getCoordinate(e){return e<0?0:e>1?1:e},getTableAreaAsString(e,t,o,a){let i=e/this.imageWidth,s=t/this.imageHeight,l=o/this.imageWidth,r=a/this.imageHeight;return i.toString()+","+s.toString()+","+l.toString()+","+r.toString()},prepareTableArea(){di.table_areas=[],Array.from(this.areas).forEach((e=>{let t=e.width+e.x,o=e.height+e.y;di.table_areas.push(this.getTableAreaAsString(e.x,e.y,t,o))})),!1===this.isRowMode&&at.A.set("table_data",JSON.stringify(di))},calculateLeftPosition(e){let t=this.areaDisplayPosX(e)+e.width;return t+50>=this.imageWidth&&(t=this.areaDisplayPosX(e)-60),t+"px"},calculatePositionFromTop(e){let t=this.areaDisplayPosY(e)-25;return t<0&&(t=this.areaDisplayPosY(e)),t+"px"},cancelAreaSelection(){this.deleteSelected(this.numberOfAreas),this.correctionDialog=!1,this.numberOfAreas=0,this.disableSelectionForRow(this.oldArea)},reSelectArea(){this.deleteSelected(this.numberOfAreas),this.correctionDialog=!1,this.numberOfAreas=0,setTimeout((()=>{let e=(0,na.$)("#draw_"+this.oldArea).querySelector(".select-areas--background_area");e.style.cursor="crosshair"}),10)},saveSelectionResult(){if(di.table_areas.length>0){this.correctionDialog=!1,this.disableImageRowsClick=!1;let e,t=di.table_areas[di.table_areas.length-1];e=t.hasOwnProperty("coord")?t.coord:t,this.disableSelectionForRow(this.oldArea),this.numberOfAreas=0,this.$emit("saveColumnCoords",e)}},decideAction(e){let t=e.areaTag,o=e.areaType,a=e.rowId;if(this.currentSelectedItem=e,this.removeExistingConfirmationOverlays(),!0!==this.disableImageRowsClick)if(this.disableSelectionForRow(this.oldArea),"column"===o){this.numberOfAreas=0;let e=(0,na.$)("#screenshot_container"),o=e.querySelectorAll("div.column_background_area");Array.from(o).forEach((e=>{let t=e.style.background.split("100%)");e.style.background=st.I7+t[1]}));let i=e.querySelectorAll("div.column_outline");Array.from(i).forEach((e=>{e.style.opacity="0.2",e.nextSibling&&(e.nextSibling.style.border="unset")})),this.oldArea=a;let s=(0,na.$)("#input_"+t+"_"+a);if(s){let e=(0,na.$)("#draw_"+t),o=e.querySelector(".select-areas--outline");o.style.opacity="0";let a=document.querySelector("#line_item_table").querySelectorAll("label.active-border-2px");Array.from(a).forEach((e=>{e.classList.remove("active-border-2px")}));let i=e.querySelector(".select-areas--background_area");i.style.border="2px",i.style.borderStyle="solid",i.style.borderColor="#8800ff",s.scrollIntoView(),s.querySelector("label").classList.add("active-border-2px");let l=s.querySelector("label.extraction_method");if(null!=l){let e=s.dataset.columnValue,t=s.dataset.scoreDescription,o={value:e,score:t,selection:i};this.prepareOverlay({detail:o})}}}else{this.numberOfAreas=0;let e=document.getElementById(t);if(e.classList.add("active-table-row"),""!=this.oldArea){let e=document.getElementById(this.oldArea);e.classList.remove("active-table-row")}let o={rowId:t,columnName:null};const a=new CustomEvent("get_table_rows_areas",{detail:o});document.dispatchEvent(a),this.oldArea=t}},enableSelectionForRow(e){this.disableImageRowsClick=!0,this.disableSelectionForRow(this.oldArea);let t=e.detail;this.oldArea=e.detail;let o=(0,na.$)("#draw_"+t).querySelector(".select-areas--background_area");o.style.cursor="crosshair",o.addEventListener("mousedown",this.manageEventsForColumns)},disableSelectionForRow(e){if(""!=e&&(0,na.$)("#draw_"+e)){let t=(0,na.$)("#draw_"+e).querySelector(".select-areas--background_area");t.style.cursor="pointer",t.removeEventListener("mousedown",this.manageEventsForColumns),t.removeEventListener("mousemove",this.mouseMove)}},dblClickToSelect(e){this.disableSelectionForRow(this.oldArea);let t=this.getTableAreaAsString(this.mousePosX(e),this.mousePosY(e),this.mousePosX(e),this.mousePosY(e));this.$emit("saveColumnCoords",t)},prepareOverlay(e){let t=e.detail.value,o=e.detail.score,a=e.detail.selection,i=null;null!=o&&""!==o&&(i={score:o,background:this.getColor(Number(o))}),this.drawOverlay(String(t),a,i)},drawOverlay(e,t,o){var a,i,s;this.removeExistingConfirmationOverlays();const l=this.getOffset(t),r=document.createElement("div");r.setAttribute("id","confirmation_overlay"),r.style.position="absolute",r.style.zIndex="99999",r.style.left=l.left+"px",r.style.top=(+l.top+ +l.height+6).toString()+"px",r.style.background="#ffffff",r.style.color="#898989",r.style.minHeight="65px",r.style.minWidth="100px",r.style.maxWidth=.75*this.imageWidth+"px",r.style.textAlign="center",r.style.padding="5px 10px 5px 10px",r.style.letterSpacing="1px",r.style.borderRadius="7px",r.style.boxShadow="0 1px 2px rgba(0,0,0,0.07),\n      0 2px 4px rgba(0,0,0,0.07),\n      0 4px 8px rgba(0,0,0,0.07),\n      0 8px 16px rgba(0,0,0,0.07),\n      0 16px 32px rgba(0,0,0,0.07),\n      0 32px 64px rgba(0,0,0,0.07);",r.innerHTML=`<div>\n                    <div><b>${e}</b></div>\n                    <div>\n                    <span id='divOverlayWrong'>\n                      <i style='display: inline-block;border-radius: 50px;box-shadow: 0px 0px 2px #888;padding: 0.5em 0.6em;cursor:pointer;' class='fa fa-times'></i>\n                    </span>\n                    <span id='divOverlayCorrect'>\n                      <i style='display: inline-block;border-radius: 50px;box-shadow: 0px 0px 2px #888;padding: 0.5em 0.5em;cursor:pointer;' class='fas fa-check'></i>\n                    </span></div>\n                  </div>`,document.body.appendChild(r),null===(a=(0,na.$)("#divOverlayCorrect"))||void 0===a||a.addEventListener("click",(e=>{this.removeExistingConfirmationOverlays(),this.validateColumn(this.currentSelectedItem)})),null===(i=(0,na.$)("#divOverlayWrong"))||void 0===i||i.addEventListener("click",(e=>{this.removeExistingConfirmationOverlays(),this.deleteSelectedColumn(this.currentSelectedItem)}));try{const e=(0,na.$)("#confirmation_overlay"),a=null===(s=(0,na.$)("#confirmation_overlay"))||void 0===s?void 0:s.clientWidth,i=l.width,n=(+a-+i)/2;e.style.left=+l.left-+n+"px";let d=+t.getAttribute("width")+ +t.getAttribute("y")+e.offsetHeight;d>=ni.offsetHeight&&(r.style.top=(+l.top-6-+e.offsetHeight).toString()+"px"),o&&setTimeout((()=>{this.overlayForScore(e,o)}),10)}catch(n){}},overlayForScore(e,t){let o=t.score,a=t.background;const i=this.getOffset(e),s=document.createElement("div");s.setAttribute("id","score_overlay"),s.style.position="absolute",s.style.zIndex="99999",s.style.left=(+i.left+i.width+6).toString()+"px",s.style.top=(+i.top-15).toString()+"px",s.style.background=a,s.style.color="#898989",s.style.fontSize="14px",s.style.fontWeight="bold",s.style.letterSpacing="2px",s.style.cursor="pointer",s.style.padding="0.1em 0.6em",s.style.border="1px solid #f5f5f5",s.style.borderRadius="50px",s.innerHTML=`<div> <span  class='column-score-test' > ${o} </span> </div>`,document.body.appendChild(s)},getOffset(e){const t=e.getBoundingClientRect();return{left:t.left+window.pageXOffset,right:t.right+window.pageXOffset,top:t.top+window.pageYOffset,width:t.width||e.offsetWidth,height:t.height||e.offsetHeight}},handleScroll(){this.removeExistingConfirmationOverlays()}},mounted(){li=this,this.setSize(),ri=(0,na.$)("#image_area"),ri.addEventListener("mousemove",this.calcPosOfBox),ri.addEventListener("scroll",this.calcPosOfBox),this.calcPosOfBox(),ri.addEventListener("mouseup",this.mouseUp),document.addEventListener("prepare_overlay",this.prepareOverlay),document.addEventListener("reset_table_areas",this.prepareDataForAreas),document.addEventListener("enable_column_selection",this.enableSelectionForRow),document.addEventListener("prepare_customized_areas",this.prepareCustomizedAreas),(0,na.$)("#image_container").parentElement.addEventListener("scroll",this.handleScroll)},unmounted:function(){ri.removeEventListener("mousemove",this.calcPosOfBox),ri.removeEventListener("scroll",this.calcPosOfBox),ri.removeEventListener("mouseup",this.mouseUp),document.removeEventListener("prepare_overlay",this.prepareOverlay),document.removeEventListener("reset_table_areas",this.prepareDataForAreas),document.removeEventListener("prepare_customized_areas",this.prepareCustomizedAreas),document.removeEventListener("enable_column_selection",this.enableSelectionForRow);let e=(0,na.$)("#image_container");if(e){let t=e.parentElement;t&&t.removeEventListener("scroll",this.handleScroll)}},setup(){return{}}}),ui=(0,gt.A)(ci,[["render",ai],["__scopeId","data-v-487e1c9a"]]),hi=ui;kt()(ci,"components",{QDialog:_t.A,QCard:pt.A,QCardSection:bt.A,QCardActions:vt.A,QBtn:Ft.A}),kt()(ci,"directives",{ClosePopup:wt.A});var mi=o(92867),gi=function(e,t,o,a){function i(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function l(e){try{n(a.next(e))}catch(t){s(t)}}function r(e){try{n(a["throw"](e))}catch(t){s(t)}}function n(e){e.done?o(e.value):i(e.value).then(l,r)}n((a=a.apply(e,t||[])).next())}))};let _i=new Map,pi={columns:[],table_areas:[]};const bi=document.querySelector.bind(document);let fi;const vi=(0,a.pM)({el:"#app",mixins:[Ne.A,Pe.A,lt.A,Oe.A,Me.A],components:{Loader:Ve.A,invoiceSaveExport:Mt,LineItemsTblExtV3:Va,AIDialGauge:Ht,autoTesting:Yt.A,DocumentLock:Gt.A,MessageBanner:Zt.A,Classification:Nt.A,DeleteRulesBtn:xt,ErrorDocumentView:Ma.A,MultiSelectAreasImageTblV3:hi,scriptBtn:Xa.A,IgnoreTableValidation:mi.A},data(){return{draggingColumnEl:{},deleteColumnInfo:{},enableEditing:!1,enableColumnEditing:!1,imageHeight:0,imageWidth:0,viewBox:"0 0 0 0",enableExportButton:!1,purchaseOrderColumns:[],purchaseOrderData:[],closeEnough:6,dragTL:!1,dragBL:!1,dragTR:!1,dragBR:!1,rect:{},current_zoom:1,account_block:"",extractedData:"",currentColumnName:"",currentRowId:"",debounceAutoSaveFunc:{}}},watch:{training_mode(e){!1===e&&(this.persistTableAreas(),this.restrictDrawing(),this.setTableMode())},$route(e,t){if(!e.hasOwnProperty("path")||!t.hasOwnProperty("path"))return;const o=e.path.split("/"),a=t.path.split("/");o.length>2&&a.length>2&&o[1]===a[1]&&this.get_cached_data_id!=this.docId&&window.location.reload()}},mounted(){this.init(),this.isDebugFlagHandler(),document.addEventListener("update_table_data",this.updateTableDataForSave),document.addEventListener("delete_select_area_column",this.deleteColumnDataForReSelection),document.addEventListener("validate_selected_column",this.validateSelectedColumn),document.addEventListener("disable_all_modes",this.diableAllModes),document.addEventListener("rules_deleted",this.rulesDeleted),document.addEventListener("perform_split_text",this.callSplitTextAction),window.tblExtV3=this,this.debounceAutoSaveFunc=(0,eo.A)((()=>{this.saveDataOnChanges()}),1e3)},unmounted:function(){window.removeEventListener("resize",this.windowResize),document.removeEventListener("update_table_data",this.updateTableDataForSave),document.removeEventListener("delete_select_area_column",this.deleteColumnDataForReSelection),document.removeEventListener("validate_selected_column",this.validateSelectedColumn),document.removeEventListener("disable_all_modes",this.diableAllModes),document.removeEventListener("rules_deleted",this.rulesDeleted),document.removeEventListener("rules_deleted",this.rulesDeleted),document.removeEventListener("perform_split_text",this.callSplitTextAction),this.clearViewForUnmount()},methods:{goHelp(){window.open("https://docs.fellowpro.com/DocBits/table-extraction/training-of-table-extraction/")},init(){return gi(this,void 0,void 0,(function*(){if(this.isDocForTraining(),yield this.handleTokenForExternalUser(),!0===this.table_train){if(this.setDocLockStoreDisable(),this.docId=String(this.$route.query.id),yield this.getTrainingData(),!this.record||0===Object.keys(this.record).length||!1===this.record.success)return void this.handleException()}else{if(this.docId=String(this.$route.params.id),this.$route.params.id||this.$router.push("/dashboard"),yield this.getInvoiceDataByDocId(),!this.record||0===Object.keys(this.record).length||!1===this.record.success)return void this.handleException();this.setTableTrainingFlag();const e=new CustomEvent("init_line_items",{detail:this.record});document.dispatchEvent(e)}this.handleBlockedSupplier(),this.account_block||(window.addEventListener("resize",this.windowResize),this.handleAiTableWarning(),this.handleReadOnly(),this.handleDocLockSubscribe(),this.isReadOnly?(this.error_message=this.$t("pages.messages.READ_ONLY_MSG"),this.error_class="error-banner",this.trigger_document_lock=!1):this.trigger_document_lock=!0,this.imageWidth=bi("#image_container").offsetWidth-15,at.A.set("table_data",""),at.A.set("table_rows_data",""),this.initPage())}))},handleTokenForExternalUser(){return gi(this,void 0,void 0,(function*(){const e=!0===this.table_train?String(this.$route.query.token):"";yield this.setAuthToken(e),this.table_train&&(this.ignore_token_validation=!0),this.getTokenQueryParam()}))},restoreDeleteColumn(){if(this.isReadOnly)return;const e=new CustomEvent("restore_delete_column",{});document.dispatchEvent(e)},handleAiTableWarning(){this.has_ai_table&&(this.ai_table_warning=!0)},handleException(){this.isReadOnly=!0,this.error_message=this.$t("pages.messages.INVALID_DOCUMENT"),this.error_class="error-banner"},doManualTraining(){this.ai_table_warning&&(this.ai_table_warning=!1,this.deleteAllExtractedData(),this.setManualTraining(!0))},handleDocLockSubscribe(){const e=(0,ct.oI)();e.$subscribe(((e,t)=>{this.isReadOnly=!this.doc_lock.success,this.handleReadOnly()}))},handleReadOnly(){if(st.B2.includes(this.record.status))return void(this.isReadOnly=!0);const e=$e.tH.hasAccess("update");e||(this.isReadOnly=!0)},isDocForTraining(){this.$route.params.table_train&&"true"===this.$route.params.table_train&&(this.table_train=!0)},setTableTrainingFlag(){!0===this.table_train&&(this.record.is_table_training_doc=!0)},getToken(){return this.token},getTrainingData(){return gi(this,void 0,void 0,(function*(){try{let e;if(e=yield this.getTrainingDataByDocId(),!e||!e.data)throw e;if(!1===e.data.success&&this.api_tries<1&&(this.api_tries++,e=yield this.getTrainingDataByDocId()),!1===e.data.success||!e.data.data||!e.data.data.doc_id)throw e;this.record=e.data.data,this.record.token=this.token,this.is_manual_training_allowed=!0,this.setTableTrainingFlag();const t=new CustomEvent("init_line_items",{detail:this.record});document.dispatchEvent(t)}catch(e){}finally{this.hideLoading()}}))},getTrainingDataByDocId(){return gi(this,void 0,void 0,(function*(){let e;this.showLoading();try{let t=this.getToken();e=yield Ie.A.get((0,ut.MV)(Te.FH.get_table_train_data+this.docId+"&version=v3"),{headers:{Authorization:t}})}catch(t){}return e}))},getInvoiceDataByDocId(){return gi(this,void 0,void 0,(function*(){try{if(this.record.doc_id==this.docId)return;this.showLoading(),this.record=[],this.clearSelectedSessionStorage();this.docId;yield this.getDocumentById(this.docId)}catch(e){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},initPage(){this.page=1,this.handleImageBaseURL(),this.image=this.baseUrl+"/"+(0,Na.v)(this.record.images[0].path),this.images=(0,Na.m)(this.record.images),at.A.set("table_data",""),_i=new Map,this.record.tables&&this.record.tables[0]&&this.record.tables[0].locations_list&&this.record.tables[0].locations_list[0]&&this.prepareTableMap(this.record.tables[0].locations_list),this.document_version=this.record.document_version?this.record.document_version:1,window.addEventListener("keydown",(e=>{27===e.keyCode&&this.restrictDrawing()})),at.A.has("enableExportButton")?this.enableExportButton=at.A.getItem("enableExportButton"):this.enableExportButton=!1,this.$forceUpdate(),this.setTableVersion(),this.getAI_IndicatorData(),this.getExtractedColumns(),this.fetchLanguageOptions(),this.confirmationForPoConnectionReset=!1},setTableVersion(){let e=(0,Jt.PL)("TBL_EXT_VERSION");this.record.tables&&0!=this.record.tables.length?(this.record.tables[0].hasOwnProperty("version")&&"v3"==this.record.tables[0].version&&(this.tb_version="v3"),this.setPoMatchingData()):void 0!==e&&""!=e&&"Version3"==e&&(this.tb_version="v3")},getAI_IndicatorData(){return gi(this,void 0,void 0,(function*(){try{let e;if(this.setTableCountForAIIndicator(),!this.record.filter_values||!(this.record.filter_values.length>0)||!Array.isArray(this.record.filter_values))throw"getAI_IndicatorData () no filter_values or doc_type to proceed";let t="?doc_type="+this.record.doc_type+"&filter_values="+this.record.filter_values.join(),o=this.getToken(),a=new FormData;if(a.append("org_id",(0,ut.I)()),e=yield Ie.A.post(Te.FH.get_ai_score+t,a,{headers:{Authorization:o}}),!1===e.data.success)throw e.data.message;if(!0===e.data.success){this.ai_rules=e.data.table_rules;const t=new CustomEvent("TE_gauge_calculation",{detail:e.data});document.dispatchEvent(t)}}catch(e){}}))},setTableCountForAIIndicator(){let e=0;this.record&&this.record.tables&&Array.isArray(this.record.tables)&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("rows")&&Array.isArray(this.record.tables[0].rows)&&this.record.tables[0].rows.length>0&&(e=1),this.ai_tables=e},setPoMatchingData(){const e=new CustomEvent("po_info",{detail:{tb_version:this.tb_version,po_enable:this.po_enable}});document.dispatchEvent(e)},handleBlockedSupplier(){this.account_block="",!this.record.hasOwnProperty("table_blocked")||1!=this.record.table_blocked&&"true"!=this.record.table_blocked||(this.account_block="table_blocked"),!this.record.hasOwnProperty("table_extraction_disabled")||1!=this.record.table_extraction_disabled&&"true"!=this.record.table_extraction_disabled||(this.account_block="table_extraction_disabled"),!this.record.hasOwnProperty("table_not_supported")||1!=this.record.table_not_supported&&"true"!=this.record.table_not_supported||(this.account_block="table_not_supported"),"ELECTRONIC_DOCUMENT"==this.record.extraction_method&&(this.account_block="table_extraction_disabled")},toggler(){this.toggleMenu(),this.windowResize()},back(){this.record.hasOwnProperty("has_layout")&&"true"===String(this.record.has_layout)&&this.$router.push("/field_validation_v1/"+this.$route.params.id)},imageClicked(e){this.loadNewPageImage(e.target.dataset.id)},loadNewPageImage(e){this.persistTableAreas(),this.image=this.baseUrl+"/"+(0,Na.v)(this.record.images[e].path),this.page=parseInt(e)+1,!0===this.isRowMode?setTimeout((()=>{const e=new CustomEvent("get_table_rows_areas",{});document.dispatchEvent(e)}),10):(this.loadNewPageTableAreas(),this.isExtractedColumnMode),this.resizeSelectableColumns(),this.$forceUpdate()},persistTableAreas(){if(at.A.has("table_data")&&null!=at.A.getItem("table_data")&&""!=at.A.getItem("table_data")){let e=at.A.getItem("table_data");pi=JSON.parse(e),pi&&pi.table_areas&&pi.table_areas.length?_i.set(this.page.toString(),JSON.stringify(pi)):_i.delete(this.page.toString())}else _i.delete(this.page.toString())},loadNewPageTableAreas(){pi=_i.has(this.page.toString())?JSON.parse(_i.get(this.page.toString())):{columns:[],table_areas:[]},this.tableAreasStr=JSON.stringify(pi),at.A.set("table_data",this.tableAreasStr)},prepareTableMap(e){_i=new Map,e&&Array.from(e).forEach((e=>{if(e){let t={columns:[],table_areas:e.coords};_i.set(e.page.toString(),JSON.stringify(t))}})),this.loadNewPageTableAreas()},selectAreaToExtratctText(e=!1){this.enableDrawing()},enableDrawing(){this.enableEditing=!0;const e=bi("#draw");null===e||void 0===e||e.classList.add("cursor-crosshair"),null===e||void 0===e||e.classList.remove("pointer-events-none"),this.disableColumnEditing(),this.setTableMode()},restrictDrawing(){this.enableEditing=!1;const e=bi("#draw");null===e||void 0===e||e.classList.add("pointer-events-none"),null===e||void 0===e||e.classList.remove("cursor-crosshair")},windowResize(){this.persistTableAreas();let e=bi("#image_container");this.imageWidth=e.offsetWidth,setTimeout((()=>{fi=bi("#screenshot"),fi&&(this.imageHeight=fi.offsetHeight),this.$forceUpdate(),this.resizeSelectableColumns()}),10)},resizeSelectableColumns(){let e=document.querySelectorAll(".draggable-column");for(var t=0;t<e.length;t++){let o=e[t],a=o.dataset.normalized_value,i=+a*this.imageWidth;this.page==Number(o.dataset.page_no)||"all"==o.dataset.page_no?(o.style.display="block",o.style.left=i.toString()+"px",o.style.height=String(this.imageHeight)+"px"):o.style.display="none"}},addColumnForAll(e){e.stopPropagation();const t=document.querySelectorAll(".draggable-column");if(0!=t.length)for(var o=0;o<t.length;o++){let e=t[o];if(e.dataset.page_no!==this.page.toString()&&"all"!==e.dataset.page_no){e.remove();continue}let a=e.dataset.normalized_value,i=+a*this.imageWidth;e.style.left=i.toString()+"px",e.dataset.page_no="all",e.style.display="block"}else this.showErrorToast("No column detected")},disableColumnEditing(){this.enableColumnEditing=!1,this.draggingColumnEl=null,this.deleteColumnInfo=null,document.removeEventListener("pointermove",this.repositionColumn),document.removeEventListener("pointerup",this.columnStopDrag)},reDrawColumns(e,t){if(!e||e.length<1)return;this.deleteColumnInfo=null,this.persistTableAreas(),this.restrictDrawing(),this.setTableMode();let o=bi("#screenshot_container");fi=bi("#screenshot"),this.imageWidth=fi.offsetWidth,this.imageHeight=fi.offsetHeight,Array.from(e).forEach((e=>{let a=+e*this.imageWidth;var i=document.createElement("div");i.className="draggable-column",i.style.height=String(this.imageHeight)+"px",i.style.left=a.toString()+"px",i.dataset.parent_class="screenshot",i.dataset.page_no=t.toString(),i.dataset.normalized_value=e,o.appendChild(i),i.addEventListener("pointerdown",this.pointerDownDraggableColumn,!1)}))},addColumn(e){this.enableColumnEditing=!0,this.deleteColumnInfo=null,this.persistTableAreas(),this.restrictDrawing(),this.setTableMode(),e.stopPropagation();let t=bi("#screenshot_container");fi=bi("#screenshot"),this.imageWidth=fi.offsetWidth,this.imageHeight=fi.offsetHeight;let o=this.getNewColPosOffset(this.page);var a=document.createElement("div");a.className="draggable-column",a.style.height=String(this.imageHeight)+"px",a.style.left=o.toString()+"px",a.dataset.parent_class="screenshot",a.dataset.page_no=void 0!==e.page?e.page:this.page.toString(),a.dataset.normalized_value=(o/this.imageWidth).toString(),t.appendChild(a),a.addEventListener("pointerdown",this.pointerDownDraggableColumn,!1)},getNewColPosOffset(e){let t=0,o=0;const a=bi("#screenshot"),i=document.querySelectorAll(".draggable-column"),s=a.offsetWidth-a.offsetLeft;if(i.length){let o=null;for(var l=0;l<i.length;l++){let t=i[l];e!=Number(t.dataset.page_no)&&"all"!=t.dataset.page_no||(o=t)}o&&(t=parseInt(o.style.left))}return t+25>s&&(t=0),o=t+25,o},removeDraggableColumn(e){this.draggingColumnEl=null,this.deleteColumnInfo=null,e.target.remove()},pointerDownDraggableColumn(e){if(e.preventDefault(),e.target.clicks++,setTimeout((function(){e.target.clicks=0}),400),2===e.target.clicks)return this.removeDraggableColumn(e),void(e.target.clicks=0);this.columnDragStart(e)},columnDragStart(e){let t=e.target.offsetLeft,o=e.target.offsetTop,a=e.clientX,i=e.clientY;this.draggingColumnEl={el:e.target,initX:t,initY:o,mousePressX:a,mousePressY:i},this.deleteColumnInfo={event:e},document.addEventListener("pointermove",this.repositionColumn,!1),document.addEventListener("pointerup",this.columnStopDrag,!1)},columnStopDrag(e){this.draggingColumnEl=null;let t=bi("#image_container");if(!t)return;let o=t.querySelectorAll(".draggable-column");for(var a=0;a<o.length;a++){o[a].removeEventListener("pointermove",this.repositionColumn,!1);let e=o[a].style.left.replace("px","");o[a].dataset.normalized_value=(+e/this.imageWidth).toString()}},repositionColumn(e){if(!(this.draggingColumnEl&&this.draggingColumnEl.initX&&this.draggingColumnEl.mousePressX))return;let t=this.draggingColumnEl.el.dataset.parent_class,o=bi("#"+t);if(o){this.deleteColumnInfo=null;var a=o.getBoundingClientRect();e.clientX>=a.left?this.draggingColumnEl.el.style.left=this.draggingColumnEl.initX+e.clientX-this.draggingColumnEl.mousePressX+"px":this.draggingColumnEl.el.style.left=Math.floor(5*o.offsetWidth/100)+"px"}},removeAllColumns(){this.deleteColumnInfo=null,this.draggingColumnEl=null;const e=document.querySelectorAll(".draggable-column");if(0!=e.length)for(var t=0;t<e.length;t++)e[t].remove()},isColumnSelectedForDelete(){return!(!this.deleteColumnInfo||0===Object.keys(this.deleteColumnInfo).length||!this.deleteColumnInfo.event)},removeSelectedColumn(e){this.deleteColumnInfo&&0!==Object.keys(this.deleteColumnInfo).length&&this.deleteColumnInfo.event?(this.removeDraggableColumn(this.deleteColumnInfo.event),this.deleteColumnInfo=null):this.deleteColumnInfo=null},getExtractedColumns(){this.extracted_columns=[],this.record&&this.record.tables&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("extraction_info")&&this.record.tables[0].extraction_info.length>0&&Array.from(this.record.tables[0].extraction_info).forEach((e=>{if(e.hasOwnProperty("columns")){let t=[];Array.from(e.columns).forEach((e=>{t=t.concat(e.toString().split(","))})),this.extracted_columns["page_"+e.page]=t}}))},toggleExtractedColumnMode(e){this.isExtractedColumnMode=!0,this.enableColumnEditing=!0,this.showExtractedColumns(e),this.resizeSelectableColumns(),this.isExtractedColumnMode=!1},showExtractedColumns(e){if(this.extracted_columns&&0!==Object.keys(this.extracted_columns).length||!e){this.removeAllColumns();for(let e=0;e<=this.images.length;e++)this.extracted_columns.hasOwnProperty("page_"+e)&&this.reDrawColumns(this.extracted_columns["page_"+e],e.toString())}else this.showErrorToast(this.$t("pages.messages.NO_COLUMNS_FOUND"))},saveTableCoordinates(e=""){return gi(this,void 0,void 0,(function*(){try{this.showLoading(),this.persistTableAreas(),this.setRulesForSelectableColumns();let t=[];_i.forEach(((e,o)=>{e&&o&&(pi=JSON.parse(e),t.push(Object.assign({},{page:o,table_areas:pi.table_areas,columns:pi.columns})))}));let o=new FormData;o.append("doc_id",this.record.doc_id),o.append("table_extraction_data",JSON.stringify(t)),o.append("header_rows_count","1");let a,i=this.addMappingFlag();""!==i&&o.append("get_mapping_rules",i.toString()),"add_split_text"===e&&o.append("split_text",this.split_text.toString()),"doc_locale"===e&&o.append("doc_locale",this.languageOrigin),this.record.hasOwnProperty("is_table_training_doc")&&o.append("is_table_training_doc",(!0).toString()),this.force_ocr_table_train&&o.append("force_ocr",(!0).toString()),this.force_ocr_table_train=!1,o.append("org_id",(0,ut.I)());let s=this.getToken();if(a=yield Ie.A.post(Te.FH.get_table_v3,o,{headers:{Authorization:s}}),!a.data||!Array.isArray(a.data)||0==a.data.length)throw{message:this.$t("CANNOT_EXECUTE_REQUEST")};if(!1===a.data[0].success)throw{message:a.data[0].message};this.setApiResponse(a)}catch(t){if(null!=t&&"object"==typeof t&&t.hasOwnProperty("message"))return void this.showErrorToast(t.message);this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},setApiResponse(e){e.data&&e.data[0].hasOwnProperty("locations_list")&&(this.record.tables=e.data,this.setTableCountForAIIndicator(),this.prepareTableMap(this.record.tables[0].locations_list),this.getExtractedColumns(),this.restrictDrawing(),this.disableColumnEditing(),this.setTableMode(),this.resetLineItems())},setRulesForSelectableColumns(){let e=document.querySelectorAll(".draggable-column");if(!e)return;let t=bi("#screenshot");if(!t)return;let o=t.offsetWidth;for(var a=0;a<this.images.length;a++){let t=(a+1).toString(),s=[];for(var i=0;i<e.length;i++){let a=e[i];if(t==a.dataset.page_no||"all"==a.dataset.page_no){let e=a.style.left.replace("px","");s.push(+e/o)}}s.length>0&&(s=this.sortNumbericArray(s),this.addColumnsToTableMap(s,t))}},addColumnsToTableMap(e,t){let o={table_areas:[]};_i.has(t)&&(o=JSON.parse(_i.get(t))),o.columns=[e.toString()],_i.set(t,JSON.stringify(o))},autoDetectTables(){return gi(this,void 0,void 0,(function*(){this.showLoading();let e,t=new FormData;t.append("doc_id",this.record.doc_id),this.record.hasOwnProperty("is_table_training_doc")&&t.append("is_table_training_doc",(!0).toString());try{t.append("org_id",(0,ut.I)());let o=this.getToken();e=yield Ie.A.post(Te.FH.get_auto_table_v3,t,{headers:{Authorization:o}})}catch(o){return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void this.hideLoading()}if(!1===e.data.success)return this.showErrorToast(e.data.message),void this.hideLoading();this.setApiResponse(e),this.hideLoading(),this.toggleExtractedColumnMode(!1)}))},handleScroll(){},deleteAllExtractedData(){this.isExtractedColumnMode=!1,this.extracted_columns=[],_i=new Map,pi={columns:[],table_areas:[]},this.record.tables=null,this.setTableCountForAIIndicator(),this.restrictDrawing(),this.removeAllColumns(),pi={columns:[],table_areas:[]},this.tableAreasStr=JSON.stringify(pi),at.A.set("table_data",this.tableAreasStr);const e=new CustomEvent("reset_table_areas",{detail:this.record});document.dispatchEvent(e),this.resetLineItems(),this.$forceUpdate()},currentPage(){return this.page},diableAllModes(){this.persistTableAreas(),this.restrictDrawing(),this.setTableMode()},updateExtractionDataForSave(e,t){if(this.record&&this.record.tables&&this.record.tables[0]&&this.record.tables[0].hasOwnProperty("extraction_info"))for(let[o,a]of Object.entries(this.record.tables[0].locations_list))this.record.tables[0].locations_list[o][e]=t},updateTableDataForSave(e){e&&e.detail&&this.record&&this.record.tables&&(this.record.tables=e.detail.tables,this.setTableCountForAIIndicator(),e.detail.save_to_server&&!0===e.detail.save_to_server&&this.debounceAutoSaveFunc())},resetLineItems(){const e=new CustomEvent("init_line_items",{detail:this.record});document.dispatchEvent(e)},viewPurchaseOrder(){at.A.set("view_mod","edit"),this.$router.push("/po-matching/"+this.$route.params.id)},openLineItemAdvanceSettings(){this.restrictDrawing();const e=new CustomEvent("display_adv_settings_view",{});document.dispatchEvent(e)},addColumnInLineItems(){this.diableAllModes();const e=new CustomEvent("add_new_column",{});document.dispatchEvent(e)},setApiData(e){this.record=e,this.$forceUpdate()},setFieldsData(e){this.record.document_version=e.document_version,this.record.fields=e.fields,this.record.tables=e.tables,this.$forceUpdate()},revertChanges(){const e=new CustomEvent("revert_changes",{});document.dispatchEvent(e)},handleImageBaseURL(){this.record.images[0]&&this.record.images[0].path.match(/doc2/g)&&(this.baseUrl=Te.VA)},zoomOut(){this.imageWidth>200&&(this.imageWidth=this.imageWidth-100,fi=bi("#screenshot"),setTimeout((()=>{this.imageHeight=fi.offsetHeight,this.resizeSelectableColumns()}),10))},zoomIn(){this.imageWidth=this.imageWidth+100,fi=bi("#screenshot"),setTimeout((()=>{this.imageHeight=fi.offsetHeight,this.resizeSelectableColumns()}),10)},getExtractedDataFromCordinates(e){return gi(this,void 0,void 0,(function*(){const t=this.record;let o,a=new FormData,i=e.startX/this.imageWidth,s=e.startY/this.imageHeight,l=e.endX/this.imageWidth,r=e.endY/this.imageHeight;a.append("x0",i.toString()),a.append("y0",s.toString()),a.append("x1",l.toString()),a.append("y1",r.toString()),a.append("doc_id",t.doc_id),a.append("page",this.page.toString()),a.append("field_name",""),this.showLoading();try{this.record.hasOwnProperty("is_table_training_doc")&&a.append("is_table_training_doc",(!0).toString()),a.append("org_id",(0,ut.I)());let e=this.getToken();o=yield Ie.A.post(Te.FH.get_field_value,a,{headers:{Authorization:e}})}catch(d){return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void this.hideLoading()}let n=o.data;this.hideLoading(),n&&n.value?this.hideLoading():this.showErrorToast(this.$t("No Data"))}))},addNewLineItem(){const e=new CustomEvent("add_new_row",{});document.dispatchEvent(e)},setTableRowCorrdinates(e,t,o){pi={columns:[],table_areas:[]},this.currentRowId=o,this.currentColumnName=t,pi.table_areas=JSON.parse(e),this.tableAreasStr=JSON.stringify(pi),at.A.set("table_rows_data",this.tableAreasStr),this.$forceUpdate()},setRowMode(){if(!0===this.isRowMode){this.persistTableAreas(),this.restrictDrawing(),this.disableColumnEditing();const e=new CustomEvent("get_table_rows_areas",{});document.dispatchEvent(e)}else this.setTableMode(!1)},setTableMode(e=!0){!0===e&&(this.isRowMode=!1),this.loadNewPageTableAreas()},saveColumnCoords(e){return gi(this,void 0,void 0,(function*(){if(!this.currentColumnName||!e)return void this.showErrorToast(this.$t("Please Select Line Column and then try again"));this.showLoading();let t=[];t=e.split(",");let o,a=new FormData;a.append("x0",t[0].toString()),a.append("y0",t[1].toString()),a.append("x1",t[2].toString()),a.append("y1",t[3].toString()),a.append("doc_id",this.record.doc_id),a.append("page",this.page.toString()),a.append("column_name",this.currentColumnName),a.append("table_name",this.record.tables[0].name),this.record.hasOwnProperty("is_table_training_doc")&&a.append("is_table_training_doc",(!0).toString());try{a.append("org_id",(0,ut.I)());let e=this.getToken();o=yield Ie.A.post(Te.FH.get_table_text,a,{headers:{Authorization:e}})}catch(l){return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void this.hideLoading()}const i=o.data.coords;if(!i||0===i[0].x&&0===i[0].y&&""===o.data.formatted_value)return this.showErrorToast(this.$t("pages.messages.EMPTY_MAPPING_NOT_ALLOWED")),void this.hideLoading();this.updateApiForTableColumn(o.data);const s=new CustomEvent("init_line_items",{detail:this.record});document.dispatchEvent(s),setTimeout((()=>{let e=bi("#input_"+this.currentColumnName+"_"+this.currentRowId);e&&(e.scrollIntoView(),e.querySelector("label").classList.add("active-border-2px"))}),30),this.$forceUpdate(),this.hideLoading()}))},updateApiForTableColumn(e){Array.from(this.record.tables[0].rows).forEach(((t,o)=>{t.id===this.currentRowId&&Array.from(t.columns).forEach(((t,a)=>{if(t.name===this.currentColumnName){let i="";i=e.location[0].coords.toString();let s={name:t.name,content:e.text,locations:e.location,locations_list:[{page:this.page,coords:[i]}],is_validated:!1,value:e.value,formatted_value:e.formatted_value,extraction_method:"AI"};return t.isExtraColumn&&(s.isExtraColumn=!0),this.record.tables[0].rows[o].columns[a]=[],void(this.record.tables[0].rows[o].columns[a]=JSON.parse(JSON.stringify(s)))}}))})),this.$forceUpdate()},deleteColumnDataForReSelection(){Array.from(this.record.tables[0].rows).forEach(((e,t)=>{e.id===this.currentRowId&&Array.from(e.columns).forEach(((e,t)=>{if(e.name===this.currentColumnName)return e.locations=[],e.locations_list=[],e.formatted_value="",e.value="",void(e.content="")}))}));const e=new CustomEvent("reload_line_items",{detail:{apiData:this.record,currentRowId:this.currentRowId,currentColumnName:this.currentColumnName}});document.dispatchEvent(e)},validateSelectedColumn(){Array.from(this.record.tables[0].rows).forEach(((e,t)=>{e.id===this.currentRowId&&Array.from(e.columns).forEach(((e,t)=>{e.name!==this.currentColumnName||(e.is_validated=!0)}))}))},saveDataForV3(e=!1){return gi(this,void 0,void 0,(function*(){const t=yield this.hasActionAcquiredLock();if(!t)return;let o=this.record;this.showLoading(),o.hasOwnProperty("table_data_copy")&&delete o["table_data_copy"];let a,i=new FormData;i.append("data",JSON.stringify(o));try{if(i.append("org_id",(0,ut.I)()),a=yield Ie.A.post(Te.FH.save_table_train_data+this.record.doc_id,i,{headers:{Authorization:"Bearer "+this.token}}),!1===a.data.success)throw{message:a.data.message};e&&this.autoDetectTables()}catch(s){if(null!=s&&"object"==typeof s&&s.hasOwnProperty("message"))return void this.showErrorToast(this.$t("pages.messages.error_internal_occur"));this.showErrorToast(s)}finally{this.hideLoading()}}))},addMappingFlag(){let e="";return!this.$route.query||"true"!==this.$route.query.get_mapping_rules&&"false"!==this.$route.query.get_mapping_rules||(e=this.$route.query.get_mapping_rules),e},rulesDeleted(){this.ai_rules=0;const e=new CustomEvent("TE_gauge_calculation",{detail:{min_table_effective_weight:0}});document.dispatchEvent(e)},callSplitTextAction(e){this.performSplitText(e)},performSplitText(e){return gi(this,void 0,void 0,(function*(){e&&this.record&&this.record.tables&&(this.split_text=!0===e.detail,this.prepareTableMap(this.record.tables[0].locations_list),this.addExtractedColumns(),yield this.saveTableCoordinates("add_split_text"))}))},addExtractedColumns(){if(this.extracted_columns&&0!==Object.keys(this.extracted_columns).length)for(let[e,t]of Object.entries(this.extracted_columns))t=this.sortNumbericArray(t),e=e.substring(5),this.addColumnsToTableMap(t,e)},saveDataOnChanges(){if(!0!==this.table_train){if(!this.isReadOnly){const e=new CustomEvent("save_data",{});document.dispatchEvent(e)}}else this.saveDataForV3()},disabledCustomColumnsDialog(){const e=new CustomEvent("open_disabled_custom_columns_view",{});document.dispatchEvent(e)},isDebugFlagHandler(){this.is_debug=!1,this.$route.query&&"true"===this.$route.query.is_debug&&(this.is_debug=!0)},viewOCRDocument(){let e=this.$router.resolve({path:"/ocr-document/"+this.docId+"/"+this.page});window.open(e.href,"_blank","location=yes,toolbar=yes,scrollbars=yes,resizable=yes,left=500,width=1500,height=1000")},changeOrigin(){this.saveTableCoordinates("doc_locale"),this.changeOriginConfirmDialog=!1},fetchLanguageOptions(){return gi(this,void 0,void 0,(function*(){let e;try{let t=this.getToken();e=yield Ie.A.get((0,ut.MV)(Te.FH.get_items_from_dictionary+"DOC_ORIGIN"),{headers:{Authorization:t}})}catch(t){return void this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}if(e.data&&0!==Object.keys(e.data).length){this.language_origin_list=[];for(const t in e.data){let o=e.data[t],a=o.description?o.description:"";this.language_origin_list.push(Object.assign({},{value:o.value,label:o.label,description:a.replaceAll("\\n","<br />")}))}(0,Xt._Y)("language_origin_list",this.language_origin_list),this.setLanguage()}}))},setLanguage(){this.force_ocr_table_train=!1;const e=this.record.doc_origin;e&&(this.languageOrigin=e)},isOcrButtonEnabled(){let e=!0;if(this.record.time_logs){const t=this.record.time_logs.ocr,o=this.record.time_logs.ocr_document;(o||t)&&(e=!1)}return e},clearViewForUnmount(){this.ignore_token_validation=!1}},beforeRouteLeave:function(e,t,o){this.removeAllNotifications(),this.releaseDocLock({doc_id:this.record.doc_id}),this.page=1,this.resetDocStore(e.fullPath),o()},setup(){const e=(0,ct.q3)(),{record:t,notifications:o,error:a,confirmationForPoConnectionReset:i,get_cached_data_id:s,extractable:l,has_ai_table:r,is_manual_training_allowed:n,doctype:d,po_enable:c}=(0,Re.bP)(e),{getDocumentById:u,setRecordFromCache:h,setDataToCache:m,removeCache:g,resetDocStore:_,setManualTraining:p}=e,b=(0,ct.oI)(),{releaseDocLock:f,hasActionAcquiredLock:v,setDocLockStoreDisable:w}=b,{doc_lock:y}=(0,Re.bP)(b),k=(0,ct._6)(),{token:C,tokenQueryParam:x,ignore_token_validation:A}=(0,Re.bP)(k),{setAuthToken:E,getTokenQueryParam:S}=k;let F=[];return{po_enable:c,doctype:d,is_manual_training_allowed:n,setManualTraining:p,has_ai_table:r,confirmationForPoConnectionReset:i,doc_fetch_error:(0,qe.KR)(a),notifications:o,record:t,get_cached_data_id:s,extractable:l,setDocLockStoreDisable:w,hasActionAcquiredLock:v,setRecordFromCache:h,getDocumentById:u,releaseDocLock:f,setDataToCache:m,resetDocStore:_,setAuthToken:E,removeCache:g,token:C,doc_lock:y,docId:(0,qe.KR)(""),page:(0,qe.KR)(1),image:(0,qe.KR)(""),images:(0,qe.KR)(F),splitterModel:(0,qe.KR)(60),tableAreasStr:(0,qe.KR)(""),isReadOnly:(0,qe.KR)(!1),isRowMode:(0,qe.KR)(!1),baseUrl:Te.VA,table_train:(0,qe.KR)(!1),tb_version:"default",training_mode:(0,qe.KR)(!1),ai_rules:(0,qe.KR)(0),ai_tables:(0,qe.KR)(0),extracted_columns:(0,qe.KR)({}),isExtractedColumnMode:(0,qe.KR)(!1),openCodeEditor:(0,qe.KR)(!1),split_text:(0,qe.KR)(!1),is_debug:(0,qe.KR)(!1),changeOriginConfirmDialog:(0,qe.KR)(!1),language_origin_list:F,languageOrigin:(0,qe.KR)(""),force_ocr_table_train:(0,qe.KR)(!1),trigger_document_lock:(0,qe.KR)(!1),document_version:(0,qe.KR)(0),api_tries:(0,qe.KR)(0),error_message:(0,qe.KR)(""),error_class:(0,qe.KR)("error-banner"),ai_table_warning:(0,qe.KR)(!1),tokenQueryParam:x,getTokenQueryParam:S,ignore_token_validation:A}}});var wi=o(98072),yi=o(66908),ki=o(93676);const Ci=(0,gt.A)(vi,[["render",De],["__scopeId","data-v-0a9bc945"]]),xi=Ci;kt()(vi,"components",{QBtn:Ft.A,QIcon:Ea.A,QSplitter:wi.A,QTooltip:Lt.A,QToggle:yi.A,QSelect:Ta.A,QItem:Tt.A,QItemSection:Rt.A,QItemLabel:Ot.A,QDialog:_t.A,QCard:pt.A,QCardSection:bt.A,QAvatar:ft.A,QCardActions:vt.A,QSpace:ki.A}),kt()(vi,"directives",{ClosePopup:wt.A})}}]);