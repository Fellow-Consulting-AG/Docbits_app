"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[3240],{83240:(e,t,o)=>{o.r(t),o.d(t,{default:()=>me});var a=o(61758),l=o(58790),s=o(29104);const i=e=>((0,a.Qi)("data-v-3c06f4c0"),e=e(),(0,a.jt)(),e),r={style:{"font-size":"large",display:"flex","align-items":"center"}},n={class:"row q-pa-md container-wrapper"},d={class:"col-12 q-pb-md"},c={class:"row"},u={class:"col-sm-8 col-md-6 col-lg-4"},h={class:"col-sm-4 col-md-6 col-lg-8"},p={class:"col-12 q-pb-md",style:{height:"76vh !important","overflow-y":"auto"}},g={class:"table-header-text"},f={class:"text-left q-pl-md"},m={class:"text-center width-160"},b=["onClick"],k={class:"text-left"},w={class:"text-center"},_={class:"text-red"},v={class:"col-12 q-pb-md",style:{"margin-top":"20px","align-items":"center","justify-content":"center"}},y={class:"row"},F={class:"q-ml-sm"},L={class:"text-weight-bold"},D=i((()=>(0,a.Lk)("img",{src:"settings/export.svg",width:"100","aria-hidden":"true"},null,-1))),T={style:{padding:"20px"}},x={class:"text-white"};function A(e,t,o,i,A,E){const C=(0,a.g2)("SubHeader"),W=(0,a.g2)("q-icon"),q=(0,a.g2)("q-input"),$=(0,a.g2)("f-btn"),R=(0,a.g2)("q-item-section"),S=(0,a.g2)("q-item"),I=(0,a.g2)("q-separator"),Q=(0,a.g2)("q-list"),V=(0,a.g2)("q-menu"),j=(0,a.g2)("q-btn"),U=(0,a.g2)("q-markup-table"),B=(0,a.g2)("q-pagination"),K=(0,a.g2)("q-avatar"),O=(0,a.g2)("q-card-section"),M=(0,a.g2)("q-card-actions"),P=(0,a.g2)("q-card"),z=(0,a.g2)("q-dialog"),X=(0,a.g2)("Loader"),H=(0,a.g2)("q-toolbar-title"),J=(0,a.g2)("q-toolbar"),N=(0,a.g2)("q-tooltip"),G=(0,a.g2)("q-file"),Y=(0,a.g2)("workflowTemplates"),Z=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(C,{name:"dashboard",label:e.$t("my_workflows"),show_expiry_alert:!0,display_help_link:!1},{default:(0,a.k6)((()=>[(0,a.Lk)("label",r,(0,l.v_)(e.version),1)])),_:1},8,["label"]),(0,a.Lk)("div",n,[(0,a.Lk)("div",d,[(0,a.Lk)("div",c,[(0,a.Lk)("div",u,[(0,a.bF)(q,{modelValue:e.searchBy,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.searchBy=t),t[1]||(t[1]=t=>e.inputValueChanges())],dense:"",class:(0,l.C4)(0===e.searchBy.length?"search-in-active":"search-active"),autofocus:"",placeholder:e.$t("search_workflow"),outlined:""},{append:(0,a.k6)((()=>[(0,a.bF)(W,{flat:"",dense:"",name:"search",size:"24px",color:"primary"})])),_:1},8,["modelValue","class","placeholder"])]),(0,a.Lk)("div",h,[(0,a.bF)($,{icon:"add",label:e.$t("add_workflow"),class:"float-right",to:"/workflow_designer"},null,8,["label"]),(0,a.bF)($,{icon:"file_upload",label:e.$t("import_workflow"),class:"float-right",style:{"margin-right":"10px"},onClick:t[2]||(t[2]=t=>{e.multiUploaderDialog=!0,e.uploadedFiles=null})},null,8,["label"]),(0,a.bF)($,{icon:"account_tree",label:e.$t("workflow_templates"),class:"float-right",style:{"margin-right":"10px"},onClick:t[3]||(t[3]=t=>e.ShowTemplateDashboard=!0)},null,8,["label"])])])]),(0,a.Lk)("div",p,[(0,a.bF)(U,{flat:"",class:"workflow-table-style"},{default:(0,a.k6)((()=>[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",g,[(0,a.Lk)("th",f,(0,l.v_)(e.$t("name")),1),(0,a.Lk)("th",m,(0,l.v_)(e.$t("actions")),1)])]),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.tableData,((o,i)=>((0,a.uX)(),(0,a.CE)("tr",{class:"cursor-pointer workflow-name",key:i,onClick:t=>e.openWorkflowDesigner(o.id)},[(0,a.Lk)("td",k,[o.enabled?((0,a.uX)(),(0,a.Wv)(W,{key:0,class:"q-mr-md black_to_white",name:"img:workflow/flow-enabled.svg"})):(0,a.Q3)("",!0),o.enabled?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(W,{key:1,class:"q-mr-md black_to_white",name:"img:workflow/flow-disabled.svg"})),(0,a.Lk)("span",{style:{"font-size":"16px"},class:(0,l.C4)(1==o.enabled?"enabled-name":"disabled-name")},(0,l.v_)(o.name),3)]),(0,a.Lk)("td",w,[(0,a.bF)(j,{flat:"",dense:"",round:"",onClick:t[4]||(t[4]=(0,s.D$)((()=>{}),["stop","prevent"])),icon:"more_horiz"},{default:(0,a.k6)((()=>[(0,a.bF)(V,{"auto-close":"","transition-show":"jump-down","transition-hide":"jump-up",anchor:"bottom middle",self:"top middle"},{default:(0,a.k6)((()=>[(0,a.bF)(Q,{dense:"",style:{"min-width":"100px"}},{default:(0,a.k6)((()=>[(0,a.bF)(S,{clickable:""},{default:(0,a.k6)((()=>[o.enabled?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(R,{key:0,onClick:t=>e.handleActive(o,!0)},{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(e.$t("activate")),1)])),_:2},1032,["onClick"])),o.enabled?((0,a.uX)(),(0,a.Wv)(R,{key:1,onClick:t=>e.handleActive(o,!1)},{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(e.$t("deactivate")),1)])),_:2},1032,["onClick"])):(0,a.Q3)("",!0)])),_:2},1024),(0,a.bF)(S,{clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(R,{onClick:t=>e.copyWorkflow(o.id)},{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(e.$t("duplicate")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,a.bF)(S,{clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(R,{onClick:t=>e.openWorkflowDesigner(o.id)},{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(e.$t("edit")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,a.bF)(S,{clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(R,{onClick:t=>e.downloadWorkflow(o)},{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(e.$t("download")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,a.bF)(I,{inset:""}),(0,a.bF)(S,{clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(R,{onClick:t=>{e.workflowId=o.id,e.confirmDelete=!0,e.selectedRecordIndex=i}},{default:(0,a.k6)((()=>[(0,a.Lk)("span",_,(0,l.v_)(e.$t("delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])],8,b)))),128))])])),_:1})]),(0,a.Lk)("div",v,[(0,a.Lk)("div",y,[e.total_pages>1?((0,a.uX)(),(0,a.Wv)(B,{key:0,modelValue:e.current_page,"onUpdate:modelValue":t[5]||(t[5]=t=>e.current_page=t),max:e.total_pages,"direction-links":"",unelevated:"",color:"black","active-color":"black",class:"doc2-pagination q-ml-auto q-mr-auto",onClick:t[6]||(t[6]=t=>e.nexPageClicked())},null,8,["modelValue","max"])):(0,a.Q3)("",!0)])])]),(0,a.bF)(z,{modelValue:e.confirmDelete,"onUpdate:modelValue":t[8]||(t[8]=t=>e.confirmDelete=t),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(P,null,{default:(0,a.k6)((()=>[(0,a.bF)(O,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,a.k6)((()=>[(0,a.bF)(K,{icon:"warning",color:"primary"})])),_:1}),(0,a.bF)(O,{class:"row items-center"},{default:(0,a.k6)((()=>[(0,a.Lk)("span",F,(0,l.v_)(e.$t("pages.messages.msg_delete")),1)])),_:1}),(0,a.bF)(M,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(j,{flat:"",label:e.$t("cancel"),color:"primary"},null,8,["label"]),[[Z]]),(0,a.bo)((0,a.bF)(j,{flat:"",label:e.$t("delete"),color:"primary",onClick:t[7]||(t[7]=t=>{e.deleteWorkflow()})},null,8,["label"]),[[Z]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(X),(0,a.bF)(z,{modelValue:e.multiUploaderDialog,"onUpdate:modelValue":t[13]||(t[13]=t=>e.multiUploaderDialog=t)},{default:(0,a.k6)((()=>[(0,a.bF)(P,{style:{width:"50vw"}},{default:(0,a.k6)((()=>[(0,a.bF)(J,{class:"text-white secondary-toolbar"},{default:(0,a.k6)((()=>[(0,a.bF)(H,null,{default:(0,a.k6)((()=>[(0,a.Lk)("span",L,(0,l.v_)(e.$t("upload_workflow")),1)])),_:1}),(0,a.bo)((0,a.bF)(j,{flat:"",round:"",dense:"",icon:"close"},null,512),[[Z]])])),_:1}),(0,a.bF)(O,null,{default:(0,a.k6)((()=>[(0,a.Lk)("div",{class:"drag-area text-center full-width",style:{padding:"20px"},id:"box-droppable",onDrop:t[10]||(t[10]=(...t)=>e.drop&&e.drop(...t)),onDragover:t[11]||(t[11]=(...t)=>e.allowDrop&&e.allowDrop(...t)),onDragleave:t[12]||(t[12]=(...t)=>e.dragLeave&&e.dragLeave(...t))},[D,(0,a.Lk)("div",T,(0,l.v_)(e.$t("pages.land.dragndrop")),1),(0,a.bF)(G,{style:{width:"70% !important",margin:"auto","white-space":"nowrap"},"data-cy":"upload-multiple-docs",class:"select-field",outlined:"",multiple:"","onUpdate:modelValue":[e.uploadFile,t[9]||(t[9]=t=>e.uploadedFiles=t)],modelValue:e.uploadedFiles,label:e.$t("upload_workflow"),accept:"application/json"},{prepend:(0,a.k6)((()=>[(0,a.bF)(W,{name:"attachment"})])),file:(0,a.k6)((({index:e,file:t})=>[(0,a.Lk)("div",x,(0,l.v_)(t.name),1),(0,a.bF)(N,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(t.name),1)])),_:2},1024),(0,a.Q3)("",!0)])),_:1},8,["onUpdate:modelValue","modelValue","label"])],32)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(z,{modelValue:e.ShowTemplateDashboard,"onUpdate:modelValue":t[14]||(t[14]=t=>e.ShowTemplateDashboard=t),onKeypress:t[15]||(t[15]=(0,s.jR)((t=>e.ShowTemplateDashboard=!1),["esc"]))},{default:(0,a.k6)((()=>[(0,a.bF)(Y)])),_:1},8,["modelValue"])],64)}var E=o(53500),C=o(1659),W=o(24622),q=o(38734),$=o(96056),R=o(8420),S=o(18505),I=o(11470),Q=o(94124),V=o(95488),j=o(64775),U=o(76956),B=o(59340),K=function(e,t,o,a){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function i(e){try{n(a.next(e))}catch(t){s(t)}}function r(e){try{n(a["throw"](e))}catch(t){s(t)}}function n(e){e.done?o(e.value):l(e.value).then(i,r)}n((a=a.apply(e,t||[])).next())}))};const O=(0,a.pM)({name:"workFlow",mixins:[W.A,$.A,S.A],components:{Loader:R.A,SubHeader:V.A,workflowTemplates:B.A},data(){return{workflowId:(0,q.KR)(""),searchBy:(0,q.KR)(""),tableData:{},confirmDelete:(0,q.KR)(!1),selectedRecordIndex:(0,q.KR)(),version:(0,q.KR)("")}},mounted(){return K(this,void 0,void 0,(function*(){this.debounceSearchInputFunc=(0,E.A)((()=>{this.loadWokFlow()}),1e3),this.loadWokFlow(),document.removeEventListener("upload_files",this.uploadFilesEventHandler),document.addEventListener("upload_files",this.uploadFilesEventHandler),yield this.getWorkflowVersion()}))},unmounted:function(){document.removeEventListener("upload_files",this.uploadFilesEventHandler)},methods:{inputValueChanges(){this.debounceSearchInputFunc()},getWorkflowVersion(){return K(this,void 0,void 0,(function*(){const e=yield I.Bj.getDocFlowVersion();this.version=e["docflow-version"]}))},loadWokFlow(){return K(this,void 0,void 0,(function*(){let e;try{this.showLoading(),this.request_params={},this.request_params["offset"]=this.offset,this.request_params["limit"]=this.page_size,this.request_params["order_by_direction"]="desc",this.searchBy.length>1&&(this.request_params["name"]=this.searchBy),e=yield I.Bj.getWorkflowDashboard(this.request_params),e.entries&&(this.tableData=e.entries),this.total_records=e.all_entries_count,this.setTotalPages()}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},handleActive(e,t){return K(this,void 0,void 0,(function*(){let o,a=null;try{let l={};l.id=e.id,l.enabled=t,o=yield I.Bj.updateWorkflow(l),o&&(this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),e.enabled=t),a=!1}catch(l){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),a=null}}))},saveOrUpdateWorkflow(){return K(this,void 0,void 0,(function*(){if(this.openAddWorkflowDialog)return;let e;try{if(this.showLoading(),this.workflowModel["id"])e=yield I.Bj.updateWorkflow(this.workflowModel),this.tableData[this.selectedRecordIndex].id=e.id,this.tableData[this.selectedRecordIndex].name=e.name,this.tableData[this.selectedRecordIndex].org_id=e.org_id,this.tableData[this.selectedRecordIndex].enabled=e.enabled,this.tableData[this.selectedRecordIndex].trigger=e.trigger,this.tableData[this.selectedRecordIndex].doc_type=e.doc_type,this.tableData[this.selectedRecordIndex].sub_org_id=e.sub_org_id,this.tableData[this.selectedRecordIndex].description=e.description;else{e=yield I.Bj.createWorkflow(this.workflowModel);const t={id:e.id,name:e.name,org_id:e.org_id,enabled:e.enabled,trigger:e.trigger,doc_type:e.doc_type,sub_org_id:e.sub_org_id,description:e.description};this.tableData.splice(0,0,t)}this.showSuccessToast(this.$t("pages.messages.MSG_SAVE"))}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},deleteWorkflow(){return K(this,void 0,void 0,(function*(){let e;try{this.showLoading(),e=yield I.Bj.deleteWorkflow(this.workflowId),this.showSuccessToast(this.$t("pages.messages.DELETED_SUCCESSFULLY")),this.tableData.splice(this.selectedRecordIndex,1)}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},copyWorkflow(e){return K(this,void 0,void 0,(function*(){let t;try{this.showLoading(),t=yield I.Bj.copyWorkflow(e),this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),this.tableData.splice(0,0,JSON.parse(JSON.stringify(t)))}catch(o){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},openWorkflowDesigner(e){this.$router.push("/workflow_designer/"+e)},downloadWorkflow(e){return K(this,void 0,void 0,(function*(){try{this.showLoading(),yield I.Bj.exportworkflowtojson(e.id).then((t=>{const o=new Blob([JSON.stringify(t)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download=e.name,a.click(),URL.revokeObjectURL(a.href)}))}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},resetPagination(){this.offset=0,this.total_pages=0,this.current_page=1,this.total_records=0},setTotalPages(){this.total_pages=Math.ceil(this.total_records/this.page_size)},nexPageClicked(){return K(this,void 0,void 0,(function*(){try{this.calculateOffset(),yield this.loadWokFlow()}catch(e){const t=j.t.getErrorMessage(e);this.showErrorToast(t)}}))},calculateOffset(){this.offset=this.page_size*(this.current_page-1)},uploadFile(e){this.uploadedFiles=e;let t=this.uploadedFiles;t||this.showErrorToast(this.$t("pages.messages.NO_FILE_SELECTED")),this.uploadFiles(t)},allowDrop(e){e.preventDefault(),e.currentTarget.classList.add("bg-grey-5"),e.currentTarget.classList.add("bd-shadow")},drop(e){e.preventDefault(),e.currentTarget.classList.remove("bg-grey-5"),e.currentTarget.classList.remove("bd-shadow"),this.uploadFiles(e.dataTransfer.files)},dragLeave(e){e.currentTarget.classList.remove("bg-grey-5"),e.currentTarget.classList.remove("bd-shadow")},uploadFilesEventHandler(e){e&&e.detail.files&&this.uploadFiles(e.detail.files)},uploadFiles(e){return K(this,void 0,void 0,(function*(){try{if(this.multiUploaderDialog=!1,this.uploadedFiles=null,e&&e.length>10)return void this.showErrorToast(this.$t("max_workflow_upload_limit"));this.formData=new FormData;let t=0;for(let o of e)this.hasAllowedFileType(o)?this.formData.append("workflow_json",o):t++;if(t>0)return void this.showErrorToast(this.$t("pages.messages.INVALID_FILES"));yield this.uploadWorkflowJson(this.formData)}catch(t){const e=j.t.getErrorMessage(t);this.showErrorToast(e)}finally{const e=new CustomEvent("table_data_updated",{});document.dispatchEvent(e)}}))},hasAllowedFileType(e){let t=U.oe.includes(e.type);if(!t){const o=e.name.lastIndexOf("."),a=e.name.substring(o+1);t=U.oe.includes(a)}return t},uploadWorkflowJson(e){return K(this,void 0,void 0,(function*(){try{const t=yield I.Bj.importWorkflowJson(e);if(!1===t.success)return this.showErrorToast(this.$t("pages.messages.DOC_UPLOAD_ERROR")),void this.showErrorToast(t.message)}catch(t){const e=j.t.getErrorMessage(t);this.showErrorToast(e)}finally{yield this.loadWokFlow()}}))}},setup(){const e=(0,Q.cY)(),{doc_type_list:t,trigger_list:o,subOrgList:a}=(0,C.bP)(e),{getSubOrgsList:l,getDocumentTriggers:s}=e;return{subOrgList:a,trigger_list:o,doc_type_list:t,debounceSearchInputFunc:{},request_params:(0,q.KR)({}),current_page:(0,q.KR)(1),total_pages:(0,q.KR)(1),offset:(0,q.KR)(0),page_size:(0,q.KR)(25),total_records:(0,q.KR)(0),multiUploaderDialog:(0,q.KR)(!1),uploadedFiles:(0,q.KR)(null),formData:{},ShowTemplateDashboard:(0,q.KR)(!1),getSubOrgsList:l,getDocumentTriggers:s}}});var M=o(12807),P=o(67837),z=o(50492),X=o(857),H=o(80460),J=o(56384),N=o(84436),G=o(53999),Y=o(90124),Z=o(25173),ee=o(10386),te=o(54700),oe=o(82156),ae=o(23316),le=o(44189),se=o(3952),ie=o(62669),re=o(36914),ne=o(39150),de=o(99980),ce=o(97410),ue=o(42315),he=o(88672),pe=o(98582),ge=o.n(pe);const fe=(0,M.A)(O,[["render",A],["__scopeId","data-v-3c06f4c0"]]),me=fe;ge()(O,"components",{QInput:P.A,QIcon:z.A,QMarkupTable:X.A,QCheckbox:H.A,QBtn:J.A,QMenu:N.A,QList:G.A,QItem:Y.A,QItemSection:Z.A,QSeparator:ee.A,QPagination:te.A,QDialog:oe.A,QCard:ae.A,QCardSection:le.A,QAvatar:se.A,QCardActions:ie.A,QToolbar:re.A,QToolbarTitle:ne.A,QFile:de.A,QTooltip:ce.A,QTable:ue.A}),ge()(O,"directives",{ClosePopup:he.A})}}]);