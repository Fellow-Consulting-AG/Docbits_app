"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[1556],{11556:(e,t,o)=>{o.r(t),o.d(t,{default:()=>fs});var s=o(61758),l=o(58790);const i={class:"container page-height-limit"},a={style:{width:"100%"}},r={style:{"margin-top":"3px"}},n={style:{"margin-top":"3px"}},d={style:{"margin-top":"3px"}};function c(e,t,o,c,u,m){const p=(0,s.g2)("SubHeader"),_=(0,s.g2)("BackToSettings"),h=(0,s.g2)("q-separator"),g=(0,s.g2)("q-icon"),f=(0,s.g2)("q-space"),b=(0,s.g2)("PageRestriction"),v=(0,s.g2)("q-card-section"),k=(0,s.g2)("q-card"),y=(0,s.g2)("q-expansion-item"),w=(0,s.g2)("FtpImportList"),L=(0,s.g2)("EmailImportList"),E=(0,s.g2)("q-list");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(p,{name:"import_settings",label:e.$t("Import"),onSearch:!1},null,8,["label"]),(0,s.bF)(_),(0,s.Lk)("div",i,[(0,s.Lk)("div",a,[(0,s.Lk)("div",null,[(0,s.bF)(E,{bordered:"",class:"rounded-borders"},{default:(0,s.k6)((()=>[(0,s.bF)(y,{"expand-separator":"","header-class":"highlighted-back","default-opened":""},{header:(0,s.k6)((()=>[(0,s.bF)(g,{size:"25px",class:"q-mr-lg black_to_white",name:"img:settings/doc.svg"}),(0,s.Lk)("span",r,(0,l.v_)(e.$t("pages.import.email_import")),1),(0,s.bF)(f)])),default:(0,s.k6)((()=>[(0,s.bF)(h),(0,s.bF)(k,{class:"page-background"},{default:(0,s.k6)((()=>[(0,s.bF)(v,null,{default:(0,s.k6)((()=>[(0,s.bF)(b)])),_:1})])),_:1})])),_:1}),(0,s.bF)(y,{"expand-separator":"","header-class":"highlighted-back","default-opened":""},{header:(0,s.k6)((()=>[(0,s.bF)(g,{size:"25px",class:"q-mr-lg black_to_white",name:"img:settings/email-import.svg"}),(0,s.Lk)("span",n,(0,l.v_)(e.$t("ftp_import")),1),(0,s.bF)(f)])),default:(0,s.k6)((()=>[(0,s.bF)(h),(0,s.bF)(k,{class:"page-background"},{default:(0,s.k6)((()=>[(0,s.bF)(v,null,{default:(0,s.k6)((()=>[(0,s.bF)(w)])),_:1})])),_:1})])),_:1}),(0,s.bF)(y,{"expand-separator":"","header-class":"highlighted-back","default-opened":""},{header:(0,s.k6)((()=>[(0,s.bF)(g,{size:"25px",class:"q-mr-lg black_to_white",name:"img:settings/email-import.svg"}),(0,s.Lk)("span",d,(0,l.v_)(e.$t("pages.settings.email_import")),1),(0,s.bF)(f)])),default:(0,s.k6)((()=>[(0,s.bF)(h),(0,s.bF)(k,{class:"page-background"},{default:(0,s.k6)((()=>[(0,s.bF)(v,null,{default:(0,s.k6)((()=>[(0,s.bF)(L)])),_:1})])),_:1})])),_:1})])),_:1})])])])],64)}var u=o(95488),m=o(60894);const p={class:"import-container q-pa-xl"},_={class:"row"},h={style:{width:"30%",margin:"auto","padding-right":"5%"}},g={style:{width:"30%"}},f=(0,s.Lk)("div",{style:{width:"40%",margin:"auto","padding-left":"5%"}},null,-1),b={class:"row q-py-sm"},v={style:{width:"30%",margin:"auto","padding-right":"5%"}},k={style:{width:"30%"}},y=(0,s.Lk)("div",{style:{width:"40%"}},null,-1),w={class:"row"},L={style:{width:"30%",margin:"auto","padding-right":"5%"}},E={style:{width:"30%"}},F=(0,s.Lk)("div",{style:{width:"40%"}},null,-1);function C(e,t,o,i,a,r){const n=(0,s.g2)("q-tooltip"),d=(0,s.g2)("q-input"),c=(0,s.g2)("q-select");return(0,s.uX)(),(0,s.CE)("div",p,[(0,s.Lk)("div",_,[(0,s.Lk)("div",h,(0,l.v_)(e.$t("restrict_to_pages")),1),(0,s.Lk)("div",g,[(0,s.bF)(d,{outlined:"",dense:"","data-cy":"restrict_to_pages",tabindex:"0",type:"number",class:(0,l.C4)("full-width back-white"),modelValue:e.settings_model["RESTRICT_TO_PAGES"],"onUpdate:modelValue":[t[0]||(t[0]=t=>e.settings_model["RESTRICT_TO_PAGES"]=t),t[1]||(t[1]=t=>{e.saveSettings("RESTRICT_TO_PAGES",t)})]},{default:(0,s.k6)((()=>[(0,s.bF)(n,null,{default:(0,s.k6)((()=>[(0,s.eW)(" Only process given number of pages every further page will be ignored. ")])),_:1})])),_:1},8,["modelValue"])]),f]),(0,s.Lk)("div",b,[(0,s.Lk)("div",v,(0,l.v_)(e.$t("payment_terms_days")),1),(0,s.Lk)("div",k,[(0,s.bF)(d,{outlined:"",dense:"","data-cy":"payment_terms_days",tabindex:"0",type:"number",class:(0,l.C4)("full-width back-white"),modelValue:e.settings_model["PAYMENT_TERMS_DAYS"],"onUpdate:modelValue":[t[2]||(t[2]=t=>e.settings_model["PAYMENT_TERMS_DAYS"]=t),t[3]||(t[3]=t=>{e.saveSettings("PAYMENT_TERMS_DAYS",t)})]},null,8,["modelValue"])]),y]),(0,s.Lk)("div",w,[(0,s.Lk)("div",L,(0,l.v_)(e.$t("date_pattern")),1),(0,s.Lk)("div",E,[(0,s.bF)(c,{outlined:"",dense:"",class:"back-white","data-cy":"date_pattern",modelValue:e.settings_model["DATE_PATTERN"],"onUpdate:modelValue":[t[4]||(t[4]=t=>e.settings_model["DATE_PATTERN"]=t),t[5]||(t[5]=t=>{e.saveSettings("DATE_PATTERN",t)})],options:[{label:e.$t("select"),value:""},{label:"%d/%m/%Y",value:"%d/%m/%Y"},{label:"%d.%m.%Y",value:"%d.%m.%Y"},{label:"%m %d, %Y",value:"%m %d, %Y"},{label:"%Y %m, %d",value:"%Y %m, %d"}],"emit-value":"","map-options":"",label:e.$t("date_pattern")},null,8,["modelValue","options","label"])]),F])])}var A=o(38734),R=o(18505),D=o(24622),S=o(82303),q=o(46162),$=o(36801),T=o(14907),V=o(85487),O=function(e,t,o,s){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,i){function a(e){try{n(s.next(e))}catch(t){i(t)}}function r(e){try{n(s["throw"](e))}catch(t){i(t)}}function n(e){e.done?o(e.value):l(e.value).then(a,r)}n((s=s.apply(e,t||[])).next())}))};const x=(0,s.pM)({mixins:[R.A,D.A],mounted:function(){this.getSettings()},methods:{getSettings(){return O(this,void 0,void 0,(function*(){let e;this.showLoading();try{let t=yield(0,q.L3)();e=yield S.A.get((0,V.MV)(q.FH.get_preferences),{headers:{"Content-Type":"multipart/form-data",Authorization:t}})}catch(t){return this.hideLoading(),void this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}if(this.hideLoading(),e.data)for(let[o,s]of Object.entries(e.data))this.settings_model[o]="true"==s||"false"!=s&&s}))},saveSettings(e,t){return O(this,void 0,void 0,(function*(){if(!e)return;this.showLoading();let o=new FormData;o.append("key",e),o.append("value",t),o.append("org_id",(0,V.I)());try{let s=yield(0,q.L3)();const l=yield S.A.put(q.FH.set_preference,o,{headers:{"Content-Type":"multipart/form-data",Authorization:s}});if(!1===l.data.success)throw l;this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),(0,$.mi)(e,t)}catch(s){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))}},setup(){const e=(0,T.A)(),t={};let o=[];return{settings_model:(0,A.KR)(t),display_data:[],icon:(0,A.KR)(!1),columns:o,processing:(0,A.KR)(!1),showNotification(t){e.notify({message:t,color:"primary",position:"top"})}}},data(){return{userDialog:(0,A.KR)(!1),api_key:""}}});var I=o(12807),Q=o(67837),K=o(97410),M=o(94940),W=o(98582),P=o.n(W);const X=(0,I.A)(x,[["render",C]]),U=X;P()(x,"components",{QInput:Q.A,QTooltip:K.A,QSelect:M.A});var N=o(29104);const Y={class:"container q-pa-xl"},z={class:"row",style:{"margin-bottom":"15px"}},j={style:{width:"20%",margin:"auto"}},J={style:{width:"80%"}},B={class:"row"},G={key:0,class:"cursor-default"},H={key:1},Z={class:"row float-right"},ee={class:"text-red-14"},te=(0,s.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1);function oe(e,t,o,i,a,r){const n=(0,s.g2)("f-btn"),d=(0,s.g2)("ImportLogs"),c=(0,s.g2)("q-th"),u=(0,s.g2)("q-tr"),m=(0,s.g2)("q-item-section"),p=(0,s.g2)("q-item"),_=(0,s.g2)("q-separator"),h=(0,s.g2)("q-list"),g=(0,s.g2)("q-menu"),f=(0,s.g2)("q-btn"),b=(0,s.g2)("q-td"),v=(0,s.g2)("q-table"),k=(0,s.g2)("q-inner-loading"),y=(0,s.g2)("EditCreate"),w=(0,s.g2)("q-dialog"),L=(0,s.g2)("ConnectionLogs");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",Y,[(0,s.Lk)("div",z,[(0,s.Lk)("div",j,(0,l.v_)(e.$t("pages.import.email")),1),(0,s.Lk)("div",J,[(0,s.eW)((0,l.v_)(e.$t("pages.import.email_info"))+" ",1),(0,s.Lk)("a",{onClick:t[0]||(t[0]=(...t)=>e.webSiteLink&&e.webSiteLink(...t)),class:"cursor-pointer color-primary",target:"_blank"},(0,l.v_)(e.$t("pages.import.email_link")),1)]),(0,s.bF)(n,{class:"q-ml-auto",icon:"add",label:e.$t("new"),onClick:e.createNewRecord},null,8,["label","onClick"]),(0,s.bF)(d,{setheight:"36px"})]),(0,s.Lk)("div",B,[(0,s.bF)(v,{"no-data-label":e.$t("pages.messages.no_record_found"),style:{width:"100%",height:"100%"},class:"dashboard-table-style back-white",rows:e.rows,columns:e.columns,"row-key":"name",flat:"","rows-per-page-options":[0],id:"email_import_table"},{header:(0,s.k6)((t=>[(0,s.bF)(u,{props:t},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.cols,((o,i)=>((0,s.uX)(),(0,s.Wv)(c,{key:o.name,props:t,"data-index":i,draggable:e.canDragDropColumn(o),dropzone:e.canDragDropColumn(o),direction:"horizontal",onDragstart:t=>e.onDragStart(t,e.columns,i),onDrop:(0,N.D$)((t=>e.handleDrop(t,i)),["prevent"]),onDragover:(0,N.D$)((t=>e.onDragOver(t,i)),["prevent"]),onDragenter:(0,N.D$)(e.onDragEnter,["prevent"]),onDragleave:(0,N.D$)(e.onDragLeave,["prevent"]),style:(0,l.Tr)({cursor:e.getIsDragging?"pointer":"move"})},{default:(0,s.k6)((()=>["action"==o.name?((0,s.uX)(),(0,s.CE)("span",G,(0,l.v_)(o.label),1)):((0,s.uX)(),(0,s.CE)("span",H,(0,l.v_)(o.label),1))])),_:2},1032,["props","data-index","draggable","dropzone","onDragstart","onDrop","onDragover","onDragenter","onDragleave","style"])))),128))])),_:2},1032,["props"])])),body:(0,s.k6)((o=>[(0,s.bF)(u,{props:o,id:o.key},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.cols,(i=>((0,s.uX)(),(0,s.CE)(s.FK,{key:i.name},["action"===i.name?((0,s.uX)(),(0,s.Wv)(b,{key:0,style:{width:"350px"}},{default:(0,s.k6)((()=>[(0,s.Lk)("div",Z,[(0,s.bF)(f,{flat:"",dense:"",round:"",onClick:t[1]||(t[1]=(0,N.D$)((()=>{}),["stop","prevent"])),icon:"more_horiz"},{default:(0,s.k6)((()=>[(0,s.bF)(g,{"auto-close":"","transition-show":"jump-down","transition-hide":"jump-up",anchor:"bottom middle",self:"top middle"},{default:(0,s.k6)((()=>[(0,s.bF)(h,{dense:"",style:{"min-width":"100px"}},{default:(0,s.k6)((()=>["IMAP"===o.row.protocol||"POP3"===o.row.protocol?((0,s.uX)(),(0,s.Wv)(p,{key:0,clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(m,{onClick:t=>e.checkLogin(o.row)},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("test_connection")),1)])),_:2},1032,["onClick"])])),_:2},1024)):(0,s.Q3)("",!0),(0,s.bF)(p,{clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(m,{onClick:t=>e.showMailConnectionLogs(o.row.id)},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.import.connection_logs")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,s.bF)(_,{inset:""}),(0,s.bF)(p,{clickable:""},{default:(0,s.k6)((()=>[o.row.is_active?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(m,{key:0,onClick:t=>{o.row.is_active=!0,e.de_activateEmail(o.row)}},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("activate")),1)])),_:2},1032,["onClick"])),o.row.is_active?((0,s.uX)(),(0,s.Wv)(m,{key:1,onClick:t=>{o.row.is_active=!1,e.de_activateEmail(o.row)}},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("deactivate")),1)])),_:2},1032,["onClick"])):(0,s.Q3)("",!0)])),_:2},1024),(0,s.bF)(p,{clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(m,{onClick:t=>e.editRow(o.rowIndex,o.row)},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("edit")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,s.bF)(_,{inset:""}),(0,s.bF)(p,{clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(m,{onClick:t=>e.deleteClicked(o.rowIndex,o.row.id)},{default:(0,s.k6)((()=>[(0,s.Lk)("span",ee,(0,l.v_)(e.$t("delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])])),_:2},1024)):"sub_org_id"===i.name?((0,s.uX)(),(0,s.Wv)(b,{key:1,class:(0,l.C4)(o.row.is_active?"":"email-import-deactive-column")},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.sub_orgs_flattened[o.row[i.name]]),1)])),_:2},1032,["class"])):((0,s.uX)(),(0,s.Wv)(b,{key:2,class:(0,l.C4)(1==o.row.is_active?"":"email-import-deactive-column")},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)("null"===o.row[i.name]?"":o.row[i.name]),1)])),_:2},1032,["class"]))],64)))),128))])),_:2},1032,["props","id"])])),_:1},8,["no-data-label","rows","columns"])])]),(0,s.bF)(k,{showing:e.loading,class:"z-index-1",style:{"z-index":"1000"}},{default:(0,s.k6)((()=>[te])),_:1},8,["showing"]),(0,s.bF)(w,{modelValue:e.show_edit_create,"onUpdate:modelValue":t[2]||(t[2]=t=>e.show_edit_create=t),persistent:"",onKeydown:t[3]||(t[3]=(0,N.jR)((t=>e.show_edit_create=!1),["esc"]))},{default:(0,s.k6)((()=>[(0,s.bF)(y,{selected_model:e.selected_row,api_key:e.api_key},null,8,["selected_model","api_key"])])),_:1},8,["modelValue"]),(0,s.bF)(w,{modelValue:e.show_connection_logs,"onUpdate:modelValue":t[4]||(t[4]=t=>e.show_connection_logs=t)},{default:(0,s.k6)((()=>[(0,s.bF)(L,{connection_id:e.connection_id,connection_type:e.connection_type},null,8,["connection_id","connection_type"])])),_:1},8,["modelValue"])],64)}var se=o(10739),le=o(11470),ie=o(64775);const ae={key:0,class:"text-weight-bold"},re={key:1,class:"text-weight-bold"},ne={class:"row q-mt-md"},de={class:"col-2"},ce={class:"col-7"},ue={class:"col-3"},me={class:"row q-mt-md"},pe={class:"col-2"},_e={class:"col-7"},he={class:"col-3"},ge={class:"row q-mt-md"},fe=(0,s.Lk)("div",{class:"col-2"},null,-1),be={class:"col-7"},ve={key:0,class:"col-3"},ke={style:{"margin-top":"8px"}},ye={class:"row q-mt-md"},we=(0,s.Lk)("div",{class:"col-2"},null,-1),Le={class:"col-7"},Ee={class:"col-3"},Fe={class:"col-3"},Ce={style:{"margin-top":"8px"}},Ae={class:"row q-mt-md"},Re=(0,s.Lk)("div",{class:"col-2"},null,-1),De={class:"col-7"},Se=(0,s.Lk)("div",{class:"col-3"},null,-1),qe={class:"row q-mt-md"},$e=(0,s.Lk)("div",{class:"col-2"},null,-1),Te={class:"col-7"},Ve=(0,s.Lk)("div",{class:"col-3"},null,-1),Oe={class:"row q-mt-md"},xe={class:"col-2"},Ie={key:0,class:"col-7"},Qe={class:"col-3"},Ke={class:"row q-mt-md"},Me=(0,s.Lk)("div",{class:"col-2"},null,-1),We={class:"col-3"},Pe={class:"col-1"},Xe=(0,s.Lk)("div",{class:"col-3"},null,-1),Ue={key:0,class:"row q-mt-md"},Ne=(0,s.Lk)("div",{class:"col-2"},null,-1),Ye={class:"col-7"},ze={class:"row"},je={class:"col-4"},Je={style:{"margin-top":"8px"}},Be={class:"col"},Ge=(0,s.Lk)("div",{class:"col-3"},null,-1),He={key:1,class:"row q-mt-md"},Ze=(0,s.Lk)("div",{class:"col-2"},null,-1),et={class:"col-7"},tt={class:"row"},ot={class:"col-4"},st={style:{"margin-top":"8px"}},lt={class:"col"},it=(0,s.Lk)("div",{class:"col-3"},null,-1),at={key:2,class:"row q-mt-md"},rt=(0,s.Lk)("div",{class:"col-2"},null,-1),nt={class:"col-7"},dt={class:"row"},ct={class:"col-6"},ut={style:{"margin-top":"8px"}},mt={class:"col"},pt=(0,s.Lk)("div",{class:"col-3"},null,-1),_t={class:"row q-mt-md"},ht=(0,s.Lk)("div",{class:"col-2"},null,-1),gt=(0,s.Lk)("div",{class:"col-6"},null,-1),ft={class:"col-4"},bt=(0,s.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1);function vt(e,t,o,i,a,r){const n=(0,s.g2)("q-toolbar-title"),d=(0,s.g2)("q-btn"),c=(0,s.g2)("q-toolbar"),u=(0,s.g2)("q-tooltip"),m=(0,s.g2)("q-icon"),p=(0,s.g2)("q-select"),_=(0,s.g2)("q-input"),h=(0,s.g2)("q-toggle"),g=(0,s.g2)("q-card-section"),f=(0,s.g2)("f-btn"),b=(0,s.g2)("q-inner-loading"),v=(0,s.g2)("q-card"),k=(0,s.gN)("close-popup");return(0,s.uX)(),(0,s.Wv)(v,{style:{width:"1200px","max-width":"1200px",height:"600px"}},{default:(0,s.k6)((()=>[(0,s.Lk)("form",{onSubmit:t[26]||(t[26]=(0,N.D$)(((...t)=>e.submitFrom&&e.submitFrom(...t)),["prevent","stop"]))},[(0,s.bF)(c,{class:"text-white secondary-toolbar"},{default:(0,s.k6)((()=>[(0,s.bF)(n,null,{default:(0,s.k6)((()=>[e.row_id?((0,s.uX)(),(0,s.CE)("span",ae,(0,l.v_)(e.$t("pages.settings.master_data_lookup.edit_row")),1)):((0,s.uX)(),(0,s.CE)("span",re,(0,l.v_)(e.$t("pages.settings.master_data_lookup.create_row")),1))])),_:1}),(0,s.bo)((0,s.bF)(d,{flat:"",round:"",dense:"",icon:"close"},null,512),[[k]])])),_:1}),e.Office365_selected?((0,s.uX)(),(0,s.Wv)(g,{key:1},{default:(0,s.k6)((()=>[(0,s.Lk)("div",Oe,[(0,s.Lk)("div",xe,[(0,s.bF)(p,{modelValue:e.model["protocol"],"onUpdate:modelValue":[t[13]||(t[13]=t=>e.model["protocol"]=t),e.protocolUpdated],outlined:"",options:e.protocols,label:e.$t("pages.import.protocol")},{append:(0,s.k6)((()=>[e.errors["protocol"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","options","label","onUpdate:modelValue"])]),e.loading||1!=e.ms_is_authenticated?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Ie,[(0,s.bF)(p,{class:"full q-ml-sm",outlined:"",clearable:"",modelValue:e.model["sub_org_id"],"onUpdate:modelValue":t[14]||(t[14]=t=>e.model["sub_org_id"]=t),"use-input":"",options:e.filterSubOrgsList,onFilter:e.filterSubOrgslistEvent,label:e.$t("sub_organizations"),loading:e.sub_org_list_loading,"emit-value":"","map-options":""},null,8,["modelValue","options","onFilter","label","loading"])])),(0,s.Lk)("div",Qe,[0==e.ms_authenticate&&0==e.ms_is_authenticated?((0,s.uX)(),(0,s.Wv)(f,{key:0,class:"q-ml-sm",appearance:"secondary",label:e.$t("pages.import.authenticate"),onClick:t[15]||(t[15]=t=>e.submitFrom()),style:{height:"56px"}},null,8,["label"])):1==e.ms_authenticate&&0==e.ms_is_authenticated?((0,s.uX)(),(0,s.Wv)(f,{key:1,class:"q-ml-sm",style:{height:"56px"},label:e.$t("pages.import.finish_authentication"),onClick:t[16]||(t[16]=t=>e.msfinish())},null,8,["label"])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",Ke,[Me,(0,s.Lk)("div",We,[1==e.ms_authenticate&&0==e.ms_is_authenticated?((0,s.uX)(),(0,s.Wv)(_,{key:0,modelValue:e.ms_code,"onUpdate:modelValue":t[17]||(t[17]=t=>e.ms_code=t),label:e.$t("pages.import.microsoft_code"),outlined:"",readonly:"",onClick:e.copyText,id:"mscode",style:{"margin-left":"10px",width:"90%"}},null,8,["modelValue","label","onClick"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Pe,[1==e.ms_authenticate&&0==e.ms_is_authenticated?((0,s.uX)(),(0,s.Wv)(f,{key:0,style:{"margin-left":"4px","margin-top":"8px"},icon:"fas fa-copy",onClick:e.copyText},null,8,["onClick"])):(0,s.Q3)("",!0)]),Xe]),e.loading||1!=e.ms_is_authenticated?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Ue,[Ne,(0,s.Lk)("div",Ye,[(0,s.Lk)("div",ze,[(0,s.Lk)("div",je,[(0,s.bF)(h,{modelValue:e.use_folder,"onUpdate:modelValue":t[18]||(t[18]=t=>e.use_folder=t)},null,8,["modelValue"]),(0,s.Lk)("span",Je,(0,l.v_)(e.$t("Use Folder")),1)]),(0,s.Lk)("div",Be,[1==e.use_folder&&""!=e.row_id?((0,s.uX)(),(0,s.Wv)(p,{key:0,modelValue:e.model["folder"],"onUpdate:modelValue":t[19]||(t[19]=t=>e.model["folder"]=t),label:e.$t("pages.import.folder"),options:e.folder_list,outlined:"","data-cy":"folder",style:{"margin-left":"10px"}},null,8,["modelValue","label","options"])):(0,s.Q3)("",!0)])])]),Ge])),e.loading||1!=e.ms_is_authenticated?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",He,[Ze,(0,s.Lk)("div",et,[(0,s.Lk)("div",tt,[(0,s.Lk)("div",ot,[(0,s.bF)(h,{modelValue:e.use_email,"onUpdate:modelValue":t[20]||(t[20]=t=>e.use_email=t)},null,8,["modelValue"]),(0,s.Lk)("span",st,(0,l.v_)(e.$t("Use shared Mailbox")),1),(0,s.bF)(m,{name:"help",style:{"margin-top":"-8px","margin-left":"2px"}},{default:(0,s.k6)((()=>[(0,s.bF)(u,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("Seperate, shared Email-Adress you want to import from.")),1)])),_:1})])),_:1})]),(0,s.Lk)("div",lt,[1==e.use_email?((0,s.uX)(),(0,s.Wv)(_,{key:0,modelValue:e.model["shared_email"],"onUpdate:modelValue":t[21]||(t[21]=t=>e.model["shared_email"]=t),label:e.$t("pages.import.shared_email"),outlined:"","data-cy":"shared_email",style:{"margin-left":"10px"}},null,8,["modelValue","label"])):(0,s.Q3)("",!0)])])]),it])),e.loading||1!=e.ms_is_authenticated?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",at,[rt,(0,s.Lk)("div",nt,[(0,s.Lk)("div",dt,[(0,s.Lk)("div",ct,[(0,s.bF)(h,{dense:"",style:{"margin-left":"5px","margin-right":"5px"},modelValue:e.model["delete_after_import"],"onUpdate:modelValue":t[22]||(t[22]=t=>e.model["delete_after_import"]=t)},null,8,["modelValue"]),(0,s.Lk)("span",ut,(0,l.v_)(e.$t("Move Emails to other folder")),1)]),(0,s.Lk)("div",mt,[1==e.model["delete_after_import"]?((0,s.uX)(),(0,s.Wv)(p,{key:0,modelValue:e.model["move_to_folder"],"onUpdate:modelValue":t[23]||(t[23]=t=>e.model["move_to_folder"]=t),label:e.$t("pages.import.folder"),options:e.folder_list,outlined:"","data-cy":"folder"},null,8,["modelValue","label","options"])):(0,s.Q3)("",!0)])])]),pt]))])),_:1})):((0,s.uX)(),(0,s.Wv)(g,{key:0},{default:(0,s.k6)((()=>[(0,s.Lk)("div",ne,[(0,s.Lk)("div",de,[(0,s.bF)(p,{modelValue:e.model["protocol"],"onUpdate:modelValue":[t[0]||(t[0]=t=>e.model["protocol"]=t),e.protocolUpdated],outlined:"",options:e.protocols,label:e.$t("pages.import.protocol")},{append:(0,s.k6)((()=>[e.errors["protocol"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","options","label","onUpdate:modelValue"])]),(0,s.Lk)("div",ce,[(0,s.bF)(_,{modelValue:e.model["server"],"onUpdate:modelValue":t[1]||(t[1]=t=>e.model["server"]=t),label:e.$t("pages.import.server"),outlined:"",class:(0,l.C4)("full q-ml-sm")},{append:(0,s.k6)((()=>[e.errors["server"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),(0,s.Lk)("div",ue,[(0,s.bF)(_,{modelValue:e.model["port"],"onUpdate:modelValue":t[2]||(t[2]=t=>e.model["port"]=t),label:e.$t("pages.import.port"),outlined:"","data-cy":"port",class:(0,l.C4)("full q-ml-sm")},{append:(0,s.k6)((()=>[e.errors["port"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])])]),(0,s.Lk)("div",me,[(0,s.Lk)("div",pe,[(0,s.bF)(p,{modelValue:e.model["encryption"],"onUpdate:modelValue":t[3]||(t[3]=t=>e.model["encryption"]=t),outlined:"","data-cy":"encryption",options:e.encryptions,class:(0,l.C4)("full-width "),label:e.$t("pages.import.encryption")},{append:(0,s.k6)((()=>[e.errors["encryption"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","options","label"])]),(0,s.Lk)("div",_e,[(0,s.bF)(_,{modelValue:e.model["username"],"onUpdate:modelValue":t[4]||(t[4]=t=>e.model["username"]=t),class:(0,l.C4)(["full q-ml-sm","full q-ml-sm"]),label:e.$t("pages.import.username"),outlined:"","data-cy":"username"},{append:(0,s.k6)((()=>[e.errors["username"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),(0,s.Lk)("div",he,["IMAP"==e.model["protocol"]&&""!=e.row_id?((0,s.uX)(),(0,s.Wv)(p,{key:0,modelValue:e.model["folder"],"onUpdate:modelValue":t[5]||(t[5]=t=>e.model["folder"]=t),label:e.$t("pages.import.folder"),options:e.folder_list,outlined:"","data-cy":"folder",class:"full q-ml-sm"},null,8,["modelValue","label","options"])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",ge,[fe,(0,s.Lk)("div",be,[(0,s.bF)(_,{modelValue:e.model["email"],"onUpdate:modelValue":t[6]||(t[6]=t=>e.model["email"]=t),label:e.$t("pages.import.email"),outlined:"","data-cy":"email",class:(0,l.C4)("full q-ml-sm")},{append:(0,s.k6)((()=>[e.errors["email"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),e.row_id?((0,s.uX)(),(0,s.CE)("div",ve,[(0,s.bF)(h,{dense:"",style:{"margin-left":"5px","margin-right":"5px"},modelValue:e.model.delete_after_import,"onUpdate:modelValue":t[7]||(t[7]=t=>e.model.delete_after_import=t)},null,8,["modelValue"]),(0,s.Lk)("span",ke,(0,l.v_)(e.$t("Move Emails to other folder")),1),"IMAP"==e.model["protocol"]&&""!=e.row_id&&1==e.model["delete_after_import"]?((0,s.uX)(),(0,s.Wv)(p,{key:0,modelValue:e.model["move_to_folder"],"onUpdate:modelValue":t[8]||(t[8]=t=>e.model["move_to_folder"]=t),label:e.$t("pages.import.folder"),options:e.folder_list,outlined:"",dense:"","data-cy":"folder",class:"full q-ml-sm"},null,8,["modelValue","label","options"])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",ye,[we,(0,s.Lk)("div",Le,[(0,s.bF)(_,{modelValue:e.model["password"],"onUpdate:modelValue":t[9]||(t[9]=t=>e.model["password"]=t),type:"password",label:e.$t("pages.import.password"),outlined:"","data-cy":"password",class:(0,l.C4)("full q-ml-sm")},{append:(0,s.k6)((()=>[e.errors["password"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),(0,s.Lk)("div",Ee,[(0,s.Lk)("div",Fe,[(0,s.bF)(h,{dense:"",style:{"margin-left":"5px","margin-right":"5px"},modelValue:e.model["merge_pdf_files"],"onUpdate:modelValue":t[10]||(t[10]=t=>e.model["merge_pdf_files"]=t)},null,8,["modelValue"]),(0,s.Lk)("span",Ce,(0,l.v_)(e.$t("pages.import.merge_attached_documents")),1)])])]),(0,s.Lk)("div",Ae,[Re,(0,s.Lk)("div",De,[(0,s.bF)(p,{class:"full q-ml-sm",outlined:"",clearable:"",modelValue:e.model["sub_org_id"],"onUpdate:modelValue":t[11]||(t[11]=t=>e.model["sub_org_id"]=t),"use-input":"",options:e.filterSubOrgsList,onFilter:e.filterSubOrgslistEvent,label:e.$t("sub_organizations"),loading:e.sub_org_list_loading,"emit-value":"","map-options":""},null,8,["modelValue","options","onFilter","label","loading"])]),Se]),(0,s.Lk)("div",qe,[$e,(0,s.Lk)("div",Te,[(0,s.bF)(_,{class:(0,l.C4)(["full q-ml-sm","bg-disable"]),id:"apiKey",outlined:"",modelValue:e.api_key_ref,"onUpdate:modelValue":t[12]||(t[12]=t=>e.api_key_ref=t),readonly:"",label:e.$t("pages.import.token")},null,8,["modelValue","label"])]),Ve])])),_:1})),e.Office365_selected&&1!=e.ms_is_authenticated?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(g,{key:2,class:"p-t-0"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",_t,[ht,gt,(0,s.Lk)("div",ft,[e.Office365_selected?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(f,{key:0,type:"submit",class:"q-ml-sm float-right",label:e.$t("save")},null,8,["label"])),1==e.ms_is_authenticated?((0,s.uX)(),(0,s.Wv)(f,{key:1,class:"q-ml-sm float-right",label:e.$t("pages.import.save"),onClick:t[24]||(t[24]=t=>e.saveFolder())},null,8,["label"])):(0,s.Q3)("",!0),e.row_id?((0,s.uX)(),(0,s.Wv)(f,{key:2,appearance:"secondary",class:"q-ml-sm float-right",label:e.$t("pages.import.import"),onClick:t[25]||(t[25]=t=>e.manual_import())},null,8,["label"])):(0,s.Q3)("",!0),(0,s.bo)((0,s.bF)(f,{class:"float-right",appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[k]])])])])),_:1}))],32),(0,s.bF)(b,{showing:e.loading,class:"z-index-1"},{default:(0,s.k6)((()=>[bt])),_:1},8,["showing"])])),_:1})}var kt=o(1659),yt=o(94124),wt=o(78652),Lt=o(7813),Et=function(e,t,o,s){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,i){function a(e){try{n(s.next(e))}catch(t){i(t)}}function r(e){try{n(s["throw"](e))}catch(t){i(t)}}function n(e){e.done?o(e.value):l(e.value).then(a,r)}n((s=s.apply(e,t||[])).next())}))};const Ft=(0,s.pM)({el:"#app",mixins:[R.A,D.A],props:{selected_model:{},api_key:{type:String,default:""}},components:{},data(){return{}},setup(){const e=(0,yt.cY)(),{encryptions:t,protocols:o,subOrgList:s,sub_org_list_loading:l}=(0,kt.bP)(e),i=(0,A.KR)(e.subOrgList);return{EMAIL_ENCRYPTION_KEY:(0,A.KR)(""),subOrgList:s,sub_org_list_loading:l,filterSubOrgsList:i,protocols:o,encryptions:t,loading:(0,A.KR)(!1),model:(0,A.KR)({}),row_id:(0,A.KR)(""),errors:(0,A.KR)({}),Office365_selected:(0,A.KR)(!1),use_folder:(0,A.KR)(!1),use_email:(0,A.KR)(!1),ms_url:(0,A.KR)("https://microsoft.com/devicelogin"),ms_code:(0,A.KR)(""),ms_authenticate:(0,A.KR)(!1),ms_is_authenticated:(0,A.KR)(!1),ms_message:(0,A.KR)("Microsoft o365 is authenticated already."),api_key_ref:(0,A.KR)(""),folder_list:(0,A.KR)([])}},mounted:function(){const e="thi5i5@very5ecurehardc0d3denCrIp";if(void 0==e)throw"Missing EMAIL_ENCRYPTION_KEY env - unable to load";this.EMAIL_ENCRYPTION_KEY=e,this.initView()},methods:{initView(){return Et(this,void 0,void 0,(function*(){this.api_key_ref=this.api_key,this.row_id=this.selected_model.hasOwnProperty("id")?this.selected_model.id:"",""!=this.row_id&&(yield this.getFolders()),this.folder_list,this.model=JSON.parse(JSON.stringify(this.selected_model));for(let[e,t]of Object.entries(this.model))(t||"merge_pdf_files"!=e)&&(t||"delete_after_import"!=e)&&(t||"is_active"!=e)?t||(this.model[e]=""):this.model[e]=!1;this.protocolUpdated(),"OAuth Office365"==this.model.protocol&&(this.ms_is_authenticated=!0,"null"!=this.model.shared_email&&null!=this.model.shared_email?this.use_email=!0:(this.model.shared_email="",this.use_email=!1)),this.model.hasOwnProperty("service_type")||(this.model.service_type="Other"),null!=this.model["password"]&&""!=this.model["password"]&&(this.model["password"]=this.decryptPassword(this.model["password"]).toString(Lt.fk.Utf8)),this.row_id||this.resetForm()}))},resetForm(){this.model={active:!1,email:"",shared_email:"",username:"",password:"",server:"",port:"",folder:"",encryption:"",protocol:"",service_type:"Other",whole_email:!1,skip:!1,sub_org_id:"",delete_after_import:!1,merge_pdf_files:!1}},submitFrom(){return Et(this,void 0,void 0,(function*(){try{this.loading=!0,"OAuth Office365"==this.model.protocol&&this.updateModel();const e=yield le.D.AddUpdateEmail(this.prepareApiData());if(!e.success)throw e.message;if(this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),"OAuth Office365"!==this.model.protocol)return this.resetForm(),void this.updateEmailImportEvent();"OAuth Office365"==this.model.protocol&&e.hasOwnProperty("code")&&(this.model=e.data,this.row_id=this.model.id,this.ms_code=e.code,this.openMsPage(),this.ms_authenticate=!0);const t=new CustomEvent("record_saved",{detail:{}});document.dispatchEvent(t)}catch(e){const t=ie.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},prepareApiData(){let e=this.encryptPassword();return{email:this.model.email,shared_email:this.model.shared_email,password:e,username:this.model.username,server:this.model.server,port:this.model.port,encryption:this.model.encryption,protocol:this.model.protocol,whole_email:""!==this.model.whole_email&&this.model.whole_email,skip:""!==this.model.skip&&this.model.skip,api_key:this.api_key,sub_org_id:this.model.sub_org_id,id:this.row_id,folder:"SSL"!=this.model.encryption||"IMAP"!=this.model.protocol?"":this.model.folder,delete_after_import:this.model.delete_after_import,merge_pdf_files:this.model.merge_pdf_files,move_to_folder:1==this.model.delete_after_import?this.model.move_to_folder:""}},encryptPassword(){var e=Lt.fk.Utf8.parse(this.EMAIL_ENCRYPTION_KEY),t=Lt.c5.encrypt(this.model.password,e,{mode:Lt.Mq.ECB,padding:Lt.eV.PKCS7});return t},decryptPassword(e){var t=Lt.fk.Utf8.parse(this.EMAIL_ENCRYPTION_KEY),o=Lt.c5.decrypt(e,t,{mode:Lt.Mq.ECB});return o},updateModel(){this.model.password="",this.model.username="",this.model.server="",this.model.port="",this.model.encryption="",this.model.folder="",this.model.shared_email=null,this.model.sub_org_id=null},copyText(){(0,wt.A)(this.ms_code).then((()=>{this.showSuccessToast("Copied!")}))},updateEmailImportEvent(){const e=new CustomEvent("email_import_updated",{});document.dispatchEvent(e)},openMsPage(){window.open(this.ms_url,"_blank")},protocolUpdated(){"OAuth Office365"==this.model.protocol?this.Office365_selected=!0:this.Office365_selected=!1},msfinish(){return Et(this,void 0,void 0,(function*(){try{this.loading=!0;const e=yield le.D.finishMsAuth(this.row_id);1==e.success&&(this.ms_is_authenticated=!0,this.showSuccessToast(this.$t("Authentication completed")))}catch(e){this.showErrorToast(this.$t("Something failed on the transmission. Please try again."))}finally{this.loading=!1}}))},manual_import(){return Et(this,void 0,void 0,(function*(){this.loading=!0,yield le.D.performManuelImportMail(this.row_id),this.loading=!1,this.showSuccessToast(this.$t("pages.messages.import_try")),this.$router.push("/dashboard")}))},validateLoginTest(){let e=!0;this.resetErrors();const t=["folder","whole_email","skip","active"];if("OAuth Office365"===this.model.protocol)return e=!1,this.showErrorToast(this.$t("service_type_not_supported")),e;for(const[o,s]of Object.entries(this.model))t.includes(o)||s&&0!=String(s).length||(e=!1,this.errors[o]=!0);return e},resetErrors(){for(const[e,t]of Object.entries(this.model))this.errors[e]=!1},saveFolder(){return Et(this,void 0,void 0,(function*(){try{this.loading=!0;const e={id:this.row_id,folder:1==this.use_folder?this.model.folder:"null",shared_email:1==this.use_email?this.model.shared_email:"null",sub_org_id:this.model.sub_org_id,delete_after_import:this.model.delete_after_import,move_to_folder:this.model.move_to_folder};let t=yield le.D.saveFolder(e);if(!t.success)throw t;this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),this.resetForm(),this.updateEmailImportEvent()}catch(e){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.loading=!1}}))},getFolders(){return Et(this,void 0,void 0,(function*(){try{this.loading=!0;let e=yield le.D.getFolders(this.row_id);if(!e.success)throw e;this.folder_list=e.data}catch(e){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.loading=!1}}))},filterSubOrgslistEvent(e,t,o){t(e?()=>{const t=e.toLowerCase();this.filterSubOrgsList=this.subOrgList.filter((e=>e.label.toLowerCase().indexOf(t)>-1))}:()=>{this.filterSubOrgsList=this.subOrgList})}}});var Ct=o(23316),At=o(36914),Rt=o(39150),Dt=o(56384),St=o(44189),qt=o(50492),$t=o(66908),Tt=o(39035),Vt=o(88672);const Ot=(0,I.A)(Ft,[["render",vt]]),xt=Ot;P()(Ft,"components",{QCard:Ct.A,QToolbar:At.A,QToolbarTitle:Rt.A,QBtn:Dt.A,QCardSection:St.A,QSelect:M.A,QIcon:qt.A,QTooltip:K.A,QInput:Q.A,QToggle:$t.A,QInnerLoading:Tt.A}),P()(Ft,"directives",{ClosePopup:Vt.A});const It={class:"text-weight-bold primary-bg-text"},Qt={class:"q-pl-md q-pr-md q-pt-md"},Kt={class:"text-item"},Mt=(0,s.Lk)("div",{class:"row float-right"},null,-1),Wt={key:0,style:{"text-wrap":"wrap"}},Pt={key:1},Xt={class:"q-mt-md row full-width"};function Ut(e,t,o,i,a,r){const n=(0,s.g2)("q-toolbar-title"),d=(0,s.g2)("q-btn"),c=(0,s.g2)("q-toolbar"),u=(0,s.g2)("q-th"),m=(0,s.g2)("q-tr"),p=(0,s.g2)("q-td"),_=(0,s.g2)("q-icon"),h=(0,s.g2)("q-table"),g=(0,s.g2)("q-pagination"),f=(0,s.g2)("q-card-section"),b=(0,s.g2)("q-card"),v=(0,s.gN)("close-popup");return(0,s.uX)(),(0,s.Wv)(b,{style:{width:"1060px","max-width":"1060px"}},{default:(0,s.k6)((()=>[(0,s.bF)(c,{class:"secondary-toolbar"},{default:(0,s.k6)((()=>[(0,s.bF)(n,null,{default:(0,s.k6)((()=>[(0,s.Lk)("span",It,(0,l.v_)(e.$t("pages.import.connection_logs")),1)])),_:1}),(0,s.bo)((0,s.bF)(d,{flat:"",round:"",dense:"",class:"primary-bg-text",icon:"close",onClick:e.cleanupOnhide},null,8,["onClick"]),[[v]])])),_:1}),(0,s.bF)(f,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",Qt,[(0,s.bF)(h,{class:"dashboard-table-style dashboard-table-height back-white","rows-per-page-options":[0],rows:e.rows,columns:e.columns,"row-key":"id","hide-bottom":"",flat:"","table-header-class":"table-header-text back-white","no-data-label":e.$t("no_data_found"),"no-results-label":"The filter didn't uncover any results",style:{overflow:"auto",height:"550px"}},{header:(0,s.k6)((t=>[(0,s.bF)(m,{props:t},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.cols,((e,o)=>((0,s.uX)(),(0,s.Wv)(u,{key:e.name,props:t,"data-index":o},{default:(0,s.k6)((()=>[(0,s.Lk)("span",Kt,(0,l.v_)(e.label),1)])),_:2},1032,["props","data-index"])))),128))])),_:2},1032,["props"]),0==e.rows.length?((0,s.uX)(),(0,s.Wv)(m,{key:0},{default:(0,s.k6)((()=>[(0,s.bF)(p,{colspan:"20",class:"text-center"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("no_data_found")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),body:(0,s.k6)((e=>[(0,s.bF)(m,{props:e,id:e.key},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.cols,(t=>((0,s.uX)(),(0,s.CE)(s.FK,{key:t.name},["action"===t.name?((0,s.uX)(),(0,s.Wv)(p,{key:0},{default:(0,s.k6)((()=>[Mt])),_:1})):(0,s.Q3)("",!0),"success"===t.name?((0,s.uX)(),(0,s.Wv)(p,{key:1},{default:(0,s.k6)((()=>[(0,s.bF)(_,{name:!0===e.row[t.name]?"check_circle":"cancel",color:!0===e.row[t.name]?"green":"red",size:"20px"},null,8,["name","color"])])),_:2},1024)):((0,s.uX)(),(0,s.Wv)(p,{key:2},{default:(0,s.k6)((()=>["message"===t.name?((0,s.uX)(),(0,s.CE)("span",Wt,(0,l.v_)(e.row[t.name]),1)):((0,s.uX)(),(0,s.CE)("span",Pt,(0,l.v_)(e.row[t.name]),1))])),_:2},1024))],64)))),128))])),_:2},1032,["props","id"])])),_:1},8,["rows","columns","no-data-label"]),(0,s.Lk)("div",Xt,[e.total_pages>1?((0,s.uX)(),(0,s.Wv)(g,{key:0,modelValue:e.current_page,"onUpdate:modelValue":t[0]||(t[0]=t=>e.current_page=t),max:3,"max-pages":3,"direction-links":"",unelevated:"",color:"black","active-color":"black",class:"doc2-pagination q-mb-md q-ml-auto q-mr-auto",onClick:t[1]||(t[1]=t=>e.nexPageClicked())},null,8,["modelValue"])):(0,s.Q3)("",!0)])])])),_:1})])),_:1})}var Nt=o(36246),Yt=function(e,t,o,s){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,i){function a(e){try{n(s.next(e))}catch(t){i(t)}}function r(e){try{n(s["throw"](e))}catch(t){i(t)}}function n(e){e.done?o(e.value):l(e.value).then(a,r)}n((s=s.apply(e,t||[])).next())}))};const zt=(0,s.pM)({mixins:[D.A,R.A],props:{connection_id:{type:String,required:!0},connection_type:{type:String,required:!0}},components:{},watch:{},computed:{},mounted:function(){this.init(),this.checkConnectionLogs()},unmounted:function(){this.cleanupOnhide()},methods:{init(){this.prepareColumns()},checkConnectionLogs(){try{this.resetPagination(),this.getDataFromServer()}catch(e){const t=ie.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}},getDataFromServer(){return Yt(this,void 0,void 0,(function*(){try{this.loading=!0,this.request_params={},this.request_params["offset"]=this.offset,this.request_params["limit"]=10,this.request_params["connection_type"]=this.connection_type,this.request_params["connection_id"]=this.connection_id,this.request_params["order_by_direction"]="desc";const e=yield le.D.fetchConnectionLogs(this.request_params);if(!1===e.success)throw{message:e.message};this.total_records=e.total_records_count,this.setTotalPages(),this.prepareRows(e.elements)}catch(e){const t=ie.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},prepareRows(e){this.rows=[],Array.from(e).forEach((e=>{const t=e;this.addNewRow(t)}))},addNewRow(e){let t=Object.assign({},e);return t["created_on"]=this.formateDate(e["created_on"],"DD-MM-YYYY HH:mm:ss"),this.rows.push(t),this.rows.length.toString()},formateDate(e,t){return Nt.Ay.formatDate(e,t)},resetPagination(){this.offset=0,this.total_pages=0,this.current_page=1,this.total_records=0},setTotalPages(){this.total_pages=Math.ceil(this.total_records/this.page_size)},nexPageClicked(){return Yt(this,void 0,void 0,(function*(){try{this.calculateOffset(),yield this.getDataFromServer()}catch(e){const t=ie.t.getErrorMessage(e);this.showErrorToast(t)}}))},calculateOffset(){this.offset=10*(this.current_page-1)},prepareColumns(){this.columns=[],this.columns.push({name:"success",label:this.$t("status"),field:"status",align:"left"}),this.columns.push({name:"created_on",label:this.$t("pages.import.attempted_on"),field:"created_on",align:"left"}),this.columns.push({name:"message",label:this.$t("pages.support.message"),field:"message",align:"left"})},cleanupOnhide(){this.resetPagination()}},setup(){return{loading:(0,A.KR)(!1),request_params:(0,A.KR)({}),current_page:(0,A.KR)(1),total_pages:(0,A.KR)(0),offset:(0,A.KR)(0),page_size:(0,A.KR)(8),total_records:(0,A.KR)(0),columns:(0,A.KR)([]),rows:(0,A.KR)([])}}});var jt=o(42315),Jt=o(44488),Bt=o(57722),Gt=o(45262),Ht=o(54700);const Zt=(0,I.A)(zt,[["render",Ut]]),eo=Zt;P()(zt,"components",{QCard:Ct.A,QToolbar:At.A,QToolbarTitle:Rt.A,QBtn:Dt.A,QCardSection:St.A,QTable:jt.A,QTr:Jt.A,QTh:Bt.A,QTd:Gt.A,QIcon:qt.A,QPagination:Ht.A,QInnerLoading:Tt.A}),P()(zt,"directives",{ClosePopup:Vt.A});var to=o(49332),oo=o(51476);const so="sub_app",lo={methods:{async getSubscriptionFromServer(){try{const e=await le.jD.getSubscription();if(!e||!e||!Array.isArray(e)||0==e.length)return;(0,oo._Y)(so,this.getDoc2AppSubscription(e))}catch(e){}},getDoc2AppSubscription(e){let t=!1,o={};for(let s of e){const e=s.apps;for(let l of e)if("FELLOW_DOC2"===l.app_key){t=!0,o=s;break}if(!0===t)break}return o},getRemainingDays(){let e=-1,t=this.getSubscription();if(!t)return null;let o=this.getDateFromServerDate(t.end_date);const s=(new Date).setHours(0,0,0,0);return e=this.datediff(s,o),e},datediff(e,t){return Math.round((t-e)/864e5)},getDateFromServerDate(e){var t=e.split(" ");return new Date(t[0]).setHours(0,0,0,0)},async getsubscriptionRemainingDays(){let e=0;try{e=this.getRemainingDays(),null==e&&(await this.getSubscriptionFromServer(),e=this.getRemainingDays())}catch(t){}return e},subscriptionAlertShowDays(){return 30},getSubscription(){let e=(0,oo.KW)(so);return e&&e.hasOwnProperty("start_date")&&e.hasOwnProperty("end_date")?e:null}}};var io=o(41498),ao=o(45022),ro=function(e,t,o,s){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,i){function a(e){try{n(s.next(e))}catch(t){i(t)}}function r(e){try{n(s["throw"](e))}catch(t){i(t)}}function n(e){e.done?o(e.value):l(e.value).then(a,r)}n((s=s.apply(e,t||[])).next())}))};const no=(0,s.pM)({mixins:[R.A,D.A,lo,se.A],components:{EditCreate:xt,ConnectionLogs:eo,ImportLogs:to.A},watch:{sub_org_list_loading(e,t){!1===e&&this.initView()}},mounted:function(){const e="thi5i5@very5ecurehardc0d3denCrIp";void 0!=e?(this.EMAIL_ENCRYPTION_KEY=e,this.initDragDropColumns("email_import_table","label",["action"]),document.addEventListener("email_import_table-column-drop",this.onDropColumns),document.addEventListener("email_import_updated",this.emailImportUpdated),this.handleSubOrgs()):this.showErrorToast("Missing an important value - unable to load email import")},unmounted:function(){document.removeEventListener("email_import_updated",this.emailImportUpdated),document.removeEventListener("email_import_table-column-drop",this.onDropColumns)},methods:{showMailConnectionLogs(e){this.connection_type="email_import",this.connection_id=e,this.show_connection_logs=!0},initView(){return ro(this,void 0,void 0,(function*(){try{this.loading=!0,this.prepareColumns(),yield this.getAppKey(),this.flattenSubOrgs(),this.getList()}catch(e){const t=ie.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},handleSubOrgs(){this.subOrgList.length>1&&this.initView(),this.sub_org_list_loading&&(this.loading=!0)},getList(){return ro(this,void 0,void 0,(function*(){try{this.loading=!0,this.prepareColumns();const e=yield le.D.getList();if(0==e.data.length)return;this.prepareRows(e.data)}catch(e){const t=ie.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},prepareRows(e){this.rows=[],Array.from(e).forEach((e=>{const t=e;this.addNewRow(t)}))},addNewRow(e){let t=Object.assign({},e);return this.rows.push(t),this.rows.length.toString()},createNewRecord(){this.selected_row={},this.show_edit_create=!0},emailImportUpdated(){this.show_edit_create=!1,this.getList()},editRow(e,t){this.selected_row=JSON.parse(JSON.stringify(t)),this.show_edit_create=!0},deleteClicked(e,t){return ro(this,void 0,void 0,(function*(){try{this.loading=!0;const o=yield le.D.deleteRecord(t);!0===o.success&&this.rows.splice(e,1),this.showSuccessToast(this.$t("success"))}catch(o){const e=ie.t.getErrorMessage(o);this.showErrorToast(e)}finally{this.loading=!1}}))},getAppKey(){return ro(this,void 0,void 0,(function*(){try{this.loading=!0;const e={app_key:"FELLOW_DOC2"},t=yield le.jD.getAppSubscription(e);this.api_key=t[0].token}catch(e){const t=ie.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},de_activateEmail(e){return ro(this,void 0,void 0,(function*(){try{this.loading=!0;const t=e.id,o=e.is_active;yield le.D.DeActivateEmail(t,o);this.showSuccessToast(this.$t("success"))}catch(t){const e=ie.t.getErrorMessage(t);this.showErrorToast(e)}finally{this.loading=!1}}))},checkLogin(e){return ro(this,void 0,void 0,(function*(){try{this.loading=!0;const t=yield le.D.testEmailLogin(String(e.id));if(!t||t.hasOwnProperty("success")&&!1===t.success)throw t;this.showSuccessToast(this.$t("check_login_success"))}catch(t){const e=ie.t.getErrorMessage(t);this.showErrorToast(e)}finally{this.loading=!1}}))},flattenSubOrgs(){this.subOrgList.forEach((e=>{this.sub_orgs_flattened[e.value]=e.label}))},prepareColumns(){this.columns=[],this.columns.push({name:"username",label:this.$t("username"),field:"username",align:"left"}),this.columns.push({name:"email",label:this.$t("email"),field:"email",align:"left"}),this.columns.push({name:"shared_email",label:this.$t("shared_email"),field:"shared_email",align:"left"}),this.columns.push({name:"protocol",label:this.$t("protocol"),field:"protocol",align:"left"}),this.columns.push({name:"encryption",label:this.$t("encryption"),field:"encryption",align:"left"}),this.columns.push({name:"sub_org_id",label:this.$t("sub_organizations"),field:"sub_org_id",align:"left"}),this.columns.push({name:"folder",label:this.$t("folder"),field:"folder",align:"left"}),this.columns.push({name:"action",label:this.$t("action"),field:"action",align:"right"});const e=ao.A.getItem("EMAIL_IMPORT_SETTING_COLUMNS");this.columns=e&&""!=e?JSON.parse(e):this.columns},onDropColumns(){ao.A.set("EMAIL_IMPORT_SETTING_COLUMNS",JSON.stringify(this.columns))},webSiteLink(){const e=(0,io.TE)("import_settings");e&&window.open(e)}},setup(){const e=(0,yt.cY)(),{subOrgList:t,sub_org_list_loading:o}=(0,kt.bP)(e);let s=(0,A.KR)({});const l=(0,A.KR)(null);return{sub_org_list_loading:o,subOrgList:t,myForm:l,import_email:s,errors:(0,A.KR)({}),show_connection_logs:(0,A.KR)(!1),connection_type:(0,A.KR)(""),connection_id:(0,A.KR)({}),sub_orgs_flattened:(0,A.KR)({}),processing:(0,A.KR)(!1),ms_url:(0,A.KR)("https://microsoft.com/devicelogin"),ms_code:(0,A.KR)(""),ms_authenticate:(0,A.KR)(!1),ms_is_authenticated:(0,A.KR)(!1),ms_message:(0,A.KR)("Microsoft o365 is authenticated already."),loading:(0,A.KR)(!1),userDialog:(0,A.KR)(!1),columns:(0,A.KR)([]),rows:(0,A.KR)([]),show_edit_create:(0,A.KR)(!1),selected_row:(0,A.KR)({}),api_key:(0,A.KR)(""),EMAIL_ENCRYPTION_KEY:(0,A.KR)("")}},data(){return{}}});var co=o(84436),uo=o(53999),mo=o(90124),po=o(25173),_o=o(10386),ho=o(82156);const go=(0,I.A)(no,[["render",oe]]),fo=go;P()(no,"components",{QTable:jt.A,QTr:Jt.A,QTh:Bt.A,QTd:Gt.A,QBtn:Dt.A,QMenu:co.A,QList:uo.A,QItem:mo.A,QItemSection:po.A,QSeparator:_o.A,QTooltip:K.A,QInnerLoading:Tt.A,QDialog:ho.A});const bo={class:"container"},vo={class:"row mt-8 mb-25"},ko={class:"row"},yo={key:0,class:"cursor-default"},wo={key:1},Lo={class:"row float-right"},Eo={class:"text-red-14"},Fo=(0,s.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1);function Co(e,t,o,i,a,r){const n=(0,s.g2)("f-btn"),d=(0,s.g2)("q-th"),c=(0,s.g2)("q-tr"),u=(0,s.g2)("q-item-section"),m=(0,s.g2)("q-item"),p=(0,s.g2)("q-separator"),_=(0,s.g2)("q-list"),h=(0,s.g2)("q-menu"),g=(0,s.g2)("q-btn"),f=(0,s.g2)("q-td"),b=(0,s.g2)("q-table"),v=(0,s.g2)("q-inner-loading"),k=(0,s.g2)("EditCreate"),y=(0,s.g2)("q-dialog"),w=(0,s.g2)("ConnectionLogs");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",bo,[(0,s.Lk)("div",vo,[(0,s.bF)(n,{class:"q-ml-auto float-right",icon:"add",label:e.$t("new"),id:"create_new_ftp",onClick:e.createNewRecord},null,8,["label","onClick"])]),(0,s.Lk)("div",ko,[(0,s.bF)(b,{style:{width:"100%",height:"100%"},class:"dashboard-table-style dashboard-table-height back-white",rows:e.rows,columns:e.columns,"row-key":"name",flat:"","no-data-label":e.$t("pages.messages.no_record_found"),"table-header-class":"table-header-text","rows-per-page-options":[0],id:"ftp_import_table"},{header:(0,s.k6)((t=>[(0,s.bF)(c,{props:t},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.cols,((o,i)=>((0,s.uX)(),(0,s.Wv)(d,{key:o.name,props:t,"data-index":i,draggable:e.canDragDropColumn(o),dropzone:e.canDragDropColumn(o),direction:"horizontal",onDragstart:t=>e.onDragStart(t,e.columns,i),onDrop:(0,N.D$)((t=>e.handleDrop(t,i)),["prevent"]),onDragover:(0,N.D$)((t=>e.onDragOver(t,i)),["prevent"]),onDragenter:(0,N.D$)(e.onDragEnter,["prevent"]),onDragleave:(0,N.D$)(e.onDragLeave,["prevent"]),style:(0,l.Tr)({cursor:e.getIsDragging?"pointer":"move"})},{default:(0,s.k6)((()=>["action"==o.name?((0,s.uX)(),(0,s.CE)("span",yo,(0,l.v_)(o.label),1)):((0,s.uX)(),(0,s.CE)("span",wo,(0,l.v_)(o.label),1))])),_:2},1032,["props","data-index","draggable","dropzone","onDragstart","onDrop","onDragover","onDragenter","onDragleave","style"])))),128))])),_:2},1032,["props"])])),body:(0,s.k6)((o=>[(0,s.bF)(c,{props:o,id:o.key},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.cols,(i=>((0,s.uX)(),(0,s.CE)(s.FK,{key:i.name},["action"===i.name?((0,s.uX)(),(0,s.Wv)(f,{key:0,style:{width:"236px"}},{default:(0,s.k6)((()=>[(0,s.Lk)("div",Lo,[(0,s.bF)(g,{flat:"",dense:"",round:"",onClick:t[0]||(t[0]=(0,N.D$)((()=>{}),["stop","prevent"])),icon:"more_horiz"},{default:(0,s.k6)((()=>[(0,s.bF)(h,{"auto-close":"","transition-show":"jump-down","transition-hide":"jump-up",anchor:"bottom middle",self:"top middle"},{default:(0,s.k6)((()=>[(0,s.bF)(_,{dense:"",style:{"min-width":"100px"}},{default:(0,s.k6)((()=>[(0,s.bF)(m,{clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(u,{onClick:t=>e.checkConnection(o.row.id)},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("test_connection")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,s.bF)(m,{clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(u,{onClick:t=>e.showFtpConnectionLogs(o.row.id)},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.import.connection_logs")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,s.bF)(p,{inset:""}),(0,s.bF)(m,{clickable:""},{default:(0,s.k6)((()=>[o.row.is_active?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(u,{key:0,onClick:t=>{o.row.is_active=!0,e.de_activate(o.row)}},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("activate")),1)])),_:2},1032,["onClick"])),o.row.is_active?((0,s.uX)(),(0,s.Wv)(u,{key:1,onClick:t=>{o.row.is_active=!1,e.de_activate(o.row)}},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("deactivate")),1)])),_:2},1032,["onClick"])):(0,s.Q3)("",!0)])),_:2},1024),(0,s.bF)(m,{clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(u,{onClick:t=>e.editRow(o.rowIndex,o.row)},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("edit")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,s.bF)(p,{inset:""}),(0,s.bF)(m,{clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(u,{onClick:t=>e.deleteClicked(o.rowIndex,o.row.id)},{default:(0,s.k6)((()=>[(0,s.Lk)("span",Eo,(0,l.v_)(e.$t("delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])])),_:2},1024)):"sub_org_id"===i.name?((0,s.uX)(),(0,s.Wv)(f,{key:1,class:(0,l.C4)(o.row.is_active?"":"email-import-deactive-column")},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.sub_orgs_flattened[o.row[i.name]]),1)])),_:2},1032,["class"])):((0,s.uX)(),(0,s.Wv)(f,{key:2,class:(0,l.C4)(1==o.row.is_active?"":"email-import-deactive-column")},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)("null"===o.row[i.name]?"":o.row[i.name]),1)])),_:2},1032,["class"]))],64)))),128))])),_:2},1032,["props","id"])])),_:1},8,["rows","columns","no-data-label"])])]),(0,s.bF)(v,{showing:e.loading,class:"z-index-1",style:{"z-index":"1000"}},{default:(0,s.k6)((()=>[Fo])),_:1},8,["showing"]),(0,s.bF)(y,{modelValue:e.show_edit_create,"onUpdate:modelValue":t[1]||(t[1]=t=>e.show_edit_create=t),persistent:"",onKeydown:t[2]||(t[2]=(0,N.jR)((t=>e.show_edit_create=!1),["esc"]))},{default:(0,s.k6)((()=>[(0,s.bF)(k,{selected_model:e.selected_row,api_key:e.api_key},null,8,["selected_model","api_key"])])),_:1},8,["modelValue"]),(0,s.bF)(y,{modelValue:e.show_connection_logs,"onUpdate:modelValue":t[3]||(t[3]=t=>e.show_connection_logs=t)},{default:(0,s.k6)((()=>[(0,s.bF)(w,{connection_id:e.connection_id,connection_type:"ftp_import"},null,8,["connection_id"])])),_:1},8,["modelValue"])],64)}const Ao={key:0,class:"text-weight-bold"},Ro={key:1,class:"text-weight-bold"},Do={class:"row q-mt-md"},So={class:"col-2"},qo={class:"col-7"},$o={class:"col-3"},To={class:"row q-mt-md"},Vo={class:"col-2"},Oo={class:"col-7"},xo=(0,s.Lk)("div",{class:"col-3"},null,-1),Io={class:"row q-mt-md"},Qo=(0,s.Lk)("div",{class:"col-2"},null,-1),Ko={class:"col-7"},Mo=(0,s.Lk)("div",{class:"col-3"},null,-1),Wo={class:"row q-mt-md"},Po=(0,s.Lk)("div",{class:"col-2"},null,-1),Xo={class:"col-7"},Uo=(0,s.Lk)("div",{class:"col-3"},null,-1),No={class:"row q-mt-md"},Yo=(0,s.Lk)("div",{class:"col-2"},null,-1),zo={class:"col-7"},jo=(0,s.Lk)("div",{class:"col-3"},null,-1),Jo={class:"row q-mt-md"},Bo=(0,s.Lk)("div",{class:"col-2"},null,-1),Go={class:"col-7"},Ho=(0,s.Lk)("div",{class:"col-3"},null,-1),Zo={class:"row q-mt-md"},es=(0,s.Lk)("div",{class:"col-2"},null,-1),ts={class:"col-7"},os=(0,s.Lk)("div",{class:"col-3"},null,-1),ss=(0,s.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1);function ls(e,t,o,i,a,r){const n=(0,s.g2)("q-toolbar-title"),d=(0,s.g2)("q-btn"),c=(0,s.g2)("q-toolbar"),u=(0,s.g2)("q-tooltip"),m=(0,s.g2)("q-icon"),p=(0,s.g2)("q-select"),_=(0,s.g2)("q-input"),h=(0,s.g2)("q-card-section"),g=(0,s.g2)("q-inner-loading"),f=(0,s.g2)("q-card"),b=(0,s.gN)("close-popup");return(0,s.uX)(),(0,s.Wv)(f,{style:{width:"1200px","max-width":"1200px",height:"600px"}},{default:(0,s.k6)((()=>[(0,s.Lk)("form",{onSubmit:t[10]||(t[10]=(0,N.D$)(((...t)=>e.submitFrom&&e.submitFrom(...t)),["prevent","stop"]))},[(0,s.bF)(c,{class:"text-white secondary-toolbar"},{default:(0,s.k6)((()=>[(0,s.bF)(n,null,{default:(0,s.k6)((()=>[e.row_id?((0,s.uX)(),(0,s.CE)("span",Ao,(0,l.v_)(e.$t("pages.settings.master_data_lookup.edit_row")),1)):((0,s.uX)(),(0,s.CE)("span",Ro,(0,l.v_)(e.$t("pages.settings.master_data_lookup.create_row")),1))])),_:1}),(0,s.bo)((0,s.bF)(d,{flat:"",round:"",dense:"",icon:"close"},null,512),[[b]])])),_:1}),(0,s.bF)(h,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",Do,[(0,s.Lk)("div",So,[(0,s.bF)(p,{"data-cy":"ftp_type",modelValue:e.model["ftp_type"],"onUpdate:modelValue":t[0]||(t[0]=t=>e.model["ftp_type"]=t),outlined:"",options:e.ftp_types,label:e.$t("type")},{append:(0,s.k6)((()=>[e.errors["ftp_type"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","options","label"])]),(0,s.Lk)("div",qo,[(0,s.bF)(_,{"data-cy":"ftp_server",modelValue:e.model["server"],"onUpdate:modelValue":t[1]||(t[1]=t=>e.model["server"]=t),label:e.$t("pages.import.server"),outlined:"",class:(0,l.C4)("full q-ml-sm")},{append:(0,s.k6)((()=>[e.errors["server"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),(0,s.Lk)("div",$o,[(0,s.bF)(_,{modelValue:e.model["default_directory"],"onUpdate:modelValue":t[2]||(t[2]=t=>e.model["default_directory"]=t),label:e.$t("default_directory"),outlined:"","data-cy":"ftp_default_directory",class:"full q-ml-sm"},null,8,["modelValue","label"])])]),(0,s.Lk)("div",To,[(0,s.Lk)("div",Vo,[(0,s.bF)(_,{modelValue:e.model["port"],"onUpdate:modelValue":t[3]||(t[3]=t=>e.model["port"]=t),label:e.$t("pages.import.port"),outlined:"","data-cy":"ftp_port",class:(0,l.C4)("full")},{append:(0,s.k6)((()=>[e.errors["port"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),(0,s.Lk)("div",Oo,[(0,s.bF)(_,{modelValue:e.model["username"],"onUpdate:modelValue":t[4]||(t[4]=t=>e.model["username"]=t),class:(0,l.C4)(["full q-ml-sm","full q-ml-sm"]),label:e.$t("username"),outlined:"","data-cy":"ftp_username"},{append:(0,s.k6)((()=>[e.errors["username"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),xo]),(0,s.Lk)("div",Io,[Qo,(0,s.Lk)("div",Ko,[(0,s.bF)(_,{modelValue:e.model["password"],"onUpdate:modelValue":t[5]||(t[5]=t=>e.model["password"]=t),type:"password",label:e.$t("pages.import.password"),outlined:"","data-cy":"ftp_password",class:(0,l.C4)("full q-ml-sm")},{append:(0,s.k6)((()=>[e.errors["password"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),Mo]),(0,s.Lk)("div",Wo,[Po,(0,s.Lk)("div",Xo,[(0,s.bF)(_,{modelValue:e.model["file_name_matching_patterns"],"onUpdate:modelValue":t[6]||(t[6]=t=>e.model["file_name_matching_patterns"]=t),label:e.$t("file_name_matching_patterns"),outlined:"","data-cy":"ftp_file_name_matching_patterns",class:"full q-ml-sm"},null,8,["modelValue","label"])]),Uo]),(0,s.Lk)("div",No,[Yo,(0,s.Lk)("div",zo,[(0,s.bF)(p,{"data-cy":"ftp_sub_org",class:"full q-ml-sm",outlined:"",clearable:"",modelValue:e.model["sub_org_id"],"onUpdate:modelValue":t[7]||(t[7]=t=>e.model["sub_org_id"]=t),"use-input":"",options:e.filterSubOrgsList,onFilter:e.filterSubOrgslistEvent,label:e.$t("sub_organizations"),loading:e.sub_org_list_loading,"emit-value":"","map-options":""},null,8,["modelValue","options","onFilter","label","loading"])]),jo]),(0,s.Lk)("div",Jo,[Bo,(0,s.Lk)("div",Go,[(0,s.bF)(_,{class:(0,l.C4)(["full q-ml-sm","bg-disable"]),"data-cy":"ftp_apiKey",outlined:"",modelValue:e.api_key_ref,"onUpdate:modelValue":t[8]||(t[8]=t=>e.api_key_ref=t),readonly:"",label:e.$t("pages.import.token")},null,8,["modelValue","label"])]),Ho])])),_:1}),(0,s.bF)(h,{class:"p-t-0"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",Zo,[es,(0,s.Lk)("div",ts,[(0,s.bF)(d,{type:"submit",color:"primary",class:"q-ml-sm float-right",id:"ftp_btn_save",label:e.$t("save")},null,8,["label"]),e.row_id?((0,s.uX)(),(0,s.Wv)(d,{key:0,class:"q-ml-sm float-right",color:"primary",label:e.$t("test_connection"),id:"ftp_btn_test_connection",onClick:t[9]||(t[9]=t=>e.checkConnection())},{default:(0,s.k6)((()=>[e.row_id?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(u,{key:0},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("available_after_save")),1)])),_:1}))])),_:1},8,["label"])):(0,s.Q3)("",!0),(0,s.bo)((0,s.bF)(d,{id:"ftp_btn_cancel",class:"float-right highlighted-back",label:e.$t("cancel")},null,8,["label"]),[[b]])]),os])])),_:1})],32),(0,s.bF)(g,{showing:e.loading,class:"z-index-1"},{default:(0,s.k6)((()=>[ss])),_:1},8,["showing"])])),_:1})}var is=function(e,t,o,s){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,i){function a(e){try{n(s.next(e))}catch(t){i(t)}}function r(e){try{n(s["throw"](e))}catch(t){i(t)}}function n(e){e.done?o(e.value):l(e.value).then(a,r)}n((s=s.apply(e,t||[])).next())}))};const as=(0,s.pM)({el:"#app",mixins:[R.A,D.A],props:{selected_model:{},api_key:{type:String,default:""}},components:{},data(){return{}},setup(){const e=(0,yt.cY)(),{ftp_types:t,subOrgList:o,sub_org_list_loading:s}=(0,kt.bP)(e),l=(0,A.KR)(e.subOrgList);return{EMAIL_ENCRYPTION_KEY:(0,A.KR)(""),subOrgList:o,sub_org_list_loading:s,filterSubOrgsList:l,ftp_types:t,loading:(0,A.KR)(!1),model:(0,A.KR)({}),row_id:(0,A.KR)(""),errors:(0,A.KR)({}),api_key_ref:(0,A.KR)("")}},mounted:function(){const e="thi5i5@very5ecurehardc0d3denCrIp";if(void 0==e)throw"Missing EMAIL_ENCRYPTION_KEY env - unable to load";this.EMAIL_ENCRYPTION_KEY=e,this.initView()},methods:{initView(){this.api_key_ref=this.api_key,this.row_id=this.selected_model.hasOwnProperty("id")?this.selected_model.id:"",this.model=JSON.parse(JSON.stringify(this.selected_model));for(let[e,t]of Object.entries(this.model))t||(this.model[e]="");this.model["server"]=this.model["server_url"],this.row_id||this.resetForm()},resetForm(){this.model={username:"",password:"",server:"",port:"22",default_directory:"",file_name_matching_patterns:"",ftp_type:"SFTP",sub_org_id:""}},submitFrom(){return is(this,void 0,void 0,(function*(){try{if(!this.validateForm())return;this.loading=!0;const e=yield le.D.ftpImportAddUpdate(this.prepareApiData());if(!e.success)throw e;e.data.hasOwnProperty("id")&&(this.row_id=e.data.id),this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),yield this.checkConnection();const t=new CustomEvent("ftp_import_updated",{detail:{}});document.dispatchEvent(t)}catch(e){const t=ie.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},validateForm(){let e=!0;this.resetErrors();const t=["default_directory","file_name_matching_patterns","sub_org_id"];for(const[o,s]of Object.entries(this.model))t.includes(o)||"is_active"===o||s&&0!=String(s).length||(e=!1,this.errors[o]=!0);return e},prepareApiData(){this.encryptPassword();return{password:this.model.password,username:this.model.username,server:this.model.server,port:this.model.port,ftp_type:this.model.ftp_type,file_name_matching_patterns:this.model.file_name_matching_patterns,api_key:this.api_key,sub_org_id:this.model.sub_org_id,id:this.row_id,default_directory:this.model.default_directory}},encryptPassword(){var e=Lt.fk.Utf8.parse(this.EMAIL_ENCRYPTION_KEY),t=Lt.c5.encrypt(this.model.password,e,{mode:Lt.Mq.ECB,padding:Lt.eV.PKCS7});return t},decryptPassword(e){var t=Lt.fk.Utf8.parse(this.EMAIL_ENCRYPTION_KEY),o=Lt.c5.decrypt(e,t,{mode:Lt.Mq.ECB});return o},updateFTPImportEvent(){const e=new CustomEvent("email_import_updated",{});document.dispatchEvent(e)},checkConnection(){return is(this,void 0,void 0,(function*(){try{if(!this.row_id)return;this.loading=!0;const e=yield le.D.ftpConnectionTest(this.row_id);if(!e||e.hasOwnProperty("success")&&!1===e.success)throw e;this.showSuccessToast(this.$t("test_connection_success"))}catch(e){const t=ie.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},resetErrors(){for(const[e,t]of Object.entries(this.model))this.errors[e]=!1},filterSubOrgslistEvent(e,t,o){t(e?()=>{const t=e.toLowerCase();this.filterSubOrgsList=this.subOrgList.filter((e=>e.label.toLowerCase().indexOf(t)>-1))}:()=>{this.filterSubOrgsList=this.subOrgList})}}}),rs=(0,I.A)(as,[["render",ls]]),ns=rs;P()(as,"components",{QCard:Ct.A,QToolbar:At.A,QToolbarTitle:Rt.A,QBtn:Dt.A,QCardSection:St.A,QSelect:M.A,QIcon:qt.A,QTooltip:K.A,QInput:Q.A,QInnerLoading:Tt.A}),P()(as,"directives",{ClosePopup:Vt.A});var ds=function(e,t,o,s){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,i){function a(e){try{n(s.next(e))}catch(t){i(t)}}function r(e){try{n(s["throw"](e))}catch(t){i(t)}}function n(e){e.done?o(e.value):l(e.value).then(a,r)}n((s=s.apply(e,t||[])).next())}))};const cs=(0,s.pM)({mixins:[R.A,D.A,lo,se.A],components:{EditCreate:ns,ConnectionLogs:eo},watch:{sub_org_list_loading(e,t){!1===e&&this.initView()}},mounted:function(){const e="thi5i5@very5ecurehardc0d3denCrIp";void 0!=e?(this.initDragDropColumns("ftp_import_table","label",["action"]),document.addEventListener("ftp_import_table-column-drop",this.onDropColumns),document.addEventListener("ftp_import_updated",this.emailImportUpdated),this.handleSubOrgs()):this.showErrorToast("Missing an important value - unable to load email import")},unmounted:function(){document.removeEventListener("ftp_import_updated",this.emailImportUpdated),document.removeEventListener("ftp_import_table-column-drop",this.onDropColumns)},methods:{showFtpConnectionLogs(e){this.connection_id=e,this.show_connection_logs=!0},initView(){return ds(this,void 0,void 0,(function*(){try{this.loading=!0,this.prepareColumns(),yield this.getAppKey(),this.flattenSubOrgs(),this.getList()}catch(e){const t=ie.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},handleSubOrgs(){this.subOrgList.length>1&&this.initView(),this.sub_org_list_loading&&(this.loading=!0)},getList(){return ds(this,void 0,void 0,(function*(){try{this.loading=!0,this.prepareColumns();const e=yield le.D.getFTPImport_List();if(0==e.data.length)return;this.prepareRows(e.data)}catch(e){const t=ie.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},prepareRows(e){this.rows=[],Array.from(e).forEach((e=>{const t=e;this.addNewRow(t)}))},addNewRow(e){let t=Object.assign({},e);return this.rows.push(t),this.rows.length.toString()},createNewRecord(){this.selected_row={},this.show_edit_create=!0},emailImportUpdated(){this.show_edit_create=!1,this.getList()},editRow(e,t){this.selected_row=JSON.parse(JSON.stringify(t)),this.show_edit_create=!0},deleteClicked(e,t){return ds(this,void 0,void 0,(function*(){try{this.loading=!0;const o=yield le.D.ftpImportDelete(t);!0===o.success&&this.rows.splice(e,1),this.showSuccessToast(this.$t("success"))}catch(o){const e=ie.t.getErrorMessage(o);this.showErrorToast(e)}finally{this.loading=!1}}))},checkConnection(e){return ds(this,void 0,void 0,(function*(){try{this.loading=!0;const t=yield le.D.ftpConnectionTest(e);if(!t||t.hasOwnProperty("success")&&!1===t.success)throw t;this.showSuccessToast(this.$t("test_connection_success"))}catch(t){const e=ie.t.getErrorMessage(t);this.showErrorToast(e)}finally{this.loading=!1}}))},getAppKey(){return ds(this,void 0,void 0,(function*(){try{this.loading=!0;const e={app_key:"FELLOW_DOC2"},t=yield le.jD.getAppSubscription(e);this.api_key=t[0].token}catch(e){const t=ie.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},de_activate(e){return ds(this,void 0,void 0,(function*(){try{this.loading=!0;const t=e.id,o=e.is_active;yield le.D.setFTPImportActiveDeactive(t,o);this.showSuccessToast(this.$t("success"))}catch(t){const e=ie.t.getErrorMessage(t);this.showErrorToast(e)}finally{this.loading=!1}}))},flattenSubOrgs(){this.subOrgList.forEach((e=>{this.sub_orgs_flattened[e.value]=e.label}))},prepareColumns(){this.columns=[],this.columns.push({name:"ftp_type",label:this.$t("type"),field:"ftp_type",align:"left"}),this.columns.push({name:"server_url",label:this.$t("server_url"),field:"server_url",align:"left"}),this.columns.push({name:"username",label:this.$t("username"),field:"username",align:"left"}),this.columns.push({name:"port",label:this.$t("port"),field:"port",align:"left"}),this.columns.push({name:"sub_org_id",label:this.$t("sub_organizations"),field:"sub_org_id",align:"left"}),this.columns.push({name:"default_directory",label:this.$t("default_directory"),field:"default_directory",align:"left"}),this.columns.push({name:"action",label:this.$t("action"),field:"action",align:"right"});const e=ao.A.getItem("FTP_IMPORT_SETTING_COLUMNS");this.columns=e&&""!=e?JSON.parse(e):this.columns},onDropColumns(){ao.A.set("FTP_IMPORT_SETTING_COLUMNS",JSON.stringify(this.columns))}},setup(){const e=(0,yt.cY)(),{subOrgList:t,sub_org_list_loading:o}=(0,kt.bP)(e);let s=(0,A.KR)({});const l=(0,A.KR)(null);return{sub_org_list_loading:o,subOrgList:t,myForm:l,import_email:s,show_connection_logs:(0,A.KR)(!1),connection_id:(0,A.KR)(""),errors:(0,A.KR)({}),sub_orgs_flattened:(0,A.KR)({}),processing:(0,A.KR)(!1),ms_url:(0,A.KR)("https://microsoft.com/devicelogin"),ms_code:(0,A.KR)(""),ms_authenticate:(0,A.KR)(!1),ms_is_authenticated:(0,A.KR)(!1),ms_message:(0,A.KR)("Microsoft o365 is authenticated already."),loading:(0,A.KR)(!1),userDialog:(0,A.KR)(!1),columns:(0,A.KR)([]),rows:(0,A.KR)([]),show_edit_create:(0,A.KR)(!1),selected_row:(0,A.KR)({}),api_key:(0,A.KR)("")}},data(){return{}}}),us=(0,I.A)(cs,[["render",Co]]),ms=us;P()(cs,"components",{QTable:jt.A,QTr:Jt.A,QTh:Bt.A,QTd:Gt.A,QBtn:Dt.A,QMenu:co.A,QList:uo.A,QItem:mo.A,QItemSection:po.A,QSeparator:_o.A,QTooltip:K.A,QInnerLoading:Tt.A,QDialog:ho.A});const ps=(0,s.pM)({el:"#app",components:{SubHeader:u.A,BackToSettings:m.A,PageRestriction:U,EmailImportList:fo,FtpImportList:ms},mounted:function(){this.getSubOrgsList()},setup(){const e=(0,yt.cY)(),{getSubOrgsList:t}=e;return{getSubOrgsList:t}}});var _s=o(88841),hs=o(93676);const gs=(0,I.A)(ps,[["render",c]]),fs=gs;P()(ps,"components",{QList:uo.A,QExpansionItem:_s.A,QSeparator:_o.A,QIcon:qt.A,QSpace:hs.A,QCard:Ct.A,QCardSection:St.A})}}]);