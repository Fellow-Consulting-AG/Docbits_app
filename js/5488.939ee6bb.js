"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[5488],{85488:(e,t,s)=>{s.r(t),s.d(t,{default:()=>it});var o=s(61758),i=s(58790);const a=e=>((0,o.Qi)("data-v-4c961097"),e=e(),(0,o.jt)(),e),r={class:"full-width sub-header mobile-only"},l={class:"row",style:{padding:"10px 12px"}},d={class:"left-side q-mr-auto ml-24"},n={class:"q-mr-auto"},c={class:"cursor-pointer text-caption"},h={key:0,class:"row highlighted-back q-pl-md q-pr-md q-pb-md"},u={key:1,class:"row approval-conatiner"},p={key:0,class:"col-xs-12 col-sm-12 col-md-3 col-lg-3 q-pl-sm",id:"left_section",style:{"padding-left":"38px"},ref:"left_section"},m={class:"row"},_={class:"full-width approval-comment-area",style:{position:"relative"}},g={key:0,class:"back-white secondary-c-text gray-border",style:{"border-radius":"5px","margin-right":"8px"}},v={class:"row"},f={class:"q-mr-auto q-ml-auto"},y={class:"text-h6 text-weight-bold"},w={class:"q-pr-sm full-width small-hide"},b={class:"row"},k={style:{position:"relative"}},L={class:"full-width q-pl-sm q-pr-sm"},F={class:"invisible absolute position-absolute"},C={class:"row"},A={class:"q-mr-auto"},x={class:"page-numbers"},I={class:"panel-middle mobile-hide"},S={class:"panel-right mobile-hide"},E={class:"doc-name"},q={class:"full-width full-height",id:"image_container",style:{position:"relative"}},M={class:"col-sm-12 col-md-4 col-lg-3 q-pl-sm"},R={class:"full-width q-ma-sm approval-area-height-right scrolle-y"},B={class:"full-width white-inputs"},$={class:"full-width full-height"},D={class:"row"},P={class:"secondary-c-text text-h6 text-weight-bold"},T={key:1,style:{"margin-left":"8px"}},O={key:0,class:"full-width"},z=a((()=>(0,o.Lk)("div",null,"Comment",-1))),K={class:"q-pt-none"},V={class:"footer-filename"},Q={class:"footer-status-message"},H={class:"cursor-pointer"},U={class:"footer-status-message"},X={key:1,class:"row"},W={class:"row q-ml-sm back-white custom-border",style:{width:"138px"}},N=["src"],j=["src"],J={class:"footer-status-message q-px-sm"};function G(e,t,s,a,G,Y){const Z=(0,o.g2)("SubHeader"),ee=(0,o.g2)("q-icon"),te=(0,o.g2)("BackToSettings"),se=(0,o.g2)("ErrorDocumentView"),oe=(0,o.g2)("DocumentLogs"),ie=(0,o.g2)("q-btn"),ae=(0,o.g2)("q-tooltip"),re=(0,o.g2)("AnnotationView"),le=(0,o.g2)("q-splitter"),de=(0,o.g2)("q-page-sticky"),ne=(0,o.g2)("q-space"),ce=(0,o.g2)("q-bar"),he=(0,o.g2)("q-card-section"),ue=(0,o.g2)("q-card"),pe=(0,o.g2)("q-dialog"),me=(0,o.g2)("Loader"),_e=(0,o.g2)("q-separator"),ge=(0,o.g2)("q-item-section"),ve=(0,o.g2)("q-item"),fe=(0,o.g2)("q-list"),ye=(0,o.g2)("q-menu"),we=(0,o.g2)("q-toolbar"),be=(0,o.g2)("q-footer"),ke=(0,o.gN)("close-popup");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bF)(Z,{name:"pending_approval",label:e.$t("pending_approval"),display_help_link:!1},null,8,["label"]),(0,o.Lk)("div",r,[(0,o.Lk)("div",l,[(0,o.Lk)("span",d,[(0,o.Lk)("div",n,[(0,o.Lk)("span",{class:"cursor-pointer text-uppercase",onClick:t[0]||(t[0]=(...t)=>e.routeToListPendingApproval&&e.routeToListPendingApproval(...t))},[(0,o.bF)(ee,{class:"cursor-pointer",onClick:e.nextImage,name:"chevron_left",size:"sm"},null,8,["onClick"]),(0,o.eW)(" "+(0,i.v_)(e.$t("pending_approval_list")),1)]),(0,o.Lk)("span",c," - "+(0,i.v_)(e.pending_approval_doc_count)+" "+(0,i.v_)(e.$t("invoices_for_release")),1)])])])]),(0,o.bF)(te,{back_to_rotue:"/dashboard",label:"dashboard"}),e.error?((0,o.uX)(),(0,o.CE)("div",h,[(0,o.bF)(se)])):((0,o.uX)(),(0,o.CE)("div",u,[e.showActivityPanel?((0,o.uX)(),(0,o.CE)("div",p,[(0,o.Lk)("div",m,[(0,o.Lk)("div",_,[e.isModelReady()?((0,o.uX)(),(0,o.CE)("div",g,[(0,o.Lk)("div",v,[(0,o.Lk)("div",f,[(0,o.Lk)("span",y,(0,i.v_)(e.$t("activity_stream")),1)])])])):(0,o.Q3)("",!0),(0,o.Lk)("div",w,[(0,o.bF)(oe,{docId:e.docId,list_data:e.doc_logs},null,8,["docId","list_data"])])])])],512)):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:(0,i.C4)(["q-pl-md",e.showActivityPanel?"col-xs-12 col-sm-12 col-md-9 col-lg-9":"full-width"]),style:{"padding-left":"48px"}},[(0,o.Lk)("div",b,[(0,o.Lk)("div",k,[(0,o.bF)(ie,{size:"sm",dense:"",round:"",unelevated:"",color:"primary",icon:e.showActivityPanel?"chevron_left":"chevron_right",class:"text-white chevron-left-icon",onClick:t[1]||(t[1]=t=>{e.showActivityPanel=!e.showActivityPanel,e.windowResize()})},null,8,["icon"])])]),(0,o.bF)(le,{modelValue:e.splitterModel,"onUpdate:modelValue":[t[3]||(t[3]=t=>e.splitterModel=t),t[4]||(t[4]=t=>e.windowResize())],class:"approval-content-area q-pl-sm"},{before:(0,o.k6)((()=>[(0,o.Lk)("div",L,[(0,o.Lk)("div",F,[(0,o.Lk)("div",C,[(0,o.Lk)("div",A,[(0,o.bF)(ee,{class:"up-arrow cursor-pointer",onClick:e.prevImage,name:"expand_less",size:"sm"},{default:(0,o.k6)((()=>[(0,o.bF)(ae,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(e.$t("previous")),1)])),_:1})])),_:1},8,["onClick"]),(0,o.bF)(ee,{class:"down-arrow cursor-pointer",onClick:e.nextImage,name:"expand_more",size:"sm"},{default:(0,o.k6)((()=>[(0,o.bF)(ae,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(e.$t("next")),1)])),_:1})])),_:1},8,["onClick"]),(0,o.Lk)("span",x,(0,i.v_)(e.currentPage())+"/"+(0,i.v_)(e.lastPage)+" "+(0,i.v_)(e.$t("page_number_text")),1)]),(0,o.Lk)("div",I,[(0,o.Lk)("span",null,[e.record.status==e.in_review?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.eW)((0,i.v_)(e.$t("in_review")),1)],64)):e.second_approval?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)((0,i.v_)(e.$t("second_approval")),1)],64)):((0,o.uX)(),(0,o.CE)(o.FK,{key:2},[(0,o.eW)((0,i.v_)(e.$t("first_approval")),1)],64))])]),(0,o.Lk)("div",S,[(0,o.Lk)("span",{class:"cursor-pointer q-mr-md text-uppercase",onClick:t[2]||(t[2]=(...t)=>e.downloadFile&&e.downloadFile(...t))},(0,i.v_)(e.$t("download")),1),(0,o.Lk)("span",E,(0,i.v_)(e.record.filename),1)])])]),((0,o.uX)(),(0,o.CE)("div",{class:"full-width",key:e.refreshAnnotationView},[(0,o.Lk)("div",q,[(0,o.bF)(re,{ref:"child_comp",enableEditing:e.enable_editing,cropUrl:e.image+"?"+e.tokenQueryParam,width:e.imageWidth,screenmode:e.screenmode,selectFont:e.selectFont,selectFontSize:e.selectFontSize,selectColor:e.selectColor},null,8,["enableEditing","cropUrl","width","screenmode","selectFont","selectFontSize","selectColor"])])]))])])),after:(0,o.k6)((()=>[(0,o.Lk)("div",M,[(0,o.Lk)("div",R,[(0,o.Lk)("div",B,[(0,o.Lk)("div",$,[(0,o.Lk)("div",D,[(0,o.Lk)("span",P,[e.record.status==e.in_review?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.eW)((0,i.v_)(e.$t("review_fields")),1)],64)):((0,o.uX)(),(0,o.CE)("div",T,(0,i.v_)(e.$t("auto_detect")),1))])]),e.isModelReady()?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[e.renderComponent?((0,o.uX)(),(0,o.CE)("div",O,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.formLayout,((t,s)=>((0,o.uX)(),(0,o.CE)(o.FK,{key:`div-${s}`},[t.is_hidden||void 0!=t.visibile&&!t.visibile?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",{key:0,class:"display-block field-padding",style:(0,i.Tr)("width:"+t.elementWidth+"%")},[((0,o.uX)(),(0,o.Wv)((0,o.$y)(t.fieldType),{currentField:t,isReadOnly:e.isReadOnly,fieldName:t.name,groupIndex:s,onInputClicked:e.htmlElementClick,onInputValueChanges:e.onInputValueChanges,onUpdateModel:e.updateModel},null,40,["currentField","isReadOnly","fieldName","groupIndex","onInputClicked","onInputValueChanges","onUpdateModel"]))],4))],64)))),128))])):(0,o.Q3)("",!0)],64)):(0,o.Q3)("",!0)])])])])])),_:1},8,["modelValue"])],2),(0,o.bF)(de,{position:"bottom-right",offset:[8,8],class:"hidden small-only"},{default:(0,o.k6)((()=>[(0,o.bF)(ie,{fab:"",icon:"chat",color:"primary",padding:"sm",onClick:t[5]||(t[5]=t=>e.chatWindow=!0)})])),_:1})])),(0,o.bF)(pe,{modelValue:e.chatWindow,"onUpdate:modelValue":t[6]||(t[6]=t=>e.chatWindow=t),position:"bottom"},{default:(0,o.k6)((()=>[(0,o.bF)(ue,{class:"full-width"},{default:(0,o.k6)((()=>[(0,o.bF)(ce,{class:"bg-primary text-white"},{default:(0,o.k6)((()=>[z,(0,o.bF)(ne),(0,o.bo)((0,o.bF)(ie,{dense:"",flat:"",icon:"close"},null,512),[[ke]])])),_:1}),(0,o.bF)(he,null,{default:(0,o.k6)((()=>[(0,o.Lk)("div",K,[(0,o.bF)(oe,{docId:e.docId,list_data:e.doc_logs},null,8,["docId","list_data"])])])),_:1}),(0,o.bF)(he,{class:"q-pt-none"})])),_:1})])),_:1},8,["modelValue"]),(0,o.bF)(me),(0,o.bF)(be,{class:"validation-status-bar back-white"},{default:(0,o.k6)((()=>[(0,o.bF)(we,{class:"row justify-start opened-right-padding"},{default:(0,o.k6)((()=>[(0,o.Lk)("span",V,(0,i.v_)(e.record.filename),1),(0,o.bF)(ie,{size:"md",flat:"",dense:"",class:"q-ml-xs",onClick:e.downloadFile},{default:(0,o.k6)((()=>[(0,o.bF)(ee,{name:"download",style:{color:"#8a8a8a"}})])),_:1},8,["onClick"]),(0,o.bF)(_e,{vertical:"",class:"q-mx-md"}),(0,o.Lk)("span",Q,[e.second_approval?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.eW)((0,i.v_)(e.$t("second_approval")),1)],64)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)((0,i.v_)(e.$t("first_approval")),1)],64))]),(0,o.bF)(_e,{vertical:"",class:"q-mx-md"}),(0,o.Lk)("span",H,(0,i.v_)(e.pending_approval_doc_count)+" "+(0,i.v_)(e.$t("invoices_for_release")),1),(0,o.bF)(_e,{vertical:"",class:"q-mx-md"}),(0,o.bF)(ne),e.record.table_blocked?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.bF)(_e,{vertical:"",class:"q-mx-md"}),(0,o.bF)(ee,{class:"text-blue",style:{"font-size":"22px"},name:"info"}),(0,o.Lk)("span",U,(0,i.v_)(e.$t("block_supplier_warning")),1)],64)):(0,o.Q3)("",!0),(0,o.bF)(ie,{dense:"",class:"q-mr-sm custom-border back-white",flat:"",size:"12px",onClick:t[7]||(t[7]=t=>{e.showStampMenu=!0,e.showFontMenu=!1,e.screenmode="stamp"})},{default:(0,o.k6)((()=>[(0,o.bF)(ee,{name:"img:annotation/stamp_icon.svg",class:"icon-grey-svg"}),(0,o.bF)(ae,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(e.$t("annotation.stamp_annotation")),1)])),_:1})])),_:1}),(0,o.bF)(ie,{size:"12px",dense:"",flat:"",class:"q-mr-sm custom-border back-white",onClick:t[8]||(t[8]=t=>{e.showFontMenu=!0,e.showStampMenu=!1,e.screenmode="annotate"})},{default:(0,o.k6)((()=>[(0,o.bF)(ee,{name:"text_format",class:"icon-grey"}),(0,o.bF)(ae,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(e.$t("annotation.text_annotation")),1)])),_:1})])),_:1}),(0,o.Lk)("div",null,[(0,o.bF)(ie,{size:"12px",flat:"",class:"back-white custom-border q-mr-sm",dense:"",onClick:t[9]||(t[9]=t=>{e.selectColor="#000000",this.$refs.child_comp.createAnnotationFromColorShortcut(e.selectColor)})},{default:(0,o.k6)((()=>[(0,o.bF)(ee,{color:"black",name:"title"})])),_:1}),(0,o.bF)(ie,{flat:"",size:"12px",class:"back-white custom-border q-mr-sm",dense:"",onClick:t[10]||(t[10]=t=>{e.selectColor="#f44336",this.$refs.child_comp.createAnnotationFromColorShortcut(e.selectColor)})},{default:(0,o.k6)((()=>[(0,o.bF)(ee,{color:"red",name:"title"})])),_:1}),(0,o.bF)(ie,{flat:"",size:"12px",class:"back-white custom-border q-mr-sm",dense:"",onClick:t[11]||(t[11]=t=>{e.selectColor="#4caf50",this.$refs.child_comp.createAnnotationFromColorShortcut(e.selectColor)})},{default:(0,o.k6)((()=>[(0,o.bF)(ee,{color:"green",name:"title"})])),_:1}),(0,o.bF)(ie,{flat:"",size:"12px",class:"back-white custom-border q-mr-sm",dense:"",onClick:t[12]||(t[12]=t=>{e.selectColor="#2196f3",this.$refs.child_comp.createAnnotationFromColorShortcut(e.selectColor)})},{default:(0,o.k6)((()=>[(0,o.bF)(ee,{color:"blue",name:"title"})])),_:1}),(0,o.bF)(ie,{flat:"",size:"12px",class:"back-white custom-border q-mr-sm",dense:"",onClick:t[13]||(t[13]=t=>{e.selectColor="#ffeb3b",this.$refs.child_comp.createAnnotationFromColorShortcut(e.selectColor)})},{default:(0,o.k6)((()=>[(0,o.bF)(ee,{color:"yellow",name:"title"})])),_:1})]),e.showStampMenu?((0,o.uX)(),(0,o.CE)("div",X,[(0,o.Lk)("div",W,[(0,o.Lk)("img",{class:"q-px-sm",src:e.stamp_dir+e.selectedStamp+e.stamp_ext,style:{width:"100px"}},null,8,N),(0,o.bF)(ie,{dense:"",flat:""},{default:(0,o.k6)((()=>[(0,o.bF)(ee,{name:"expand_more",class:"icon-grey"}),(0,o.bF)(ye,null,{default:(0,o.k6)((()=>[(0,o.bF)(fe,{style:{"min-width":"80px"}},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.sortedStamps,(t=>(0,o.bo)(((0,o.uX)(),(0,o.Wv)(ve,{key:t,clickable:""},{default:(0,o.k6)((()=>[(0,o.bF)(ge,{onClick:s=>e.selectedStamp=t},{default:(0,o.k6)((()=>[(0,o.Lk)("img",{width:"80",src:e.stamp_dir+t+e.stamp_ext},null,8,j)])),_:2},1032,["onClick"])])),_:2},1024)),[[ke]]))),128))])),_:1})])),_:1})])),_:1})]),(0,o.bF)(ie,{label:e.$t("doc2light.pages.add"),class:"q-ml-sm",color:"primary",unelevated:"",onClick:t[14]||(t[14]=t=>e.stampAddClicked())},null,8,["label"])])):(0,o.Q3)("",!0),(0,o.bF)(_e,{vertical:"",class:"q-mx-xs"}),(0,o.bF)(ie,{disable:1==e.page,icon:"keyboard_arrow_up",flat:"",class:"validation-view-page-button icon-grey",onClick:e.prevImage},null,8,["disable","onClick"]),(0,o.Lk)("span",J,(0,i.v_)(e.currentPage())+"/"+(0,i.v_)(e.lastPage),1),(0,o.bF)(ie,{disable:e.page==e.images.length,icon:"keyboard_arrow_down",flat:"",class:"validation-view-page-button icon-grey",onClick:e.nextImage},null,8,["disable","onClick"])])),_:1})])),_:1})],64)}var Y=s(82303),Z=s(1659),ee=s(24622),te=s(38734),se=s(68450),oe=s(46162),ie=s(96056),ae=s(8420),re=s(14907),le=s(45022),de=s(18505),ne=s(64775),ce=s(11470),he=s(61715),ue=s(91236),pe=s(12566),me=s(96075),_e=s(60894),ge=s(76956),ve=s(1133),fe=s(41162),ye=s(86366),we=s(6315),be=s(41902),ke=s(31986),Le=s(8325),Fe=s(73268),Ce=s(87709),Ae=s(8903),xe=s(94124),Ie=s(85487),Se=s(23537),Ee=function(e,t,s,o){function i(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,a){function r(e){try{d(o.next(e))}catch(t){a(t)}}function l(e){try{d(o["throw"](e))}catch(t){a(t)}}function d(e){e.done?s(e.value):i(e.value).then(r,l)}d((o=o.apply(e,t||[])).next())}))};const qe=document.querySelector.bind(document),Me=(0,o.pM)({el:"#app",mixins:[de.A,ee.A,ie.A],components:{Loader:ae.A,DocumentLogs:he.A,AnnotationView:we.A,ErrorDocumentView:pe.A,Label:ve.A,Button:fe.A,TextInput:be.A,BackToSettings:_e.A,HorizontalSeparator:ke.A,DocumentApprover:Le.A,SecondApprover:Ce.A,ExtractedTableTabPanels:Fe.A,SubHeader:ue.A},watch:{doc_status:{deep:!0,handler:function(){this.checkValidStatus()}}},data(){return{default_stamp:Ae.EO,stamp_ext:Ae.K_,stamps:Ae.dA,stamp_dir:Ae.Ul,docId:"",imageHeight:0,imageWidth:0,loading:!1,showArticlePage:!1,renderComponent:!1,chatWindow:(0,te.KR)(!1),enableExportButton:!1,in_review:ge.aH.in_review,allowedDoctypes:ge.Gk,filter_status:"validated_pending_approval",showActivityPanel:(0,te.KR)(!1),enable_editing:(0,te.KR)(!0),splitterModel:(0,te.KR)(50),refreshAnnotationView:(0,te.KR)(0),sortedStamps:[]}},beforeRouteLeave:function(e,t,s){this.restoreBeforeLeave(),s()},mounted:function(){let e=this.$route.params.id,t=le.A.getItem("selected_language");t&&(this.locale=t),this.selectedStamp=this.default_stamp,this.sortStampsByLanguage(),this.getDocAnnotations(e),window.addEventListener("resize",this.windowResize),document.body.addEventListener("click",this.mouseClicked,!0),window.rda=this,this.init(),document.addEventListener("new_log",this.addNewLog),document.addEventListener("keydown",this.keyDownEvent);for(let s=1;s<=80;s++)this.fontSizes.push(s.toString()+"pt")},unmounted:function(){window.removeEventListener("resize",this.windowResize),document.removeEventListener("new_log",this.addNewLog),document.removeEventListener("keydown",this.keyDownEvent)},methods:{init(){return Ee(this,void 0,void 0,(function*(){this.isSecondApproval(),this.$route.params.id||this.$router.push("/dashboard"),this.second_approval&&(this.filter_status=ge.aH.approved_pending_second_approval),this.docId=this.$route.params.id,yield this.getInvoiceDataByDocId(this.docId);let e=ge.L9.field_validation;this.record.status==ge.aH.validated_pending_approval?e=ge.L9.approval:this.record.status==ge.aH.in_review?(e=ge.L9.review,this.filter_status=ge.aH.in_review):this.record.status==ge.aH.approved_pending_second_approval&&(e=ge.L9.recond_approval,this.filter_status=ge.aH.approved_pending_second_approval),this.renderDocumentLog(),this.renderPendingRecordsCountView(),this.renderNextPrevLinkBtns(),yield this.getLayoutTemplateID(e),yield this.getFormBuilderLayout(),this.renderComponent=!0,ge.B2.includes(this.record.status)&&(this.isReadOnly=!0),this.handleImageBaseURL(),this.image=this.baseUrl+"/"+(0,me.v)(this.record.images[0].path),this.images=(0,me.m)(this.record.images),this.lastPage=this.images.length,this.windowResize()}))},sortStampsByLanguage(){let e=this.$i18n.locale,t=[];"en-us"==e&&(e="en"),this.stamps.forEach((s=>{"de"!=e&&"en"!=e&&(e="en"),s.includes(e)&&t.push(s)})),this.selectedStamp=t[0],this.sortedStamps=t},isSecondApproval(){this.second_approval=!1,this.$route.params.second_approval&&"true"===this.$route.params.second_approval&&(this.second_approval=!0)},getInvoiceDataByDocId(e){return Ee(this,void 0,void 0,(function*(){try{if(this.showLoading(),yield this.getDocumentById(e),!this.record.doc_id)return void this.showErrorToast(this.$t("pages.messages.INVALID_DOCUMENT"))}catch(t){return void this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},fillFirstApprover(){let e={};return e=this.record.hasOwnProperty("first_approver")?this.createEmptyField("first_approver","",this.record.first_approver):this.createEmptyField("assigned_to","",this.record.assigned_to),e},createEmptyField(e,t="",s=""){return"checkbox"==t&&(s=!1),{confidence:0,name:e,value:s,formatted_value:s,content:s}},getAssignToUsers(){return Ee(this,void 0,void 0,(function*(){yield this.dropdownStore.prepareUsersDropdown(),this.usersList=this.dropdownStore.usersList,this.formBuilderModel["assigned_to"]=this.getUserFullName(this.record.assigned_to),this.setPreviousApprover()}))},setPreviousApprover(){this.second_approval&&this.record.first_approver&&(this.formBuilderModel["first_approver"]=this.getUserFullName(this.record.first_approver))},filterUserList(e,t,s){try{if(""===e)return void t((()=>{this.usersList=this.dropdownStore.usersList}));t((()=>{const t=e.toLowerCase();this.usersList=this.dropdownStore.usersList.filter((e=>e.label.toLowerCase().indexOf(t)>-1))}))}catch(o){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),s()}},getUserFullName(e){let t=this.dropdownStore.usersList.filter((t=>t.value==e));return t[0].label},isModelReady(){return 0!==(0,se.Ns)(this.formBuilderConfigModel)},goHelp(){window.open("https://docs.cloudintegration.eu/")},keyDownEvent(e){"d"===e.key&&e.ctrlKey&&(this.showActivityPanel=!this.showActivityPanel)},htmlElementClick(e){this.formBuilderConfigModel[e].fieldType!==ye.VV.BUTTON||this.handleButtons(e)},handleButtons(e){this.formBuilderConfigModel[e].type!=ge.aH.reject?this.formBuilderConfigModel[e].type!=ge.aH.save?this.formBuilderConfigModel[e].type!=ge.aH.request_release?this.formBuilderConfigModel[e].type!=ge.aH.in_review?this.formBuilderConfigModel[e].type!=ge.aH.restart_workflow||this.goToFieldValidation():this.setInReview():this.acceptRequest():this.saveData():this.rejectRequest()},onInputValueChanges(e,t){this.updateLocalModel(e),this.updateImportJson(e)},updateLocalModel(e){this.formBuilderModel.hasOwnProperty(e)&&(this.formBuilderModel[e].value=this.formBuilderModel[e].formatted_value)},updateImportJson(e,t,s,o=""){try{const i=this.record.fields.find((t=>t.name===e));if(!i){this.record.fields.push({});const i=this.record.fields.length-1;return this.record.fields[i].name=e,this.record.fields[i].content=this.formBuilderModel[e].content,this.record.fields[i].formatted_value=this.formBuilderModel[e].formatted_value,this.record.fields[i].value=this.formBuilderModel[e].value,this.record.fields[i].original_value="",this.record.fields[i].validation_code="",this.record.fields[i].extraction_method=o,this.record.fields[i].is_validated=!0,this.record.fields[i].is_valid=!0,this.record.fields[i].color=ge.aH.success_border_left,!0===this.formBuilderModel[this.connectionId].multi_line?this.record.fields[i].multi_line=!0:this.record.fields[i].multi_line=!1,t&&(this.record.fields[i].coords=t),s&&(this.record.fields[i].page=s),void this.$emit("checkFieldInvalid",this.record.fields[i])}i.hasOwnProperty("original")||(i["original"]=Object.assign({},i)),i.hasOwnProperty("original_value")||(i["original_value"]=i.value),(t||null===t)&&(i.coords=t),s&&(i.page=s),o&&(i.extraction_method=o),i.is_valid=!0,i.is_validated=!0;let a=this.formBuilderModel[e];i.formatted_value=a.formatted_value,i.value=a.value?a.value:a.formatted_value,i.content=a.content,a.hasOwnProperty("api_save")&&a.api_save||(i.value=a.formatted_value),((0,se.z)(i.formatted_value)||(0,se.jw)(i.formatted_value))&&(i.content=i.formatted_value),this.formBuilderModel[this.connectionId]&&this.formBuilderModel[this.connectionId].hasOwnProperty("multi_line")&&!0===this.formBuilderModel[this.connectionId].multi_line?i.multi_line=!0:i.multi_line=!1,this.formBuilderModel[e].is_valid=i.is_valid,this.formBuilderModel[e].is_validated=i.is_validated,this.$emit("checkFieldInvalid",i)}catch(i){}},setApiData(e){this.record=e,this.$forceUpdate()},windowResize(){setTimeout((()=>{let e=qe("#image_container");this.imageWidth=e.offsetWidth,this.imageHeight=e.offsetHeight,this.refreshAnnotationView++}),20)},currentPage(){return this.page},prevImage(){let e=this.page-1,t=this.getImagePath(e);this.updateImage(e,t)},nextImage(){let e=this.page+1,t=this.getImagePath(e);this.updateImage(e,t)},getImagePath(e){let t="";for(const[s,o]of Object.entries(this.images)){let s=o;s.pageNumber===e&&(t=s.path)}return t},updateImage(e,t){t&&""!==t&&(this.image=this.baseUrl+"/"+(0,me.v)(t),this.page=e)},handleImageBaseURL(){this.record.images[0]&&this.record.images[0].path.match(/doc2/g)&&(this.baseUrl=oe.VA)},updateApiData(e){e.detail&&(this.record=e.detail)},saveData(){return Ee(this,void 0,void 0,(function*(){try{if(this.isReadOnly)return;if(!this.validateData())return;this.showLoading();const e=yield this.saveDocument(this.docId);if(!1===e.success)return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void this.showErrorToast(e.message);this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),this.assign_user_error=!1}catch(e){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},validateData(){let e=!0;return(0,se.z)(this.record.assigned_to)&&(this.assign_user_error=!0,e=!1),e},setInReview(){return Ee(this,void 0,void 0,(function*(){try{if(this.isReadOnly)return;this.showLoading(),yield this.saveData(),yield this.setDocumnetStatus(ge.aH.in_review),this.$router.push("/dashboard")}catch(e){const t=ne.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.hideLoading()}}))},setDocumnetStatus(e){return Ee(this,void 0,void 0,(function*(){try{const t=yield ce.M8.set_document_status(this.docId,{status:e});if(!1===t.success)throw{message:t.message};this.showSuccessToast(this.$t("pages.messages.MSG_SAVE"))}catch(t){const e=ne.t.getErrorMessage(t);this.showErrorToast(e)}}))},goToFieldValidation(){return Ee(this,void 0,void 0,(function*(){try{if(this.isReadOnly)return;this.showLoading(),yield this.saveData(),yield this.setDocumnetStatus(ge.aH.ready_for_validation),this.$router.push("/field_validation_v1/"+this.docId)}catch(e){const t=ne.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.hideLoading()}}))},acceptRequest(){let e=this.images.length,t=this.getImagePath(e);if(this.updateImage(e,t),this.page===this.images.length){let e="de"===this.locale?"approved_stamp_de":"approved_stamp_en";this.$refs.child_comp.addStampAnnotation(e)}this.record.first_approver=this.record.assigned_to,this.updateRequest("approve")},rejectRequest(){this.second_approval||delete this.record.first_approver,this.updateRequest("reject")},updateRequest(e){return Ee(this,void 0,void 0,(function*(){try{if(this.isReadOnly)return;if(!this.validateData())return;this.showLoading();const t={request_type:e},s=yield this.approveOrRejectDocument(this.docId,t);if(!1===s.success)return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void this.showErrorToast(s.message);this.showSuccessToast(this.$t("pages.messages.MSG_SAVE"));(0,xe.Bu)().user_settings;"approved_pending_second_approval"==this.doc_status&&this.dashboardFiltersAfterExport(),this.$router.push("/dashboard")}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},addNewLog(e){e&&e.detail&&this.renderDocumentLog()},renderDocumentLog(){return Ee(this,void 0,void 0,(function*(){try{yield this.getDocumentLogs()}catch(e){}finally{this.hideLoading()}}))},getDocumentLogs(){return Ee(this,void 0,void 0,(function*(){let e;this.doc_logs={};let t=new FormData;t.append("action_type","message"),t.append("org_id",(0,Ie.I)());let s=yield(0,oe.L3)();if(e=yield Y.A.post(oe.FH.get_document_log+this.docId,t,{headers:{Authorization:s}}),!e.data)throw{message:"no logs from server"};e.data.forEach((e=>{this.doc_logs[e.id.toString()+"_ID"]=e}))}))},downloadFile(){try{let e=oe.VA+"/resource/document/"+this.docId+"/"+this.docId+".pdf?"+this.tokenQueryParam;if(!e)return;fetch(e).then((e=>e.blob())).then((e=>{const t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=this.record.filename,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)})).catch((e=>{}))}catch(e){}},routeToListPendingApproval(){this.removeDashboardFilters(),this.$router.push("/dashboard")},renderPendingRecordsCountView(){return Ee(this,void 0,void 0,(function*(){try{let e,t="?filter=current-year&skip=0&limit=100&status="+this.filter_status,s=yield(0,oe.L3)();if(e=yield Y.A.get((0,Ie.MV)(oe.FH.get_dashboard_data+t),{headers:{Authorization:s}}),!e.data.documents)throw{message:"no pending documents from server"};this.pending_approval_doc_count=e.data.documents.length,this.pending_approval_doc_count<0&&(this.pending_approval_doc_count=0)}catch(e){}finally{this.hideLoading()}}))},renderNextPrevLinkBtns(){return Ee(this,void 0,void 0,(function*(){try{let e,t=yield(0,oe.L3)();if(e=yield Y.A.get((0,Ie.MV)(oe.FH.get_next_document+this.docId+"?doc_type="+this.record.doc_type+"&status="+this.filter_status+"&sort_attr=created_on"),{headers:{Authorization:t}}),!1===e.data.success)throw{message:"cannot get response related to next or prev record"};e.data.has_next&&e.data.next_id&&(this.next_record=e.data.next_id),e.data.has_previous&&e.data.previous_id&&(this.prev_record=e.data.previous_id)}catch(e){}finally{this.hideLoading()}}))},checkValidStatus(){(0,se.jw)(this.doc_status)||this.doc_status!==this.filter_status&&this.doc_status!==ge.aH.in_review&&this.doc_status!==ge.aH.approved_pending_second_approval&&(this.error=!0,this.error_message="invalid_status")},routeTo(e){let t="ready-for-approval";this.second_approval&&(t="ready-for-second-approval"),"prev"===e&&this.prev_record&&this.$router.push({path:"/"+t+"/"+this.prev_record,replace:!0}),"next"===e&&this.next_record&&this.$router.push("/"+t+"/"+this.next_record)},updateValue(e,t){"font"==e?this.selectFont=t:"color"==e?this.selectColor=t:"size"==e&&(this.selectFontSize=t)},stampAddClicked(){this.$refs.child_comp.addTemplateAnnotation(this.selectedStamp)},makeModel(){return new Promise(((e,t)=>{let s={};if(void 0!==this.record){this.record.fields.forEach(((e,t)=>{s[e.name]=e})),s["first_approver"]=this.fillFirstApprover(),s["assigned_to"]=this.createEmptyField("assigned_to","",this.record.assigned_to);let e=this.getUpdatedFieldSettings();for(let[t,o]of this.formLayout.entries()){let t=o.hasOwnProperty("field_name")?o.field_name:o.name;e.hasOwnProperty(t)&&(o=Object.assign(o,this.cleanLayoutSettings(e[t]))),this.prepareModel(o,s[t],t)}this.$forceUpdate()}e("done")}))},prepareModel(e,t,s){t||(t=this.createEmptyField(s,e.input_type));let o=e.input_type?e.input_type:e.fieldType;o&&(e.hasOwnProperty("tabIndex")&&!(0,se.z)(e.tabIndex)||(e.tabIndex=0),this.formBuilderModel[s]={},this.formBuilderConfigModel[s]={},this.formBuilderModel[s]=Object.assign({},t),this.formBuilderConfigModel[s]=Object.assign({},e),t.hasOwnProperty("is_required")&&(this.formBuilderConfigModel[s].is_required=t.is_required),"first_approver"==s&&this.second_approval&&(this.formBuilderConfigModel[s].translation_key="first_approver"))},cleanLayoutSettings(e){return delete e.name,delete e.field,delete e.field_name,delete e.field_type,delete e.title,delete e.translation_key,delete e.is_readonly,e},getFormBuilderLayout(){return Ee(this,void 0,void 0,(function*(){let e;this.formLayout=[];try{if(!this.layout_template_id)return;e=yield ce.H7.getDocumentLayoutTemplateById(this.layout_template_id);let t=JSON.parse(e.layout_json);t&&(this.formLayout=t.hasOwnProperty("layout")?t.layout:[],this.formLayout&&(yield this.makeModel()))}catch(t){return void this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}}))},getUpdatedFieldSettings(){let e={},t=JSON.parse(JSON.stringify(this.record.layout.groups));return t.forEach(((t,s)=>{t.rows.forEach(((t,s)=>{t.forEach(((t,s)=>{let o=t.field_name;e[o]=t}))}))})),e},updateModel(e){},restoreBeforeLeave(){this.record={},this.error=!1,this.error_message="",this.doc_status="",this.page=1}},setup(){const e=(0,re.A)();let t=[];const s=(0,xe.cY)();let{locale:o}=(0,Se.s9)({useScope:"global"});const i=(0,xe.q3)(),{approveOrRejectDocument:a,getDocumentById:r,getDocAnnotations:l,saveDocument:d,getLayoutTemplateID:n}=i,{record:c,doc_status:h,error:u,error_message:p,page:m,layout_template_id:_}=(0,Z.bP)(i),g=(0,xe.fX)(),{removeSavedFilters:v,saveFilters:f,dashboardFiltersAfterExport:y}=g,w=(0,xe._6)(),{tokenQueryParam:b}=(0,Z.bP)(w);w.getTokenQueryParam();const k=(0,xe.uL)(),{second_approval:L,formBuilderModel:F,formLayout:C,formBuilderConfigModel:A}=(0,Z.bP)(k),x=(0,xe.wt)(),{model:I}=(0,Z.bP)(x);return{locale:(0,te.KR)(o),model:I,approval_stamp:ge.Y_,approveOrRejectDocument:a,saveDocument:d,getLayoutTemplateID:n,savedDashboardFilters:f,removeDashboardFilters:v,dashboardFiltersAfterExport:y,tokenQueryParam:b,doc_status:h,page:m,error:u,error_message:p,getDocumentById:r,record:c,dropdownStore:s,image:"",images:t,lastPage:(0,te.KR)(0),baseUrl:oe.VA,isReadOnly:!1,usersList:(0,te.KR)([]),assign_user_error:(0,te.KR)(!1),doc_logs:(0,te.KR)({}),pending_approval_doc_count:(0,te.KR)(0),next_record:(0,te.KR)(""),prev_record:(0,te.KR)(""),second_approval:L,showNotification(t){e.notify({message:t,color:"primary",position:"top"})},getDocAnnotations:l,showFontMenu:(0,te.KR)(!0),showStampMenu:(0,te.KR)(!1),selectColor:(0,te.KR)("#000000"),selectFont:(0,te.KR)("Helvetica"),fontlist:["Helvetica","Times New Roman","Arimo","Caladea","Carlito","Cousine","Liberation Serif","Arial"],selectFontSize:(0,te.KR)(20),fontSizes:[],showDoc:(0,te.KR)(!1),selectedStamp:(0,te.KR)(""),screenmode:(0,te.KR)("annotate"),formLayout:C,formBuilderModel:F,formBuilderConfigModel:A,layout_template_id:_}}});var Re=s(12807),Be=s(50492),$e=s(56384),De=s(98072),Pe=s(97410),Te=s(13718),Oe=s(82156),ze=s(23316),Ke=s(18670),Ve=s(93676),Qe=s(44189),He=s(57092),Ue=s(36914),Xe=s(10386),We=s(84436),Ne=s(53999),je=s(90124),Je=s(25173),Ge=s(1444),Ye=s(67156),Ze=s(42315),et=s(88672),tt=s(98582),st=s.n(tt);const ot=(0,Re.A)(Me,[["render",G],["__scopeId","data-v-4c961097"]]),it=ot;st()(Me,"components",{QIcon:Be.A,QBtn:$e.A,QSplitter:De.A,QTooltip:Pe.A,QPageSticky:Te.A,QDialog:Oe.A,QCard:ze.A,QBar:Ke.A,QSpace:Ve.A,QCardSection:Qe.A,QFooter:He.A,QToolbar:Ue.A,QSeparator:Xe.A,QMenu:We.A,QList:Ne.A,QItem:je.A,QItemSection:Je.A,QSlider:Ge.A,QField:Ye.A,QTable:Ze.A}),st()(Me,"directives",{ClosePopup:et.A})}}]);