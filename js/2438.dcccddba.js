"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[2438],{22438:(e,t,o)=>{o.r(t),o.d(t,{default:()=>xe});var s=o(61758),r=o(58790),i=o(29104);const a={class:"col-6 pl-20",style:{"margin-top":"10px","margin-bottom":"-5vh"}},l={style:{"vertical-align":"middle","margin-left":"10px","font-size":"20px",cursor:"pointer"}},n={class:"row"},d={key:1},c={class:"text-subtitle2 row",style:{"margin-bottom":"20px","margin-top":"5px"}},u={key:0,class:"col-5"},w={key:0},g={class:"card-category-text"},h={key:0,class:"row"},f={class:"col-11"},_={key:0,class:"col-1"},p={key:1,class:"col-1"},k={class:"card-category-text"},m={class:"col-11"},v={key:0,class:"col-1"},y={key:1,class:"col-1"},b={class:"card-category-text"},C={class:"col-11"},F={key:0,class:"col-1"},L={key:1,class:"col-1"},x={key:1},X={class:"small-heading"},E={class:"card-category-text"},A={key:0,class:"row"},K={class:"col-11"},S={class:"card-category-text"},W={class:"col-11"},D={class:"card-category-text"},R={class:"col-11"},T={class:"col-7"},$={class:"small-heading"},z={key:0},j={key:1},q={key:0},I={class:"col-10"},Q={key:1};function P(e,t,o,P,O,V){const G=(0,s.g2)("SubHeader"),B=(0,s.g2)("q-icon"),M=(0,s.g2)("q-btn"),U=(0,s.g2)("q-pagination"),H=(0,s.g2)("q-th"),N=(0,s.g2)("q-tr"),Y=(0,s.g2)("q-td"),J=(0,s.g2)("GenericCard"),Z=(0,s.g2)("q-table"),ee=(0,s.g2)("Loader");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(G,{name:"workflow_logs",label:e.$t("workflow_logs")},null,8,["label"]),(0,s.Lk)("div",a,[(0,s.bF)(M,{flat:"",rounded:"",color:"primary",to:"/dashboard"},{default:(0,s.k6)((()=>[(0,s.bF)(B,{name:"fa-solid fa-circle-arrow-left",size:"sm"}),(0,s.Lk)("label",l,(0,r.v_)(e.$t("dashboard")),1)])),_:1})]),(0,s.Lk)("div",n,[(0,s.bF)(Z,{flat:"",bordered:"",title:e.$t("workflow_logs"),rows:this.rows,columns:e.columns,style:{width:"95%",margin:"3%","max-height":"85vh","max-width":"95%"},"rows-per-page-options":[e.page_size],separator:"cell","wrap-cells":""},{pagination:(0,s.k6)((()=>[e.total_pages>1?((0,s.uX)(),(0,s.Wv)(U,{key:0,modelValue:e.current_page,"onUpdate:modelValue":t[0]||(t[0]=t=>e.current_page=t),max:e.total_pages,"max-pages":7,"direction-links":"",unelevated:"","active-color":"primary",class:"doc2-pagination q-mb-md q-ml-auto q-mr-auto",onClick:t[1]||(t[1]=t=>e.nextPageClicked())},null,8,["modelValue","max"])):(0,s.Q3)("",!0)])),header:(0,s.k6)((t=>[(0,s.bF)(N,{props:t},{default:(0,s.k6)((()=>[(0,s.bF)(H,{"auto-width":""}),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.cols,(o=>((0,s.uX)(),(0,s.Wv)(H,{key:o.name,props:t},{default:(0,s.k6)((()=>[(0,s.eW)((0,r.v_)(e.$t(o.label)),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,s.k6)((t=>[(0,s.bF)(N,{props:t},{default:(0,s.k6)((()=>[(0,s.bF)(Y,{"auto-width":""},{default:(0,s.k6)((()=>[(0,s.bF)(M,{size:"sm",color:"primary",round:"",dense:"",onClick:e=>t.expand=!t.expand,icon:t.expand?"keyboard_arrow_up":"keyboard_arrow_down"},null,8,["onClick","icon"])])),_:2},1024),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.cols,(e=>((0,s.uX)(),(0,s.Wv)(Y,{key:e.name,props:t},{default:(0,s.k6)((()=>["result"===e.name?((0,s.uX)(),(0,s.Wv)(Y,{key:0,style:{display:"flex","align-items":"center","justify-content":"center"}},{default:(0,s.k6)((()=>["success"===t.row[e.name]?((0,s.uX)(),(0,s.Wv)(B,{key:0,name:"check_circle",color:"green",size:"sm"})):null===t.row[e.name]||"failed_condition"===t.row[e.name]?((0,s.uX)(),(0,s.Wv)(B,{key:1,name:"do_not_disturb_on",color:"orange",size:"sm"})):((0,s.uX)(),(0,s.Wv)(B,{key:2,name:"cancel",color:"red",size:"sm"}))])),_:2},1024)):((0,s.uX)(),(0,s.CE)("div",d,(0,r.v_)(e.value),1))])),_:2},1032,["props"])))),128))])),_:2},1032,["props"]),(0,s.bo)((0,s.bF)(N,{props:t},{default:(0,s.k6)((()=>[(0,s.bF)(Y,{colspan:"100%"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",c,[Object.keys(this.workflows).includes(t.row.workflow_id)?((0,s.uX)(),(0,s.CE)("div",u,[this.workflowChanged(t.row.id)?((0,s.uX)(),(0,s.CE)("div",x,[(0,s.Lk)("div",X,(0,r.v_)(e.$t("workflow_changed")),1),(0,s.Lk)("div",null,[(0,s.Lk)("div",E,(0,r.v_)(e.$t("wf_when")),1)]),Object.keys(this.workflows).includes(t.row.workflow_id)?((0,s.uX)(),(0,s.CE)("div",A,[(0,s.Lk)("div",K,[(0,s.bF)(J,{item:this.workflows[t.row.workflow_id].data.when_condition,version:this.workflows[t.row.workflow_id].data.when_condition.version,onClick:e=>this.getCardLogs(this.workflows[t.row.workflow_id].data.when_condition.id,t.row.id,0,"when")},null,8,["item","version","onClick"])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",null,[(0,s.Lk)("div",S,(0,r.v_)(e.$t("wf_and")),1)]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(this.workflows[t.row.workflow_id].data.and_conditions,((e,o)=>((0,s.uX)(),(0,s.CE)("div",{class:"row",key:e.id+"_"+e.card_version+"_"+o},[(0,s.Lk)("div",W,[(0,s.bF)(J,{item:e,version:e.version,onClick:s=>this.getCardLogs(e.id,t.row.id,o,"and")},null,8,["item","version","onClick"])])])))),128)),(0,s.Lk)("div",null,[(0,s.Lk)("div",D,(0,r.v_)(e.$t("wf_then")),1)]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(this.workflows[t.row.workflow_id].data.then_conditions,((e,o)=>((0,s.uX)(),(0,s.CE)("div",{class:"row",key:e.id+"_"+e.card_version+"_"+o},[(0,s.Lk)("div",R,[(0,s.bF)(J,{item:e,version:e.version,onClick:s=>this.getCardLogs(e.id,t.row.id,o,"then")},null,8,["item","version","onClick"])])])))),128))])):((0,s.uX)(),(0,s.CE)("div",w,[(0,s.Lk)("div",null,[(0,s.Lk)("div",g,(0,r.v_)(e.$t("wf_when")),1)]),Object.keys(this.workflows).includes(t.row.workflow_id)?((0,s.uX)(),(0,s.CE)("div",h,[(0,s.Lk)("div",f,[(0,s.bF)(J,{item:this.workflows[t.row.workflow_id].data.when_condition,version:this.workflows[t.row.workflow_id].data.when_condition.version,onClick:e=>this.getCardLogs(this.workflows[t.row.workflow_id].data.when_condition.id,t.row.id,0,"when")},null,8,["item","version","onClick"])]),"success"==t.row.logs[0][0].card_result?((0,s.uX)(),(0,s.CE)("div",_,[(0,s.bF)(B,{name:"check_circle",size:"22px",color:"green"})])):((0,s.uX)(),(0,s.CE)("div",p,[(0,s.bF)(B,{name:"cancel",size:"22px",color:"red"})]))])):(0,s.Q3)("",!0),(0,s.Lk)("div",null,[(0,s.Lk)("div",k,(0,r.v_)(e.$t("wf_and")),1)]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(this.workflows[t.row.workflow_id].data.and_conditions,((o,r)=>((0,s.uX)(),(0,s.CE)("div",{class:"row",key:o.id+"_"+o.card_version+"_"+r},[(0,s.Lk)("div",m,[(0,s.bF)(J,{item:o,version:o.version,onClick:e=>this.getCardLogs(o.id,t.row.id,r,"and")},null,8,["item","version","onClick"])]),e.checkCardSuccess(t.row.id,r,"and")?((0,s.uX)(),(0,s.CE)("div",v,[(0,s.bF)(B,{name:"check_circle",size:"22px",color:"green"})])):((0,s.uX)(),(0,s.CE)("div",y,[(0,s.bF)(B,{name:"cancel",size:"22px",color:"red"})]))])))),128)),(0,s.Lk)("div",null,[(0,s.Lk)("div",b,(0,r.v_)(e.$t("wf_then")),1)]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(this.workflows[t.row.workflow_id].data.then_conditions,((o,r)=>((0,s.uX)(),(0,s.CE)("div",{class:"row",key:o.id+"_"+o.card_version+"_"+r},[(0,s.Lk)("div",C,[(0,s.bF)(J,{item:o,version:o.version,onClick:e=>this.getCardLogs(o.id,t.row.id,r,"then")},null,8,["item","version","onClick"])]),e.checkCardSuccess(t.row.id,r,"then")?((0,s.uX)(),(0,s.CE)("div",F,[(0,s.bF)(B,{name:"check_circle",size:"22px",color:"green"})])):((0,s.uX)(),(0,s.CE)("div",L,[(0,s.bF)(B,{name:"cancel",size:"22px",color:"red"})]))])))),128))]))])):(0,s.Q3)("",!0),(0,s.Lk)("div",T,[(0,s.Lk)("div",$,[this.workflowChanged(t.row.id)?((0,s.uX)(),(0,s.CE)("div",j,(0,r.v_)(e.$t("workflow_logs")),1)):((0,s.uX)(),(0,s.CE)("div",z,(0,r.v_)(e.$t("card_logs")),1))]),Object.keys(this.displayed_messages).includes(t.row.id)?((0,s.uX)(),(0,s.CE)("div",q,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(this.displayed_messages[t.row.id],(e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"row",style:{"text-wrap":"wrap"}},[(0,s.Lk)("div",I,(0,r.v_)(e.message),1)])))),128))])):((0,s.uX)(),(0,s.CE)("div",Q,(0,r.v_)(e.$t("card_logs_message")),1))])])])),_:2},1024)])),_:2},1032,["props"]),[[i.aG,t.expand]])])),_:1},8,["title","rows","columns","rows-per-page-options"])]),(0,s.bF)(ee)],64)}var O=o(24622),V=o(38734);const G={class:"col-sm-12 col-md-12 col-lg-12"},B=["innerHTML"],M={class:"color-93939A paddingMargin0 font-size-0-75"},U={class:"paddingMargin0 font-size-15",style:{"text-wrap":"wrap"}};function H(e,t,o,i,a,l){const n=(0,s.g2)("q-btn"),d=(0,s.g2)("q-card-section"),c=(0,s.g2)("q-card");return(0,s.uX)(),(0,s.CE)("div",G,[(0,s.bF)(c,{class:"row",style:{"margin-bottom":"10px"}},{default:(0,s.k6)((()=>[(0,s.bF)(n,{class:"col-2 p-10",disable:"",round:"",flat:"",size:"xs",style:(0,r.Tr)("background-color:"+e.color)},{default:(0,s.k6)((()=>[(0,s.Lk)("i",{innerHTML:e.item.svg,class:"svg-icon center-inner"},null,8,B)])),_:1},8,["style"]),(0,s.bF)(d,{class:"col-10"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",M,(0,r.v_)(e.$t(e.item.category)),1),(0,s.Lk)("p",U,[!e.dataArray||e.dataArray.length<1?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,r.v_)(e.$t(e.item.text)),1)],64)):((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(e.dataArray,((t,o)=>((0,s.uX)(),(0,s.CE)(s.FK,{key:o},[e.renderBadge(t)?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,r.v_)(e.$t(e.getVariableData(t))),1)],64)):e.renderTextTranslation(t)?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.eW)((0,r.v_)(e.$t(t)),1)],64)):((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[(0,s.eW)((0,r.v_)(t+" "),1)],64))],64)))),128))])])),_:1})])),_:1})])}var N=o(96056),Y=o(18505),J=o(76956),Z=o(66715),ee=o(1659),te=o(11470),oe=function(e,t,o,s){function r(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,i){function a(e){try{n(s.next(e))}catch(t){i(t)}}function l(e){try{n(s["throw"](e))}catch(t){i(t)}}function n(e){e.done?o(e.value):r(e.value).then(a,l)}n((s=s.apply(e,t||[])).next())}))};const se=(0,ee.nY)("workflow_logs_variables_store",{state:()=>({users:[],groups:[],workflows:[]}),getters:{getStoredUsers:e=>e.users},actions:{getUsers(){return oe(this,void 0,void 0,(function*(){if(0==this.users.length){const e=yield te.jD.getUsers();e.forEach((e=>{this.users.push(e)}))}}))},getGroups(){return oe(this,void 0,void 0,(function*(){if(0==this.groups.length){const e=yield te.jD.getGroups();e.forEach((e=>{this.groups.push(e)}))}}))},getWorkflows(){return oe(this,void 0,void 0,(function*(){if(0==this.users.length){const e=yield te.Bj.getWorkflowsForOrg();e.forEach((e=>{this.workflows.push(e)}))}}))}}}),re=(0,s.pM)({name:"generic-card",emits:[],mixins:[O.A,N.A,Y.A],components:{},props:{isDialog:{type:Boolean,default:!1},itemIndex:{type:Number,default:null},cardType:{type:String,default:""},parentSvg:{type:String,default:""},color:{type:String,default:""},item:{type:Object,default:{category:"",id:"",text:"",toolTip:"",card_version:""}}},data(){return{showItemPanel:(0,V.KR)(!1),dataArray:(0,V.KR)([])}},mounted(){this.prepareDataForVariableReplacement(),this.prepareData()},methods:{renderBadge(e){return e.startsWith(J.XF)},renderTextTranslation(e){return e.startsWith(J.Q9)},getVariableData(e){if(this.item)for(let t of this.item.variables)if(t.id.split(J.XF).join("")==e.split(J.XF).join("")){if(["user","users","operator","math_operator","sub_org_id","groups","workflow","export_configuration","decision_table"].includes(t.display_name))switch(t.display_name){case"user":case"users":case"groups":case"operator":case"sub_org_id":return this.getVariableDataForID(t.display_name,"id",t.data);case"operator":case"math_operator":return Z.i18n.t(t.data);case"workflow":return this.getVariableDataForID(t.display_name,"entries.id",t.data)}return t.data}return""},getVariableDataForID(e,t,o){const s=Object.keys(this.data);if(s.includes(e)){let s=[];for(let r of o.split(","))for(let o of this.data[e])if(o[t]==r)switch(e){case"user":case"users":const e=o.first_name+" "+o.last_name;-1==s.indexOf(e)&&s.push(e);break;case"groups":case"workflows":s.push(o.name);break}return s.length>0?s.toString():o}return o},prepareDataForVariableReplacement(){this.data.users=this.users,this.data.user=this.users,this.data.groups=this.groups,this.data.workflows=this.workflows},prepareData(){try{if(this.item&&this.$t(this.item.text).includes(J.XF)){let e=this.$t(this.item.text).split(/(__%)/);for(let t=0;t<e.length;t++){let o="";e[t]&&(e[t]==J.XF?(o=e[t]+e[t+1]+e[t+2],t+=2):o=e[t],this.dataArray.push(o))}}}catch(e){}}},setup(){const e=se(),{users:t,groups:o,workflows:s}=(0,ee.bP)(e);return{users:t,groups:o,workflows:s,data:{}}}});var ie=o(12807),ae=o(23316),le=o(56384),ne=o(44189),de=o(98582),ce=o.n(de);const ue=(0,ie.A)(re,[["render",H],["__scopeId","data-v-8074309a"]]),we=ue;ce()(re,"components",{QCard:ae.A,QBtn:le.A,QCardSection:ne.A});var ge=o(8420),he=o(36246),fe=o(66693),_e=o(46736),pe=function(e,t,o,s){function r(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,i){function a(e){try{n(s.next(e))}catch(t){i(t)}}function l(e){try{n(s["throw"](e))}catch(t){i(t)}}function n(e){e.done?o(e.value):r(e.value).then(a,l)}n((s=s.apply(e,t||[])).next())}))};const ke=(0,s.pM)({name:"workflowLogs",mixins:[O.A,N.A,Y.A,_e.A],components:{Loader:ge.A,GenericCard:we,SubHeader:fe.A},data(){return{}},mounted(){return pe(this,void 0,void 0,(function*(){this.showLoading(),yield this.getLogsForDocument(),this.getUsers(),this.getGroups(),this.getWorkflows,this.prepareTableRows(),this.hideLoading(),window.vpo=this}))},methods:{formatDate(e,t){return he.Ay.formatDate(e,t)},prepareTableRows(){this.rows=this.logs;for(let e=0;e<this.rows.length;e++)this.rows[e].name=this.rows[e].workflow_name,this.rows[e].created_on=this.formatDateAccordingToPreference(this.rows[e].created_on),this.rows[e].run_time_seconds=(this.rows[e].run_time_mili_seconds/1e3).toFixed(2)},nextPageClicked(){return pe(this,void 0,void 0,(function*(){try{this.showLoading(),this.calculateOffset(),yield this.getLogsForDocument()}catch(e){this.showErrorToast(e),logError(e)}finally{this.hideLoading()}}))},resetPagination(){this.total_pages=0,this.current_page=1,this.total_records=0,this.offset=0},setTotalPages(){this.total_pages=Math.ceil(this.total_records/this.page_size)},calculateOffset(){this.offset=this.page_size*(this.current_page-1)},getLogsForDocument(){return pe(this,void 0,void 0,(function*(){let e={with_name:!0,include_workflows:!0};e["per_site"]=this.page_size,e["offset"]=this.offset,e["ignore_pagination"]=!1;let t=yield te.Bj.getWorkflowLogsForDoc(this.$route.params.id.toString(),e);this.logs=t.logs,this.complete_logs=t,this.total_records=t.total,this.setTotalPages();for(let o of t.logs)this.loadWorkflow(o.workflow_id),this.expanded[o.id]=!1;this.prepareTableRows()}))},loadWorkflow(e){if(!Object.keys(this.workflows).includes(e)){let t=this.complete_logs.workflows[e];this.workflows[e]=t,null==!t.last_modified_on?this.workflows[e].last_modified_on=this.formatDateAccordingToPreference(t.last_modified_on):this.workflows[e].last_modified_on=this.formatDateAccordingToPreference(t.created_on)}},getCardLogs(e,t,o,s){Object.keys(this.card_messages).includes(e.toString()+t.toString()+o+"_"+s)||this.prepareCardLogs(e,t,o,s),this.displayed_messages[t.toString()]=this.card_messages[e.toString()+t.toString()+o+"_"+s]},prepareCardLogs(e,t,o,s){const r=this.getWorkflowRunLog(t);if("when"==s)this.card_messages[e.toString()+t.toString()+o+"_"+s]=r[0];else if("and"==s){for(let i=1;i<r.length;i++)if(i==o+1){this.card_messages[e.toString()+t.toString()+o+"_"+s]=r[i];break}}else if("then"==s)for(let i=0;i<r.length;i++)if(r[i][0].run_category==s){this.card_messages[e.toString()+t.toString()+o+"_"+s]=r[i+o];break}},prepareCompleteLogs(e){const t=this.getWorkflowRunLog(e);let o=[];for(let s of t)for(let e of s)o.push(e);this.displayed_messages[e.toString()]=o},checkCardSuccess(e,t,o){const s=this.getWorkflowRunLog(e);try{if("when"==o)return"success"==s[0][0].card_result;if("and"==o)return t+=1,"success"==s[t][0].card_result;if("then"==o)for(let e=1;e<s.length;e++)if(s[e][0].run_category==o)return"success"==s[e+t][0].card_result}catch(r){logError(r)}},getWorkflowRunLog(e){let t="";for(let o of this.logs)o.id==e&&(t=o.logs);return t},workflowChanged(e){let t=!1;for(let o of this.logs)if(o.id==e)return t=o.created_on<this.workflows[o.workflow_id].last_modified_on,t&&this.prepareCompleteLogs(e),t;return t}},setup(){const e=[{name:"workflow_name",required:!0,label:"wf_name",align:"left",field:"workflow_name",headerClasses:"table-header-wf-logs",style:"width: 40%;",headerStyle:" width: 40%;"},{name:"created_on",required:!1,label:"doc2light.table.created_on",align:"left",field:"created_on",headerClasses:"table-header-wf-logs"},{name:"run_time_seconds",required:!1,label:"run_time_seconds",align:"right",field:"run_time_seconds",headerClasses:"table-header-wf-logs",headerStyle:"align-items: left; justify-content: left;"},{name:"result",required:!1,label:"result",align:"left",field:"result",style:" align-items: center; justify-content: center; width: 10%;",headerStyle:" width: 10%;",headerClasses:"table-header-wf-logs"}],t=se(),{getUsers:o,getGroups:s,getWorkflows:r}=t;return{logs:(0,V.KR)([]),expanded:(0,V.KR)({}),workflows:(0,V.KR)({}),complete_logs:(0,V.KR)({}),card_messages:(0,V.KR)({}),displayed_messages:(0,V.KR)({}),wf_logs:(0,V.KR)({}),columns:e,rows:(0,V.KR)([]),getUsers:o,getGroups:s,getWorkflows:r,current_page:(0,V.KR)(1),total_pages:(0,V.KR)(0),offset:(0,V.KR)(0),page_size:(0,V.KR)(10),total_records:(0,V.KR)(0)}}});var me=o(50492),ve=o(42315),ye=o(54700),be=o(44488),Ce=o(57722),Fe=o(45262);const Le=(0,ie.A)(ke,[["render",P],["__scopeId","data-v-43d62006"]]),xe=Le;ce()(ke,"components",{QBtn:le.A,QIcon:me.A,QTable:ve.A,QPagination:ye.A,QTr:be.A,QTh:Ce.A,QTd:Fe.A})}}]);