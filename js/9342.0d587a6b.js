"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[9342],{9342:(e,t,s)=>{s.r(t),s.d(t,{default:()=>lo});var o=s(83673),l=s(62323);const i={class:"container q-pa-xl settings"},a={style:{width:"100%"}},r={class:"q-pa-md"},n={style:{"margin-top":"3px"}},d={style:{"margin-top":"3px"}},c={style:{"margin-top":"3px"}};function u(e,t,s,u,m,p){const _=(0,o.up)("SubHeader"),h=(0,o.up)("BackToSettings"),g=(0,o.up)("q-separator"),w=(0,o.up)("q-icon"),f=(0,o.up)("q-space"),y=(0,o.up)("PageRestriction"),b=(0,o.up)("q-card-section"),v=(0,o.up)("q-card"),k=(0,o.up)("q-expansion-item"),E=(0,o.up)("FtpImportList"),q=(0,o.up)("EmailImportList"),C=(0,o.up)("q-list");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(_,{name:"import_settings",label:e.$t("Import")},null,8,["label"]),(0,o.Wm)(h),(0,o._)("div",i,[(0,o._)("div",a,[(0,o._)("div",r,[(0,o.Wm)(C,{bordered:"",class:"rounded-borders"},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{"expand-separator":"","header-class":"highlighted-back","default-opened":""},{header:(0,o.w5)((()=>[(0,o.Wm)(w,{size:"25px",class:"q-mr-lg black_to_white",name:"img:settings/doc.svg"}),(0,o._)("span",n,(0,l.zw)(e.$t("pages.import.email_import")),1),(0,o.Wm)(f)])),default:(0,o.w5)((()=>[(0,o.Wm)(g),(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y)])),_:1})])),_:1})])),_:1}),(0,o.Wm)(k,{"expand-separator":"","header-class":"highlighted-back","default-opened":""},{header:(0,o.w5)((()=>[(0,o.Wm)(w,{size:"25px",class:"q-mr-lg black_to_white",name:"img:settings/email-import.svg"}),(0,o._)("span",d,(0,l.zw)(e.$t("ftp_import")),1),(0,o.Wm)(f)])),default:(0,o.w5)((()=>[(0,o.Wm)(g),(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(E)])),_:1})])),_:1})])),_:1}),(0,o.Wm)(k,{"expand-separator":"","header-class":"highlighted-back","default-opened":""},{header:(0,o.w5)((()=>[(0,o.Wm)(w,{size:"25px",class:"q-mr-lg black_to_white",name:"img:settings/email-import.svg"}),(0,o._)("span",c,(0,l.zw)(e.$t("pages.settings.email_import")),1),(0,o.Wm)(f)])),default:(0,o.w5)((()=>[(0,o.Wm)(g),(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(q)])),_:1})])),_:1})])),_:1})])),_:1})])])])],64)}var m=s(13873),p=s(47845);const _={class:"import-container q-pa-xl"},h={class:"row"},g={style:{width:"30%",margin:"auto","padding-right":"5%"}},w={style:{width:"30%"}},f=(0,o.Uk)(" Ony process given number of pages every further page will be ignored. "),y=(0,o._)("div",{style:{width:"40%",margin:"auto","padding-left":"5%"}},null,-1),b={class:"row"},v={style:{width:"30%",margin:"auto","padding-right":"5%"}},k={style:{width:"30%"}},E=(0,o._)("div",{style:{width:"40%"}},null,-1),q={class:"row"},C={style:{width:"30%",margin:"auto","padding-right":"5%"}},O={style:{width:"30%"}},T=(0,o._)("div",{style:{width:"40%"}},null,-1);function S(e,t,s,i,a,r){const n=(0,o.up)("q-tooltip"),d=(0,o.up)("q-input"),c=(0,o.up)("q-select");return(0,o.wg)(),(0,o.iD)("div",_,[(0,o._)("div",h,[(0,o._)("div",g,(0,l.zw)(e.$t("restrict_to_pages")),1),(0,o._)("div",w,[(0,o.Wm)(d,{tabindex:"0",type:"number",class:(0,l.C_)("full-width "),modelValue:e.settings_model["RESTRICT_TO_PAGES"],"onUpdate:modelValue":[t[0]||(t[0]=t=>e.settings_model["RESTRICT_TO_PAGES"]=t),t[1]||(t[1]=t=>{e.saveSettings("RESTRICT_TO_PAGES",t)})]},{default:(0,o.w5)((()=>[(0,o.Wm)(n,null,{default:(0,o.w5)((()=>[f])),_:1})])),_:1},8,["modelValue"])]),y]),(0,o._)("div",b,[(0,o._)("div",v,(0,l.zw)(e.$t("payment_terms_days")),1),(0,o._)("div",k,[(0,o.Wm)(d,{tabindex:"0",type:"number",class:(0,l.C_)("full-width "),modelValue:e.settings_model["PAYMENT_TERMS_DAYS"],"onUpdate:modelValue":[t[2]||(t[2]=t=>e.settings_model["PAYMENT_TERMS_DAYS"]=t),t[3]||(t[3]=t=>{e.saveSettings("PAYMENT_TERMS_DAYS",t)})]},null,8,["modelValue"])]),E]),(0,o._)("div",q,[(0,o._)("div",C,(0,l.zw)(e.$t("date_pattern")),1),(0,o._)("div",O,[(0,o.Wm)(c,{modelValue:e.settings_model["DATE_PATTERN"],"onUpdate:modelValue":[t[4]||(t[4]=t=>e.settings_model["DATE_PATTERN"]=t),t[5]||(t[5]=t=>{e.saveSettings("DATE_PATTERN",t)})],options:[{label:e.$t("select"),value:""},{label:"%d/%m/%Y",value:"%d/%m/%Y"},{label:"%d.%m.%Y",value:"%d.%m.%Y"},{label:"%m %d, %Y",value:"%m %d, %Y"},{label:"%Y %m, %d",value:"%Y %m, %d"}],"emit-value":"","map-options":"",label:e.$t("date_pattern")},null,8,["modelValue","options","label"])]),T])])}var W=s(61959),x=s(45401),V=s(77378),L=s(30052),$=s.n(L),U=s(54268),I=s(28239),D=s(48825),R=function(e,t,s,o){function l(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,i){function a(e){try{n(o.next(e))}catch(t){i(t)}}function r(e){try{n(o["throw"](e))}catch(t){i(t)}}function n(e){e.done?s(e.value):l(e.value).then(a,r)}n((o=o.apply(e,t||[])).next())}))};const Z=(0,o.aZ)({mixins:[x.Z,V.Z],mounted:function(){this.getSettings()},methods:{getSettings(){return R(this,void 0,void 0,(function*(){let e;this.showLoading();try{let t=yield(0,U.O_)();e=yield $().get(U.hi.get_preferences,{headers:{"Content-Type":"multipart/form-data",Authorization:t}})}catch(t){return this.hideLoading(),void this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}if(this.hideLoading(),e.data)for(let[s,o]of Object.entries(e.data))this.settings_model[s]="true"==o||"false"!=o&&o}))},saveSettings(e,t){return R(this,void 0,void 0,(function*(){if(!e)return;this.showLoading();let s=new FormData;s.append("key",e),s.append("value",t);try{let e=yield(0,U.O_)();yield $().put(U.hi.set_preference,s,{headers:{"Content-Type":"multipart/form-data",Authorization:e}})}catch(o){return this.hideLoading(),void this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}this.hideLoading(),this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),(0,I.vq)(e,t)}))}},setup(){const e=(0,D.Z)(),t={};let s=[];return{settings_model:(0,W.iH)(t),display_data:[],icon:(0,W.iH)(!1),columns:s,processing:(0,W.iH)(!1),showNotification(t){e.notify({message:t,color:"primary",position:"top"})}}},data(){return{userDialog:(0,W.iH)(!1),api_key:""}}});var H=s(74260),z=s(64689),Q=s(5363),A=s(72448),P=s(7518),M=s.n(P);const F=(0,H.Z)(Z,[["render",S]]),N=F;M()(Z,"components",{QInput:z.Z,QTooltip:Q.Z,QSelect:A.Z});var j=s(98880);const Y={class:"container q-pa-xl"},K={class:"row",style:{"margin-bottom":"15px"}},J={style:{width:"20%",margin:"auto"}},X={style:{width:"80%"}},B=(0,o.Uk)(". "),G={class:"row"},ee={class:"row float-right"},te={class:"active-toggle import-active-toggle"},se=["onUpdate:modelValue"],oe=(0,o._)("div",{class:"slider"},null,-1),le=(0,o._)("img",{class:"loading-image",src:"loader.gif",alt:"Loading..."},null,-1);function ie(e,t,s,i,a,r){const n=(0,o.up)("q-btn"),d=(0,o.up)("ImportLogs"),c=(0,o.up)("q-th"),u=(0,o.up)("q-tr"),m=(0,o.up)("q-tooltip"),p=(0,o.up)("ConnectionLogs"),_=(0,o.up)("q-td"),h=(0,o.up)("q-table"),g=(0,o.up)("q-inner-loading"),w=(0,o.up)("EditCreate"),f=(0,o.up)("q-dialog");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",Y,[(0,o._)("div",K,[(0,o._)("div",J,(0,l.zw)(e.$t("pages.import.logic_apps")),1),(0,o._)("div",X,[(0,o.Uk)((0,l.zw)(e.$t("pages.import.logic"))+" ",1),(0,o._)("a",{onClick:t[0]||(t[0]=(...t)=>e.webSiteLink&&e.webSiteLink(...t)),class:"cursor-pointer",target:"_blank",style:{color:"#2388AE"}},(0,l.zw)(e.$t("pages.import.logic_link")),1),B])]),(0,o._)("div",G,[(0,o.Wm)(h,{"no-data-label":e.$t("pages.messages.NO_RECORD_FOUND"),style:{width:"100%",height:"100%"},class:"main-table dashboard-table-style",rows:e.rows,columns:e.columns,"row-key":"name",flat:"",bordered:"","rows-per-page-options":[0]},{top:(0,o.w5)((()=>[(0,o.Wm)(n,{color:"primary",class:"q-ml-auto",icon:"add",label:e.$t("new"),onClick:e.createNewRecord},null,8,["label","onClick"]),(0,o.Wm)(d,{setheight:"36px"})])),header:(0,o.w5)((e=>[(0,o.Wm)(u,{props:e},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.cols,((t,s)=>((0,o.wg)(),(0,o.j4)(c,{key:t.name,props:e,dropzone:"true","data-index":s},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(t.label),1)])),_:2},1032,["props","data-index"])))),128))])),_:2},1032,["props"])])),body:(0,o.w5)((t=>[(0,o.Wm)(u,{props:t,id:t.key},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.cols,(s=>((0,o.wg)(),(0,o.iD)(o.HY,{key:s.name},["action"===s.name?((0,o.wg)(),(0,o.j4)(_,{key:0,style:{width:"350px"}},{default:(0,o.w5)((()=>[(0,o._)("div",ee,["IMAP"===t.row.protocol||"POP3"===t.row.protocol?((0,o.wg)(),(0,o.j4)(n,{key:0,"icon-right":"network_check","no-caps":"",flat:"",dense:"",onClick:s=>e.checkLogin(t.row)},{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("test_connection")),1)])),_:1})])),_:2},1032,["onClick"])):(0,o.kq)("",!0),(0,o.Wm)(p,{connection_id:t.row.id,connection_type:"email_import"},null,8,["connection_id"]),(0,o.Wm)(n,{"icon-right":"edit","no-caps":"",flat:"",dense:"",onClick:s=>e.editRow(t.rowIndex,t.row)},{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("edit")),1)])),_:1})])),_:2},1032,["onClick"]),(0,o.Wm)(n,{"icon-right":"delete","no-caps":"",flat:"",dense:"",onClick:s=>e.deleteClicked(t.rowIndex,t.row.id)},{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("delete")),1)])),_:1})])),_:2},1032,["onClick"]),(0,o._)("label",te,[(0,o.wy)((0,o._)("input",{type:"checkbox","onUpdate:modelValue":[e=>t.row.is_active=e,s=>{e.de_activateEmail(t.row)}]},null,8,se),[[j.e8,t.row.is_active]]),oe])])])),_:2},1024)):"sub_org_id"===s.name?((0,o.wg)(),(0,o.j4)(_,{key:1},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.sub_orgs_flattened[t.row[s.name]]),1)])),_:2},1024)):((0,o.wg)(),(0,o.j4)(_,{key:2},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)("null"===t.row[s.name]?"":t.row[s.name]),1)])),_:2},1024))],64)))),128))])),_:2},1032,["props","id"])])),_:1},8,["no-data-label","rows","columns"])])]),(0,o.Wm)(g,{showing:e.loading,class:"z-index-1"},{default:(0,o.w5)((()=>[le])),_:1},8,["showing"]),(0,o.Wm)(f,{modelValue:e.show_edit_create,"onUpdate:modelValue":t[1]||(t[1]=t=>e.show_edit_create=t),persistent:"",onKeydown:t[2]||(t[2]=(0,j.D2)((t=>e.show_edit_create=!1),["esc"]))},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{selected_model:e.selected_row,api_key:e.api_key},null,8,["selected_model","api_key"])])),_:1},8,["modelValue"])],64)}var ae=s(80579),re=s(9273);const ne={key:0,class:"text-weight-bold"},de={key:1,class:"text-weight-bold"},ce={class:"row q-mt-md"},ue={class:"col-2"},me={class:"col-7"},pe={class:"col-3"},_e={class:"row q-mt-md"},he={class:"col-2"},ge={class:"col-7"},we={class:"col-3"},fe={class:"row q-mt-md"},ye=(0,o._)("div",{class:"col-2"},null,-1),be={class:"col-7"},ve=(0,o._)("div",{class:"col-3"},null,-1),ke={class:"row q-mt-md"},Ee=(0,o._)("div",{class:"col-2"},null,-1),qe={class:"col-7"},Ce=(0,o._)("div",{class:"col-3"},null,-1),Oe={class:"row q-mt-md"},Te=(0,o._)("div",{class:"col-2"},null,-1),Se={class:"col-7"},We=(0,o._)("div",{class:"col-3"},null,-1),xe={class:"row q-mt-md"},Ve=(0,o._)("div",{class:"col-2"},null,-1),Le={class:"col-7"},$e=(0,o._)("div",{class:"col-3"},null,-1),Ue={class:"row q-mt-md"},Ie={class:"col-2"},De={class:"col-7"},Re={class:"col-3"},Ze={class:"row q-mt-md"},He=(0,o._)("div",{class:"col-2"},null,-1),ze={class:"col-6"},Qe={class:"col-1"},Ae=(0,o._)("div",{class:"col-3"},null,-1),Pe={key:0,class:"row q-mt-md"},Me=(0,o._)("div",{class:"col-2"},null,-1),Fe={class:"col-7"},Ne={class:"row"},je={class:"col-4"},Ye={style:{"margin-top":"8px"}},Ke={class:"col"},Je=(0,o._)("div",{class:"col-3"},null,-1),Xe={key:1,class:"row q-mt-md"},Be=(0,o._)("div",{class:"col-2"},null,-1),Ge={class:"col-7"},et={class:"row"},tt={class:"col-4"},st={style:{"margin-top":"8px"}},ot={class:"col"},lt=(0,o._)("div",{class:"col-3"},null,-1),it={class:"row q-mt-md"},at=(0,o._)("div",{class:"col-2"},null,-1),rt={class:"col-7"},nt=(0,o._)("div",{class:"col-3"},null,-1),dt=(0,o._)("img",{class:"loading-image",src:"loader.gif",alt:"Loading..."},null,-1);function ct(e,t,s,i,a,r){const n=(0,o.up)("q-toolbar-title"),d=(0,o.up)("q-btn"),c=(0,o.up)("q-toolbar"),u=(0,o.up)("q-tooltip"),m=(0,o.up)("q-icon"),p=(0,o.up)("q-select"),_=(0,o.up)("q-input"),h=(0,o.up)("q-card-section"),g=(0,o.up)("q-toggle"),w=(0,o.up)("q-inner-loading"),f=(0,o.up)("q-card"),y=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(f,{style:{width:"1200px","max-width":"1200px",height:"600px"}},{default:(0,o.w5)((()=>[(0,o._)("form",{onSubmit:t[21]||(t[21]=(0,j.iM)(((...t)=>e.submitFrom&&e.submitFrom(...t)),["prevent","stop"]))},[(0,o.Wm)(c,{class:"text-white secondary-toolbar"},{default:(0,o.w5)((()=>[(0,o.Wm)(n,null,{default:(0,o.w5)((()=>[e.row_id?((0,o.wg)(),(0,o.iD)("span",ne,(0,l.zw)(e.$t("pages.settings.master_data_lookup.edit_row")),1)):((0,o.wg)(),(0,o.iD)("span",de,(0,l.zw)(e.$t("pages.settings.master_data_lookup.create_row")),1))])),_:1}),(0,o.wy)((0,o.Wm)(d,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])])),_:1}),e.Office365_selected?((0,o.wg)(),(0,o.j4)(h,{key:1},{default:(0,o.w5)((()=>[(0,o._)("div",Ue,[(0,o._)("div",Ie,[(0,o.Wm)(p,{modelValue:e.model["protocol"],"onUpdate:modelValue":[t[10]||(t[10]=t=>e.model["protocol"]=t),e.protocolUpdated],outlined:"",options:e.protocols,label:e.$t("pages.import.protocol")},{append:(0,o.w5)((()=>[e.errors["protocol"]?((0,o.wg)(),(0,o.j4)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"bg-red line-error-tooltip"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1},8,["modelValue","options","label","onUpdate:modelValue"])]),(0,o._)("div",De,[(0,o.Wm)(p,{class:"full q-ml-sm",outlined:"",clearable:"",modelValue:e.model["sub_org_id"],"onUpdate:modelValue":t[11]||(t[11]=t=>e.model["sub_org_id"]=t),"use-input":"",options:e.filterSubOrgsList,onFilter:e.filterSubOrgslistEvent,label:e.$t("sub_organizations"),loading:e.sub_org_list_loading,"emit-value":"","map-options":""},null,8,["modelValue","options","onFilter","label","loading"])]),(0,o._)("div",Re,[0==e.ms_authenticate&&0==e.ms_is_authenticated?((0,o.wg)(),(0,o.j4)(d,{key:0,class:"q-ml-sm",color:"primary",label:e.$t("pages.import.authenticate"),onClick:t[12]||(t[12]=t=>e.submitFrom()),style:{height:"56px"}},null,8,["label"])):1==e.ms_authenticate&&0==e.ms_is_authenticated?((0,o.wg)(),(0,o.j4)(d,{key:1,class:"q-ml-sm",color:"primary",style:{height:"56px"},label:e.$t("pages.import.finish_authentication"),onClick:t[13]||(t[13]=t=>e.msfinish())},null,8,["label"])):(0,o.kq)("",!0)])]),(0,o._)("div",Ze,[He,(0,o._)("div",ze,[1==e.ms_authenticate&&0==e.ms_is_authenticated?((0,o.wg)(),(0,o.j4)(_,{key:0,modelValue:e.ms_code,"onUpdate:modelValue":t[14]||(t[14]=t=>e.ms_code=t),label:e.$t("pages.import.microsoft_code"),outlined:"",readonly:"",onClick:e.copyText,id:"mscode",style:{"margin-left":"10px",width:"90%"}},null,8,["modelValue","label","onClick"])):(0,o.kq)("",!0)]),(0,o._)("div",Qe,[1==e.ms_authenticate&&0==e.ms_is_authenticated?((0,o.wg)(),(0,o.j4)(d,{key:0,style:{"margin-left":"4px","margin-top":"8px",height:"14px"},round:"",color:"primary",icon:"fas fa-copy",onClick:e.copyText},null,8,["onClick"])):(0,o.kq)("",!0)]),Ae]),e.loading||1!=e.ms_is_authenticated?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",Pe,[Me,(0,o._)("div",Fe,[(0,o._)("div",Ne,[(0,o._)("div",je,[(0,o.Wm)(g,{modelValue:e.use_folder,"onUpdate:modelValue":t[15]||(t[15]=t=>e.use_folder=t)},null,8,["modelValue"]),(0,o._)("span",Ye,(0,l.zw)(e.$t("Use Folder")),1)]),(0,o._)("div",Ke,[1==e.use_folder?((0,o.wg)(),(0,o.j4)(_,{key:0,modelValue:e.model["folder"],"onUpdate:modelValue":t[16]||(t[16]=t=>e.model["folder"]=t),label:e.$t("pages.import.folder"),outlined:"","data-cy":"folder",style:{"margin-left":"10px"}},null,8,["modelValue","label"])):(0,o.kq)("",!0)])])]),Je])),e.loading||1!=e.ms_is_authenticated?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",Xe,[Be,(0,o._)("div",Ge,[(0,o._)("div",et,[(0,o._)("div",tt,[(0,o.Wm)(g,{modelValue:e.use_email,"onUpdate:modelValue":t[17]||(t[17]=t=>e.use_email=t)},null,8,["modelValue"]),(0,o._)("span",st,(0,l.zw)(e.$t("Use shared Mailbox")),1)]),(0,o._)("div",ot,[1==e.use_email?((0,o.wg)(),(0,o.j4)(_,{key:0,modelValue:e.model["email"],"onUpdate:modelValue":t[18]||(t[18]=t=>e.model["email"]=t),label:e.$t("pages.import.shared_email"),outlined:"","data-cy":"email",style:{"margin-left":"10px"}},null,8,["modelValue","label"])):(0,o.kq)("",!0)])])]),lt]))])),_:1})):((0,o.wg)(),(0,o.j4)(h,{key:0},{default:(0,o.w5)((()=>[(0,o._)("div",ce,[(0,o._)("div",ue,[(0,o.Wm)(p,{modelValue:e.model["protocol"],"onUpdate:modelValue":[t[0]||(t[0]=t=>e.model["protocol"]=t),e.protocolUpdated],outlined:"",options:e.protocols,label:e.$t("pages.import.protocol")},{append:(0,o.w5)((()=>[e.errors["protocol"]?((0,o.wg)(),(0,o.j4)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"bg-red line-error-tooltip"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1},8,["modelValue","options","label","onUpdate:modelValue"])]),(0,o._)("div",me,[(0,o.Wm)(_,{modelValue:e.model["server"],"onUpdate:modelValue":t[1]||(t[1]=t=>e.model["server"]=t),label:e.$t("pages.import.server"),outlined:"",class:(0,l.C_)("full q-ml-sm")},{append:(0,o.w5)((()=>[e.errors["server"]?((0,o.wg)(),(0,o.j4)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"bg-red line-error-tooltip"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1},8,["modelValue","label"])]),(0,o._)("div",pe,[(0,o.Wm)(_,{modelValue:e.model["port"],"onUpdate:modelValue":t[2]||(t[2]=t=>e.model["port"]=t),label:e.$t("pages.import.port"),outlined:"","data-cy":"port",class:(0,l.C_)("full q-ml-sm")},{append:(0,o.w5)((()=>[e.errors["port"]?((0,o.wg)(),(0,o.j4)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"bg-red line-error-tooltip"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1},8,["modelValue","label"])])]),(0,o._)("div",_e,[(0,o._)("div",he,[(0,o.Wm)(p,{modelValue:e.model["encryption"],"onUpdate:modelValue":t[3]||(t[3]=t=>e.model["encryption"]=t),outlined:"","data-cy":"encryption",options:e.encryptions,class:(0,l.C_)("full-width "),label:e.$t("pages.import.encryption")},{append:(0,o.w5)((()=>[e.errors["encryption"]?((0,o.wg)(),(0,o.j4)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"bg-red line-error-tooltip"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1},8,["modelValue","options","label"])]),(0,o._)("div",ge,[(0,o.Wm)(_,{modelValue:e.model["username"],"onUpdate:modelValue":t[4]||(t[4]=t=>e.model["username"]=t),class:(0,l.C_)(["full q-ml-sm","full q-ml-sm"]),label:e.$t("pages.import.username"),outlined:"","data-cy":"username"},{append:(0,o.w5)((()=>[e.errors["username"]?((0,o.wg)(),(0,o.j4)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"bg-red line-error-tooltip"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1},8,["modelValue","label"])]),(0,o._)("div",we,["IMAP"==e.model["protocol"]?((0,o.wg)(),(0,o.j4)(_,{key:0,modelValue:e.model["folder"],"onUpdate:modelValue":t[5]||(t[5]=t=>e.model["folder"]=t),label:e.$t("pages.import.folder"),outlined:"","data-cy":"folder",class:"full q-ml-sm"},null,8,["modelValue","label"])):(0,o.kq)("",!0)])]),(0,o._)("div",fe,[ye,(0,o._)("div",be,[(0,o.Wm)(_,{modelValue:e.model["email"],"onUpdate:modelValue":t[6]||(t[6]=t=>e.model["email"]=t),label:e.$t("pages.import.email"),outlined:"","data-cy":"email",class:(0,l.C_)("full q-ml-sm")},{append:(0,o.w5)((()=>[e.errors["email"]?((0,o.wg)(),(0,o.j4)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"bg-red line-error-tooltip"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1},8,["modelValue","label"])]),ve]),(0,o._)("div",ke,[Ee,(0,o._)("div",qe,[(0,o.Wm)(_,{modelValue:e.model["password"],"onUpdate:modelValue":t[7]||(t[7]=t=>e.model["password"]=t),type:"password",label:e.$t("pages.import.password"),outlined:"","data-cy":"password",class:(0,l.C_)("full q-ml-sm")},{append:(0,o.w5)((()=>[e.errors["password"]?((0,o.wg)(),(0,o.j4)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"bg-red line-error-tooltip"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1},8,["modelValue","label"])]),Ce]),(0,o._)("div",Oe,[Te,(0,o._)("div",Se,[(0,o.Wm)(p,{class:"full q-ml-sm",outlined:"",clearable:"",modelValue:e.model["sub_org_id"],"onUpdate:modelValue":t[8]||(t[8]=t=>e.model["sub_org_id"]=t),"use-input":"",options:e.filterSubOrgsList,onFilter:e.filterSubOrgslistEvent,label:e.$t("sub_organizations"),loading:e.sub_org_list_loading,"emit-value":"","map-options":""},null,8,["modelValue","options","onFilter","label","loading"])]),We]),(0,o._)("div",xe,[Ve,(0,o._)("div",Le,[(0,o.Wm)(_,{class:(0,l.C_)(["full q-ml-sm","bg-disable"]),id:"apiKey",outlined:"",modelValue:e.api_key_ref,"onUpdate:modelValue":t[9]||(t[9]=t=>e.api_key_ref=t),readonly:"",label:e.$t("pages.import.token")},null,8,["modelValue","label"])]),$e])])),_:1})),e.Office365_selected&&1!=e.ms_is_authenticated?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(h,{key:2,class:"p-t-0"},{default:(0,o.w5)((()=>[(0,o._)("div",it,[at,(0,o._)("div",rt,[e.Office365_selected?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(d,{key:0,type:"submit",color:"primary",class:"q-ml-sm float-right",label:e.$t("save")},null,8,["label"])),1==e.ms_is_authenticated?((0,o.wg)(),(0,o.j4)(d,{key:1,class:"q-ml-sm float-right",color:"primary",label:e.$t("pages.import.save"),onClick:t[19]||(t[19]=t=>e.saveFolder())},null,8,["label"])):(0,o.kq)("",!0),e.row_id?((0,o.wg)(),(0,o.j4)(d,{key:2,color:"primary",class:"q-ml-sm float-right",label:e.$t("pages.import.import"),onClick:t[20]||(t[20]=t=>e.manual_import())},null,8,["label"])):(0,o.kq)("",!0),(0,o.wy)((0,o.Wm)(d,{class:"float-right highlighted-back",label:e.$t("cancel")},null,8,["label"]),[[y]])]),nt])])),_:1}))],32),(0,o.Wm)(w,{showing:e.loading,class:"z-index-1"},{default:(0,o.w5)((()=>[dt])),_:1},8,["showing"])])),_:1})}var ut=s(10321),mt=s(60727),pt=s(41914),_t=s(20179),ht=function(e,t,s,o){function l(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,i){function a(e){try{n(o.next(e))}catch(t){i(t)}}function r(e){try{n(o["throw"](e))}catch(t){i(t)}}function n(e){e.done?s(e.value):l(e.value).then(a,r)}n((o=o.apply(e,t||[])).next())}))};const gt=(0,o.aZ)({el:"#app",mixins:[x.Z,V.Z],props:{selected_model:{},api_key:{type:String,default:""}},components:{},data(){return{}},setup(){const e=(0,mt.At)(),{encryptions:t,protocols:s,subOrgList:o,sub_org_list_loading:l}=(0,ut.Jk)(e),i=(0,W.iH)(e.subOrgList);return{EMAIL_ENCRYPTION_KEY:(0,W.iH)(""),subOrgList:o,sub_org_list_loading:l,filterSubOrgsList:i,protocols:s,encryptions:t,loading:(0,W.iH)(!1),model:(0,W.iH)({}),row_id:(0,W.iH)(""),errors:(0,W.iH)({}),Office365_selected:(0,W.iH)(!1),use_folder:(0,W.iH)(!1),use_email:(0,W.iH)(!1),ms_url:(0,W.iH)("https://microsoft.com/devicelogin"),ms_code:(0,W.iH)(""),ms_authenticate:(0,W.iH)(!1),ms_is_authenticated:(0,W.iH)(!1),ms_message:(0,W.iH)("Microsoft o365 is authenticated already."),api_key_ref:(0,W.iH)("")}},mounted:function(){const e="thi5i5@very5ecurehardc0d3denCrIp";if(void 0==e)throw"Missing EMAIL_ENCRYPTION_KEY env - unable to load";this.EMAIL_ENCRYPTION_KEY=e,this.initView()},methods:{initView(){this.api_key_ref=this.api_key,this.row_id=this.selected_model.hasOwnProperty("id")?this.selected_model.id:"",this.model=JSON.parse(JSON.stringify(this.selected_model));for(let[e,t]of Object.entries(this.model))t||(this.model[e]="");"OAuth Office365"==this.model["protocol"]&&(this.ms_is_authenticated=!0,this.protocolUpdated(),this.model.folder&&(this.use_folder=!0),this.model.email&&(this.use_email=!0)),this.model.hasOwnProperty("service_type")||(this.model.service_type="Other"),null!=this.model["password"]&&""!=this.model["password"]&&(this.model["password"]=this.decryptPassword(this.model["password"]).toString(_t.cE.Utf8)),this.row_id||this.resetForm()},resetForm(){this.model={active:!1,email:"",username:"",password:"",server:"",port:"",folder:"",encryption:"",protocol:"",service_type:"Other",whole_email:!1,skip:!1,sub_org_id:""}},submitFrom(){return ht(this,void 0,void 0,(function*(){try{this.loading=!0,"OAuth Office365"==this.model.protocol&&this.updateModel();const e=yield ae.mX.AddUpdateEmail(this.prepareApiData());if(!e.success)throw e.message;if(this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),"OAuth Office365"!==this.model.protocol)return this.resetForm(),void this.updateEmailImportEvent();"OAuth Office365"==this.model.protocol&&e.hasOwnProperty("code")&&(this.model=e.data,this.row_id=this.model.id,this.ms_code=e.code,this.openMsPage(),this.ms_authenticate=!0);const t=new CustomEvent("record_saved",{detail:{}});document.dispatchEvent(t)}catch(e){const t=re.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},prepareApiData(){let e=this.encryptPassword();return{email:this.model.email,password:e,username:this.model.username,server:this.model.server,port:this.model.port,encryption:this.model.encryption,protocol:this.model.protocol,whole_email:""!==this.model.whole_email&&this.model.whole_email,skip:""!==this.model.skip&&this.model.skip,api_key:this.api_key,sub_org_id:this.model.sub_org_id,id:this.row_id,folder:"SSL"!=this.model.encryption||"IMAP"!=this.model.protocol?"Inbox":this.model.folder}},encryptPassword(){var e=_t.cE.Utf8.parse(this.EMAIL_ENCRYPTION_KEY),t=_t.es.encrypt(this.model.password,e,{mode:_t.xJ.ECB,padding:_t.vk.PKCS7});return t},decryptPassword(e){var t=_t.cE.Utf8.parse(this.EMAIL_ENCRYPTION_KEY),s=_t.es.decrypt(e,t,{mode:_t.xJ.ECB});return s},updateModel(){this.model.password="",this.model.username="",this.model.server="",this.model.port="",this.model.encryption="",this.model.folder=""},copyText(){(0,pt.Z)(this.ms_code).then((()=>{this.showSuccessToast("Copied!")}))},updateEmailImportEvent(){const e=new CustomEvent("email_import_updated",{});document.dispatchEvent(e)},openMsPage(){window.open(this.ms_url,"_blank")},protocolUpdated(){"OAuth Office365"==this.model.protocol?this.Office365_selected=!0:this.Office365_selected=!1},msfinish(){return ht(this,void 0,void 0,(function*(){try{this.loading=!0;const e=yield ae.mX.finishMsAuth(this.row_id);1==e.success&&(this.ms_is_authenticated=!0,this.showSuccessToast(this.$t("Authentication completed")))}catch(e){this.showErrorToast(this.$t("Something failed on the transmission. Please try again."))}finally{this.loading=!1}}))},manual_import(){return ht(this,void 0,void 0,(function*(){yield ae.mX.performManuelImportMail(this.row_id),this.showSuccessToast(this.$t("pages.messages.import_try")),this.$router.push("/dashboard")}))},validateLoginTest(){let e=!0;this.resetErrors();const t=["folder","whole_email","skip","active"];if("OAuth Office365"===this.model.protocol)return e=!1,this.showErrorToast(this.$t("service_type_not_supported")),e;for(const[s,o]of Object.entries(this.model))t.includes(s)||o&&0!=String(o).length||(e=!1,this.errors[s]=!0);return e},resetErrors(){for(const[e,t]of Object.entries(this.model))this.errors[e]=!1},saveFolder(){return ht(this,void 0,void 0,(function*(){try{this.loading=!0;const e={id:this.row_id,folder:1==this.use_folder?this.model.folder:"",email:1==this.use_email?this.model.email:"",sub_org_id:this.model.sub_org_id};let t=yield ae.mX.saveFolder(e);if(!t.success)throw t;this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),this.resetForm(),this.updateEmailImportEvent()}catch(e){this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}finally{this.loading=!1}}))},filterSubOrgslistEvent(e,t,s){t(e?()=>{const t=e.toLowerCase();this.filterSubOrgsList=this.subOrgList.filter((e=>e.label.toLowerCase().indexOf(t)>-1))}:()=>{this.filterSubOrgsList=this.subOrgList})}}});var wt=s(10151),ft=s(39570),yt=s(13747),bt=s(2165),vt=s(25589),kt=s(24554),Et=s(28886),qt=s(66941),Ct=s(60677);const Ot=(0,H.Z)(gt,[["render",ct]]),Tt=Ot;M()(gt,"components",{QCard:wt.Z,QToolbar:ft.Z,QToolbarTitle:yt.Z,QBtn:bt.Z,QCardSection:vt.Z,QSelect:A.Z,QIcon:kt.Z,QTooltip:Q.Z,QInput:z.Z,QToggle:Et.Z,QInnerLoading:qt.Z}),M()(gt,"directives",{ClosePopup:Ct.Z});const St=(0,o._)("img",{width:"24",height:"24",src:"logs.svg",class:"icon-grey-svg"},null,-1),Wt={class:"text-weight-bold primary-bg-text"},xt={class:"q-pl-md q-pr-md q-pt-md"},Vt={class:"text-item"},Lt=(0,o._)("div",{class:"row float-right"},null,-1),$t={key:0,style:{"text-wrap":"wrap"}},Ut={key:1},It={class:"q-mt-md row full-width"},Dt=(0,o._)("img",{class:"loading-image",src:"loader.gif",alt:"Loading..."},null,-1);function Rt(e,t,s,i,a,r){const n=(0,o.up)("q-tooltip"),d=(0,o.up)("q-btn"),c=(0,o.up)("q-toolbar-title"),u=(0,o.up)("q-toolbar"),m=(0,o.up)("q-th"),p=(0,o.up)("q-tr"),_=(0,o.up)("q-td"),h=(0,o.up)("q-icon"),g=(0,o.up)("q-table"),w=(0,o.up)("q-pagination"),f=(0,o.up)("q-card-section"),y=(0,o.up)("q-card"),b=(0,o.up)("q-dialog"),v=(0,o.up)("q-inner-loading");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(d,{flat:"",dense:"",onClick:e.checkConnectionLogs},{default:(0,o.w5)((()=>[St,(0,o.Wm)(n,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("pages.import.connection_logs")),1)])),_:1})])),_:1},8,["onClick"]),(0,o.Wm)(b,{modelValue:e.show_popup,"onUpdate:modelValue":t[2]||(t[2]=t=>e.show_popup=t),onKeydown:(0,j.D2)(e.cleanupOnhide,["esc"]),onHide:e.cleanupOnhide},{default:(0,o.w5)((()=>[(0,o.Wm)(y,{style:{width:"1060px","max-width":"1060px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"secondary-toolbar"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o._)("span",Wt,(0,l.zw)(e.$t("pages.import.connection_logs")),1)])),_:1}),(0,o.Wm)(d,{flat:"",round:"",dense:"",class:"primary-bg-text",icon:"close",onClick:e.cleanupOnhide},null,8,["onClick"])])),_:1}),(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o._)("div",xt,[(0,o.Wm)(g,{class:(0,l.C_)("main-table"),"rows-per-page-options":[0],rows:e.rows,columns:e.columns,"row-key":"id","hide-bottom":"","no-data-label":e.$t("no_data_found"),"no-results-label":"The filter didn't uncover any results",style:{overflow:"scroll",height:"600px"}},{header:(0,o.w5)((t=>[(0,o.Wm)(p,{props:t,class:(0,l.C_)("highlighted-back ")},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.cols,((e,s)=>((0,o.wg)(),(0,o.j4)(m,{key:e.name,props:t,"data-index":s},{default:(0,o.w5)((()=>[(0,o._)("span",Vt,(0,l.zw)(e.label),1)])),_:2},1032,["props","data-index"])))),128))])),_:2},1032,["props"]),0==e.rows.length?((0,o.wg)(),(0,o.j4)(p,{key:0},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{colspan:"20",class:"text-center"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("no_data_found")),1)])),_:1})])),_:1})):(0,o.kq)("",!0)])),body:(0,o.w5)((e=>[(0,o.Wm)(p,{props:e,id:e.key},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.cols,(t=>((0,o.wg)(),(0,o.iD)(o.HY,{key:t.name},["action"===t.name?((0,o.wg)(),(0,o.j4)(_,{key:0},{default:(0,o.w5)((()=>[Lt])),_:1})):(0,o.kq)("",!0),"success"===t.name?((0,o.wg)(),(0,o.j4)(_,{key:1},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{name:!0===e.row[t.name]?"check_circle":"cancel",color:!0===e.row[t.name]?"green":"red",size:"20px"},null,8,["name","color"])])),_:2},1024)):((0,o.wg)(),(0,o.j4)(_,{key:2},{default:(0,o.w5)((()=>["message"===t.name?((0,o.wg)(),(0,o.iD)("span",$t,(0,l.zw)(e.row[t.name]),1)):((0,o.wg)(),(0,o.iD)("span",Ut,(0,l.zw)(e.row[t.name]),1))])),_:2},1024))],64)))),128))])),_:2},1032,["props","id"])])),_:1},8,["rows","columns","no-data-label"]),(0,o._)("div",It,[e.total_pages>1?((0,o.wg)(),(0,o.j4)(w,{key:0,modelValue:e.current_page,"onUpdate:modelValue":t[0]||(t[0]=t=>e.current_page=t),max:e.total_pages,"max-pages":6,"direction-links":"",unelevated:"",color:"black","active-color":"black",class:"doc2-pagination q-mb-md q-ml-auto q-mr-auto",onClick:t[1]||(t[1]=t=>e.nexPageClicked())},null,8,["modelValue","max"])):(0,o.kq)("",!0)])])])),_:1})])),_:1})])),_:1},8,["modelValue","onKeydown","onHide"]),(0,o.Wm)(v,{showing:e.loading},{default:(0,o.w5)((()=>[Dt])),_:1},8,["showing"])],64)}var Zt=s(25616),Ht=function(e,t,s,o){function l(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,i){function a(e){try{n(o.next(e))}catch(t){i(t)}}function r(e){try{n(o["throw"](e))}catch(t){i(t)}}function n(e){e.done?s(e.value):l(e.value).then(a,r)}n((o=o.apply(e,t||[])).next())}))};const zt=(0,o.aZ)({mixins:[V.Z,x.Z],props:{connection_id:{type:String,required:!0},connection_type:{type:String,required:!0}},components:{},watch:{},computed:{},mounted:function(){this.init()},methods:{init(){window.cl=this,this.prepareColumns()},checkConnectionLogs(){try{this.resetPagination(),this.getDataFromServer()}catch(e){const t=re.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}},getDataFromServer(){return Ht(this,void 0,void 0,(function*(){try{this.loading=!0,this.request_params={},this.request_params["offset"]=this.offset,this.request_params["limit"]=this.page_size,this.request_params["connection_type"]=this.connection_type,this.request_params["connection_id"]=this.connection_id,this.request_params["order_by_direction"]="desc";const e=yield ae.mX.fetchConnectionLogs(this.request_params);if(!1===e.success)throw{message:e.message};this.total_records=e.total_records_count,this.setTotalPages(),this.prepareRows(e.elements),this.show_popup=!0}catch(e){const t=re.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},prepareRows(e){this.rows=[],Array.from(e).forEach((e=>{const t=e;this.addNewRow(t)}))},addNewRow(e){let t=Object.assign({},e);return t["created_on"]=this.formateDate(e["created_on"],"DD-MM-YYYY HH:mm:ss"),this.rows.push(t),this.rows.length.toString()},formateDate(e,t){return Zt.ZP.formatDate(e,t)},resetPagination(){this.offset=0,this.total_pages=0,this.current_page=1,this.total_records=0},setTotalPages(){this.total_pages=Math.ceil(this.total_records/this.page_size)},nexPageClicked(){return Ht(this,void 0,void 0,(function*(){try{this.calculateOffset(),yield this.getDataFromServer()}catch(e){const t=re.w.getErrorMessage(e);this.showErrorToast(t)}}))},calculateOffset(){this.offset=this.page_size*(this.current_page-1)},prepareColumns(){this.columns=[],this.columns.push({name:"success",label:this.$t("status"),field:"status",align:"left"}),this.columns.push({name:"created_on",label:this.$t("created_on"),field:"created_on",align:"left"}),this.columns.push({name:"message",label:this.$t("pages.support.message"),field:"message",align:"left"})},cleanupOnhide(){this.show_popup=!1,this.resetPagination()}},setup(){return{loading:(0,W.iH)(!1),request_params:(0,W.iH)({}),current_page:(0,W.iH)(1),total_pages:(0,W.iH)(0),offset:(0,W.iH)(0),page_size:(0,W.iH)(8),total_records:(0,W.iH)(0),show_popup:(0,W.iH)(!1),columns:(0,W.iH)([]),rows:(0,W.iH)([])}}});var Qt=s(46778),At=s(17132),Pt=s(18186),Mt=s(92414),Ft=s(83884),Nt=s(87300);const jt=(0,H.Z)(zt,[["render",Rt]]),Yt=jt;M()(zt,"components",{QBtn:bt.Z,QTooltip:Q.Z,QDialog:Qt.Z,QCard:wt.Z,QToolbar:ft.Z,QToolbarTitle:yt.Z,QCardSection:vt.Z,QTable:At.Z,QTr:Pt.Z,QTh:Mt.Z,QTd:Ft.Z,QIcon:kt.Z,QPagination:Nt.Z,QInnerLoading:qt.Z});var Kt=s(47286),Jt=s(93033);const Xt="sub_app",Bt={methods:{async getSubscriptionFromServer(){try{const e=await ae.FT.getSubscription();if(!e||!e||!Array.isArray(e)||0==e.length)return;(0,Jt.w4)(Xt,this.getDoc2AppSubscription(e))}catch(e){}},getDoc2AppSubscription(e){let t=!1,s={};for(let o of e){const e=o.apps;for(let l of e)if("FELLOW_DOC2"===l.app_key){t=!0,s=o;break}if(!0===t)break}return s},getRemainingDays(){let e=-1,t=this.getSubscription();if(!t)return null;let s=this.getDateFromServerDate(t.end_date);const o=(new Date).setHours(0,0,0,0);return e=this.datediff(o,s),e},datediff(e,t){return Math.round((t-e)/864e5)},getDateFromServerDate(e){var t=e.split(" ");return new Date(t[0]).setHours(0,0,0,0)},async getsubscriptionRemainingDays(){let e=0;try{e=this.getRemainingDays(),null==e&&(await this.getSubscriptionFromServer(),e=this.getRemainingDays())}catch(t){}return e},subscriptionAlertShowDays(){return 30},getSubscription(){let e=(0,Jt.jE)(Xt);return e&&e.hasOwnProperty("start_date")&&e.hasOwnProperty("end_date")?e:null}}};var Gt=s(12699),es=function(e,t,s,o){function l(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,i){function a(e){try{n(o.next(e))}catch(t){i(t)}}function r(e){try{n(o["throw"](e))}catch(t){i(t)}}function n(e){e.done?s(e.value):l(e.value).then(a,r)}n((o=o.apply(e,t||[])).next())}))};const ts=(0,o.aZ)({mixins:[x.Z,V.Z,Bt],components:{EditCreate:Tt,ConnectionLogs:Yt,ImportLogs:Kt.Z},watch:{sub_org_list_loading(e,t){!1===e&&this.initView()}},mounted:function(){const e="thi5i5@very5ecurehardc0d3denCrIp";void 0!=e?(this.EMAIL_ENCRYPTION_KEY=e,document.addEventListener("email_import_updated",this.emailImportUpdated),this.handleSubOrgs()):this.showErrorToast("Missing an important value - unable to load email import")},unmounted:function(){document.removeEventListener("email_import_updated",this.emailImportUpdated)},methods:{initView(){return es(this,void 0,void 0,(function*(){try{this.loading=!0,this.prepareColumns(),yield this.getAppKey(),this.flattenSubOrgs(),this.getList()}catch(e){const t=re.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},handleSubOrgs(){this.subOrgList.length>1&&this.initView(),this.sub_org_list_loading&&(this.loading=!0)},getList(){return es(this,void 0,void 0,(function*(){try{this.loading=!0,this.prepareColumns();const e=yield ae.mX.getList();if(0==e.data.length)return;this.prepareRows(e.data)}catch(e){const t=re.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},prepareRows(e){this.rows=[],Array.from(e).forEach((e=>{const t=e;this.addNewRow(t)}))},addNewRow(e){let t=Object.assign({},e);return this.rows.push(t),this.rows.length.toString()},createNewRecord(){this.selected_row={},this.show_edit_create=!0},emailImportUpdated(){this.show_edit_create=!1,this.getList()},editRow(e,t){this.selected_row=JSON.parse(JSON.stringify(t)),this.show_edit_create=!0},deleteClicked(e,t){return es(this,void 0,void 0,(function*(){try{this.loading=!0;const s=yield ae.mX.deleteRecord(t);!0===s.success&&this.rows.splice(e,1),this.showSuccessToast(this.$t("success"))}catch(s){const e=re.w.getErrorMessage(s);this.showErrorToast(e)}finally{this.loading=!1}}))},getAppKey(){return es(this,void 0,void 0,(function*(){try{this.loading=!0;const e={app_key:"FELLOW_DOC2"},t=yield ae.FT.getAppSubscription(e);this.api_key=t[0].token}catch(e){const t=re.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},de_activateEmail(e){return es(this,void 0,void 0,(function*(){try{this.loading=!0;const t=e.id,s=e.is_active;yield ae.mX.DeActivateEmail(t,s);this.showSuccessToast(this.$t("success"))}catch(t){const e=re.w.getErrorMessage(t);this.showErrorToast(e)}finally{this.loading=!1}}))},checkLogin(e){return es(this,void 0,void 0,(function*(){try{this.loading=!0;const t=yield ae.mX.testEmailLogin(String(e.id));if(!t||t.hasOwnProperty("success")&&!1===t.success)throw t;this.showSuccessToast(this.$t("check_login_success"))}catch(t){const e=re.w.getErrorMessage(t);this.showErrorToast(e)}finally{this.loading=!1}}))},flattenSubOrgs(){this.subOrgList.forEach((e=>{this.sub_orgs_flattened[e.value]=e.label}))},prepareColumns(){this.columns=[],this.columns.push({name:"username",label:this.$t("username"),field:"username",align:"left"}),this.columns.push({name:"email",label:this.$t("email"),field:"email",align:"left"}),this.columns.push({name:"protocol",label:this.$t("protocol"),field:"protocol",align:"left"}),this.columns.push({name:"encryption",label:this.$t("encryption"),field:"encryption",align:"left"}),this.columns.push({name:"sub_org_id",label:this.$t("sub_organizations"),field:"sub_org_id",align:"left"}),this.columns.push({name:"folder",label:this.$t("folder"),field:"folder",align:"left"}),this.columns.push({name:"action",label:this.$t("action"),field:"action",align:"right"})},webSiteLink(){const e=(0,Gt.Rg)("logic_apps");e&&window.open(e)}},setup(){const e=(0,mt.At)(),{subOrgList:t,sub_org_list_loading:s}=(0,ut.Jk)(e);let o=(0,W.iH)({});const l=(0,W.iH)(null);return{sub_org_list_loading:s,subOrgList:t,myForm:l,import_email:o,errors:(0,W.iH)({}),sub_orgs_flattened:(0,W.iH)({}),processing:(0,W.iH)(!1),ms_url:(0,W.iH)("https://microsoft.com/devicelogin"),ms_code:(0,W.iH)(""),ms_authenticate:(0,W.iH)(!1),ms_is_authenticated:(0,W.iH)(!1),ms_message:(0,W.iH)("Microsoft o365 is authenticated already."),loading:(0,W.iH)(!1),userDialog:(0,W.iH)(!1),columns:(0,W.iH)([]),rows:(0,W.iH)([]),show_edit_create:(0,W.iH)(!1),selected_row:(0,W.iH)({}),api_key:(0,W.iH)(""),EMAIL_ENCRYPTION_KEY:(0,W.iH)("")}},data(){return{}}}),ss=(0,H.Z)(ts,[["render",ie]]),os=ss;M()(ts,"components",{QTable:At.Z,QBtn:bt.Z,QTr:Pt.Z,QTh:Mt.Z,QTd:Ft.Z,QTooltip:Q.Z,QInnerLoading:qt.Z,QDialog:Qt.Z});const ls={class:"container q-pa-xl"},is={class:"row"},as={class:"row float-right"},rs={class:"active-toggle import-active-toggle"},ns=["onUpdate:modelValue"],ds=(0,o._)("div",{class:"slider"},null,-1),cs=(0,o._)("img",{class:"loading-image",src:"loader.gif",alt:"Loading..."},null,-1);function us(e,t,s,i,a,r){const n=(0,o.up)("q-btn"),d=(0,o.up)("q-th"),c=(0,o.up)("q-tr"),u=(0,o.up)("q-tooltip"),m=(0,o.up)("ConnectionLogs"),p=(0,o.up)("q-td"),_=(0,o.up)("q-table"),h=(0,o.up)("q-inner-loading"),g=(0,o.up)("EditCreate"),w=(0,o.up)("q-dialog");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",ls,[(0,o._)("div",is,[(0,o.Wm)(_,{style:{width:"100%",height:"100%"},class:"dashboard-table-style main-table",rows:e.rows,columns:e.columns,"row-key":"name",flat:"","no-data-label":e.$t("pages.messages.NO_RECORD_FOUND"),bordered:"","rows-per-page-options":[0]},{top:(0,o.w5)((()=>[(0,o.Wm)(n,{color:"primary",class:"q-ml-auto",icon:"add",label:e.$t("new"),onClick:e.createNewRecord},null,8,["label","onClick"])])),header:(0,o.w5)((e=>[(0,o.Wm)(c,{props:e},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.cols,((t,s)=>((0,o.wg)(),(0,o.j4)(d,{key:t.name,props:e,dropzone:"true","data-index":s},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(t.label),1)])),_:2},1032,["props","data-index"])))),128))])),_:2},1032,["props"])])),body:(0,o.w5)((t=>[(0,o.Wm)(c,{props:t,id:t.key},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.cols,(s=>((0,o.wg)(),(0,o.iD)(o.HY,{key:s.name},["action"===s.name?((0,o.wg)(),(0,o.j4)(p,{key:0,style:{width:"236px"}},{default:(0,o.w5)((()=>[(0,o._)("div",as,[(0,o.Wm)(n,{"icon-right":"network_check","no-caps":"",flat:"",dense:"",onClick:s=>e.checkConnection(t.row.id)},{default:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("test_connection")),1)])),_:1})])),_:2},1032,["onClick"]),(0,o.Wm)(m,{connection_id:t.row.id,connection_type:"ftp_import"},null,8,["connection_id"]),(0,o.Wm)(n,{"icon-right":"edit","no-caps":"",flat:"",dense:"",onClick:s=>e.editRow(t.rowIndex,t.row)},{default:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("edit")),1)])),_:1})])),_:2},1032,["onClick"]),(0,o.Wm)(n,{"icon-right":"delete","no-caps":"",flat:"",dense:"",onClick:s=>e.deleteClicked(t.rowIndex,t.row.id)},{default:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("delete")),1)])),_:1})])),_:2},1032,["onClick"]),(0,o._)("label",rs,[(0,o.wy)((0,o._)("input",{type:"checkbox","onUpdate:modelValue":[e=>t.row.is_active=e,s=>{e.de_activate(t.row)}]},null,8,ns),[[j.e8,t.row.is_active]]),ds])])])),_:2},1024)):"sub_org_id"===s.name?((0,o.wg)(),(0,o.j4)(p,{key:1},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.sub_orgs_flattened[t.row[s.name]]),1)])),_:2},1024)):((0,o.wg)(),(0,o.j4)(p,{key:2},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)("null"===t.row[s.name]?"":t.row[s.name]),1)])),_:2},1024))],64)))),128))])),_:2},1032,["props","id"])])),_:1},8,["rows","columns","no-data-label"])])]),(0,o.Wm)(h,{showing:e.loading,class:"z-index-1"},{default:(0,o.w5)((()=>[cs])),_:1},8,["showing"]),(0,o.Wm)(w,{modelValue:e.show_edit_create,"onUpdate:modelValue":t[0]||(t[0]=t=>e.show_edit_create=t),persistent:"",onKeydown:t[1]||(t[1]=(0,j.D2)((t=>e.show_edit_create=!1),["esc"]))},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{selected_model:e.selected_row,api_key:e.api_key},null,8,["selected_model","api_key"])])),_:1},8,["modelValue"])],64)}const ms={key:0,class:"text-weight-bold"},ps={key:1,class:"text-weight-bold"},_s={class:"row q-mt-md"},hs={class:"col-2"},gs={class:"col-7"},ws={class:"col-3"},fs={class:"row q-mt-md"},ys={class:"col-2"},bs={class:"col-7"},vs=(0,o._)("div",{class:"col-3"},null,-1),ks={class:"row q-mt-md"},Es=(0,o._)("div",{class:"col-2"},null,-1),qs={class:"col-7"},Cs=(0,o._)("div",{class:"col-3"},null,-1),Os={class:"row q-mt-md"},Ts=(0,o._)("div",{class:"col-2"},null,-1),Ss={class:"col-7"},Ws=(0,o._)("div",{class:"col-3"},null,-1),xs={class:"row q-mt-md"},Vs=(0,o._)("div",{class:"col-2"},null,-1),Ls={class:"col-7"},$s=(0,o._)("div",{class:"col-3"},null,-1),Us={class:"row q-mt-md"},Is=(0,o._)("div",{class:"col-2"},null,-1),Ds={class:"col-7"},Rs=(0,o._)("div",{class:"col-3"},null,-1),Zs={class:"row q-mt-md"},Hs=(0,o._)("div",{class:"col-2"},null,-1),zs={class:"col-7"},Qs=(0,o._)("div",{class:"col-3"},null,-1),As=(0,o._)("img",{class:"loading-image",src:"loader.gif",alt:"Loading..."},null,-1);function Ps(e,t,s,i,a,r){const n=(0,o.up)("q-toolbar-title"),d=(0,o.up)("q-btn"),c=(0,o.up)("q-toolbar"),u=(0,o.up)("q-tooltip"),m=(0,o.up)("q-icon"),p=(0,o.up)("q-select"),_=(0,o.up)("q-input"),h=(0,o.up)("q-card-section"),g=(0,o.up)("q-inner-loading"),w=(0,o.up)("q-card"),f=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(w,{style:{width:"1200px","max-width":"1200px",height:"600px"}},{default:(0,o.w5)((()=>[(0,o._)("form",{onSubmit:t[10]||(t[10]=(0,j.iM)(((...t)=>e.submitFrom&&e.submitFrom(...t)),["prevent","stop"]))},[(0,o.Wm)(c,{class:"text-white secondary-toolbar"},{default:(0,o.w5)((()=>[(0,o.Wm)(n,null,{default:(0,o.w5)((()=>[e.row_id?((0,o.wg)(),(0,o.iD)("span",ms,(0,l.zw)(e.$t("pages.settings.master_data_lookup.edit_row")),1)):((0,o.wg)(),(0,o.iD)("span",ps,(0,l.zw)(e.$t("pages.settings.master_data_lookup.create_row")),1))])),_:1}),(0,o.wy)((0,o.Wm)(d,{flat:"",round:"",dense:"",icon:"close"},null,512),[[f]])])),_:1}),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o._)("div",_s,[(0,o._)("div",hs,[(0,o.Wm)(p,{modelValue:e.model["ftp_type"],"onUpdate:modelValue":t[0]||(t[0]=t=>e.model["ftp_type"]=t),outlined:"",options:e.ftp_types,label:e.$t("type")},{append:(0,o.w5)((()=>[e.errors["ftp_type"]?((0,o.wg)(),(0,o.j4)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"bg-red line-error-tooltip"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1},8,["modelValue","options","label"])]),(0,o._)("div",gs,[(0,o.Wm)(_,{modelValue:e.model["server"],"onUpdate:modelValue":t[1]||(t[1]=t=>e.model["server"]=t),label:e.$t("pages.import.server"),outlined:"",class:(0,l.C_)("full q-ml-sm")},{append:(0,o.w5)((()=>[e.errors["server"]?((0,o.wg)(),(0,o.j4)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"bg-red line-error-tooltip"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1},8,["modelValue","label"])]),(0,o._)("div",ws,[(0,o.Wm)(_,{modelValue:e.model["default_directory"],"onUpdate:modelValue":t[2]||(t[2]=t=>e.model["default_directory"]=t),label:e.$t("default_directory"),outlined:"","data-cy":"default_directory",class:"full q-ml-sm"},null,8,["modelValue","label"])])]),(0,o._)("div",fs,[(0,o._)("div",ys,[(0,o.Wm)(_,{modelValue:e.model["port"],"onUpdate:modelValue":t[3]||(t[3]=t=>e.model["port"]=t),label:e.$t("pages.import.port"),outlined:"","data-cy":"port",class:(0,l.C_)("full")},{append:(0,o.w5)((()=>[e.errors["port"]?((0,o.wg)(),(0,o.j4)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"bg-red line-error-tooltip"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1},8,["modelValue","label"])]),(0,o._)("div",bs,[(0,o.Wm)(_,{modelValue:e.model["username"],"onUpdate:modelValue":t[4]||(t[4]=t=>e.model["username"]=t),class:(0,l.C_)(["full q-ml-sm","full q-ml-sm"]),label:e.$t("username"),outlined:"","data-cy":"username"},{append:(0,o.w5)((()=>[e.errors["username"]?((0,o.wg)(),(0,o.j4)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"bg-red line-error-tooltip"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1},8,["modelValue","label"])]),vs]),(0,o._)("div",ks,[Es,(0,o._)("div",qs,[(0,o.Wm)(_,{modelValue:e.model["password"],"onUpdate:modelValue":t[5]||(t[5]=t=>e.model["password"]=t),type:"password",label:e.$t("pages.import.password"),outlined:"","data-cy":"password",class:(0,l.C_)("full q-ml-sm")},{append:(0,o.w5)((()=>[e.errors["password"]?((0,o.wg)(),(0,o.j4)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"bg-red line-error-tooltip"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1},8,["modelValue","label"])]),Cs]),(0,o._)("div",Os,[Ts,(0,o._)("div",Ss,[(0,o.Wm)(_,{modelValue:e.model["file_name_matching_patterns"],"onUpdate:modelValue":t[6]||(t[6]=t=>e.model["file_name_matching_patterns"]=t),label:e.$t("file_name_matching_patterns"),outlined:"","data-cy":"file_name_matching_patterns",class:"full q-ml-sm"},null,8,["modelValue","label"])]),Ws]),(0,o._)("div",xs,[Vs,(0,o._)("div",Ls,[(0,o.Wm)(p,{class:"full q-ml-sm",outlined:"",clearable:"",modelValue:e.model["sub_org_id"],"onUpdate:modelValue":t[7]||(t[7]=t=>e.model["sub_org_id"]=t),"use-input":"",options:e.filterSubOrgsList,onFilter:e.filterSubOrgslistEvent,label:e.$t("sub_organizations"),loading:e.sub_org_list_loading,"emit-value":"","map-options":""},null,8,["modelValue","options","onFilter","label","loading"])]),$s]),(0,o._)("div",Us,[Is,(0,o._)("div",Ds,[(0,o.Wm)(_,{class:(0,l.C_)(["full q-ml-sm","bg-disable"]),id:"apiKey",outlined:"",modelValue:e.api_key_ref,"onUpdate:modelValue":t[8]||(t[8]=t=>e.api_key_ref=t),readonly:"",label:e.$t("pages.import.token")},null,8,["modelValue","label"])]),Rs])])),_:1}),(0,o.Wm)(h,{class:"p-t-0"},{default:(0,o.w5)((()=>[(0,o._)("div",Zs,[Hs,(0,o._)("div",zs,[(0,o.Wm)(d,{type:"submit",color:"primary",class:"q-ml-sm float-right",label:e.$t("save")},null,8,["label"]),e.row_id?((0,o.wg)(),(0,o.j4)(d,{key:0,class:"q-ml-sm float-right",color:"primary",label:e.$t("test_connection"),onClick:t[9]||(t[9]=t=>e.checkConnection())},{default:(0,o.w5)((()=>[e.row_id?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(u,{key:0},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.$t("available_after_save")),1)])),_:1}))])),_:1},8,["label"])):(0,o.kq)("",!0),(0,o.wy)((0,o.Wm)(d,{class:"float-right highlighted-back",label:e.$t("cancel")},null,8,["label"]),[[f]])]),Qs])])),_:1})],32),(0,o.Wm)(g,{showing:e.loading,class:"z-index-1"},{default:(0,o.w5)((()=>[As])),_:1},8,["showing"])])),_:1})}var Ms=function(e,t,s,o){function l(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,i){function a(e){try{n(o.next(e))}catch(t){i(t)}}function r(e){try{n(o["throw"](e))}catch(t){i(t)}}function n(e){e.done?s(e.value):l(e.value).then(a,r)}n((o=o.apply(e,t||[])).next())}))};const Fs=(0,o.aZ)({el:"#app",mixins:[x.Z,V.Z],props:{selected_model:{},api_key:{type:String,default:""}},components:{},data(){return{}},setup(){const e=(0,mt.At)(),{ftp_types:t,subOrgList:s,sub_org_list_loading:o}=(0,ut.Jk)(e),l=(0,W.iH)(e.subOrgList);return{EMAIL_ENCRYPTION_KEY:(0,W.iH)(""),subOrgList:s,sub_org_list_loading:o,filterSubOrgsList:l,ftp_types:t,loading:(0,W.iH)(!1),model:(0,W.iH)({}),row_id:(0,W.iH)(""),errors:(0,W.iH)({}),api_key_ref:(0,W.iH)("")}},mounted:function(){const e="thi5i5@very5ecurehardc0d3denCrIp";if(void 0==e)throw"Missing EMAIL_ENCRYPTION_KEY env - unable to load";this.EMAIL_ENCRYPTION_KEY=e,this.initView(),window.aa=this},methods:{initView(){this.api_key_ref=this.api_key,this.row_id=this.selected_model.hasOwnProperty("id")?this.selected_model.id:"",this.model=JSON.parse(JSON.stringify(this.selected_model));for(let[e,t]of Object.entries(this.model))t||(this.model[e]="");this.model["server"]=this.model["server_url"],this.row_id||this.resetForm()},resetForm(){this.model={username:"",password:"",server:"",port:"22",default_directory:"",file_name_matching_patterns:"",ftp_type:"SFTP",sub_org_id:""}},submitFrom(){return Ms(this,void 0,void 0,(function*(){try{if(!this.validateForm())return;this.loading=!0;const e=yield ae.mX.ftpImportAddUpdate(this.prepareApiData());if(!e.success)throw e;e.hasOwnProperty("id")&&(this.row_id=e.id),this.showSuccessToast(this.$t("pages.messages.MSG_SAVE"));const t=new CustomEvent("ftp_import_updated",{detail:{}});document.dispatchEvent(t)}catch(e){const t=re.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},validateForm(){let e=!0;this.resetErrors();const t=["default_directory","file_name_matching_patterns","sub_org_id"];for(const[s,o]of Object.entries(this.model))t.includes(s)||o&&0!=String(o).length||(e=!1,this.errors[s]=!0);return e},prepareApiData(){this.encryptPassword();return{password:this.model.password,username:this.model.username,server:this.model.server,port:this.model.port,ftp_type:this.model.ftp_type,file_name_matching_patterns:this.model.file_name_matching_patterns,api_key:this.api_key,sub_org_id:this.model.sub_org_id,id:this.row_id,default_directory:this.model.default_directory}},encryptPassword(){var e=_t.cE.Utf8.parse(this.EMAIL_ENCRYPTION_KEY),t=_t.es.encrypt(this.model.password,e,{mode:_t.xJ.ECB,padding:_t.vk.PKCS7});return t},decryptPassword(e){var t=_t.cE.Utf8.parse(this.EMAIL_ENCRYPTION_KEY),s=_t.es.decrypt(e,t,{mode:_t.xJ.ECB});return s},updateFTPImportEvent(){const e=new CustomEvent("email_import_updated",{});document.dispatchEvent(e)},checkConnection(){return Ms(this,void 0,void 0,(function*(){try{if(!this.row_id)return;this.loading=!0;const e=yield ae.mX.ftpConnectionTest(this.row_id);if(!e||e.hasOwnProperty("success")&&!1===e.success)throw e;this.showSuccessToast(this.$t("test_connection_success"))}catch(e){const t=re.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},resetErrors(){for(const[e,t]of Object.entries(this.model))this.errors[e]=!1},filterSubOrgslistEvent(e,t,s){t(e?()=>{const t=e.toLowerCase();this.filterSubOrgsList=this.subOrgList.filter((e=>e.label.toLowerCase().indexOf(t)>-1))}:()=>{this.filterSubOrgsList=this.subOrgList})}}}),Ns=(0,H.Z)(Fs,[["render",Ps]]),js=Ns;M()(Fs,"components",{QCard:wt.Z,QToolbar:ft.Z,QToolbarTitle:yt.Z,QBtn:bt.Z,QCardSection:vt.Z,QSelect:A.Z,QIcon:kt.Z,QTooltip:Q.Z,QInput:z.Z,QInnerLoading:qt.Z}),M()(Fs,"directives",{ClosePopup:Ct.Z});var Ys=function(e,t,s,o){function l(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,i){function a(e){try{n(o.next(e))}catch(t){i(t)}}function r(e){try{n(o["throw"](e))}catch(t){i(t)}}function n(e){e.done?s(e.value):l(e.value).then(a,r)}n((o=o.apply(e,t||[])).next())}))};const Ks=(0,o.aZ)({mixins:[x.Z,V.Z,Bt],components:{EditCreate:js,ConnectionLogs:Yt},watch:{sub_org_list_loading(e,t){!1===e&&this.initView()}},mounted:function(){const e="thi5i5@very5ecurehardc0d3denCrIp";void 0!=e?(document.addEventListener("ftp_import_updated",this.emailImportUpdated),this.handleSubOrgs()):this.showErrorToast("Missing an important value - unable to load email import")},unmounted:function(){document.removeEventListener("ftp_import_updated",this.emailImportUpdated)},methods:{initView(){return Ys(this,void 0,void 0,(function*(){try{this.loading=!0,this.prepareColumns(),yield this.getAppKey(),this.flattenSubOrgs(),this.getList()}catch(e){const t=re.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},handleSubOrgs(){this.subOrgList.length>1&&this.initView(),this.sub_org_list_loading&&(this.loading=!0)},getList(){return Ys(this,void 0,void 0,(function*(){try{this.loading=!0,this.prepareColumns();const e=yield ae.mX.getFTPImport_List();if(0==e.data.length)return;this.prepareRows(e.data)}catch(e){const t=re.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},prepareRows(e){this.rows=[],Array.from(e).forEach((e=>{const t=e;this.addNewRow(t)}))},addNewRow(e){let t=Object.assign({},e);return this.rows.push(t),this.rows.length.toString()},createNewRecord(){this.selected_row={},this.show_edit_create=!0},emailImportUpdated(){this.show_edit_create=!1,this.getList()},editRow(e,t){this.selected_row=JSON.parse(JSON.stringify(t)),this.show_edit_create=!0},deleteClicked(e,t){return Ys(this,void 0,void 0,(function*(){try{this.loading=!0;const s=yield ae.mX.ftpImportDelete(t);!0===s.success&&this.rows.splice(e,1),this.showSuccessToast(this.$t("success"))}catch(s){const e=re.w.getErrorMessage(s);this.showErrorToast(e)}finally{this.loading=!1}}))},checkConnection(e){return Ys(this,void 0,void 0,(function*(){try{this.loading=!0;const t=yield ae.mX.ftpConnectionTest(e);if(!t||t.hasOwnProperty("success")&&!1===t.success)throw t;this.showSuccessToast(this.$t("test_connection_success"))}catch(t){const e=re.w.getErrorMessage(t);this.showErrorToast(e)}finally{this.loading=!1}}))},getAppKey(){return Ys(this,void 0,void 0,(function*(){try{this.loading=!0;const e={app_key:"FELLOW_DOC2"},t=yield ae.FT.getAppSubscription(e);this.api_key=t[0].token}catch(e){const t=re.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},de_activate(e){return Ys(this,void 0,void 0,(function*(){try{this.loading=!0;const t=e.id,s=e.is_active;yield ae.mX.setFTPImportActiveDeactive(t,s);this.showSuccessToast(this.$t("success"))}catch(t){const e=re.w.getErrorMessage(t);this.showErrorToast(e)}finally{this.loading=!1}}))},flattenSubOrgs(){this.subOrgList.forEach((e=>{this.sub_orgs_flattened[e.value]=e.label}))},prepareColumns(){this.columns=[],this.columns.push({name:"ftp_type",label:this.$t("type"),field:"ftp_type",align:"left"}),this.columns.push({name:"server_url",label:this.$t("server_url"),field:"server_url",align:"left"}),this.columns.push({name:"username",label:this.$t("username"),field:"username",align:"left"}),this.columns.push({name:"port",label:this.$t("port"),field:"port",align:"left"}),this.columns.push({name:"sub_org_id",label:this.$t("sub_organizations"),field:"sub_org_id",align:"left"}),this.columns.push({name:"default_directory",label:this.$t("default_directory"),field:"default_directory",align:"left"}),this.columns.push({name:"action",label:this.$t("action"),field:"action",align:"right"})}},setup(){const e=(0,mt.At)(),{subOrgList:t,sub_org_list_loading:s}=(0,ut.Jk)(e);let o=(0,W.iH)({});const l=(0,W.iH)(null);return{sub_org_list_loading:s,subOrgList:t,myForm:l,import_email:o,errors:(0,W.iH)({}),sub_orgs_flattened:(0,W.iH)({}),processing:(0,W.iH)(!1),ms_url:(0,W.iH)("https://microsoft.com/devicelogin"),ms_code:(0,W.iH)(""),ms_authenticate:(0,W.iH)(!1),ms_is_authenticated:(0,W.iH)(!1),ms_message:(0,W.iH)("Microsoft o365 is authenticated already."),loading:(0,W.iH)(!1),userDialog:(0,W.iH)(!1),columns:(0,W.iH)([]),rows:(0,W.iH)([]),show_edit_create:(0,W.iH)(!1),selected_row:(0,W.iH)({}),api_key:(0,W.iH)("")}},data(){return{}}}),Js=(0,H.Z)(Ks,[["render",us]]),Xs=Js;M()(Ks,"components",{QTable:At.Z,QBtn:bt.Z,QTr:Pt.Z,QTh:Mt.Z,QTd:Ft.Z,QTooltip:Q.Z,QInnerLoading:qt.Z,QDialog:Qt.Z});const Bs=(0,o.aZ)({el:"#app",components:{SubHeader:m.Z,BackToSettings:p.Z,PageRestriction:N,EmailImportList:os,FtpImportList:Xs},mounted:function(){this.getSubOrgsList()},setup(){const e=(0,mt.At)(),{getSubOrgsList:t}=e;return{getSubOrgsList:t}}});var Gs=s(27011),eo=s(60429),to=s(65869),so=s(62025);const oo=(0,H.Z)(Bs,[["render",u]]),lo=oo;M()(Bs,"components",{QList:Gs.Z,QExpansionItem:eo.Z,QSeparator:to.Z,QIcon:kt.Z,QSpace:so.Z,QCard:wt.Z,QCardSection:vt.Z})}}]);