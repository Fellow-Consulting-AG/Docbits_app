"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[390],{90390:(e,t,o)=>{o.r(t),o.d(t,{default:()=>lo});var a=o(59835),i=o(86970),s=o(61957);const n=e=>((0,a.dD)("data-v-d75bd49c"),e=e(),(0,a.Cn)(),e),l={class:"row q-pb-md"},r={class:"col-12 q-pl-sm q-mt-sm"},c={key:0,class:"row"},d={key:1,class:"row"},h={class:"po-container-parrent h-m-r-10",id:"po-container-parrent",style:{"border-right":"1px solid #9f9d9d"}},u={class:"row highlighted-back"},m={class:"po-nav-width q-pr-md row"},_={class:"q-mr-auto"},p=n((()=>(0,a._)("img",{width:"30",src:"back_new.svg"},null,-1))),g={style:{"vertical-align":"middle","margin-left":"10px","font-size":"20px",cursor:"pointer"}},f={class:"float-right mode-banner"},b={key:0,class:"table-mode mode-on"},w={key:0,class:"q-ml-auto"},y={class:"po-toggler-width"},v={key:0,class:"row ml-10"},O={class:"col-sm-12 col-md-12 col-lg-12 secondary-c-text"},k=(0,a.Uk)(" You can create line item table form po table just drag po table header and drop it on line item table. "),C={key:1,class:"row ml-10"},E={class:"col-sm-12 col-md-12 col-lg-12 secondary-c-text"},T=(0,a.Uk)(" You can create line item table form po table just drag po table header and drop it on line item table. "),D={class:"row ml-10 po-page-height scrolle-y"},P={class:"col-12 q-mb-md",id:"search-po"},I=["innerHTML"],x={class:"col-sm-12"},R={class:"full-width scrolle-y po-container back-white"},L={key:1,class:"row q-pa-sm"},A=n((()=>(0,a._)("div",{class:"q-mt-sm q-ma-sm"},null,-1))),q={class:"full-width scrolle-y"},S={class:"row back-white q-pa-sm"},N={class:"col-sm-12 col-md-12 col-lg-12 pr-6 row"},W={class:"q-mr-auto"},U={class:"q-ml-auto"},$={key:1,class:"q-pr-sm text-red-14"},j={class:"full-width back-white"},H={class:"po-image-container po-image-height q-pr-md",id:"po-image-container"},V=n((()=>(0,a._)("span",{class:"q-ml-sm"},"PO and AB are not same Please choose action.",-1))),Z={class:"q-ml-sm"},M={class:"q-ml-sm"},Q=n((()=>(0,a._)("img",{class:"loading-image",src:"loader.gif",alt:"Loading..."},null,-1)));function F(e,t,o,n,F,z){const B=(0,a.up)("MessageBanner"),K=(0,a.up)("ErrorDocumentView"),Y=(0,a.up)("q-icon"),J=(0,a.up)("q-btn"),G=(0,a.up)("DocumentAutoSaveNotify"),X=(0,a.up)("q-tooltip"),ee=(0,a.up)("exportBtn"),te=(0,a.up)("q-item-label"),oe=(0,a.up)("q-item-section"),ae=(0,a.up)("q-item"),ie=(0,a.up)("q-select"),se=(0,a.up)("q-tab"),ne=(0,a.up)("q-tabs"),le=(0,a.up)("q-separator"),re=(0,a.up)("PurchaseOrder"),ce=(0,a.up)("q-tab-panel"),de=(0,a.up)("q-tab-panels"),he=(0,a.up)("q-markup-table"),ue=(0,a.up)("LineItems"),me=(0,a.up)("ImageComponent"),_e=(0,a.up)("keyboardShortcutInfo"),pe=(0,a.up)("q-card-actions"),ge=(0,a.up)("q-card"),fe=(0,a.up)("q-dialog"),be=(0,a.up)("q-avatar"),we=(0,a.up)("q-card-section"),ye=(0,a.up)("f-btn"),ve=(0,a.up)("q-inner-loading"),Oe=(0,a.up)("PurchaseOrderPreview"),ke=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[e.isReadOnly?((0,a.wg)(),(0,a.j4)(B,{key:0,message:e.error_message,messageCategoryClass:"error-banner"},null,8,["message"])):(0,a.kq)("",!0),(0,a._)("div",l,[(0,a._)("div",r,[e.doc_fetch_error?((0,a.wg)(),(0,a.iD)("div",c,[(0,a.Wm)(K)])):((0,a.wg)(),(0,a.iD)("div",d,[(0,a._)("div",h,[(0,a._)("div",u,[(0,a._)("div",m,[(0,a._)("div",_,[!1===e.ext_table_train?((0,a.wg)(),(0,a.j4)(J,{key:0,flat:"",rounded:"",color:"primary",onClick:t[0]||(t[0]=e=>this.$router.back()),class:"po_iterateable_item"},{default:(0,a.w5)((()=>[(0,a.Wm)(Y,{class:"text-red-13",size:"sm"},{default:(0,a.w5)((()=>[p])),_:1}),(0,a._)("label",g,(0,i.zw)(e.$t("back")),1)])),_:1})):(0,a.kq)("",!0),(0,a._)("span",f,[e.allowPOTableDrag?((0,a.wg)(),(0,a.iD)("span",b,(0,i.zw)(e.$t("po_table_drag_mode")),1)):(0,a.kq)("",!0)])]),e.isReadOnly?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",w,[(0,a.Wm)(G),(0,a.Wm)(J,{id:"help_po_btn",round:"",color:"info",padding:"xs",onClick:e.goToHelp,icon:"info",class:"q-ma-sm po_iterateable_item"},{default:(0,a.w5)((()=>[(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("help")),1)])),_:1})])),_:1},8,["onClick"]),(0,a.Wm)(J,{id:"keyboard_po_btn",round:"",color:"positive",padding:"xs",onClick:t[1]||(t[1]=t=>e.showKeyboardShortcuts=!0),icon:"keyboard",class:"q-ma-sm po_iterateable_item"},{default:(0,a.w5)((()=>[(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("keyboard_shortcut")),1)])),_:1})])),_:1}),(0,a.Wm)(J,{id:"po_training_mode_btn",round:"",color:!0===e.allowPOTableDrag?"red":"grey",padding:"xs",onClick:t[2]||(t[2]=t=>e.allowPOTableDrag=!0!==e.allowPOTableDrag),icon:"backup_table",class:"q-ma-sm po_iterateable_item"},{default:(0,a.w5)((()=>[(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[!0===e.allowPOTableDrag?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a.Uk)((0,i.zw)(e.$t("po_training_mode_off")),1)],64)):((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a.Uk)((0,i.zw)(e.$t("po_training_mode_on")),1)],64))])),_:1})])),_:1},8,["color"]),(0,a.Wm)(J,{id:"auto_po_match_btn",round:"",color:"amber-7",padding:"xs",onClick:e.autoPoMatch,icon:"autorenew",class:"q-ma-sm po_iterateable_item"},{default:(0,a.w5)((()=>[(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("auto_po_match")),1)])),_:1})])),_:1},8,["onClick"]),!0===e.ext_table_train?((0,a.wg)(),(0,a.j4)(J,{key:0,round:"",color:"secondary",padding:"xs",onClick:t[3]||(t[3]=t=>e.saveExtAppData(!0)),icon:"save",class:"q-ma-sm po_iterateable_item"},{default:(0,a.w5)((()=>[(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("pages.screen2a.save")),1)])),_:1})])),_:1})):((0,a.wg)(),(0,a.j4)(J,{key:1,id:"save_po_btn",round:"",color:"secondary",padding:"xs",onClick:t[4]||(t[4]=t=>e.saveData()),icon:"save",class:"q-ma-sm po_iterateable_item"},{default:(0,a.w5)((()=>[(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("pages.screen2a.save")),1)])),_:1})])),_:1})),e.isReadOnly?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(ee,{key:2}))]))]),(0,a._)("div",y,[(0,a.Wm)(J,{round:"",icon:e.togglerIcon,size:"xs",class:"po-image-toggler text-grey-6 bg-white po_iterateable_item",onClick:t[5]||(t[5]=t=>e.togglePoImage())},null,8,["icon"])])]),e.allowPOTableDrag?((0,a.wg)(),(0,a.iD)("div",v,[(0,a._)("div",O,[(0,a.Wm)(Y,{name:"info",size:"sm"}),k])])):(0,a.kq)("",!0),e.allowPOTableDrag?((0,a.wg)(),(0,a.iD)("div",C,[(0,a._)("div",E,[(0,a.Wm)(Y,{name:"info",size:"sm"}),T])])):(0,a.kq)("",!0),(0,a._)("div",D,[(0,a._)("div",P,[(0,a.Wm)(ie,{dense:"",outlined:"","use-input":"","emit-value":"","map-options":"",tabindex:"0","input-debounce":"0","hide-dropdown-icon":"",disable:e.isReadOnly,modelValue:e.po_search_keyword,"onUpdate:modelValue":[t[6]||(t[6]=t=>e.po_search_keyword=t),e.getSelectedPOitems],options:e.po_number_options,onFilter:e.searchPurchaseOrderList,label:e.$t("search_po_label"),class:"back-white po_iterateable_item max-width-500 q-ml-auto q-mr-auto"},{option:(0,a.w5)((t=>[(0,a.Wm)(ae,(0,i.vs)((0,a.F4)(t.itemProps)),{default:(0,a.w5)((()=>[(0,a.Wm)(oe,null,{default:(0,a.w5)((()=>[(0,a.Wm)(te,null,{default:(0,a.w5)((()=>[(0,a._)("span",{innerHTML:e.displayPONumbersAsOption(t.opt.label)},null,8,I)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),append:(0,a.w5)((()=>[e.po_search&&""!=e.po_search?((0,a.wg)(),(0,a.j4)(Y,{key:0,name:"close",onClick:(0,s.iM)(e.clearSearch,["stop"]),class:"cursor-pointer"},null,8,["onClick"])):(0,a.kq)("",!0)])),_:1},8,["disable","modelValue","options","onFilter","onUpdate:modelValue","label"])]),(0,a._)("div",x,[(0,a._)("div",R,[e.hasPoItems?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a.Wm)(ne,{modelValue:e.tab,"onUpdate:modelValue":t[7]||(t[7]=t=>e.tab=t),class:"text-black text-weight-bold po-tabs"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.po_items,((t,o)=>((0,a.wg)(),(0,a.j4)(se,{draggable:"false",class:"po-tab",key:o,name:o,"data-name":o,label:o,tabindex:"0"},{default:(0,a.w5)((()=>[(0,a.Wm)(Y,{class:"q-pl-sm",name:"fa fa-times",onClick:t=>e.proceedToCloseTab(o)},{default:(0,a.w5)((()=>[(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(this.isDeleteAble(o)?e.$t("delete"):e.$t("tab_not_deletable")),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1032,["name","data-name","label"])))),128))])),_:1},8,["modelValue"]),(0,a.Wm)(le),(0,a.Wm)(de,{modelValue:e.tab,"onUpdate:modelValue":t[8]||(t[8]=t=>e.tab=t)},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.po_items,((t,o)=>((0,a.wg)(),(0,a.j4)(ce,{key:o,name:o},{default:(0,a.w5)((()=>[(0,a.Wm)(re,{apiData:e.record,po_lines:t,po_number:o,allowPOTableDrag:e.allowPOTableDrag},null,8,["apiData","po_lines","po_number","allowPOTableDrag"])])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue"])],64)):((0,a.wg)(),(0,a.iD)("div",L,[(0,a.Wm)(he,{class:"full-width"},{default:(0,a.w5)((()=>[(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,(0,i.zw)(e.$t("no_po_line_items_found")),1)])])])),_:1})]))]),A,(0,a._)("div",q,[(0,a._)("div",S,[(0,a._)("div",N,[(0,a._)("div",W,(0,i.zw)(e.$t("pages.settings."+e.record.doc_type)),1),(0,a._)("div",U,[(0,a.Wm)(Y,{name:"drag_indicator",class:"float-right secondary-c-text-grey text-h6"}),"PO_CONVERTED_TABLE"===e.table_name?((0,a.wg)(),(0,a.j4)(Y,{key:0,name:"delete",class:"float-right secondary-c-text-grey text-h6 cursor-pointer",onClick:t[9]||(t[9]=t=>e.delete_table_confirmation=!0)},{default:(0,a.w5)((()=>[(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("delete_table")),1)])),_:1})])),_:1})):(0,a.kq)("",!0),"PO_CONVERTED_TABLE"===e.table_name?((0,a.wg)(),(0,a.iD)("span",$,(0,i.zw)(e.$t("pages.messages.TABLE_FORMED_BY_PO")),1)):(0,a.kq)("",!0)])])]),(0,a.Wm)(le),(0,a._)("div",j,[(0,a.Wm)(ue,{allowPOTableDrag:e.allowPOTableDrag},null,8,["allowPOTableDrag"])])])])])]),(0,a._)("div",H,[(0,a.Wm)(me,{renderOpenWindoIcon:!0,docName:e.record.filename,docImages:e.record.images},null,8,["docName","docImages"])])]))])]),(0,a.Wm)(fe,{modelValue:e.showKeyboardShortcuts,"onUpdate:modelValue":t[11]||(t[11]=t=>e.showKeyboardShortcuts=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(ge,null,{default:(0,a.w5)((()=>[(0,a.Wm)(_e),(0,a.Wm)(pe,{align:"right"},{default:(0,a.w5)((()=>[(0,a.Wm)(J,{flat:"",color:"primary",label:e.$t("conclude"),class:"float-right",style:{"font-weight":"900"},onClick:t[10]||(t[10]=t=>e.showKeyboardShortcuts=!1)},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(fe,{modelValue:e.confirmDecision,"onUpdate:modelValue":t[14]||(t[14]=t=>e.confirmDecision=t),persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(ge,null,{default:(0,a.w5)((()=>[(0,a.Wm)(we,{class:"row items-center"},{default:(0,a.w5)((()=>[(0,a.Wm)(be,{icon:"info",color:"primary","text-color":"white"}),V])),_:1}),(0,a.Wm)(pe,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(J,{flat:"",label:"Cancel",color:"primary"},null,512),[[ke]]),(0,a.wy)((0,a.Wm)(J,{flat:"",label:"Close PO",color:"primary",onClick:t[12]||(t[12]=t=>e.setPOStatus("close"))},null,512),[[ke]]),(0,a.wy)((0,a.Wm)(J,{flat:"",label:"Accept",color:"primary",onClick:t[13]||(t[13]=t=>e.setPOStatus("accept"))},null,512),[[ke]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(fe,{modelValue:e.delete_tab_confirmation,"onUpdate:modelValue":t[17]||(t[17]=t=>e.delete_tab_confirmation=t),persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(ge,null,{default:(0,a.w5)((()=>[(0,a.Wm)(we,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,a.w5)((()=>[(0,a.Wm)(be,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,a.Wm)(we,{class:"row items-center"},{default:(0,a.w5)((()=>[(0,a._)("span",Z,(0,i.zw)(e.$t("delete_po_tab")),1)])),_:1}),(0,a.Wm)(pe,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(ye,{appearance:"cancel",label:e.$t("cancel"),onClick:t[15]||(t[15]=t=>e.delete_tab_po_number="")},null,8,["label"]),[[ke]]),(0,a.wy)((0,a.Wm)(ye,{"data-cy":"done",label:e.$t("proceed"),onClick:t[16]||(t[16]=t=>e.deletePoTab())},null,8,["label"]),[[ke]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(fe,{modelValue:e.delete_table_confirmation,"onUpdate:modelValue":t[19]||(t[19]=t=>e.delete_table_confirmation=t),persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(ge,null,{default:(0,a.w5)((()=>[(0,a.Wm)(we,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,a.w5)((()=>[(0,a.Wm)(be,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,a.Wm)(we,{class:"row items-center"},{default:(0,a.w5)((()=>[(0,a._)("span",M,(0,i.zw)(e.$t("delete_po_tab")),1)])),_:1}),(0,a.Wm)(pe,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(ye,{appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[ke]]),(0,a.wy)((0,a.Wm)(ye,{"data-cy":"done",label:e.$t("proceed"),onClick:t[18]||(t[18]=t=>e.deleteLineTable())},null,8,["label"]),[[ke]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(ve,{class:"main-loader",showing:e.processing},{default:(0,a.w5)((()=>[Q])),_:1},8,["showing"]),(0,a.Wm)(fe,{modelValue:e.po_preview,"onUpdate:modelValue":t[20]||(t[20]=t=>e.po_preview=t),persistent:"","full-width":""},{default:(0,a.w5)((()=>[(0,a.Wm)(Oe,{po_preview_columns:e.po_preview_columns,po_lines:e.po_preview_items,po_number:e.po_search,onClearSearch:e.clearSearch,onAddToPoItemsList:e.addToPoItemsList},null,8,["po_preview_columns","po_lines","po_number","onClearSearch","onAddToPoItemsList"])])),_:1},8,["modelValue"])],64)}var z=o(39981),B=o.n(z),K=o(7363),Y=o(49990),J=o(44173),G=o(92603),X=o(67325),ee=o(60499),te=o(60899),oe=o(33725),ae=o(77997);const ie=(0,a.Uk)("Select as po Match"),se=(0,a.Uk)("Quit"),ne=["src","onPointerover","onPointerleave"],le={key:0},re={key:1},ce={class:"row q-pa-sm pr-12"},de=(0,a._)("div",{style:{width:"74%"}},null,-1),he={style:{width:"26%"}},ue={style:{float:"right"}},me={class:"row q-pa-sm pr-12"},_e=(0,a._)("div",{style:{width:"74%"}},null,-1),pe={style:{width:"26%"}},ge={style:{float:"right"}},fe={class:"row q-pa-sm pr-12"},be={style:{width:"74%"}},we={style:{width:"26%"}},ye={style:{float:"right"}},ve={class:"q-ml-sm"},Oe={class:"q-ml-sm"},ke={class:"text-h6"},Ce={class:"text-h6"};function Ee(e,t,o,s,n,l){const r=(0,a.up)("q-tooltip"),c=(0,a.up)("q-icon"),d=(0,a.up)("q-th"),h=(0,a.up)("q-tr"),u=(0,a.up)("q-item-section"),m=(0,a.up)("q-item"),_=(0,a.up)("q-list"),p=(0,a.up)("q-menu"),g=(0,a.up)("q-btn"),f=(0,a.up)("q-td"),b=(0,a.up)("q-input"),w=(0,a.up)("q-table"),y=(0,a.up)("q-spinner"),v=(0,a.up)("q-markup-table"),O=(0,a.up)("q-card-section"),k=(0,a.up)("q-card-actions"),C=(0,a.up)("q-card"),E=(0,a.up)("q-dialog"),T=(0,a.up)("q-avatar"),D=(0,a.up)("f-btn"),P=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[((0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["row q-pa-sm",!0===this.allowPOTableDrag?"po_table_drop_target":""]),key:e.renderKey},[e.hasLineItems()?((0,a.wg)(),(0,a.j4)(w,{key:0,rows:e.tableRows,columns:e.tableColumns,"row-key":"id","table-header-style":{backgroundColor:"#d4d4d4"},style:{overflow:"scroll",height:"auto","max-height":"400px"},"no-data-label":e.$t("pages.messages.NO_RECORD_FOUND"),"rows-per-page-options":[0],id:"line_item_table",class:(0,i.C_)(["text-uppercase","PO_CONVERTED_TABLE"===e.table_name?"sticky-column-table":""])},{header:(0,a.w5)((t=>[(0,a.Wm)(h,{props:t,class:"highlighted-back"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.cols,(o=>((0,a.wg)(),(0,a.j4)(d,{key:o.name,props:t},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(o.label)+" ",1),o.error?((0,a.wg)(),(0,a.j4)(c,{key:0,title:e.$t("pages.screen2b.in_valid_column_error"),name:"priority_high",class:"headerError"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("pages.screen2b.in_valid_column_error")),1)])),_:1})])),_:1},8,["title"])):(0,a.kq)("",!0)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,a.w5)((t=>[(0,a.Wm)(h,{props:t,"data-id":t.key,class:"droptarget line-item-tr po_iterateable_item cursor-pointer",tabindex:"0"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.cols,(o=>((0,a.wg)(),(0,a.iD)(a.HY,{key:o.name},[(0,a.Wm)(p,{"touch-position":"","context-menu":""},{default:(0,a.w5)((()=>[(0,a.Wm)(_,{dense:"",style:{"min-width":"100px"}},{default:(0,a.w5)((()=>[(0,a.wy)(((0,a.wg)(),(0,a.j4)(m,{clickable:"",onClick:o=>e.addToPoMatchedList(t.key)},{default:(0,a.w5)((()=>[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[ie])),_:1})])),_:2},1032,["onClick"])),[[P]])])),_:2},1024),(0,a.wy)(((0,a.wg)(),(0,a.j4)(m,{clickable:""},{default:(0,a.w5)((()=>[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[se])),_:1})])),_:1})),[[P]])])),_:2},1024),""===o.label?((0,a.wg)(),(0,a.j4)(f,{key:0,class:"secondary-c-text"},{default:(0,a.w5)((()=>[e.isPurchaseOrderConnected(t.key)?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a.Wm)(c,{size:"sm",tabindex:"0",class:"cursor-pointer",onFocus:o=>e.showlineHighlighted(t.key),onBlur:o=>e.removedLineHighlight(t.key)},{default:(0,a.w5)((()=>[(0,a._)("img",{width:"20",src:e.getConnectionSvg(t.key),onPointerover:o=>e.showlineHighlighted(t.key),onPointerleave:o=>e.removedLineHighlight(t.key)},null,40,ne),(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.getConnectionTitle(t.key))+" "+(0,i.zw)(e.getConnectionStatusDetails(t.key)),1)])),_:2},1024)])),_:2},1032,["onFocus","onBlur"]),e.is_po_view?((0,a.wg)(),(0,a.j4)(g,{key:0,flat:"",tabindex:"0",color:"blue",onClick:o=>e.removePOConnection(t.key),icon:"fa fa-times"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("remove_po_connection")),1)])),_:1})])),_:2},1032,["onClick"])):(0,a.kq)("",!0)],64)):(0,a.kq)("",!0)])),_:2},1024)):"Actions"===o.label?((0,a.wg)(),(0,a.j4)(f,{key:1,class:"secondary-c-text"},{default:(0,a.w5)((()=>["PO_CONVERTED_TABLE"===e.table_name?((0,a.wg)(),(0,a.j4)(c,{key:0,name:"delete",class:"float-right secondary-c-text-grey text-h6 cursor-pointer",onClick:o=>e.deleteLine(t.key)},{default:(0,a.w5)((()=>[(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("delete")),1)])),_:1})])),_:2},1032,["onClick"])):(0,a.kq)("",!0)])),_:2},1024)):e.isColumnVisible(o.org_index,o)?((0,a.wg)(),(0,a.j4)(f,{key:2,"data-id":t.key,id:"input_"+o.name+"_"+t.key},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{tabindex:"-1","data-id":t.key,class:(0,i.C_)("input-field "),borderless:"",readonly:"PO_CONVERTED_TABLE"!==e.table_name,modelValue:e.lineDataObj[t.key]["columns"][o.name].formatted_value,"onUpdate:modelValue":a=>e.lineDataObj[t.key]["columns"][o.name].formatted_value=a,onChange:a=>e.inputValueChanges(o.name,t.key)},null,8,["data-id","readonly","modelValue","onUpdate:modelValue","onChange"])])),_:2},1032,["data-id","id"])):(0,a.kq)("",!0)],64)))),128))])),_:2},1032,["props","data-id"])])),_:1},8,["rows","columns","no-data-label","class"])):((0,a.wg)(),(0,a.j4)(v,{key:1,class:"full-width"},{default:(0,a.w5)((()=>[(0,a._)("thead",null,[!1===e.lineItemsloading?((0,a.wg)(),(0,a.iD)("tr",le,[(0,a._)("th",null,(0,i.zw)(e.$t("no_line_items_found")),1)])):(0,a.kq)("",!0),!0===e.lineItemsloading?((0,a.wg)(),(0,a.iD)("tr",re,[(0,a._)("th",null,[(0,a.Wm)(y,{color:"primary",size:"3em",thickness:10})])])):(0,a.kq)("",!0)])])),_:1}))],2)),e.hasLineItems()?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a._)("div",ce,[de,(0,a._)("div",he,[(0,a._)("span",null,(0,i.zw)(e.$t("recorded_bookings"))+": ",1),(0,a._)("span",ue,(0,i.zw)(e.total_net_amount),1)])]),(0,a._)("div",me,[_e,(0,a._)("div",pe,[(0,a._)("span",null,(0,i.zw)(e.$t("matched_total"))+": ",1),(0,a._)("span",ge,(0,i.zw)(e.matched_total_amount),1)])]),(0,a._)("div",fe,[(0,a._)("div",be,[e.amount_error?((0,a.wg)(),(0,a.j4)(c,{key:0,flat:"",dense:"",name:"error",size:"20px",color:"red",class:"q-ml-sm",style:{float:"right"}},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("total_amount_not_equal_to_line_items")),1)])),_:1})])),_:1})):(0,a.kq)("",!0)]),(0,a._)("div",we,[(0,a._)("span",null,(0,i.zw)(e.$t("unsettled_amount"))+": ",1),(0,a._)("span",ye,(0,i.zw)(e.pending_amount),1)])])],64)):(0,a.kq)("",!0),(0,a.Wm)(E,{modelValue:e.confirmDialog,"onUpdate:modelValue":t[0]||(t[0]=t=>e.confirmDialog=t),persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Wm)(O,{class:"row items-center"},{default:(0,a.w5)((()=>[(0,a._)("span",ve,(0,i.zw)(e.$t("line_items_connection_overwrite")),1)])),_:1}),(0,a.Wm)(k,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(g,{flat:"",label:"Cancel",color:"primary"},null,512),[[P]]),(0,a.Wm)(g,{flat:"",label:"Connect anyway",color:"primary",onClick:e.removeExistingAndConnectNewPO},null,8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(E,{modelValue:e.poEditRestrictDialog,"onUpdate:modelValue":t[3]||(t[3]=t=>e.poEditRestrictDialog=t),persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Wm)(O,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,a.w5)((()=>[(0,a.Wm)(T,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,a.Wm)(O,{class:"row items-center"},{default:(0,a.w5)((()=>[(0,a._)("span",Oe,(0,i.zw)(e.poEditRestrictMessage),1)])),_:1}),!0!==e.apiData.ext_table_train?((0,a.wg)(),(0,a.j4)(k,{key:0,align:"right"},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{flat:"",label:e.$t("dashboard"),color:"primary",onClick:t[1]||(t[1]=t=>e.goToDashboard())},null,8,["label"]),(0,a.Wm)(g,{flat:"",label:e.$t("table_extraction_view"),color:"primary",onClick:t[2]||(t[2]=t=>e.goTolineItemsPage())},null,8,["label"])])),_:1})):(0,a.kq)("",!0)])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(E,{modelValue:e.connectConfirmation,"onUpdate:modelValue":t[6]||(t[6]=t=>e.connectConfirmation=t),persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Wm)(O,null,{default:(0,a.w5)((()=>[(0,a._)("div",ke,(0,i.zw)(e.$t("confirm")),1)])),_:1}),(0,a.Wm)(O,{class:"q-pt-none"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("pages.messages.CONNECTION_MISMATCHED",{properties:this.misMatchedProperties})),1)])),_:1}),(0,a.Wm)(k,{align:"right"},{default:(0,a.w5)((()=>[(0,a.Wm)(D,{appearance:"cancel",label:e.$t("cancel"),onClick:t[4]||(t[4]=t=>e.connectConfirmation=!1)},null,8,["label"]),(0,a.Wm)(D,{label:e.$t("proceed"),onClick:t[5]||(t[5]=t=>{e.connectConfirmation=!1,e.proceedMakingConnection(e.currentItemId)})},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(E,{modelValue:e.showOverrideTableConfirm,"onUpdate:modelValue":t[9]||(t[9]=t=>e.showOverrideTableConfirm=t),persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Wm)(O,null,{default:(0,a.w5)((()=>[(0,a._)("div",Ce,(0,i.zw)(e.$t("confirm")),1)])),_:1}),(0,a.Wm)(O,{class:"q-pt-none"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("pages.messages.TABLE_OVERRIDE_CONFIRM")),1)])),_:1}),(0,a.Wm)(k,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(D,{appearance:"cancel",label:e.$t("cancel"),onClick:t[7]||(t[7]=t=>e.cancelTableDrop())},null,8,["label"]),[[P]]),(0,a.wy)((0,a.Wm)(D,{label:e.$t("proceed"),onClick:t[8]||(t[8]=t=>e.prepareTableFromDropedSource())},null,8,["label"]),[[P]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var Te=o(38126),De=o(70501),Pe=o(96427),Ie=o(15877),xe=o(11494),Re=o(3650),Le=o(46624);let Ae=new Map;const qe=(0,a.aZ)({el:"#app",mixins:[De.Z,Y.Z,Re.Z],props:{allowPOTableDrag:{type:Boolean,default:!1}},components:{},data(){return{docId:"",po_dragging:!1,dragging_data:{},coveredLineItem:[],validation_done:!0,po_connected_line_items:{},connected_line_item:"",confirmDialog:(0,ee.iH)(!1),renderKey:0,is_po_view:!1,dropdownColumns:[],misMatchedProperties:""}},mounted:function(){document.addEventListener("init_line_items",this.lineItemDataLoaded),this.isViewPo(),window.lineItemsPoV3=this,document.addEventListener("dragover",this.dragover),document.addEventListener("drop",this.drop),document.addEventListener("keydown",this.keyDownEvent)},unmounted:function(){document.removeEventListener("init_line_items",this.lineItemDataLoaded),document.removeEventListener("dragover",this.dragover),document.removeEventListener("drop",this.drop),document.removeEventListener("keydown",this.keyDownEvent)},methods:{dragover(e){e.preventDefault()},drop(e){if(e.preventDefault(),!e.target)return;let t=e.target;if(!0===this.allowPOTableDrag){let e=!1;return t.classList.contains("po_table_drop_target")&&(e=!0),!e&&t.closest(".po_table_drop_target")&&(e=!0),void(e&&(this.hasLineItems()?this.showOverrideTableConfirm=!0:this.prepareTableFromDropedSource()))}let o=e.target.dataset.id,a=Te.Z.getItem("Text");Te.Z.remove("Text");var i=e.target.closest("tr");if(("tr"!=t.tagName||"droptarget"!=t.className)&&i&&i.className&&"droptarget"==i.className&&(o=i.dataset.id),!a||!o)return;let s=JSON.parse(a);this.makeConnection(o,s)},prepareTableFromDropedSource(){let e=Te.Z.getItem("DRAG_PO_NUMBER");Te.Z.remove("DRAG_PO_NUMBER"),this.tableConversionHandler(e)},cancelTableDrop(){Te.Z.remove("DRAG_PO_NUMBER");const e=new CustomEvent("table_drag_mode_flag_update",{detail:!0});document.dispatchEvent(e)},makeConnection(e,t){if(!e)return;if(this.coveredLineItem=this.lineDataObj[e],this.dragging_data=t,this.targetItem={},!this.coveredLineItem)return;let o=["UNIT_PRICE","QUANTITY","TOTAL_AMOUNT","ITEM_NUMBER","SUPPLIER_ITEM_NUMBER","PURCHASE_ORDER","NET_AMOUNT"];for(let[i,[s,n]]of Object.entries(Object.entries(this.coveredLineItem.columns)))o.includes(s)&&(this.targetItem[s]={formatted:Object(n).formatted_value,value:Object(n).value});if(this.targetItem["UUID"]={formatted:this.coveredLineItem.id,value:this.coveredLineItem.id},!this.targetItem.UUID.formatted)return;let{connection_status:a}=this.setPoConnectionStatus(this.targetItem,t);"success"===a?this.proceedMakingConnection(e):(this.currentItemId=e,this.connectConfirmation=!0)},proceedMakingConnection(e){if(this.po_connected_line_items.hasOwnProperty(e))return this.confirmDialog=!0,void(this.connected_line_item=e);this.connectNewPORecord(),this.renderKey++},dragenter(e){var t=e.target.closest("tr");"tr"==e.target.tagName&&"droptarget"==e.target.className||t&&t.className&&t.className},lineItemDataLoaded(e){if(!e||!e.detail)return;this.lineItemsloading=!1;let t=e.detail;this.resetRows(),this.apiData=t,this.docId=this.apiData&&this.apiData.doc_id?this.apiData.doc_id:"",this.refactorApiData()},resetRows(){this.tableRows=[],this.lineDataObj=[]},refactorApiData(){this.is_ai_table=this.isAI_TableExit(this.apiData),this.setFormatOptions(),this.table_name=this.apiData.tables&&this.apiData.tables.length>0&&this.apiData.tables[0].hasOwnProperty("name")?this.apiData.tables[0].name:"",this.prepareTableLayoutObj(),this.prepareTableRowsAndRowObj(),this.prepareTableColumn(),this.validateLineItemColumns(),this.restrictPOEditIfNotValidated(),this.setConnectedLineItems()},setFormatOptions(){this.formatting_options={},this.apiData.tables&&this.apiData.tables.length>0&&this.apiData.tables[0].hasOwnProperty("formatting_options")&&(this.formatting_options=this.apiData.tables[0].formatting_options),!this.formatting_options||this.formatting_options.hasOwnProperty("columns_to_hide")&&Array.isArray(this.formatting_options.columns_to_hide)||(this.formatting_options.columns_to_hide=[]),!this.formatting_options||this.formatting_options.hasOwnProperty("mapping")&&null!==this.formatting_options.mapping||(this.formatting_options.mapping={})},prepareTableLayoutObj(){this.dropdownColumns=[];let e={};this.lineItemLayout={},this.apiData.tables&&this.apiData.tables.length>0&&this.apiData.tables[0].hasOwnProperty("layout")&&Array.from(this.apiData.tables[0].layout).forEach((t=>{e.hasOwnProperty(t.column_name)||0!=t.is_hidden||(e[t.column_name]=!0,t["lbl_to_display"]=this.$t("pages.line_items_columns."+t.translation_key)==="pages.line_items_columns."+t.translation_key?t.title:this.$t("pages.line_items_columns."+t.translation_key),this.lineItemLayout[t.column_name]=t,this.dropdownColumns.push({header:t.lbl_to_display,techName:t.column_name}))}))},prepareTableRowsAndRowObj(){this.tableRows=[],this.lineDataObj=[];let e={};this.apiData.tables&&0!=this.apiData.tables.length&&this.apiData.tables[0].hasOwnProperty("rows")&&0!=this.apiData.tables[0].rows.length&&(Array.from(this.apiData.tables[0].rows).forEach((t=>{if(!1===t.is_deleted){let o={};e[t.id]=JSON.parse(JSON.stringify(t)),e[t.id].locations_list=[],t.locations_list&&Array.from(t.locations_list).forEach((o=>{e[t.id].locations_list["page_"+o.page]=o})),delete e[t.id].columns,e[t.id]["columns"]=[],Array.from(t.columns).forEach((a=>{e[t.id].columns[a.name]=JSON.parse(JSON.stringify(a)),e[t.id].columns[a.name].locations_list=[],a.locations_list&&Array.from(a.locations_list).forEach((o=>{e[t.id].columns[a.name].locations_list["page_"+o.page]=o})),(0,Pe.Jp)(a.formatted_value)&&(a.formatted_value=""),o[a.name]=a.formatted_value,Ae.has(a.name)?!1===Ae.get(a.name)&&a.formatted_value&&null!=a.formatted_value&&""!=a.formatted_value&&Ae.set(a.name,!0):a.formatted_value&&null!=a.formatted_value&&""!=a.formatted_value?Ae.set(a.name,!0):Ae.set(a.name,!1)})),o["id"]=t.id,this.tableRows.push(o)}})),Object.assign(this.lineDataObj,e))},prepareTableColumn(){this.tableColumns=[];let e=[],t=[],o={name:"id",field:"id",align:"left",label:"",is_mapped:!1,org_index:""};this.tableColumns.push(o);let a={};if(this.apiData.tables&&this.apiData.tables.length>0&&this.apiData.tables[0].hasOwnProperty("rows")){Array.from(this.apiData.tables[0].rows).forEach((o=>{Array.from(o.columns).forEach((i=>{let s=this.isColumnHidden(o,i);if(s&&!a.hasOwnProperty(i.name)){a[i.name]=!0;let o=i.name;this.lineItemLayout.hasOwnProperty(i.name)&&(o=this.lineItemLayout[i.name].lbl_to_display);let s="";null!=i.org_index&&void 0!=i.org_index&&(s=String(i.org_index));let n={name:i.name,field:i.name,align:"left",label:o,is_mapped:!!i.is_mapped&&i.is_mapped,org_index:""!==s?s:""};i.hasOwnProperty("org_index")&&null!=i.org_index?t.push(n):e[i.name]=n}}))}));for(let o of Object.keys(this.lineItemLayout))e.hasOwnProperty(o)&&(t.push(Object.assign({},e[o])),delete e[o]);if(e.lenght>0)for(let o of e)t.push(Object.assign({},e[o]));Array.from(t).forEach(((e,t)=>{Ae.has(e.name)&&!0===Ae.get(e.name)&&this.tableColumns.push(Object.assign({},e))})),"PO_CONVERTED_TABLE"===this.table_name&&(o={name:"action_column",field:"action_column",align:"left",label:"Actions",is_mapped:!1,org_index:""},this.tableColumns.push(o))}},isColumnHidden(e,t){let o="";null!=t.org_index&&void 0!=t.org_index&&(o=String(t.org_index));let a=!0;return""!==o&&(a=this.isColumnVisible(o,t)),a},isColumnVisible(e,t){let o=!0;return e&&this.formatting_options&&0!=this.formatting_options.columns_to_hide.length?((this.formatting_options.columns_to_hide.includes(e)||"UUID"==t.name)&&(o=!1),o):o},validateLineItemColumns(){let e=!1;if(void 0===this.tableColumns)return;for(const o of this.tableColumns){let t=this.isColumnNameValid(o);t||(o.error=!0,e=!0)}let t=!e;this.validation_done!==t&&(this.validation_done=t)},isColumnNameValid(e){let t=!1;for(const o of this.dropdownColumns)if(e.name===o.techName||"id"==e.name||"action_column"==e.name){t=!0;break}return t},hasOriginalIndex(e,t){let o=!1;return""!==e&&(o=!0),o},restrictPOEditIfNotValidated(){this.is_po_view&&(this.validation_done&&this.hasLineItems()||(this.validation_done||(this.poEditRestrictMessage=this.$t("po_restrict_message_not_mapped")),this.hasLineItems()&&(this.poEditRestrictDialog=!0)))},isPurchaseOrderConnected(e){return!!this.po_connected_line_items.hasOwnProperty(e)},connectNewPORecord(){let{connection_status:e,connection_details:t}=this.setPoConnectionStatus(this.targetItem,this.dragging_data),o={invoice_table_line_id:this.targetItem.UUID.value,connection_status:e,connection_details:t,po_line_id:this.dragging_data.id,unit_price:this.targetItem.UNIT_PRICE?this.targetItem.UNIT_PRICE.value:"",quantity:this.targetItem.QUANTITY.value,total_amount:this.targetItem.TOTAL_AMOUNT?this.targetItem.TOTAL_AMOUNT.value:"",net_amount:this.targetItem.NET_AMOUNT?this.targetItem.NET_AMOUNT.value:""};for(let[a,i]of Object.entries(this.dragging_data))oe.O1.includes(a)&&(o[a]=null===i?"":String(i));o["currency_format"]="en_US",this.po_connected_line_items[this.targetItem.UUID.formatted]=o,this.dispatchConnectionSuccessEvent(o)},getLineItemQuantity(e){let t="quantity",o=this.apiData.doc_type+"_QUANTITY_COL";const a=(0,Ie.$8)(o);return void 0!==a&&""!==a&&(t=a),String(e[t])},getLineItemQuantityColumn(){let e="quantity",t=this.apiData.doc_type+"_QUANTITY_COL";const o=(0,Ie.$8)(t);return void 0!==o&&""!==o&&(e=o),e},setPoConnectionStatus(e,t){let o=[],a="",i="";const s=this.getLineItemQuantityColumn(),n=t.hasOwnProperty(s+"_value")?t[s+"_value"]:t.quantityColName,l=e.QUANTITY.value,r=t.hasOwnProperty("unit_price_value")?t.unit_price_value:t.unit_price;if(a="success",this.notEqual(n,l)&&(a="mismatch",o.push(this.$t("quantity"))),e.hasOwnProperty("PURCHASE_ORDER")&&t.hasOwnProperty("purchase_order_number")){const i=e.PURCHASE_ORDER.value,s=t.purchase_order_number;i&&s&&this.notEqual(i,s)&&(a="mismatch",o.push(this.$t("purchase_order_number")))}else e.hasOwnProperty("PURCHASE_ORDER")&&(a="mismatch",o.push(this.$t("purchase_order_number")));if(e.hasOwnProperty("SUPPLIER_ITEM_NUMBER")&&t.hasOwnProperty("supplier_item_id")){const i=e.SUPPLIER_ITEM_NUMBER.value,s=t.supplier_item_id;i&&s&&this.notEqual(i,s)&&(a="mismatch",o.push(this.$t("pages.screen2a.supplier_number")))}else if(e.hasOwnProperty("ITEM_NUMBER")&&t.hasOwnProperty("item_id")){const i=e.ITEM_NUMBER.value,s=t.item_id;i&&s&&this.notEqual(i,s)&&(a="mismatch",o.push(this.$t("pages.screen2a.item_number")))}else a="mismatch",o.push(this.$t("pages.screen2a.supplier_number")+" / "+this.$t("pages.screen2a.item_number"));if("INVOICE"==this.apiData.doc_type||"ORDER_CONFIRMATION"==this.apiData.doc_type){const t=e.UNIT_PRICE.value;this.notEqual(r,t)&&(a="mismatch",o.push(this.$t("unit_price")))}return this.misMatchedProperties=o.join(", "),i=this.misMatchedProperties,{connection_status:a,connection_details:i}},notEqual(e,t){return e=e.replace(/\s/g,"").toLowerCase(),t=t.replace(/\s/g,"").toLowerCase(),e!=t},dispatchConnectionSuccessEvent(e){const t=new CustomEvent("po_connection_add",{detail:{data:e}});document.dispatchEvent(t)},removeExistingAndConnectNewPO(){this.confirmDialog=!1;let e=this.po_connected_line_items.hasOwnProperty(this.connected_line_item)?this.po_connected_line_items[this.connected_line_item]:{};this.dispatchConnectionRemoveEvent(e),delete this.po_connected_line_items[this.connected_line_item],this.connectNewPORecord()},dispatchConnectionRemoveEvent(e){const t=new CustomEvent("po_connection_remove",{detail:{data:e}});document.dispatchEvent(t)},convertToUSValue(e){return e.replace(/,/g,".")},mouseMoveHandler(e){this.po_dragging&&this.validation_done&&this.wait},getConnectionInfo(e){let t={};return t=this.po_connected_line_items.hasOwnProperty(e)?this.po_connected_line_items[e]:{},t},getConnectedinfoAttribute(e,t){let o=this.getConnectionInfo(e);return o&&0!==Object.keys(o).length?o[t]:{}},setConnectedLineItems(){this.po_connected_line_items={};let e=this.getConnectedLineItems();if(0!=e.length)for(let[t,o]of e.entries())this.po_connected_line_items[o.invoice_table_line_id]=o},getConnectedLineItems(){let e=[];return this.apiData?(this.apiData.hasOwnProperty("po_matched")&&(e=this.apiData.po_matched),e):e},removePOConnection(e){let t=this.po_connected_line_items.hasOwnProperty(e)?this.po_connected_line_items[e]:{};this.dispatchConnectionRemoveEvent(t),delete this.po_connected_line_items[e],this.renderKey++},hasLineItems(){return!(!this.tableRows||0===Object.keys(this.tableRows).length)},isViewPo(){this.$route.fullPath.match(/po-matching/g)&&(this.is_po_view=!0)},showlineHighlighted(e){let t=this.getConnectionInfo(e);if(!t||0===Object.keys(t).length)return;const o=new CustomEvent("show_line_highlighted",{detail:t});document.dispatchEvent(o)},removedLineHighlight(e){let t=this.getConnectionInfo(e);if(!t||0===Object.keys(t).length)return;const o=new CustomEvent("removed_highlight",{detail:t});document.dispatchEvent(o)},keyDownEvent(e){if("v"===e.key&&e.ctrlKey&&this.hasLineItems()){e.preventDefault();let t=document.activeElement;if(!t||!t.classList.contains("droptarget"))return;this.drop(e)}else if(e.ctrlKey&&"l"===e.key){e.preventDefault();const t=(0,J.$)("#line_item_table").querySelectorAll(".line-item-tr");if(0==t.length)return;let o=t[0];o.contentEditable="true",o.focus(),o.contentEditable="false"}},goTolineItemsPage(){this.removeCache(),this.is_ai_table?this.$router.push("/field_validation_v1/"+this.apiData.doc_id):this.$router.push("/tbl_ext_v3/"+this.apiData.doc_id)},goToDashboard(){this.$router.push("/dashboard")},tableConversionHandler(e){try{this.callApiForTableConversion(e)}catch(t){return void this.showErrorToast("Error while displaying Page")}},callApiForTableConversion(e){const t=new CustomEvent("convert_pline_to_ltable",{detail:e});document.dispatchEvent(t)},dispatchEventToSaveTableChanges(){const e=new CustomEvent("update_table_data",{detail:this.apiData.tables});document.dispatchEvent(e)},inputValueChanges(e,t){"PO_CONVERTED_TABLE"===this.table_name&&setTimeout((()=>{this.lineDataObj[t]["columns"][e].value=this.lineDataObj[t]["columns"][e].formatted_value,this.updateJsonForLineItems(e,t)}),0)},updateJsonForLineItems(e,t){Array.from(this.apiData.tables[0].rows).forEach(((o,a)=>{t===o.id&&Array.from(o.columns).forEach(((t,a)=>{t.name!==e||(this.apiData.tables[0].rows[a].columns[a]=this.lineDataObj[o.id].columns[e])}))})),this.dispatchEventToSaveTableChanges()},deleteLine(e){Array.from(this.apiData.tables[0].rows).forEach(((t,o)=>{e===t.id&&(t.is_deleted=!0)}));let t=this.po_connected_line_items.hasOwnProperty(e)?this.po_connected_line_items[e]:{};this.removePOConnection(e);const o=new CustomEvent("delete_table_line",{detail:{tables:this.apiData.tables,connection_info:t}});document.dispatchEvent(o)},getConnectionStatus(e){return this.getConnectedinfoAttribute(e,"connection_status")},getConnectionStatusDetails(e){return this.getConnectedinfoAttribute(e,"connection_details")},getConnectionSvg(e){const t=this.getConnectionStatus(e);return"success"==t?"link.svg":"mismatch"==t?"broken-link.svg":"line_item_only"==t?"broken-link-self.svg":void 0},getConnectionTitle(e){const t=this.getConnectionStatus(e);return"success"==t?this.$t("po_connected_match"):"mismatch"==t?this.$t("po_connected_mismatch"):"line_item_only"==t?this.$t("po_connected_self"):void 0},addToPoMatchedList(e){let t={item_id:null,po_line_id:null,line_number:null,purchase_order_id:null,currency_format:"en_US",invoice_table_line_id:e,connection_status:"line_item_only",unit_price:this.lineDataObj[e].columns.UNIT_PRICE?this.lineDataObj[e].columns.UNIT_PRICE.value:null,quantity:this.lineDataObj[e].columns.QUANTITY?this.lineDataObj[e].columns.QUANTITY.value:null,total_amount:this.lineDataObj[e].columns.TOTAL_AMOUNT?this.lineDataObj[e].columns.TOTAL_AMOUNT.value:null,purchase_order_number:this.lineDataObj[e].columns.PURCHASE_ORDER?this.lineDataObj[e].columns.PURCHASE_ORDER.value:null,supplier_item_id:this.lineDataObj[e].columns.SUPPLIER_ITEM_NUMBER?this.lineDataObj[e].columns.SUPPLIER_ITEM_NUMBER.value:null,description:this.lineDataObj[e].columns.DESCRIPTION?this.lineDataObj[e].columns.DESCRIPTION.value:null,unit_code:this.lineDataObj[e].columns.UNIT?this.lineDataObj[e].columns.UNIT.value:null,currency:this.lineDataObj[e].columns.CURRENCY?this.lineDataObj[e].columns.CURRENCY.value:null,org_id:(0,xe.Y4)("org_id")};this.po_connected_line_items[e]=t;const o=new CustomEvent("po_connection_success",{detail:{data:t}});document.dispatchEvent(o),this.renderKey++}},setup(){let e=[],t={};const o=(0,Le.H_)(),{removeCache:a,isAI_TableExit:i}=o,s=(0,Le.Yb)(),{total_net_amount:n,pending_amount:l,matched_total_amount:r,amount_error:c}=(0,K.Jk)(s);return{amount_error:c,total_net_amount:n,pending_amount:l,matched_total_amount:r,removeCache:a,isAI_TableExit:i,is_ai_table:(0,ee.iH)(!1),poEditRestrictDialog:(0,ee.iH)(!1),poEditRestrictMessage:(0,ee.iH)(""),lineItemsloading:(0,ee.iH)(!0),tableColumns:(0,ee.iH)(e),tableRows:(0,ee.iH)(e),apiData:(0,ee.iH)(e),table_name:(0,ee.iH)(""),currentItemId:(0,ee.iH)(),lineDataObj:(0,ee.iH)(e),targetItem:(0,ee.iH)(t),lineItemLayout:(0,ee.iH)(e),formatting_options:(0,ee.iH)(t),connectConfirmation:(0,ee.iH)(!1),showOverrideTableConfirm:(0,ee.iH)(!1)}}});var Se=o(7683),Ne=o(61450),We=o(31233),Ue=o(21682),$e=o(22857),je=o(46858),He=o(56362),Ve=o(13246),Ze=o(490),Me=o(76749),Qe=o(67220),Fe=o(68879),ze=o(13119),Be=o(66933),Ke=o(13902),Ye=o(32074),Je=o(44458),Ge=o(63190),Xe=o(11821),et=o(61357),tt=o(32045),ot=o(18149),at=o(62146),it=o(69984),st=o.n(it);const nt=(0,Se.Z)(qe,[["render",Ee]]),lt=nt;st()(qe,"components",{QTable:Ne.Z,QTr:We.Z,QTh:Ue.Z,QIcon:$e.Z,QTooltip:je.Z,QMenu:He.Z,QList:Ve.Z,QItem:Ze.Z,QItemSection:Me.Z,QTd:Qe.Z,QBtn:Fe.Z,QInput:ze.Z,QMarkupTable:Be.Z,QSpinner:Ke.Z,QDialog:Ye.Z,QCard:Je.Z,QCardSection:Ge.Z,QCardActions:Xe.Z,QAvatar:et.Z,QBtnDropdown:tt.Z,QField:ot.Z}),st()(qe,"directives",{ClosePopup:at.Z});var rt=o(37744),ct=o(9008),dt=o(53199),ht=o(20334),ut=o(69542),mt=o(73683),_t=o(49782);const pt={class:"text-weight-medium text-h6"},gt={class:"bg-grey-3"},ft={class:"text-left",style:{"font-weight":"bold"}},bt={class:"text-left",style:{"font-weight":"900"}},wt=(0,a._)("tr",null,[(0,a._)("td",{class:"text-left",style:{"font-weight":"bold"}},"Move between items (Generic)"),(0,a._)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,a._)("span",{class:"shortcut-Key-box"}," TAB ")])],-1),yt=(0,a._)("tr",null,[(0,a._)("td",{class:"text-left",style:{"font-weight":"bold"}},"Move between items (specific to po Items)"),(0,a._)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,a._)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,a.Uk)(" + "),(0,a._)("span",{class:"shortcut-Key-box q-ml-sm"}," m ")])],-1),vt=(0,a._)("tr",null,[(0,a._)("td",{class:"text-left",style:{"font-weight":"bold"}},"To Select or click a item"),(0,a._)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,a._)("span",{class:"shortcut-Key-box"}," ENTER ")])],-1),Ot=(0,a._)("tr",null,[(0,a._)("td",{class:"text-left",style:{"font-weight":"bold"}},"Open Help"),(0,a._)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,a._)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,a.Uk)(" + "),(0,a._)("span",{class:"shortcut-Key-box q-ml-sm"}," h ")])],-1),kt={class:"text-left",style:{"font-weight":"bold"}},Ct=(0,a._)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,a._)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,a.Uk)(" + "),(0,a._)("span",{class:"shortcut-Key-box q-ml-sm"}," k ")],-1),Et=(0,a._)("tr",null,[(0,a._)("td",{class:"text-left",style:{"font-weight":"bold"}},"Enable/Disable PO traning mode"),(0,a._)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,a._)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,a.Uk)(" + "),(0,a._)("span",{class:"shortcut-Key-box q-ml-sm"}," d ")])],-1),Tt=(0,a._)("tr",null,[(0,a._)("td",{class:"text-left",style:{"font-weight":"bold"}},"Auto PO match"),(0,a._)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,a._)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,a.Uk)(" + "),(0,a._)("span",{class:"shortcut-Key-box q-ml-sm"}," a ")])],-1),Dt=(0,a._)("tr",null,[(0,a._)("td",{class:"text-left",style:{"font-weight":"bold"}},"Save PO"),(0,a._)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,a._)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,a.Uk)(" + "),(0,a._)("span",{class:"shortcut-Key-box q-ml-sm"}," s ")])],-1),Pt=(0,a._)("tr",null,[(0,a._)("td",{class:"text-left",style:{"font-weight":"bold"}},"Export PO"),(0,a._)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,a._)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,a.Uk)(" + "),(0,a._)("span",{class:"shortcut-Key-box q-ml-sm"}," e ")])],-1),It=(0,a._)("tr",null,[(0,a._)("td",{class:"text-left",style:{"font-weight":"bold"}},"Search PO"),(0,a._)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,a._)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,a.Uk)(" + "),(0,a._)("span",{class:"shortcut-Key-box q-ml-sm"}," f ")])],-1),xt=(0,a._)("tr",null,[(0,a._)("td",{class:"text-left",style:{"font-weight":"bold"}},"Selecting first row of PO items "),(0,a._)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,a._)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,a.Uk)(" + "),(0,a._)("span",{class:"shortcut-Key-box q-ml-sm"}," p ")])],-1),Rt=(0,a._)("tr",null,[(0,a._)("td",{class:"text-left",style:{"font-weight":"bold"}},"Selecting first row of Line items "),(0,a._)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,a._)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,a.Uk)(" + "),(0,a._)("span",{class:"shortcut-Key-box q-ml-sm"}," l ")])],-1),Lt=(0,a._)("tr",null,[(0,a._)("td",{class:"text-left",style:{"font-weight":"bold"}},"To connect a PO line with the line item."),(0,a._)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,a._)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,a.Uk)(" + "),(0,a._)("span",{class:"shortcut-Key-box q-ml-sm"}," C ")])],-1),At=(0,a._)("tr",null,[(0,a._)("td",{class:"text-left",style:{"font-weight":"bold"}},"To Connect PO Line with line item"),(0,a._)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,a._)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,a.Uk)(" + "),(0,a._)("span",{class:"shortcut-Key-box q-ml-sm"}," V ")])],-1);function qt(e,t,o,s,n,l){const r=(0,a.up)("q-card-section"),c=(0,a.up)("q-markup-table");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[(0,a._)("div",pt,(0,i.zw)(e.$t("keyboard_shortcuts")),1)])),_:1}),(0,a.Wm)(r,{class:"v-p-0"},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{class:"full-width",style:{overflow:"scroll","max-height":"60vh"},"virtual-scroll":""},{default:(0,a.w5)((()=>[(0,a._)("thead",null,[(0,a._)("tr",gt,[(0,a._)("th",ft,(0,i.zw)(e.$t("action")),1),(0,a._)("th",bt,(0,i.zw)(e.$t("keyboard_shortcut")),1)])]),(0,a._)("tbody",null,[wt,yt,vt,Ot,(0,a._)("tr",null,[(0,a._)("td",kt,(0,i.zw)(e.$t("doc2light.descriptions.check_keyboard_shortcut")),1),Ct]),Et,Tt,Dt,Pt,It,xt,Rt,Lt,At])])),_:1})])),_:1})],64)}const St=(0,a.aZ)({el:"#app",mixins:[],props:{},components:{},data(){return{}},setup(){return{}}}),Nt=(0,Se.Z)(St,[["render",qt]]),Wt=Nt;st()(St,"components",{QCardSection:Ge.Z,QMarkupTable:Be.Z});const Ut={class:"q-ml-sm"},$t=(0,a._)("img",{class:"loading-image",src:"loader.gif",alt:"Loading..."},null,-1);function jt(e,t,o,s,n,l){const r=(0,a.up)("q-tooltip"),c=(0,a.up)("q-btn"),d=(0,a.up)("export-dialog"),h=(0,a.up)("q-dialog"),u=(0,a.up)("q-avatar"),m=(0,a.up)("q-card-section"),_=(0,a.up)("f-btn"),p=(0,a.up)("autoAccountingBtn"),g=(0,a.up)("q-card-actions"),f=(0,a.up)("q-card"),b=(0,a.up)("q-inner-loading"),w=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(c,{round:"",color:"amber-9",padding:"xs",id:"export_po_btn",onClick:t[0]||(t[0]=t=>e.confirmAndExport()),icon:"import_export",class:"q-ma-sm po_iterateable_item"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("confirm_export")),1)])),_:1})])),_:1}),(0,a.Wm)(h,{modelValue:e.display_config_dialog,"onUpdate:modelValue":t[1]||(t[1]=t=>e.display_config_dialog=t),position:"top",class:"export-dialog",persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(d)])),_:1},8,["modelValue"]),(0,a.Wm)(h,{modelValue:e.confirm_amount_difference,"onUpdate:modelValue":t[3]||(t[3]=t=>e.confirm_amount_difference=t),persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(f,null,{default:(0,a.w5)((()=>[(0,a.Wm)(m,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,a.Wm)(m,{class:"row items-center",style:{"justify-content":"center",display:"flex"}},{default:(0,a.w5)((()=>[(0,a._)("span",Ut,(0,i.zw)(e.$t("amount_pending_message")),1)])),_:1}),(0,a.Wm)(g,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(_,{appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[w]]),(0,a.Wm)(p,{show_icon_btn:!1}),(0,a.wy)((0,a.Wm)(_,{label:e.$t("run_anyway"),onClick:t[2]||(t[2]=t=>e.validateConfigurationAndExport())},null,8,["label"]),[[w]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(b,{showing:e.export_config_processing},{default:(0,a.w5)((()=>[$t])),_:1},8,["showing"])],64)}var Ht=o(63225),Vt=o(43066),Zt=o(60937),Mt=o(43572),Qt=o(12757),Ft=function(e,t,o,a){function i(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function n(e){try{r(a.next(e))}catch(t){s(t)}}function l(e){try{r(a["throw"](e))}catch(t){s(t)}}function r(e){e.done?o(e.value):i(e.value).then(n,l)}r((a=a.apply(e,t||[])).next())}))};const zt=(0,a.aZ)({el:"#app",mixins:[De.Z,Y.Z,Vt.Z,Zt.Z,Ht.Z],props:{enableExportButton:Boolean,isValidationView:{type:Boolean,default:!1}},components:{ExportDialog:Mt.Z,autoAccountingBtn:Qt.Z},watch:{config_saved:{handler:function(e,t){!0===t&&!1===e||(this.display_config_dialog=!1)}}},data(){return{docId:"",allowedDoctypes:oe.rf}},mounted:function(){window.addEventListener("beforeunload",this.onTabClose),this.docId=this.$route.params.id},unmounted:function(){window.removeEventListener("beforeunload",this.onTabClose)},methods:{routeToDashboard(){window.removeEventListener("beforeunload",this.onTabClose),this.releaseDocLock({doc_id:this.record.doc_id}),this.$router.push("/dashboard")},validateConfigurationAndExport(){return Ft(this,void 0,void 0,(function*(){const e=yield this.hasActionAcquiredLock();if(!e)return;let t;try{let e=new FormData;e.append("doc_type",this.record.doc_type);let o=yield(0,rt.O_)();const a=yield B().post(rt.hi.export_configuration_existence,e,{headers:{Authorization:o}});t=a.data.valid}catch(o){return void this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}t?this.exportData().catch():this.display_config_dialog=!0}))},exportData(){return Ft(this,void 0,void 0,(function*(){let e,t=this.record;this.display_config_dialog=!1,this.showLoading(),t.hasOwnProperty("table_data_copy")&&delete t["table_data_copy"];try{this.removeAllNotifications();let o=new FormData;o.append("data",JSON.stringify(t));let a=yield(0,rt.O_)();e=yield B().post(rt.hi.validate_and_export+this.docId,o,{headers:{Authorization:a}})}catch(o){this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}finally{this.hideLoading()}if(!0===e.data.success)return yield this.dashboardFiltersAfterExport(),void this.routeToDashboard()}))},onTabClose(e){let t=Te.Z.has("event_name")?Te.Z.getItem("event_name"):null;t&&"language_change"===t||(e.preventDefault(),e.returnValue="",this.clearSelectedSessionStorage())},confirmAndExport(){try{this.amount_error=!1;let e=parseFloat(this.pending_amount.replace(/[^0-9]/g,""));if(this.pending_amount&&""!=this.pending_amount&&e>0)return this.confirm_amount_difference=!0,void(this.amount_error=!0);this.validateConfigurationAndExport()}catch(e){}}},setup(){const e=(0,Le.H_)(),{record:t,doctype:o,language_origin:a,notifications:i}=(0,K.Jk)(e),s=(0,Le.TB)(),{hasActionAcquiredLock:n,releaseDocLock:l}=s,r=(0,Le.Fl)(),{display_config_dialog:c,processing:d,config_saved:h}=(0,K.Jk)(r),u=(0,Le.Ln)(),{dashboardFiltersAfterExport:m}=u,_=(0,Le.Yb)(),{pending_amount:p,amount_error:g}=(0,K.Jk)(_);return{amount_error:g,pending_amount:p,dashboardFiltersAfterExport:m,record:t,doctype:o,language_origin:a,notifications:i,releaseDocLock:l,exportButtonWidth:(0,ee.iH)("61"),hasActionAcquiredLock:n,display_config_dialog:c,export_config_processing:d,config_saved:h,confirm_amount_difference:(0,ee.iH)(!1)}}});var Bt=o(60854);const Kt=(0,Se.Z)(zt,[["render",jt]]),Yt=Kt;st()(zt,"components",{QBtn:Fe.Z,QTooltip:je.Z,QDialog:Ye.Z,QCard:Je.Z,QCardSection:Ge.Z,QAvatar:et.Z,QCardActions:Xe.Z,QInnerLoading:Bt.Z}),st()(zt,"directives",{ClosePopup:at.Z});var Jt=function(e,t,o,a){function i(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function n(e){try{r(a.next(e))}catch(t){s(t)}}function l(e){try{r(a["throw"](e))}catch(t){s(t)}}function r(e){e.done?o(e.value):i(e.value).then(n,l)}r((a=a.apply(e,t||[])).next())}))};dt.Z.table.arrowUp="arrow_drop_down";const Gt=(0,a.aZ)({el:"#app",mixins:[Y.Z,G.Z],components:{LineItems:lt,PurchaseOrder:ut.Z,MessageBanner:ct.Z,ImageComponent:ht["default"],ErrorDocumentView:mt.Z,PurchaseOrderPreview:_t.Z,keyboardShortcutInfo:Wt,exportBtn:Yt},data(){return{docId:"",imageObjStr:"",error_message:"",poFieldValue:(0,ee.iH)(""),poElements:[],isReadOnly:(0,ee.iH)(!1),warning_alert:{},currentPoElementIndex:(0,ee.iH)(0),debounceAutoSaveFunc:{},allowedDoctypes:oe.rf}},mounted(){this.docId=this.$route.params.id,this.record=[],this.init(),document.addEventListener("po_connection_success",this.lineItemConnected),document.addEventListener("po_connection_remove",this.lineItemPOConnectionRemoved),document.addEventListener("table_drag_mode_flag_update",this.TableDragModeHandler),document.addEventListener("update_table_data",this.updateTableDataForSave),document.addEventListener("delete_table_line",this.deleteTableLine),document.addEventListener("convert_pline_to_ltable",this.triggerTableConversion),document.addEventListener("keydown",this.keyDownEvent),this.debounceAutoSaveFunc=(0,te.Z)((()=>{this.saveDataOnChanges()}),1e3),this.poElements=document.getElementsByClassName("po_iterateable_item"),window.vpo=this},unmounted:function(){document.removeEventListener("po_connection_success",this.lineItemConnected),document.removeEventListener("po_connection_remove",this.lineItemPOConnectionRemoved),document.removeEventListener("keydown",this.keyDownEvent),document.removeEventListener("table_drag_mode_flag_update",this.TableDragModeHandler),document.removeEventListener("update_table_data",this.updateTableDataForSave),document.removeEventListener("delete_table_line",this.deleteTableLine),document.removeEventListener("convert_pline_to_ltable",this.triggerTableConversion)},computed:{hasPoItems:function(){return this.po_items&&0!==Object.keys(this.po_items).length}},methods:{init(){return Jt(this,void 0,void 0,(function*(){try{if(this.processing=!0,this.isDocForExtTraining(),!0===this.ext_table_train)yield this.getExtAppPODocumentByID(this.docId);else{if(yield this.getDocumentById(this.docId),!this.record||0===Object.keys(this.record).length||!1===this.record.success)return;this.handleReadOnly()}this.handleReadOnlyAlert(),this.imageObjStr=JSON.stringify(this.record.images),yield this.getPOColumns(),this.ShowStaticPO(),this.getFieldValues(),this.initPage(),this.record.hasOwnProperty("po_matched")&&this.record.po_matched.length?this.isExportDisabled=!1:this.isExportDisabled=!0}catch(e){if(null!=e&&"object"==typeof e&&e.hasOwnProperty("message"))return void this.showErrorToast(e.message);this.showErrorToast("Error while displaying Page. Please reload again or contact admistrator")}finally{this.processing=!1}}))},isDocForExtTraining(){return Jt(this,void 0,void 0,(function*(){if(!this.$route.params.ext_table_train||"true"!==this.$route.params.ext_table_train)return;this.ext_table_train=!0,this.docId=String(this.$route.query.id);const e=String(this.$route.query.token);yield this.setAuthToken(e)}))},getToken(){return Jt(this,void 0,void 0,(function*(){let e=this.token&&null!=this.token&&""!=this.token?this.token:yield(0,rt.O_)();return e}))},handleReadOnlyAlert(){if(0==this.record.editable){let e="po_readonly_doc_warning";oe.at.includes(this.record.status)&&(e="po_finished_doc_warning"),"error"===this.record.status&&(e="po_error_doc_warning"),this.warning_alert=this.showWarningAlert(this.$t(e))}},handleReadOnly(){if(oe.at.includes(this.record.status))return void(this.isReadOnly=!0);const e=X.W1.hasAccess("update");e||(this.isReadOnly=!0),this.isReadOnly&&(this.error_message=this.$t("pages.messages.READ_ONLY_MSG"))},initLineItems(){const e=new CustomEvent("init_line_items",{detail:this.record});document.dispatchEvent(e)},initPage(){this.record&&this.record.fields&&(this.connect(),this.table_name=this.record.tables&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("name")?this.record.tables[0].name:"",this.setViewEditable(),this.setDataToCache(),this.initLineItems(),this.renderMultiplePOItems(),this.getPoFieldValue(),this.setTotallineItem(),this.calculateMatchedTotal())},setViewEditable(){this.record.editable=!0,(oe.at.includes(this.record.status)||"error"==this.record.status)&&(this.record.editable=!1)},saveExtAppData(e=!1){return Jt(this,void 0,void 0,(function*(){try{e&&(this.processing=!0);const t=yield this.saveExtAppDocument(this.docId);if(!1===t.success)return void this.showErrorToast(t.message);e&&this.showSuccessToast(this.$t("pages.messages.MSG_SAVE"))}catch(t){this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}finally{this.processing=!1}}))},validationsForExportData(){"ORDER_CONFIRMATION"==this.record.doc_type?this.record.po_matched.forEach((e=>{"success"!=e.connection_status&&(this.confirmDecision=!0)})):this.saveData()},setPOStatus(e){this.record["po_status"]=e,this.saveData()},saveData(e=!0){return Jt(this,void 0,void 0,(function*(){try{e&&(this.processing=!0);const t=yield this.saveDocument(this.docId);if(!1===t.success){if(t.message)throw{message:t.message};throw{}}e&&this.showSuccessToast(this.$t("pages.messages.MSG_SAVE"))}catch(t){this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}finally{this.processing=!1}}))},goToExtractionTableView(){this.$router.push("/tbl_ext_v3/"+this.$route.params.id)},ShowStaticPO(){this.$route.fullPath.match(/PO/g)&&(this.record.showStaticPo="4002513646")},lineItemConnected(e){this.record&&(this.record.hasOwnProperty("po_matched")||(this.record.po_matched=[]),this.record.po_matched.push(e.detail.data),this.isExportDisabled=!1,this.debounceAutoSaveFunc())},lineItemPOConnectionRemoved(e){if(!this.record||!this.record.hasOwnProperty("po_matched"))return;let t=e.detail.data,o=null;for(let[a,i]of this.record.po_matched.entries())t.invoice_table_line_id==i.invoice_table_line_id&&(o=a);null!=o&&(this.record.po_matched.splice(o,1),this.record.po_matched.lenght>0?this.isExportDisabled=!1:this.isExportDisabled=!0,this.debounceAutoSaveFunc())},getFieldValues(){for(let e of this.record.fields)this.get_fields.hasOwnProperty(e.name)&&(this.get_fields[e.name]=e.formatted_value);this.record.showStaticPo&&(this.get_fields["purchase_order"]=this.record.showStaticPo)},renderMultiplePOItems(){return Jt(this,void 0,void 0,(function*(){try{let e={};e=this.getPurchaseOrderData();for(let[t,o]of Object.entries(e))this.addToPoItems(t,o);e&&0!==Object.keys(e).length||(this.addPoItemsFromHeaderPO(),yield this.addPoItemsFromLineItemsPO()),this.cleanupPoMatched()}catch(e){}}))},fetchAddPoItems(e){return Jt(this,void 0,void 0,(function*(){if(this.po_items[e])return;let t=yield this.getPOitems(e);this.addToPoItems(e,t,!0)}))},addPoItemsFromHeaderPO(){this.get_fields["purchase_order"]&&this.fetchAddPoItems(this.get_fields["purchase_order"])},addPoItemsFromLineItemsPO(){return Jt(this,void 0,void 0,(function*(){if(!this.record.tables||0==this.record.tables.length||!this.record.tables[0].hasOwnProperty("rows")||0==this.record.tables[0].rows.length)return;const e=["purchase_order_number",,"purchase_order"];for(const[t,o]of this.record.tables[0].rows.entries())if(!0!==o.is_deleted)for(const[a,i]of o.columns.entries())e.includes(i.name.toLowerCase())&&""!==i.value&&(yield this.fetchAddPoItems(i.value))}))},addToPoItems(e,t,o=!1){(0,Pe.Jp)(this.po_items)&&(this.po_items={}),0!=(0,Pe.v7)(t)&&(this.po_items[e]=t,1==(0,Pe.v7)(this.po_items)&&(this.tab=Object.keys(this.po_items)[0]),o&&this.setPoItemsforSave())},removeFromPoItems(e,t=!0){(0,Pe.Jp)(this.po_items)||0==(0,Pe.v7)(this.po_items)||(delete this.po_items[e],t&&this.setPoItemsforSave())},setPoItemsforSave(){this.record&&(this.record.hasOwnProperty("po_items")||(this.record.po_items={}),this.record.po_items=this.po_items)},getPurchaseOrderData(){let e={};return this.record&&this.record.po_items?(e=this.record.po_items,e):e},getPOitems(e){return Jt(this,void 0,void 0,(function*(){let t,o=[];try{if(!this.record.editable||(0,Pe.ke)(e))return;let a="?purchase_order_number="+e,i=yield this.getToken();t=yield B().get(rt.hi.get_purchase_order_data+a,{headers:{Authorization:i}}),!1!==t.data.success&&(o=t.data)}catch(a){this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}return o}))},searchPurchaseOrder(){return Jt(this,void 0,void 0,(function*(){try{if(!(0,oe.s_)(this.record.doc_type)||!this.record.editable)return;if((0,Pe.ke)(this.po_search))return;this.processing=!0,this.po_preview_items=[],this.po_preview=!1;let e=yield this.getPOitems(this.po_search);this.po_preview_items=e,this.po_preview=!0}catch(e){this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}finally{this.processing=!1}}))},clearSearch(){this.po_search="",this.po_preview_items=[],this.po_preview=!1,this.po_search_keyword=""},addToPoItemsList(){this.po_preview_items&&this.record.editable&&(this.addToPoItems(this.po_search,this.po_preview_items,!0),this.clearSearch())},togglePoImage(){"chevron_left"===this.togglerIcon?this.togglerIcon="chevron_right":this.togglerIcon="chevron_left",(0,J.$)("#po-image-container").classList.toggle("hidden"),(0,J.$)("#po-container-parrent").classList.toggle("po-container-parrent"),(0,J.$)("#po-container-parrent").classList.toggle("po-container-parrent-full-width")},getPOColumns(){return Jt(this,void 0,void 0,(function*(){let e;try{this.record.po_columns=[];let t=this.record&&this.record.doc_type?this.record.doc_type:"PO_TABLE",o="?doc_type="+t,a=yield this.getToken();if(e=yield B().get(rt.hi.get_purchase_order_display_cols+o,{headers:{Authorization:a}}),!1===e.data.success)throw"Api response error";this.record.po_columns=e.data.data,this.po_preview_columns=[],this.record.po_columns.forEach(((e,t)=>{!0===e.preview&&this.po_preview_columns.push(e)}))}catch(t){throw this.showErrorToast(this.$t("pages.messages.PO_COLUMNS_API_ERROR")),"stop execuation, no columns for purchase order lines"}}))},keyDownEvent(e){if("Enter"===e.key){const t=e.target;null!==t&&t.hasAttribute("data-id")&&"po_search"===t.getAttribute("data-id")&&this.searchPurchaseOrder()}else if(e.ctrlKey&&"f"===e.key)e.preventDefault(),setTimeout((()=>{(0,J.$)("#search-po").querySelector("label").click()}),10);else if(e.ctrlKey&&"a"===e.key)e.preventDefault(),setTimeout((()=>{(0,J.$)("#auto_po_match_btn").click()}),10);else if(e.ctrlKey&&"s"===e.key)e.preventDefault(),setTimeout((()=>{(0,J.$)("#save_po_btn").click()}),10);else if(e.ctrlKey&&"e"===e.key)e.preventDefault(),setTimeout((()=>{(0,J.$)("#export_po_btn").click()}),10);else if(e.ctrlKey&&"d"===e.key)e.preventDefault(),setTimeout((()=>{(0,J.$)("#po_training_mode_btn").click()}),10);else if(e.ctrlKey&&"h"===e.key)e.preventDefault(),setTimeout((()=>{(0,J.$)("#help_po_btn").click()}),10);else if(e.ctrlKey&&"k"===e.key)e.preventDefault(),setTimeout((()=>{(0,J.$)("#keyboard_po_btn").click()}),10);else if(e.ctrlKey&&"m"===e.key){e.preventDefault();const t=this.poElements[this.currentPoElementIndex];t&&t.focus(),this.currentPoElementIndex<this.poElements.length-1?this.currentPoElementIndex++:this.currentPoElementIndex=0}},goToHelp(){window.open(ae.hA,"_blank")},TableDragModeHandler(e){e&&(this.allowPOTableDrag=!0===e.detail)},updateTableDataForSave(e){e&&e.detail&&this.record&&this.record.tables&&(this.updateTables(e),this.debounceAutoSaveFunc())},updateTables(e){this.record.tables=e.detail,this.setDataToCache()},saveDataOnChanges(){return Jt(this,void 0,void 0,(function*(){this.auto_save_data&&(this.auto_saving=!0,this.auto_saved_done=!1,!0===this.ext_table_train?yield this.saveExtAppData():yield this.saveData(!1),this.auto_saving=!1,this.auto_saved_done=!0,this.calculateMatchedTotal(),setTimeout((()=>{this.auto_saved_done=!1}),1e4))}))},deleteTableLine(e){e&&e.detail&&e.detail.tables&&this.record&&this.record.tables&&(this.record.tables=e.detail.tables,this.lineItemPOConnectionRemoved({detail:{data:e.detail.connection_info}}),this.setDataToCache(),this.debounceAutoSaveFunc(),this.initLineItems())},triggerTableConversion(e){this.convertPoLineToLineTable(e)},convertPoLineToLineTable(e){return Jt(this,void 0,void 0,(function*(){if(e&&e.detail)try{let t;this.processing=!0;const o=this.getPoNumbers(e.detail);let a=yield this.getToken(),i=new FormData;if(i.append("data",JSON.stringify(this.record)),i.append("purchase_order_numbers",o),t=yield B().post(rt.hi.get_table_from_po_numbers,i,{headers:{Authorization:a}}),!1===t.data.success)throw"Api response error";this.record=t.data.data,this.initPage(),this.debounceAutoSaveFunc(),this.TableDragModeHandler({detail:!1})}catch(t){if(null!=t&&"object"==typeof t&&t.hasOwnProperty("message"))return void this.showErrorToast(t.message);this.showErrorToast(t)}finally{this.processing=!1}}))},getPoNumbers(e){if(Array.isArray(e))return e.join();if(("string"===typeof e||e instanceof String)&&""!=e)return e;throw"No Purchase number found"},autoPoMatch(){return Jt(this,void 0,void 0,(function*(){try{this.processing=!0;const e=this.getPurchaseOrderData();if(!e||0===Object.keys(e).length)throw"No Po Lines Found";let t="";const o=document.querySelector(".po-tab.q-tab--active");if(o&&(t=o.dataset.name?o.dataset.name:""),""===t)throw"No Purchase Number Tab is selected";if(!this.record.tables||0==this.record.tables.length||!this.record.tables[0].hasOwnProperty("rows")||0==this.record.tables[0].rows.length)throw"No Line Table found";let a=yield this.getToken(),i=new FormData;i.append("data",JSON.stringify(this.record)),i.append("purchase_order_number",t);let s=yield B().post(rt.hi.auto_po_match,i,{headers:{Authorization:a}});if(!1===s.data.success)throw"Api response error";this.record=s.data.data,this.initPage(),this.debounceAutoSaveFunc()}catch(e){if(null!=e&&"object"==typeof e&&e.hasOwnProperty("message"))return void this.showErrorToast(e.message);this.showErrorToast(e)}finally{this.processing=!1}}))},deleteLineTable(){"PO_CONVERTED_TABLE"===this.table_name&&(this.processing=!0,this.record&&(this.record.hasOwnProperty("po_matched")&&(this.record.po_matched=[]),this.record.hasOwnProperty("po_all_matched")&&(this.record.po_all_matched=!1),this.updateTables({detail:[]}),this.debounceAutoSaveFunc(),this.initPage(),this.processing=!1))},deletePoTab(){if(!this.delete_tab_po_number||""===this.delete_tab_po_number)return;this.removeFromPoItems(this.delete_tab_po_number);let e=this.removePoConnection(this.delete_tab_po_number);e&&e.length>0&&this.record.hasOwnProperty("po_all_matched")&&(this.record.po_all_matched=!1),this.debounceAutoSaveFunc(),this.initPage()},removePoConnection(e){if(!this.record||!this.record.hasOwnProperty("po_matched"))return;let t=[];for(let[a,i]of this.record.po_matched.entries())e==i.purchase_order_number&&t.push(a);for(var o=t.length-1;o>=0;o--)this.record.po_matched.splice(t[o],1);return t},getSelectedPOitems(e){return Jt(this,void 0,void 0,(function*(){try{if(this.po_search=e,(0,Pe.ke)(this.po_search)||!this.record.editable||"no_data_found"===this.po_search)return;this.po_preview_items=[],this.po_preview=!1;let t=yield this.getPOitems(this.po_search);this.po_preview_items=t,this.po_preview=!0}catch(t){this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}}))},searchPurchaseOrderList(e,t,o){return Jt(this,void 0,void 0,(function*(){if(!this.record.editable||(0,Pe.ke)(e)||e.length<2)o();else try{this.processing=!0,e=this.removeSpaces(e);let o=[],a=yield this.getPONumberMatchlist(e);this.po_search=e,(0,Pe.v7)(a)>1&&a.forEach(((e,t)=>{const a=e.purchase_order_number;o.push(Object.assign({},{value:a,label:a}))})),0==(0,Pe.v7)(a)&&o.push(Object.assign({},{value:"no_data_found",label:this.$t("no_data_found")})),t((()=>{this.po_number_options=o})),1==(0,Pe.v7)(a)&&(this.po_search_keyword=e,yield this.getSelectedPOitems(e))}catch(a){this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}finally{this.processing=!1}}))},displayPONumbersAsOption(e){let t="<strong>"+e.substr(0,this.po_search.length)+"</strong>";return t+=e.substr(this.po_search.length),t},getPONumberMatchlist(e){return Jt(this,void 0,void 0,(function*(){let t,o=[];try{let a="?keyword="+e,i=yield this.getToken();t=yield B().get(rt.hi.get_purchase_orders_list+a,{headers:{Authorization:i}}),!1!==t.data.success&&(o=t.data)}catch(a){this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}return o}))},getPoFieldValue(){this.record.fields.forEach(((e,t)=>{"purchase_order"===e.name&&(this.poFieldValue=e.formatted_value)}))},isDeleteAble(e){return e!==this.poFieldValue},proceedToCloseTab(e){this.isDeleteAble(e)&&(this.delete_tab_po_number=e,this.delete_tab_confirmation=!0)},cleanupPoMatched(){if(!this.record||!this.record.hasOwnProperty("po_matched"))return;const e=this.getCompactPoLines();if(0==e.length)return this.record.po_matched=[],void this.syncPoMatched();const t=this.getCompactLineItems();if(0==t.length)return this.record.po_matched=[],void this.syncPoMatched();const o=[];for(let[a,i]of this.record.po_matched.entries())0!=t.includes(i.invoice_table_line_id)&&0!=e.includes(i.po_line_id)||o.push(a);0!=o.length&&(this.record.po_matched=this.record.po_matched.filter(((e,t)=>!o.includes(t))),this.syncPoMatched())},syncPoMatched(){this.initLineItems(),this.initPoLines(),this.debounceAutoSaveFunc()},initPoLines(){const e=new CustomEvent("init_po_lines",{});document.dispatchEvent(e)},getCompactLineItems(){const e=[],t=(0,J.$)("#line_item_table").querySelectorAll(".line-item-tr");if(0==t.length)return e;for(var o=0;o<t.length;o++){let a=t[o];a.dataset.id&&e.push(a.dataset.id)}return e},getCompactPoLines(){const e=[];if(0==(0,Pe.v7)(this.po_items))return e;for(const[t,o]of Object.entries(this.po_items))for(const[a,i]of Object.entries(o)){const t=i;e.push(t.id)}return e}},beforeRouteLeave:function(e,t,o){"function"===typeof this.warning_alert&&this.warning_alert(),this.removeCache(),this.record={},o()},setup(){const e=(0,Le.H_)(),{record:t,processing:o,auto_saving:a,auto_saved_done:i,error:s}=(0,K.Jk)(e),{getDocumentById:n,getExtAppPODocumentByID:l,saveExtAppDocument:r,saveDocument:c,removeCache:d,setDataToCache:h}=e,u=(0,Le.wX)(),{token:m}=(0,K.Jk)(u),{setAuthToken:_}=u,p=(0,Le.Yb)(),{calculateMatchedTotal:g,setTotallineItem:f}=p,b=(0,Le.b8)(),{connect:w}=b;let y=[];return{connect:w,setTotallineItem:f,calculateMatchedTotal:g,doc_fetch_error:(0,ee.iH)(s),auto_saving:a,auto_saved_done:i,removeCache:d,saveDocument:c,setAuthToken:_,setDataToCache:h,getDocumentById:n,saveExtAppDocument:r,getExtAppPODocumentByID:l,token:m,processing:o,record:t,tab:(0,ee.iH)(""),profile:(0,ee.iH)(""),po_preview:(0,ee.iH)(!1),confirmDecision:(0,ee.iH)(!1),isExportDisabled:(0,ee.iH)(!0),po_preview_items:(0,ee.iH)(y),allowPODragButton:(0,ee.iH)(!0),allowPOTableDrag:(0,ee.iH)(!1),po_items:(0,ee.iH)({}),showKeyboardShortcuts:(0,ee.iH)(!1),togglerIcon:(0,ee.iH)("chevron_right"),baseUrl:"https://dev.api.docbits.com",get_fields:{purchase_order:"",invoice_id:""},po_preview_columns:(0,ee.iH)(y),table_name:(0,ee.iH)(""),auto_save_data:(0,ee.iH)(!0),delete_tab_confirmation:(0,ee.iH)(!1),delete_table_confirmation:(0,ee.iH)(!1),delete_tab_po_number:(0,ee.iH)(""),ext_table_train:(0,ee.iH)(!1),po_number_options:(0,ee.iH)(y),po_search:(0,ee.iH)(""),po_search_keyword:(0,ee.iH)("")}}});var Xt=o(32259),eo=o(33115),to=o(47817),oo=o(70900),ao=o(50926),io=o(89800),so=o(84106);const no=(0,Se.Z)(Gt,[["render",F],["__scopeId","data-v-d75bd49c"]]),lo=no;st()(Gt,"components",{QBtn:Fe.Z,QIcon:$e.Z,QTooltip:je.Z,QSelect:Xt.Z,QItem:Ze.Z,QItemSection:Me.Z,QItemLabel:eo.Z,QTabs:to.Z,QTab:oo.Z,QSeparator:ao.Z,QTabPanels:io.Z,QTabPanel:so.Z,QMarkupTable:Be.Z,QDialog:Ye.Z,QCard:Je.Z,QCardActions:Xe.Z,QCardSection:Ge.Z,QAvatar:et.Z,QInnerLoading:Bt.Z,QField:ot.Z}),st()(Gt,"directives",{ClosePopup:at.Z})}}]);