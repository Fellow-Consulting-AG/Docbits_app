"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[2597],{32597:(e,t,o)=>{o.r(t),o.d(t,{default:()=>bt});var i=o(61758),s=o(58790);const a=e=>((0,i.Qi)("data-v-1335445b"),e=e(),(0,i.jt)(),e),l={class:"row q-pb-md"},n={class:"col-12 q-pl-sm q-mt-sm"},r={key:0,class:"row"},d={key:1,class:"full-width"},u={class:"row"},c={class:"po-nav-width q-pr-md row"},m={class:"q-mr-auto q-mt-sm"},h={style:{"vertical-align":"middle","margin-left":"10px","font-size":"20px",cursor:"pointer"}},_={class:"q-ml-auto q-mt-sm"},p={class:"h-m-r-10",id:"po-container-parrent",style:{"border-right":"1px solid #9f9d9d"}},g={class:"row ml-10 scroll-height-100vh-130px scrolle-y"},f={class:"col-sm-12"},b={class:"full-width scrolle-y"},v={key:0,class:"row q-mt-md q-mb-md input-text-28px"},y={class:"row"},k={class:"col-sm-12 col-md-12 col-lg-12"},w={class:"col-sm-12 col-md-12 col-lg-12"},L={class:"full-width q-pt-md"},I={style:{"margin-left":"-13px",top:"10px"}},A={style:{"margin-left":"-5.5px",top:"40%"}},C={class:""},F={class:"po-right-container q-pr-md q-mt-sm",id:"po-image-container"},E=a((()=>(0,i.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1)));function O(e,t,o,a,O,x){const D=(0,i.g2)("DocumentLock"),R=(0,i.g2)("MessageBanner"),T=(0,i.g2)("SubHeader"),S=(0,i.g2)("ErrorDocumentView"),P=(0,i.g2)("q-icon"),V=(0,i.g2)("q-btn"),q=(0,i.g2)("TaskBtn"),N=(0,i.g2)("CreateTaskBtn"),Q=(0,i.g2)("exportBtns"),K=(0,i.g2)("q-input"),U=(0,i.g2)("q-separator"),W=(0,i.g2)("LineItems"),X=(0,i.g2)("ImageComponent"),j=(0,i.g2)("q-splitter"),$=(0,i.g2)("q-inner-loading");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.bF)(D,{document_version:e.document_version,trigger_document_lock:e.trigger_document_lock,doc_id:e.docId},null,8,["document_version","trigger_document_lock","doc_id"]),e.is_view_readonly?((0,i.uX)(),(0,i.Wv)(R,{key:0,message:e.error_message,messageCategoryClass:"error-banner"},null,8,["message"])):(0,i.Q3)("",!0),(0,i.bF)(T,{name:"quote_details",label:e.$t("quote_details"),show_expiry_alert:!0,onSearch:!1},null,8,["label"]),(0,i.Lk)("div",l,[(0,i.Lk)("div",n,[e.doc_fetch_error?((0,i.uX)(),(0,i.CE)("div",r,[(0,i.bF)(S)])):((0,i.uX)(),(0,i.CE)("div",d,[(0,i.bF)(j,{limits:[30,100],modelValue:e.imageFieldSplitter,"onUpdate:modelValue":[t[3]||(t[3]=t=>e.imageFieldSplitter=t),t[4]||(t[4]=t=>e.splitterChanged())],class:"po-left-container"},{before:(0,i.k6)((()=>[(0,i.Lk)("div",u,[(0,i.Lk)("div",c,[(0,i.Lk)("div",m,[(0,i.bF)(V,{flat:"",rounded:"",color:"primary",onClick:t[0]||(t[0]=t=>e.routeToBack())},{default:(0,i.k6)((()=>[(0,i.bF)(P,{name:"fa-solid fa-circle-arrow-left",size:"sm"}),(0,i.Lk)("label",h,(0,s.v_)(e.$t("back")),1)])),_:1})]),(0,i.Lk)("div",_,[e.is_view_readonly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.bF)(q,{is_f_btn:!0,onBtnClicked:t[1]||(t[1]=t=>e.gotoTaskPendingList())}),(0,i.bF)(N,{is_icon_button:!0})],64)),e.is_view_readonly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(Q,{key:1}))])])]),(0,i.Lk)("div",p,[(0,i.Lk)("div",g,[(0,i.Lk)("div",f,[(0,i.Lk)("div",b,[e.documentFieldsConfig&&e.documentFieldsConfig.length>0?((0,i.uX)(),(0,i.CE)("div",v,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.documentFieldsConfig,((t,o)=>((0,i.uX)(),(0,i.CE)("div",{key:o,class:"col-sm-4 col-md-4 col-lg-4 q-pa-sm"},[(0,i.Lk)("div",y,[(0,i.Lk)("div",k,(0,s.v_)(e.getFieldLabelFromAllPrefixes(t)),1),(0,i.Lk)("div",w,[(0,i.bF)(K,{outlined:"",dense:"",modelValue:e.documentFields[t.field_name].formatted_value,"onUpdate:modelValue":o=>e.documentFields[t.field_name].formatted_value=o,disable:!0},null,8,["modelValue","onUpdate:modelValue"])])])])))),128))])):(0,i.Q3)("",!0),(0,i.bF)(U),(0,i.Lk)("div",L,[(0,i.bF)(W,{ref:"lineItemsPoV3",isReadOnly:e.is_view_readonly,defaultValues:e.defalutAttributes},null,8,["isReadOnly","defaultValues"])])])])])])])),separator:(0,i.k6)((()=>[(0,i.Lk)("div",I,[(0,i.bF)(V,{round:"",unelevated:"",size:"xs",icon:e.imageFieldSplitter>=90?"chevron_left":"chevron_right",class:"panel-expand-button highlighted-back shadow-2",onClick:t[2]||(t[2]=t=>e.toggleImageArea())},null,8,["icon"])]),(0,i.Lk)("div",A,[(0,i.bF)(P,{name:"drag_handle",size:"md",class:"icon-grey rotate-90"})])])),after:(0,i.k6)((()=>[(0,i.Lk)("div",C,[(0,i.Lk)("div",F,[(0,i.bF)(X,{renderOpenWindoIcon:!0,dynamicWidth:e.dynamicWidth,docName:e.record.filename,docImages:e.record.images},null,8,["dynamicWidth","docName","docImages"])])])])),_:1},8,["modelValue"])]))])]),(0,i.bF)($,{class:"main-loader",showing:e.processing,style:{"z-index":"2"}},{default:(0,i.k6)((()=>[E])),_:1},8,["showing"])],64)}var x=o(1659),D=o(24622),R=o(60521),T=o(45938),S=o(38734),P=o(46162),V=o(76956),q=o(92162),N=o(51476),Q=o(11470),K=o(48520),U=o(81589),W=o(25891),X=o(93970),j=o(18859),$=o(29104);const z=e=>((0,i.Qi)("data-v-c8d22a5e"),e=e(),(0,i.jt)(),e),M={key:0,class:"full-width q-pa-sm back-white"},B=z((()=>(0,i.Lk)("img",{width:"20",src:"images/user_define_line.svg"},null,-1))),J=z((()=>(0,i.Lk)("img",{width:"20",src:"images/extracted_line.svg"},null,-1))),H={key:0},G={key:1},Y={class:"row back-white q-mt-md"},Z={class:"col-sm-12 col-md-12 col-lg-12"},ee={class:"col-sm-12 col-md-12 col-lg-12"},te={class:"row items-center justify-end"},oe={key:0},ie=["onClick"],se={key:0,class:"col-sm-12 col-md-12 col-lg-12 q-pt-md"},ae={class:"row float-right"},le={class:"export-label"};function ne(e,t,o,a,l,n){const r=(0,i.g2)("f-btn"),d=(0,i.g2)("q-tooltip"),u=(0,i.g2)("q-icon"),c=(0,i.g2)("q-th"),m=(0,i.g2)("q-tr"),h=(0,i.g2)("q-btn"),_=(0,i.g2)("q-td"),p=(0,i.g2)("q-table"),g=(0,i.g2)("q-spinner"),f=(0,i.g2)("q-markup-table"),b=(0,i.g2)("q-separator"),v=(0,i.g2)("q-date"),y=(0,i.g2)("q-popup-proxy"),k=(0,i.g2)("SelectAsDefault"),w=(0,i.g2)("q-input"),L=(0,i.g2)("q-select"),I=(0,i.g2)("q-spinner-ios"),A=(0,i.g2)("q-avatar"),C=(0,i.g2)("q-item-label"),F=(0,i.g2)("q-item-section"),E=(0,i.g2)("q-item"),O=(0,i.g2)("q-list"),x=(0,i.g2)("q-btn-dropdown"),D=(0,i.g2)("masterDataLookup"),R=(0,i.g2)("dialog-draggable"),T=(0,i.g2)("Loader"),S=(0,i.gN)("close-popup");return(0,i.uX)(),(0,i.CE)(i.FK,null,[e.hasLineItems()?((0,i.uX)(),(0,i.CE)("div",M,[e.isReadOnly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(r,{key:0,label:e.$t("add_line_row"),onClick:t[0]||(t[0]=t=>e.addLineRow()),class:"q-ma-xs float-right"},null,8,["label"]))])):(0,i.Q3)("",!0),((0,i.uX)(),(0,i.CE)("div",{class:"full-width q-pa-sm back-white",key:e.renderKey},[e.hasLineItems()?((0,i.uX)(),(0,i.Wv)(p,{key:0,rows:e.tableRows,columns:e.tableColumns,flat:"","row-key":"id","no-data-label":e.$t("pages.messages.no_record_found"),"rows-per-page-options":[0],id:"line_item_table",ref:"el",class:"text-uppercase sticky-header transparent-header table_height resizable",style:{"table-layout":"fixed !important",width:"100%"}},{header:(0,i.k6)((t=>[(0,i.bF)(m,{props:t},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(t.cols,((o,a)=>((0,i.uX)(),(0,i.Wv)(c,{key:o.name,props:t,class:"table-column-header",draggable:e.allowedColumnSorting(o),dropzone:e.allowedColumnSorting(o),"data-index":a,direction:"horizontal",onDragstart:t=>e.onDragStart(t,e.tableColumns,a),onDrop:(0,$.D$)((t=>e.handleDrop(t,a)),["prevent"]),onDragover:(0,$.D$)((t=>e.onDragOverWrapper(t,a,o.name)),["prevent"]),onDragenter:(0,$.D$)(e.onDragEnter,["prevent"]),onDragleave:(0,$.D$)(e.onDragLeave,["prevent"]),style:(0,s.Tr)({cursor:e.getIsDragging&&e.allowedColumnSorting(o)?"pointer":"move"})},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(o.label)+" ",1),o.error?((0,i.uX)(),(0,i.Wv)(u,{key:0,title:e.$t("pages.screen2b.in_valid_column_error"),name:"priority_high",class:"headerError"},{default:(0,i.k6)((()=>[(0,i.bF)(d,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("pages.screen2b.in_valid_column_error")),1)])),_:1})])),_:1},8,["title"])):(0,i.Q3)("",!0)])),_:2},1032,["props","draggable","dropzone","data-index","onDragstart","onDrop","onDragover","onDragenter","onDragleave","style"])))),128))])),_:2},1032,["props"])])),body:(0,i.k6)((t=>[(0,i.bF)(m,{props:t,"data-id":t.key,class:(0,s.C4)(["cursor-pointer",t.rowIndex%2==0?"":"alternative-row"]),onClick:o=>e.onRowClick(t.row,t.rowIndex)},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(t.cols,(o=>((0,i.uX)(),(0,i.Wv)(_,{key:o.name,"data-id":t.key},{default:(0,i.k6)((()=>[""===o.label?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[e.record.tables[0].rows[t.rowIndex].is_user_defined?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.bF)(u,{size:"sm",tabindex:"0",class:"cursor-pointer"},{default:(0,i.k6)((()=>[B,(0,i.bF)(d,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("custom_line")),1)])),_:1})])),_:1}),(0,i.bF)(h,{flat:"",tabindex:"0",color:"blue",icon:"fa fa-times",onClick:o=>{o.preventDefault(),e.removeLineItem(t.row.id,t.rowIndex)}},null,8,["onClick"])],64)):((0,i.uX)(),(0,i.Wv)(u,{key:1,size:"sm",tabindex:"0",class:"cursor-pointer"},{default:(0,i.k6)((()=>[J,(0,i.bF)(d,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("extracted_line")),1)])),_:1})])),_:1}))],64)):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.eW)((0,s.v_)(o.value),1)],64))])),_:2},1032,["data-id"])))),128))])),_:2},1032,["props","data-id","class","onClick"])])),_:1},8,["rows","columns","no-data-label"])):((0,i.uX)(),(0,i.Wv)(f,{key:1,style:{height:"'200px'"},class:"full-width"},{default:(0,i.k6)((()=>[(0,i.Lk)("thead",null,[!1===e.lineItemsloading?((0,i.uX)(),(0,i.CE)("tr",H,[(0,i.Lk)("th",null,(0,s.v_)(e.$t("no_line_items_found")),1)])):(0,i.Q3)("",!0),!0===e.lineItemsloading?((0,i.uX)(),(0,i.CE)("tr",G,[(0,i.Lk)("th",null,[(0,i.bF)(g,{color:"primary",size:"3em",thickness:10})])])):(0,i.Q3)("",!0)])])),_:1}))])),e.selectedRow&&Object.entries(e.selectedRow).length>0?((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.bF)(b,{class:"q-mt-md"}),(0,i.Lk)("div",Y,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.tableColumns,((t,o)=>((0,i.uX)(),(0,i.CE)(i.FK,{key:o},["status"!=t.name&&e.lineItemLayout[t.name]?((0,i.uX)(),(0,i.CE)("div",{key:0,class:(0,s.C4)(["col-sm-"+e.getColSpan(t.name),"q-pa-sm"])},[(0,i.Lk)("div",{class:(0,s.C4)(["row",e.getType(t.name)?"":" input-text-28px"])},[(0,i.Lk)("div",Z,[(0,i.eW)((0,s.v_)(t.label)+" ",1),e.getUiPreference(t.name,"UI_DEFAULT_VALUE")?((0,i.uX)(),(0,i.Wv)(u,{key:0,name:"info",color:"primary"},{default:(0,i.k6)((()=>[(0,i.bF)(d,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("field_has_default_value")),1)])),_:1})])),_:1})):(0,i.Q3)("",!0)]),(0,i.Lk)("div",ee,["DATE"==e.lineItemLayout[t.name].column_type?((0,i.uX)(),(0,i.Wv)(w,{key:0,outlined:"",dense:"",modelValue:e.selectedRow[t.name],"onUpdate:modelValue":[o=>e.selectedRow[t.name]=o,o=>{e.changeEvent(t.name,o)}],mask:"date",disable:e.isReadOnly||e.lineItemLayout[t.name].is_readonly,class:"p-b-0"},{append:(0,i.k6)((()=>[e.fieldErros[t.name]?((0,i.uX)(),(0,i.Wv)(u,{key:0,flat:"",dense:"",name:"error",size:"22px",color:"red"},{default:(0,i.k6)((()=>[(0,i.bF)(d,{class:"bg-red",anchor:"bottom left",self:"top left"},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.fieldErros[t.name]),1)])),_:2},1024)])),_:2},1024)):(0,i.Q3)("",!0),(0,i.bF)(u,{name:"event",class:"cursor-pointer"},{default:(0,i.k6)((()=>[(0,i.bF)(y,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,i.k6)((()=>[(0,i.bF)(v,{modelValue:e.selectedRow[t.name],"onUpdate:modelValue":o=>e.selectedRow[t.name]=o,mask:"YYYY-MM-DD"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",te,[(0,i.bo)((0,i.bF)(h,{label:"Close",color:"primary",flat:""},null,512),[[S]])])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)])),default:(0,i.k6)((()=>[(0,i.bF)(k,{columnName:t.name,attributeValue:e.selectedRow[t.name],tableKey:e.record.tables[0].name,doctype:e.doctype},null,8,["columnName","attributeValue","tableKey","doctype"])])),_:2},1032,["modelValue","onUpdate:modelValue","disable"])):e.lovFields.hasOwnProperty(t.name)?((0,i.uX)(),(0,i.Wv)(L,{key:1,outlined:"",dense:"","emit-value":"","map-options":"",modelValue:e.selectedRow[t.name],"onUpdate:modelValue":[o=>e.selectedRow[t.name]=o,o=>{e.dropDownChange(t.name,o)}],options:e.lovFieldsList[e.getKey(t.name)],disable:e.isReadOnly||e.lineItemLayout[t.name].is_readonly},{append:(0,i.k6)((()=>[e.fieldErros[t.name]?((0,i.uX)(),(0,i.Wv)(u,{key:0,flat:"",dense:"",name:"error",size:"22px",color:"red"},{default:(0,i.k6)((()=>[(0,i.bF)(d,{class:"bg-red",anchor:"bottom left",self:"top left"},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.fieldErros[t.name]),1)])),_:2},1024)])),_:2},1024)):(0,i.Q3)("",!0)])),default:(0,i.k6)((()=>[(0,i.bF)(k,{columnName:t.name,attributeValue:e.selectedRow[t.name],tableKey:e.record.tables[0].name,doctype:e.doctype},null,8,["columnName","attributeValue","tableKey","doctype"])])),_:2},1032,["modelValue","onUpdate:modelValue","options","disable"])):((0,i.uX)(),(0,i.Wv)(w,{key:2,outlined:"",dense:"",modelValue:e.selectedRow[t.name],"onUpdate:modelValue":[o=>e.selectedRow[t.name]=o,o=>{e.changeEvent(t.name,o)}],maxlength:e.getFieldLength(t.name),counter:!!e.getFieldLength(t.name),type:e.getType(t.name)?"textarea":"input",disable:e.isReadOnly||e.lineItemLayout[t.name].is_readonly},{append:(0,i.k6)((()=>[e.lookup_loading_fields.hasOwnProperty(t.name)?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[e.lookup_loading_fields[t.name].lookup_loading?((0,i.uX)(),(0,i.CE)("div",oe,[(0,i.bF)(I,{color:"primary",size:"0.86em"})])):(0,i.Q3)("",!0),1==e.lookup_loading_fields[t.name].lookup_found?((0,i.uX)(),(0,i.Wv)(u,{key:1,flat:"",dense:"",name:"check_circle",size:"22px",class:"cursor-pointer text-light-green-8",tabindex:"0"},{default:(0,i.k6)((()=>[(0,i.bF)(d,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("lookup_record_found")),1)])),_:1})])),_:1})):(0,i.Q3)("",!0),0==e.lookup_loading_fields[t.name].lookup_found?((0,i.uX)(),(0,i.Wv)(u,{key:2,flat:"",dense:"",name:"warning",size:"22px",class:"cursor-pointer text-orange",tabindex:"0"},{default:(0,i.k6)((()=>[(0,i.bF)(d,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.interpolate(t.name,e.$t("no_lookup_record_found_for_list"))),1)])),_:2},1024)])),_:2},1024)):(0,i.Q3)("",!0)],64)):(0,i.Q3)("",!0),e.lookup_configurations.has(t.name)?((0,i.uX)(),(0,i.Wv)(A,{key:1,class:"cursor-pointer fuzzy-field",size:"18px"},{default:(0,i.k6)((()=>[(0,i.Lk)("img",{src:"images/fuzzy-search.svg",onClick:o=>{o.stopPropagation(),o.preventDefault(),e.masterDataSearchByField(e.selectedRow.id,e.lineDataObj[e.selectedRow.id]["columns"][t.name])}},null,8,ie)])),_:2},1024)):(0,i.Q3)("",!0),e.fieldErros[t.name]?((0,i.uX)(),(0,i.Wv)(u,{key:2,flat:"",dense:"",name:"error",size:"22px",color:"red"},{default:(0,i.k6)((()=>[(0,i.bF)(d,{class:"bg-red",anchor:"bottom left",self:"top left"},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.fieldErros[t.name]),1)])),_:2},1024)])),_:2},1024)):(0,i.Q3)("",!0)])),default:(0,i.k6)((()=>[(0,i.bF)(k,{columnName:t.name,attributeValue:e.selectedRow[t.name],tableKey:e.record.tables[0].name,doctype:e.doctype},null,8,["columnName","attributeValue","tableKey","doctype"])])),_:2},1032,["modelValue","onUpdate:modelValue","maxlength","counter","type","disable"]))])],2)],2)):(0,i.Q3)("",!0)],64)))),128)),e.isReadOnly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",se,[(0,i.Lk)("div",ae,[e.isReadOnly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(r,{key:0,label:e.$t("cancel"),onClick:t[1]||(t[1]=t=>e.selectedRow={}),appearance:"cancel",class:"q-ma-xs"},null,8,["label"])),e.isReadOnly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(r,{key:1,label:e.$t("save"),onClick:t[2]||(t[2]=t=>e.saveChanges(!0,!0,!0)),class:"q-ma-xs"},null,8,["label"])),e.tableRows.length==e.selectedIndex+1||e.isReadOnly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(x,{key:2,split:"",unelevated:"",color:"primary",class:"export-btn q-ma-xs","no-caps":"",onClick:t[4]||(t[4]=t=>e.saveAndNext())},{label:(0,i.k6)((()=>[(0,i.Lk)("span",le,(0,s.v_)(e.$t("save_and_next")),1)])),default:(0,i.k6)((()=>[(0,i.bF)(O,{class:"text-center"},{default:(0,i.k6)((()=>[(0,i.bo)(((0,i.uX)(),(0,i.Wv)(E,{id:"export_po_btn",clickable:"",onClick:t[3]||(t[3]=t=>e.saveAndNextCopyDefaults()),class:"border-bottom-bdbdbd min-height-38"},{default:(0,i.k6)((()=>[(0,i.bF)(F,null,{default:(0,i.k6)((()=>[(0,i.bF)(C,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("save_and_next_copy_defaults")),1)])),_:1})])),_:1})])),_:1})),[[S]])])),_:1})])),_:1}))])]))])],64)):(0,i.Q3)("",!0),(0,i.bF)(R,{modelValue:e.fuzzyDialog,"onUpdate:modelValue":t[5]||(t[5]=t=>e.fuzzyDialog=t),seamless:"","full-width":"",position:"left",persistent:"",onKeydown:(0,$.jR)(e.closeMsDialog,["esc"]),title:e.$t("pages.screen2a.validation"),onOnHide:e.closeMsDialog,isResizeAble:!0,draggable:e.isDraggle},{default:(0,i.k6)((()=>[(0,i.bF)(D)])),_:1},8,["modelValue","onKeydown","title","onOnHide","draggable"]),(0,i.bF)(T)],64)}var re=o(53500),de=o(85192),ue=o(46736),ce=o(96056),me=o(89156),he=o(91298),_e=o(18505),pe=o(57366),ge=o(86633),fe=o(10739),be=o(68450),ve=o(36801),ye=o(1595),ke=o(82080);function we(e,t,o,a,l,n){const r=(0,i.g2)("q-item-section"),d=(0,i.g2)("q-item"),u=(0,i.g2)("q-separator"),c=(0,i.g2)("q-list"),m=(0,i.g2)("q-menu"),h=(0,i.gN)("close-popup");return(0,i.uX)(),(0,i.Wv)(m,{"touch-position":"","context-menu":""},{default:(0,i.k6)((()=>[(0,i.bF)(c,{dense:"",style:{"min-width":"100px"}},{default:(0,i.k6)((()=>[(0,i.bo)(((0,i.uX)(),(0,i.Wv)(d,{clickable:"",onClick:t[0]||(t[0]=t=>e.setValueAsDefault())},{default:(0,i.k6)((()=>[(0,i.bF)(r,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("set_as_default")),1)])),_:1})])),_:1})),[[h]]),(0,i.bF)(u),(0,i.bo)(((0,i.uX)(),(0,i.Wv)(d,{clickable:""},{default:(0,i.k6)((()=>[(0,i.bF)(r,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("close")),1)])),_:1})])),_:1})),[[h]])])),_:1})])),_:1})}var Le=function(e,t,o,i){function s(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function l(e){try{r(i.next(e))}catch(t){a(t)}}function n(e){try{r(i["throw"](e))}catch(t){a(t)}}function r(e){e.done?o(e.value):s(e.value).then(l,n)}r((i=i.apply(e,t||[])).next())}))};const Ie=(0,i.pM)({name:"select-as-default",mixins:[D.A],props:{tableKey:{type:String,default:""},columnName:{type:String,default:""},attributeValue:{type:String,default:""},doctype:{type:String,default:""}},methods:{setValueAsDefault(){return Le(this,void 0,void 0,(function*(){if(this.attributeValue)try{const e=new FormData;e.append("doc_type",this.doctype),e.append("table_key",this.tableKey),e.append("column_name",this.columnName),e.append("attribute_name","UI_DEFAULT_VALUE"),e.append("attribute_value",this.attributeValue),e.append("is_organization_default","true"),yield Q.M8.setTableAdditionalAttribute(e)}catch(e){if(logError(e),null!=e&&"object"==typeof e&&e.hasOwnProperty("message"))return void this.showErrorToast(e.message);this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}}))}}});var Ae=o(12807),Ce=o(84436),Fe=o(53999),Ee=o(90124),Oe=o(25173),xe=o(10386),De=o(88672),Re=o(98582),Te=o.n(Re);const Se=(0,Ae.A)(Ie,[["render",we]]),Pe=Se;Te()(Ie,"components",{QMenu:Ce.A,QList:Fe.A,QItem:Ee.A,QItemSection:Oe.A,QSeparator:xe.A}),Te()(Ie,"directives",{ClosePopup:De.A});var Ve=o(96587),qe=o(97717),Ne=function(e,t,o,i){function s(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function l(e){try{r(i.next(e))}catch(t){a(t)}}function n(e){try{r(i["throw"](e))}catch(t){a(t)}}function r(e){e.done?o(e.value):s(e.value).then(l,n)}r((i=i.apply(e,t||[])).next())}))};let Qe=new Map;const Ke=(0,i.pM)({el:"#app",mixins:[ge.A,_e.A,ce.A,D.A,ke.A,pe.A,W.A,ue.A,fe.A],components:{Loader:me.A,masterDataLookup:qe.A,dialogDraggable:Ve.A,SelectAsDefault:Pe},watch:{populate_row_to_view:{handler:function(e,t){0!=e&&this.populateMSDataFromPopup()}}},updated(){let e=this.user_settings.LINE_ITEM_TABLE_SETTING,t=200;e&&(e=JSON.parse(e),t=e.height);const o=document.getElementById("line_item_table");o&&(t<200&&(t=200),o.style.height=t+"px")},props:{isReadOnly:{type:Boolean,default:!1},defaultValues:{type:Object,default:{}}},data(){return{docId:"",renderKey:0,validation_done:!0,dropdownColumns:[],lovFields:(0,S.KR)({}),AI_table_extraction_setting:V.N1,line_table_columns:V.iS,triggerSave:(0,S.KR)(!1)}},mounted:function(){document.addEventListener("init_line_items",this.lineItemDataLoaded),document.addEventListener("line_item_table-column-drop",this.savedSortedColumns),this.init(),this.initailizeDragColumnsById("line_item_table"),window.vlqd=this},unmounted:function(){document.removeEventListener("init_line_items",this.lineItemDataLoaded),document.removeEventListener("line_item_table-column-drop",this.savedSortedColumns)},methods:{init(){this.checkAITableSetting(),this.debounceAutoTriggerFunc=(0,re.A)(this.triggerDependentFieldsWrapper.bind(this),1e3)},onDragOverWrapper(e,t,o){this.onDragOver(e,t)},allowedColumnSorting(e){return"id"!==e.name&&"action_column"!==e.name},lineItemDataLoaded(e){e&&e.detail&&(this.lineItemsloading=!1,this.resetRows(),this.docId=this.record&&this.record.doc_id?this.record.doc_id:"",this.refactorApiData(),this.triggerLineItemDataLoadedEvent(),this.setupLookup())},triggerLineItemDataLoadedEvent(){const e=new CustomEvent("line_items_loaded",{});document.dispatchEvent(e)},savedSortedColumns(){const e=[];this.tableColumns.forEach(((t,o)=>{e[t.name]=t,e[t.name]&&(e[t.name]["org_index"]=o)})),this.updatedLineColumns(this.tableColumns)},updatedLineColumns(e){return Ne(this,void 0,void 0,(function*(){try{this.showLoading();let t=this.line_table_columns+"_"+this.doctype;yield this.updateSetting(t,JSON.stringify(e))}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},resetRows(){this.tableRows=[],this.lineDataObj={}},refactorApiData(){this.is_ai_table=this.isAI_TableExit(this.record),this.setFormatOptions(),this.table_name=this.record.tables&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("name")?this.record.tables[0].name:"",this.prepareTableLayoutObj(),this.prepareTableColumn(),this.prepareTableRowsAndRowObj(),this.validateLineItemColumns(),this.triggerSave&&this.saveChanges(!1,!1,!0),logInfo("refactorApiData",this.lineItemLayout)},setFormatOptions(){this.formatting_options={},this.record.tables[0]&&this.record.tables[0].hasOwnProperty("formatting_options")&&(this.formatting_options=this.record.tables[0].formatting_options),this.record.tables[0].formatting_options=this.formatting_options,this.formatting_options.hasOwnProperty("columns_to_hide")&&null!==this.formatting_options.columns_to_hide&&(this.columns_to_hide=Object.assign([],this.formatting_options.columns_to_hide)),this.formatting_options.hasOwnProperty("custom_columns_to_hide")&&null!==this.formatting_options.custom_columns_to_hide&&(this.custom_columns_to_hide=Object.assign([],this.formatting_options.custom_columns_to_hide)),this.formatting_options.hasOwnProperty("column_origins")&&!(0,be.z)(this.formatting_options.column_origins)&&(0,be.Gv)(this.formatting_options.column_origins)||(this.record.tables[0].formatting_options.column_origins={},this.formatting_options.column_origins={})},prepareTableLayoutObj(){this.dropdownColumns=[];let e={};this.lineItemLayout={},this.record.tables&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("layout")&&Array.from(this.record.tables[0].layout).forEach((t=>{e.hasOwnProperty(t.column_name)||(t["lbl_to_display"]=this.getLabelToDisplay(t),this.lineItemLayout[t.column_name]=t,0==t.is_hidden&&(e[t.column_name]=!0,this.dropdownColumns.push({header:t.lbl_to_display,techName:t.column_name})))}))},prepareTableRowsAndRowObj(){this.tableRows=[],this.lineDataObj={};let e={};this.record.tables&&0!=this.record.tables.length&&this.record.tables[0].hasOwnProperty("rows")&&0!=this.record.tables[0].rows.length&&(Array.from(this.record.tables[0].rows).forEach((t=>{if(!1===t.is_deleted){let o={};e[t.id]=JSON.parse(JSON.stringify(t)),e[t.id].locations_list=[],t.locations_list&&Array.from(t.locations_list).forEach((o=>{e[t.id].locations_list["page_"+o.page]=o})),delete e[t.id].columns,e[t.id]["columns"]=[],Array.from(t.columns).forEach((i=>{if(e[t.id].columns[i.name]=JSON.parse(JSON.stringify(i)),e[t.id].columns[i.name].locations_list=[],i.locations_list&&Array.from(i.locations_list).forEach((o=>{e[t.id].columns[i.name].locations_list["page_"+o.page]=o})),(0,be.z)(i.formatted_value)||""==i.formatted_value){i.formatted_value="";const e=this.getUiPreference(i.name,"UI_DEFAULT_VALUE");e&&(i.value=e,i.formatted_value=e,i.extraction_method="UD",this.triggerSave=!0)}o[i.name]=i.formatted_value,this.prepareMapOfColumnHavingData(i)})),this.addExtraColumnsInRow(e,o,t.id),o["id"]=t.id,o["show_charges"]=!1;const i=t.hasOwnProperty("is_additional_cost")&&!0===t.is_additional_cost;i||this.tableRows.push(o)}})),Object.assign(this.lineDataObj,e))},prepareMapOfColumnHavingData(e){Qe.has(e.name)?!1===Qe.get(e.name)&&e.formatted_value&&null!=e.formatted_value&&""!=e.formatted_value&&Qe.set(e.name,!0):e.formatted_value&&null!=e.formatted_value&&""!=e.formatted_value?Qe.set(e.name,!0):Qe.set(e.name,!1)},addExtraColumnsInRow(e,t,o){for(let i of this.layoutExtraColumns){let s={name:i,value:"",content:"",locations:[],locations_list:[],formatted_value:"",is_extra_column:!0};e[o].columns[i]=s,Qe.set(i,!1),t[i]=""}},sortTableColumn(){this.tableColumns.sort(((e,t)=>e.sortOrder<t.sortOrder?-1:e.sortOrder>t.sortOrder?1:0))},prepareTableColumn(){this.tableColumns=[],this.tableColumns.push({name:"status",field:"status",align:"left",label:"",is_mapped:!0,org_index:""}),this.record.tables&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("rows")&&(this.is_ai_table?this.AI_TableColumns():this.normalTableColumns(),this.sortTableColumn())},normalTableColumns(){const e=this.record.tables[0].rows[0];if(!e)return;let t={},o=JSON.parse(JSON.stringify(this.lineItemLayout));Array.from(e.columns).forEach((i=>{let s=this.isColumnHidden(e,i);if(s){let e=i.name,s="",a=9999;this.lineItemLayout.hasOwnProperty(i.name)&&(e=this.lineItemLayout[i.name].lbl_to_display,s=this.lineItemLayout[i.name].column_type,a=this.lineItemLayout[i.name].sort_order,delete o[i.name]);let l="";null!=i.org_index&&void 0!=i.org_index&&(l=String(i.org_index));let n={name:i.name,field:i.name,align:"left",label:e,is_mapped:!!i.is_mapped&&i.is_mapped,org_index:l,col_origin:"auto",dataType:s?s.toLowerCase():"string",sortable:!0,sortOrder:a};n.col_origin=this.getColumnOrigin(this.record.tables[0],i.name),i.hasOwnProperty("org_index")&&null!=i.org_index?this.tableColumns.push(n):t[i.name]=n}}));for(let[i,s]of Object.entries(t))this.tableColumns.push(Object.assign({},s));for(let i in o){const e=o[i];let t=!this.isCustomColumnHidden(e.name);if(!t){delete o[e.name];continue}const s=this.lineItemLayout[e.column_name].column_type;let a={name:e.column_name,field:e.column_name,align:"left",label:e.lbl_to_display,is_mapped:!!e.is_mapped&&e.is_mapped,org_index:"",is_extra_column:!0,col_origin:"auto",dataType:s?s.toLowerCase():"string",sortable:!0};a.col_origin=this.getColumnOrigin(this.record.tables[0],e.column_name),this.tableColumns.push(Object.assign({},a)),this.layoutExtraColumns.push(e.column_name)}},getOrignalColumnName(e){return!e.hasOwnProperty("original_name")||(0,be.z)(e.original_name)?"":String(e.original_name)},is_AI_ColumnVisible(e){let t=!0,o=this.getOrignalColumnName(e);return o&&this.formatting_options&&this.formatting_options.hasOwnProperty("columns_to_hide")&&this.formatting_options.columns_to_hide&&0!=this.formatting_options.columns_to_hide.length?((this.formatting_options.columns_to_hide.includes(o)||"UUID"==e.name)&&(t=!1),t):t},is_AI_isColumnHidden(e,t){let o="";null!=t.original_name&&void 0!=t.original_name&&(o=String(t.original_name));let i=!0;return""!==o&&(i=this.is_AI_ColumnVisible(t)),""===o&&(i=!this.isCustomColumnHidden(t.name)),i&&this.lineItemLayout[t.name]&&(i=!this.lineItemLayout[t.name].is_hidden),i},AI_TableColumns(){let e={},t=[];Array.from(this.record.tables[0].rows).forEach((o=>{Array.from(o.columns).forEach((i=>{let s=this.is_AI_isColumnHidden(o,i);if(s&&!e.hasOwnProperty(i.name)){e[i.name]=!0;let o=i.name,s="",a="",l="",n=9999;this.lineItemLayout.hasOwnProperty(i.name)&&(o=this.lineItemLayout[i.name].lbl_to_display,s=this.lineItemLayout[i.name].column_type,a=this.lineItemLayout[i.name].is_required,l=this.lineItemLayout[i.name].always_visible,n=this.lineItemLayout[i.name].sort_order);let r="";null!=i.org_index&&void 0!=i.org_index&&(r=String(i.org_index));let d={name:i.name,field:i.name,align:"left",label:o,is_mapped:!!i.is_mapped&&i.is_mapped,org_index:""!==r?r:"",dataType:s?s.toLowerCase():"string",sortable:!0,is_required:a,always_visible:l,is_extra_column:!!i.hasOwnProperty("is_extra_column")&&i.is_extra_column,original_name:this.getOrignalColumnName(i),sortOrder:n};const u=d.is_mapped||!this.remove_unmapped_columns&&!d.is_mapped;i.hasOwnProperty("org_index")&&null!=i.org_index&&u?this.tableColumns.push(d):t[i.name]=d}}))}));for(let[o,i]of Object.entries(t)){const e=i;(e.hasOwnProperty("is_extra_column")&&!0===e.is_extra_column||e.always_visible||e.is_required)&&this.tableColumns.push(e)}},isCustomColumnHidden(e){let t=!1;if(!this.custom_columns_to_hide||0==this.custom_columns_to_hide.length)return t;for(const o of this.custom_columns_to_hide)if(o===e){t=!0;break}return t},isColumnHidden(e,t){let o="";null!=t.org_index&&void 0!=t.org_index&&(o=String(t.org_index));let i=!0;return""!==o&&(i=this.isColumnVisible(o,t)),i&&this.lineItemLayout[t.name]&&(i=!this.lineItemLayout[t.name].is_hidden),i},isColumnVisible(e,t){if(this.is_ai_table)return this.is_AI_ColumnVisible(t);let o=!0;return e&&this.formatting_options&&this.formatting_options.hasOwnProperty("columns_to_hide")&&this.formatting_options.columns_to_hide&&0!=this.formatting_options.columns_to_hide.length?((this.formatting_options.columns_to_hide.includes(e)||"UUID"==t.name)&&(o=!1),o):o},validateLineItemColumns(){let e=!1;if(void 0===this.tableColumns)return;for(const o of this.tableColumns){let t=this.isColumnNameValid(o);t||(o.error=!0,e=!0)}let t=!e;this.validation_done!==t&&(this.validation_done=t)},isColumnNameValid(e){let t=!1;for(const o of this.dropdownColumns)if(e.name===o.techName||"status"==e.name||"action_column"==e.name){t=!0;break}return t},hasOriginalIndex(e,t){let o=!1;return""!==e&&(o=!0),o},hasLineItems(){return!(!this.tableRows||0===Object.keys(this.tableRows).length)},goTolineItemsPage(){this.removeCache(),this.is_ai_table?this.$router.push("/field_validation_v1/"+this.record.doc_id):this.$router.push("/tbl_ext_v3/"+this.record.doc_id)},goToDashboard(){this.$router.push("/dashboard")},checkAITableSetting(){this.ai_table_setting_flag=!1,this.user_settings[this.AI_table_extraction_setting]&&(this.ai_table_setting_flag=this.user_settings[this.AI_table_extraction_setting])},onRowClick(e,t){return Ne(this,void 0,void 0,(function*(){this.selectedRow=JSON.parse(JSON.stringify(e)),this.selectedIndex=t,yield this.triggerlookupLovs("",!0,"",!1),yield this.triggerlookupLovsHavingData()}))},saveAndNextCopyDefaults(){return Ne(this,void 0,void 0,(function*(){const e=JSON.parse(JSON.stringify(this.selectedRow));yield this.saveAndNext();for(let[t,o]of Object.entries(e))this.getUiPreference(t,"UI_DEFAULT_VALUE")&&(this.selectedRow[t]=o)}))},saveAndNext(){return Ne(this,void 0,void 0,(function*(){let e=yield this.saveChanges(!0,!0,!1);if(!e)return;this.selectedIndex++;const t=this.tableRows[this.selectedIndex];this.onRowClick(t,this.selectedIndex)}))},saveChanges(e,t,o){return Ne(this,void 0,void 0,(function*(){let i=!1;if(this.isReadOnly)return i;if(t&&!this.validateData())return i;try{e&&this.showLoading(),this.tableRows[this.selectedIndex]=this.selectedRow,this.updateJsonForLineItems();const t=yield this.saveDocument(this.docId);if(this.refactorApiData(),this.removeCache(),!1===t.success)return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void this.showErrorToast(t.message);if(t.data.tables[0].messages&&(i=this.getErros(t.data.tables[0].messages),!i))return o=!1,i;this.$forceUpdate(),this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),i=!0}catch(s){return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(s),void(i=!1)}finally{this.hideLoading(),o?(this.selectedRow={},this.selectedIndex=null):this.selectedRow=this.tableRows[this.selectedIndex]}return i}))},getErros(e){let t=[];for(const i of e)if(i.row_index==this.selectedIndex){let e=i.message;if(i.hasOwnProperty("col_name")){let t=this.$t(i.col_name);this.lineItemLayout.hasOwnProperty(i.col_name)&&(t=this.lineItemLayout[i.col_name].lbl_to_display),e=t+": "+e}t.push(e)}let o=0==t.length;return o||this.showErrorToast(t.join("<br> ")),o},updateJsonForLineItems(){Array.from(this.record.tables[0].rows).forEach(((e,t)=>{this.selectedRow.id===e.id&&Array.from(e.columns).forEach(((e,o)=>{this.record.tables[0].rows[t].columns[o].value=this.selectedRow[e.name],this.record.tables[0].rows[t].columns[o].content=this.selectedRow[e.name],this.record.tables[0].rows[t].columns[o].formatted_value=this.selectedRow[e.name]}))}))},validateData(){let e=!0;for(let[t,o]of Object.entries(this.selectedRow)){if(this.lineItemLayout[t]&&this.lineItemLayout[t].is_required&&!o){e=!1,this.fieldErros[t]=this.$t("field_required");continue}const i=this.getFieldLength(t);i&&String(o).length>i&&(e=!1,this.fieldErros[t]=this.$t("invalid_field_length"))}return e},getUiPreference(e,t){return this.defaultValues&&this.defaultValues.table&&this.defaultValues.table[e]&&this.defaultValues.table[e][t]?this.defaultValues.table[e][t]:null},getColSpan(e){const t=this.getUiPreference(e,"UI_COL_SPAN");let o=3;return t&&(o*=+t,(o>12||o<1)&&(o=3)),o},getType(e){return this.getUiPreference(e,"UI_TEXT_AREA")},addLineRow(){return Ne(this,void 0,void 0,(function*(){this.selectedIndex=this.record.tables[0].rows.length;let e=JSON.parse(JSON.stringify(this.record.tables[0].rows[this.selectedIndex-1]));e.id=(0,de.A)(),e.coords=[],e.is_header_row=!1,e.is_user_defined=!0;for(let[o,i]of Object.entries(e.columns)){let e=i,t="";"POSITION"==e.name&&(t=(Number(e.formatted_value)+1).toString());const o=this.getUiPreference(e.name,"UI_DEFAULT_VALUE");o&&(t=o),e.value=t,e.content=t,e.org_index=e.org_index?e.org_index++:0,e.formatted_value=t,e.original_content=t,e.extraction_method="UD"}this.record.tables[0].rows.push(e),this.prepareTableRowsAndRowObj(),yield this.onRowClick(this.tableRows[this.selectedIndex],this.selectedIndex);const t=this.tableRows[this.selectedIndex-1];for(let[o,i]of Object.entries(t))this.getUiPreference(o,"UI_DEFAULT_VALUE")&&(this.selectedRow[o]=i)}))},dropDownChange(e,t){return Ne(this,void 0,void 0,(function*(){try{this.showLoading(),this.updateTableValues(e,t),yield this.triggerlookupLovs(e,!1,t,!0),t&&this.fieldErros[e]&&delete this.fieldErros[e]}catch(o){logError(o)}finally{this.hideLoading()}}))},changeEvent(e,t){this.updateTableValues(e,t);const o=this.autoTriggerLookups[e];o&&(this.autoTriggedFields=[],this.debounceAutoTriggerFunc(o,e,!1)),t&&this.fieldErros[e]&&delete this.fieldErros[e]},updateTableValues(e,t){this.lineDataObj[this.selectedRow.id]["columns"][e].value=t,this.lineDataObj[this.selectedRow.id]["columns"][e].content=t,this.lineDataObj[this.selectedRow.id]["columns"][e].formatted_value=t,this.selectedRow[e]=t},triggerlookupLovsHavingData(){return Ne(this,void 0,void 0,(function*(){const e=this.record.tables[0].lookup_lov_configurations;if(e)for(const[t,o]of Object.entries(this.selectedRow))if(this.lovFields.hasOwnProperty(t)){let e=this.lovFields[t].fields[0].column_name;e&&this.selectedRow[e]&&(yield this.triggerlookupLovs(e,!1,this.selectedRow[e],!1))}}))},triggerlookupLovs(e,t,o,i){return Ne(this,void 0,void 0,(function*(){const s=this.record.tables[0].lookup_lov_configurations;if(s)e:for(let a of s)if(a.fields&&0!=a.fields.length){this.lovFieldsList[a.column_name]||(this.lovFields[a.column_name]=a,this.lovFieldsList[a.column_name]=[]);for(let s of a.fields)if(t){if(null==s.column_name){let e=null;s.lookup_field&&(e=JSON.stringify({[s.lookup_field]:[s.filter_value]})),this.lovFieldsList[a.column_name]=yield Q.SY.getLookupLov(a.id,e)}}else if(e==s.column_name){const e={[s["lookup_field"]]:o},t=a.column_name+"_"+o;this.lovFieldsList[t]=yield Q.SY.getLookupLov(a.id,JSON.stringify(e)),i&&(this.selectedRow[a.column_name]="");break e}}}))},getKey(e){let t=e,o=this.lovFields[e].fields[0].column_name;return o&&this.selectedRow[o]&&(t=e+"_"+this.selectedRow[o]),t},getFieldLength(e){return this.getUiPreference(e,"UI_MAX_LENGTH")},removeLineItem(e,t){let o=t;for(const[i,s]of Object.entries(this.record.tables[0].rows))if(s.id===e){o=Number(i);break}this.record.tables[0].rows.splice(o,1),this.tableRows.splice(t,1),this.selectedRow={},this.selectedIndex=null},masterDataSearchByField(e,t){try{const o=t.name,i=this.lookup_configurations.get(o);if(!i)return void logError("field vardef is missing for master lookup",o);const s=(0,de.A)(),a=Object.values(this.ms_advance_filters).find((e=>e.field_name===t.name));if(!a&&(this.ms_advance_filters[s]={fuzzy_field:i.lookup_field.toLowerCase(),search_text:t.formatted_value,field_name:o,primary:!0},this.master_lookup_type=i.lookup_dataset_name,this.master_data_fields_map=new Map,this.master_data_fields_map.set(this.master_lookup_type,i),this.master_data_popup_width=this.calculateWidthForMSPopuup(),i.parent_field_id&&""!=i.parent_field_id)){let t=null;for(const[e,o]of i.fields.entries())if(i.parent_field_id==o.field_id){t=o;break}if(t){const o=(0,de.A)();this.ms_advance_filters[o]={fuzzy_field:t.lookup_field.toLowerCase(),search_text:this.lineDataObj[e]["columns"][t.field_name].formatted_value,field_name:t.field_name,primary:!1}}}this.fuzzyDialog=!0}catch(o){logInfo(o)}},calculateWidthForMSPopuup(){let e="700";const t=document.querySelector(".field_validation");if(!t)return e;const o=document.querySelector("#field_scrolle");if(!o)return e;const i=o.offsetWidth;return i<=0?e:String(i)},setupLookup(){try{if(this.lookup_configurations=new Map,!this.record.tables[0].lookup_configurations)return;for(const[e,t]of this.record.tables[0].lookup_configurations.entries())if(t.hasOwnProperty("fields")&&Array.isArray(t.fields))for(const[o,i]of t.fields.entries())i.auto_trigger&&(this.autoTriggerLookups[i.column_name]=t),i.is_searchable&&this.lookup_configurations.set(i.column_name,Object.assign(JSON.parse(JSON.stringify(i)),{lookup_dataset_name:t.lookup_dataset_name,fields:JSON.parse(JSON.stringify(t.fields))}))}catch(e){logError(e)}},populateMSDataFromPopup(){this.changed_fields=[],this.groups_to_update=[];let e=this.master_data_fields_map.get(this.master_lookup_type);this.populateMasterData(e,this.master_data_row),this.autoTriggedFields=[],this.triggerDependentFields(e,e.column_name,!0)},triggerDependentFieldsWrapper(e,t,o){return Ne(this,void 0,void 0,(function*(){yield this.triggerDependentFields(e,t,o)}))},triggerDependentFields(e,t,o){return Ne(this,void 0,void 0,(function*(){if(this.selectedRow[t]&&!this.autoTriggedFields.includes(t.toLowerCase()))for(let i of e.fields){const e=this.autoTriggerLookups[i.column_name];e&&(this.autoTriggedFields.push(t.toLowerCase()),o&&i.column_name.toLowerCase()==t.toLowerCase()||(yield this.triggerLookup(i.column_name,e),this.triggerDependentFields(e,i.column_name,!0)))}}))},triggerLookup(e,t){return Ne(this,void 0,void 0,(function*(){if((0,be.z)(e)||(0,be.jw)(e))return;const o=t.lookup_dataset_name;if(!o)return;const i=this.getFieldFromConfig(t,e),s={},a=(0,de.A)();this.lookup_loading_fields[e]={},this.lookup_loading_fields[e].lookup_loading=!0,s[a]={field:{field:i.lookup_field},operator:this.getOperator(i),search_text:this.lineDataObj[this.selectedRow.id]["columns"][e].formatted_value};let l=yield this.autoTriggerSearchByField(s,o);if(null!=l){const o=JSON.stringify(l.data[0]);this.populateMasterData(t,o),this.lookup_loading_fields[e].lookup_found=!0}else this.lookup_loading_fields[e].lookup_found=!1,this.lookup_loading_fields[e].lookup_found_name=o;this.lookup_loading_fields[e].lookup_loading=!1}))},getFieldFromConfig(e,t){for(const[o,i]of e.fields.entries())if(i.column_name==t)return i},getOperator(e){return e.search_operator?String(e.search_operator):"contains"},closeMsDialog(){this.fuzzyDialog=!1,this.ms_advance_filters={}},populateMasterData(e,t){try{this.closeMsDialog(),this.showLoading();let o=JSON.parse(t);const i=e.fields;for(let[e,t]of i.entries()){const e=t.column_name,i=t.lookup_field.toLowerCase();if(!this.lineDataObj[this.selectedRow.id]["columns"].hasOwnProperty(e))continue;if(0==o.hasOwnProperty(i)||null==o[i])continue;let s=o[i];o.hasOwnProperty(i+"_formatted_value")&&(s=o[i+"_formatted_value"]),this.updateTableValues(e,s),this.lookup_loading_fields[e]||(this.lookup_loading_fields[e]={},this.lookup_loading_fields[e].lookup_found=!0)}this.resetMasterDataStore()}catch(o){logError(o)}finally{this.hideLoading()}}},setup(){const e=(0,S.KR)(null);let t=[],o={};const i=(0,ye.q3)(),{record:s,doctype:a,remove_unmapped_columns:l}=(0,x.bP)(i),{removeCache:n,isAI_TableExit:r,saveDocument:d,saveFieldsStateForAutotrigger:u}=i;(0,he.wYm)(e,(0,re.A)((e=>{const t=e[0];if(m.value.LINE_ITEM_TABLE_SETTING){const e=JSON.parse(m.value.LINE_ITEM_TABLE_SETTING);if(e&&e.height==t.contentRect.height)return}t.contentRect.width<20||t.contentRect.height<20||((0,ve.wd)("LINE_ITEM_TABLE_SETTING",JSON.stringify(t.contentRect)),(0,N._Y)("LINE_ITEM_TABLE_SETTING",JSON.stringify(t.contentRect),!0),m.value["LINE_ITEM_TABLE_SETTING"]=JSON.stringify(t.contentRect))}),1e3));const c=(0,ye.Bu)(),{user_settings:m}=(0,x.bP)(c),{updateSetting:h}=c,_=(0,ye.vm)(),{searchByField:p,interpolate:g}=_,{lookup_loading_fields:f,trigger_lookup_flow:b}=(0,x.bP)(_),v=(0,ye.Ox)(),{model:y,advance_filters:k,master_lookup_type:w,changed_fields:L,groups_to_update:I,fields_with_autotrigger:A,selected_row:C,populate_row_to_view:F,master_data_fields_map:E,isDraggle:O}=(0,x.bP)(v),{resetMasterDataStore:D,isContentChanged:R,isCurrentFieldPrimary:T}=v;return{saveDocument:d,user_settings:m,updateSetting:h,remove_unmapped_columns:l,ai_table_setting_flag:(0,S.KR)(!1),record:s,doctype:a,el:e,removeCache:n,isAI_TableExit:r,is_ai_table:(0,S.KR)(!1),lineItemsloading:(0,S.KR)(!0),tableColumns:(0,S.KR)(t),tableRows:(0,S.KR)(t),table_name:(0,S.KR)(""),lineDataObj:{},lovFieldsList:(0,S.KR)({}),lineItemLayout:(0,S.KR)(t),formatting_options:(0,S.KR)(o),custom_columns_to_hide:(0,S.KR)(t),columns_to_hide:(0,S.KR)(t),layoutExtraColumns:(0,S.KR)([]),selectedRow:(0,S.KR)({}),fieldErros:(0,S.KR)({}),selectedIndex:(0,S.KR)(),resetMasterDataStore:D,isDraggle:O,changed_fields:L,master_data_row:C,groups_to_update:I,master_lookup_type:w,ms_advance_filters:k,populate_row_to_view:F,master_data_fields_map:E,fields_with_autotrigger:A,interpolate:g,autoTriggerSearchByField:p,lookup_loading_fields:f,master_data_popup_width:(0,S.KR)("700"),fuzzyDialog:(0,S.KR)(!1),autoTriggerLookups:(0,S.KR)({}),lookup_configurations:new Map,autoTriggedFields:(0,S.KR)([]),debounceAutoTriggerFunc:{}}}});var Ue=o(42315),We=o(44488),Xe=o(57722),je=o(50492),$e=o(97410),ze=o(45262),Me=o(56384),Be=o(857),Je=o(58210),He=o(67837),Ge=o(48975),Ye=o(93692),Ze=o(94940),et=o(82157),tt=o(3952),ot=o(18301),it=o(13796),st=o(67156);const at=(0,Ae.A)(Ke,[["render",ne],["__scopeId","data-v-c8d22a5e"]]),lt=at;Te()(Ke,"components",{QTable:Ue.A,QTr:We.A,QTh:Xe.A,QIcon:je.A,QTooltip:$e.A,QTd:ze.A,QBtn:Me.A,QMarkupTable:Be.A,QSpinner:Je.A,QSeparator:xe.A,QInput:He.A,QPopupProxy:Ge.A,QDate:Ye.A,QSelect:Ze.A,QSpinnerIos:et.A,QAvatar:tt.A,QBtnDropdown:ot.A,QList:Fe.A,QItem:Ee.A,QItemSection:Oe.A,QItemLabel:it.A,QField:st.A}),Te()(Ke,"directives",{ClosePopup:De.A});var nt=o(51184),rt=o(12682),dt=o(68180),ut=o(12566),ct=o(7134),mt=function(e,t,o,i){function s(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function l(e){try{r(i.next(e))}catch(t){a(t)}}function n(e){try{r(i["throw"](e))}catch(t){a(t)}}function r(e){e.done?o(e.value):s(e.value).then(l,n)}r((i=i.apply(e,t||[])).next())}))};j.A.table.arrowUp="arrow_drop_down";const ht=(0,i.pM)({el:"#app",mixins:[D.A,R.A,W.A],components:{TaskBtn:rt.A,SubHeader:dt.A,LineItems:lt,exportBtns:ct.A,DocumentLock:U.A,CreateTaskBtn:K.A,MessageBanner:X.A,ImageComponent:nt["default"],ErrorDocumentView:ut.A},data(){return{docId:"",error_message:"",dynamicWidth:(0,S.KR)(0),imageFieldSplitter:(0,S.KR)(76),defalutAttributes:(0,S.KR)({})}},mounted(){this.docId=this.$route.params.id,this.record=[],this.init(),window.vqd=this},unmounted:function(){return mt(this,void 0,void 0,(function*(){yield this.releaseDocLock({doc_id:this.record.doc_id})}))},methods:{init(){return mt(this,void 0,void 0,(function*(){try{if(this.processing=!0,yield this.getDocumentById(this.docId),!this.record||0===Object.keys(this.record).length||!1===this.record.success)return;const e=yield Q.M8.getAdditionalAttributes(this.doctype);e.success&&this.prepareDefaultVaueObj(e),this.makeModel(),this.handleReadOnly(),this.initPage()}catch(e){if(logError(e),null!=e&&"object"==typeof e&&e.hasOwnProperty("message"))return void this.showErrorToast(e.message);this.showErrorToast("Error while displaying Page. Please reload again or contact admistrator")}finally{this.processing=!1}}))},prepareDefaultVaueObj(e){if(this.defalutAttributes["fields"]={},this.defalutAttributes["table"]={},e.field_attributes)for(const[t,o]of Object.entries(e.field_attributes)){this.defalutAttributes["fields"][t]=[];for(const[e,i]of Object.entries(o))this.defalutAttributes["fields"][t][e]=i}if(e.table_attributes)for(const[t,o]of Object.entries(e.table_attributes)){for(const[e,t]of Object.entries(o)){this.defalutAttributes["table"][e]=[];for(const[o,i]of Object.entries(t))this.defalutAttributes["table"][e][o]=i}break}},makeModel(){for(let t of this.record.fields)t.formatted_value&&(this.checkForDefaultValues(t),this.documentFields[t.name]=t);let e=this.record.layout.groups;e.forEach(((e,t)=>{e.rows.forEach(((e,t)=>{e.forEach(((e,t)=>{this.documentFields[e.field_name]&&this.documentFieldsConfig.push(e)}))}))}))},checkForDefaultValues(e){if(e.formatted_value)return;if(!this.defalutAttributes["fields"][e.name]&&!this.defalutAttributes["fields"][e.name]["UI_DEFAULT_VALUE"])return;const t=this.defalutAttributes["fields"][e.name]["UI_DEFAULT_VALUE"];t&&(e.value=t,e.formatted_value=t,e.extraction_method="UD")},splitterChanged(){let e=window.innerWidth,t=e*(100-this.imageFieldSplitter)/100;this.dynamicWidth=t},handleReadOnly(){if(this.record.status!=V.aH.ready_for_validation)return this.is_view_readonly=!0,this.trigger_document_lock=!1,void(this.error_message=this.$t("pages.messages.READ_ONLY_MSG"));this.trigger_document_lock=!0;const e=T.tH.hasAccess("update");logInfo("hasAccess",e),e||(this.is_view_readonly=!0)},initLineItems(){const e=new CustomEvent("init_line_items",{detail:this.record});document.dispatchEvent(e)},initPage(){this.record&&this.record.fields&&(this.table_name=this.record.tables&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("name")?this.record.tables[0].name:"",this.setDataToCache(),this.initLineItems())},getLineItemsPoV3Ref(){let e=this.$refs.lineItemsPoV3;return e&&Array.isArray(e)?e[0]:e},toggleImageArea(){this.imageFieldSplitter>=90?this.imageFieldSplitter=70:this.imageFieldSplitter=100},togglePoImage(){"chevron_left"===this.togglerIcon?this.togglerIcon="chevron_right":this.togglerIcon="chevron_left",(0,q.$)("#po-image-container").classList.toggle("hidden"),(0,q.$)("#po-container-parrent").classList.toggle("po-container-parrent"),(0,q.$)("#po-container-parrent").classList.toggle("po-container-parrent-full-width")},routeToBack(){try{if(history.state.back)return void this.$router.back();this.$router.push("/field_validation_v1/"+this.docId)}catch(e){logError(e),this.$router.push("/field_validation_v1/"+this.docId)}},gotoTaskPendingList(){const e=(0,ye.OP)();e.getSavedListSettings(),e.setItemInFiltersMap("keyword",this.docId);const t=[];t.push({value:"open",label:"open"}),t.push({value:"in_progress",label:"in_progress"}),e.setItemInFiltersMap("status",t),this.$router.push("/tasks")}},setup(){const e=(0,ye.q3)(),{record:t,error:o,processing:i,doctype:s,document_version:a}=(0,x.bP)(e),{getDocumentById:l,saveDocument:n,removeCache:r,setDataToCache:d}=e,u=(0,ye.oI)(),{releaseDocLock:c}=u;return{removeCache:r,saveDocument:n,setWithExpiry:N._Y,setDataToCache:d,getDocumentById:l,saveUserPrefToServer:ve.wd,releaseDocLock:c,record:t,doctype:s,processing:i,document_version:a,doc_fetch_error:(0,S.KR)(o),trigger_document_lock:(0,S.KR)(!1),is_view_readonly:(0,S.KR)(!1),documentFields:(0,S.KR)([]),documentFieldsConfig:(0,S.KR)([]),togglerIcon:(0,S.KR)("chevron_right"),baseUrl:P.VA,table_name:(0,S.KR)("")}}});var _t=o(98072),pt=o(39035),gt=o(71746);const ft=(0,Ae.A)(ht,[["render",O],["__scopeId","data-v-1335445b"]]),bt=ft;Te()(ht,"components",{QSplitter:_t.A,QBtn:Me.A,QIcon:je.A,QInput:He.A,QSeparator:xe.A,QInnerLoading:pt.A,QField:st.A,QTabPanel:gt.A})}}]);