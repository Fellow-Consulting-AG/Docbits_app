"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[4096],{84096:(t,e,a)=>{a.r(e),a.d(e,{default:()=>G});var s=a(61758),n=a(29104),r=a(58790);const o=t=>((0,s.Qi)("data-v-61c6e57b"),t=t(),(0,s.jt)(),t),i={class:"container-wrapper"},l={style:{margin:"10px","margin-bottom":"0px"}},d={style:{display:"flex","justify-content":"space-between","align-items":"center"}},u=["data-index","draggable","dropzone","onDragstart","onDrop","onDragover"],c={key:0,class:"sort-buttons"},m=["onClick"],p=["onClick"],h={class:"table-container"},g={key:0,style:{width:"20%"}},k={key:1,style:{"text-align":"right",width:"20%"}},T={key:2,style:{"text-align":"right",width:"20%"}},_={key:3,style:{"text-align":"right",width:"20%"}},f={key:4,class:"start-button"},b={class:"back-white flex justify-end",style:{margin:"10px","margin-top":"0px"}},v={class:"row",style:{"margin-right":"0"}},y={class:"setting-line"},C=o((()=>(0,s.Lk)("span",{style:{"margin-top":"-0.5px"},class:"q-py-xs q-mt-xs q-mr-sm"},"Tasks per Page:",-1)));function D(t,e,a,o,D,x){const E=(0,s.g2)("SubHeader"),A=(0,s.g2)("BackToSettings"),S=(0,s.g2)("q-input"),L=(0,s.g2)("q-markup-table"),w=(0,s.g2)("q-btn"),I=(0,s.g2)("q-select"),N=(0,s.g2)("q-separator"),F=(0,s.g2)("q-pagination");return(0,s.uX)(),(0,s.CE)("div",null,[(0,s.bF)(E,{name:"log_settings_task_management",label:"Task Management",onSearch:!1}),(0,s.bF)(A),(0,s.Lk)("div",i,[(0,s.Lk)("div",l,[(0,s.Lk)("div",d,[(0,s.bF)(S,{modelValue:t.searchText,"onUpdate:modelValue":[e[0]||(e[0]=e=>t.searchText=e),e[1]||(e[1]=e=>t.nonComputedfilteredTasks())],placeholder:"Search Task",dense:"",outlined:"",style:{width:"250px","margin-bottom":"10px"}},null,8,["modelValue"])]),(0,s.bF)(L,{flat:"",bordered:"",id:"task_management_table"},{default:(0,s.k6)((()=>[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.table_columns,((a,o)=>((0,s.uX)(),(0,s.CE)("th",{key:a.name,"data-index":o,draggable:t.canDragDropColumn(a),dropzone:t.canDragDropColumn(a),direction:"horizontal",onDragstart:e=>t.onDragStart(e,t.table_columns,o),onDrop:(0,n.D$)((e=>t.handleDrop(e,o)),["prevent"]),onDragover:(0,n.D$)((e=>t.onDragOver(e,o)),["prevent"]),onDragenter:e[2]||(e[2]=(0,n.D$)(((...e)=>t.onDragEnter&&t.onDragEnter(...e)),["prevent"])),onDragleave:e[3]||(e[3]=(0,n.D$)(((...e)=>t.onDragLeave&&t.onDragLeave(...e)),["prevent"])),style:(0,r.Tr)([a.style||"",{cursor:t.getIsDragging?"pointer":"move"}])},[(0,s.Lk)("div",{class:(0,r.C4)(a.class||"")},[(0,s.eW)((0,r.v_)(a.label)+" ",1),"start_now"!==a.name?((0,s.uX)(),(0,s.CE)("div",c,[(0,s.Lk)("button",{onClick:e=>t.sortTable(a.sort_order,"asc"),class:(0,r.C4)([t.getSortButtonClass(a.sort_order,"asc"),"sort-button"])},"▲",10,m),(0,s.Lk)("button",{onClick:e=>t.sortTable(a.sort_order,"desc"),class:(0,r.C4)([t.getSortButtonClass(a.sort_order,"desc"),"sort-button"])},"▼",10,p)])):(0,s.Q3)("",!0)],2)],44,u)))),128))])])])),_:1})]),(0,s.Lk)("div",h,[(0,s.bF)(L,{flat:"",bordered:""},{default:(0,s.k6)((()=>[(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.displayedTasks,(e=>((0,s.uX)(),(0,s.CE)("tr",{key:e["Task ID"]},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.table_columns,(a=>((0,s.uX)(),(0,s.CE)(s.FK,{key:a.name},["task"==a.name?((0,s.uX)(),(0,s.CE)("td",g,(0,r.v_)(t.formateName(e["Task"])),1)):"run_for_last_time"==a.name?((0,s.uX)(),(0,s.CE)("td",k,(0,r.v_)(t.formateDateTime(e["Last Run Time"])),1)):"interval"==a.name?((0,s.uX)(),(0,s.CE)("td",T,(0,r.v_)(t.formateSchedule(e["Schedule"])),1)):"run_next_time"==a.name?((0,s.uX)(),(0,s.CE)("td",_,(0,r.v_)(t.formateDateTime(e["Next Run Time"])),1)):((0,s.uX)(),(0,s.CE)("td",f,[(0,s.bF)(w,{icon:"refresh",onClick:a=>t.startTask(e),style:{width:"20%"}},null,8,["onClick"])]))],64)))),128))])))),128))])])),_:1})]),(0,s.Lk)("div",b,[(0,s.Lk)("div",v,[(0,s.Lk)("div",y,[C,(0,s.bF)(I,{borderless:"",dense:"",modelValue:t.pagination_size,"onUpdate:modelValue":[e[4]||(e[4]=e=>t.pagination_size=e),t.updatePagination],options:t.pagination_options},null,8,["modelValue","options","onUpdate:modelValue"])]),(0,s.bF)(N,{vertical:""}),(0,s.bF)(F,{modelValue:t.paginationCount,"onUpdate:modelValue":[e[5]||(e[5]=e=>t.paginationCount=e),e[6]||(e[6]=e=>t.loadData())],color:"primary",max:t.maxpages,class:"q-py-xs q-mx-md","max-pages":5,input:"","boundary-links":""},null,8,["modelValue","max"])])])])])}var x=a(38734),E=a(66693),A=a(25773),S=a(36246),L=a(42067),w=a.n(L),I=a(21279),N=a(96056),F=a(10739),R=a(45022),K=a(11470),X=function(t,e,a,s){function n(t){return t instanceof a?t:new a((function(e){e(t)}))}return new(a||(a=Promise))((function(a,r){function o(t){try{l(s.next(t))}catch(e){r(e)}}function i(t){try{l(s["throw"](t))}catch(e){r(e)}}function l(t){t.done?a(t.value):n(t.value).then(o,i)}l((s=s.apply(t,e||[])).next())}))};const q=(0,s.pM)({el:"#app",components:{SubHeader:E.A,BackToSettings:A.A},mixins:[N.A,F.A],data(){return{paginationCount:(0,x.KR)(1),skip:(0,x.KR)(1),startfrom:(0,x.KR)(0),pageSize:(0,x.KR)(10),maxpages:(0,x.KR)(1),tasks:(0,x.KR)([]),sortColumn:"",sortOrder:"",refreshIntervalId:null,pagination_size:(0,x.KR)(10),pagination_options:(0,x.KR)(["10","15","20","25"]),displayedTasks:(0,x.KR)([]),searchText:(0,x.KR)(""),table_columns:[{label:"TASK",name:"task",sort_order:"Task",class:"first-header-content",style:{width:"20%"}},{label:"RAN FOR THE LAST TIME",name:"run_for_last_time",sort_order:"Last_Run_Time",class:"middle-header-content",style:{width:"20%"}},{label:"INTERVAL",name:"interval",sort_order:"Schedule",class:"middle-header-content",style:{width:"20%"}},{label:"RUN NEXT TIME",name:"run_next_time",sort_order:"Next_Run_Time",class:"middle-header-content",style:{width:"20%"}},{label:"START NOW",name:"start_now",sort_order:"",class:"text-right cursor-default"}]}},watch:{pagination_size(){this.updatePagination()},paginationCount(){this.updateDisplayedTasks()},tasks(){this.updateDisplayedTasks()}},computed:{filteredTasks(){return this.tasks.filter((t=>{let e=t["Task"];return"string"===typeof e&&(e=t.Task.replaceAll("_"," "),e.toLowerCase().includes(this.searchText.toLowerCase()))}))},sortedTasks(){const t=[...this.filteredTasks],e=this.sortColumn,a=this.sortOrder;return e&&t.sort(((t,s)=>{let n=t[e],r=s[e];return"string"===typeof n&&(n=n.toLowerCase()),"string"===typeof r&&(r=r.toLowerCase()),"asc"===a?n>r?1:-1:n<r?1:-1})),t}},methods:{init(){return X(this,void 0,void 0,(function*(){yield this.fetchTasks(),this.startAutoRefresh(),this.loadData(),this.maxPages()}))},fetchTasks(){return X(this,void 0,void 0,(function*(){try{const t=yield K.D.fetchTasksData();this.tasks=JSON.parse(t),this.updateDisplayedTasks(),this.maxPages()}catch(t){logError("Failed to fetch tasks:",t)}}))},updateDisplayedTasks(){const t=(this.paginationCount-1)*this.pagination_size,e=t+this.pagination_size;this.displayedTasks=this.sortedTasks.slice(t,e)},updatePagination(){this.paginationCount=1,this.maxPages(),this.updateDisplayedTasks()},nonComputedfilteredTasks(){let t=[];this.tasks.forEach((e=>{let a=e.Task.replaceAll("_"," ");a.includes(this.searchText.toLowerCase())&&t.push(e)})),t.length>0&&(this.displayedTasks=t),this.maxPages()},startTask(t){return X(this,void 0,void 0,(function*(){try{let e=t["Task"],a="Placeholder for org_id";yield K.D.startTask(e,a),this.$q.notify({type:"positive",message:`Task '${this.formateName(t["Task"])}' has been retriggered.`,timeout:2e3})}catch(e){this.$q.notify({type:"negative",message:`Failed to retrigger task '${this.formateName(t["Task"])}'.`,timeout:2e3}),logInfo(e)}}))},formateDateTime(t){const e=/^(\d{2})[./](\d{2})[./](\d{4})$/;e.exec(t);if(!this.isDate(t))return t;if(!t)return"-";const a=I.v.getFormat(this.getDocDateFormat())+" HH:mm:ss";return this.formateDate(t,a)},formateDate(t,e=""){let a="";return this.isDate(t)?(a=e||I.v.getFormat(this.getDocDateFormat()),S.Ay.formatDate(t,`${a}`)):t},formateSchedule(t){try{let n=t.slice(1,2);if("c"===n){let n=t.slice(11,12);var e=t.slice(10,-14);if(" "===n){var a=w().toString(e),s=a.replace(a.slice(0,14)," ");s=s.replace("e","E");return s}s=w().toString(e);return s}s=t.replace(t.slice(0,7),""),s=s.replace(t.slice(-1),""),s=s.replace(".00","");return s}catch(n){return logError("Failed to convert string",n),t}},formateName(t){var e=t.replaceAll("_"," ");e=e.charAt(0).toUpperCase()+e.slice(1);return e},sortTable(t,e){this.sortColumn=t,this.sortOrder=e,this.updateDisplayedTasks()},getSortButtonClass(t,e){return{"active-sort-button":this.sortColumn===t&&this.sortOrder===e,"sort-button":!0}},startAutoRefresh(){this.refreshIntervalId=setInterval((()=>{this.fetchTasks()}),1e4)},loadData(){this.startfrom=this.pagination_size*(this.paginationCount-1)},maxPages(){this.maxpages=Math.ceil(this.sortedTasks.length/this.pagination_size)},prepareTableColumn(){const t=R.A.getItem("TASK_MANAGEMENT_SETTING_COLUMNS");t&&(this.table_columns=JSON.parse(t))},onDropColumns(){R.A.set("TASK_MANAGEMENT_SETTING_COLUMNS",JSON.stringify(this.table_columns))}},mounted(){this.prepareTableColumn(),this.init(),this.initDragDropColumns("task_management_table","label",["start_now"]),document.addEventListener("task_management_table-column-drop",this.onDropColumns)},unmounted(){document.removeEventListener("task_management_table-column-drop",this.onDropColumns)},beforeUnmount(){this.refreshIntervalId&&(clearInterval(this.refreshIntervalId),this.refreshIntervalId=null)}});var z=a(12807),M=a(67837),O=a(857),P=a(56384),V=a(94940),$=a(10386),U=a(54700),Q=a(98582),B=a.n(Q);const H=(0,z.A)(q,[["render",D],["__scopeId","data-v-61c6e57b"]]),G=H;B()(q,"components",{QInput:M.A,QMarkupTable:O.A,QBtn:P.A,QSelect:V.A,QSeparator:$.A,QPagination:U.A})}}]);