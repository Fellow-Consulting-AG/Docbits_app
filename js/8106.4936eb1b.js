"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[8106],{48106:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ke});var a=i(61758),s=i(58790);const o=e=>((0,a.Qi)("data-v-199864d1"),e=e(),(0,a.jt)(),e),r={class:"row q-pl-xl q-pr-md q-pb-md full-width"},n={class:"max-width-100",id:"left_section",ref:"left_section"},l={class:"full-width q-ma-sm scroll-area-height"},d={class:"row justify-center q-pl-md q-pr-md q-pt-md"},c={class:"secondary-c-text text-h6 text-weight-bold"},h={class:"full-width left-scroll-area-height scrolle-y q-pa-sm"},u=["data-id","src","onClick"],g={class:"right_section",id:"right_section",ref:"right_section"},m={class:"row full-height"},p={class:"col-xs-12 col-sm-12 col-md-12 col-lg-12 q-px-sm scroll-area-height"},f={class:"mb-4 image_control_panel"},_={class:"row full-height"},y={class:"panel-left col-sm-6 col-md-6 col-lg-6"},v={class:"row"},w={class:"panel-middle col-sm-1 col-md-1 col-lg-1 mt-8"},k={class:"page-numbers"},b={class:"panel-right col-sm-5 col-md-5 col-lg-5"},D=o((()=>(0,a.Lk)("img",{width:"24",height:"24",src:"images/view-doc.svg"},null,-1))),x=o((()=>(0,a.Lk)("img",{width:"24",height:"24",src:"images/ocr_icon.svg"},null,-1))),L=o((()=>(0,a.Lk)("img",{width:"24",height:"24",src:"images/debug-on.svg"},null,-1))),I={class:"float-right table-mode mode-on"},z={class:"full-width full-height",id:"image_container"},P={class:"full-width full-height q-pa-sm scrolle-y",id:"image_scrolle",style:{position:"relative"}};function A(e,t,i,o,A,O){const E=(0,a.g2)("q-btn"),C=(0,a.g2)("q-tooltip"),X=(0,a.g2)("OcrTokenAreas"),T=(0,a.g2)("Loader");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",r,[(0,a.Lk)("div",n,[(0,a.Lk)("div",l,[(0,a.Lk)("div",d,[(0,a.Lk)("span",c,(0,s.v_)(e.$t("pages.screen2a.pages")),1)]),(0,a.Lk)("div",h,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.images,((t,i)=>((0,a.uX)(),(0,a.CE)("img",{"data-id":i,key:i,src:e.baseUrl+"/"+t.path+"?"+e.tokenQueryParam,class:(0,s.C4)(["q-pa-xs shadow-5 full-width q-ma-sm cursor-pointer",i===this.page_number-1?"active":""]),style:{height:"auto"},onClick:t=>e.imageclicked(i)},null,10,u)))),128))])])],512),(0,a.Lk)("div",g,[(0,a.Lk)("div",m,[(0,a.Lk)("div",p,[(0,a.Lk)("div",f,[(0,a.Lk)("div",_,[(0,a.Lk)("div",y,[(0,a.Lk)("div",v,[(0,a.bF)(E,{id:"menu_btn",round:"",icon:"chevron_left",size:"xs",class:"toggler-right p-t-40",onClick:t[0]||(t[0]=t=>e.toggleMenu())}),(0,a.eW)(" "+(0,s.v_)(e.filename),1)])]),(0,a.Lk)("div",w,[(0,a.Lk)("span",k,(0,s.v_)(e.currentPage())+"/"+(0,s.v_)(e.images.length),1)]),(0,a.Lk)("div",b,[e.doc_mode.includes(e.mode)?((0,a.uX)(),(0,a.Wv)(E,{key:0,flat:"",onClick:t[1]||(t[1]=t=>e.mode="doc"),class:"float-right pr-6 pl-6"},{default:(0,a.k6)((()=>[D,(0,a.bF)(C,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,s.v_)(e.$t("doc_view")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0),e.ocr_mode.includes(e.mode)?((0,a.uX)(),(0,a.Wv)(E,{key:1,flat:"",onClick:t[2]||(t[2]=t=>e.mode="ocr"),class:"float-right pr-6 pl-6"},{default:(0,a.k6)((()=>[x,(0,a.bF)(C,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,s.v_)(e.$t("ocr_view")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0),e.debug_on_mode.includes(e.mode)?((0,a.uX)(),(0,a.Wv)(E,{key:2,flat:"",onClick:t[3]||(t[3]=t=>e.mode="debug_on"),class:"float-right pr-6 pl-6"},{default:(0,a.k6)((()=>[L,(0,a.bF)(C,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,s.v_)(e.$t("debug_view")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0),(0,a.Lk)("span",I,["doc"==e.mode?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.eW)((0,s.v_)(e.$t("doc_view"))+" : ON ",1)],64)):(0,a.Q3)("",!0),"ocr"==e.mode?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.eW)((0,s.v_)(e.$t("ocr_view"))+" : ON ",1)],64)):(0,a.Q3)("",!0),"debug_on"==e.mode?((0,a.uX)(),(0,a.CE)(a.FK,{key:2},[(0,a.eW)((0,s.v_)(e.$t("debug_view"))+" : ON ",1)],64)):(0,a.Q3)("",!0)])])])]),(0,a.Lk)("div",z,[(0,a.Lk)("div",P,[(0,a.bF)(X,{"pos-correction":!1,width:e.imageWidth,tableAreas:e.tokens,height:e.imageHeight,cropUrl:e.image+"?"+this.tokenQueryParam,mode:e.mode,token_len:e.tokens.length},null,8,["width","tableAreas","height","cropUrl","mode","token_len"])])])])])],512)]),(0,a.bF)(T)],64)}var O=i(82303),E=i(1659),C=i(24622),X=i(38734),T=i(46162),S=i(18505),W=i(83319),q=i(41903),F=i(68450);function Q(e){return"ocr_doc_"+e}function $(){return"doc_data"}function K(e,t,i){try{const a=Q(i),s=H(i);(null==s||(0,F.dd)(s))&&R(e,t,i),s[t]=e,q.A.set(a,s)}catch(a){return logError(a),!1}}function R(e,t,i){const a=Q(i),s=B();s[t]=e,q.A.set(a,s)}function B(){return{}}function N(e){q.A.remove(e)}function H(e){const t=Q(e);return q.A.has(t)?q.A.getItem(t):B()}var U=i(96075);const Y=e=>((0,a.Qi)("data-v-a1ef8fa2"),e=e(),(0,a.jt)(),e),M=["src","width"],V=Y((()=>(0,a.Lk)("br",null,null,-1))),j={class:"c-crop--hide_main"},G=["src","width"];function J(e,t,i,o,r,n){const l=(0,a.g2)("q-tooltip");return(0,a.uX)(),(0,a.CE)("div",{class:"image-decorator medi-selected-area-fields",ref:"image-area",id:"image_area",style:(0,s.Tr)({width:e.width+"px"})},[e.url?((0,a.uX)(),(0,a.CE)("img",{key:0,onLoad:t[0]||(t[0]=(...t)=>e.prepareImageData&&e.prepareImageData(...t)),id:"screenshot2",class:"original-image",style:{},src:e.url+"&reload="+e.image_reload,alt:"Original Image",width:e.width},null,40,M)):(0,a.Q3)("",!0),(0,a.Lk)("div",{class:"select-areas--overlay",style:(0,s.Tr)({opacity:e.opacityOverlay,position:"absolute",width:e.originImgSize.w+"px",height:e.originImgSize.h+"px",display:"block"})},null,4),"debug_on"===e.mode?((0,a.uX)(!0),(0,a.CE)(a.FK,{key:1},(0,a.pI)(e.areas,(t=>((0,a.uX)(),(0,a.CE)("div",{key:t.id},[(0,a.Lk)("div",null,[(0,a.Lk)("div",{class:"select-areas--outline outline",style:(0,s.Tr)({opacity:e.opacityOutline,position:"absolute",cursor:"default",width:t.width+2+"px",height:t.height+2+"px",left:e.areaDisplayPosX(t)+"px",top:e.areaDisplayPosY(t)+"px","z-index":t.z,"font-size":t.font_size+"px"})},null,4),(0,a.Lk)("div",{class:"select-areas--background_area",style:(0,s.Tr)({position:"absolute",cursor:"pointer",width:t.width+3+"px",height:t.height+"px",left:e.areaDisplayPosX(t)+"px",top:e.areaDisplayPosY(t)+"px","z-index":t.z+2,"font-size":t.font_size+"px"})},[(0,a.eW)((0,s.v_)(t.text),1),(0,a.bF)(l,null,{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.fieldDef,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t},[(0,a.eW)((0,s.v_)(t)+" : "+(0,s.v_)(e),1),V])))),128))])),_:2},1024)],4)])])))),128)):"ocr"===e.mode?((0,a.uX)(!0),(0,a.CE)(a.FK,{key:2},(0,a.pI)(e.areas,(t=>((0,a.uX)(),(0,a.CE)("div",{key:t.id},[(0,a.Lk)("div",null,[(0,a.Lk)("div",{class:"select-areas--outline",style:(0,s.Tr)({opacity:e.opacityOutline,position:"absolute",cursor:"default",width:t.width+2+"px",height:t.height+2+"px",left:e.areaDisplayPosX(t)+"px",top:e.areaDisplayPosY(t)+"px","z-index":t.z,"font-size":t.font_size+"px"})},null,4),(0,a.Lk)("div",{class:"select-areas--background_area",style:(0,s.Tr)({position:"absolute",cursor:"pointer",width:t.width+3+"px",height:t.height+"px",left:e.areaDisplayPosX(t)+"px",top:e.areaDisplayPosY(t)+"px","z-index":t.z+2,"font-size":t.font_size+"px"})},(0,s.v_)(t.text),5)])])))),128)):(0,a.Q3)("",!0),(0,a.Lk)("div",j,[(0,a.Lk)("img",{id:"c-crop--hide_img",src:e.url,alt:"",width:e.width},null,8,G)])],4)}var Z=i(53500),ee=i(92162),te=function(e,t,i,a){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(t){o(t)}}function n(e){try{l(a["throw"](e))}catch(t){o(t)}}function l(e){e.done?i(e.value):s(e.value).then(r,n)}l((a=a.apply(e,t||[])).next())}))};let ie,ae;const se=(0,a.pM)({mixins:[S.A],data(){return{originImgSize:{w:0,h:0,r:0},url:this.cropUrl,posImg:{top:0,left:0},areas:[],scrollLeft:0,scrollTop:0,imageHeight:0,imageWidth:0,image_reload:1,item_loaded:!1,opacityOverlay:1}},props:{cropUrl:{type:String,default:"https://dev.doc2api.cloudintegration.eu/resource/image/1b90b6d5-63b5-446b-92a4-a60d57dc0edd/1.png"},width:{type:Number,default:1500},height:{type:Number,default:1500},opacityOutline:{type:Number,default:.2},posCorrection:{type:Boolean,default:!1},tableAreas:[],isReadOnly:{type:Boolean,default:!0},mode:{type:String,default:"ocr"},token_len:{type:String}},components:{},watch:{cropUrl(e){return te(this,void 0,void 0,(function*(){this.url=e,yield this.setSize(),this.image_reload++}))},width(e){return te(this,void 0,void 0,(function*(){yield this.setSize(),this.image_reload++}))},mode(e){this.opacityOverlay="doc"===e?0:1}},setup(){return{is_debug:(0,X.KR)(!0)}},updated:(0,Z.A)((()=>{ie.$nextTick((function(){let e=document.querySelectorAll(".select-areas--outline");e.length===ie.token_len&&1==ie.item_loaded&&(ie.hideLoading(),ie.item_loaded=!1)}))}),500),methods:{isDebugFlagHandler(){this.is_debug=!1,this.$route.query&&"true"===this.$route.query.is_debug&&(this.is_debug=!0)},areaDisplayPosX(e){return e.x+(this.posCorrection?this.posImg.left:0)},areaDisplayPosY(e){return e.y+(this.posCorrection?this.posImg.top:0)},mousePosX(e){return e.pageX-this.posImg.left},mousePosY(e){return e.pageY-this.posImg.top},setSize(){return te(this,void 0,void 0,(function*(){if(!this.url)return;let e=yield this.getSize(this.url);this.originImgSize=e}))},getSize(e){let t=this.$el.querySelector("#c-crop--hide_img");return new Promise((i=>{e&&t?(t.onload=function(){const e=ie.getSizeImg(t);i(e)},t.src=e):i({w:0,h:0,r:0})}))},getSizeImg(e){let t=e.width,i=e.height,a=0===t&&0===i?0:t/i;return{w:t,h:i,r:a}},calcPosOfBox(){let e=this.$refs["image-area"];this.scrollLeft=window.pageXOffset||document.documentElement.scrollLeft,this.scrollTop=window.pageYOffset||document.documentElement.scrollTop;let t=e.getBoundingClientRect().top,i=e.getBoundingClientRect().left;this.posImg.top=t+this.scrollTop,this.posImg.left=i+this.scrollLeft},creatReactangle(e,t,i,a,s,o){let r=null;if(r=this.areas.length>0?this.areas.slice(-1).pop().id+1:1,r){let n=14;s.hasOwnProperty("font_size")&&(n=Math.floor(this.imageWidth*s.font_size));let l={id:r,x:e,y:t,width:i,height:a,z:0,resizable:!1,fieldDef:s,text:s.text,font_size:n,key:o};this.areas.push(l)}},prepareImageData(){let e=(0,ee.$)("#screenshot2");e&&(this.imageWidth=e.offsetWidth,this.imageHeight=e.offsetHeight,this.prepareDataForAreas())},prepareDataForAreas(){try{if(this.item_loaded=!0,this.showLoading(),this.areas=[],!this.tableAreas)return;for(const e in this.tableAreas){let t=this.tableAreas[e],i=Math.floor(this.imageWidth*t.normalizedX0),a=Math.floor(this.imageHeight*t.normalizedY0),s=Math.floor(this.imageWidth*t.normalizedX1),o=Math.floor(this.imageHeight*t.normalizedY1),r=s-i,n=o-a;this.creatReactangle(i,a,r,n,t,e)}}catch(e){logError(e)}finally{this.hideLoading()}}},mounted(){ie=this,this.setSize(),ae=(0,ee.$)("#image_area"),ae.addEventListener("scroll",this.calcPosOfBox),this.calcPosOfBox()},unmounted:function(){ae.removeEventListener("scroll",this.calcPosOfBox)}});var oe=i(12807),re=i(97410),ne=i(67156),le=i(98582),de=i.n(le);const ce=(0,oe.A)(se,[["render",J],["__scopeId","data-v-a1ef8fa2"]]),he=ce;de()(se,"components",{QTooltip:re.A,QField:ne.A});var ue=i(89156),ge=i(45022),me=i(23537),pe=i(85487),fe=function(e,t,i,a){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(t){o(t)}}function n(e){try{l(a["throw"](e))}catch(t){o(t)}}function l(e){e.done?i(e.value):s(e.value).then(r,n)}l((a=a.apply(e,t||[])).next())}))};const _e=document.querySelector.bind(document),ye=(0,a.pM)({el:"#app",mixins:[S.A,C.A],props:{},components:{OcrTokenAreas:he,Loader:ue.A},data(){return{docId:"",doc_data_name:"",imageHeight:0,imageWidth:0,filename:"",ocr_mode:["doc","debug_on"],doc_mode:["ocr","debug_on"],debug_on_mode:["ocr","doc"]}},setup(){let{locale:e}=(0,me.s9)({useScope:"global"}),t={},i=[];const a=(0,W.q3)(),{getDocumentById:s}=a,{record:o}=(0,E.bP)(a),r=(0,W._6)(),{tokenQueryParam:n}=(0,E.bP)(r);return r.getTokenQueryParam(),{getDocumentById:s,record:o,locale:(0,X.KR)(e),apiData:(0,X.KR)(t),page_number:(0,X.KR)(""),images:(0,X.KR)(i),baseUrl:T.VA,image:(0,X.KR)(""),tokens:(0,X.KR)(i),alert_counts:(0,X.KR)(i),mode:(0,X.KR)("ocr"),tokenQueryParam:n}},mounted(){let e=ge.A.getItem("selected_language");this.locale=e||"de",this.docId=this.$route.params.id,this.page_number=this.$route.params.page_number,this.init()},methods:{init(){return fe(this,void 0,void 0,(function*(){try{this.showLoading(),N(Q(this.docId)),this.doc_data_name=$();let e=!1,t=H(this.docId);null!==t&&this.updateLocalData(t),this.isPageNumberOcrDataExist(this.page_number)||(e=!0),e&&(yield this.getDocumentOcrData()),this.apiData&&this.apiData.hasOwnProperty(this.doc_data_name)&&this.apiData[this.doc_data_name].hasOwnProperty("images")||(yield this.getInvoiceDataByDocId()),this.setImages(),this.filename=this.apiData[this.doc_data_name]&&this.apiData[this.doc_data_name].filename?this.apiData[this.doc_data_name].filename:"",this.renderView()}catch(e){logError(e),this.showErrorToast("Something went wrong while loading data. Please try again."),this.hideLoading()}}))},updateLocalData(e,t="-1"){if("-1"!==t)return this.apiData[t]=e,void K(e,t,this.docId);this.apiData=e},isPageNumberOcrDataExist(e="0"){return!("0"===e||(0,F.dd)(this.apiData)||!this.apiData.hasOwnProperty(e)||(0,F.dd)(this.apiData[e])||!this.apiData[e].hasOwnProperty("tokens")||!Array.isArray(this.apiData[e].tokens)||0==this.apiData[e].tokens.length)},getDocumentOcrData(){return fe(this,void 0,void 0,(function*(){if(!this.page_number)throw{message:"Page Number is missing"};let e;this.page_number=this.page_number.toString();let t=new FormData;t.append("page_number",this.page_number),t.append("include_font_size",(!0).toString()),t.append("org_id",(0,pe.I)());let i=yield(0,T.L3)();if(e=yield O.A.post(T.FH.get_ocr_data+this.docId,t,{headers:{Authorization:i}}),!0!==e.data.success)throw{message:e.data.message};this.updateLocalData(e.data.data,this.page_number)}))},getInvoiceDataByDocId(){return fe(this,void 0,void 0,(function*(){try{this.docId;if(yield this.getDocumentById(this.docId),!this.record.doc_id)throw{message:this.$t("pages.messages.INVALID_DOCUMENT")};this.updateLocalData(this.record,this.doc_data_name)}catch(e){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(e)}}))},setImages(){const e=Number(this.page_number)-1;this.image=this.baseUrl+"/"+(0,U.v)(this.apiData[this.doc_data_name].images[e].path),this.images=(0,U.m)(this.apiData[this.doc_data_name].images)},currentPage(){return this.page_number},setImageDimensions(){const e=_e("#image_container");e&&(this.imageWidth=e.offsetWidth,this.imageHeight=e.offsetHeight)},imageclicked(e){return fe(this,void 0,void 0,(function*(){try{this.showLoading(),this.image=this.baseUrl+"/"+(0,U.v)(this.apiData[this.doc_data_name].images[e].path),this.page_number=String(parseInt(e)+1),this.isPageNumberOcrDataExist(this.page_number)||(yield this.getDocumentOcrData()),this.renderView()}catch(t){logError(t),this.showErrorToast("Something went wrong while loading data. Please try again."),this.hideLoading()}}))},renderView(){this.setImageDimensions(),this.setTokens()},windowResize(){setTimeout((()=>{this.setImageDimensions()}),0)},toggler(){this.windowResize()},setTokens(){this.isPageNumberOcrDataExist(this.page_number)&&(this.tokens=this.apiData[this.page_number].tokens)}}});var ve=i(56384);const we=(0,oe.A)(ye,[["render",A],["__scopeId","data-v-199864d1"]]),ke=we;de()(ye,"components",{QBtn:ve.A,QTooltip:re.A})}}]);