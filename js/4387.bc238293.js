"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[4387],{44387:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Ds});var s=i(61758),o=i(58790),a=i(29104);const n=e=>((0,s.Qi)("data-v-2d3e301a"),e=e(),(0,s.jt)(),e),l={class:"row"},r={class:"col-12 q-pl-sm q-mt-sm"},c={key:0,class:"row"},d={key:1,class:"full-width"},h={class:"h-m-r-10",id:"po-container-parrent",style:{"border-right":"1px solid #9f9d9d"}},u={class:"row"},_={class:"po-nav-width q-pr-md row"},m={class:"q-mr-auto q-mt-sm"},p={style:{"vertical-align":"middle","margin-left":"10px","font-size":"20px",cursor:"pointer"}},g={class:"float-right mode-banner"},b={key:0,class:"table-mode mode-on"},f={class:"q-ml-auto q-mt-sm"},y=n((()=>(0,s.Lk)("img",{width:"20",height:"20",src:"images/accounting-white.svg"},null,-1))),v={key:0,class:"row ml-10"},k={class:"col-sm-12 col-md-12 col-lg-12 secondary-c-text"},w={class:"row ml-10 po-page-height scrolle-y"},C={class:"col-6 q-mb-md",id:"search-po"},P=["innerHTML"],L={class:"col-6 q-mb-md center-inner"},O={class:"col-sm-12"},E={class:"full-width scrolle-y po-container back-white"},T={class:"full-width row justify-between"},I={class:"row"},D={key:0,class:"row justify-center items-center"},A={key:1,class:"row q-pa-sm"},F={key:0,class:"full-width"},x=n((()=>(0,s.Lk)("div",{class:"q-mt-sm q-ma-sm"},null,-1))),S={class:"row q-pa-sm"},R={class:"col-sm-12 col-md-12 col-lg-12 pr-6 row"},M={key:0,class:"q-mr-auto"},N={key:1,class:"q-mr-auto"},q={class:"q-ml-auto"},U={key:1,class:"q-pr-sm text-red-14"},$={key:0,class:"full-width back-white"},Q={key:1,class:"full-width back-white"},V={style:{"margin-left":"-13px",top:"10px"}},K={style:{"margin-left":"-5.5px",top:"40%"}},j={class:""},W={class:"po-right-container q-pr-md q-mt-sm",id:"po-image-container"},X=n((()=>(0,s.Lk)("span",{class:"q-ml-sm"},"PO and AB are not same Please choose action.",-1))),B={class:"q-ml-sm"},H={class:"q-ml-sm"},z=n((()=>(0,s.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1))),Y=n((()=>(0,s.Lk)("span",{class:"q-ml-sm"},"On resync, you may lose PO connections.",-1)));function J(e,t,i,n,J,G){const Z=(0,s.g2)("DocumentLock"),ee=(0,s.g2)("MessageBanner"),te=(0,s.g2)("SubHeader"),ie=(0,s.g2)("ErrorDocumentView"),se=(0,s.g2)("q-icon"),oe=(0,s.g2)("q-btn"),ae=(0,s.g2)("DocumentAutoSaveNotify"),ne=(0,s.g2)("q-tooltip"),le=(0,s.g2)("f-btn"),re=(0,s.g2)("TaskBtn"),ce=(0,s.g2)("CreateTaskBtn"),de=(0,s.g2)("SyncPOData"),he=(0,s.g2)("exportBtns"),ue=(0,s.g2)("q-item-label"),_e=(0,s.g2)("q-item-section"),me=(0,s.g2)("q-item"),pe=(0,s.g2)("AdvanceFilter"),ge=(0,s.g2)("q-menu"),be=(0,s.g2)("q-select"),fe=(0,s.g2)("q-toggle"),ye=(0,s.g2)("q-list"),ve=(0,s.g2)("q-tab"),ke=(0,s.g2)("PoTableColumnsSettings"),we=(0,s.g2)("q-tabs"),Ce=(0,s.g2)("q-separator"),Pe=(0,s.g2)("PurchaseOrder"),Le=(0,s.g2)("q-tab-panel"),Oe=(0,s.g2)("q-tab-panels"),Ee=(0,s.g2)("q-markup-table"),Te=(0,s.g2)("LineItems"),Ie=(0,s.g2)("RceiveDeliveryLines"),De=(0,s.g2)("draggable"),Ae=(0,s.g2)("ImageComponent"),Fe=(0,s.g2)("q-splitter"),xe=(0,s.g2)("keyboardShortcutInfo"),Se=(0,s.g2)("q-card-actions"),Re=(0,s.g2)("q-card"),Me=(0,s.g2)("q-dialog"),Ne=(0,s.g2)("q-avatar"),qe=(0,s.g2)("q-card-section"),Ue=(0,s.g2)("q-inner-loading"),$e=(0,s.g2)("PurchaseOrderPreview"),Qe=(0,s.g2)("q-toolbar-title"),Ve=(0,s.g2)("q-toolbar"),Ke=(0,s.gN)("close-popup");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(Z,{document_version:e.document_version,trigger_document_lock:e.trigger_document_lock,doc_id:e.docId},null,8,["document_version","trigger_document_lock","doc_id"]),e.is_view_readonly?((0,s.uX)(),(0,s.Wv)(ee,{key:0,message:e.error_message,messageCategoryClass:"error-banner"},null,8,["message"])):(0,s.Q3)("",!0),(0,s.bF)(te,{name:"po_matching",label:e.$t("po_matching"),show_expiry_alert:!0,onSearch:!1},null,8,["label"]),(0,s.Lk)("div",l,[(0,s.Lk)("div",r,[e.doc_fetch_error?((0,s.uX)(),(0,s.CE)("div",c,[(0,s.bF)(ie)])):((0,s.uX)(),(0,s.CE)("div",d,[(0,s.bF)(Fe,{limits:[30,100],modelValue:e.imageFieldSplitter,"onUpdate:modelValue":[t[15]||(t[15]=t=>e.imageFieldSplitter=t),t[16]||(t[16]=t=>e.splitterChanged())],class:"po-left-container"},{before:(0,s.k6)((()=>[(0,s.Lk)("div",h,[(0,s.Lk)("div",u,[(0,s.Lk)("div",_,[(0,s.Lk)("div",m,[!1===e.ext_table_train?((0,s.uX)(),(0,s.Wv)(oe,{key:0,flat:"",rounded:"",color:"primary",onClick:t[0]||(t[0]=t=>e.routeToBack()),class:"po_iterateable_item"},{default:(0,s.k6)((()=>[(0,s.bF)(se,{name:"fa-solid fa-circle-arrow-left",size:"sm"}),(0,s.Lk)("label",p,(0,o.v_)(e.$t("back")),1)])),_:1})):(0,s.Q3)("",!0),(0,s.Lk)("span",g,[e.allowPOTableDrag?((0,s.uX)(),(0,s.CE)("span",b,(0,o.v_)(e.$t("po_table_drag_mode")),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",f,[(0,s.Lk)("span",null,[(0,s.bF)(ae)]),(0,s.bF)(le,{id:"help_po_btn",class:"q-mr-sm q-ml-sm",icon:"question_mark",onClick:e.goToHelp},{default:(0,s.k6)((()=>[(0,s.bF)(ne,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("help")),1)])),_:1})])),_:1},8,["onClick"]),e.is_view_readonly?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(le,{key:0,id:"keyboard_po_btn",class:"q-mr-sm",icon:"keyboard",onClick:t[1]||(t[1]=t=>e.showKeyboardShortcuts=!0)},{default:(0,s.k6)((()=>[(0,s.bF)(ne,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("keyboard_shortcut")),1)])),_:1})])),_:1})),e.is_view_readonly?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(le,{key:1,id:"po_training_mode_btn",class:"q-mr-sm",icon:"backup_table",onClick:t[2]||(t[2]=t=>e.allowPOTableDrag=!0!==e.allowPOTableDrag)},{default:(0,s.k6)((()=>[(0,s.bF)(ne,null,{default:(0,s.k6)((()=>[!0===e.allowPOTableDrag?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,o.v_)(e.$t("po_training_mode_off")),1)],64)):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.eW)((0,o.v_)(e.$t("po_training_mode_on")),1)],64))])),_:1})])),_:1})),e.is_view_readonly?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[(0,s.bF)(re,{is_f_btn:!0,onBtnClicked:t[3]||(t[3]=t=>e.gotoTaskPendingList())}),(0,s.bF)(ce,{is_icon_button:!0})],64)),e.record.hasOwnProperty("accounting")?((0,s.uX)(),(0,s.Wv)(le,{key:3,class:"q-pl-sm q-pr-sm q-mr-sm",to:"/accounting/"+e.docId},{default:(0,s.k6)((()=>[y,(0,s.bF)(ne,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("auto_accounting")),1)])),_:1})])),_:1},8,["to"])):(0,s.Q3)("",!0),e.is_view_readonly?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(le,{key:4,id:"auto_po_match_btn",class:"q-mr-sm",icon:"img:images/magic_wand.svg",onClick:e.autoPoMatch},{default:(0,s.k6)((()=>[(0,s.bF)(ne,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("auto_po_match")),1)])),_:1})])),_:1},8,["onClick"])),!0===e.ext_table_train?((0,s.uX)(),(0,s.CE)(s.FK,{key:5},[e.is_view_readonly?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(le,{key:0,class:"q-mr-sm",onClick:t[4]||(t[4]=t=>e.saveExtAppData(!0)),icon:"save"},{default:(0,s.k6)((()=>[(0,s.bF)(ne,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("save")),1)])),_:1})])),_:1}))],64)):((0,s.uX)(),(0,s.CE)(s.FK,{key:6},[e.is_view_readonly?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(le,{key:0,id:"save_po_btn",class:"q-mr-sm",onClick:t[5]||(t[5]=t=>e.saveData()),icon:"save"},{default:(0,s.k6)((()=>[(0,s.bF)(ne,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("save")),1)])),_:1})])),_:1}))],64)),e.is_view_readonly?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(de,{key:7,is_module_on:"invoice_open_quantity"==e.po_quantity_column,poNumber:e.tab,onRefreshAlreadyAddedItem:e.refreshAlreadyAddedItem},null,8,["is_module_on","poNumber","onRefreshAlreadyAddedItem"])),e.is_view_readonly?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(he,{key:8,ref:"exportBtns"},null,512))])])]),e.allowPOTableDrag&&!e.is_view_readonly?((0,s.uX)(),(0,s.CE)("div",v,[(0,s.Lk)("div",k,[(0,s.bF)(se,{name:"info",size:"sm"}),(0,s.Lk)("span",null,(0,o.v_)(e.$t("po_table_drag_drop")),1)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",w,[(0,s.Lk)("div",C,[(0,s.bF)(be,{dense:"",outlined:"","use-input":"","emit-value":"","map-options":"",tabindex:"0",loading:e.poLoading,"input-debounce":"0","hide-dropdown-icon":"",disable:e.is_view_readonly,modelValue:e.po_search_keyword,"onUpdate:modelValue":[t[8]||(t[8]=t=>e.po_search_keyword=t),e.getSelectedPOitems],options:e.po_number_options,onFilter:e.searchPurchaseOrderList,onKeyup:(0,a.jR)(e.triggerPoSearch,["enter"]),label:e.$t("search_po_label"),class:"back-white po_iterateable_item max-width-500 q-mt-md"},{option:(0,s.k6)((t=>[(0,s.bF)(me,(0,o._B)((0,s.Ng)(t.itemProps)),{default:(0,s.k6)((()=>[(0,s.bF)(_e,null,{default:(0,s.k6)((()=>[(0,s.bF)(ue,null,{default:(0,s.k6)((()=>[(0,s.Lk)("span",{innerHTML:e.displayPONumbersAsOption(t.opt.label)},null,8,P)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),append:(0,s.k6)((()=>[e.po_search&&""!=e.po_search?((0,s.uX)(),(0,s.Wv)(se,{key:0,name:"close",onClick:(0,a.D$)(e.clearSearch,["stop"]),class:"cursor-pointer"},null,8,["onClick"])):(0,s.Q3)("",!0),(0,s.bF)(le,{icon:"tune",appearance:"flat",onClick:t[7]||(t[7]=t=>e.initFilterModel())},{default:(0,s.k6)((()=>[(0,s.bF)(ge,{fit:"",modelValue:e.showAdanceFilter,"onUpdate:modelValue":t[6]||(t[6]=t=>e.showAdanceFilter=t),style:{"max-width":"500px"},anchor:"bottom start",self:"top left",offset:[453,10]},{default:(0,s.k6)((()=>[(0,s.bF)(pe,{onDisplayAdvanceFilterResults:e.displayAdvanceFilterResults,classes:"col-6 q-pa-sm"},null,8,["onDisplayAdvanceFilterResults"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["loading","disable","modelValue","options","onFilter","onUpdate:modelValue","onKeyup","label"])]),(0,s.Lk)("div",L,[(0,s.bF)(fe,{disable:e.is_view_readonly,class:"float-right",modelValue:e.user_settings[e.po_auto_match_and_export],"onUpdate:modelValue":[t[9]||(t[9]=t=>e.user_settings[e.po_auto_match_and_export]=t),t[10]||(t[10]=t=>{e.updateSetting(e.po_auto_match_and_export,t)})],label:e.$t("po_auto_match_and_export"),"left-label":!0},null,8,["disable","modelValue","label"])]),(0,s.Lk)("div",O,[(0,s.Lk)("div",E,[e.hasPoItems?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.bF)(we,{modelValue:e.tab,"onUpdate:modelValue":t[11]||(t[11]=t=>e.tab=t),class:"text-weight-bold align-tabs-left"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",T,[(0,s.Lk)("div",I,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.po_items,((t,i)=>((0,s.uX)(),(0,s.Wv)(ve,{draggable:"false",class:"text-left po-tab",key:i,name:i,"data-name":i,label:i,tabindex:"0"},{default:(0,s.k6)((()=>[(0,s.bF)(se,{class:"q-pl-sm",name:"refresh",onClick:t=>e.confirmRefreshData(i)},{default:(0,s.k6)((()=>[(0,s.bF)(ne,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("refresh")),1)])),_:1})])),_:2},1032,["onClick"]),e.isDeleteAble(i)?((0,s.uX)(),(0,s.Wv)(se,{key:0,class:"q-pl-sm",name:"fa fa-times",onClick:t=>e.proceedToCloseTab(i)},{default:(0,s.k6)((()=>[(0,s.bF)(ne,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("delete")),1)])),_:1})])),_:2},1032,["onClick"])):(0,s.Q3)("",!0),(0,s.bF)(ge,{"context-menu":""},{default:(0,s.k6)((()=>[(0,s.bF)(ye,null,{default:(0,s.k6)((()=>[(0,s.bo)(((0,s.uX)(),(0,s.Wv)(me,{clickable:"",onClick:t=>e.copyToClipboard(i)},{default:(0,s.k6)((()=>[(0,s.bF)(_e,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("copy_to_clipboard")),1)])),_:1})])),_:2},1032,["onClick"])),[[Ke]])])),_:2},1024)])),_:2},1024)])),_:2},1032,["name","data-name","label"])))),128))]),e.is_view_readonly?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",D,[(0,s.bF)(ke,{po_columns_attr:e.po_table_columns+"_"+e.record.doc_type,onColumnsDataUpdated:e.updatePoTabs},null,8,["po_columns_attr","onColumnsDataUpdated"])]))])])),_:1},8,["modelValue"]),(0,s.bF)(Ce),e.visible_columns&&Object.keys(e.visible_columns).length>0?((0,s.uX)(),(0,s.Wv)(Oe,{modelValue:e.tab,"onUpdate:modelValue":t[12]||(t[12]=t=>e.tab=t),key:e.tabsKey},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.po_items,((t,i)=>((0,s.uX)(),(0,s.Wv)(Le,{key:i,name:i},{default:(0,s.k6)((()=>[(0,s.bF)(Pe,{po_lines:t,po_number:i,visible_columns:e.visible_columns,allowPOTableDrag:e.allowPOTableDrag},null,8,["po_lines","po_number","visible_columns","allowPOTableDrag"])])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue"])):(0,s.Q3)("",!0)],64)):((0,s.uX)(),(0,s.CE)("div",A,[(0,s.bF)(Ee,{class:"full-width"},{default:(0,s.k6)((()=>[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,(0,o.v_)(e.$t("no_po_line_items_found")),1)])])])),_:1})]))]),e.dragableItems&&e.dragableItems.length>0?((0,s.uX)(),(0,s.CE)("div",F,[(0,s.bF)(De,{class:"draggable-list",itemKey:"componentName",handle:".drag-handle",list:e.dragableItems,group:{name:"po-tables",pull:!1,put:!1},sort:!0,"ghost-class":"sortable__ghost",onChange:e.itemSorted},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.dragableItems,(i=>((0,s.uX)(),(0,s.CE)("div",{key:i.componentName,class:"full-width scrolle-y"},[x,(0,s.Lk)("div",S,[(0,s.Lk)("div",R,["LineItems"==i.componentName?((0,s.uX)(),(0,s.CE)("div",M,(0,o.v_)(e.setDisplayDocType(e.doc_type_key)),1)):((0,s.uX)(),(0,s.CE)("div",N,(0,o.v_)(i.title),1)),(0,s.Lk)("div",q,[(0,s.bF)(se,{name:"drag_indicator",class:"float-right secondary-c-text-grey text-h6 cursor-move drag-handle"}),"PO_CONVERTED_TABLE"===e.table_name&&"LineItems"==i.componentName?((0,s.uX)(),(0,s.Wv)(se,{key:0,name:"delete",class:"float-right secondary-c-text-grey text-h6 cursor-pointer",onClick:t[13]||(t[13]=t=>e.delete_table_confirmation=!0)},{default:(0,s.k6)((()=>[(0,s.bF)(ne,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("delete_table")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0),"PO_CONVERTED_TABLE"===e.table_name&&"LineItems"==i.componentName?((0,s.uX)(),(0,s.CE)("span",U,(0,o.v_)(e.$t("pages.messages.TABLE_FORMED_BY_PO")),1)):(0,s.Q3)("",!0)])])]),(0,s.bF)(Ce),"LineItems"==i.componentName?((0,s.uX)(),(0,s.CE)("div",$,[(0,s.bF)(Te,{ref_for:!0,ref:"lineItemsPoV3",allowPOTableDrag:e.allowPOTableDrag},null,8,["allowPOTableDrag"])])):"RceiveDeliveryLines"==i.componentName?((0,s.uX)(),(0,s.CE)("div",Q,[(0,s.bF)(Ie,{purchaseOrderNumber:e.tab,poItems:e.po_items},null,8,["purchaseOrderNumber","poItems"])])):(0,s.Q3)("",!0)])))),128))])),_:1},8,["list","onChange"])])):(0,s.Q3)("",!0)])])])])),separator:(0,s.k6)((()=>[(0,s.Lk)("div",V,[(0,s.bF)(oe,{round:"",unelevated:"",size:"xs",icon:e.imageFieldSplitter>=90?"chevron_left":"chevron_right",class:"panel-expand-button highlighted-back shadow-2",onClick:t[14]||(t[14]=t=>e.toggleImageArea())},null,8,["icon"])]),(0,s.Lk)("div",K,[(0,s.bF)(se,{name:"drag_handle",size:"md",class:"icon-grey rotate-90"})])])),after:(0,s.k6)((()=>[(0,s.Lk)("div",j,[(0,s.Lk)("div",W,[(0,s.bF)(Ae,{renderOpenWindoIcon:!0,dynamicWidth:e.dynamicWidth,docName:e.record.filename,docImages:e.record.images},null,8,["dynamicWidth","docName","docImages"])])])])),_:1},8,["modelValue"])]))])]),(0,s.bF)(Me,{modelValue:e.showKeyboardShortcuts,"onUpdate:modelValue":t[18]||(t[18]=t=>e.showKeyboardShortcuts=t)},{default:(0,s.k6)((()=>[(0,s.bF)(Re,null,{default:(0,s.k6)((()=>[(0,s.bF)(xe),(0,s.bF)(Se,{align:"right"},{default:(0,s.k6)((()=>[(0,s.bF)(oe,{flat:"",color:"primary",label:e.$t("close"),class:"float-right",style:{"font-weight":"900"},onClick:t[17]||(t[17]=t=>e.showKeyboardShortcuts=!1)},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,s.bF)(Me,{modelValue:e.confirmDecision,"onUpdate:modelValue":t[21]||(t[21]=t=>e.confirmDecision=t),persistent:""},{default:(0,s.k6)((()=>[(0,s.bF)(Re,null,{default:(0,s.k6)((()=>[(0,s.bF)(qe,{class:"row items-center"},{default:(0,s.k6)((()=>[(0,s.bF)(Ne,{icon:"info",color:"primary","text-color":"white"}),X])),_:1}),(0,s.bF)(Se,{align:"right"},{default:(0,s.k6)((()=>[(0,s.bo)((0,s.bF)(oe,{flat:"",label:"Cancel",color:"primary"},null,512),[[Ke]]),(0,s.bo)((0,s.bF)(oe,{flat:"",label:"Close PO",color:"primary",onClick:t[19]||(t[19]=t=>e.setPOStatus("close"))},null,512),[[Ke]]),(0,s.bo)((0,s.bF)(oe,{flat:"",label:"Accept",color:"primary",onClick:t[20]||(t[20]=t=>e.setPOStatus("accept"))},null,512),[[Ke]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,s.bF)(Me,{modelValue:e.delete_tab_confirmation,"onUpdate:modelValue":t[24]||(t[24]=t=>e.delete_tab_confirmation=t),persistent:""},{default:(0,s.k6)((()=>[(0,s.bF)(Re,null,{default:(0,s.k6)((()=>[(0,s.bF)(qe,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,s.k6)((()=>[(0,s.bF)(Ne,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,s.bF)(qe,{class:"row items-center"},{default:(0,s.k6)((()=>[(0,s.Lk)("span",B,(0,o.v_)(e.$t("delete_po_tab")),1)])),_:1}),(0,s.bF)(Se,{align:"right"},{default:(0,s.k6)((()=>[(0,s.bo)((0,s.bF)(le,{appearance:"cancel",label:e.$t("cancel"),onClick:t[22]||(t[22]=t=>e.delete_tab_po_number="")},null,8,["label"]),[[Ke]]),(0,s.bo)((0,s.bF)(le,{"data-cy":"done",label:e.$t("proceed"),onClick:t[23]||(t[23]=t=>e.deletePoTab())},null,8,["label"]),[[Ke]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,s.bF)(Me,{modelValue:e.delete_table_confirmation,"onUpdate:modelValue":t[26]||(t[26]=t=>e.delete_table_confirmation=t),persistent:""},{default:(0,s.k6)((()=>[(0,s.bF)(Re,null,{default:(0,s.k6)((()=>[(0,s.bF)(qe,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,s.k6)((()=>[(0,s.bF)(Ne,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,s.bF)(qe,{class:"row items-center"},{default:(0,s.k6)((()=>[(0,s.Lk)("span",H,(0,o.v_)(e.$t("delete_po_tab")),1)])),_:1}),(0,s.bF)(Se,{align:"right"},{default:(0,s.k6)((()=>[(0,s.bo)((0,s.bF)(le,{appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[Ke]]),(0,s.bo)((0,s.bF)(le,{"data-cy":"done",label:e.$t("proceed"),onClick:t[25]||(t[25]=t=>e.deleteLineTable())},null,8,["label"]),[[Ke]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,s.bF)(Ue,{class:"main-loader",showing:e.processing,style:{"z-index":"2"}},{default:(0,s.k6)((()=>[z])),_:1},8,["showing"]),(0,s.bF)(Me,{modelValue:e.po_preview,"onUpdate:modelValue":t[27]||(t[27]=t=>e.po_preview=t),persistent:"","full-width":""},{default:(0,s.k6)((()=>[(0,s.bF)($e,{po_preview_columns:e.po_preview_columns,totalRecords:e.totalRecords,po_lines:e.po_preview_items,onClearSearch:e.clearSearch,onAddToPoItemsList:e.addToPoItemsList,onProceedPoSelection:e.proceedPoSelection,onDisplayAdvanceFilterResults:e.displayAdvanceFilterResults,onSearchPurchaseOrder:e.searchPurchaseOrder},null,8,["po_preview_columns","totalRecords","po_lines","onClearSearch","onAddToPoItemsList","onProceedPoSelection","onDisplayAdvanceFilterResults","onSearchPurchaseOrder"])])),_:1},8,["modelValue"]),(0,s.bF)(Me,{modelValue:e.showConfirmSyncDlg,"onUpdate:modelValue":t[29]||(t[29]=t=>e.showConfirmSyncDlg=t),persistent:""},{default:(0,s.k6)((()=>[(0,s.bF)(Re,null,{default:(0,s.k6)((()=>[(0,s.bF)(Ve,{class:"text-white secondary-toolbar"},{default:(0,s.k6)((()=>[(0,s.bF)(Qe,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("confirm")),1)])),_:1}),(0,s.bo)((0,s.bF)(oe,{flat:"",round:"",dense:"",icon:"close"},null,512),[[Ke]])])),_:1}),(0,s.bF)(qe,{class:"row items-center"},{default:(0,s.k6)((()=>[Y])),_:1}),(0,s.bF)(Se,{align:"right"},{default:(0,s.k6)((()=>[(0,s.bo)((0,s.bF)(le,{appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[Ke]]),(0,s.bo)((0,s.bF)(le,{label:e.$t("done"),onClick:t[28]||(t[28]=t=>e.refreshAlreadyAddedItem(e.poToRefresh))},null,8,["label"]),[[Ke]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var G=i(82303),Z=i(53500),ee=i(1659),te=i(24622),ie=i(92162),se=i(60521),oe=i(45938),ae=i(38734),ne=i(46162),le=i(41498),re=i(64775),ce=i(39231);const de=e=>((0,s.Qi)("data-v-7e4d5754"),e=e(),(0,s.jt)(),e),he=["src","onPointerover","onClick","onPointerleave"],ue=["innerHTML"],_e={class:"row q-ma-md border-dotted-1px max-width-240"},me={class:"col-7 q-pb-sm"},pe={class:"col-5 q-pb-sm q-pl-sm"},ge={class:"col-7 q-pb-sm"},be={class:"col-5 q-pb-sm q-pl-sm"},fe={class:"col-12"},ye={class:"float-right"},ve=de((()=>(0,s.Lk)("div",{class:"text-left sub-table"},"No multi-match Information",-1))),ke={class:"compact-table-tr",style:{"z-index":"0"}},we=de((()=>(0,s.Lk)("th",{class:"text-left"},null,-1))),Ce={class:"text-right data-td"},Pe={class:"text-right data-td"},Le={class:"text-right data-td"},Oe={class:"text-right data-td"},Ee=de((()=>(0,s.Lk)("th",{colspan:"20"},null,-1))),Te={class:"text-left data-td"},Ie={class:"text-right data-td"},De={class:"text-right data-td"},Ae={class:"text-right data-td"},Fe={class:"text-right data-td"},xe=de((()=>(0,s.Lk)("td",{colspan:"20"},null,-1))),Se={class:"compact-table-tr"},Re={class:"text-left data-td"},Me={key:0,class:"text-left data-td"},Ne={class:"text-left data-td"},qe={key:0},Ue={key:1},$e={class:"row q-pa-sm pr-12"},Qe=de((()=>(0,s.Lk)("div",{style:{width:"74%"}},null,-1))),Ve={style:{width:"26%"}},Ke={style:{float:"right"}},je={class:"row q-pa-sm pr-12"},We=de((()=>(0,s.Lk)("div",{style:{width:"74%"}},null,-1))),Xe={style:{width:"26%"}},Be={style:{float:"right"}},He={key:0,class:"row q-pa-sm pr-12"},ze=de((()=>(0,s.Lk)("div",{style:{width:"74%"}},null,-1))),Ye={style:{width:"26%"}},Je={style:{float:"right"}},Ge={class:"row q-pa-sm pr-12"},Ze={style:{width:"74%"}},et={style:{width:"26%"}},tt={style:{float:"right"}},it={class:"q-ml-sm"},st={class:"q-ml-sm"},ot={class:"text-h6"},at={class:"text-h6"};function nt(e,t,i,n,l,r){const c=(0,s.g2)("ColumnFilterBadges"),d=(0,s.g2)("ColumnFilter"),h=(0,s.g2)("q-tooltip"),u=(0,s.g2)("q-icon"),_=(0,s.g2)("q-th"),m=(0,s.g2)("q-tr"),p=(0,s.g2)("q-item-section"),g=(0,s.g2)("q-item"),b=(0,s.g2)("q-list"),f=(0,s.g2)("q-menu"),y=(0,s.g2)("q-img"),v=(0,s.g2)("f-btn"),k=(0,s.g2)("q-spinner"),w=(0,s.g2)("q-btn"),C=(0,s.g2)("q-td"),P=(0,s.g2)("q-input"),L=(0,s.g2)("q-select"),O=(0,s.g2)("q-markup-table"),E=(0,s.g2)("q-table"),T=(0,s.g2)("q-card-section"),I=(0,s.g2)("q-card-actions"),D=(0,s.g2)("q-card"),A=(0,s.g2)("q-dialog"),F=(0,s.g2)("q-avatar"),x=(0,s.g2)("Loader"),S=(0,s.gN)("close-popup");return(0,s.uX)(),(0,s.CE)(s.FK,null,[((0,s.uX)(),(0,s.CE)("div",{class:(0,o.C4)(["row q-pa-sm",!0===e.allowPOTableDrag?"po_table_drop_target":""]),key:e.renderKey},[(0,s.bF)(c,{class:"q-mb-sm",name:"InvoiceColumnFilter",onOnUpdateValue:t[0]||(t[0]=t=>{e.filterValueByField=Object.assign({},t)})}),e.hasLineItems()?((0,s.uX)(),(0,s.Wv)(E,{key:0,rows:e.filteredTableRows,columns:e.tableColumns,flat:"","row-key":"id","no-data-label":e.$t("pages.messages.no_record_found"),"rows-per-page-options":[0],id:"line_item_table",ref:"el",class:"text-uppercase sticky-header transparent-header table_height resizable",style:{"table-layout":"fixed !important",width:"100%"}},{header:(0,s.k6)((i=>[(0,s.bF)(m,{props:i},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.cols,((n,l)=>((0,s.uX)(),(0,s.Wv)(_,{key:n.name,props:i,class:"table-column-header",draggable:e.allowedColumnSorting(n),dropzone:e.allowedColumnSorting(n),"data-index":l,direction:"horizontal",onDragstart:t=>e.onDragStart(t,e.tableColumns,l),onDrop:(0,a.D$)((t=>e.handleDrop(t,l)),["prevent"]),onDragover:(0,a.D$)((t=>e.onDragOverWrapper(t,l,n.name)),["prevent"]),onDragenter:(0,a.D$)(e.onDragEnter,["prevent"]),onDragleave:(0,a.D$)(e.onDragLeave,["prevent"]),style:(0,o.Tr)({cursor:e.getIsDragging&&e.allowedColumnSorting(n)?"pointer":"move"})},{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(n.label)+" ",1),n.label&&"Actions"!==n.label?((0,s.uX)(),(0,s.Wv)(d,{key:0,name:"InvoiceColumnFilter",persist:!0,column:n.name,onOnUpdateValue:t[1]||(t[1]=t=>{e.filterValueByField=Object.assign({},t)})},null,8,["column"])):(0,s.Q3)("",!0),n.error?((0,s.uX)(),(0,s.Wv)(u,{key:1,title:e.$t("pages.screen2b.in_valid_column_error"),name:"priority_high",class:"headerError"},{default:(0,s.k6)((()=>[(0,s.bF)(h,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("pages.screen2b.in_valid_column_error")),1)])),_:1})])),_:1},8,["title"])):(0,s.Q3)("",!0)])),_:2},1032,["props","draggable","dropzone","data-index","onDragstart","onDrop","onDragover","onDragenter","onDragleave","style"])))),128))])),_:2},1032,["props"])])),body:(0,s.k6)((i=>[(0,s.bF)(m,{props:i,"data-id":i.key,class:(0,o.C4)(["compact-table-tr droptarget line-item-tr po_iterateable_item cursor-pointer",i.rowIndex%2==0?"":"alternative-row"]),tabindex:"0",onDrop:e.drop},{default:(0,s.k6)((()=>[e.record.editable&&!e.is_view_readonly&&e.po_line_id_for_match.length>0?((0,s.uX)(),(0,s.Wv)(f,{key:0,"touch-position":"","context-menu":""},{default:(0,s.k6)((()=>[(0,s.bF)(b,{dense:"",style:{"min-width":"100px"}},{default:(0,s.k6)((()=>[(0,s.bo)(((0,s.uX)(),(0,s.Wv)(g,{clickable:"",onClick:t=>e.connectWithSelectedPo(i.key)},{default:(0,s.k6)((()=>[(0,s.bF)(p,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("connect")),1)])),_:1})])),_:2},1032,["onClick"])),[[S]])])),_:2},1024)])),_:2},1024)):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.cols,(a=>((0,s.uX)(),(0,s.CE)(s.FK,{key:a.name},[""===a.label?((0,s.uX)(),(0,s.Wv)(C,{key:0,"data-id":i.key,class:"secondary-c-text"},{default:(0,s.k6)((()=>[e.isChargesModuleEnabled?((0,s.uX)(),(0,s.Wv)(y,{key:0,src:"images/charges/charges.svg",height:"21px",width:"19px",class:(0,o.C4)([i.row.costingElements&&0!=i.row.costingElements.length?"cursor-pointer":"item-disabled","icon-grey-svg"]),onClick:e=>i.row.show_charges=!i.row.show_charges},{default:(0,s.k6)((()=>[(0,s.bF)(h,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("charges")),1)])),_:1})])),_:2},1032,["class","onClick"])):(0,s.Q3)("",!0),(0,s.bF)(v,{appearance:"tertiary",onClick:e=>i.expand=!i.expand,icon:i.expand?"remove":"add"},null,8,["onClick","icon"]),e.isPurchaseOrderConnected(i.key)?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.bF)(u,{size:"sm",tabindex:"0",class:"cursor-pointer",onFocus:t=>e.showlineHighlighted(i.key),onBlur:t=>e.removedLineHighlight(i.key)},{default:(0,s.k6)((()=>[(0,s.Lk)("img",{width:"20",src:e.getConnectionSvg(i.key),onPointerover:t=>e.showlineHighlighted(i.key),onClick:t=>e.scrollToHightlightedLine(i.key),onPointerleave:t=>e.removedLineHighlight(i.key)},null,40,he),(0,s.bF)(h,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.getConnectionTitle(i.key))+" ",1),(0,s.Lk)("div",{innerHTML:e.getConnectionStatusDetails(i.key)},null,8,ue)])),_:2},1024)])),_:2},1032,["onFocus","onBlur"]),e.blockProcessing?((0,s.uX)(),(0,s.Wv)(k,{key:0,color:"primary",size:"2em",thickness:5})):(0,s.Q3)("",!0),e.is_view_readonly||!e.is_po_view||e.blockProcessing?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(w,{key:1,flat:"",tabindex:"0",color:"blue",onClick:t=>e.removePOConnection(i.key,!1),icon:"fa fa-times"},{default:(0,s.k6)((()=>[(0,s.bF)(h,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("remove_po_connection")),1)])),_:1})])),_:2},1032,["onClick"]))],64)):(0,s.Q3)("",!0)])),_:2},1032,["data-id"])):"Actions"===a.label?((0,s.uX)(),(0,s.Wv)(C,{key:1,"data-id":i.key,class:"secondary-c-text"},{default:(0,s.k6)((()=>[e.doc_attributes[e.custom_range_for_po_tolerance]?((0,s.uX)(),(0,s.Wv)(w,{key:0,flat:"",rounded:"",icon:"img:icons/load_balanacer.svg"},{default:(0,s.k6)((()=>[(0,s.bF)(h,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("tolerance")),1)])),_:1}),e.is_view_readonly?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(f,{key:0,fit:"",anchor:"bottom middle",onBeforeShow:t=>e.initToleranceForm(e.lineDataObj[i.key]["columns"]),self:"top middle",style:{"border-radius":"10px","box-shadow":"0 10px 44px 0 rgba(0, 0, 0, 0.07),0 2px 12px 0 rgba(0, 0, 0, 0.1),0 2px 4px 0 rgba(0, 0, 0, 0.04) !important"}},{default:(0,s.k6)((()=>[(0,s.Lk)("div",_e,[(0,s.Lk)("div",me,[(0,s.bF)(P,{outlined:"",disable:e.is_view_readonly,modelValue:e.toleranceModel["quantity_tolerance"],"onUpdate:modelValue":t[2]||(t[2]=t=>e.toleranceModel["quantity_tolerance"]=t),dense:"",label:e.$t("quantity_tolerance"),type:"number",rules:[t=>t>=1&&t<=100||e.toleranceModel["quantity_tolerance_type"]!=e.percent||e.$t("percentage_1_to_100")]},null,8,["disable","modelValue","label","rules"])]),(0,s.Lk)("div",pe,[(0,s.bF)(L,{outlined:"",dense:"",disable:e.is_view_readonly,"emit-value":"","map-options":"",class:"back-white",label:e.$t("unit"),modelValue:e.toleranceModel["quantity_tolerance_type"],"onUpdate:modelValue":t[3]||(t[3]=t=>e.toleranceModel["quantity_tolerance_type"]=t),options:e.po_tolerance_type},null,8,["disable","label","modelValue","options"])]),(0,s.Lk)("div",ge,[(0,s.bF)(P,{disable:e.is_view_readonly,outlined:"",modelValue:e.toleranceModel["unit_price_tolerance"],"onUpdate:modelValue":t[4]||(t[4]=t=>e.toleranceModel["unit_price_tolerance"]=t),dense:"",label:e.$t("unit_price_tolerance"),type:"number",rules:[t=>t>=1&&t<=100||e.toleranceModel["unit_price_tolerance_type"]!=e.percent||e.$t("percentage_1_to_100")]},null,8,["disable","modelValue","label","rules"])]),(0,s.Lk)("div",be,[(0,s.bF)(L,{disable:e.is_view_readonly,outlined:"",dense:"","emit-value":"","map-options":"",class:"back-white",label:e.$t("unit"),modelValue:e.toleranceModel["unit_price_tolerance_type"],"onUpdate:modelValue":t[5]||(t[5]=t=>e.toleranceModel["unit_price_tolerance_type"]=t),options:e.po_tolerance_type},null,8,["disable","label","modelValue","options"])]),(0,s.Lk)("div",fe,[(0,s.Lk)("span",ye,[e.is_view_readonly?(0,s.Q3)("",!0):(0,s.bo)(((0,s.uX)(),(0,s.Wv)(u,{key:0,name:"check_circle",size:"md",color:"positive",class:"cursor-pointer",onClick:t[6]||(t[6]=t=>e.saveToleranceLevel())},null,512)),[[S]]),e.is_view_readonly?(0,s.Q3)("",!0):(0,s.bo)(((0,s.uX)(),(0,s.Wv)(u,{key:1,name:"cancel",size:"md",color:"negative",class:"cursor-pointer"},null,512)),[[S]])])])])])),_:2},1032,["onBeforeShow"]))])),_:2},1024)):(0,s.Q3)("",!0),"PO_CONVERTED_TABLE"===e.table_name?((0,s.uX)(),(0,s.Wv)(u,{key:1,name:"delete",class:"float-right secondary-c-text-grey text-h6 cursor-pointer",onClick:t=>e.deleteLine(i.key)},{default:(0,s.k6)((()=>[(0,s.bF)(h,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("delete")),1)])),_:1})])),_:2},1032,["onClick"])):(0,s.Q3)("",!0)])),_:2},1032,["data-id"])):e.isColumnVisible(a.org_index,a)?((0,s.uX)(),(0,s.Wv)(C,{key:2,"data-id":i.key,id:"input_"+a.name+"_"+i.key},{default:(0,s.k6)((()=>["PO_CONVERTED_TABLE"===e.table_name?((0,s.uX)(),(0,s.Wv)(P,{key:0,tabindex:"-1","data-id":i.key,class:(0,o.C4)("input-field "),borderless:"",readonly:!!e.is_view_readonly||"PO_CONVERTED_TABLE"!==e.table_name,modelValue:e.lineDataObj[i.key]["columns"][a.name].formatted_value,"onUpdate:modelValue":t=>e.lineDataObj[i.key]["columns"][a.name].formatted_value=t,onChange:t=>e.inputValueChanges(a.name,i.key)},null,8,["data-id","readonly","modelValue","onUpdate:modelValue","onChange"])):((0,s.uX)(),(0,s.CE)("div",{key:1,class:(0,o.C4)(e.number_column_types.includes(a.dataType.toLowerCase())?"float-right pr-32":"")},(0,o.v_)(e.lineDataObj[i.key]["columns"][a.name].formatted_value),3))])),_:2},1032,["data-id","id"])):(0,s.Q3)("",!0)],64)))),128))])),_:2},1032,["props","data-id","class","onDrop"]),(0,s.bo)((0,s.bF)(m,{props:i},{default:(0,s.k6)((()=>[!e.po_connected_items[i.key]||e.po_connected_items[i.key].hasOwnProperty("po_line_id")?((0,s.uX)(),(0,s.Wv)(C,{key:0,colspan:"100%",class:"sub-table-main-td"},{default:(0,s.k6)((()=>[ve])),_:1})):((0,s.uX)(),(0,s.Wv)(C,{key:1,colspan:"5",class:"sub-table-main-td"},{default:(0,s.k6)((()=>[(0,s.bF)(O,{class:"sub-table",style:{"table-layout":"fixed",width:"100%"}},{default:(0,s.k6)((()=>[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",ke,[we,(0,s.Lk)("th",Ce,(0,o.v_)(e.$t("line_number")),1),(0,s.Lk)("th",Pe,(0,o.v_)(e.$t("purchase_order")),1),(0,s.Lk)("th",Le,(0,o.v_)(e.$t("quantity")),1),(0,s.Lk)("th",Oe,(0,o.v_)(e.$t("unit_price")),1),Ee])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.po_connected_items[i.key].sub_lines,((t,i)=>((0,s.uX)(),(0,s.CE)("tr",{key:t.po_line_id,class:(0,o.C4)(["compact-table-tr",i%2==0?"":"alternative-row"])},[(0,s.Lk)("td",Te,[!e.is_view_readonly&&e.is_po_view?((0,s.uX)(),(0,s.Wv)(w,{key:0,flat:"",tabindex:"0",color:"blue",onClick:i=>e.removePOConnection(t.po_line_id,!0),icon:"fa fa-times"},{default:(0,s.k6)((()=>[(0,s.bF)(h,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("remove_po_connection")),1)])),_:1})])),_:2},1032,["onClick"])):(0,s.Q3)("",!0)]),(0,s.Lk)("td",Ie,(0,o.v_)(t.line_number),1),(0,s.Lk)("td",De,(0,o.v_)(t.purchase_order_number),1),(0,s.Lk)("td",Ae,(0,o.v_)(e.getPoQuantity(e.PODataObj[t.po_line_id])),1),(0,s.Lk)("td",Fe,(0,o.v_)(e.getPoUnitPrice(e.PODataObj[t.po_line_id])),1),xe],2)))),128))])])),_:2},1024)])),_:2},1024))])),_:2},1032,["props"]),[[a.aG,i.expand]]),(0,s.bo)((0,s.bF)(m,{props:i},{default:(0,s.k6)((()=>[(0,s.bF)(C,{colspan:"100",class:"sub-table-main-td"},{default:(0,s.k6)((()=>[(0,s.bF)(O,{class:"sub-table gray-border"},{default:(0,s.k6)((()=>[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",Se,[(0,s.Lk)("th",Re,(0,o.v_)(e.$t("charge_id")),1),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.tableColumns,((e,t)=>((0,s.uX)(),(0,s.CE)(s.FK,{key:t},[e.label?((0,s.uX)(),(0,s.CE)("th",Me,(0,o.v_)(e.label),1)):(0,s.Q3)("",!0)],64)))),128))])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.row.costingElements,((t,i)=>((0,s.uX)(),(0,s.CE)(s.FK,{key:t.line_number},[t.costing_element?((0,s.uX)(),(0,s.CE)("tr",{key:0,class:(0,o.C4)(+i%2==0?"":"alternative-row")},[(0,s.Lk)("td",Ne,[(0,s.bF)(u,{name:"img:images/charges/"+e.costingElementDictionary[t.costing_element].icon,size:"xs",class:"q-mr-sm icon-grey-svg"},null,8,["name"]),(0,s.Lk)("span",null,(0,o.v_)(t.costing_element),1)]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.tableColumns,((i,a)=>((0,s.uX)(),(0,s.CE)(s.FK,{key:a},[i.label&&t[i.name]?((0,s.uX)(),(0,s.CE)("td",{key:0,class:(0,o.C4)(["data-td",e.getColumnAlignment(i)])},(0,o.v_)(t[i.name].formatted_value),3)):(0,s.Q3)("",!0)],64)))),128))],2)):(0,s.Q3)("",!0)],64)))),128))])])),_:2},1024)])),_:2},1024)])),_:2},1032,["props"]),[[a.aG,i.row.show_charges]])])),_:1},8,["rows","columns","no-data-label"])):((0,s.uX)(),(0,s.Wv)(O,{key:1,style:{height:"'200px'"},class:"full-width"},{default:(0,s.k6)((()=>[(0,s.Lk)("thead",null,[!1===e.lineItemsloading?((0,s.uX)(),(0,s.CE)("tr",qe,[(0,s.Lk)("th",null,(0,o.v_)(e.$t("no_line_items_found")),1)])):(0,s.Q3)("",!0),!0===e.lineItemsloading?((0,s.uX)(),(0,s.CE)("tr",Ue,[(0,s.Lk)("th",null,[(0,s.bF)(k,{color:"primary",size:"3em",thickness:10})])])):(0,s.Q3)("",!0)])])),_:1}))],2)),e.hasLineItems()?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.Lk)("div",$e,[Qe,(0,s.Lk)("div",Ve,[(0,s.Lk)("span",null,(0,o.v_)(e.$t("recorded_bookings"))+": ",1),(0,s.Lk)("span",Ke,(0,o.v_)(e.total_net_amount),1)])]),(0,s.Lk)("div",je,[We,(0,s.Lk)("div",Xe,[(0,s.Lk)("span",null,(0,o.v_)(e.$t("matched_total"))+": ",1),(0,s.Lk)("span",Be,(0,o.v_)(e.matched_total_amount),1)])]),e.isChargesModuleEnabled?((0,s.uX)(),(0,s.CE)("div",He,[ze,(0,s.Lk)("div",Ye,[(0,s.Lk)("span",null,(0,o.v_)(e.$t("charges"))+": ",1),(0,s.Lk)("span",Je,(0,o.v_)(e.charges_amount),1)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",Ge,[(0,s.Lk)("div",Ze,[e.amount_error?((0,s.uX)(),(0,s.Wv)(u,{key:0,flat:"",dense:"",name:"error",size:"20px",color:"red",class:"q-ml-sm",style:{float:"right"}},{default:(0,s.k6)((()=>[(0,s.bF)(h,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("total_amount_not_equal_to_line_items")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)]),(0,s.Lk)("div",et,[(0,s.Lk)("span",null,(0,o.v_)(e.$t("unsettled_amount"))+": ",1),(0,s.Lk)("span",tt,(0,o.v_)(e.pending_amount),1)])])],64)):(0,s.Q3)("",!0),(0,s.bF)(A,{modelValue:e.confirmDialog,"onUpdate:modelValue":t[7]||(t[7]=t=>e.confirmDialog=t),persistent:""},{default:(0,s.k6)((()=>[(0,s.bF)(D,null,{default:(0,s.k6)((()=>[(0,s.bF)(T,{class:"row items-center"},{default:(0,s.k6)((()=>[(0,s.Lk)("span",it,(0,o.v_)(e.$t("line_items_connection_overwrite")),1)])),_:1}),(0,s.bF)(I,{align:"right"},{default:(0,s.k6)((()=>[(0,s.bo)((0,s.bF)(w,{flat:"",label:"Cancel",color:"primary"},null,512),[[S]]),(0,s.bF)(w,{flat:"",label:"Connect anyway",color:"primary",onClick:e.removeExistingAndConnectNewPO},null,8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,s.bF)(A,{modelValue:e.poEditRestrictDialog,"onUpdate:modelValue":t[10]||(t[10]=t=>e.poEditRestrictDialog=t),persistent:""},{default:(0,s.k6)((()=>[(0,s.bF)(D,null,{default:(0,s.k6)((()=>[(0,s.bF)(T,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,s.k6)((()=>[(0,s.bF)(F,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,s.bF)(T,{class:"row items-center"},{default:(0,s.k6)((()=>[(0,s.Lk)("span",st,(0,o.v_)(e.poEditRestrictMessage),1)])),_:1}),!0!==e.apiData.ext_table_train?((0,s.uX)(),(0,s.Wv)(I,{key:0,align:"right"},{default:(0,s.k6)((()=>[(0,s.bF)(w,{flat:"",label:e.$t("dashboard"),color:"primary",onClick:t[8]||(t[8]=t=>e.goToDashboard())},null,8,["label"]),(0,s.bF)(w,{flat:"",label:e.$t("table_extraction_view"),color:"primary",onClick:t[9]||(t[9]=t=>e.goTolineItemsPage())},null,8,["label"])])),_:1})):(0,s.Q3)("",!0)])),_:1})])),_:1},8,["modelValue"]),(0,s.bF)(A,{modelValue:e.connectConfirmation,"onUpdate:modelValue":t[13]||(t[13]=t=>e.connectConfirmation=t),persistent:""},{default:(0,s.k6)((()=>[(0,s.bF)(D,null,{default:(0,s.k6)((()=>[(0,s.bF)(T,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",ot,(0,o.v_)(e.$t("confirm")),1)])),_:1}),(0,s.bF)(T,{class:"q-pt-none"},{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("pages.messages.CONNECTION_MISMATCHED",{properties:e.misMatchedProperties})),1)])),_:1}),(0,s.bF)(I,{align:"right"},{default:(0,s.k6)((()=>[(0,s.bF)(v,{appearance:"cancel",label:e.$t("cancel"),onClick:t[11]||(t[11]=t=>{e.connectConfirmation=!1,e.setConnectedLineItems(!0)})},null,8,["label"]),(0,s.bF)(v,{label:e.$t("proceed"),onClick:t[12]||(t[12]=t=>{e.connectConfirmation=!1,e.saveChanges()})},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,s.bF)(A,{modelValue:e.showOverrideTableConfirm,"onUpdate:modelValue":t[16]||(t[16]=t=>e.showOverrideTableConfirm=t),persistent:""},{default:(0,s.k6)((()=>[(0,s.bF)(D,null,{default:(0,s.k6)((()=>[(0,s.bF)(T,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",at,(0,o.v_)(e.$t("confirm")),1)])),_:1}),(0,s.bF)(T,{class:"q-pt-none"},{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("pages.messages.TABLE_OVERRIDE_CONFIRM")),1)])),_:1}),(0,s.bF)(I,{align:"right"},{default:(0,s.k6)((()=>[(0,s.bo)((0,s.bF)(v,{appearance:"cancel",label:e.$t("cancel"),onClick:t[14]||(t[14]=t=>e.cancelTableDrop())},null,8,["label"]),[[S]]),(0,s.bo)((0,s.bF)(v,{label:e.$t("proceed"),onClick:t[15]||(t[15]=t=>e.prepareTableFromDropedSource())},null,8,["label"]),[[S]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,s.bF)(x)],64)}var lt=i(46736),rt=i(96056),ct=i(8420),dt=i(18505),ht=i(41903),ut=i(11470),_t=i(57366),mt=i(86633),pt=i(10739),gt=i(36801),bt=i(25891),ft=i(68450),yt=i(82080),vt=i(94124),kt=i(76956),wt=i(88952),Ct=i(69323),Pt=function(e,t,i,s){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function n(e){try{r(s.next(e))}catch(t){a(t)}}function l(e){try{r(s["throw"](e))}catch(t){a(t)}}function r(e){e.done?i(e.value):o(e.value).then(n,l)}r((s=s.apply(e,t||[])).next())}))};let Lt=new Map;const Ot=(0,s.pM)({el:"#app",mixins:[mt.A,dt.A,rt.A,te.A,yt.A,_t.A,bt.A,lt.A,pt.A],props:{allowPOTableDrag:{type:Boolean,default:!1}},updated(){let e=this.user_settings.LINE_ITEM_TABLE_SETTING,t=200;e&&(e=JSON.parse(e),t=e.height);const i=document.getElementById("line_item_table");i&&(t<200&&(t=200),i.style.height=t+"px")},components:{Loader:ct.A,ColumnFilter:wt.A,ColumnFilterBadges:Ct.A},data(){return{docId:"",renderKey:0,is_po_view:!1,po_dragging:!1,validation_done:!0,confirmDialog:(0,ae.KR)(!1),dragging_data:{},coveredLineItem:[],dropdownColumns:[],blockProcessing:(0,ae.KR)(!1),connected_line_item:"",misMatchedProperties:"",misMatchedList:[],percent:kt.aH.percent,po_tolerance_type:kt.d6,custom_range_for_po_tolerance:kt.aH.custom_range_for_po_tolerance,number_column_types:kt.F_,AI_table_extraction_setting:kt.N1,filterValueByField:(0,ae.KR)({}),indexToMove:(0,ae.KR)(),line_table_columns:kt.iS}},computed:{filteredTableRows(){return this.filterByObject(this.tableRows,this.filterValueByField)}},mounted:function(){return Pt(this,void 0,void 0,(function*(){document.addEventListener("init_line_items",this.lineItemDataLoaded),document.addEventListener("line_item_table-column-drop",this.savedSortedColumns),this.isViewPo(),window.lineItemsPoV3=this,yield this.init(),document.addEventListener("dragover",this.dragover),document.addEventListener("keydown",this.keyDownEvent),this.initailizeDragColumnsById("line_item_table"),setTimeout((()=>{}),1e3)}))},unmounted:function(){document.removeEventListener("init_line_items",this.lineItemDataLoaded),document.removeEventListener("line_item_table-column-drop",this.savedSortedColumns),document.removeEventListener("dragover",this.dragover),document.removeEventListener("keydown",this.keyDownEvent)},methods:{init(){return Pt(this,void 0,void 0,(function*(){this.checkAITableSetting(),this.user_settings[kt.lZ]&&(yield this.prepareCostingElementDictionary())}))},onDragOverWrapper(e,t,i){"id"!=i&&"action_column"!=i&&this.onDragOver(e,t)},allowedColumnSorting(e){return"id"!==e.name&&"action_column"!==e.name},getColumnAlignment(e){return e.dataType?kt.F_.includes(e.dataType.toLowerCase())?"text-right":void 0:""},dragover(e){e.preventDefault()},drop(e){if(e.preventDefault(),!e.target||this.is_view_readonly)return;let t=e.target;if(!0===this.allowPOTableDrag){let e=!1;return t.classList.contains("po_table_drop_target")&&(e=!0),!e&&t.closest(".po_table_drop_target")&&(e=!0),void(e&&(this.hasLineItems()?this.showOverrideTableConfirm=!0:this.prepareTableFromDropedSource()))}let i="",s=e.target.closest("td");i=s?s.dataset.id:e.target.dataset.id;var o=e.target.closest("tr");("tr"!=t.tagName||"droptarget"!=t.className)&&o&&o.className&&"droptarget"==o.className&&(i=o.dataset.id),i&&this.connectWithSelectedPo(i)},connectWithSelectedPo(e){if(0!=this.po_line_id_for_match.length&&this.po_line_for_match){for(let t of this.po_line_id_for_match){if(this.line_connected_items.hasOwnProperty(t)&&this.po_connected_items.hasOwnProperty(e))return void this.showErrorToast("One of selected Po Item and Line Item are already Mapped");let i=this.PODataObj[t],s=this.getPoQuantity(i);if(0==s)return void this.showErrorToast("Can not proceed as one of open quantity is zero");this.makeConnection(e,i)}"success"===this.poConnectionData.connection_status?this.saveChanges():this.connectConfirmation=!0,this.po_line_id_for_match=[],this.po_line_for_match=[]}},prepareTableFromDropedSource(){let e=ht.A.getItem("DRAG_PO_NUMBER");ht.A.remove("DRAG_PO_NUMBER"),this.tableConversionHandler(e)},cancelTableDrop(){ht.A.remove("DRAG_PO_NUMBER");const e=new CustomEvent("table_drag_mode_flag_update",{detail:!0});document.dispatchEvent(e)},makeConnectionAndsave(e,t){this.makeConnection(e,t),this.saveChanges()},makeConnection(e,t){if(!e)return;if(this.coveredLineItem=this.lineDataObj[e],this.dragging_data=t,this.targetItem={},!this.coveredLineItem)return;let i=["UNIT_PRICE","QUANTITY","TOTAL_AMOUNT","ITEM_NUMBER","SUPPLIER_ITEM_NUMBER","PURCHASE_ORDER","NET_AMOUNT","UNIT_PRICE_PER"];for(let[s,[o,a]]of Object.entries(Object.entries(this.coveredLineItem.columns)))i.includes(o)&&(this.targetItem[o]={formatted:Object(a).formatted_value,value:Object(a).value});this.targetItem["UUID"]={formatted:this.coveredLineItem.id,value:this.coveredLineItem.id},this.targetItem.UUID.value&&this.proceedMakingConnection(e)},proceedMakingConnection(e){this.is_view_readonly||(this.connected_line_item=e,this.connectNewPORecord(),this.renderKey++)},dragenter(e){var t=e.target.closest("tr");"tr"==e.target.tagName&&"droptarget"==e.target.className||t&&t.className&&t.className},lineItemDataLoaded(e){if(!e||!e.detail)return;this.lineItemsloading=!1;let t=e.detail;this.resetRows(),this.apiData=t,this.docId=this.apiData&&this.apiData.doc_id?this.apiData.doc_id:"",this.refactorApiData(),this.triggerLineItemDataLoadedEvent()},triggerLineItemDataLoadedEvent(){const e=new CustomEvent("line_items_loaded",{});document.dispatchEvent(e)},savedSortedColumns(){const e=[];this.tableColumns=JSON.parse(JSON.stringify(this.tableColumns)),this.tableColumns.forEach(((t,i)=>{"id"!==t.name&&"action_column"!==t.name&&e.push(t.name)})),this.updatedLineColumns(e)},updatedLineColumns(e){return Pt(this,void 0,void 0,(function*(){try{this.showLoading();let t=this.line_table_columns+"_"+this.doctype;yield this.updateSetting(t,JSON.stringify(e))}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},resetRows(){this.tableRows=[],this.lineDataObj={}},refactorApiData(){this.is_ai_table=this.isAI_TableExit(this.apiData),this.setFormatOptions(),this.table_name=this.apiData.tables&&this.apiData.tables.length>0&&this.apiData.tables[0].hasOwnProperty("name")?this.apiData.tables[0].name:"",this.prepareTableLayoutObj(),this.prepareTableColumn(),this.prepareTableRowsAndRowObj(),this.validateLineItemColumns(),this.restrictPOEditIfNotValidated(),this.setConnectedLineItems(!1)},setFormatOptions(){this.formatting_options={},this.apiData.tables[0]&&this.apiData.tables[0].hasOwnProperty("formatting_options")&&(this.formatting_options=this.apiData.tables[0].formatting_options),this.apiData.tables[0].formatting_options=this.formatting_options,this.formatting_options.hasOwnProperty("columns_to_hide")&&null!==this.formatting_options.columns_to_hide&&(this.columns_to_hide=Object.assign([],this.formatting_options.columns_to_hide)),this.formatting_options.hasOwnProperty("custom_columns_to_hide")&&null!==this.formatting_options.custom_columns_to_hide&&(this.custom_columns_to_hide=Object.assign([],this.formatting_options.custom_columns_to_hide)),this.formatting_options.hasOwnProperty("column_origins")&&!(0,ft.z)(this.formatting_options.column_origins)&&(0,ft.Gv)(this.formatting_options.column_origins)||(this.apiData.tables[0].formatting_options.column_origins={},this.formatting_options.column_origins={})},prepareTableLayoutObj(){this.dropdownColumns=[];let e={};this.lineItemLayout={},this.apiData.tables&&this.apiData.tables.length>0&&this.apiData.tables[0].hasOwnProperty("layout")&&Array.from(this.apiData.tables[0].layout).forEach((t=>{e.hasOwnProperty(t.column_name)||0!=t.is_hidden||(e[t.column_name]=!0,t["lbl_to_display"]=this.getLabelToDisplay(t),this.lineItemLayout[t.column_name]=t,this.dropdownColumns.push({header:t.lbl_to_display,techName:t.column_name}))}))},callAutoMatch(){const e=new CustomEvent("trigger_auto_match",{});document.dispatchEvent(e)},prepareTableRowsAndRowObj(){this.tableRows=[],this.lineDataObj={};let e={},t={};this.apiData.tables&&0!=this.apiData.tables.length&&this.apiData.tables[0].hasOwnProperty("rows")&&0!=this.apiData.tables[0].rows.length&&(Array.from(this.apiData.tables[0].rows).forEach((i=>{if(!1===i.is_deleted)if(i.parent_id){let e={};Array.from(i.columns).forEach((t=>{e[t.name]={},e[t.name].formatted_value=t.formatted_value,e[t.name].value=t.value})),e["costing_element"]=i.costing_element,t.hasOwnProperty(i.parent_id)||(t[i.parent_id]=[]),t[i.parent_id].push(e)}else{let t={};e[i.id]=JSON.parse(JSON.stringify(i)),e[i.id].locations_list=[],i.locations_list&&Array.from(i.locations_list).forEach((t=>{e[i.id].locations_list["page_"+t.page]=t})),delete e[i.id].columns,e[i.id]["columns"]=[],Array.from(i.columns).forEach((s=>{e[i.id].columns[s.name]=JSON.parse(JSON.stringify(s)),e[i.id].columns[s.name].locations_list=[],s.locations_list&&Array.from(s.locations_list).forEach((t=>{e[i.id].columns[s.name].locations_list["page_"+t.page]=t})),(0,ft.z)(s.formatted_value)&&(s.formatted_value=""),t[s.name]=s.formatted_value,this.prepareMapOfColumnHavingData(s)})),this.addExtraColumnsInRow(e,t,i.id),t["id"]=i.id,t["show_charges"]=!1;const s=i.hasOwnProperty("is_additional_cost")&&!0===i.is_additional_cost;s||this.tableRows.push(t)}})),Object.assign(this.lineDataObj,e),this.setTotallineItem(),this.setCostingRows(t),this.calculateMatchedTotal())},setCostingRows(e){for(let t of this.tableRows)e.hasOwnProperty(t.id)&&(t.costingElements=e[t.id],this.lineDataObj[t.id]["costingElements"]=e[t.id])},prepareMapOfColumnHavingData(e){Lt.has(e.name)?!1===Lt.get(e.name)&&e.formatted_value&&null!=e.formatted_value&&""!=e.formatted_value&&Lt.set(e.name,!0):e.formatted_value&&null!=e.formatted_value&&""!=e.formatted_value?Lt.set(e.name,!0):Lt.set(e.name,!1)},addExtraColumnsInRow(e,t,i){for(let s of this.layoutExtraColumns){let o={name:s,value:"",content:"",locations:[],locations_list:[],formatted_value:"",is_extra_column:!0};e[i].columns[s]=o,Lt.set(s,!1),t[s]=""}},sortTableColumn(){return Pt(this,void 0,void 0,(function*(){let e=yield this.getColumns(this.line_table_columns+"_"+this.doctype),t={name:"id",field:"id",align:"left",label:"",is_mapped:!1,org_index:""};if(e){const i=JSON.parse(JSON.stringify(this.tableColumns));i.sort(((t,i)=>{const s=e.indexOf(t.name),o=e.indexOf(i.name);return-1===s&&-1===o?0:-1===s?1:-1===o?-1:s-o})),i.unshift(t),this.tableColumns=i}else{let e=JSON.parse(JSON.stringify(this.tableColumns)),i=[];this.tableColumns=[],Array.from(e).forEach(((e,t)=>{1!=this.hasOriginalIndex(e.org_index,e)&&Lt.has(e.name)&&!1===Lt.get(e.name)?i.push(Object.assign({},e)):this.tableColumns.push(Object.assign({},e))})),i.sort(((e,t)=>{let i=e.field.toLowerCase(),s=t.field.toLowerCase();return i<s?-1:i>s?1:0})),this.tableColumns.unshift(t),Array.from(i).forEach(((e,t)=>{this.tableColumns.push(Object.assign({},e))}))}}))},prepareTableColumn(){this.tableColumns=[],this.apiData.tables&&this.apiData.tables.length>0&&this.apiData.tables[0].hasOwnProperty("rows")&&(this.is_ai_table?this.AI_TableColumns():this.normalTableColumns(),this.sortTableColumn().then((()=>{if("PO_CONVERTED_TABLE"===this.table_name||this.doc_attributes[this.custom_range_for_po_tolerance]){const e={name:"action_column",field:"action_column",align:"left",label:"Actions",is_mapped:!1,org_index:""};this.tableColumns.push(e)}})))},normalTableColumns(){const e=this.apiData.tables[0].rows[0];if(!e)return;let t={},i=JSON.parse(JSON.stringify(this.lineItemLayout));Array.from(e.columns).forEach((s=>{let o=this.isColumnHidden(e,s);if(o){let e=s.name,o="";this.lineItemLayout.hasOwnProperty(s.name)&&(e=this.lineItemLayout[s.name].lbl_to_display,o=this.lineItemLayout[s.name].column_type,delete i[s.name]);let a="";null!=s.org_index&&void 0!=s.org_index&&(a=String(s.org_index));let n={name:s.name,field:s.name,align:"left",label:e,is_mapped:!!s.is_mapped&&s.is_mapped,org_index:a,col_origin:"auto",dataType:o?o.toLowerCase():"string",sortable:!0};n.col_origin=this.getColumnOrigin(this.apiData.tables[0],s.name),s.hasOwnProperty("org_index")&&null!=s.org_index?this.tableColumns.push(n):t[s.name]=n}}));for(let[s,o]of Object.entries(t))this.tableColumns.push(Object.assign({},o));for(let s in i){const e=i[s];let t=!this.isCustomColumnHidden(e.name);if(!t){delete i[e.name];continue}const o=this.lineItemLayout[e.column_name].column_type;let a={name:e.column_name,field:e.column_name,align:"left",label:e.lbl_to_display,is_mapped:!!e.is_mapped&&e.is_mapped,org_index:"",is_extra_column:!0,col_origin:"auto",dataType:o?o.toLowerCase():"string",sortable:!0};a.col_origin=this.getColumnOrigin(this.apiData.tables[0],e.column_name),this.tableColumns.push(Object.assign({},a)),this.layoutExtraColumns.push(e.column_name)}},getOrignalColumnName(e){return!e.hasOwnProperty("original_name")||(0,ft.z)(e.original_name)?"":String(e.original_name)},is_AI_ColumnVisible(e){let t=!0,i=this.getOrignalColumnName(e);return i&&this.formatting_options&&this.formatting_options.hasOwnProperty("columns_to_hide")&&this.formatting_options.columns_to_hide&&0!=this.formatting_options.columns_to_hide.length?((this.formatting_options.columns_to_hide.includes(i)||"UUID"==e.name)&&(t=!1),t):t},is_AI_isColumnHidden(e,t){let i="";null!=t.original_name&&void 0!=t.original_name&&(i=String(t.original_name));let s=!0;return""!==i&&(s=this.is_AI_ColumnVisible(t)),""===i&&(s=!this.isCustomColumnHidden(t.name)),s},AI_TableColumns(){let e={},t=[];Array.from(this.apiData.tables[0].rows).forEach((i=>{Array.from(i.columns).forEach((s=>{let o=this.is_AI_isColumnHidden(i,s);if(o&&!e.hasOwnProperty(s.name)){e[s.name]=!0;let i=s.name,o="";this.lineItemLayout.hasOwnProperty(s.name)&&(i=this.lineItemLayout[s.name].lbl_to_display,o=this.lineItemLayout[s.name].column_type);let a="";null!=s.org_index&&void 0!=s.org_index&&(a=String(s.org_index));let n={name:s.name,field:s.name,align:"left",label:i,is_mapped:!!s.is_mapped&&s.is_mapped,org_index:""!==a?a:"",dataType:o?o.toLowerCase():"string",sortable:!0,is_extra_column:!!s.hasOwnProperty("is_extra_column")&&s.is_extra_column,original_name:this.getOrignalColumnName(s)};const l=n.is_mapped||!this.remove_unmapped_columns&&!n.is_mapped;s.hasOwnProperty("org_index")&&null!=s.org_index&&l?this.tableColumns.push(n):t[s.name]=n}}))}));for(let[i,s]of Object.entries(t)){const e=s;e.hasOwnProperty("is_extra_column")&&!0===e.is_extra_column&&this.tableColumns.push(e)}},isCustomColumnHidden(e){let t=!1;if(!this.custom_columns_to_hide||0==this.custom_columns_to_hide.length)return t;for(const i of this.custom_columns_to_hide)if(i===e){t=!0;break}return t},isColumnHidden(e,t){let i="";null!=t.org_index&&void 0!=t.org_index&&(i=String(t.org_index));let s=!0;return""!==i&&(s=this.isColumnVisible(i,t)),s},isColumnVisible(e,t){if(this.is_ai_table)return this.is_AI_ColumnVisible(t);let i=!0;return e&&this.formatting_options&&this.formatting_options.hasOwnProperty("columns_to_hide")&&this.formatting_options.columns_to_hide&&0!=this.formatting_options.columns_to_hide.length?((this.formatting_options.columns_to_hide.includes(e)||"UUID"==t.name)&&(i=!1),i):i},validateLineItemColumns(){let e=!1;if(void 0===this.tableColumns)return;for(const i of this.tableColumns){let t=this.isColumnNameValid(i);t||(i.error=!0,e=!0)}let t=!e;this.validation_done!==t&&(this.validation_done=t)},isColumnNameValid(e){let t=!1;for(const i of this.dropdownColumns)if(e.name===i.techName||"id"==e.name||"action_column"==e.name){t=!0;break}return t},hasOriginalIndex(e,t){let i=!1;return""!==e&&(i=!0),i},restrictPOEditIfNotValidated(){this.is_po_view&&(this.validation_done&&this.hasLineItems()||(this.validation_done||(this.poEditRestrictMessage=this.prepareEditRestrictMessage()),this.hasLineItems()&&(this.poEditRestrictDialog=!0)))},prepareEditRestrictMessage(){let e=this.$t("po_restrict_message");const t=[];for(const i of this.tableColumns)i.error&&t.push(i.label);return 0===t.length?(e=this.$t("po_restrict_message_not_mapped"),e):e.replace(/%%column%%/g,t.join(", "))},isPurchaseOrderConnected(e){return!(!this.po_connected_items.hasOwnProperty(e)&&!this.line_connected_items.hasOwnProperty(e))},connectNewPORecord(){let e={},t=this.setPoConnectionStatus(this.targetItem,this.dragging_data);this.po_connected_items.hasOwnProperty(this.targetItem.UUID.value)?(e=JSON.parse(JSON.stringify(this.po_connected_items[this.targetItem.UUID.value])),e=this.MultiPoToOneLine(e,t),this.po_connected_items[this.targetItem.UUID.value]=e):this.line_connected_items.hasOwnProperty(this.dragging_data.id)?(e=JSON.parse(JSON.stringify(this.line_connected_items[this.dragging_data.id])),this.OnePoToMultiLine(e,t),this.line_connected_items[this.dragging_data.id]=e):(e=this.createNewPoMatchObj(t),this.po_connected_items[this.targetItem.UUID.value]=e),this.poConnectionData=e},createNewPoMatchObj(e){let t={table_line_id:this.targetItem.UUID.value,matching_info:e.matching_info,connection_status:e.connection_status,connection_details:e.connection_details,po_line_id:this.dragging_data.id};for(let[i,s]of Object.entries(this.dragging_data))kt.gb.includes(i)&&(t[i]=null===s?"":String(s));return t["unit_code_price"]=this.getUnitCodePrice(t.po_line_id),t["currency_format"]="en_US",t["quantity"]=this.getlineDataColumn(t.table_line_id,"QUANTITY"),this.isNumeric(t["quantity"])||(t["quantity"]=0),t["unit_price"]=this.getlineDataColumn(t.table_line_id,"UNIT_PRICE"),this.isNumeric(t["unit_price"])||(t["unit_price"]=0),this.lineDataObj[t.table_line_id].columns.hasOwnProperty("UNIT_PRICE_PER")?(t["unit_price_per"]=this.lineDataObj[t.table_line_id].columns.UNIT_PRICE_PER.value,this.isNumeric(t["quantity"])||(t["unit_price_per"]=0)):t["unit_price_per"]="1.00",e.matching_info.hasOwnProperty("PACKET_MATCH")&&(t["packet_size"]=e.matching_info.PACKET_MATCH.packet_size),t},OnePoToMultiLine(e,t){e.hasOwnProperty("table_line_ids")||(e.table_line_ids=[],e.table_lines=[],e.table_line_ids.push(e.table_line_id),e.table_lines.push({table_line_id:e.table_line_id,quantity:Number(e.quantity),matching_info:null}),delete e.table_line_id,delete e.matching_info),e.table_line_ids.push(this.targetItem.UUID.value);let i=this.targetItem.QUANTITY?this.targetItem.QUANTITY.value:"";e.table_lines.push({table_line_id:this.targetItem.UUID.value,quantity:Number(i),matching_info:null});let s=0;for(let[o,a]of e.table_lines.entries()){const e=this.lineDataObj[a.table_line_id].columns.QUANTITY.value;s+=+e}e["unit_code_price"]=this.getUnitCodePrice(e.po_line_id),e.quantity=s,e.connection_details=t.connection_details,e.connection_status=t.connection_status},MultiPoToOneLine(e,t){let i="";if(!e.hasOwnProperty("sub_lines")){e.connection_details&&(i=e.connection_details);let t={table_line_id:e.table_line_id,currency_format:e.currency_format,connection_status:e.connection_status,sub_lines:[]};delete e.matching_info,delete e.table_line_id,delete e.currency_format,delete e.connection_status,delete e.connection_details,this.lineDataObj[t.table_line_id].columns.hasOwnProperty("UNIT_PRICE_PER")?e["unit_price_per"]=this.lineDataObj[t.table_line_id].columns.UNIT_PRICE_PER.value:e["unit_price_per"]="1.00",e["unit_code_price"]=this.getUnitCodePrice(e.po_line_id),t.sub_lines.push(JSON.parse(JSON.stringify(e))),e=t}let s=this.createNewPoMatchObj(t);return delete s.matching_info,delete s.table_line_id,delete s.currency_format,delete s.connection_status,e.connection_status=t.connection_status,e.connection_details=t.connection_details,i&&i.includes("item_number")&&(e.connection_details+=","+this.$t("item_number")),e.sub_lines.push(s),this.calculateQuantityforSubLines(e),e},calculateQuantityforSubLines(e){let t=0,i=0;for(let[a,n]of e.sub_lines.entries()){const e=this.PODataObj[n.po_line_id];let i=this.getPoQuantity(e);t+=+i}const s=this.getlineDataColumn(e.table_line_id,"QUANTITY");for(let[a,n]of e.sub_lines.entries()){const e=this.PODataObj[n.po_line_id];let o=this.getPoQuantity(e);const a=o/t*Number(s);if(a.toString().includes(".")){let[e,t]=a.toString().split(".");n.quantity=String(e),i+=Number("0."+t)}else n.quantity=String(a)}let o=Number(e.sub_lines[e.sub_lines.length-1].quantity);o=+o+i,e.sub_lines[e.sub_lines.length-1].quantity=o.toFixed()},isPOColumnAvailable(e,t){let i=!1;if(this.tableColumns.length>0)for(let s of this.tableColumns)s.name.toLowerCase()===t.toLowerCase()&&(i=!0);return!!i&&!!this.PODataObj[e].hasOwnProperty(t)},getUnitCodePrice(e){let t="";return this.PODataObj.hasOwnProperty(e)?(this.PODataObj[e].hasOwnProperty("unit_code_price")?t=this.PODataObj[e].unit_code_price:this.PODataObj[e].hasOwnProperty("unit_code")&&(t=this.PODataObj[e].unit_code),t):t},getLineItemQuantity(e){let t="quantity",i=this.apiData.doc_type+"_QUANTITY_COL";const s=(0,gt.PL)(i);return void 0!==s&&""!==s&&(t=s),String(e[t])},getLineItemQuantityColumn(){let e="quantity",t=this.apiData.doc_type+"_QUANTITY_COL";const i=(0,gt.PL)(t);return void 0!==i&&""!==i&&(e=i),e},matchPoNumber(e,t){let i=!0;if(this.isLineColumnAvailable(e,"PURCHASE_ORDER")&&t.hasOwnProperty("purchase_order_number")){const s=e.PURCHASE_ORDER.value,o=t.purchase_order_number;s&&o&&this.notEqual(s,o)&&(this.misMatchedList.push(this.$t("purchase_order_number")),i=!1)}else this.isLineColumnAvailable(e,"PURCHASE_ORDER")&&(this.misMatchedList.push(this.$t("purchase_order_number")),i=!1);return i},matchItemNumber(e,t){const i={is_matched:!0};let s=!0;const o=this.isLineColumnAvailable(e,"SUPPLIER_ITEM_NUMBER"),a=this.isLineColumnAvailable(e,"ITEM_NUMBER");if(!o&&!a)return s=!1,i["is_matched"]=s,this.misMatchedList.push(this.$t("pages.screen2a.supplier_number")+" / "+this.$t("pages.screen2a.item_number")),i;if(o&&t.supplier_item_id){const o=(0,ft.$U)(e.SUPPLIER_ITEM_NUMBER.value||""),a=(0,ft.$U)(t.supplier_item_id||"");i["actual"]=o,i["expected"]=a,o&&a&&this.notEqual(o,a)&&this.po_supplier_item_numbers.hasOwnProperty(a)&&this.notEqual(o,this.po_supplier_item_numbers[a][o])&&(s=!1,this.misMatchedList.push(this.$t("pages.screen2a.supplier_number")))}else if(a&&t.hasOwnProperty("item_id")){const o=(0,ft.$U)(e.ITEM_NUMBER.value||""),a=(0,ft.$U)(t.item_id||"");i["actual"]=o,i["expected"]=a,o&&a&&this.notEqual(o,a)&&(s=!1,this.misMatchedList.push("item_number"))}else s=!1,this.misMatchedList.push(this.$t("pages.screen2a.supplier_number")+" / "+this.$t("pages.screen2a.item_number"));return i["actual"]||(i["actual"]="N/A",s=!1),i["expected"]||(i["expected"]="N/A",s=!1),i["is_matched"]=s,i},setPoConnectionStatus(e,t){let i={QUANTITY:{},UNIT_PRICE:{},PACKET_MATCH:{},ITEM_NUMBER:{}};this.misMatchedList=[];let s="success";const o=e.ITEM_NUMBER?e.ITEM_NUMBER.value:"";let a=e.SUPPLIER_ITEM_NUMBER?e.SUPPLIER_ITEM_NUMBER.value:"",n=this.cleanItemNumber(o);a=this.cleanItemNumber(a),this.fillToleranceModel(n,a);const l=this.checkTableExtraColumnsStatus(e,t);if(Object.keys(l.matching_info).length>=0&&(l.match||(s="mismatch"),Object.assign(i,l.matching_info)),!this.po_connected_items.hasOwnProperty(this.targetItem.UUID.value)&&!this.line_connected_items.hasOwnProperty(t.id)){const o=this.matchItemNumber(e,t),a=o.is_matched;if(a||(s="mismatch",i.ITEM_NUMBER=o),a&&this.apiData.doc_type!=kt.aH.DELIVERY_NOTE){const o=this.matchByPacket(e,t);if(o.match){i.PACKET_MATCH=o.matching_info;const e={matching_info:i,connection_status:s,connection_details:this.misMatchedProperties};return e}}}const r=this.checkQuantityStatus(e,t);if(i.QUANTITY=r.match_obj,r.match||(s="mismatch"),this.apiData.doc_type!=kt.aH.DELIVERY_NOTE){const o=this.checkUnitPriceStatus(e,t);o.match||(s="mismatch"),i.UNIT_PRICE=o.match_obj}this.misMatchedProperties=this.misMatchedList.join(", ");const c={matching_info:i,connection_status:s,connection_details:this.misMatchedProperties};return c},isWholeNumber(e){return Number.isInteger(e)},matchByPacket(e,t){const i=this.getPoQuantity(t),s=this.getLineQuantity(e);let o=!1,a=!1,n=1,l={};if((0,ft.z)(i)||(0,ft.z)(s))return{match:o,matching_info:{}};if(n=i/s,n<1&&(a=!0,n=s/i),!1===this.isWholeNumber(n))return{match:o,matching_info:{}};a&&(n=1/n);const r=this.getPoUnitPrice(t),c=this.getLineUnitPrice(e),d=c/n,h=this.toleranceModel["unit_price_tolerance_type"]==this.percent,u=this.matchValues(d,r,this.toleranceModel.unit_price_tolerance,h);return u||(o=!0),l={expected:d,actual:c,packet_size:n},{match:o,matching_info:l}},isLineColumnAvailable(e,t){let i=!1;if(this.tableColumns.length>0)for(let s of this.tableColumns)s.name.toLowerCase()===t.toLowerCase()&&(i=!0);return!!i&&!(!e.hasOwnProperty(t)||!e[t])},checkUnitPriceStatus(e,t){try{let i=!0,s=this.getPoUnitPrice(t),o=this.getLineUnitPrice(e);if(this.po_connected_items.hasOwnProperty(this.targetItem.UUID.value)){let e=this.getPoQuantity(t);s=this.getManyPoToOneLine_UnitPrice(this.targetItem.UUID.value,Number(s),e)}else if(this.line_connected_items.hasOwnProperty(t.id)){let i=this.getLineQuantity(e);o=this.getOnePoToManyTableLine_UnitPrice(t.id,Number(o),Number(i))}let a=this.toleranceModel["unit_price_tolerance_type"]==this.percent,n=this.matchValues(s,o,this.toleranceModel.unit_price_tolerance,a);n&&(i=!1,this.misMatchedList.push(this.$t("unit_price")));const l=this.getMatchingInfo(!n,s,o,this.toleranceModel.unit_price_tolerance,a);return{match:i,match_obj:l}}catch(i){this.showErrorToast(this.$t("check_unit_price_column"))}},checkTableExtraColumnsStatus(e,t){let i={},s=!0;const o=kt.aH.TABLE_EXTRA_COLUMNS_+this.apiData.doc_type,a=this.user_settings[o];if(!a)return{match:s,matching_info:i};const n=JSON.parse(a);if(!n||0==n.length)return{match:s,matching_info:i};for(let l of n){const o=this.getlineDataColumn(e.UUID.value,l.line_column);if(l.line_column.toLowerCase().includes("date")){const e=this.formatDateWithPattern(o,kt.yt.date_only),a=this.formatDateWithPattern(t[l.po_column],kt.yt.date_only);0!=this.dateDifferenceInDays(e,a)&&(s=!1,this.misMatchedList.push(this.$t(l.line_column))),i[l.line_column]=this.getMatchingInfoForString(s,a,e)}else s=this.matchValues(t[l.po_column],o,0,!1),s=!s,i[l.line_column]=this.getMatchingInfo(s,t[l.po_column],o,0,!1)}return{match:s,matching_info:i}},getManyPoToOneLine_UnitPrice(e,t,i){let s=this.po_connected_items[e],o=0,a=0;if(s.hasOwnProperty("po_line_id")&&(a=Number(s.matching_info.UNIT_PRICE.expected)*Number(s.matching_info.QUANTITY.expected),o+=Number(s.matching_info.QUANTITY.expected)),s.hasOwnProperty("sub_lines"))for(let[n,l]of s.sub_lines.entries())a+=Number(l.unit_price)*Number(l.quantity),o+=Number(l.quantity);return o+=Number(i),a+=i*t,a/=o,isNaN(a)&&(a=0),+Number(a).toFixed(4)},getOnePoToManyTableLine_UnitPrice(e,t,i){let s=this.line_connected_items[e],o=0,a=0;if(s.hasOwnProperty("table_line_id")&&(a=Number(s.matching_info.UNIT_PRICE.actual)*Number(s.matching_info.QUANTITY.actual),o+=Number(s.matching_info.QUANTITY.actual)),s.hasOwnProperty("table_line_ids"))for(let[n,l]of s.table_lines.entries()){const e=this.getlineDataColumn(l.table_line_id,"QUANTITY"),t=Number(this.lineDataObj[l.table_line_id].columns.UNIT_PRICE.value);a+=e*t,o+=e}return o+=Number(i),a+=i*t,a/=o,+Number(a).toFixed(4)},checkQuantityStatus(e,t){try{let i=!0,s=this.getPoQuantity(t),o=this.getLineQuantity(e);this.po_connected_items.hasOwnProperty(this.targetItem.UUID.value)?s=this.getManyPoToOneLine_Quantity(this.targetItem.UUID.value,Number(s),Number(o)):this.line_connected_items.hasOwnProperty(t.id)&&(o=this.getOnePoToManyLine_Quantity(t.id,Number(o)));let a=this.toleranceModel["quantity_tolerance_type"]==this.percent,n=this.matchValues(s,o,this.toleranceModel.quantity_tolerance,a);n&&(i=!1,this.misMatchedList.push(this.$t("quantity")));const l=this.getMatchingInfo(!n,s,o,this.toleranceModel.quantity_tolerance,a);return{match:i,match_obj:l}}catch(i){this.showErrorToast(this.$t("check_quantity_column"))}},getLineQuantity(e){let t=this.isLineColumnAvailable(e,"QUANTITY")&&e.QUANTITY?e.QUANTITY.value:0;return this.isNumeric(t)||(t=0),+t},getPoUnitPrice(e){const t=e.hasOwnProperty("unit_price_value")?e.unit_price_value:e.unit_price,i=e.unit_price_per?e.unit_price_per:1;let s=t/i;return+s},getLineUnitPrice(e){let t=this.isLineColumnAvailable(e,"UNIT_PRICE")&&e.UNIT_PRICE?e.UNIT_PRICE.value:0,i=1;this.isNumeric(t)||(t=0),this.isLineColumnAvailable(e,"UNIT_PRICE_PER")&&e.UNIT_PRICE_PER.value&&(i=e.UNIT_PRICE_PER.value);let s=t/i;return+s},getPoQuantity(e){let t="quantity";const i="_value";e.hasOwnProperty(this.po_quantity_column)&&(t=this.po_quantity_column);let s=e[t];return e.hasOwnProperty(t+i)&&(s=e[t+i]),!(0,ft.z)(s)&&this.isNumeric(s)||(s=0),+s},getManyPoToOneLine_Quantity(e,t,i){let s=this.po_connected_items[e],o=0;if(s.hasOwnProperty("po_line_id")){const e=this.PODataObj[s.po_line_id];let t=this.getPoQuantity(e);o=+t}if(s.hasOwnProperty("sub_lines"))for(let[a,n]of s.sub_lines.entries())o+=+n.quantity;return o+t},getOnePoToManyLine_Quantity(e,t){let i=this.line_connected_items[e],s=0;if(i.hasOwnProperty("table_line_id")&&(s=+i.matching_info.QUANTITY.actual),i.hasOwnProperty("table_line_ids"))for(let[o,a]of i.table_lines.entries()){const e=this.getlineDataColumn(a.table_line_id,"QUANTITY");s+=+e}return s+t},getlineDataColumn(e,t){try{return this.getlineColumnValue(e,t)}catch(i){this.showErrorToast("Column "+t+" for matching")}return""},getMatchingInfo(e,t,i,s,o){o&&(s=+s/100*i);const a={is_matched:e,expected:t,actual:i,tolerance:s};return a},getMatchingInfoForString(e,t,i){const s={is_matched:e,expected:t,actual:i};return s},notEqual(e,t){return e=e.toString().replace(/\s/g,"").toLowerCase(),t=t.toString().replace(/\s/g,"").toLowerCase(),e!=t},notEqualAmount(e,t){return e=Number(e).toFixed(4),t=Number(t).toFixed(4),e!=t},useToleranceForMatch(e,t,i,s){let o=e-t;if(o=Number(Math.abs(o).toFixed(4)),i=Number(Number(i).toFixed(4)),0==o)return!1;if(s){if(i>100||i<0)return this.showErrorToast(this.$t("pages.messages.TOLERANCE_RANGE")),!0;i=i/100*e}return i<o},matchValues(e,t,i,s){return e=Number(e).toFixed(4),t=Number(t).toFixed(4),this.doc_attributes[this.custom_range_for_po_tolerance]?this.useToleranceForMatch(Number(e),Number(t),i,s):e!=t},saveChanges(){this.dispatchConnectionSuccessEvent(this.poConnectionData)},dispatchConnectionSuccessEvent(e){const t=new CustomEvent("po_connection_add",{detail:{data:e}});document.dispatchEvent(t)},removeExistingAndConnectNewPO(){this.confirmDialog=!1;let e=this.po_connected_items.hasOwnProperty(this.connected_line_item)?this.po_connected_items[this.connected_line_item]:{};this.dispatchConnectionRemoveEvent(e,!1),delete this.po_connected_items[this.connected_line_item],this.connectNewPORecord(),this.saveChanges()},dispatchConnectionRemoveEvent(e,t){const i=new CustomEvent("po_connection_remove",{detail:{data:e,isPoId:t}});document.dispatchEvent(i)},convertToUSValue(e){return e.replace(/,/g,".")},mouseMoveHandler(e){this.po_dragging&&this.validation_done&&this.wait},getConnectionInfo(e){let t={};return t=this.po_connected_items.hasOwnProperty(e)?this.po_connected_items[e]:{},t},getConnectedinfoAttribute(e,t){let i=this.getConnectionInfo(e);if(!i||0===Object.keys(i).length)return{};if("connection_details"==t&&i.hasOwnProperty("matching_info")){const e=Object.entries(i.matching_info).map((([e,t])=>{if(!1===t["is_matched"]){const i=`</b>\n              <div style='padding-left: 10px'>\n                ${this.$t(String(e))} </b>\n                <div style='padding-left: 10px'>\n                  <div> - PO: ${t["expected"]}</div> \n                  <div> - Line: ${t["actual"]}</div>  \n                </div>\n              </div>\n            `;return i}}));return e.join("")}{if(!i.connection_details)return"";let e=Object.entries(i.connection_details.split(",")).map((([e,t])=>{const i=`</b>\n            <div style='padding-left: 10px'>\n              ${String(t)} </b>\n            </div>\n            `;return i}));return e.join("")}},setConnectedLineItems(e){this.po_connected_items={},this.line_connected_items={};let t=this.getConnectedLineItems();if(0!=t.length){for(let[e,i]of t.entries()){if(i.hasOwnProperty("table_line_id"))this.po_connected_items[i.table_line_id]=i;else if(i.hasOwnProperty("table_lines"))for(let[e,t]of i.table_lines.entries())this.po_connected_items[t.table_line_id]=i;if(i.hasOwnProperty("po_line_id"))this.line_connected_items[i.po_line_id]=i;else if(i.hasOwnProperty("sub_lines"))for(let[e,t]of i.sub_lines.entries())this.line_connected_items[t.po_line_id]=i}e&&this.renderKey++}},getConnectedLineItems(){let e=[];return this.record?(this.record.hasOwnProperty("po_multi_matched")&&(e=this.record.po_multi_matched),e):e},removePOConnection(e,t){this.blockProcessing=!0,this.dispatchConnectionRemoveEvent(e,t),setTimeout((()=>{this.blockProcessing=!1}),1e3)},hasLineItems(){return!(!this.tableRows||0===Object.keys(this.tableRows).length)},isViewPo(){this.$route.fullPath.match(/po-matching/g)&&(this.is_po_view=!0)},showlineHighlighted(e){let t=this.getConnectionInfo(e);if(!t||0===Object.keys(t).length)return;const i=new CustomEvent("show_line_highlighted",{detail:t});document.dispatchEvent(i)},scrollToHightlightedLine(e){let t=this.getConnectionInfo(e);if(!t||0===Object.keys(t).length)return;const i=new CustomEvent("scroll_to_highlighted_line",{detail:t});document.dispatchEvent(i)},removedLineHighlight(e){let t=this.getConnectionInfo(e);if(!t||0===Object.keys(t).length)return;const i=new CustomEvent("removed_highlight",{detail:t});document.dispatchEvent(i)},keyDownEvent(e){if("v"!==e.key&&"V"!==e.key||!e.ctrlKey||!this.hasLineItems()){if(e.ctrlKey&&("l"===e.key||"L"===e.key)){e.preventDefault();const t=(0,ie.$)("#line_item_table").querySelectorAll(".line-item-tr");if(0==t.length)return;let i=t[0];i.contentEditable="true",i.focus(),i.contentEditable="false"}}else{e.preventDefault();let t=document.activeElement;if(!t||!t.classList.contains("droptarget"))return;this.drop(e)}},goTolineItemsPage(){this.removeCache(),this.is_ai_table?this.$router.push("/field_validation_v1/"+this.apiData.doc_id):this.$router.push("/tbl_ext_v3/"+this.apiData.doc_id)},goToDashboard(){this.$router.push("/dashboard")},tableConversionHandler(e){try{this.callApiForTableConversion(e)}catch(t){return void this.showErrorToast("Error while displaying Page")}},callApiForTableConversion(e){const t=new CustomEvent("convert_pline_to_ltable",{detail:e});document.dispatchEvent(t)},dispatchEventToSaveTableChanges(){const e=new CustomEvent("update_table_data",{detail:this.apiData.tables});document.dispatchEvent(e)},inputValueChanges(e,t){this.is_view_readonly||"PO_CONVERTED_TABLE"===this.table_name&&setTimeout((()=>{this.lineDataObj[t]["columns"][e].value=this.lineDataObj[t]["columns"][e].formatted_value,this.updateJsonForLineItems(e,t)}),0)},updateJsonForLineItems(e,t){Array.from(this.apiData.tables[0].rows).forEach(((i,s)=>{t===i.id&&Array.from(i.columns).forEach(((t,s)=>{t.name!==e||(this.apiData.tables[0].rows[s].columns[s]=this.lineDataObj[i.id].columns[e])}))})),this.dispatchEventToSaveTableChanges()},deleteLine(e){if(this.is_view_readonly)return;Array.from(this.apiData.tables[0].rows).forEach(((t,i)=>{e===t.id&&(t.is_deleted=!0)}));let t=this.po_connected_items.hasOwnProperty(e)?this.po_connected_items[e]:{};this.removePOConnection(e,!1);const i=new CustomEvent("delete_table_line",{detail:{tables:this.apiData.tables,connection_info:t}});document.dispatchEvent(i)},getConnectionStatus(e){let t=this.getConnectionInfo(e);return t["connection_status"]},getConnectionStatusDetails(e){return this.getConnectedinfoAttribute(e,"connection_details")},getConnectionSvg(e){const t=this.getConnectionStatus(e);return"success"==t?"images/link.svg":"mismatch"==t?"images/broken-link-self.svg":void 0},getConnectionTitle(e){const t=this.getConnectionStatus(e);return"success"==t?this.$t("po_connected_match"):"mismatch"==t?this.$t("po_connected_mismatch"):"line_item_only"==t?this.$t("po_connected_self"):void 0},initToleranceForm(e){let t=e["ITEM_NUMBER"]?e["ITEM_NUMBER"].formatted_value:"",i=e["SUPPLIER_ITEM_NUMBER"]?e["SUPPLIER_ITEM_NUMBER"].formatted_value:"";t||i?(t=this.cleanItemNumber(t),i=this.cleanItemNumber(i),this.fillToleranceModel(t),this.toleranceModel.item_number=t,this.toleranceModel.supplier_item_number=e["SUPPLIER_ITEM_NUMBER"]?e["SUPPLIER_ITEM_NUMBER"].formatted_value:""):this.showErrorToast(this.$t("pages.messages.CAN_NOT_SET_TOLERANCE"))},fillToleranceModel(e,t){e&&this.itemSpecificTolerancesMap.has(e)?this.toleranceModel=JSON.parse(JSON.stringify(this.itemSpecificTolerancesMap.get(e))):t&&this.itemSpecificTolerancesMap.has(t)?this.toleranceModel=JSON.parse(JSON.stringify(this.itemSpecificTolerancesMap.get(t))):this.initToleranceModel()},saveToleranceLevel(){return Pt(this,void 0,void 0,(function*(){try{if(this.is_view_readonly)return;if(!this.doc_attributes[this.custom_range_for_po_tolerance])return;if(!this.validateToleranceForm())return;let e;this.showLoading(),e=yield ut.A0.setItemTolerance(this.toleranceModel),this.itemSpecificTolerancesMap.set(this.toleranceModel.item_number,this.toleranceModel)}catch(e){const t=re.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.hideLoading()}}))},validateToleranceForm(){let e=!0;const t=this.itemSpecificTolerancesMap.get(this.toleranceModel.item_number);return this.toleranceModel["quantity_tolerance_type"]==this.percent&&(this.toleranceModel["quantity_tolerance"]<1||this.toleranceModel["quantity_tolerance"]>100)&&(this.toleranceModel["quantity_tolerance"]=t.quantity_tolerance,this.showErrorToast(this.$t("percentage_1_to_100")),e=!1),this.toleranceModel["unit_price_tolerance_type"]==this.percent&&(this.toleranceModel["unit_price_tolerance"]<1||this.toleranceModel["unit_price_tolerance"]>100)&&(this.toleranceModel["unit_price_tolerance"]=t.unit_price_tolerance,this.showErrorToast(this.$t("percentage_1_to_100")),e=!1),this.toleranceModel.item_number||(this.showErrorToast(this.$t("pages.messages.CAN_NOT_SET_TOLERANCE")),e=!1),e},checkAITableSetting(){this.ai_table_setting_flag=!1,this.user_settings[this.AI_table_extraction_setting]&&(this.ai_table_setting_flag=this.user_settings[this.AI_table_extraction_setting])}},setup(){const e=(0,ae.KR)(null);let t=[],i={};const s=(0,vt.q3)(),{record:o,doctype:a,remove_unmapped_columns:n,has_ai_table:l}=(0,ee.bP)(s),{removeCache:r,isAI_TableExit:c}=s,d=(0,vt.rD)(),{prepareCostingElementDictionary:h}=d,{costingElementDictionary:u}=(0,ee.bP)(d);rt.A.methods.setResizeObserverHelper(e,"LINE_ITEM_TABLE_SETTING");const _=(0,vt.R9)(),{total_net_amount:m,is_view_readonly:p,po_connected_items:g,line_connected_items:b,PODataObj:f,pending_amount:y,charges_amount:v,matched_total_amount:k,amount_error:w,toleranceModel:C,itemSpecificTolerancesMap:P,lineDataObj:L,po_line_id_for_match:O,po_line_for_match:E,po_quantity_column:T,isChargesModuleEnabled:I,po_supplier_item_numbers:D}=(0,ee.bP)(_),{initToleranceModel:A,calculateMatchedTotal:F,setTotallineItem:x,getlineColumnValue:S,getSavedColumns:R,getColumns:M}=_,N=(0,vt.wt)(),{model:q}=(0,ee.bP)(N),U=(0,vt.Bu)(),{user_settings:$,loading_settings:Q}=(0,ee.bP)(U),{updateSetting:V}=U;return{setTotallineItem:x,getlineColumnValue:S,getSavedColumns:R,getColumns:M,prepareCostingElementDictionary:h,costingElementDictionary:u,po_supplier_item_numbers:D,isChargesModuleEnabled:I,po_quantity_column:T,user_settings:$,loading_settings:Q,updateSetting:V,remove_unmapped_columns:n,has_ai_table:l,ai_table_setting_flag:(0,ae.KR)(!1),po_line_id_for_match:O,po_line_for_match:E,is_view_readonly:p,po_connected_items:g,line_connected_items:b,PODataObj:f,record:o,doctype:a,amount_error:w,doc_attributes:q,toleranceModel:C,pending_amount:y,charges_amount:v,total_net_amount:m,matched_total_amount:k,itemSpecificTolerancesMap:P,el:e,removeCache:r,isAI_TableExit:c,initToleranceModel:A,is_ai_table:(0,ae.KR)(!1),poEditRestrictDialog:(0,ae.KR)(!1),poEditRestrictMessage:(0,ae.KR)(""),lineItemsloading:(0,ae.KR)(!0),tableColumns:(0,ae.KR)(t),tableRows:(0,ae.KR)(t),apiData:(0,ae.KR)(t),table_name:(0,ae.KR)(""),lineDataObj:L,targetItem:(0,ae.KR)(i),lineItemLayout:(0,ae.KR)(t),formatting_options:(0,ae.KR)(i),custom_columns_to_hide:(0,ae.KR)(t),columns_to_hide:(0,ae.KR)(t),layoutExtraColumns:(0,ae.KR)([]),connectConfirmation:(0,ae.KR)(!1),showOverrideTableConfirm:(0,ae.KR)(!1),poConnectionData:(0,ae.KR)({}),tableObj:(0,ae.KR)({}),calculateMatchedTotal:F,startY:0,isResizing:!1}}});var Et=i(12807),Tt=i(42315),It=i(44488),Dt=i(57722),At=i(50492),Ft=i(97410),xt=i(84436),St=i(53999),Rt=i(90124),Mt=i(25173),Nt=i(45262),qt=i(15046),Ut=i(58210),$t=i(56384),Qt=i(67837),Vt=i(94940),Kt=i(857),jt=i(82156),Wt=i(23316),Xt=i(44189),Bt=i(62669),Ht=i(3952),zt=i(18301),Yt=i(67156),Jt=i(88672),Gt=i(98582),Zt=i.n(Gt);const ei=(0,Et.A)(Ot,[["render",nt],["__scopeId","data-v-7e4d5754"]]),ti=ei;Zt()(Ot,"components",{QTable:Tt.A,QTr:It.A,QTh:Dt.A,QIcon:At.A,QTooltip:Ft.A,QMenu:xt.A,QList:St.A,QItem:Rt.A,QItemSection:Mt.A,QTd:Nt.A,QImg:qt.A,QSpinner:Ut.A,QBtn:$t.A,QInput:Qt.A,QSelect:Vt.A,QMarkupTable:Kt.A,QDialog:jt.A,QCard:Wt.A,QCardSection:Xt.A,QCardActions:Bt.A,QAvatar:Ht.A,QBtnDropdown:zt.A,QField:Yt.A}),Zt()(Ot,"directives",{ClosePopup:Jt.A});var ii=i(48520),si=i(84857),oi=i(18859),ai=i(94822),ni=i(27959),li=i(63923),ri=i(76194),ci=i(91236),di=i(74279),hi=i(12566);const ui={class:"full-width dashboard-list-area q-pt-md"},_i={key:0,class:"float-right"},mi={class:"display-flex"},pi={style:{width:"300px"}},gi={class:"q-pa-sm text-success"};function bi(e,t,i,a,n,l){const r=(0,s.g2)("ColumnFilterBadges"),c=(0,s.g2)("ColumnFilter"),d=(0,s.g2)("q-th"),h=(0,s.g2)("q-tr"),u=(0,s.g2)("q-td"),_=(0,s.g2)("q-slider"),m=(0,s.g2)("q-table"),p=(0,s.g2)("q-markup-table"),g=(0,s.g2)("Loader");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",ui,[(0,s.bF)(r,{class:"q-mb-sm",name:"ShipmentColumnFilter",onOnUpdateValue:t[0]||(t[0]=t=>{e.filterValue=Object.assign({},t)})}),e.rows&&e.rows.length>0?((0,s.uX)(),(0,s.Wv)(m,{key:0,class:"text-uppercase sticky-header transparent-header table_height resizable","no-data-label":e.$t("pages.messages.no_record_found"),rows:e.filteredTableRow,columns:e.columns,ref:"el","row-key":"name","rows-per-page-options":[0],id:"receive-delivery-lines-table"},{header:(0,s.k6)((i=>[(0,s.bF)(h,{props:i,class:""},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.cols,(a=>((0,s.uX)(),(0,s.Wv)(d,{key:a.name,props:i},{default:(0,s.k6)((()=>["position"==a.label?((0,s.uX)(),(0,s.CE)("span",_i,(0,o.v_)(a.label),1)):((0,s.uX)(),(0,s.CE)("span",{key:1,class:(0,o.C4)(a.is_bold||a.name===e.po_quantity_column?"text-weight-bolder font-size-14 secondary-c-text":"")},(0,o.v_)(a.label),3)),a.label?((0,s.uX)(),(0,s.Wv)(c,{key:2,name:"ShipmentColumnFilter",column:a.name,onOnUpdateValue:t[1]||(t[1]=t=>{e.filterValue=Object.assign({},t)})},null,8,["column"])):(0,s.Q3)("",!0)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,s.k6)((t=>[(0,s.bF)(h,{props:t,"data-id":t.key,class:(0,o.C4)(t.rowIndex%2==0?"":"alternative-row")},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.cols,(i=>((0,s.uX)(),(0,s.CE)(s.FK,{key:i.name},[i.label?((0,s.uX)(),(0,s.Wv)(u,{key:0},{default:(0,s.k6)((()=>[(0,s.Lk)("span",{class:(0,o.C4)(e.checkIfColumnIsAmount(i.name,e.AMOUNT_COLUMNS)?"float-right":"")},(0,o.v_)(t.row[i.name]),3)])),_:2},1024)):((0,s.uX)(),(0,s.Wv)(u,{key:1},{default:(0,s.k6)((()=>[(0,s.Lk)("div",mi,[(0,s.Lk)("div",pi,[(0,s.bF)(_,{modelValue:t.row[i.name].already_delivered,"onUpdate:modelValue":e=>t.row[i.name].already_delivered=e,readonly:"",draggable:"false",max:100,"inner-max":t.row[i.name].bar_value,color:"success","inner-track-color":"primary","track-size":"8px","thumb-size":"0px"},null,8,["modelValue","onUpdate:modelValue","inner-max"])]),(0,s.Lk)("span",gi,(0,o.v_)(t.row[i.name].bar_value)+" % ",1),(0,s.Lk)("span",{class:(0,o.C4)(["q-pa-sm",t.row[i.name].delivered_on_time?"text-success":"text-error"])},(0,o.v_)(t.row[i.name].promised_delivery_date),3),t.row[i.name].delivered_on_time?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",{key:0,class:(0,o.C4)(["q-pa-sm",t.row[i.name].delivered_on_time?"text-success":"text-error"])},(0,o.v_)(t.row[i.name].no_of_days_late+" day(s) late"),3))])])),_:2},1024))],64)))),128))])),_:2},1032,["props","data-id","class"])])),_:1},8,["no-data-label","rows","columns"])):((0,s.uX)(),(0,s.Wv)(p,{key:1,class:"full-width"},{default:(0,s.k6)((()=>[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,(0,o.v_)(e.$t("pages.messages.no_record_found")),1)])])])),_:1}))]),(0,s.bF)(g)],64)}var fi=i(62488);const yi=(0,s.pM)({el:"#app",props:{purchaseOrderNumber:{type:String,default:""},poItems:{type:[],default:[]}},watch:{purchaseOrderNumber:{handler:function(e,t){e&&e!=t&&this.prepareTableRows(e)}}},data(){return{rows:(0,ae.KR)([]),columns:(0,ae.KR)([]),startY:0,isResizing:!1,AMOUNT_COLUMNS:fi.Ng,filterValue:(0,ae.KR)({})}},mixins:[dt.A,te.A,lt.A,mt.A,rt.A],components:{Loader:ct.A,ColumnFilter:wt.A,ColumnFilterBadges:Ct.A},updated(){let e=this.user_settings.RECEIVE_DELIVERY_LINES_TABLE_SETTING,t=200;e&&(e=JSON.parse(e),t=e.height);const i=document.getElementById("receive-delivery-lines-table");i&&(t<200&&(t=200),i.style.height=t+"px")},mounted(){this.init(),document.addEventListener("reload_received_delivery_lines",this.reloadData)},unmounted(){document.removeEventListener("reload_received_delivery_lines",this.reloadData)},computed:{filteredTableRow(){return this.filterByObject(this.rows,this.filterValue)}},methods:{init(){this.prepareTableColumns()},calculateTableHeight(){let e=this.user_settings.RECEIVE_DELIVERY_LINES_TABLE_SETTING;e&&(e=JSON.parse(e),e.hasOwnProperty("height")&&(this.tableHeight=e.height)),this.rows.length>0&&(this.rows.length<3||this.tableHeight<10)&&(this.tableHeight=200)},prepareTableColumns(){this.columns=[],this.columns.push({name:"item_id",label:this.$t("item_id"),field:"item_id",align:"left",sortable:!0,headerStyle:"width: 100px"},{name:"delivery_number",label:this.$t("delivery_number"),field:"delivery_number",align:"left",sortable:!0,headerStyle:"width: 150px"},{name:"shipped_quantity",label:this.$t("shipped_quantity"),field:"shipped_quantity",align:"left",sortable:!0,headerStyle:"width: 150px"},{name:"invoiced_quantity",label:this.$t("invoiced_quantity"),field:"invoiced_quantity",align:"left",sortable:!0,headerStyle:"width: 150px"},{name:"invoice_open_quantity",label:this.$t("invoice_open_quantity"),field:"invoice_open_quantity",align:"left",sortable:!0,headerStyle:"width: 150px"},{name:"chart_status",label:"",field:"chart_status",align:"left",sortable:!1})},reloadData(e){this.purchaseOrderNumber&&this.prepareTableRows(this.purchaseOrderNumber)},prepareTableRows(e){this.rows=[];for(let t of this.poItems[e]){let e=this.getQuantityPercent(t.shipped_quantity,t.invoiced_quantity),i=this.getPOMatchedQuentyPercentatge(t.id,t.shipped_quantity),s=e+i;const o=this.formatDateWithPattern(t.received_date_time,kt.yt.date_only),a=this.formatDateWithPattern(t.promised_delivery_date,kt.yt.date_only),n=this.compareDates(o,a),l={item_id:t.item_id,delivery_number:t.delivery_number,shipped_quantity:t.shipped_quantity,invoiced_quantity:t.invoiced_quantity,invoice_open_quantity:t.invoice_open_quantity,chart_status:{received_date_time:o,promised_delivery_date:a,bar_value:s,already_delivered:e,delivered_on_time:n,no_of_days_late:n?this.dateDifferenceInDays(o,a):0}};this.rows.push(l)}this.calculateTableHeight()},getQuantityPercent(e,t){if(!e||!t||0==Number(e)||0==Number(t))return 0;let i=Number(t)/Number(e)*100;return Number(i.toFixed())},getPOMatchedQuentyPercentatge(e,t){const{found:i,invoiceQuantity:s}=this.verifyIfPoIsMatched(e);return i?this.getQuantityPercent(t,s):0},verifyIfPoIsMatched(e){let t=!1,i=0;if(!this.record.po_multi_matched||0==this.record.po_multi_matched.entries().length)return{found:t,invoiceQuantity:i};e:for(let[s,o]of this.record.po_multi_matched.entries())if(o.hasOwnProperty("po_line_id")){if(o.po_line_id==e){t=!0,i=o.quantity;break e}}else if(o.hasOwnProperty("sub_lines"))for(let[a,n]of o.sub_lines.entries())if(n.po_line_id==e){t=!0,i=n.quantity;break e}return{found:t,invoiceQuantity:i}},startResize(e){this.startY=e.clientY,this.isResizing=!0,document.addEventListener("mousemove",this.resize),document.addEventListener("mouseup",this.stopResize)},resize(e){if(this.isResizing){const t=e.clientY-this.startY;this.tableHeight+=t}},stopResize(){this.isResizing=!1,document.removeEventListener("mousemove",this.resize),document.removeEventListener("mouseup",this.stopResize)}},setup(){const e=(0,vt.R9)(),{PODataObj:t}=(0,ee.bP)(e),i=(0,ae.KR)(null),s=(0,vt.q3)(),{record:o}=(0,ee.bP)(s);let a=200;rt.A.methods.setResizeObserverHelper(i,"RECEIVE_DELIVERY_LINES_TABLE_SETTING");const n=(0,vt.Bu)(),{user_settings:l}=(0,ee.bP)(n);return{record:o,el:i,PODataObj:t,user_settings:l,tableHeight:a}}});var vi=i(1444);const ki=(0,Et.A)(yi,[["render",bi],["__scopeId","data-v-df67dd06"]]),wi=ki;Zt()(yi,"components",{QTable:Tt.A,QTr:It.A,QTh:Dt.A,QTd:Nt.A,QSlider:vi.A,QMarkupTable:Kt.A});const Ci=(0,s.Lk)("img",{width:"20",height:"20",src:"icons/dataSyncButton.svg"},null,-1),Pi={class:"secondary-c-text text-h6 text-weight-bold"},Li={class:"row"},Oi={class:"col-sm-12 col-md-12 col-lg-12"},Ei={class:"col-sm-12 col-md-12 col-lg-12"},Ti={class:"col-sm-12 col-md-12 col-lg-12"},Ii={class:"col-sm-12 col-md-12 col-lg-12"},Di=(0,s.Lk)("span",{class:"q-ml-sm"},"On resync, you may lose PO connections.",-1);function Ai(e,t,i,a,n,l){const r=(0,s.g2)("q-tooltip"),c=(0,s.g2)("f-btn"),d=(0,s.g2)("q-toolbar-title"),h=(0,s.g2)("q-toolbar"),u=(0,s.g2)("q-linear-progress"),_=(0,s.g2)("q-separator"),m=(0,s.g2)("q-input"),p=(0,s.g2)("q-checkbox"),g=(0,s.g2)("q-card-section"),b=(0,s.g2)("q-card-actions"),f=(0,s.g2)("q-card"),y=(0,s.g2)("q-dialog"),v=(0,s.g2)("q-btn"),k=(0,s.gN)("close-popup");return(0,s.uX)(),(0,s.CE)(s.FK,null,[e.is_module_on?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.bF)(c,{onClick:t[0]||(t[0]=t=>{e.showSyncDataPopup=!0,e.initForm()}),class:"q-pl-sm q-pr-sm q-mr-sm"},{default:(0,s.k6)((()=>[Ci,(0,s.bF)(r,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("sync_data")),1)])),_:1})])),_:1}),(0,s.bF)(y,{modelValue:e.showSyncDataPopup,"onUpdate:modelValue":t[8]||(t[8]=t=>e.showSyncDataPopup=t)},{default:(0,s.k6)((()=>[(0,s.bF)(f,{style:{width:"700px","max-width":"50vw"}},{default:(0,s.k6)((()=>[(0,s.bF)(f,{flat:"",class:"popup-background"},{default:(0,s.k6)((()=>[(0,s.bF)(h,{class:"pr-0"},{default:(0,s.k6)((()=>[(0,s.bF)(d,null,{default:(0,s.k6)((()=>[(0,s.Lk)("span",Pi,(0,o.v_)(e.$t("sync_data")),1)])),_:1}),(0,s.bF)(c,{flat:"",round:"",dense:"",appearance:"tertiary",icon:"close",onClick:t[1]||(t[1]=t=>e.showSyncDataPopup=!1)})])),_:1}),e.showLoading?((0,s.uX)(),(0,s.Wv)(u,{key:0,indeterminate:""})):(0,s.Q3)("",!0),(0,s.bF)(_,{class:"separator-space"}),(0,s.bF)(g,{class:"q-pa-md"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",Li,[(0,s.Lk)("div",Oi,[(0,s.bF)(m,{outlined:"",dense:"",modelValue:e.showSyncDataModel.purchase_orders,"onUpdate:modelValue":t[2]||(t[2]=t=>e.showSyncDataModel.purchase_orders=t),label:e.$t("purchase_orders")},null,8,["modelValue","label"])]),(0,s.Lk)("div",Ei,[(0,s.bF)(p,{modelValue:e.showSyncDataModel.sync_purchase_order_bod,"onUpdate:modelValue":t[3]||(t[3]=t=>e.showSyncDataModel.sync_purchase_order_bod=t),label:e.$t("sync_purchase_order")},null,8,["modelValue","label"])]),(0,s.Lk)("div",Ti,[(0,s.bF)(p,{modelValue:e.showSyncDataModel.sync_receive_delivery_bod,"onUpdate:modelValue":t[4]||(t[4]=t=>e.showSyncDataModel.sync_receive_delivery_bod=t),label:e.$t("sync_receive_delivery")},null,8,["modelValue","label"])]),(0,s.Lk)("div",Ii,[(0,s.bF)(p,{modelValue:e.showSyncDataModel.sync_receive_delivery_additional_info,"onUpdate:modelValue":t[5]||(t[5]=t=>e.showSyncDataModel.sync_receive_delivery_additional_info=t),label:e.$t("sync_receive_delivery_additional_info")},null,8,["modelValue","label"])])])])),_:1}),(0,s.bF)(b,{align:"right"},{default:(0,s.k6)((()=>[(0,s.bF)(c,{appearance:"cancel",label:e.$t("cancel"),onClick:t[6]||(t[6]=t=>e.showSyncDataPopup=!1)},null,8,["label"]),(0,s.bF)(c,{label:e.$t("sync"),class:"q-mr-sm",onClick:t[7]||(t[7]=t=>e.confirmSyncData())},null,8,["label"])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)):(0,s.Q3)("",!0),(0,s.bF)(y,{modelValue:e.showConfirmSyncDlg,"onUpdate:modelValue":t[10]||(t[10]=t=>e.showConfirmSyncDlg=t),persistent:""},{default:(0,s.k6)((()=>[(0,s.bF)(f,null,{default:(0,s.k6)((()=>[(0,s.bF)(h,{class:"text-white secondary-toolbar"},{default:(0,s.k6)((()=>[(0,s.bF)(d,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,o.v_)(e.$t("confirm")),1)])),_:1}),(0,s.bo)((0,s.bF)(v,{flat:"",round:"",dense:"",icon:"close"},null,512),[[k]])])),_:1}),(0,s.bF)(g,{class:"row items-center"},{default:(0,s.k6)((()=>[Di])),_:1}),(0,s.bF)(b,{align:"right"},{default:(0,s.k6)((()=>[(0,s.bo)((0,s.bF)(c,{appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[k]]),(0,s.bo)((0,s.bF)(c,{label:e.$t("done"),onClick:t[9]||(t[9]=t=>e.syncData())},null,8,["label"]),[[k]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var Fi=i(28684),xi=function(e,t,i,s){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function n(e){try{r(s.next(e))}catch(t){a(t)}}function l(e){try{r(s["throw"](e))}catch(t){a(t)}}function r(e){e.done?i(e.value):o(e.value).then(n,l)}r((s=s.apply(e,t||[])).next())}))};const Si=(0,s.pM)({el:"#app",emits:["refreshAlreadyAddedItem"],mixins:[te.A,rt.A,Fi.A],props:{is_module_on:{type:Boolean,default:!1},poNumber:{type:String,default:""}},components:{},data(){return{showLoading:(0,ae.KR)(!1),showSyncDataPopup:(0,ae.KR)(!1),showConfirmSyncDlg:(0,ae.KR)(!1),showSyncDataModel:(0,ae.KR)({})}},mounted:function(){this.initForm()},methods:{initForm(){this.showSyncDataModel["purchase_orders"]=this.poNumber,this.showSyncDataModel["sync_purchase_order_bod"]=!1,this.showSyncDataModel["sync_receive_delivery_bod"]=!1,this.showSyncDataModel["sync_receive_delivery_additional_info"]=!1},confirmSyncData(){this.record.hasOwnProperty("po_multi_matched")&&this.record.po_multi_matched.length>0?this.showConfirmSyncDlg=!0:this.syncData()},syncData(){return xi(this,void 0,void 0,(function*(){if(this.showSyncDataModel.purchase_orders)if(this.showSyncDataModel.sync_purchase_order_bod||this.showSyncDataModel.sync_receive_delivery_bod||this.showSyncDataModel.sync_receive_delivery_additional_info)try{this.showLoading=!0;yield ut.A0.syncData(this.showSyncDataModel);this.$emit("refreshAlreadyAddedItem",this.poNumber)}catch(e){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.showLoading=!1,this.showSyncDataPopup=!1}else this.showErrorToast("pages.messages.SELECT_ONE_SYNC_OPTION");else this.showErrorToast("pages.messages.PURCHASE_ORDER_NUMBER_MANDATORY")}))}},setup(){const e=(0,vt.q3)(),{record:t}=(0,ee.bP)(e);return{record:t}}});var Ri=i(36914),Mi=i(39150),Ni=i(35859),qi=i(10386),Ui=i(80460);const $i=(0,Et.A)(Si,[["render",Ai]]),Qi=$i;Zt()(Si,"components",{QTooltip:Ft.A,QDialog:jt.A,QCard:Wt.A,QToolbar:Ri.A,QToolbarTitle:Mi.A,QLinearProgress:Ni.A,QSeparator:qi.A,QCardSection:Xt.A,QInput:Qt.A,QCheckbox:Ui.A,QCardActions:Bt.A,QBtn:$t.A}),Zt()(Si,"directives",{ClosePopup:Jt.A});var Vi=i(57016);const Ki={class:"text-weight-medium text-h6"},ji={class:"highlighted-back"},Wi={class:"text-left",style:{"font-weight":"bold"}},Xi={class:"text-left",style:{"font-weight":"900"}},Bi=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"Move between items (Generic)"),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box"}," TAB ")])],-1),Hi=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"Move between items (specific to po Items)"),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,s.eW)(" + "),(0,s.Lk)("span",{class:"shortcut-Key-box q-ml-sm"}," m ")])],-1),zi=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"To Select or click a item"),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box"}," ENTER ")])],-1),Yi=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"Open Help"),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,s.eW)(" + "),(0,s.Lk)("span",{class:"shortcut-Key-box q-ml-sm"}," h ")])],-1),Ji={class:"text-left",style:{"font-weight":"bold"}},Gi=(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,s.eW)(" + "),(0,s.Lk)("span",{class:"shortcut-Key-box q-ml-sm"}," k ")],-1),Zi=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"Enable/Disable PO traning mode"),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,s.eW)(" + "),(0,s.Lk)("span",{class:"shortcut-Key-box q-ml-sm"}," d ")])],-1),es=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"Auto PO match"),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,s.eW)(" + "),(0,s.Lk)("span",{class:"shortcut-Key-box q-ml-sm"}," a ")])],-1),ts=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"Save PO"),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,s.eW)(" + "),(0,s.Lk)("span",{class:"shortcut-Key-box q-ml-sm"}," s ")])],-1),is=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"Reject"),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,s.eW)(" + "),(0,s.Lk)("span",{class:"shortcut-Key-box q-ml-sm"}," r ")])],-1),ss=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"Export PO"),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,s.eW)(" + "),(0,s.Lk)("span",{class:"shortcut-Key-box q-ml-sm"}," e ")])],-1),os=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"Search PO"),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,s.eW)(" + "),(0,s.Lk)("span",{class:"shortcut-Key-box q-ml-sm"}," f ")])],-1),as=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"Selecting first row of PO items "),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,s.eW)(" + "),(0,s.Lk)("span",{class:"shortcut-Key-box q-ml-sm"}," p ")])],-1),ns=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"Selecting first row of Line items "),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,s.eW)(" + "),(0,s.Lk)("span",{class:"shortcut-Key-box q-ml-sm"}," l ")])],-1),ls=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"Selecting and remove selected rows of Line items "),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,s.eW)(" + "),(0,s.Lk)("span",{class:"shortcut-Key-box q-ml-sm"}," Left Click ")])],-1),rs=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"To connect a PO line with the line item."),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,s.eW)(" + "),(0,s.Lk)("span",{class:"shortcut-Key-box q-ml-sm"}," C ")])],-1),cs=(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"bold"}},"To Connect PO Line with line item"),(0,s.Lk)("td",{class:"text-left",style:{"font-weight":"900"}},[(0,s.Lk)("span",{class:"shortcut-Key-box q-mr-sm"}," CTRL "),(0,s.eW)(" + "),(0,s.Lk)("span",{class:"shortcut-Key-box q-ml-sm"}," V ")])],-1);function ds(e,t,i,a,n,l){const r=(0,s.g2)("q-card-section"),c=(0,s.g2)("q-markup-table");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(r,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",Ki,(0,o.v_)(e.$t("keyboard_shortcuts")),1)])),_:1}),(0,s.bF)(r,{class:"v-p-0"},{default:(0,s.k6)((()=>[(0,s.bF)(c,{class:"full-width",style:{overflow:"auto","max-height":"60vh"},"virtual-scroll":""},{default:(0,s.k6)((()=>[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",ji,[(0,s.Lk)("th",Wi,(0,o.v_)(e.$t("action")),1),(0,s.Lk)("th",Xi,(0,o.v_)(e.$t("keyboard_shortcut")),1)])]),(0,s.Lk)("tbody",null,[Bi,Hi,zi,Yi,(0,s.Lk)("tr",null,[(0,s.Lk)("td",Ji,(0,o.v_)(e.$t("doc2light.descriptions.check_keyboard_shortcut")),1),Gi]),Zi,es,ts,is,ss,os,as,ns,ls,rs,cs])])),_:1})])),_:1})],64)}const hs=(0,s.pM)({el:"#app",mixins:[],props:{},components:{},data(){return{}},setup(){return{}}}),us=(0,Et.A)(hs,[["render",ds]]),_s=us;Zt()(hs,"components",{QCardSection:Xt.A,QMarkupTable:Kt.A});var ms=i(76944),ps=i(51476),gs=i(78652),bs=i(85487),fs=i(24481),ys=function(e,t,i,s){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function n(e){try{r(s.next(e))}catch(t){a(t)}}function l(e){try{r(s["throw"](e))}catch(t){a(t)}}function r(e){e.done?i(e.value):o(e.value).then(n,l)}r((s=s.apply(e,t||[])).next())}))};oi.A.table.arrowUp="arrow_drop_down";const vs=(0,s.pM)({el:"#app",mixins:[te.A,se.A,fs.A],components:{TaskBtn:li.A,LineItems:ti,SubHeader:ci.A,exportBtns:ri.A,SyncPOData:Qi,AdvanceFilter:di.A,PurchaseOrder:ni.A,MessageBanner:si.A,CreateTaskBtn:ii.A,ImageComponent:ai["default"],ErrorDocumentView:hi.A,RceiveDeliveryLines:wi,PurchaseOrderPreview:Vi.A,keyboardShortcutInfo:_s,PoTableColumnsSettings:ms.A,draggable:ce.H},data(){return{docId:"",tabsKey:(0,ae.KR)(0),imageObjStr:"",error_message:"",totalRecords:(0,ae.KR)(0),poFieldValue:(0,ae.KR)(""),poElements:[],warning_alert:{},dragableItems:[],visible_columns:[],showAdanceFilter:(0,ae.KR)(!1),currentPoElementIndex:(0,ae.KR)(0),debounceAutoSaveFunc:{},allowedDoctypes:kt.Gk,po_table_columns:kt.lv,po_auto_match_and_export:kt.aH.po_auto_match_and_export,percent:kt.aH.percent,imageFieldSplitter:(0,ae.KR)(76),dynamicWidth:(0,ae.KR)(0),charges_table_extraction:kt.lZ,showConfirmSyncDlg:(0,ae.KR)(!1),poLoading:(0,ae.KR)(!1),poToRefresh:(0,ae.KR)("")}},mounted(){this.docId=this.$route.params.id,this.record=[],this.init(),this.initFilterModel(),document.addEventListener("po_connection_success",this.lineItemConnected),document.addEventListener("po_connection_remove",this.removeLineItemPO),document.addEventListener("table_drag_mode_flag_update",this.TableDragModeHandler),document.addEventListener("update_table_data",this.updateTableDataForSave),document.addEventListener("delete_table_line",this.deleteTableLine),document.addEventListener("convert_pline_to_ltable",this.triggerTableConversion),document.addEventListener("keydown",this.keyDownEvent),document.addEventListener("trigger_auto_match",this.triggerAutoMatch),document.addEventListener("line_items_loaded",this.lineItemsLoaded),document.addEventListener("po-table-column-drop",this.onDragColumn),this.debounceAutoSaveFunc=(0,Z.A)((()=>{this.saveDataOnChanges()}),1e3),this.poElements=document.getElementsByClassName("po_iterateable_item"),window.vpo=this},unmounted:function(){document.removeEventListener("po_connection_success",this.lineItemConnected),document.removeEventListener("po_connection_remove",this.removeLineItemPO),document.removeEventListener("keydown",this.keyDownEvent),document.removeEventListener("table_drag_mode_flag_update",this.TableDragModeHandler),document.removeEventListener("update_table_data",this.updateTableDataForSave),document.removeEventListener("delete_table_line",this.deleteTableLine),document.removeEventListener("convert_pline_to_ltable",this.triggerTableConversion),document.removeEventListener("trigger_auto_match",this.triggerAutoMatch),document.removeEventListener("line_items_loaded",this.lineItemsLoaded),document.removeEventListener("po-table-column-drop",this.onDragColumn),this.resetPoMatchStore()},computed:{hasPoItems:function(){return this.po_items&&0!==Object.keys(this.po_items).length}},methods:{init(){return ys(this,void 0,void 0,(function*(){try{if(this.first_time_view_render=!0,this.processing=!0,this.error=!1,yield this.initUserSettings(),this.isDocForExtTraining(),this.fetch_po_items=!1,!0===this.ext_table_train)yield this.getExtAppPODocumentByID(this.docId);else{if(yield this.getDocumentById(this.docId),!this.record||0===Object.keys(this.record).length||!1===this.record.success)return;this.handleReadOnly()}this.initDragableList(),this.handleReadOnlyAlert(),this.imageObjStr=JSON.stringify(this.record.images);try{yield this.getPOColumns()}catch(e){this.showErrorToast(this.$t("pages.messages.PO_COLUMNS_API_ERROR"))}this.ShowStaticPO(),this.getFieldValues(),yield this.initPage(),this.verifyExport(),yield this.fetchAttributes(this.doctype),this.setPoQuantityColumn()}catch(e){if(null!=e&&"object"==typeof e&&e.hasOwnProperty("message"))return void this.showErrorToast(e.message);this.showErrorToast("Error while displaying Page. Please reload again or contact admistrator")}finally{this.processing=!1}}))},onDragColumn(e){this.updatedDragColumns(e.detail)},updatedDragColumns(e){return ys(this,void 0,void 0,(function*(){this.processing=!0;const t={};e.forEach(((e,i)=>{t[e.name]=this.visible_columns[e.name],t[e.name]&&(t[e.name]["order"]=i)}));try{let e=this.po_table_columns+"_"+this.record.doc_type;yield this.updateSetting(e,JSON.stringify(t))}catch(i){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.processing=!1}}))},setDisplayDocType(e){const t=String(e),i=this.displayDocType(t);return String(i)},splitterChanged(){let e=window.innerWidth,t=e*(100-this.imageFieldSplitter)/100;this.dynamicWidth=t},toggleImageArea(){this.imageFieldSplitter>=90?this.imageFieldSplitter=70:this.imageFieldSplitter=100},initDragableList(){this.dragableItems.push({title:this.$t("invoice"),componentName:"LineItems"}),this.user_settings[kt.aH.po_shipment_order]&&this.dragableItems.push({title:this.$t("po_shipment_order"),componentName:"RceiveDeliveryLines"})},initUserSettings(){return ys(this,void 0,void 0,(function*(){yield this.startSettingsFetch(),this.user_settings[this.po_auto_match_and_export]||(this.user_settings[this.po_auto_match_and_export]=!1),this.user_settings[kt.aH.po_shipment_order]||(this.user_settings[kt.aH.po_shipment_order]=!1),this.user_settings[this.charges_table_extraction]&&(this.isChargesModuleEnabled=!0)}))},itemSorted(e){this.initLineItems()},handleTolerance(){return ys(this,void 0,void 0,(function*(){this.is_view_readonly||(yield this.getToleranceLevel(),this.initToleranceModel())}))},isDocForExtTraining(){return ys(this,void 0,void 0,(function*(){if(!this.$route.params.ext_table_train||"true"!==this.$route.params.ext_table_train)return;this.ext_table_train=!0,this.docId=String(this.$route.query.id);const e=String(this.$route.query.token);yield this.setAuthToken(e)}))},getToken(){return ys(this,void 0,void 0,(function*(){let e=this.token&&null!=this.token&&""!=this.token?this.token:yield(0,ne.L3)();return e}))},handleReadOnlyAlert(){if(0==this.record.editable){let e="po_readonly_doc_warning";kt.B2.includes(this.record.status)&&(e="po_finished_doc_warning"),"error"===this.record.status&&(e="po_error_doc_warning"),this.warning_alert=this.showWarningAlert(this.$t(e))}},handleReadOnly(){if(this.record.status!=kt.aH.ready_for_validation)return this.is_view_readonly=!0,this.allowPOTableDrag=!1,this.trigger_document_lock=!1,void(this.error_message=this.$t("pages.messages.READ_ONLY_MSG"));this.trigger_document_lock=!0;const e=oe.tH.hasAccess("update");e||(this.is_view_readonly=!0)},initLineItems(){const e=new CustomEvent("init_line_items",{detail:this.record});document.dispatchEvent(e)},initPage(){return ys(this,void 0,void 0,(function*(){this.record&&this.record.fields&&(this.connect(),this.table_name=this.record.tables&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("name")?this.record.tables[0].name:"",this.setViewEditable(),this.setDataToCache(),this.verifyIfPONumberChanged(),this.initLineItems(),yield this.renderMultiplePOItems(),this.setTotallineItem(),yield this.checkAutoExport(),this.setActiveTab(),this.getPoFieldValue(),this.visible_columns=yield this.getSavedColumns(this.po_table_columns+"_"+this.record.doc_type),this.handleTolerance())}))},verifyExport(){this.record.hasOwnProperty("po_multi_matched")&&this.record.po_multi_matched.length?this.isExportDisabled=!1:this.isExportDisabled=!0},verifyIfPONumberChanged(){this.record.hasOwnProperty("is_purchase_order_changed")&&this.record.is_purchase_order_changed&&(this.record.po_multi_matched=[],delete this.record.is_purchase_order_changed)},setViewEditable(){this.record.editable=!0,(kt.B2.includes(this.record.status)||"error"==this.record.status)&&(this.record.editable=!1)},saveExtAppData(e=!1){return ys(this,void 0,void 0,(function*(){try{e&&(this.processing=!0);const t=yield this.saveExtAppDocument(this.docId);if(!1===t.success)return void this.showErrorToast(t.message);e&&this.showSuccessToast(this.$t("pages.messages.MSG_SAVE"))}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.processing=!1}}))},validationsForExportData(){"ORDER_CONFIRMATION"==this.record.doc_type?this.record.po_multi_matched.forEach((e=>{"success"!=e.connection_status&&(this.confirmDecision=!0)})):this.saveData()},setPOStatus(e){this.record["po_status"]=e,this.saveData()},saveData(e=!0){return ys(this,void 0,void 0,(function*(){try{if(this.is_view_readonly)return;e&&(this.processing=!0);const t=yield this.saveDocument(this.docId);if(!1===t.success){if(t.message)throw{message:t.message};throw{}}this.refreshPOinfo(),e&&this.showSuccessToast(this.$t("pages.messages.MSG_SAVE"))}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.processing=!1}}))},refreshPOinfo(){let e={};e=this.getPurchaseOrderData();for(let[t,i]of Object.entries(e))this.addToPoItems(t,i)},goToExtractionTableView(){this.$router.push("/tbl_ext_v3/"+this.$route.params.id)},ShowStaticPO(){this.$route.fullPath.match(/PO/g)&&(this.record.showStaticPo="4002513646")},removeAccountingData(){this.record.hasOwnProperty("accounting")&&delete this.record.accounting},lineItemConnected(e){if(!this.record||this.is_view_readonly)return;this.record.hasOwnProperty("po_multi_matched")?this.record.po_multi_matched.length>0&&this.removeOldPoConnection({detail:{data:e.detail.data}}):this.record.po_multi_matched=[],this.record.po_multi_matched.push(e.detail.data),this.getLineItemsPoV3Ref().setConnectedLineItems(!0),this.removeAccountingData(),this.isExportDisabled=!1;const t=new CustomEvent("reload_received_delivery_lines",{});document.dispatchEvent(t),this.debounceAutoSaveFunc()},getLineItemsPoV3Ref(){let e=this.$refs.lineItemsPoV3;return e&&Array.isArray(e)?e[0]:e},removeOldPoConnection(e){if(!this.record||!this.record.hasOwnProperty("po_multi_matched"))return;let t=e.detail.data,i=null,s=this.getLineIds(t);e:for(let[o,a]of this.record.po_multi_matched.entries()){let e=this.getLineIds(a);for(let t of s)if(e.includes(t)){i=o;break e}}null!=i&&(this.record.po_multi_matched.splice(i,1),this.removeAccountingData())},removeLineItemPO(e){if(!this.record||this.is_view_readonly||!this.record.hasOwnProperty("po_multi_matched"))return;this.blockSaveWhileRecalculating=!0;let t=!!e.detail.isPoId,i=e.detail.data,s=0;if(t?(s=this.removeConnectionUsingPoId(i),null!=s&&this.reCalculateForOneLineWithMultiPos(s)):(s=this.removeConnectionUsingLineId(i),null!=s&&this.reCalculateForOnePoWithMultiLines(s)),null==s){this.getLineItemsPoV3Ref().setConnectedLineItems(!0);const e=new CustomEvent("connection_remove",{detail:{data:i,isPoId:t}});document.dispatchEvent(e)}this.record.po_multi_matched.length>0?this.isExportDisabled=!1:this.isExportDisabled=!0,this.blockSaveWhileRecalculating=!1,this.removeAccountingData();const o=new CustomEvent("reload_received_delivery_lines",{});document.dispatchEvent(o),this.debounceAutoSaveFunc()},removeConnectionUsingPoId(e){let t=null,i=null;e:for(let[s,o]of this.record.po_multi_matched.entries())if(o.hasOwnProperty("po_line_id")){if(o.po_line_id==e){t=s;break e}}else if(o.hasOwnProperty("sub_lines"))for(let[a,n]of o.sub_lines.entries())if(n.po_line_id==e){i=a,t=s;break e}return t||0==t?i||0==i?(this.record.po_multi_matched[t].sub_lines.splice(i,1),t):(this.record.po_multi_matched.splice(t,1),null):null},removeConnectionUsingLineId(e){let t=null,i=null,s=0;e:for(let[o,a]of this.record.po_multi_matched.entries())if(a.hasOwnProperty("table_line_id")){if(a.table_line_id==e){t=o;break e}}else if(a.hasOwnProperty("table_lines")){s=0;for(let[n,l]of a.table_lines.entries())l.table_line_id==e?(i=n,t=o):s=Number(l.quantity)+s;if(i)break e}return t||0==t?i||0==i?(this.record.po_multi_matched[t].table_lines.splice(i,1),this.record.po_multi_matched[t].table_line_ids.splice(i,1),t):(this.record.po_multi_matched.splice(t,1),null):null},getLineIds(e){let t=[];if(e.hasOwnProperty("table_line_id"))t.push(e.table_line_id);else if(e.hasOwnProperty("table_line_ids"))for(let[i,s]of e.table_line_ids.entries())t.push(s);return t},findPOByPoId(e,t){let i=null;const s=this.po_items[e];for(let o of s)if(o.id==t){i=o;break}return i},reCalculateForOneLineWithMultiPos(e){let t=this.record.po_multi_matched[e],i=t.table_line_id;this.record.po_multi_matched.splice(e,1),this.getLineItemsPoV3Ref().setConnectedLineItems(!0);const s=new CustomEvent("connection_remove",{detail:{data:null,isPoId:!0}});if(document.dispatchEvent(s),i)for(let[o,a]of t.sub_lines.entries()){let e=this.findPOByPoId(a.purchase_order_number,a.po_line_id);null!=e&&this.getLineItemsPoV3Ref().makeConnectionAndsave(i,e)}},reCalculateForOnePoWithMultiLines(e){let t=this.record.po_multi_matched[e],i=t.po_line_id,s=this.findPOByPoId(t.purchase_order_number,i);this.record.po_multi_matched.splice(e,1),this.getLineItemsPoV3Ref().setConnectedLineItems(!0);const o=new CustomEvent("connection_remove",{detail:{data:null,isPoId:!1}});if(document.dispatchEvent(o),i&&s)for(let[a,n]of t.table_lines.entries())this.getLineItemsPoV3Ref().makeConnectionAndsave(n.table_line_id,s)},getFieldValues(){for(let e of this.record.fields)this.get_fields.hasOwnProperty(e.name)&&(this.get_fields[e.name]=e.formatted_value);this.record.showStaticPo&&(this.get_fields["purchase_order"]=this.record.showStaticPo)},renderMultiplePOItems(){return ys(this,void 0,void 0,(function*(){try{let e={};e=this.getPurchaseOrderData();for(let[t,i]of Object.entries(e))this.addToPoItems(t,i);if(this.is_view_readonly)return;yield this.addPoItemsFromHeaderPO(),yield this.addPoItemsFromLineItemsPO()}catch(e){}}))},fetchAddPoItems(e){return ys(this,void 0,void 0,(function*(){if(this.po_items[e]||this.fetched_po_items.hasOwnProperty(e))return;let t=yield this.getPOitems(e);this.fetched_po_items[e]=t,this.addToPoItems(e,t,!0)}))},addPoItemsFromHeaderPO(){return ys(this,void 0,void 0,(function*(){this.get_fields["purchase_order"]&&(this.po_items[this.get_fields["purchase_order"]]||(yield this.fetchAddPoItems(this.get_fields["purchase_order"])))}))},addPoItemsFromLineItemsPO(){return ys(this,void 0,void 0,(function*(){if(!this.record.tables||0==this.record.tables.length||!this.record.tables[0].hasOwnProperty("rows")||0==this.record.tables[0].rows.length)return;const e=["purchase_order_number",,"purchase_order"];for(const[t,i]of this.record.tables[0].rows.entries())if(!0!==i.is_deleted)for(const[s,o]of i.columns.entries())e.includes(o.name.toLowerCase())&&""!==o.value&&(yield this.fetchAddPoItems(o.value))}))},addToPoItems(e,t,i=!1){(0,ft.z)(this.po_items)&&(this.po_items={}),0!=(0,ft.Ns)(t)&&(this.po_items[e]=t,i?this.setPoItemsforSave():this.handlePoItemsUpdate())},handlePoItemsUpdate(){this.buildPoLinesObj(this.record.po_items),this.setupSupplierItemNumbers(this.record.po_items),this.handleCharges(this.record.po_items)},removeFromPoItems(e,t=!0){(0,ft.z)(this.po_items)||0==(0,ft.Ns)(this.po_items)||(delete this.fetched_po_items[e],delete this.po_items[e],t&&this.setPoItemsforSave())},setPoItemsforSave(){this.record&&(this.record.hasOwnProperty("po_items")||(this.record.po_items={}),this.record.po_items=this.po_items,this.handlePoItemsUpdate())},getPurchaseOrderData(){let e={};return this.record&&this.record.po_items?(e=this.record.po_items,e):e},getPOitems(e){return ys(this,void 0,void 0,(function*(){let t=[];try{if(!this.record.editable||(0,ft.jw)(e))return;const i={};i.purchase_order_number=e,i.limit=-1;const s=yield ut.A0.getPOitems(i);if(!1===s.success)throw{message:"Api response error"};!1!==s.success&&(t=s)}catch(i){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}return t}))},searchPurchaseOrder(){try{if(!this.record.editable)return;if((0,ft.jw)(this.po_search))return;this.po_preview=!0}catch(e){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.processing=!1}},clearSearch(){this.po_search="",this.po_preview_items=[],this.po_preview=!1,this.po_search_keyword=""},addToPoItemsList(){this.po_preview_items&&this.record.editable&&(this.addToPoItems(this.po_search,this.po_preview_items,!0),this.setActiveTab(),this.clearSearch())},togglePoImage(){"chevron_left"===this.togglerIcon?this.togglerIcon="chevron_right":this.togglerIcon="chevron_left",(0,ie.$)("#po-image-container").classList.toggle("hidden"),(0,ie.$)("#po-container-parrent").classList.toggle("po-container-parrent"),(0,ie.$)("#po-container-parrent").classList.toggle("po-container-parrent-full-width")},keyDownEvent(e){if("Enter"===e.key){const t=e.target;null!==t&&t.hasAttribute("data-id")&&"po_search"===t.getAttribute("data-id")&&this.searchPurchaseOrder()}else if(!e.ctrlKey||"f"!==e.key&&"F"!==e.key)if(!e.ctrlKey||"a"!==e.key&&"A"!==e.key)if(!e.ctrlKey||"s"!==e.key&&"S"!==e.key)if(!e.ctrlKey||"e"!==e.key&&"E"!==e.key)if(!e.ctrlKey||"d"!==e.key&&"D"!==e.key)if(!e.ctrlKey||"h"!==e.key&&"H"!==e.key)if(!e.ctrlKey||"k"!==e.key&&"K"!==e.key)if(!e.ctrlKey||"r"!==e.key&&"R"!==e.key){if(e.ctrlKey&&("m"===e.key||"M"===e.key)){e.preventDefault();const t=this.poElements[this.currentPoElementIndex];t&&t.focus(),this.currentPoElementIndex<this.poElements.length-1?this.currentPoElementIndex++:this.currentPoElementIndex=0}}else{e.preventDefault();const t=new CustomEvent("reject_document",{});document.dispatchEvent(t)}else e.preventDefault(),setTimeout((()=>{(0,ie.$)("#keyboard_po_btn").click()}),10);else e.preventDefault(),setTimeout((()=>{(0,ie.$)("#help_po_btn").click()}),10);else e.preventDefault(),setTimeout((()=>{(0,ie.$)("#po_training_mode_btn").click()}),10);else{e.preventDefault();const t=new CustomEvent("confirm_and_export",{});window.dispatchEvent(t)}else e.preventDefault(),setTimeout((()=>{(0,ie.$)("#save_po_btn").click()}),10);else e.preventDefault(),setTimeout((()=>{(0,ie.$)("#auto_po_match_btn").click()}),10);else e.preventDefault(),setTimeout((()=>{(0,ie.$)("#search-po").querySelector("label").click()}),10)},goToHelp(){window.open(le.v6N,"_blank")},TableDragModeHandler(e){e&&!this.is_view_readonly?this.allowPOTableDrag=!0===e.detail:this.allowPOTableDrag=!1},updateTableDataForSave(e){e&&e.detail&&this.record&&this.record.tables&&(this.updateTables(e),this.debounceAutoSaveFunc())},updateTables(e){this.record.tables=e.detail,this.setDataToCache()},saveDataOnChanges(){return ys(this,void 0,void 0,(function*(){this.is_view_readonly||this.blockSaveWhileRecalculating||this.auto_save_data&&(this.processing=!0,this.auto_saving=!0,this.auto_saved_done=!1,!0===this.ext_table_train?yield this.saveExtAppData():yield this.saveData(!1),this.getLineItemsPoV3Ref().setConnectedLineItems(!1),this.auto_saving=!1,this.auto_saved_done=!0,this.calculateMatchedTotal(),setTimeout((()=>{this.auto_saved_done=!1}),1e4),this.processing=!1)}))},addToPoItemsForPoMatch(e,t,i=!1){(0,ft.z)(this.po_items)&&(this.po_items={}),0!=(0,ft.Ns)(t)&&(this.po_items[e]=t,i?this.setPoItemsforSave():(this.buildPoLinesObj(this.record.po_items),this.handleCharges(this.record.po_items)))},refreshPOinfoForPoMatch(){let e={};e=this.getPurchaseOrderData();for(let[t,i]of Object.entries(e))this.addToPoItemsForPoMatch(t,i)},saveDataForPoMatch(e=!0){return ys(this,void 0,void 0,(function*(){try{if(this.is_view_readonly)return;e&&(this.processing=!0);const t=yield this.saveDocument(this.docId);if(!1===t.success){if(t.message)throw{message:t.message};throw{}}this.refreshPOinfoForPoMatch(),e&&this.showSuccessToast(this.$t("pages.messages.MSG_SAVE"))}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.processing=!1}}))},saveDataOnChangesForPoMatch(){return ys(this,void 0,void 0,(function*(){this.is_view_readonly||this.blockSaveWhileRecalculating||this.auto_save_data&&(this.processing=!0,this.auto_saving=!0,this.auto_saved_done=!1,!0===this.ext_table_train?yield this.saveExtAppData():yield this.saveDataForPoMatch(!1),this.auto_saving=!1,this.auto_saved_done=!0,this.calculateMatchedTotal(),setTimeout((()=>{this.auto_saved_done=!1}),1e4),this.processing=!1)}))},deleteTableLine(e){e&&e.detail&&e.detail.tables&&this.record&&this.record.tables&&(this.record.tables=e.detail.tables,this.removeOldPoConnection({detail:{data:e.detail.connection_info}}),this.setDataToCache(),this.debounceAutoSaveFunc(),this.initLineItems())},triggerTableConversion(e){this.convertPoLineToLineTable(e)},convertPoLineToLineTable(e){return ys(this,void 0,void 0,(function*(){if(e&&e.detail)try{if(this.is_view_readonly)return;let t;this.processing=!0;const i=this.getPoNumbers(e.detail);let s=yield this.getToken(),o=new FormData;if(o.append("data",JSON.stringify(this.record)),o.append("purchase_order_numbers",i),o.append("org_id",(0,bs.I)()),t=yield G.A.post(ne.FH.get_table_from_po_numbers,o,{headers:{Authorization:s}}),!1===t.data.success)throw"Api response error";this.record=t.data.data,this.initPage(),this.debounceAutoSaveFunc(),this.TableDragModeHandler({detail:!1})}catch(t){if(null!=t&&"object"==typeof t&&t.hasOwnProperty("message"))return void this.showErrorToast(t.message);this.showErrorToast(t)}finally{this.processing=!1}}))},getPoNumbers(e){if(Array.isArray(e))return e.join();if(("string"===typeof e||e instanceof String)&&""!=e)return e;throw"No Purchase number found"},autoPoMatch(){return ys(this,void 0,void 0,(function*(){try{if(this.processing=!0,this.is_view_readonly)return;const e=this.getPurchaseOrderData();if(!e||0===Object.keys(e).length)throw{message:"No Po Lines Found"};if(!this.record.tables||0==this.record.tables.length||!this.record.tables[0].hasOwnProperty("rows")||0==this.record.tables[0].rows.length)throw{message:"No Line Table found"};const t={data:JSON.stringify(this.record)},i=yield ut.A0.autoMatch(t);if(!1===i.success)throw i;this.record=i.data,this.syncDataAfterAutoMatch()}catch(e){const t=re.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.processing=!1}}))},syncDataAfterAutoMatch(){this.setDataToCache(),this.verifyExport(),this.calculateMatchedTotal(),this.syncPoMatched()},deleteLineTable(){"PO_CONVERTED_TABLE"===this.table_name&&(this.processing=!0,this.record&&(this.record.hasOwnProperty("po_multi_matched")&&(this.record.po_multi_matched=[]),this.updateTables({detail:[]}),this.debounceAutoSaveFunc(),this.initPage(),this.processing=!1))},deletePoTab(){if(!this.delete_tab_po_number||""===this.delete_tab_po_number)return;this.removeFromPoItems(this.delete_tab_po_number);this.removePoConnection(this.delete_tab_po_number);this.debounceAutoSaveFunc(),this.initPage()},triggerPoSearch(e){"Enter"===e.key&&this.triggerPoSearchOnKeyword(e.target.value)},triggerPoSearchOnKeyword(e){try{this.initFilterModel(),this.filterModel["q"]=e,this.po_preview=!0}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.poLoading=!1}},getSelectedPOitems(e){try{if(this.po_search=e,(0,ft.jw)(this.po_search)||!this.record.editable||"no_data_found"===this.po_search)return;this.triggerPoSearchOnKeyword(this.po_search)}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}},searchPurchaseOrderList(e,t,i){return ys(this,void 0,void 0,(function*(){if(!this.record.editable||(0,ft.jw)(e)||e.length<2)i();else try{this.processing=!0,e=this.removeSpaces(e);let i=[],s=yield this.getPONumberMatchlist(e);this.po_search=e,(0,ft.Ns)(s)>1&&s.forEach(((e,t)=>{const s=e.purchase_order_number;i.push(Object.assign({},{value:s,label:s}))})),0==(0,ft.Ns)(s)&&i.push(Object.assign({},{value:"no_data_found",label:this.$t("no_data_found")})),t((()=>{this.po_number_options=i})),1==(0,ft.Ns)(s)&&this.getSelectedPOitems(s[0].purchase_order_number)}catch(s){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.processing=!1}}))},displayPONumbersAsOption(e){let t="<strong>"+e.substr(0,this.po_search.length)+"</strong>";return t+=e.substr(this.po_search.length),t},getPONumberMatchlist(e){return ys(this,void 0,void 0,(function*(){let t,i=[];try{let s="?keyword="+e,o=yield this.getToken();t=yield G.A.get((0,bs.MV)(ne.FH.get_purchase_orders_list+s),{headers:{Authorization:o}}),!1!==t.data.success&&(i=t.data)}catch(s){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}return i}))},getPoFieldValue(){this.record.fields.forEach(((e,t)=>{"purchase_order"===e.name&&(this.poFieldValue=e.formatted_value)}))},isDeleteAble(e){return!e||e!==this.poFieldValue},proceedToCloseTab(e){if(!this.is_view_readonly)return e?void(this.isDeleteAble(e)&&(this.delete_tab_po_number=e,this.delete_tab_confirmation=!0)):(this.removeFromPoItems(e),void this.initPage())},cleanupPoMatched(){if(!this.record||!this.record.hasOwnProperty("po_multi_matched"))return;const e=this.getCompactPoLines();if(0==e.length)return this.record.po_multi_matched=[],void this.syncPoMatched();const t=this.getCompactLineItems();if(0==t.length)return this.record.po_multi_matched=[],void this.syncPoMatched();const i=[];for(let[s,o]of this.record.po_multi_matched.entries()){let a=this.getLineIds(o),n=this.getPurchaseOrderNumbers(o);for(let e of a)0==t.includes(e)&&(i.includes(s)||i.push(s));for(let t of n)0==e.includes(t)&&(i.includes(s)||i.push(s))}0!=i.length&&(this.record.po_multi_matched=this.record.po_multi_matched.filter(((e,t)=>!i.includes(t))),this.syncPoMatched())},syncPoMatched(){this.initLineItems(),this.initPoLines(),this.debounceAutoSaveFunc()},initPoLines(){const e=new CustomEvent("init_po_lines",{});document.dispatchEvent(e)},getCompactLineItems(){const e=[],t=(0,ie.$)("#line_item_table").querySelectorAll(".line-item-tr");if(0==t.length)return e;for(var i=0;i<t.length;i++){let s=t[i];s.dataset.id&&e.push(s.dataset.id)}return e},getCompactPoLines(){const e=[];if(0==(0,ft.Ns)(this.po_items))return e;for(const[t,i]of Object.entries(this.po_items))for(const[s,o]of Object.entries(i)){const t=o;e.push(t.id)}return e},confirmRefreshData(e){if(this.record.hasOwnProperty("po_multi_matched")&&this.record.po_multi_matched.length>0)return this.showConfirmSyncDlg=!0,void(this.poToRefresh=e);this.refreshAlreadyAddedItem(e)},refreshAlreadyAddedItem(e){return ys(this,void 0,void 0,(function*(){try{if(this.is_view_readonly)return;this.processing=!0,this.po_preview_items=yield this.getPOitems(e),this.po_preview=!0,this.po_search=e,this.addToPoItemsList(),this.processing=!1,this.saveData(),this.addToPoItemsList(),this.processing=!1,this.record.po_multi_matched=[];const t=new CustomEvent("reload_received_delivery_lines",{});document.dispatchEvent(t),this.syncPoMatched()}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}this.poToRefresh=""}))},displayAdvanceFilterResults(e){this.showAdanceFilter=!1,this.po_search="",this.po_preview_items=[],this.po_search_keyword="",e.data&&0!=e.data.length||this.showErrorToast(this.$t("no_data_found")),this.totalRecords=e.metadata.total_results,this.po_preview_items=e.data},proceedPoSelection(e){return ys(this,void 0,void 0,(function*(){try{if((0,ft.jw)(e)||(0,ft.z)(e))return;this.processing=!0,this.po_search=e,this.po_preview_items=[];let t=yield this.getPOitems(this.po_search);if(this.po_preview_items=t,(0,ft.jw)(this.po_search)||(0,ft.z)(this.po_search))return void this.clearSearch();this.addToPoItemsList(),this.processing=!1}catch(t){}}))},triggerAutoMatch(){this.execute_auto_export=!0,this.checkAutoExport(!1)},checkAutoExport(e=!0){return ys(this,void 0,void 0,(function*(){if(this.execute_auto_export&&!this.is_view_readonly&&(this.execute_auto_export=!1,yield this.autoPoMatch(),this.record.hasOwnProperty("po_match_status")&&!(0,ft.z)(this.record.po_match_status)&&fi.A0.includes(this.record.po_match_status))){if(!(0,ft.z)(this.pending_amount)&&!(0,ft.jw)(this.pending_amount)){const e=parseFloat(this.pending_amount.replace(/[^0-9]/g,""));if(e>0)return}e&&this.$refs["exportBtns"].confirmAndExport()}}))},getToleranceLevel(){return ys(this,void 0,void 0,(function*(){let e;try{this.processing=!0;const t={doc_type:this.selected_doc_type};if(e=yield ut.A0.getToleranceList(t),!e.success||!e.data)throw e}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.processing=!1}this.unit_price_tolerance=e.data.unit_price_tolerance?e.data.unit_price_tolerance:.5,this.quantity_tolerance=e.data.quantity_tolerance?e.data.quantity_tolerance:.5,this.quantity_tolerance_type=e.data.quantity_tolerance_type?e.data.quantity_tolerance_type:this.percent,this.unit_price_tolerance_type=e.data.unit_price_tolerance_type?e.data.unit_price_tolerance_type:this.percent,e.data.hasOwnProperty("item_specific_tolerances")&&Object.keys(e.data.item_specific_tolerances).forEach(((t,i)=>{this.itemSpecificTolerancesMap.set(t,e.data.item_specific_tolerances[t])})),e.data.hasOwnProperty("supplier_item_specific_tolerances")&&Object.keys(e.data.supplier_item_specific_tolerances).forEach(((t,i)=>{this.itemSpecificTolerancesMap.set(t,e.data.supplier_item_specific_tolerances[t])}))}))},updatePoTabs(){return ys(this,void 0,void 0,(function*(){this.visible_columns=yield this.getSavedColumns(this.po_table_columns+"_"+this.record.doc_type),this.tabsKey++}))},gotoTaskPendingList(){const e=(0,vt.OP)();e.getSavedListSettings(),e.setItemInFiltersMap("keyword",this.docId);const t=[];t.push({value:"open",label:"open"}),t.push({value:"in_progress",label:"in_progress"}),e.setItemInFiltersMap("status",t),this.$router.push("/tasks")},lineItemsLoaded(){this.first_time_view_render&&(this.first_time_view_render=!1,this.verifyMatchedPoIds())},verifyMatchedPoIds(){for(const[e,t]of Object.entries(this.po_connected_items))if(!this.lineDataObj.hasOwnProperty(e)){this.triggerAutoMatch();break}},setActiveTab(){0!=(0,ft.Ns)(this.po_items)&&(""!=this.tab&&this.po_items.hasOwnProperty(this.tab)&&1!=(0,ft.Ns)(this.po_items)||(this.tab=Object.keys(this.po_items)[0]))},setupSupplierItemNumbers(e){return ys(this,void 0,void 0,(function*(){try{if(this.is_view_readonly)return;let t=this.getSupplierId();if((0,ft.jw)(t))return;let i=[];if(e&&(0,ft.Ns)(e)>0)for(const[e,o]of Object.entries(this.po_items))o.hasOwnProperty("supplier_item_id")&&!this.po_supplier_item_numbers.hasOwnProperty(o.supplier_item_id)&&i.push(o.supplier_item_id);const s=i.join(",");yield this.getItemNumberDictionary(t,s)}catch(t){}}))},getSupplierId(){let e="";return this.record.fields&&Array.isArray(this.record.fields)&&this.record.fields.length>0&&this.record.fields.forEach(((t,i)=>{"supplier_id"===t.name&&(e=t.formatted_value)})),e},getItemNumberDictionary(e,t){return ys(this,void 0,void 0,(function*(){try{if((0,ft.jw)(e)||this.fetched_suppliers.hasOwnProperty(e))return;const i=yield ut.A0.getSupplierItemNumbers({supplier_id:e,item_numbers:t});if(!i.hasOwnProperty("success")||!1===i.success)throw i;this.fetched_suppliers[e]=!0;const s=i.data;for(const[e,t]of Object.entries(s)){const i={};for(const[e,s]of Object.entries(t))i[s]=s;this.po_supplier_item_numbers[e]=i}}catch(i){}}))},routeToBack(){try{if(history.state.back)return void this.$router.back();this.$router.push("/field_validation_v1/"+this.docId)}catch(e){this.$router.push("/field_validation_v1/"+this.docId)}},goToAccounting(){this.$router.push("/accounting/"+this.$route.params.id)},copyToClipboard(e){return ys(this,void 0,void 0,(function*(){try{if(!e)return;"number"===typeof e&&(e=e.toString()),yield(0,gs.A)(e),this.showSuccessToast(this.$t("success_copy_to_clipboard"))}catch(t){this.showErrorToast(this.$t("error_copy_to_clipboard"))}}))},handleCharges(e){return ys(this,void 0,void 0,(function*(){const t=[];for(const[s,o]of Object.entries(e))this.charges.hasOwnProperty(s)||(this.charges[s]={},t.push(s));if(0!=t.length)try{const e=t.join(","),i=yield ut.nb.getPoCharges({purchase_order_numbers:e});if(!1===i.success)throw i;for(const[t,s]of Object.entries(i.data)){const e=s;this.charges.hasOwnProperty(e.purchase_order_number)||(this.charges[e.purchase_order_number]={}),this.charges[e.purchase_order_number].hasOwnProperty(e.line_number)||(this.charges[e.purchase_order_number][e.line_number]=[]),this.charges[e.purchase_order_number][e.line_number].push(e)}}catch(i){}}))}},beforeRouteLeave:function(e,t,i){"function"===typeof this.warning_alert&&this.warning_alert(),this.removeCache(),this.record={},this.fetch_po_items=!0,i()},setup(){const e=(0,vt.q3)(),{record:t,processing:i,doctype:s,auto_saving:o,auto_saved_done:a,error:n,selected_doc_type:l,document_version:r,fetch_po_items:c}=(0,ee.bP)(e),{getDocumentById:d,getExtAppPODocumentByID:h,saveExtAppDocument:u,saveDocument:_,removeCache:m,setDataToCache:p,removePoConnection:g,getPurchaseOrderNumbers:b}=e,f=(0,vt._6)(),{token:y}=(0,ee.bP)(f),{setAuthToken:v}=f,k=(0,vt.R9)(),{table_columns:w,unit_price_tolerance:C,quantity_tolerance:P,itemSpecificTolerancesMap:L,quantity_tolerance_type:O,unit_price_tolerance_type:E,filterModel:T,po_connected_items:I,lineDataObj:D,is_view_readonly:A,po_supplier_item_numbers:F,pending_amount:x,po_preview_columns:S,po_quantity_column:R,isChargesModuleEnabled:M,charges:N,po_preview:q}=(0,ee.bP)(k),{calculateMatchedTotal:U,buildPoLinesObj:$,setTotallineItem:Q,initFilterModel:V,initToleranceModel:K,getSavedColumns:j,prepareFilterRequestParams:W,resetPoMatchStore:X,setPoQuantityColumn:B,getPOColumns:H}=k,z=(0,vt.Bu)(),{user_settings:Y,execute_auto_export:J}=(0,ee.bP)(z),{updateSetting:G,startSettingsFetch:Z}=z,te=(0,vt.G6)(),{connect:ie}=te,se=(0,vt.wt)(),{fetchAttributes:oe}=se,{doc_type_key:le}=(0,ee.bP)(se);let re=[];return{doc_type_key:le,fetch_po_items:c,charges:N,isChargesModuleEnabled:M,execute_auto_export:J,getPOColumns:H,startSettingsFetch:Z,pending_amount:x,po_supplier_item_numbers:F,quasarCopyToClipboard:gs.A,doctype:s,fetchAttributes:oe,setPoQuantityColumn:B,trigger_document_lock:(0,ae.KR)(!1),document_version:r,resetPoMatchStore:X,is_view_readonly:A,lineDataObj:D,po_connected_items:I,prepareFilterRequestParams:W,filterModel:T,selected_doc_type:l,buildPoLinesObj:$,connect:ie,updateSetting:G,initFilterModel:V,getSavedColumns:j,setTotallineItem:Q,initToleranceModel:K,calculateMatchedTotal:U,doc_fetch_error:(0,ae.KR)(n),auto_saving:o,auto_saved_done:a,user_settings:Y,removeCache:m,saveDocument:_,setAuthToken:v,setDataToCache:p,getDocumentById:d,saveExtAppDocument:u,removePoConnection:g,getPurchaseOrderNumbers:b,getExtAppPODocumentByID:h,token:y,processing:i,table_columns:w,record:t,tab:(0,ae.KR)(""),profile:(0,ae.KR)(""),po_preview:q,confirmDecision:(0,ae.KR)(!1),isExportDisabled:(0,ae.KR)(!0),po_preview_items:(0,ae.KR)(re),allowPODragButton:(0,ae.KR)(!0),allowPOTableDrag:(0,ae.KR)(!1),po_items:(0,ae.KR)({}),fetched_po_items:(0,ae.KR)({}),fetched_suppliers:(0,ae.KR)({}),showKeyboardShortcuts:(0,ae.KR)(!1),first_time_view_render:(0,ae.KR)(!0),togglerIcon:(0,ae.KR)("chevron_right"),baseUrl:ne.VA,get_fields:{purchase_order:"",invoice_id:""},po_preview_columns:S,po_quantity_column:R,table_name:(0,ae.KR)(""),auto_save_data:(0,ae.KR)(!0),blockSaveWhileRecalculating:(0,ae.KR)(!1),delete_tab_confirmation:(0,ae.KR)(!1),delete_table_confirmation:(0,ae.KR)(!1),delete_tab_po_number:(0,ae.KR)(""),ext_table_train:(0,ae.KR)(!1),po_number_options:(0,ae.KR)(re),po_search:(0,ae.KR)(""),po_search_keyword:(0,ae.KR)(""),itemSpecificTolerancesMap:L,unit_price_tolerance:C,quantity_tolerance:P,quantity_tolerance_type:O,unit_price_tolerance_type:E,saveUserPrefToServer:gt.wd,setWithExpiry:ps._Y,error:n}}});var ks=i(98072),ws=i(13796),Cs=i(66908),Ps=i(42980),Ls=i(10327),Os=i(39041),Es=i(71746),Ts=i(39035);const Is=(0,Et.A)(vs,[["render",J],["__scopeId","data-v-2d3e301a"]]),Ds=Is;Zt()(vs,"components",{QSplitter:ks.A,QBtn:$t.A,QIcon:At.A,QTooltip:Ft.A,QSelect:Vt.A,QItem:Rt.A,QItemSection:Mt.A,QItemLabel:ws.A,QMenu:xt.A,QToggle:Cs.A,QTabs:Ps.A,QTab:Ls.A,QList:St.A,QSeparator:qi.A,QTabPanels:Os.A,QTabPanel:Es.A,QMarkupTable:Kt.A,QDialog:jt.A,QCard:Wt.A,QCardActions:Bt.A,QCardSection:Xt.A,QAvatar:Ht.A,QInnerLoading:Ts.A,QToolbar:Ri.A,QToolbarTitle:Mi.A,QField:Yt.A}),Zt()(vs,"directives",{ClosePopup:Jt.A})}}]);