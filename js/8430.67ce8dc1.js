"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[8430],{68430:(t,e,s)=>{s.r(e),s.d(e,{default:()=>ke});var a=s(61758),i=s(58790),o=s(29104);const r=t=>((0,a.Qi)("data-v-cd6a94f8"),t=t(),(0,a.jt)(),t),l=r((()=>(0,a.Lk)("link",{href:"https://fonts.googleapis.com/icon?family=Material+Icons",rel:"stylesheet"},null,-1))),n={key:0,class:"row justify-center q-pa-lg"},d={key:1},u={key:0},c={key:0,class:"full-width"},h={class:"highlighted-back"},p={class:"q-pa-lg flex flex-center"},_={key:0},m={class:"text-center",colspan:"10"},g={key:0,class:"row justify-center q-pa-lg"},f={key:1,class:"full-width"},b={key:2,class:"full-width"},v={class:"q-ml-sm"},w={cellspacing:"0",cellpadding:"0",style:{border:"none",width:"100%"}},y={style:{width:"5%"}},k={style:{padding:"5%","text-align":"center"}},D={style:{width:"5%"}},C={cellspacing:"5px",cellpadding:"5px",style:{border:"none",width:"100%"}},L={cellspacing:"0",cellpadding:"0",style:{border:"none",width:"100%"}},E={style:{width:"5%"}},x={style:{padding:"5%","text-align":"center"}},S={style:{width:"5%"}},F={cellspacing:"5px",cellpadding:"5px",style:{border:"none",width:"100%"}},A={style:{"text-align":"center"}},R={class:"q-ml-sm"};function T(t,e,s,r,T,M){const O=(0,a.g2)("SupplierApprovalStatus"),P=(0,a.g2)("SubHeader"),I=(0,a.g2)("MobileGrid"),$=(0,a.g2)("q-markup-table"),q=(0,a.g2)("q-pagination"),Q=(0,a.g2)("DashboardHeader"),W=(0,a.g2)("q-separator"),K=(0,a.g2)("DashboardLinearView"),B=(0,a.g2)("GroupingDashboardTabulator"),V=(0,a.g2)("WorkflowLogs"),H=(0,a.g2)("q-dialog"),X=(0,a.g2)("q-avatar"),z=(0,a.g2)("q-card-section"),N=(0,a.g2)("f-btn"),G=(0,a.g2)("q-card-actions"),j=(0,a.g2)("q-card"),U=(0,a.g2)("q-btn"),Y=(0,a.g2)("DocAssignment"),J=(0,a.g2)("Loader"),Z=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)(a.FK,null,[l,"pending_registration"===t.supplierApprovalStatus||"pending_supplier_input"===t.supplierApprovalStatus||"pending_approval"===t.supplierApprovalStatus||"rejected"===t.supplierApprovalStatus?((0,a.uX)(),(0,a.CE)("div",n,[(0,a.bF)(O,{status:t.supplierApprovalStatus,supplier_as_org_id:t.supplier_as_org_id,supplier_lookup_record_id:t.supplier_lookup_record_id},null,8,["status","supplier_as_org_id","supplier_lookup_record_id"])])):((0,a.uX)(),(0,a.CE)("div",d,[(0,a.bF)(P,{name:"dashboard",label:t.$t("pages.screen2a.dashboard"),show_expiry_alert:!0},null,8,["label"]),t.isMobile()?((0,a.uX)(),(0,a.CE)("div",u,[t.display_data&&t.display_data.length>0?((0,a.uX)(),(0,a.CE)("div",c,[(0,a.bF)(I,{table_data:t.display_data,onRowClick:t.rowClick},null,8,["table_data","onRowClick"])])):((0,a.uX)(),(0,a.Wv)($,{key:1,flat:"",class:"full-width"},{default:(0,a.k6)((()=>[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",h,[(0,a.Lk)("th",null,(0,i.v_)(t.$t("no_data_found")),1)])])])),_:1})),(0,a.Lk)("div",p,[t.display_data.length>0?((0,a.uX)(),(0,a.CE)("tr",_,[(0,a.Lk)("td",m,[(0,a.bF)(q,{modelValue:t.paginationCount,"onUpdate:modelValue":e[0]||(e[0]=e=>t.paginationCount=e),color:"primary",max:t.skip,"max-pages":6,"direction-links":"","boundary-links":"",onClick:e[1]||(e[1]=e=>t.loadData())},null,8,["modelValue","max"])])])):(0,a.Q3)("",!0)])])):((0,a.uX)(),(0,a.CE)("div",{key:1,class:"dashboard-container dashboard-text-color dashboard-main",onDrop:e[2]||(e[2]=(...e)=>t.drop&&t.drop(...e)),onDragover:e[3]||(e[3]=(...e)=>t.allowDrop&&t.allowDrop(...e)),onDragleave:e[4]||(e[4]=(...e)=>t.dragLeave&&t.dragLeave(...e))},["pending_registration"===t.supplierApprovalStatus||"pending_supplier_input"===t.supplierApprovalStatus||"pending_approval"===t.supplierApprovalStatus||"rejected"===t.supplierApprovalStatus?((0,a.uX)(),(0,a.CE)("div",g,[(0,a.bF)(O,{status:t.supplierApprovalStatus,supplier_as_org_id:t.supplier_as_org_id,supplier_lookup_record_id:t.supplier_lookup_record_id},null,8,["status","supplier_as_org_id","supplier_lookup_record_id"])])):(0,a.Q3)("",!0),(0,a.bF)(Q),(0,a.bF)(W,{class:"seperator"}),t.isGroupingTable?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",f,[t.tabulator_table_columns.length>0?((0,a.uX)(),(0,a.Wv)(K,{key:0,tabulator_table_columns:t.tabulator_table_columns,rowMenu:t.rowMenu,display_data:t.display_data,current_invoice_count:t.current_invoice_count,onLoadDataOnScroll:t.loadDataOnScroll,onSetSelectionList:t.setSelectionList,onRowClickEvent:t.rowClick},null,8,["tabulator_table_columns","rowMenu","display_data","current_invoice_count","onLoadDataOnScroll","onSetSelectionList","onRowClickEvent"])):(0,a.Q3)("",!0)])),t.isGroupingTable?((0,a.uX)(),(0,a.CE)("div",b,[t.tabulator_table_columns.length>0?((0,a.uX)(),(0,a.Wv)(B,{key:0,tabulator_table_columns:t.tabulator_table_columns,rowMenu:t.rowMenu,display_data:t.display_data,onSetSelectionList:t.setSelectionList,onRowClickEvent:t.rowClick,onUpdateDocumentStats:t.updateDocumentStats,onReformatTableColumns:t.reformatTableColumns},null,8,["tabulator_table_columns","rowMenu","display_data","onSetSelectionList","onRowClickEvent","onUpdateDocumentStats","onReformatTableColumns"])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)],32))])),(0,a.bF)(H,{modelValue:t.WorkflowLogs,"onUpdate:modelValue":e[5]||(e[5]=e=>t.WorkflowLogs=e),onKeypress:e[6]||(e[6]=(0,o.jR)((e=>t.WorkflowLogs=!1),["esc"]))},{default:(0,a.k6)((()=>[(0,a.bF)(V,{doc_id:t.workflow_doc_id},null,8,["doc_id"])])),_:1},8,["modelValue"]),(0,a.bF)(H,{modelValue:t.deleteInvoice,"onUpdate:modelValue":e[8]||(e[8]=e=>t.deleteInvoice=e),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(j,null,{default:(0,a.k6)((()=>[(0,a.bF)(z,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,a.k6)((()=>[(0,a.bF)(X,{icon:"warning",color:"primary"})])),_:1}),(0,a.bF)(z,{class:"row items-center"},{default:(0,a.k6)((()=>[(0,a.Lk)("span",v,(0,i.v_)(t.$t("sure")),1)])),_:1}),(0,a.bF)(G,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(N,{appearance:"cancel","data-cy":"cancel",label:t.$t("cancel")},null,8,["label"]),[[Z]]),(0,a.bo)((0,a.bF)(N,{label:t.$t("delete"),"data-cy":"delete-popup",onClick:e[7]||(e[7]=e=>t.deleteRecord(t.recordId))},null,8,["label"]),[[Z]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(H,{modelValue:t.ErrorInfos,"onUpdate:modelValue":e[9]||(e[9]=e=>t.ErrorInfos=e)},{default:(0,a.k6)((()=>[(0,a.bF)(j,null,{default:(0,a.k6)((()=>[(0,a.bF)(z,{class:"row items-center"},{default:(0,a.k6)((()=>[(0,a.Lk)("table",w,[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("td",y,[(0,a.bF)(X,{icon:"error",color:"red-6",style:{margin:"3%"}})]),(0,a.Lk)("td",null,[(0,a.Lk)("div",k,[(0,a.Lk)("b",null,(0,i.v_)(this.ErrorText["row"]["filename"]),1)])]),(0,a.Lk)("td",D,[(0,a.bF)(X,{icon:"error",color:"red-6",style:{margin:"3%"}})])])])]),(0,a.Lk)("table",C,[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,[(0,a.Lk)("span",null,(0,i.v_)(t.$t("upload_failed")),1)])])])])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(H,{modelValue:t.QualityConfirm,"onUpdate:modelValue":e[12]||(e[12]=e=>t.QualityConfirm=e)},{default:(0,a.k6)((()=>[(0,a.bF)(j,null,{default:(0,a.k6)((()=>[(0,a.bF)(z,{class:"row items-center"},{default:(0,a.k6)((()=>[(0,a.Lk)("table",L,[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("td",E,[(0,a.bF)(X,{icon:"warning",color:"yellow-6",style:{margin:"3%"}})]),(0,a.Lk)("td",null,[(0,a.Lk)("div",x,[(0,a.Lk)("b",null,(0,i.v_)(this.QualityText["row"]["filename"]),1)])]),(0,a.Lk)("td",S,[(0,a.bF)(X,{icon:"warning",color:"yellow-6",style:{margin:"3%"}})])])])]),(0,a.Lk)("table",F,[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("td",A,[(0,a.Lk)("span",null,(0,i.v_)(t.$t("low_quality")),1)])])])]),(0,a.bF)(U,{class:"button-1",onClick:e[10]||(e[10]=e=>t.restartExport(this.docrowID)),label:t.$t("run_anyway")},null,8,["label"]),(0,a.bF)(U,{class:"button-2",onClick:e[11]||(e[11]=e=>{t.recordId=this.docrowID,t.deleteInvoice=!0,t.QualityConfirm=!1}),label:t.$t("delete")},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(H,{modelValue:t.assigneDialog,"onUpdate:modelValue":e[13]||(e[13]=e=>t.assigneDialog=e)},{default:(0,a.k6)((()=>[(0,a.bF)(Y,{doc_ids:t.assignment_doc_ids},null,8,["doc_ids"])])),_:1},8,["modelValue"]),(0,a.bF)(H,{modelValue:t.confirmMergeDialog,"onUpdate:modelValue":e[15]||(e[15]=e=>t.confirmMergeDialog=e),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(j,null,{default:(0,a.k6)((()=>[(0,a.bF)(z,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,a.k6)((()=>[(0,a.bF)(X,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,a.bF)(z,{class:"row items-center"},{default:(0,a.k6)((()=>[(0,a.Lk)("span",R,(0,i.v_)(t.$t("merge_doc_warning")),1)])),_:1}),(0,a.bF)(G,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(N,{appearance:"cancel",label:t.$t("cancel")},null,8,["label"]),[[Z]]),(0,a.bo)((0,a.bF)(N,{label:t.$t("done"),onClick:e[14]||(e[14]=e=>t.mergeDocuments())},null,8,["label"]),[[Z]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(J)],64)}var M=s(82303),O=s(66845),P=s(1659),I=s(6044),$=s(24622),q=s(45938),Q=s(38734),W=s(46162),K=s(96056),B=s(89156),V=s(18505),H=s(64233),X=s(24481),z=s(57366),N=s(64775),G=s(51476),j=s(25891),U=s(94891),Y=s(44415),J=s(28545),Z=s(11470),tt=s(83319),et=s(77362),st=s(36246),at=s(45022),it=s(41903),ot=s(53500),rt=s(76956),lt=s(68450);const nt={class:"text-weight-bold text-white"},dt={class:"q-pl-md q-pr-md q-pt-md"},ut={class:"text-item"},ct={key:0,style:{"column-width":"100px"}},ht={key:0,style:{"text-wrap":"wrap","column-width":"100px"}},pt={style:{"text-wrap":"wrap","column-width":"200px"}},_t=(0,a.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1);function mt(t,e,s,o,r,l){const n=(0,a.g2)("q-toolbar-title"),d=(0,a.g2)("q-btn"),u=(0,a.g2)("q-toolbar"),c=(0,a.g2)("q-th"),h=(0,a.g2)("q-tr"),p=(0,a.g2)("q-td"),_=(0,a.g2)("q-table"),m=(0,a.g2)("q-card-section"),g=(0,a.g2)("q-card"),f=(0,a.g2)("q-inner-loading"),b=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(g,{style:{width:"75%","max-width":"75%","text-wrap":"wrap"}},{default:(0,a.k6)((()=>[(0,a.bF)(u,{class:"secondary-toolbar"},{default:(0,a.k6)((()=>[(0,a.bF)(n,null,{default:(0,a.k6)((()=>[(0,a.Lk)("span",nt,(0,i.v_)(t.$t("workflow_logs")),1)])),_:1}),(0,a.bo)((0,a.bF)(d,{flat:"",round:"",dense:"",icon:"close",color:"white"},null,512),[[b]])])),_:1}),(0,a.bF)(m,null,{default:(0,a.k6)((()=>[(0,a.Lk)("div",dt,[(0,a.bF)(_,{class:"dashboard-table-style back-white","rows-per-page-options":[11],rows:t.rows,columns:t.columns,"row-key":"id","table-header-class":"table-header-text","hide-bottom":"","virtual-scroll":"","virtual-scroll-item-size":48,"no-data-label":t.$t("no_data_found"),flat:"","no-results-label":"The filter didn't uncover any results",style:{overflow:"auto",height:"600px","text-wrap":"wrap"},"wrap-cells":""},{header:(0,a.k6)((e=>[(0,a.bF)(h,{props:e},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.cols,((t,s)=>((0,a.uX)(),(0,a.Wv)(c,{key:t.name,props:e,"data-index":s},{default:(0,a.k6)((()=>[(0,a.Lk)("span",ut,(0,i.v_)(t.label),1)])),_:2},1032,["props","data-index"])))),128))])),_:2},1032,["props"]),0==t.rows.length?((0,a.uX)(),(0,a.Wv)(h,{key:0},{default:(0,a.k6)((()=>[(0,a.bF)(p,{colspan:"20",class:"text-center"},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(t.$t("no_data_found")),1)])),_:1})])),_:1})):(0,a.Q3)("",!0)])),body:(0,a.k6)((t=>[(0,a.bF)(h,{props:t,id:t.key},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.cols,(e=>((0,a.uX)(),(0,a.CE)(a.FK,{key:e.name},["workflow_name"==e.name?((0,a.uX)(),(0,a.Wv)(p,{key:0,style:{"column-width":"100px"}},{default:(0,a.k6)((()=>["workflow_name"===e.name?((0,a.uX)(),(0,a.CE)("span",ct,(0,i.v_)(t.row[e.name]),1)):(0,a.Q3)("",!0)])),_:2},1024)):"created_on"==e.name?((0,a.uX)(),(0,a.Wv)(p,{key:1,style:{"column-width":"100px"}},{default:(0,a.k6)((()=>["created_on"===e.name?((0,a.uX)(),(0,a.CE)("span",ht,(0,i.v_)(t.row[e.name]),1)):(0,a.Q3)("",!0)])),_:2},1024)):((0,a.uX)(),(0,a.Wv)(p,{key:2},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.row[e.name],(t=>((0,a.uX)(),(0,a.CE)("div",{key:t},[(0,a.Lk)("span",pt,(0,i.v_)(t),1)])))),128))])),_:2},1024))],64)))),128))])),_:2},1032,["props","id"])])),_:1},8,["rows","columns","no-data-label"])])])),_:1})])),_:1}),(0,a.bF)(f,{showing:t.loading},{default:(0,a.k6)((()=>[_t])),_:1},8,["showing"])],64)}var gt=function(t,e,s,a){function i(t){return t instanceof s?t:new s((function(e){e(t)}))}return new(s||(s=Promise))((function(s,o){function r(t){try{n(a.next(t))}catch(e){o(e)}}function l(t){try{n(a["throw"](t))}catch(e){o(e)}}function n(t){t.done?s(t.value):i(t.value).then(r,l)}n((a=a.apply(t,e||[])).next())}))};const ft=(0,a.pM)({mixins:[$.A,V.A],props:{setheight:{type:String,required:!0},doc_id:{type:String,required:!0}},components:{},watch:{},computed:{},mounted:function(){this.init(),this.checkWorkflowLogs()},methods:{init(){this.prepareColumns()},checkWorkflowLogs(){try{this.loading=!0,this.getDataFromServer()}catch(t){const e=N.t.getErrorMessage(t);this.showErrorToast(e),logError(t)}finally{this.loading=!1}},getDataFromServer(){return gt(this,void 0,void 0,(function*(){try{this.loading=!0,this.request_params={},this.request_params["with_name"]=!0;const t=yield Z.Bj.getWorkflowLogsForDoc(this.doc_id,this.request_params);if(!1===t.success)throw{message:t.message};this.prepareRows(t.logs),this.WorkflowLogs=!0}catch(t){const e=N.t.getErrorMessage(t);this.showErrorToast(e),logError(t)}finally{this.loading=!1}}))},prepareRows(t){this.rows=[],Array.from(t).forEach((t=>{let e=t;e["created_on"]=t["created_on"],e["id"]=t["id"],e["run_time"]=t["run_time_mili_seconds"],e["workflow_id"]=t["workflow_id"],e["logs"]=t["logs"],e["workflow_name"]=t["workflow_name"],this.addNewRow(e)}))},addNewRow(t){let e=Object.assign({},t);return e["created_on"]=this.formatDate(t["created_on"],"DD-MM-YYYY HH:mm:ss"),this.rows.push(e),logInfo("addNewRow",this.rows),this.rows.length.toString()},formatDate(t,e){return st.Ay.formatDate(t,e)},prepareColumns(){this.columns=[],this.columns.push({name:"workflow_name",field:"workflow_name",label:this.$t("workflow_name"),align:"left",style:"width: 70%;"}),this.columns.push({name:"created_on",field:"created_on",label:this.$t("workflow_ran_on"),align:"left"}),this.columns.push({name:"logs",field:"logs",label:this.$t("workflow_log"),align:"left"})},cleanupOnhide(){this.WorkflowLogs=!1}},setup(){return{loading:(0,Q.KR)(!1),request_params:(0,Q.KR)({}),columns:(0,Q.KR)([]),rows:(0,Q.KR)([]),WorkflowLogs:(0,Q.KR)(!0)}}});var bt=s(12807),vt=s(23316),wt=s(36914),yt=s(39150),kt=s(56384),Dt=s(44189),Ct=s(42315),Lt=s(44488),Et=s(57722),xt=s(45262),St=s(39035),Ft=s(88672),At=s(98582),Rt=s.n(At);const Tt=(0,bt.A)(ft,[["render",mt]]),Mt=Tt;Rt()(ft,"components",{QCard:vt.A,QToolbar:wt.A,QToolbarTitle:yt.A,QBtn:kt.A,QCardSection:Dt.A,QTable:Ct.A,QTr:Lt.A,QTh:Et.A,QTd:xt.A,QInnerLoading:St.A}),Rt()(ft,"directives",{ClosePopup:Ft.A});var Ot=s(62488);const Pt={class:"full-width"},It=(0,a.Lk)("div",{id:"dashboard-tabulator-table"},null,-1);function $t(t,e,s,i,o,r){const l=(0,a.g2)("q-linear-progress");return(0,a.uX)(),(0,a.CE)("div",Pt,[t.processing?((0,a.uX)(),(0,a.Wv)(l,{key:0,indeterminate:""})):(0,a.Q3)("",!0),It])}var qt=s(95055);const Qt=(0,a.pM)({name:"DashboardLinearView",emits:["loadDataOnScroll","setSelectionList","rowClickEvent"],props:{tabulator_table_columns:{type:Array,default:()=>[]},rowMenu:{type:[{}],default:[]},display_data:{type:[{}],default:[]},current_invoice_count:{type:Number,default:0}},watch:{},data(){return{lastCallTime:(0,Q.KR)(0)}},mounted:function(){this.initializeTable(),document.addEventListener("table_data_updated",this.updateTableData),document.addEventListener("clear_table_data",this.resetTableData),document.addEventListener("delete_rows",this.deleteMultipleRows),document.addEventListener("update_columns",this.updateTableColumns)},unmounted:function(){document.removeEventListener("table_data_updated",this.updateTableData),document.removeEventListener("clear_table_data",this.resetTableData),document.removeEventListener("delete_rows",this.deleteMultipleRows),document.removeEventListener("update_columns",this.updateTableColumns)},methods:{initializeTable(){this.table=new qt.mu("#dashboard-tabulator-table",{maxHeight:"calc(100vh - 340px)",layout:"fitDataFill",widthGrow:5,persistence:{columns:["order"]},virtualDomBuffer:300,rowContextMenu:this.rowMenu,movableColumns:!0,data:[],tooltips:!0,columns:this.tabulator_table_columns}),this.table.on("cellClick",((t,e)=>{var s=e.getColumn().getDefinition();"po_icon"!==s.field&&"row_selection"!==s.field&&this.$emit("rowClickEvent",e.getData())})),this.table.on("rowSelectionChanged",(t=>{let e=[];t.forEach((t=>{e.push(t.id)})),this.$emit("setSelectionList",e)})),this.table.on("tableBuilt",(()=>{this.addScrollEventToTable()}))},addScrollEventToTable(){let t=document.querySelector(".tabulator-tableholder");t.addEventListener("scroll",this.onScrollLoadData)},onScrollLoadData(){if(!(this.table.getDataCount()>=this.current_invoice_count)&&this.isScrollNearBottom()){const t=Date.now(),e=t-this.lastCallTime;if(e<1e3)return;this.$emit("loadDataOnScroll"),this.lastCallTime=Date.now()}},isScrollNearBottom(){const t=document.querySelector(".tabulator-tableholder");return!(t.clientHeight<50)&&t.scrollHeight-t.scrollTop<=t.clientHeight+1},updateTableData(t){t.detail.clearOldData&&this.table.clearData(),this.table.updateOrAddData(t.detail.data)},resetTableData(t){this.table.clearData()},deleteMultipleRows(t){this.table.deleteRow(t.detail.data)},updateTableColumns(t){this.table.setColumns(t.detail.data)}},setup(){const t=(0,tt.fX)(),{processing:e,table:s}=(0,P.bP)(t);return{table:s,processing:e}}});var Wt=s(35859);const Kt=(0,bt.A)(Qt,[["render",$t]]),Bt=Kt;Rt()(Qt,"components",{QLinearProgress:Wt.A});var Vt=s(85487);const Ht=t=>((0,a.Qi)("data-v-7068cf29"),t=t(),(0,a.jt)(),t),Xt={class:"row"},zt={class:"col-sm-12 col-md-8 col-lg-9"},Nt={key:0,class:"row q-pb-md"},Gt={key:0,class:"q-ml-sm"},jt={class:"col-sm-12 col-md-4 col-lg-3"},Ut=Ht((()=>(0,a.Lk)("div",{id:"grouping-table"},null,-1)));function Yt(t,e,s,o,r,l){const n=(0,a.g2)("q-item-label"),d=(0,a.g2)("q-item-section"),u=(0,a.g2)("q-item"),c=(0,a.g2)("q-list"),h=(0,a.g2)("q-popup-proxy"),p=(0,a.g2)("q-icon"),_=(0,a.g2)("q-badge"),m=(0,a.g2)("draggable"),g=(0,a.g2)("q-tooltip"),f=(0,a.g2)("f-btn"),b=(0,a.g2)("q-separator"),v=(0,a.g2)("q-linear-progress"),w=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",Xt,[(0,a.Lk)("div",zt,[t.groupedColumns?((0,a.uX)(),(0,a.CE)("div",Nt,[(0,a.bF)(m,{modelValue:t.groupedColumns,"onUpdate:modelValue":e[0]||(e[0]=e=>t.groupedColumns=e),class:"dragArea","item-key":"name",group:{name:"groups",pull:!1,put:!0},sort:!0,"ghost-class":"sortable__ghost",onEnd:t.handleSortEnd},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.dragableItems,((e,s)=>((0,a.uX)(),(0,a.Wv)(_,{key:e.name,rounded:"",color:"primary",class:"q-mr-sm capitalize cursor-pointer"},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.title)+" ",1),e.value?((0,a.uX)(),(0,a.CE)("span",Gt," ("+(0,i.v_)(e.value)+")",1)):(0,a.Q3)("",!0),e.value?((0,a.uX)(),(0,a.Wv)(h,{key:1,anchor:"bottom end",self:"top end"},{default:(0,a.k6)((()=>[(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bo)(((0,a.uX)(),(0,a.Wv)(u,{clickable:"",onClick:s=>{e.value="day",t.resetAndFetchAgain()}},{default:(0,a.k6)((()=>[(0,a.bF)(d,null,{default:(0,a.k6)((()=>[(0,a.bF)(n,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(t.$t("day")),1)])),_:1})])),_:1})])),_:2},1032,["onClick"])),[[w]]),(0,a.bo)(((0,a.uX)(),(0,a.Wv)(u,{clickable:"",onClick:s=>{e.value="week",t.resetAndFetchAgain()}},{default:(0,a.k6)((()=>[(0,a.bF)(d,null,{default:(0,a.k6)((()=>[(0,a.bF)(n,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(t.$t("week")),1)])),_:1})])),_:1})])),_:2},1032,["onClick"])),[[w]]),(0,a.bo)(((0,a.uX)(),(0,a.Wv)(u,{clickable:"",onClick:s=>{e.value="month",t.resetAndFetchAgain()}},{default:(0,a.k6)((()=>[(0,a.bF)(d,null,{default:(0,a.k6)((()=>[(0,a.bF)(n,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(t.$t("month")),1)])),_:1})])),_:1})])),_:2},1032,["onClick"])),[[w]])])),_:2},1024)])),_:2},1024)):(0,a.Q3)("",!0),(0,a.bF)(p,{name:"close",color:"white",class:"q-ml-xs cursor-pointer",onClick:e=>t.removeGroup(s)},null,8,["onClick"])])),_:2},1024)))),128))])),_:1},8,["modelValue","onEnd"])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",jt,[(0,a.bF)(f,{square:"",class:"float-right",onClick:t.downloadCsv},{default:(0,a.k6)((()=>[(0,a.bF)(p,{name:"img:icons/csv.png",class:"invert-100"}),(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.eW)("Download Dataset In CSV format")])),_:1})])),_:1},8,["onClick"]),(0,a.bF)(f,{square:"",class:"float-right q-mr-sm",onClick:t.downloadXlsx},{default:(0,a.k6)((()=>[(0,a.bF)(p,{name:"img:icons/xlsx.svg",class:"invert-100"}),(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.eW)("Download Dataset In excel formate")])),_:1})])),_:1},8,["onClick"])])]),(0,a.bF)(b,{class:"seperator q-mt-sm"}),t.loading?((0,a.uX)(),(0,a.Wv)(v,{key:0,indeterminate:""})):(0,a.Q3)("",!0),Ut],64)}var Jt=s(39231),Zt=function(t,e,s,a){function i(t){return t instanceof s?t:new s((function(e){e(t)}))}return new(s||(s=Promise))((function(s,o){function r(t){try{n(a.next(t))}catch(e){o(e)}}function l(t){try{n(a["throw"](t))}catch(e){o(e)}}function n(t){t.done?s(t.value):i(t.value).then(r,l)}n((a=a.apply(t,e||[])).next())}))};const te=(0,a.pM)({components:{draggable:Jt.H},mixins:[V.A,$.A],emits:["updateDocumentStats","setSelectionList","rowClickEvent","reformatTableColumns"],props:{tabulator_table_columns:{type:Array,default:()=>[]},rowMenu:{type:[{}],default:[]},display_data:{type:[{}],default:[]},current_invoice_count:{type:Number,default:0}},data(){return{group_key:(0,Q.KR)(rt.aH.group_key),loading:(0,Q.KR)(!1),lastCallTime:(0,Q.KR)(0),groupedColumns:(0,Q.KR)([]),paginationObj:{startRow:0,pageSize:20,totalRecords:0},date_fields:["created_on","last_modified_on","invoice_date","delivery_date","order_date"]}},mounted(){this.init();const t=document.createElement("script");t.setAttribute("src","https://oss.sheetjs.com/sheetjs/xlsx.full.min.js"),document.head.appendChild(t),document.addEventListener("fetch_data",this.refreshData),document.addEventListener("delete_rows",this.deleteMultipleRows),document.addEventListener("clear_table_data",this.resetTableData),document.addEventListener("update_columns",this.updateTableColumns),window.gd=this},unmounted:function(){document.removeEventListener("fetch_data",this.refreshData),document.removeEventListener("delete_rows",this.deleteMultipleRows),document.removeEventListener("clear_table_data",this.resetTableData),document.removeEventListener("update_columns",this.updateTableColumns)},methods:{init(){this.$nextTick((function(){this.initTable()})),this.initGroups()},initGroups(){this.group_key=(0,G.un)(this.group_key);const t=at.A.getItem(this.group_key);t&&(this.groupedColumns=JSON.parse(t))},initTable(){this.table=new qt.mu("#grouping-table",{maxHeight:"calc(100vh - 350px)",layout:"fitDataFill",persistence:{columns:["order"]},widthGrow:5,dataTree:!0,movableColumns:!0,virtualDomBuffer:3e3,data:[],columns:this.tabulator_table_columns,dataTreeStartExpanded:!1,paginationSizeSelector:[10,20,50],rowContextMenu:this.rowContextMenu,rowFormatter:function(t){if(t.getData().hasOwnProperty("_children")){var e=t.getCell("row_selection");e.getElement().style.visibility="hidden"}}}),this.table.on("headerDblClick",this.headerColumnDblClick),this.table.on("dataTreeRowExpanded",this.dataTreeRowExpanded),this.table.on("cellClick",((t,e)=>{var s=e.getColumn().getDefinition();"po_icon"!==s.field&&"row_selection"!==s.field&&(e.getRow().getData().hasOwnProperty("_children")||this.$emit("rowClickEvent",e.getData()))})),this.table.on("tableBuilt",(()=>{this.handleTableRenderComplete()})),this.table.on("rowSelectionChanged",(t=>{let e=[];t.forEach((t=>{e.push(t.id)})),this.$emit("setSelectionList",e)}))},rowContextMenu(t,e){if(!e.getData()._children)return this.rowMenu},handleTableRenderComplete(){const t=document.getElementById("grouping-table");if(!t)return;const e=t.querySelector(".tabulator-tableholder");e&&e.addEventListener("scroll",this.onScrollLoadData)},onScrollLoadData(){if(!(this.table.getDataCount()>=this.paginationObj.totalRecords)&&this.isScrollNearBottom()){const t=Date.now(),e=t-this.lastCallTime;if(e<1e3)return;this.paginationObj.startRow+=this.paginationObj.pageSize,this.fetchNextGroupData(this.groupedColumns[0],[],null,this.paginationObj),this.lastCallTime=Date.now()}},isScrollNearBottom(){var t=document.getElementById("grouping-table");const e=t.querySelector(".tabulator-tableholder");return!(e.clientHeight<50)&&e.scrollHeight-e.scrollTop<=e.clientHeight+1},dataTreeRowExpanded(t,e){if(t._row.data._children.length>=this.paginationObj.pageSize)return;t.update({_children:[]});const s=this.getGroupingWhere(t),a=this.getGroupBy(s.length),i={startRow:0,pageSize:t._row.data.count};this.fetchNextGroupData(a,s,t,i)},headerColumnDblClick(t,e){const s=e._column.definition;if(!this.groupedColumns.some((t=>t.field===s.field))){this.date_fields.includes(s.field)&&!s["value"]&&(s["value"]="month"),this.groupedColumns.push(e._column.definition),this.setGroupsToCache();let t=this.table.getColumn("row_selection").getDefinition();t.titleFormatter="",this.table.updateColumnDefinition("row_selection",t),this.resetAndFetchAgain()}},setGroupsToCache(){this.groupedColumns&&this.groupedColumns.length>0?at.A.set(this.group_key,JSON.stringify(this.groupedColumns)):at.A.remove(this.group_key)},resetAndFetchAgain(){return Zt(this,void 0,void 0,(function*(){this.table.clearData(),this.paginationObj.startRow=0,yield this.fetchNextGroupData(this.groupedColumns[0],[],null,this.paginationObj)}))},refreshData(t){if(t.detail.data)this.resetAndFetchAgain();else{if(this.groupedColumns&&this.groupedColumns.length>0)return;this.fetchNextGroupData(this.groupedColumns[0],[],null,this.paginationObj)}},removeGroup(t){this.groupedColumns.splice(t,1),this.setGroupsToCache();let e=this.table.getColumn("row_selection").getDefinition();e.titleFormatter="rowSelection",this.table.updateColumnDefinition("row_selection",e),this.resetAndFetchAgain()},handleSortEnd(t){this.resetAndFetchAgain(),this.setGroupsToCache()},fetchNextGroupData(t={},e,s,a){return Zt(this,void 0,void 0,(function*(){try{if(this.loading=!0,this.getSavedFilters(),this.queryParams="?&skip="+a.startRow+"&limit="+a.pageSize,this.queryParams+=(yield this.makeQueryParamFromFilters(!1)),e.length>0&&(this.queryParams+="&raw_where="+JSON.stringify(e)),0!==(0,lt.Ns)(t)){const e=[],s={};s[t.field]=t.hasOwnProperty("value")?t.value:"",e.push(s),this.queryParams+="&group_by="+JSON.stringify(e)}const i=yield Z.z6.getListFromWarehouse(this.queryParams);this.updateTableData(i,t,s)}catch(i){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError("error",i)}finally{this.loading=!1}}))},updateTableData(t,e,s){if(0==t.documents.length)return;let a=[];for(let[i,o]of t.documents.entries()){if(o.count){let t=JSON.parse(JSON.stringify(o));delete t.id,delete t.count;for(const[e,s]of Object.entries(t))o.group_on=e,o.group_value=s;o.group=this.getGroupTranslations(o)+" ("+o.count+")",o._children=[]}o.doc_type&&(o.doc_type=this.$t(o.doc_type.toLowerCase())),this.applyCustomFormatOnRows(o),a.push(o)}s?a.forEach((t=>{s.addTreeChild(t)})):(this.table.updateOrAddData(a),this.paginationObj.totalRecords=t.overview["results-count"],this.$emit("updateDocumentStats",t))},getGroupingWhere(t){let e=this.getAllParents(t);e=e.reverse(),e.push(t);let s=[];for(let a=0;a<e.length;a++){const t={};if(this.date_fields.includes(e[a]._row.data.group_on)){const s=this.groupedColumns.find((t=>t.field===e[a]._row.data.group_on));s&&s.value?t["operator"]=s.value:t["operator"]="month"}t["field"]=e[a]._row.data.group_on,t["value"]=e[a]._row.data.group_value,s.push(t)}return s},getAllParents(t){const e=[];let s=t.getTreeParent();while(s)e.push(s),s=s.getTreeParent();return e},getGroupBy(t){return t==this.groupedColumns.length?null:this.groupedColumns[t]},getGroupTranslations(t){return"status"==t.group_on||"doc_type"==t.group_on?this.$t(t.group_value.toLowerCase()):t.group_value},downloadCsv(){this.table.download("csv","data.csv")},downloadXlsx(){this.table.download("xlsx","data.xlsx",{sheetName:"My Data"})},applyCustomFormatOnRows(t){if(t["fabAction"]=!1,t["rowSelection"]=!1,t["created_on"]=t["created_on"]?this.formateDate(t["created_on"],"YYYY-MM-DD HH:mm:ss"):"-",t["last_modified_on"]=t["last_modified_on"]?this.formateDate(t["last_modified_on"],"YYYY-MM-DD HH:mm:ss"):"-",t.hasOwnProperty("po_match_status")&&!(0,lt.z)(t["po_match_status"])){const e=(0,Ot.Wp)(t["po_match_status"]);(0,lt.z)(e)||(t["po_match_icon"]=e)}},formateDate(t,e){return st.Ay.formatDate(t,e)},resetTableData(t){this.table.clearData()},updateTableColumns(t){this.table.setColumns(t.detail.data)},deleteMultipleRows(t){this.table.deleteRow(t.detail.data)}},setup(){const t=(0,tt.fX)(),{processing:e,table:s}=(0,P.bP)(t),{getSavedFilters:a,makeQueryParamFromFilters:i}=t;return{makeQueryParamFromFilters:i,getSavedFilters:a,processing:e,table:s,queryParams:(0,Q.KR)(""),table_columns:(0,Q.KR)([])}}});var ee=s(23954),se=s(48975),ae=s(53999),ie=s(90124),oe=s(25173),re=s(13796),le=s(50492),ne=s(97410),de=s(10386);const ue=(0,bt.A)(te,[["render",Yt],["__scopeId","data-v-7068cf29"]]),ce=ue;Rt()(te,"components",{QBadge:ee.A,QPopupProxy:se.A,QList:ae.A,QItem:ie.A,QItemSection:oe.A,QItemLabel:re.A,QIcon:le.A,QTooltip:ne.A,QSeparator:de.A,QLinearProgress:Wt.A}),Rt()(te,"directives",{ClosePopup:Ft.A});var he=s(90954),pe=s(73937),_e=function(t,e,s,a){function i(t){return t instanceof s?t:new s((function(e){e(t)}))}return new(s||(s=Promise))((function(s,o){function r(t){try{n(a.next(t))}catch(e){o(e)}}function l(t){try{n(a["throw"](t))}catch(e){o(e)}}function n(t){t.done?s(t.value):i(t.value).then(r,l)}n((a=a.apply(t,e||[])).next())}))};const me=(0,a.pM)({el:"#app",mixins:[V.A,$.A,z.A,j.A,X.A,H.A,I.A,K.A],components:{DashboardLinearView:Bt,GroupingDashboardTabulator:ce,WorkflowLogs:Mt,DashboardHeader:Y.A,DocAssignment:J.A,MobileGrid:U.A,SubHeader:et.A,Loader:B.A,SupplierApprovalStatus:he.A},data(){return{clearOldData:(0,Q.KR)(!1),isGroupingTable:(0,Q.KR)(!1),rowMenu:[],headerMenu:[],all_invoice_data:[],InvoicesClearInterval:0,po_module_activate:!1,debounceSearchInputFunc:{},confirmMergeDialog:!1,filters_reset_after_restart_setting:rt.at}},beforeRouteLeave:function(t,e,s){this.intervalManager(!1),this.unsubscribeToChannel("dashboard"),this.unsubscribeToChannel("pending_docs"),s()},mounted(){return _e(this,void 0,void 0,(function*(){try{this.processing=!0,this.paginationCount=1,this.pageSize=Number(this.pagination_size),yield this.startSettingsFetch(),yield this.getSavedColumns(),this.handleTableColumns(!1),this.prepareStatusList(),yield this.getOrderBy(),this.po_module_activate=!0,this.isGroupingTable=this.user_settings[rt.eO],this.getSavedFilters(),this.reformatTableColumns(),yield this.loadData(),this.clearSelectedSessionStorage(),this.intervalManager(!0),this.subscribeToDashboardChannel(),this.getUserDetailByKey(),this.$route.params.force_restart&&"force_restart"===this.$route.params.force_restart&&(this.restartExportedInvoices=!0),this.headerCheckbox=!1,document.addEventListener("apply_filters",this.applyFilterEvent),document.addEventListener("reset_filters",this.resetFilters),document.addEventListener("reset_pages",this.resetPages),document.addEventListener("dashboard_refresh_data",this.refreshDashboardData),document.addEventListener("on_row_click",this.rowClickEvent),document.addEventListener("reload_columns",this.reformatTableColumns),document.addEventListener("load_data_on_upload",this.resetPaginationAndLoadData),document.addEventListener("dashboard_columns_updated",this.dashboardColumnsEvent),document.addEventListener("assignment_success",this.assignmentSuccess),this.debounceSearchInputFunc=(0,ot.A)((()=>{this.applyFilter()}),1e3)}catch(t){logError(t)}finally{this.processing=!1}}))},unmounted:function(){document.removeEventListener("keydown",this.keyDownEvent),document.removeEventListener("assignment_success",this.assignmentSuccess),document.removeEventListener("apply_filters",this.applyFilterEvent),document.removeEventListener("reset_filters",this.resetFilters),document.removeEventListener("dashboard_refresh_data",this.refreshDashboardData),document.removeEventListener("load_data_on_upload",this.resetPaginationAndLoadData),document.removeEventListener("dashboard_columns_updated",this.dashboardColumnsEvent),document.removeEventListener("reload_columns",this.reformatTableColumns)},watch:{headerCheckbox(){!1===this.headerCheckbox&&(this.headerFabIcon=!1,this.isMultiDeleteButtonDisabled=!1,this.isMultiRestartButtonDisabled=!1)},isConnected:{handler:function(t,e){this.use_websocket=!0,this.subscribeToDashboardChannel()}},websocketHasError:{handler:function(t,e){1==t&&(this.use_websocket=!1,this.handleWebsocketDelay())}},dashboard_data_flag:{handler:function(t,e){0!=t&&(this.data_status="received",this.handleWebSocketResult(this.dashboard_data))}}},methods:{getWebSocketDashboard(){return _e(this,void 0,void 0,(function*(){try{const t={type:"dashboard",data:{}};let e=this.queryParams;e=e.replace("?","");const s=e.split("&");s.forEach((e=>{e=e.split("="),2===e.length&&(t.data[e[0]]=e[1])})),this.data_status="fetching",this.dashboard_data_flag=!1,this.processing=!0;const a=yield this.sendMessageToSocket(t.type,t.data);return this.updateDocumentStats(a),this.updateTableData(a),!0}catch(t){this.handleWebsocketDelay}}))},handleWebsocketDelay(){"received"!==this.data_status&&(logInfo("turning off websocket and switching to https",this.data_status),this.use_websocket=!1,this.fetchInvoices(!1),setTimeout(this.turnOnWebSocket,5e3))},loadDashboardMenus(){this.rowMenu=[{label:'<span class="material-icons" style="">edit</span><span style="margin-left: 4px;"> '+this.$t("validate")+"</span>",action:(t,e)=>{this.rowClick(e.getData())},disabled:function(t){var e=t.getData();return"finished"==e["status"]||"workflow"==e["status"]||"running"==e["status"]||"restart_in_progress"==e["status"]||"error"==e["status"]||"pending_confirmation"==e["status"]}},{label:'<span class="material-icons" style="">account_circle</span><span style="margin-left: 4px;"> '+this.$t("assign2")+"</span>",action:(t,e)=>{this.openAssignmentDlg(e.getData().id)}},{label:'<span class="material-icons" style="">schema</span><span style="margin-left: 4px;"> '+this.$t("flow_screen")+"</span>",action:(t,e)=>{this.toFlowScreen(e.getData().id)}},{label:'<span class="material-icons" style="">account_tree</span><span style="margin-left: 4px;"> '+this.$t("workflow_logs")+"</span>",action:(t,e)=>{this.openWorkflowDlg(e.getData().id)}},{separator:!0},{label:'<span class="material-icons" style="">download</span><span style="margin-left: 4px;"> '+this.$t("download")+"</span>",menu:[{label:'<span class="material-icons" style="">download</span><span style="margin-left: 4px;"> '+this.$t("download")+"</span>",action:(t,e)=>{this.downloadFile(e.getData())},disabled:t=>{var e=t.getData();return!this.isDocDownloadable(e)}},{label:'<span class="material-icons" style="">download</span><span style="margin-left: 4px;"> '+this.$t("download_annotated")+"</span>",action:(t,e)=>{this.downloadAnnotated(e.getData())},disabled:t=>{var e=t.getData();return!this.isdownloadAnnotated(e)}},{label:'<span class="material-icons" style="">download</span><span style="margin-left: 4px;"> '+this.$t("download_zugferd")+"</span>",action:(t,e)=>{this.downloadZugferd(e.getData())},disabled:t=>{var e=t.getData();return!this.isdownloadZugferd(e)}},{label:'<span class="material-icons" style="">download</span><span style="margin-left: 4px;"> '+this.$t("download_peppol")+"</span>",action:(t,e)=>{this.downloadPeppol(e.getData())},disabled:t=>{var e=t.getData();return!this.isdownloadPeppol(e)}},{label:'<span class="material-icons" style="">download</span><span style="margin-left: 4px;"> '+this.$t("download_preview_files")+"</span>",action:(t,e)=>{this.downloadPreviewFile(e.getData())},disabled:t=>{var e=t.getData();return!this.hasPreviewFile(e)}}]},{label:'<span class="material-icons" style="">restart_alt</span><span style="margin-left: 4px;"> '+this.$t("restart")+"</span>",menu:[{label:'<span class="material-icons" style="">restart_alt</span><span style="margin-left: 4px;"> '+this.$t("restart")+"</span>",action:(t,e)=>{this.restartExport(e.getData().id)},disabled:t=>{var e=t.getData();return!this.isDocRestartable(e)}},{label:'<span class="material-icons" style="">restart_alt</span><span style="margin-left: 4px;"> '+this.$t("restart_export")+"</span>",action:(t,e)=>{this.restartExportError(e.getData().id)},disabled:t=>{var e=t.getData();return!this.isExportErrorRestart(e)}}]},{label:'<span class="material-icons" style="">file_upload</span><span style="margin-left: 4px;"> '+this.$t("go_to_export")+"</span>",action:(t,e)=>{this.goToExport(e.getData().document_export_log)},disabled:t=>{var e=t.getData();return!this.isExportAllowed(e.document_export_log)}},{separator:!0},{label:'<span class="material-icons text-red-14" style="">delete</span><span style="margin-left: 4px;" class="text-red-14"> '+this.$t("delete")+"</span>",action:(t,e)=>{this.recordId=e.getData().id,this.deleteInvoice=!0},disabled:t=>{var e=t.getData();return!this.isDocDeleteable(e)}}],this.prepareHeaderMenu()},prepareHeaderMenu(){this.headerMenu=[{label:'<span class="material-icons" style="">account_circle</span><span style="margin-left: 4px;"> '+this.$t("assign2")+"</span>",action:()=>{this.multipleDocAssignment()},disabled:()=>0===this.selectionList.length},{label:'<span class="material-icons" style="">restart_alt</span><span style="margin-left: 4px;"> '+this.$t("restart")+"</span>",action:()=>{this.restartMultipalDocExport()},disabled:()=>0===this.selectionList.length},{label:'<span class="material-icons" style="">merge</span><span style="margin-left: 4px;"> '+this.$t("merge")+"</span>",action:()=>{this.confirmMerge()},disabled:()=>0===this.selectionList.length},{separator:!0},{label:'<span class="material-icons text-red-14" style="">delete</span><span style="margin-left: 4px;" class="text-red-14"> '+this.$t("delete")+"</span>",action:()=>{this.deleteMultipalDocument()},disabled:()=>0===this.selectionList.length}]},contextColumnFormatter(){var t=(t,e)=>{var s=t.getRow().getData(),a=document.createElement("button");a.type="button",a.innerHTML='<span class="material-icons icon-grey" style="width: 14px; display: inline-flex !important;" >more_horiz</span>',a.classList.add("btn-menu"),a.addEventListener("click",(e=>{const s=new MouseEvent("contextmenu",{bubbles:!0,clientX:e.pageX,clientY:e.pageY+20});t.getRow().getElement().dispatchEvent(s)}));var i=document.createElement("span");if(s.po_match_icon){var o=document.createElement("button");o.type="button",o.innerHTML='<img src="images/'+s.po_match_icon+'.svg" width="16" />',o.classList.add("btn-po"),o.addEventListener("click",(()=>{this.viewPurchaseOrder(t.getRow().getData())})),i.appendChild(o)}return i.appendChild(a),i};return t},addCustomColumn(){this.tabulator_table_columns.push({title:this.$t("actions"),field:"po_icon",formatter:this.contextColumnFormatter(),headerSort:!1,frozen:!0,width:90});var t=(t,e)=>{var s=t.getRow().getData();return s.locked_by?'<span class="material-icons" style="top: 13px; position: absolute; right: 5px;">lock</span>':""};const e=(0,G.un)(rt.aH.group_key),s=at.A.getItem(e);this.tabulator_table_columns.unshift({formatter:t,headerMenu:this.headerMenu,headerMenuIcon:'<span class="material-icons" style="top: -13px; position: absolute; right: 4px;">more_vert</span>',width:40,hozAlign:"center",headerSort:!1}),this.tabulator_table_columns.unshift({formatter:"rowSelection",titleFormatter:s?"":"rowSelection",field:"row_selection",titleFormatterParams:{rowRange:"active"},headerSort:!1,width:15}),this.isGroupingTable&&this.tabulator_table_columns.unshift({title:this.$t("groups"),field:"group",headerSort:!1,visible:!0})},reformatTableColumns(){this.tabulator_table_columns=[],this.table_columns.forEach((t=>{const e={title:t.label,field:t.name,maxWidth:350,headerSort:t.sortable,headerClick:(t,e)=>{const s=e.getDefinition();this.sortHeaders({detail:{column:s}})},formatter:(t,e,s)=>{var a=String(t.getValue());return"null"!=a&&void 0!=a?'<span class="text-capitalize"> '+this.$t(a.toLowerCase())+" </span>":"-"}};e.formatter=(e,s)=>{var a=e.getValue();if(!a)return"";if("status"===t.name)return this.statusList.hasOwnProperty(a)?'<span class="'+this.statusList[a].class+'">'+this.$t(a)+"</span>":this.$t(a);if("filename"===t.name){a=e.getValue();return'<span class="text-primary">'+a+"</span>"}return t.name.includes("amount")?'<span class="text-right" style="display: block;">'+a+"</span>":a},this.tabulator_table_columns.push(e)})),this.loadDashboardMenus(),this.addCustomColumn();const t=new CustomEvent("update_columns",{detail:{data:this.tabulator_table_columns}});document.dispatchEvent(t)},sortHeaders(t){const e=this.tableInstance.getSorters(),s={direction:e[0].dir,name:t.detail.column.field};this.OrderBy(s)},OrderBy(t){return _e(this,void 0,void 0,(function*(){let e=t.direction,s=t.name;e&&s?(this.order_by={field_name:s,direction:e},yield this.saveOrderBy(),this.applyFilterEvent({})):logError("ERROR: Orderby for field",s)}))},applyFilterEvent(t){t&&t.detail&&!0===t.detail.reset_pagination&&(this.resetPagination=!0),this.clearOldData=!0,this.applyFilter()},turnOnWebSocket(){this.websocketHasError||(this.use_websocket=!0)},dashboardColumnsEvent(){this.dashboardColumnsUpdated()},dashboardColumnsUpdated(){return _e(this,void 0,void 0,(function*(){this.handleTableColumns(),yield this.applySavedFilters(),this.fetchInvoices(!0)}))},applySavedFilters(){return _e(this,void 0,void 0,(function*(){this.queryParams="?&skip="+this.startfrom+"&limit="+this.pageSize,this.queryParams+=(yield this.makeQueryParamFromFilters(!1)),this.resetPagination=!1}))},handleTableColumns(t=!0){try{this.processing=!0;const t=this.visible_columns;this.table_columns=[];for(const e in this.visible_columns)t[e].selected=!1,this.filtered_columns.includes(t[e].name)||(t[e].label=this.getColumnLabel(t[e]),this.table_columns.push(t[e]));this.table_columns.sort(((t,e)=>t.order-e.order))}catch(e){logError(e)}finally{t&&(this.processing=!1)}},intervalManager(t){clearInterval(this.InvoicesClearInterval),!0===t&&(this.InvoicesClearInterval=setInterval((()=>{this.is_any_checked||this.fetchInvoices(!1)}),6e4))},handleActions(t){return this.display_data.forEach(((e,s)=>{s!==t&&(e["fabAction"]=!1)})),!0},prepareStatusList(){this.statusList["new"]=[],this.statusList["new"]["value"]="new",this.statusList["new"]["class"]="text-light-green-6",this.statusList["ready_for_review"]=[],this.statusList["ready_for_review"]["value"]="ready_for_review",this.statusList["ready_for_review"]["class"]="text-amber-7",this.statusList["ready_for_validation"]=[],this.statusList["ready_for_validation"]["value"]="ready_for_validation",this.statusList["ready_for_validation"]["class"]="text-amber-7",this.statusList["validating"]=[],this.statusList["validating"]["value"]="ready_for_validation",this.statusList["validating"]["class"]="text-amber-7",this.statusList["validated_pending_export"]=[],this.statusList["validated_pending_export"]["value"]="validated_pending_export",this.statusList["validated_pending_export"]["class"]="text-amber-7",this.statusList["pending_confirmation"]=[],this.statusList["pending_confirmation"]["value"]="pending_confirmation",this.statusList["pending_confirmation"]["class"]="text-amber-7",this.statusList["finished"]=[],this.statusList["finished"]["value"]="finished",this.statusList["finished"]["class"]="text-light-green-6",this.statusList["workflow"]=[],this.statusList["workflow"]["value"]="workflow",this.statusList["workflow"]["class"]="text-light-green-6",this.statusList["completed"]=[],this.statusList["completed"]["value"]="completed",this.statusList["completed"]["class"]="text-light-green-6",this.statusList["restarted"]=[],this.statusList["restarted"]["value"]="restarted",this.statusList["restarted"]["class"]="text-blue-14",this.statusList["error"]=[],this.statusList["error"]["value"]="error",this.statusList["error"]["class"]="text-red-13",this.statusList["export_error"]=[],this.statusList["export_error"]["value"]="error",this.statusList["export_error"]["class"]="text-red-13",this.statusList["restart_export"]=[],this.statusList["restart_export"]["value"]="restart_export",this.statusList["restart_export"]["class"]="text-blue-14",this.statusList["running"]=[],this.statusList["running"]["value"]="running",this.statusList["running"]["class"]="text-blue-14",this.statusList["in_progress"]=[],this.statusList["in_progress"]["value"]="in_progress",this.statusList["in_progress"]["class"]="text-blue-14",this.statusList["restart_in_progress"]=[],this.statusList["restart_in_progress"]["value"]="restart_in_progress",this.statusList["restart_in_progress"]["class"]="text-blue-14",this.statusList["exporting"]=[],this.statusList["exporting"]["value"]="exporting",this.statusList["exporting"]["class"]="text-blue-14"},resetPages(){this.resetPagination=!0},applyFilter(){return _e(this,void 0,void 0,(function*(){this.processing=!0,this.resetAllSelectedRows(),this.resetPagination&&(this.startfrom=0,this.paginationCount=1),this.resetPagination=!1,this.queryParams="?&skip="+this.startfrom+"&limit="+this.pageSize,this.queryParams+=(yield this.makeQueryParamFromFilters()),""==this.queryParams&&this.removeSavedFilters(),yield this.fetchInvoices(!0)}))},refreshDashboardData(t){this.refreshFilters(t)},refreshFilters(t){return _e(this,void 0,void 0,(function*(){let e=!1,s=!1;t&&t.detail&&t.detail.show_shimmer_loader&&(e=!0),t&&t.detail&&t.detail.refresh_cache&&(s=!0),this.pageSize=this.startfrom+this.pagination_size,this.startfrom=0,this.all_invoice_data=[],this.display_data=[],this.selectionList=[],this.headerCheckbox=!1,this.clearOldData=!0,yield this.fetchInvoices(!0,e,s),this.pageSize=Number(this.pagination_size)}))},fetchInvoices(t,e=!1,s=!1){return _e(this,void 0,void 0,(function*(){this.isGroupingTable&&setTimeout((()=>{this.processing=!1;const e=new CustomEvent("fetch_data",{detail:{data:t}});document.dispatchEvent(e)}),1e3),yield this.fetchInvoicesForLinearDashboard(t,e,s)}))},fetchInvoicesForLinearDashboard(t,e=!1,s=!1){return _e(this,void 0,void 0,(function*(){try{if(t&&(this.processing=!0),e&&(this.show_table_loader=!0),yield this.applySavedFilters(),this.use_websocket){let t=yield this.getWebSocketDashboard();return void(1!=t&&setTimeout(this.handleWebsocketDelay,5e3))}{const t=yield Z.z6.getList(this.queryParams);this.updateDocumentStats(t),this.updateTableData(t),this.processing=!1,setTimeout(this.turnOnWebSocket,5e3)}}catch(s){this.showErrorToast(this.$t("pages.messages.ERROR_FETCHING_INVOICES")),logError(s.message),this.processing=!1}}))},updateTableData(t){this.resultsCount=t.overview["results-count"],this.current_invoice_count=this.resultsCount;let e=this.resultsCount/this.pageSize;this.skip=Math.ceil(e);let s=[];if(t.documents&&(s=t.documents),this.applyCustomFormatOnRows(s),this.display_data=s,this.show_table_loader=!1,this.processing=!1,!s||0==s.length)return;const a=new CustomEvent("table_data_updated",{detail:{data:s,clearOldData:this.clearOldData}});document.dispatchEvent(a),this.clearOldData=!1},updateDocumentStats(t){this.all_invoices=t.overview["all-invoices"],this.automatically_processed=t.overview["automatically-processed"],this.manually_processed=t.overview["manually-processed"],this.completed=t.overview["completed"],this.in_progress=t.overview["processing"],this.pending=t.overview["pending-user-input"],this.validated_pending_approval=t.overview["validated-pending-approval"],this.approved_pending_second_approval=t.overview["approved-pending-second-approval"],this.error=t.overview["error"]},applyCustomFormatOnRows(t){t.forEach((t=>{if(t["fabAction"]=!1,t["rowSelection"]=!1,t["created_on"]=t["created_on"]?this.formateDate(t["created_on"],"YYYY-MM-DD HH:mm:ss"):"-",t["last_modified_on"]=t["last_modified_on"]?this.formateDate(t["last_modified_on"],"YYYY-MM-DD HH:mm:ss"):"-",t.hasOwnProperty("po_match_status")&&!(0,lt.z)(t["po_match_status"])){const e=(0,Ot.Wp)(t["po_match_status"]);(0,lt.z)(e)||(t["po_match_icon"]=e)}}))},toRejectedScreen(t){this.$router.push("/rejected/"+t)},toFlowScreen(t){this.$router.push("/doc_flow/"+t)},toValidationScreen(t){it.A.set("view_mod","edit"),this.$router.push("/field_validation_v1/"+t)},toInReviewScreen(t,e){this.$router.push("/in_review/"+t)},toPendingApprovalScreen(t,e){e.layout?this.$router.push("/ready-for-approval-v2/"+t):(it.A.set("view_mod","edit"),this.$router.push("/ready-for-approval/"+t))},toPendingSecondApprovalScreen(t,e){e.layout?this.$router.push("/ready-for-second-approval-v2/"+t):(it.A.set("view_mod","edit"),this.$router.push("/ready-for-second-approval/"+t))},toMediValidationScreen(t){this.$router.push("/field_validation/"+t)},toMediValidationV3Screen(t){this.$router.push("/medi_order_v3/"+t)},toDocumentErrorView(t){this.$router.push("/document_error/"+t["id"])},toDocumentClassifiyView(t){this.$router.push("/document_classifiy/"+t["id"])},toDocumentPdfView(t){this.$router.push("/document_pdf/"+t["filename"]+"/"+t["id"])},formateDate(t,e){return st.Ay.formatDate(t,e)},openWorkflowDlg(t){this.workflow_doc_id="",logInfo("workflow_doc_id",this.workflow_doc_id),this.workflow_doc_id=t,logInfo("workflow_doc_id",this.workflow_doc_id),this.WorkflowLogs=!0},loadData(){return _e(this,void 0,void 0,(function*(){this.resetPagination=!1,this.startfrom=this.pageSize*(this.paginationCount-1),yield this.applyFilter()}))},triggerWorkflow(t){return _e(this,void 0,void 0,(function*(){try{yield Z.Bj.triggerWorkflow(t)}catch(e){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(e)}}))},deleteRecord(t){return _e(this,void 0,void 0,(function*(){let e;this.processing=!0;try{let s=yield(0,W.L3)();e=yield M.A.delete((0,Vt.MV)(W.FH.delete_document+t),{headers:{Authorization:s}}),yield this.fetchInvoices(!0),this.deleteInvoice=!1}catch(s){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(s)}finally{this.processing=!1}}))},viewRecord(t){it.A.set("view_mod","view"),this.$router.push("/field_validation_v1/"+t)},restartExportError(t){return _e(this,void 0,void 0,(function*(){this.processing=!0;try{const e=yield Z.z6.restartExport(t);if(!1===e.success)throw{message:e.message};this.resetFilters()}catch(e){const t=N.t.getErrorMessage(e);this.showErrorToast(t),logError(e)}finally{this.processing=!1}}))},restartExport(t){return _e(this,void 0,void 0,(function*(){let e;this.processing=!0;try{let s=yield(0,W.L3)();e=yield M.A.get((0,Vt.MV)(W.FH.restart_document+t),{headers:{Authorization:s}}),this.refreshDashboard(this.filters_reset_after_restart_setting)}catch(s){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(s)}finally{this.processing=!1}this.QualityConfirm=!1}))},isStatusError(t){return"error"===t||"export_error"===t},rowClickEvent(t){const e=t.detail;this.rowClick(e)},rowClick(t){let e=t["id"]?t["id"]:t["doc_id"];t["id"]=e;let s=t["status"];t["doc_type"];this.isStatusError(s)?this.toDocumentErrorView(t):"classified"!==s?"validating"!==s&&"validated_pending_export"!==s&&("pending_confirmation"!==s?"validated_pending_approval"!==s?"approved_pending_second_approval"!==s?"in_review"!==s?this.isMediUser()?this.handleMediRoutes(t):"rejected"!==s?rt.Yd.includes(s)&&(t.layout||"ready_for_validation"===s?this.toValidationScreen(e):rt.B2.includes(s)&&this.viewRecord(e)):this.toRejectedScreen(e):this.toInReviewScreen(e,t):this.toPendingSecondApprovalScreen(e,t):this.toPendingApprovalScreen(e,t):this.getQualityInfos(t)):this.toDocumentClassifiyView(t)},handleMediRoutes(t){t.layout&&this.toMediValidationV3Screen(t["id"])},getClassesForColumn(t,e){let s="",a="running"===t?"enableDrawingRectangle":"cursor-pointer";return a+="filename"===e?" text-primary ":"","status"===e&&this.statusList.hasOwnProperty(t)&&(s=t?this.statusList[t].class:""),a+" "+s},openAssignmentDlg(t){this.assignment_doc_ids=[],this.assignment_doc_ids.push(t),this.assigneDialog=!0},isExportAllowed(t){let e=this.getExportRecord(t);return!(!e||0===Object.keys(e).length)},goToExport(t){let e=this.getExportRecord(t);e&&0!==Object.keys(e).length&&window.open(e.document_url)},getExportIcon(t){let e=this.getExportRecord(t);if(!e||0===Object.keys(e).length)return;let s="";return"FLOW2"==e.export_application&&(s="images/flow2_icon.svg"),"IDM"==e.export_application&&(s="images/idm_icon.svg"),"ZUGFERD"==e.export_application&&(s="images/zugferd-icon.svg"),"PEPPOL"==e.export_application&&(s="images/peppol-icon.svg"),s},getExportRecord(t){if(!t)return{};let e=at.A.getItem("login_source");if(!at.A.has("login_source")||null===e)return{};e=e.toLowerCase(),"infor"==e&&(e="idm");let s={};for(const a of t)if(e===a.export_application.toLowerCase()&&a.document_url){s=a;break}return s},viewPurchaseOrder(t){"po_not_matched"==t["po_match_icon"]&&null===t["table_version"]||(this.user_settings[rt.aH.po_auto_match_and_export]&&(this.execute_auto_export=!0),"v1"===t["table_version"]&&this.$router.push("/po-matching/"+t["id"]),"v3"===t["table_version"]&&this.$router.push("/po-matching-v3/"+t["id"]))},downloadFile(t){try{if(!t["doc_path"])return;let e=W.VA+"/resource/"+t["doc_path"]+"?"+this.tokenQueryParam;if(!e)return;fetch(e).then((t=>t.blob())).then((e=>{const s=URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download=t["filename"],document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)})).catch((t=>{logError("Error downloading file:",t)}))}catch(e){logError(e)}},resetFilters(){this.resetPagination=!0,this.quickFilterMap.clear(),this.clearOldData=!0,this.applyFilter()},resetPaginationAndLoadData(){this.resetPagination=!0,this.clearOldData=!0,this.applyFilter()},isdownloadZugferd(t){let e=!1;return this.isDocDownloadable(t)?(rt.B2.includes(t["status"])&&1==(0,rt.UJ)(t["doc_type"])&&1==t["has_zugferd"]&&(e=!0),e):e},downloadZugferd(t){let e=W.VA+"/resource/document/"+t["id"]+"/"+t["id"]+"_zugferd.pdf?"+this.tokenQueryParam;if(e){var s=document.createElement("a");s.download=t["filename"],s.href=e,document.body.appendChild(s),s.click(),document.body.removeChild(s)}},isdownloadPeppol(t){let e=!1;return this.isDocDownloadable(t)?(rt.B2.includes(t["status"])&&1==(0,rt.UJ)(t["doc_type"])&&1==t["has_peppol"]&&(e=!0),e):e},downloadPeppol(t){let e=W.VA+"/resource/document/"+t["id"]+"/"+t["id"]+"_peppol.xml?"+this.tokenQueryParam;if(e){var s=document.createElement("a");s.download=t["filename"],s.href=e,document.body.appendChild(s),s.click(),document.body.removeChild(s)}},isdownloadAnnotated(t){let e=!1;return this.isDocDownloadable(t)?(1==t["has_annotated_version"]&&(e=!0),e):e},downloadAnnotated(t){let e=W.VA+"/resource/document/"+t["id"]+"/"+t["id"]+"_annotated.pdf?"+this.tokenQueryParam;if(e){var s=document.createElement("a");s.download=t["filename"],s.href=e,document.body.appendChild(s),s.click(),document.body.removeChild(s)}},getErrorInfos(t){return _e(this,void 0,void 0,(function*(){if("error"!==t["status"])return;let e=yield(0,W.L3)();const s=yield M.A.get((0,Vt.MV)(W.FH.get_error_infos),{headers:{Authorization:e},params:{doc_id:t["id"]}});return s["data"]["row"]=t,1===Object.keys(s).length?(this.ErrorText={message:"None"},logInfo(this.ErrorText),!1):(this.ErrorText=s["data"],this.ErrorInfos=!0,!0)}))},getQualityInfos(t){return _e(this,void 0,void 0,(function*(){if("pending_confirmation"==t["status"]){let e=yield(0,W.L3)();const s=yield M.A.get((0,Vt.MV)(W.FH.get_error_infos),{headers:{Authorization:e},params:{doc_id:t["id"]}});return s["data"]["row"]=t,1===Object.keys(s).length?(this.QualityText={message:"None"},!1):(this.QualityText=s["data"],this.QualityConfirm=!0,this.docrowID=s["data"]["row"]["id"],!0)}}))},allowDrop(t){t.preventDefault(),t.currentTarget.classList.add("opacity-half")},drop(t){t.preventDefault(),t.currentTarget.classList.remove("opacity-half"),this.uploadFiles(t.dataTransfer.files)},dragLeave(t){t.currentTarget.classList.remove("opacity-half")},uploadFiles(t){try{if(t&&t.length>10)return void this.showErrorToast(this.$t("pages.messages.MAX_DOC_UPLOAD_LIMIT"));const e=new CustomEvent("upload_files",{detail:{files:t}});document.dispatchEvent(e)}catch(e){logError(e)}},changeAction(){!0===this.headerCheckbox?this.selectAllRows():this.resetAllSelectedRows()},selectAllRows(){this.selectionList=[],this.isMultiDeleteButtonDisabled=!1,this.isMultiRestartButtonDisabled=!1,this.display_data.forEach((t=>{t["rowSelection"]=!0,this.selectionList.push(t.id),!1===this.isMultiDeleteButtonDisabled&&(this.isMultiDeleteButtonDisabled=!this.isDocDeleteable(t)),!1===this.isMultiRestartButtonDisabled&&(this.isMultiRestartButtonDisabled=!this.isDocRestartable(t))}))},resetAllSelectedRows(){this.selectionList=[],this.headerCheckbox=!1,this.isMultiDeleteButtonDisabled=!1,this.isMultiRestartButtonDisabled=!1,this.display_data.forEach((t=>{t["rowSelection"]=!1}))},setSelectionList(t){this.selectionList=t},checkRowExistance(){let t=0;this.selectionList=[],this.headerCheckbox=!1,this.is_any_checked=!1,this.isMultiDeleteButtonDisabled=!1,this.isMultiRestartButtonDisabled=!1,this.display_data.forEach((e=>{!0===e["rowSelection"]&&(this.is_any_checked=!0,t++,this.selectionList.push(e.id),!1===this.isMultiDeleteButtonDisabled&&(this.isMultiDeleteButtonDisabled=!this.isDocDeleteable(e)),!1===this.isMultiRestartButtonDisabled&&(this.isMultiRestartButtonDisabled=!this.isDocRestartable(e)))})),0===t?(this.headerCheckbox=!1,this.isMultiDeleteButtonDisabled=!1,this.isMultiRestartButtonDisabled=!1):this.display_data.length===t?this.headerCheckbox=!0:this.headerCheckbox=!1},setRowStyle(t){if(t.hasOwnProperty("export_data_fetched")&&!0===t["export_data_fetched"])return"exported-row"},restartMultipalDocExport(){return _e(this,void 0,void 0,(function*(){try{this.processing=!0;const t=yield Z.z6.restartDocuments(this.selectionList.join(","),this.restartExportedInvoices);if(!1===t.success)return void this.showErrorToast(t.data.message);this.headerCheckbox=!1,this.resetAllSelectedRows(),this.refreshDashboard(this.filters_reset_after_restart_setting)}catch(t){return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void logError(t)}finally{this.processing=!1}}))},refreshDashboard(t){return _e(this,void 0,void 0,(function*(){const e=yield this.getSettingWithExpiry(t);if(e){const t=new CustomEvent("reset_filters",{});return void document.dispatchEvent(t)}const s=new CustomEvent("dashboard_refresh_data",{});document.dispatchEvent(s)}))},multipleDocAssignment(){this.selectionList&&(this.assignment_doc_ids=this.selectionList,this.assigneDialog=!0)},confirmMerge(){this.selectionList&&this.selectionList.length>5?this.showErrorToast(this.$t("pages.messages.SELECTION_GREATER_THAN_FIVE")):this.selectionList&&(this.confirmMergeDialog=!0)},mergeDocuments(){return _e(this,void 0,void 0,(function*(){try{this.showLoading();const t=yield Z.M8.mergeDocumnet(this.selectionList.toString());if(!1===t.success)return void this.showErrorToast(t.message);yield this.fetchInvoices(!0)}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(t)}finally{const t=new CustomEvent("dashboard_refresh_data",{});document.dispatchEvent(t),this.hideLoading()}}))},deleteMultipalDocument(){return _e(this,void 0,void 0,(function*(){if(!this.selectionList)return;let t;this.processing=!0;try{let e=new Map;if(e.set("doc_ids",this.selectionList.join(",")),t=yield Z.v1.deleteRequest(W.FH.delete_documents,e),!1===t.success)return void this.showErrorToast(t.data.message);this.headerCheckbox=!1;const s=new CustomEvent("delete_rows",{detail:{data:this.selectionList}});document.dispatchEvent(s),this.loadData()}catch(e){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(e)}finally{this.processing=!1}}))},removeQuickFilter(t){this.quickFilterMap.delete(t),this.applyFilter()},isDocRestartable(t){const e=q.tH.hasAccess("update",t);if(!e)return!1;const s=String(t["status"]),a=Boolean(t["restart_allowed"]);return!!this.restartExportedInvoices||("ready_for_validation"===s||"error"===s||"export_error"===s||1==a)},isExportErrorRestart(t){const e=q.tH.hasAccess("update",t);if(!e)return!1;const s=String(t["status"]),a=Boolean(t["restart_allowed"]);return!!this.restartExportedInvoices||("export_error"===s||1==a)},isDocDeleteable(t){const e=q.tH.hasAccess("delete",t),s=String(t["status"]);return e&&"finished"!=s&&"workflow"!=s&&"running"!=s&&"restart_in_progress"!=s},isDocReassignAble(t){const e=q.tH.hasAccess("update",t),s=String(t["status"]);return e&&"finished"!=s&&"workflow"!=s&&"running"!=s&&"restart_in_progress"!=s},isDocDownloadable(t){const e=q.tH.hasAccess("view",t),s=String(t["status"]);return e&&"running"!=s&&"restart_in_progress"!=s},setDisplayDocType(t){const e=this.getDocTypeForDisplay(t),s=this.displayDocType(e);return String(s)},assignmentSuccess(t){this.assigneDialog=!1,this.selectionList&&(this.headerCheckbox=!1,this.resetAllSelectedRows()),this.refreshFilters({detail:{show_shimmer_loader:!0,refresh_cache:!0}})},renderquality(t){if(!this.user_settings["OCR_PERCENTAGE"]||!this.user_settings["OCR_PERCENTAGE"])return;let e="";if(t.hasOwnProperty("quality")){let s=this.$t("overall");const a=t["quality"];parseInt(t["quality"])<parseInt(this.user_settings["OCR_PERCENTAGE"])&&(e=s+' : <FONT COLOR="#AA0500">'+t["quality"]+"</FONT COLOR>"),parseInt(a)==parseInt(this.user_settings["OCR_PERCENTAGE"])&&(e=s+' : <FONT COLOR="#ffff00">'+t["quality"]+"</FONT COLOR>"),parseInt(a)>parseInt(this.user_settings["OCR_PERCENTAGE"])&&(e=s+' : <FONT COLOR="#00ff00">'+t["quality"]+"</FONT COLOR>")}return e},handleWebSocketResult(t){t&&(this.use_websocket=!0,this.updateDocumentStats(t),this.updateTableData(t))},isStatsUpdated(t){if(this.all_invoices!==t.overview["all-invoices"])return!0},subscribeToDashboardChannel(){this.$route.path},hasPreviewFile(t){return!(!t.hasOwnProperty("preview_file_path")||!t["preview_file_path"])},downloadPreviewFile(t){try{if(!t["preview_file_path"])return;let s=W.VA+"/"+t["preview_file_path"]+"?"+this.tokenQueryParam;if(!s)return;var e=document.createElement("a");e.download=t["filename"],e.href=s,document.body.appendChild(e),e.click(),document.body.removeChild(e)}catch(s){logError(s)}},loadDataOnScroll(){return _e(this,void 0,void 0,(function*(){this.paginationCount+=1,this.resetPagination=!1,this.startfrom=this.pageSize*(this.paginationCount-1),yield this.applyFilter()}))},getUserDetailByKey(){let t=(0,pe.Ky)("organisations"),e=t[0];e&&(this.supplierApprovalStatus=e.status,this.supplier_lookup_record_id=e.supplier_lookup_record_id?e.supplier_lookup_record_id:"supplier_lookup_record_id",this.supplier_as_org_id=e.supplier_as_org_id?e.supplier_as_org_id:"supplier_as_org_id")}},setup(){let t=[];const e=(0,tt.fX)(),{quickFilterMap:s,all_invoices:a,automatically_processed:i,manually_processed:o,completed:r,in_progress:l,pending:n,validated_pending_approval:d,approved_pending_second_approval:u,error:c,table:h,order_by:p,processing:_,visible_columns:m,filtered_columns:g,pagination_size:f,current_invoice_count:b,paginationCount:v}=(0,P.bP)(e),{getSavedFilters:w,removeSavedFilters:y,saveFilters:k,makeQueryParamFromFilters:D,setDefaultFilters:C,getSavedColumns:L,getOrderBy:E,saveOrderBy:x,getColumnLabel:S}=e,F=(0,tt.Bu)(),{user_settings:A,execute_auto_export:R}=(0,P.bP)(F),{getSettingWithExpiry:T,setOrgSettings:M,startSettingsFetch:I}=F,$=(0,tt.G6)(),{dashboard_data:q,isConnected:W,hasError:K,dashboard_data_flag:B}=(0,P.bP)($),{subscribeToChannel:V,unsubscribeToChannel:H,sendMessageByType:X}=$,z=(0,tt.kH)(),{isMediUser:N}=z,G=(0,tt._6)(),{tokenQueryParam:j}=(0,P.bP)(G);return G.getTokenQueryParam(),{execute_auto_export:R,startSettingsFetch:I,tokenQueryParam:j,current_invoice_count:b,dashboard_data_flag:B,pagination_size:f,paginationCount:v,websocketHasError:K,isConnected:W,dashboard_data:q,user_settings:A,visible_columns:m,filtered_columns:g,quickFilterMap:s,order_by:p,processing:_,getOrderBy:E,saveOrderBy:x,getColumnLabel:S,getSavedColumns:L,setDefaultFilters:C,getSettingWithExpiry:T,makeQueryParamFromFilters:D,isMediUser:N,sendMessageToSocket:X,unsubscribeToChannel:H,subscribeToChannel:V,saveFilters:k,removeSavedFilters:y,getSavedFilters:w,assignment_doc_ids:(0,Q.KR)([]),restartExportedInvoices:(0,Q.KR)(!1),model:(0,Q.KR)(null),table_columns:(0,Q.KR)([]),tabulator_table_columns:(0,Q.KR)([]),display_data:(0,Q.KR)([]),Popup:O.A,statusList:t,pageSize:(0,Q.KR)(10),skip:(0,Q.KR)(1),startfrom:(0,Q.KR)(0),resetPagination:!0,queryParams:"?filter=current-month&skip=0",deleteInvoice:(0,Q.KR)(!1),recordId:"",resultsCount:(0,Q.KR)(0),assigneDialog:(0,Q.KR)(!1),ErrorInfos:(0,Q.KR)(!1),ErrorText:(0,Q.KR)(),QualityConfirm:(0,Q.KR)(!1),QualityText:(0,Q.KR)(),docrowID:(0,Q.KR)(),headerCheckbox:(0,Q.KR)(!1),is_any_checked:(0,Q.KR)(!1),headerFabIcon:(0,Q.KR)(!1),selectionList:(0,Q.KR)([]),isMultiDeleteButtonDisabled:(0,Q.KR)(!1),isMultiRestartButtonDisabled:(0,Q.KR)(!1),showFlow:(0,Q.KR)(!1),flow_doc_id:(0,Q.KR)(""),use_websocket:(0,Q.KR)(!0),show_table_loader:(0,Q.KR)(!1),data_status:(0,Q.KR)(""),all_invoices:a,automatically_processed:i,manually_processed:o,completed:r,in_progress:l,pending:n,validated_pending_approval:d,approved_pending_second_approval:u,error:c,tableInstance:h,WorkflowLogs:(0,Q.KR)(!1),workflow_doc_id:(0,Q.KR)(""),supplierApprovalStatus:(0,Q.KR)(""),supplier_lookup_record_id:(0,Q.KR)(""),supplier_as_org_id:(0,Q.KR)("")}}});var ge=s(857),fe=s(54700),be=s(82156),ve=s(3952),we=s(62669);const ye=(0,bt.A)(me,[["render",T],["__scopeId","data-v-cd6a94f8"]]),ke=ye;Rt()(me,"components",{QMarkupTable:ge.A,QPagination:fe.A,QSeparator:de.A,QDialog:be.A,QCard:vt.A,QCardSection:Dt.A,QAvatar:ve.A,QCardActions:we.A,QBtn:kt.A}),Rt()(me,"directives",{ClosePopup:Ft.A})}}]);