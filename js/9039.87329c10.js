"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[9039],{19039:(e,t,l)=>{l.r(t),l.d(t,{default:()=>te});var i=l(61758),a=l(58790);const s=e=>((0,i.Qi)("data-v-663a5826"),e=e(),(0,i.jt)(),e),o={class:"row"},n={class:"col-3 q-pt-sm q-pl-lg"},r={class:""},d={class:""},u={class:""},c={class:"col-9 q-pt-sm q-pl-lg q-pr-lg",ref:"editorContainer",style:{height:"calc(100vh - 120px)"}},p={key:0,class:"editor-wrapper"},m={key:1},h={class:"text-weight-bold"},_={class:"row"},f={style:{width:"100%"}},g={key:0,class:"properties"},b=s((()=>(0,i.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1)));function v(e,t,l,s,v,k){const y=(0,i.g2)("SubHeader"),F=(0,i.g2)("f-btn"),E=(0,i.g2)("BackToSettings"),C=(0,i.g2)("q-input"),w=(0,i.g2)("q-select"),V=(0,i.g2)("q-item-section"),T=(0,i.g2)("q-item"),$=(0,i.g2)("q-list"),S=(0,i.g2)("q-btn-dropdown"),q=(0,i.g2)("q-editor"),A=(0,i.g2)("q-icon"),D=(0,i.g2)("q-tooltip"),K=(0,i.g2)("Editor"),Q=(0,i.g2)("q-form"),U=(0,i.g2)("q-toolbar-title"),L=(0,i.g2)("q-btn"),x=(0,i.g2)("q-toolbar"),I=(0,i.g2)("q-card-section"),R=(0,i.g2)("q-card-actions"),j=(0,i.g2)("q-card"),H=(0,i.g2)("q-dialog"),X=(0,i.g2)("q-inner-loading"),z=(0,i.gN)("close-popup");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.bF)(y,{name:"add_email_templates",label:e.$t("add_new_template")},null,8,["label"]),(0,i.bF)(E,{label:e.$t("email_templates"),back_to_rotue:"/settings/supplier/email_templates"},{default:(0,i.k6)((()=>[(0,i.bF)(F,{class:"float-right",label:e.$t("save"),onClick:e.submitForm},null,8,["label","onClick"]),(0,i.bF)(F,{class:"float-right q-mr-sm",label:e.$t("send_test"),onClick:e.sendTest},null,8,["label","onClick"])])),_:1},8,["label"]),(0,i.bF)(Q,{onSubmit:e.save,ref:"saveForm"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",o,[(0,i.Lk)("div",n,[(0,i.Lk)("div",r,[(0,i.bF)(C,{outlined:"",dense:"",label:e.$t("name"),modelValue:e.email.name,"onUpdate:modelValue":t[0]||(t[0]=t=>e.email.name=t),"lazy-rules":"",rules:[t=>t&&t.length>0||e.$t("please_input_name")]},null,8,["label","modelValue","rules"])]),(0,i.Lk)("div",d,[(0,i.bF)(C,{outlined:"",dense:"",label:e.$t("subject"),modelValue:e.email.subject,"onUpdate:modelValue":t[1]||(t[1]=t=>e.email.subject=t),"lazy-rules":"",rules:[t=>t&&t.length>0||e.$t("please_input_subject")]},null,8,["label","modelValue","rules"])]),(0,i.Lk)("div",u,[(0,i.bF)(w,{label:e.$t("select_email_template"),"map-options":"",dense:"",outlined:"",modelValue:e.email.supplier_type,"onUpdate:modelValue":[t[2]||(t[2]=t=>e.email.supplier_type=t),e.selectEmailChange],options:e.supplierEmailOptions,"emit-value":"","lazy-rules":"",rules:[t=>t&&t.length>0||e.$t("please_select_type")]},null,8,["label","modelValue","options","onUpdate:modelValue","rules"])])]),(0,i.Lk)("div",c,[e.view_source?((0,i.uX)(),(0,i.CE)("div",m,[(0,i.bF)(A,{name:"code",style:{"font-size":"18px"},class:"q-pb-sm cursor-pointer",onClick:e.backToEditor},null,8,["onClick"]),(0,i.bF)(A,{name:"edit_note",class:"format-icon cursor-pointer q-pb-sm",onClick:e.formatCode},{default:(0,i.k6)((()=>[(0,i.bF)(D,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(e.$t("format_button")),1)])),_:1})])),_:1},8,["onClick"]),(0,i.bF)(K,{editorValue:e.email.editor_value,formatCode:e.is_format_code,onUpdatedValue:e.updateValue,onFormatComplete:e.afterFormatted},null,8,["editorValue","formatCode","onUpdatedValue","onFormatComplete"])])):((0,i.uX)(),(0,i.CE)("div",p,[(0,i.bF)(q,{style:(0,a.Tr)(`min-height:28rem;height: ${e.editorHeight}px;max-height: ${e.editorHeight}px;`),modelValue:e.email.editor_value,"onUpdate:modelValue":t[3]||(t[3]=t=>e.email.editor_value=t),ref:"editorRef",definitions:{upload:{tip:"Upload to cloud",icon:"cloud_upload",label:"Upload",handler:e.openFileDialog},viewsource:{icon:"code",handler:e.openViewSource}},toolbar:[["left","center","right","justify"],["quote","unordered","ordered","outdent","indent"],["viewsource"],["bold","italic","strike","underline"],["undo","redo"],["upload"],["properties"]]},{properties:(0,i.k6)((()=>[(0,i.bF)(S,{dense:"","no-caps":"",ref:"tokenRef","no-wrap":"",unelevated:"",label:"Properties",size:"sm",icon:"list"},{default:(0,i.k6)((()=>[e.filteredDataKey.length?((0,i.uX)(),(0,i.Wv)($,{key:0,dense:""},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.filteredDataKey,(t=>((0,i.uX)(),(0,i.Wv)(T,{key:t.index,tag:"label",clickable:"",onClick:l=>e.insertKey(t.key)},{default:(0,i.k6)((()=>[(0,i.bF)(V,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(t.name),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):((0,i.uX)(),(0,i.Wv)($,{key:1},{default:(0,i.k6)((()=>[(0,i.bF)(T,null,{default:(0,i.k6)((()=>[(0,i.bF)(V,null,{default:(0,i.k6)((()=>[(0,i.eW)(" No properties available ")])),_:1})])),_:1})])),_:1}))])),_:1},512)])),_:1},8,["style","modelValue","definitions"]),(0,i.Lk)("input",{type:"file",ref:"fileInput",style:{display:"none"},onChange:t[4]||(t[4]=(...t)=>e.handleFileUpload&&e.handleFileUpload(...t))},null,544)]))],512)])])),_:1},8,["onSubmit"]),(0,i.bF)(H,{modelValue:e.send_test_dialog,"onUpdate:modelValue":t[6]||(t[6]=t=>e.send_test_dialog=t),persistent:""},{default:(0,i.k6)((()=>[(0,i.bF)(j,{style:{width:"500px"}},{default:(0,i.k6)((()=>[(0,i.bF)(x,{class:"text-white secondary-toolbar"},{default:(0,i.k6)((()=>[(0,i.bF)(U,null,{default:(0,i.k6)((()=>[(0,i.Lk)("span",h,(0,a.v_)(e.$t("send_test")),1)])),_:1}),(0,i.bo)((0,i.bF)(L,{flat:"",round:"",dense:"",icon:"close"},null,512),[[z]])])),_:1}),(0,i.bF)(Q,{onSubmit:e.submitSendTest},{default:(0,i.k6)((()=>[(0,i.bF)(I,null,{default:(0,i.k6)((()=>[(0,i.Lk)("div",_,[(0,i.Lk)("div",f,[(0,i.bF)(C,{outlined:"",dense:"",label:e.$t("receiver_email"),modelValue:e.email.receiver_email,"onUpdate:modelValue":t[5]||(t[5]=t=>e.email.receiver_email=t),rules:[t=>t&&t.length>0||e.$t("please_input_email"),t=>e.isValidEmail(t)||e.$t("invalid_email")]},null,8,["label","modelValue","rules"])])]),e.filteredDataKey.length?((0,i.uX)(),(0,i.CE)("div",g,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.filteredDataKey,((t,l)=>((0,i.uX)(),(0,i.CE)("div",{key:t.index,class:(0,a.C4)(l?"properties-child":"")},[(0,i.bF)(C,{outlined:"",dense:"",label:t.name,modelValue:e.filteredDataValues[t.key],"onUpdate:modelValue":l=>e.filteredDataValues[t.key]=l},{append:(0,i.k6)((()=>[(0,i.bF)(A,{name:"content_copy",style:{"font-size":"16px"},class:"cursor-pointer",onClick:l=>e.clickToCopyKey(t.key)},{default:(0,i.k6)((()=>[(0,i.bF)(D,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(e.$t("click_to_copy_key")),1)])),_:1})])),_:2},1032,["onClick"])])),_:2},1032,["label","modelValue","onUpdate:modelValue"])],2)))),128))])):(0,i.Q3)("",!0)])),_:1}),(0,i.bF)(R,{align:"right"},{default:(0,i.k6)((()=>[(0,i.bo)((0,i.bF)(F,{appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[z]]),(0,i.bF)(F,{class:"q-mr-sm","data-cy":"setvatfield",label:e.$t("send"),type:"submit"},null,8,["label"])])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(X,{showing:e.loading,style:{"z-index":"2"}},{default:(0,i.k6)((()=>[b])),_:1},8,["showing"])],64)}var k=l(38734),y=l(91236),F=l(60894),E=l(94124),C=l(1659),w=l(64775),V=l(24622),T=l(23537),$=l(78652),S=l(25577),q=function(e,t,l,i){function a(e){return e instanceof l?e:new l((function(t){t(e)}))}return new(l||(l=Promise))((function(l,s){function o(e){try{r(i.next(e))}catch(t){s(t)}}function n(e){try{r(i["throw"](e))}catch(t){s(t)}}function r(e){e.done?l(e.value):a(e.value).then(o,n)}r((i=i.apply(e,t||[])).next())}))};const A=(0,i.pM)({el:"#app",mixins:[V.A],components:{SubHeader:y.A,BackToSettings:F.A,Editor:S.A},mounted(){this.init(),this.setEditorHeight(),window.addEventListener("resize",this.setEditorHeight)},unmounted(){window.removeEventListener("resize",this.setEditorHeight)},watch:{"email.supplier_type":function(e){const t=this.sample_data.filter((t=>t.email_type===e));t.length>0&&t.map((e=>{this.filteredDataKey=e.data_key}))}},methods:{setEditorHeight(){this.$nextTick((function(){const e=this.$refs.editorContainer;if(e){const t=e.getBoundingClientRect().height;this.editorHeight=t}}))},formatCode(){this.is_format_code=!0},afterFormatted(e){this.is_format_code=e},isValidEmail(e){const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)},updateValue(e){this.email.editor_value=e},openViewSource(){this.view_source=!0},backToEditor(){this.view_source=!1},init(){return q(this,void 0,void 0,(function*(){yield this.getSampleTemplatedata()}))},getSampleTemplatedata(){return q(this,void 0,void 0,(function*(){try{yield this.getSampleData()}catch(e){}}))},submitForm(){const e=this.$refs.saveForm;e.submit()},save(){return q(this,void 0,void 0,(function*(){try{if(!this.email.editor_value.trim())return void this.showErrorToast(this.t("email_content_empty"));{this.loading=!0;const e=yield this.createEmailTemplate(this.email);if(!e||!1===e.success)throw null===e||void 0===e?void 0:e.message;this.resetEmailData(),this.$router.push("/settings/supplier/email_templates"),this.showSuccessToast(this.t("email_template_created_success"))}}catch(e){const t=w.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},sendTest(){this.send_test_dialog=!0},submitSendTest(){return q(this,void 0,void 0,(function*(){try{this.send_test_dialog=!1,this.loading=!0,this.prepareDataSend={receiver_email:this.email.receiver_email,subject:this.email.subject,body:this.email.editor_value,data:Object.assign({},this.filteredDataValues)};const e=yield this.sendTestEmail(this.prepareDataSend);e&&this.showSuccessToast(this.t("email_send_successfully")),this.email.receiver_email=""}catch(e){const t=w.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},openFileDialog(){const e=this.$refs.fileInput;e&&e.click()},handleFileUpload(e){return q(this,void 0,void 0,(function*(){const t=e.target;if(t.files&&t.files[0]){const e=t.files[0];yield this.onUploadFile(e),e.type.startsWith("image/")?this.insertImageToEditor(this.stream_file_data):this.insertFileLinkToEditor(this.stream_file_data,e.name)}}))},insertImageToEditor(e){this.email.editor_value+=`<img src="${e}" alt="Uploaded Image" />`},insertFileLinkToEditor(e,t){const l=`<a class="cursor-pointer" href="${e}" target="_blank">${t}</a>`;this.email.editor_value+=l},selectEmailChange(e){this.email.supplier_type=e},resetEmailData(){this.email.name="",this.email.subject="",this.email.supplier_type="",this.email.editor_value="",this.email.receiver_email="",this.filteredDataKey=[],this.filteredDataValues=[]},clickToCopyKey(e){return q(this,void 0,void 0,(function*(){const t=`{{${e}}}`;yield(0,$.A)(t),this.showSuccessToast(this.t("copy_key_successfully"))}))},insertKey(e){var t;null===(t=this.editorRef)||void 0===t||t.runCmd("insertHTML",`{{${e}}}`)}},data(){return{files:(0,k.KR)(null),email:{name:"",subject:"",supplier_type:"",editor_value:"",receiver_email:""},filteredDataKey:(0,k.KR)([]),filteredDataValues:(0,k.KR)([]),prepareDataSend:{},view_source:(0,k.KR)(!1),is_format_code:(0,k.KR)(!1),editorHeight:0}},setup(){const e=(0,E.M_)(),t=((0,k.KR)(null),(0,k.KR)(null)),{loading:l,send_test_dialog:i,sample_data:a,stream_file_data:s}=(0,C.bP)(e),{createEmailTemplate:o,getSampleData:n,sendTestEmail:r,onUploadFile:d}=e,{t:u}=(0,T.s9)();return{t:u,editorRef:t,createEmailTemplate:o,getSampleData:n,sendTestEmail:r,onUploadFile:d,loading:l,sample_data:a,send_test_dialog:i,stream_file_data:s,supplierEmailOptions:[{label:"Supplier Invitation Email",value:"supplier_invite"},{label:"Supplier Registration Completion Email",value:"supplier_register"},{label:"Supplier Approval Email",value:"supplier_approve"},{label:"Supplier Rejection Email",value:"supplier_reject"}]}}});var D=l(12807),K=l(49200),Q=l(67837),U=l(94940),L=l(79075),x=l(18301),I=l(53999),R=l(90124),j=l(25173),H=l(50492),X=l(97410),z=l(82156),W=l(23316),B=l(36914),M=l(39150),P=l(56384),O=l(44189),N=l(62669),G=l(39035),J=l(88672),Y=l(98582),Z=l.n(Y);const ee=(0,D.A)(A,[["render",v],["__scopeId","data-v-663a5826"]]),te=ee;Z()(A,"components",{QForm:K.A,QInput:Q.A,QSelect:U.A,QEditor:L.A,QBtnDropdown:x.A,QList:I.A,QItem:R.A,QItemSection:j.A,QIcon:H.A,QTooltip:X.A,QDialog:z.A,QCard:W.A,QToolbar:B.A,QToolbarTitle:M.A,QBtn:P.A,QCardSection:O.A,QCardActions:N.A,QInnerLoading:G.A}),Z()(A,"directives",{ClosePopup:J.A})}}]);