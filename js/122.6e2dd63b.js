"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[122],{20122:(e,t,o)=>{o.r(t),o.d(t,{default:()=>ke});var l=o(61758),a=o(58790),s=o(29104);const i=e=>((0,l.Qi)("data-v-1073dd26"),e=e(),(0,l.jt)(),e),r={class:"row q-pa-md"},n={class:"col-12 q-pb-md"},d={class:"row"},c={class:"col-sm-8 col-md-6 col-lg-4"},u={class:"col-sm-4 col-md-6 col-lg-8"},h={class:"col-12 q-pb-md",style:{height:"76vh !important","overflow-y":"auto"}},p={class:"table-header-text"},g={class:"text-left q-pl-md"},f={class:"text-center width-160"},m=["onClick"],k={class:"text-left"},w={class:"text-center"},_={class:"text-red"},b={class:"col-11 q-pb-md",style:{"margin-top":"20px","align-items":"center","justify-content":"center"}},v={class:"row"},y={class:"col-1 q-pb-md",style:{"margin-top":"20px","align-items":"center","justify-content":"center"}},F={class:"float-right",style:{"font-size":"medium",display:"flex","align-items":"center"}},L={class:"q-ml-sm"},D={class:"text-weight-bold"},E=i((()=>(0,l.Lk)("img",{src:"settings/export.svg",width:"100","aria-hidden":"true"},null,-1))),T={style:{padding:"20px"}},x={class:"text-white"};function A(e,t,o,i,A,C){const W=(0,l.g2)("SubHeader"),q=(0,l.g2)("q-icon"),$=(0,l.g2)("q-input"),R=(0,l.g2)("f-btn"),S=(0,l.g2)("q-item-section"),I=(0,l.g2)("q-item"),Q=(0,l.g2)("q-separator"),V=(0,l.g2)("q-list"),j=(0,l.g2)("q-menu"),U=(0,l.g2)("q-btn"),B=(0,l.g2)("q-markup-table"),K=(0,l.g2)("q-pagination"),O=(0,l.g2)("q-tooltip"),M=(0,l.g2)("q-avatar"),P=(0,l.g2)("q-card-section"),z=(0,l.g2)("q-card-actions"),X=(0,l.g2)("q-card"),H=(0,l.g2)("q-dialog"),J=(0,l.g2)("Loader"),N=(0,l.g2)("q-toolbar-title"),G=(0,l.g2)("q-toolbar"),Y=(0,l.g2)("q-file"),Z=(0,l.g2)("workflowTemplates"),ee=(0,l.gN)("close-popup");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(W,{name:"page_workflow",label:e.$t("my_workflows"),show_expiry_alert:!0,display_help_link:!0},null,8,["label"]),(0,l.Lk)("div",r,[(0,l.Lk)("div",n,[(0,l.Lk)("div",d,[(0,l.Lk)("div",c,[(0,l.bF)($,{modelValue:e.searchBy,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.searchBy=t),t[1]||(t[1]=t=>e.inputValueChanges())],dense:"",class:(0,a.C4)(0===e.searchBy.length?"search-in-active":"search-active"),autofocus:"",placeholder:e.$t("search_workflow"),outlined:""},{append:(0,l.k6)((()=>[(0,l.bF)(q,{flat:"",dense:"",name:"search",size:"24px",color:"primary"})])),_:1},8,["modelValue","class","placeholder"])]),(0,l.Lk)("div",u,[(0,l.bF)(R,{icon:"add",label:e.$t("add_workflow"),class:"float-right",to:"/workflow_designer"},null,8,["label"]),(0,l.bF)(R,{icon:"file_upload",label:e.$t("import_workflow"),class:"float-right",style:{"margin-right":"10px"},onClick:t[2]||(t[2]=t=>{e.multiUploaderDialog=!0,e.uploadedFiles=null})},null,8,["label"]),(0,l.bF)(R,{icon:"account_tree",label:e.$t("workflow_templates"),class:"float-right",style:{"margin-right":"10px"},onClick:t[3]||(t[3]=t=>e.ShowTemplateDashboard=!0)},null,8,["label"])])])]),(0,l.Lk)("div",h,[(0,l.bF)(B,{flat:"",class:"workflow-table-style"},{default:(0,l.k6)((()=>[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",p,[(0,l.Lk)("th",g,(0,a.v_)(e.$t("name")),1),(0,l.Lk)("th",f,(0,a.v_)(e.$t("actions")),1)])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.tableData,((o,i)=>((0,l.uX)(),(0,l.CE)("tr",{class:"cursor-pointer workflow-name",key:i,onClick:t=>e.openWorkflowDesigner(o.id)},[(0,l.Lk)("td",k,[o.enabled?((0,l.uX)(),(0,l.Wv)(q,{key:0,class:"q-mr-md black_to_white",name:"img:workflow/flow-enabled.svg"})):(0,l.Q3)("",!0),o.enabled?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(q,{key:1,class:"q-mr-md black_to_white",name:"img:workflow/flow-disabled.svg"})),(0,l.Lk)("span",{style:{"font-size":"16px"},class:(0,a.C4)(1==o.enabled?"enabled-name":"disabled-name")},(0,a.v_)(o.name),3)]),(0,l.Lk)("td",w,[(0,l.bF)(U,{flat:"",dense:"",round:"",onClick:t[4]||(t[4]=(0,s.D$)((()=>{}),["stop","prevent"])),icon:"more_horiz"},{default:(0,l.k6)((()=>[(0,l.bF)(j,{"auto-close":"","transition-show":"jump-down","transition-hide":"jump-up",anchor:"bottom middle",self:"top middle"},{default:(0,l.k6)((()=>[(0,l.bF)(V,{dense:"",style:{"min-width":"100px"}},{default:(0,l.k6)((()=>[(0,l.bF)(I,{clickable:""},{default:(0,l.k6)((()=>[o.enabled?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(S,{key:0,onClick:t=>e.handleActive(o,!0)},{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(e.$t("activate")),1)])),_:2},1032,["onClick"])),o.enabled?((0,l.uX)(),(0,l.Wv)(S,{key:1,onClick:t=>e.handleActive(o,!1)},{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(e.$t("deactivate")),1)])),_:2},1032,["onClick"])):(0,l.Q3)("",!0)])),_:2},1024),(0,l.bF)(I,{clickable:""},{default:(0,l.k6)((()=>[(0,l.bF)(S,{onClick:t=>e.copyWorkflow(o.id)},{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(e.$t("duplicate")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,l.bF)(I,{clickable:""},{default:(0,l.k6)((()=>[(0,l.bF)(S,{onClick:t=>e.openWorkflowDesigner(o.id)},{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(e.$t("edit")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,l.bF)(I,{clickable:""},{default:(0,l.k6)((()=>[(0,l.bF)(S,{onClick:t=>e.downloadWorkflow(o)},{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(e.$t("download")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,l.bF)(Q,{inset:""}),(0,l.bF)(I,{clickable:""},{default:(0,l.k6)((()=>[(0,l.bF)(S,{onClick:t=>{e.workflowId=o.id,e.confirmDelete=!0,e.selectedRecordIndex=i}},{default:(0,l.k6)((()=>[(0,l.Lk)("span",_,(0,a.v_)(e.$t("delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])],8,m)))),128))])])),_:1})]),(0,l.Lk)("div",b,[(0,l.Lk)("div",v,[e.total_pages>1?((0,l.uX)(),(0,l.Wv)(K,{key:0,modelValue:e.current_page,"onUpdate:modelValue":t[5]||(t[5]=t=>e.current_page=t),max:e.total_pages,"direction-links":"",unelevated:"",color:"black","active-color":"black",class:"doc2-pagination q-ml-auto q-mr-auto",onClick:t[6]||(t[6]=t=>e.nexPageClicked())},null,8,["modelValue","max"])):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",y,[(0,l.Lk)("label",F,[(0,l.eW)((0,a.v_)(e.version)+" ",1),(0,l.bF)(O,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(e.$t("docflow_version")),1)])),_:1})])])]),(0,l.bF)(H,{modelValue:e.confirmDelete,"onUpdate:modelValue":t[8]||(t[8]=t=>e.confirmDelete=t),persistent:""},{default:(0,l.k6)((()=>[(0,l.bF)(X,null,{default:(0,l.k6)((()=>[(0,l.bF)(P,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,l.k6)((()=>[(0,l.bF)(M,{icon:"warning",color:"primary"})])),_:1}),(0,l.bF)(P,{class:"row items-center"},{default:(0,l.k6)((()=>[(0,l.Lk)("span",L,(0,a.v_)(e.$t("pages.messages.msg_delete")),1)])),_:1}),(0,l.bF)(z,{align:"right"},{default:(0,l.k6)((()=>[(0,l.bo)((0,l.bF)(U,{flat:"",label:e.$t("cancel"),color:"primary"},null,8,["label"]),[[ee]]),(0,l.bo)((0,l.bF)(U,{flat:"",label:e.$t("delete"),color:"primary",onClick:t[7]||(t[7]=t=>{e.deleteWorkflow()})},null,8,["label"]),[[ee]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,l.bF)(J),(0,l.bF)(H,{modelValue:e.multiUploaderDialog,"onUpdate:modelValue":t[13]||(t[13]=t=>e.multiUploaderDialog=t)},{default:(0,l.k6)((()=>[(0,l.bF)(X,{style:{width:"50vw"}},{default:(0,l.k6)((()=>[(0,l.bF)(G,{class:"text-white secondary-toolbar"},{default:(0,l.k6)((()=>[(0,l.bF)(N,null,{default:(0,l.k6)((()=>[(0,l.Lk)("span",D,(0,a.v_)(e.$t("upload_workflow")),1)])),_:1}),(0,l.bo)((0,l.bF)(U,{flat:"",round:"",dense:"",icon:"close"},null,512),[[ee]])])),_:1}),(0,l.bF)(P,null,{default:(0,l.k6)((()=>[(0,l.Lk)("div",{class:"drag-area text-center full-width",style:{padding:"20px"},id:"box-droppable",onDrop:t[10]||(t[10]=(...t)=>e.drop&&e.drop(...t)),onDragover:t[11]||(t[11]=(...t)=>e.allowDrop&&e.allowDrop(...t)),onDragleave:t[12]||(t[12]=(...t)=>e.dragLeave&&e.dragLeave(...t))},[E,(0,l.Lk)("div",T,(0,a.v_)(e.$t("pages.land.dragndrop")),1),(0,l.bF)(Y,{style:{width:"70% !important",margin:"auto","white-space":"nowrap"},"data-cy":"upload-multiple-docs",class:"select-field",outlined:"",multiple:"","onUpdate:modelValue":[e.uploadFile,t[9]||(t[9]=t=>e.uploadedFiles=t)],modelValue:e.uploadedFiles,label:e.$t("upload_workflow"),accept:"application/json"},{prepend:(0,l.k6)((()=>[(0,l.bF)(q,{name:"attachment"})])),file:(0,l.k6)((({index:e,file:t})=>[(0,l.Lk)("div",x,(0,a.v_)(t.name),1),(0,l.bF)(O,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(t.name),1)])),_:2},1024),(0,l.Q3)("",!0)])),_:1},8,["onUpdate:modelValue","modelValue","label"])],32)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,l.bF)(H,{modelValue:e.ShowTemplateDashboard,"onUpdate:modelValue":t[14]||(t[14]=t=>e.ShowTemplateDashboard=t),onKeypress:t[15]||(t[15]=(0,s.jR)((t=>e.ShowTemplateDashboard=!1),["esc"]))},{default:(0,l.k6)((()=>[(0,l.bF)(Z)])),_:1},8,["modelValue"])],64)}var C=o(53500),W=o(1659),q=o(24622),$=o(38734),R=o(96056),S=o(89156),I=o(18505),Q=o(11470),V=o(83319),j=o(77362),U=o(64775),B=o(76956),K=o(7426),O=function(e,t,o,l){function a(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function i(e){try{n(l.next(e))}catch(t){s(t)}}function r(e){try{n(l["throw"](e))}catch(t){s(t)}}function n(e){e.done?o(e.value):a(e.value).then(i,r)}n((l=l.apply(e,t||[])).next())}))};const M=(0,l.pM)({name:"workFlow",mixins:[q.A,R.A,I.A],components:{Loader:S.A,SubHeader:j.A,workflowTemplates:K.A},data(){return{workflowId:(0,$.KR)(""),searchBy:(0,$.KR)(""),tableData:{},confirmDelete:(0,$.KR)(!1),selectedRecordIndex:(0,$.KR)(),version:(0,$.KR)("")}},mounted(){return O(this,void 0,void 0,(function*(){this.debounceSearchInputFunc=(0,C.A)((()=>{this.loadWorkFlow()}),1e3),this.loadWorkFlow(),document.removeEventListener("upload_files",this.uploadFilesEventHandler),document.addEventListener("upload_files",this.uploadFilesEventHandler),yield this.getWorkflowVersion()}))},unmounted:function(){logInfo("unmounted"),document.removeEventListener("upload_files",this.uploadFilesEventHandler)},methods:{inputValueChanges(){this.debounceSearchInputFunc()},getWorkflowVersion(){return O(this,void 0,void 0,(function*(){const e=yield Q.Bj.getDocFlowVersion();this.version=e["docflow-version"]}))},loadWorkFlow(){return O(this,void 0,void 0,(function*(){let e;try{this.showLoading(),this.request_params={},this.request_params["offset"]=this.offset,this.request_params["limit"]=this.page_size,this.request_params["order_by_direction"]="desc",this.searchBy.length>1&&(this.request_params["name"]=this.searchBy),e=yield Q.Bj.getWorkflowDashboard(this.request_params),e.entries&&(this.tableData=e.entries),this.total_records=e.all_entries_count,this.setTotalPages()}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(t)}finally{this.hideLoading()}}))},handleActive(e,t){return O(this,void 0,void 0,(function*(){let o,l=null;try{let a={};a.id=e.id,a.enabled=t,o=yield Q.Bj.updateWorkflow(a),o&&(this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),e.enabled=t),l=!1}catch(a){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(a),l=null}}))},saveOrUpdateWorkflow(){return O(this,void 0,void 0,(function*(){if(this.openAddWorkflowDialog)return;let e;try{if(this.showLoading(),this.workflowModel["id"])e=yield Q.Bj.updateWorkflow(this.workflowModel),this.tableData[this.selectedRecordIndex].id=e.id,this.tableData[this.selectedRecordIndex].name=e.name,this.tableData[this.selectedRecordIndex].org_id=e.org_id,this.tableData[this.selectedRecordIndex].enabled=e.enabled,this.tableData[this.selectedRecordIndex].trigger=e.trigger,this.tableData[this.selectedRecordIndex].doc_type=e.doc_type,this.tableData[this.selectedRecordIndex].sub_org_id=e.sub_org_id,this.tableData[this.selectedRecordIndex].description=e.description;else{e=yield Q.Bj.createWorkflow(this.workflowModel);const t={id:e.id,name:e.name,org_id:e.org_id,enabled:e.enabled,trigger:e.trigger,doc_type:e.doc_type,sub_org_id:e.sub_org_id,description:e.description};this.tableData.splice(0,0,t)}this.showSuccessToast(this.$t("pages.messages.MSG_SAVE"))}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(t)}finally{this.hideLoading()}}))},deleteWorkflow(){return O(this,void 0,void 0,(function*(){let e;try{this.showLoading(),e=yield Q.Bj.deleteWorkflow(this.workflowId),this.showSuccessToast(this.$t("pages.messages.DELETED_SUCCESSFULLY")),this.tableData.splice(this.selectedRecordIndex,1)}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(t)}finally{this.hideLoading()}}))},copyWorkflow(e){return O(this,void 0,void 0,(function*(){let t;try{this.showLoading(),t=yield Q.Bj.copyWorkflow(e),this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),this.tableData.splice(0,0,JSON.parse(JSON.stringify(t)))}catch(o){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(o)}finally{this.hideLoading()}}))},openWorkflowDesigner(e){this.$router.push("/workflow_designer/"+e)},downloadWorkflow(e){return O(this,void 0,void 0,(function*(){try{this.showLoading(),yield Q.Bj.exportworkflowtojson(e.id).then((t=>{const o=new Blob([JSON.stringify(t)],{type:"application/json"}),l=document.createElement("a");l.href=URL.createObjectURL(o),l.download=e.name,l.click(),URL.revokeObjectURL(l.href)}))}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(t)}finally{this.hideLoading()}}))},resetPagination(){this.offset=0,this.total_pages=0,this.current_page=1,this.total_records=0},setTotalPages(){this.total_pages=Math.ceil(this.total_records/this.page_size)},nexPageClicked(){return O(this,void 0,void 0,(function*(){try{this.calculateOffset(),yield this.loadWorkFlow()}catch(e){const t=U.t.getErrorMessage(e);this.showErrorToast(t),logError(e)}}))},calculateOffset(){this.offset=this.page_size*(this.current_page-1)},uploadFile(e){this.uploadedFiles=e;let t=this.uploadedFiles;t||this.showErrorToast(this.$t("pages.messages.NO_FILE_SELECTED")),this.uploadFiles(t)},allowDrop(e){e.preventDefault(),e.currentTarget.classList.add("bg-grey-5"),e.currentTarget.classList.add("bd-shadow")},drop(e){e.preventDefault(),e.currentTarget.classList.remove("bg-grey-5"),e.currentTarget.classList.remove("bd-shadow"),this.uploadFiles(e.dataTransfer.files)},dragLeave(e){e.currentTarget.classList.remove("bg-grey-5"),e.currentTarget.classList.remove("bd-shadow")},uploadFilesEventHandler(e){e&&e.detail.files&&this.uploadFiles(e.detail.files)},uploadFiles(e){return O(this,void 0,void 0,(function*(){try{if(this.multiUploaderDialog=!1,this.uploadedFiles=null,e&&e.length>10)return void this.showErrorToast(this.$t("max_workflow_upload_limit"));this.formData=new FormData;let t=0;for(let o of e)this.hasAllowedFileType(o)?this.formData.append("workflow_json",o):t++;if(t>0)return void this.showErrorToast(this.$t("pages.messages.INVALID_FILES"));yield this.uploadWorkflowJson(this.formData)}catch(t){const e=U.t.getErrorMessage(t);this.showErrorToast(e),logError(t)}finally{const e=new CustomEvent("table_data_updated",{});document.dispatchEvent(e)}}))},hasAllowedFileType(e){let t=B.oe.includes(e.type);if(!t){const o=e.name.lastIndexOf("."),l=e.name.substring(o+1);t=B.oe.includes(l)}return t},uploadWorkflowJson(e){return O(this,void 0,void 0,(function*(){try{logInfo("formData",e);const t=yield Q.Bj.importWorkflowJson(e);if(!1===t.success)return logError(t),this.showErrorToast(this.$t("pages.messages.DOC_UPLOAD_ERROR")),void this.showErrorToast(t.message)}catch(t){const e=U.t.getErrorMessage(t);this.showErrorToast(e),logError(t)}finally{yield this.loadWorkFlow()}}))}},setup(){const e=(0,V.cY)(),{doc_type_list:t,trigger_list:o,subOrgList:l}=(0,W.bP)(e),{getSubOrgsList:a,getDocumentTriggers:s}=e;return{subOrgList:l,trigger_list:o,doc_type_list:t,debounceSearchInputFunc:{},request_params:(0,$.KR)({}),current_page:(0,$.KR)(1),total_pages:(0,$.KR)(1),offset:(0,$.KR)(0),page_size:(0,$.KR)(25),total_records:(0,$.KR)(0),multiUploaderDialog:(0,$.KR)(!1),uploadedFiles:(0,$.KR)(null),formData:{},ShowTemplateDashboard:(0,$.KR)(!1),getSubOrgsList:a,getDocumentTriggers:s}}});var P=o(12807),z=o(67837),X=o(50492),H=o(857),J=o(80460),N=o(56384),G=o(84436),Y=o(53999),Z=o(90124),ee=o(25173),te=o(10386),oe=o(54700),le=o(97410),ae=o(82156),se=o(23316),ie=o(44189),re=o(3952),ne=o(62669),de=o(36914),ce=o(39150),ue=o(99980),he=o(42315),pe=o(88672),ge=o(98582),fe=o.n(ge);const me=(0,P.A)(M,[["render",A],["__scopeId","data-v-1073dd26"]]),ke=me;fe()(M,"components",{QInput:z.A,QIcon:X.A,QMarkupTable:H.A,QCheckbox:J.A,QBtn:N.A,QMenu:G.A,QList:Y.A,QItem:Z.A,QItemSection:ee.A,QSeparator:te.A,QPagination:oe.A,QTooltip:le.A,QDialog:ae.A,QCard:se.A,QCardSection:ie.A,QAvatar:re.A,QCardActions:ne.A,QToolbar:de.A,QToolbarTitle:ce.A,QFile:ue.A,QTable:he.A}),fe()(M,"directives",{ClosePopup:pe.A})}}]);