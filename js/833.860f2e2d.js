"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[833],{70833:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ft});var o=s(61758),i=s(58790);const a=e=>((0,o.Qi)("data-v-e0b0af30"),e=e(),(0,o.jt)(),e),r={class:"full-width sub-header mobile-only"},l={class:"row",style:{padding:"10px 12px"}},n={class:"left-side q-mr-auto q-pl-lg"},d={class:"q-mr-auto"},c={class:"cursor-pointer text-caption"},h={class:"row highlighted-back q-pl-md top-back-button-bar"},u={class:"secondary-c-text full-width text-h6"},p={class:"primary-dashboard"},m={key:0,class:"row highlighted-back q-pl-md q-pr-md q-pb-md"},g={key:1,class:"row"},_={key:0,class:"col-xs-12 col-sm-12 col-md-3 col-lg-3 q-pl-lg small-hide",id:"left_section",ref:"left_section"},v={class:"row"},f={class:"full-width approval-content-area",style:{position:"relative"}},y={key:0,class:"back-white secondary-c-text gray-border",style:{"border-radius":"5px","margin-right":"8px"}},w={class:"row"},b={class:"q-mr-auto q-ml-auto"},k={class:"text-h6 text-weight-bold"},L={class:"q-pr-sm full-width small-hide"},F={class:"row"},C={style:{position:"relative"}},A={class:"row"},I={class:"back-white q-pa-sm",style:{"border-radius":"5px"}},S={class:"full-width white-inputs"},E={class:"full-width full-height"},x={key:0,class:"full-width"},q=["data-group-id"],P={class:"row q-pr-sm"},T={class:"col-12 secondary-c-text text-h6 text-weight-bold"},M=["data-fields-group-name"],R={style:{"margin-left":"3px",top:"40%"}},D={class:"row"},B={class:"approval-width q-pl-sm approval-anotation-area scrolle-y"},O={class:"invisible absolute position-absolute"},$={class:"row"},V={class:"q-mr-auto"},z={class:"page-numbers"},Q={class:"panel-middle mobile-hide"},K={class:"panel-right mobile-hide"},U={class:"doc-name"},j={class:"full-width full-height",id:"image_container",style:{position:"relative"}},H={class:"column full-width justify-between back-white right-action-bar approval-anotation-area"},N={class:"action-bar-items"},X={class:"action-bar-bottom"},W={class:"q-my-auto"},G={class:"validation-view-button q-pt-md"},J={key:0,class:"col-xs-12 col-sm-12 col-md-3 col-lg-3"},Y=a((()=>(0,o.Lk)("div",null,"Comment",-1))),Z={class:"q-pt-none"},ee={class:"footer-filename"},te={class:"footer-status-message"},se={class:"footer-status-message"},oe={key:1,class:"row"},ie={class:"row q-ml-sm back-white custom-border",style:{width:"138px"}},ae=["src"],re=["src"];function le(e,t,s,a,le,ne){const de=(0,o.g2)("q-icon"),ce=(0,o.g2)("f-btn"),he=(0,o.g2)("ErrorDocumentView"),ue=(0,o.g2)("DocumentLogs"),pe=(0,o.g2)("q-btn"),me=(0,o.g2)("q-tooltip"),ge=(0,o.g2)("AnnotationView"),_e=(0,o.g2)("TaskBtn"),ve=(0,o.g2)("q-separator"),fe=(0,o.g2)("q-input"),ye=(0,o.g2)("q-splitter"),we=(0,o.g2)("TaskList"),be=(0,o.g2)("q-page-sticky"),ke=(0,o.g2)("q-space"),Le=(0,o.g2)("q-bar"),Fe=(0,o.g2)("q-card-section"),Ce=(0,o.g2)("q-card"),Ae=(0,o.g2)("q-dialog"),Ie=(0,o.g2)("Loader"),Se=(0,o.g2)("q-item-section"),Ee=(0,o.g2)("q-item"),xe=(0,o.g2)("q-list"),qe=(0,o.g2)("q-menu"),Pe=(0,o.g2)("q-toolbar"),Te=(0,o.g2)("q-footer"),Me=(0,o.gN)("close-popup");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.Lk)("div",r,[(0,o.Lk)("div",l,[(0,o.Lk)("span",n,[(0,o.Lk)("div",d,[(0,o.Lk)("span",{class:"cursor-pointer text-uppercase",onClick:t[0]||(t[0]=(...t)=>e.routeToListPendingApproval&&e.routeToListPendingApproval(...t))},[(0,o.bF)(de,{class:"cursor-pointer",onClick:e.nextImage,name:"chevron_left",size:"sm"},null,8,["onClick"]),(0,o.eW)(" "+(0,i.v_)(e.$t("pending_approval_list")),1)]),(0,o.Lk)("span",c," - "+(0,i.v_)(e.pending_approval_doc_count)+" "+(0,i.v_)(e.$t("invoices_for_release")),1)])])])]),(0,o.Lk)("div",h,[(0,o.Lk)("div",u,[(0,o.bF)(ce,{appearance:"tertiary","data-cy":"dashboard",onClick:t[1]||(t[1]=t=>e.goToDashboard())},{default:(0,o.k6)((()=>[(0,o.bF)(de,{name:"fa-solid fa-circle-arrow-left",size:"sm"}),(0,o.Lk)("label",p,(0,i.v_)(e.$t("dashboard")),1)])),_:1})])]),e.error?((0,o.uX)(),(0,o.CE)("div",m,[(0,o.bF)(he)])):((0,o.uX)(),(0,o.CE)("div",g,[e.showActivityPanel?((0,o.uX)(),(0,o.CE)("div",_,[(0,o.Lk)("div",v,[(0,o.Lk)("div",f,[e.isModelReady()?((0,o.uX)(),(0,o.CE)("div",y,[(0,o.Lk)("div",w,[(0,o.Lk)("div",b,[(0,o.Lk)("span",k,(0,i.v_)(e.$t("activity_stream")),1)])])])):(0,o.Q3)("",!0),(0,o.Lk)("div",L,[(0,o.bF)(ue,{docId:e.docId,list_data:e.doc_logs},null,8,["docId","list_data"])])])])],512)):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:(0,i.C4)([e.showActivityPanel?"col-xs-12 col-sm-12 col-md-9 col-lg-9":"full-width","q-pl-lg"])},[(0,o.Lk)("div",F,[(0,o.Lk)("div",C,[(0,o.bF)(pe,{size:"sm",dense:"",round:"",unelevated:"",color:"primary",icon:e.showActivityPanel?"chevron_left":"chevron_right",class:"text-white chevron-left-icon",onClick:t[2]||(t[2]=t=>{e.showActivityPanel=!e.showActivityPanel,e.windowResize()})},null,8,["icon"])])]),(0,o.Lk)("div",A,[(0,o.Lk)("div",{class:(0,i.C4)(e.showTaskPanel?"col-xs-12 col-sm-12 col-md-9 col-lg-9":"full-width")},[(0,o.bF)(ye,{modelValue:e.splitterModel,"onUpdate:modelValue":[t[7]||(t[7]=t=>e.splitterModel=t),t[8]||(t[8]=t=>e.windowResize())],class:"approval-content-area border-left-grey q-pl-sm"},{before:(0,o.k6)((()=>[(0,o.Lk)("div",I,[(0,o.Lk)("div",S,[(0,o.Lk)("div",E,[e.isModelReady()?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[e.renderComponent?((0,o.uX)(),(0,o.CE)("div",x,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.formLayout,((t,s)=>((0,o.uX)(),(0,o.CE)(o.FK,{key:`div-${s}`},[t.rows.length>0?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"full-width q-mb-lg not-sticky-area","data-group-id":s},[(0,o.Lk)("div",P,[(0,o.Lk)("div",T,(0,i.v_)(e.getLabelForFormBuilder(t,"form_builder.")),1)]),(0,o.Lk)("div",{class:"full-width","data-fields-group-name":t.name},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(t.rows,((t,a)=>((0,o.uX)(),(0,o.CE)(o.FK,{key:`div-${a}`},[t.is_hidden||void 0!=t.visibile&&!t.visibile?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",{key:0,class:"display-block field-padding",style:(0,i.Tr)("width:"+t.elementWidth+"%")},[((0,o.uX)(),(0,o.Wv)((0,o.$y)(t.fieldType),{currentField:t,isReadOnly:e.getReadOnlyStatus(t.name),fieldName:t.name,groupIndex:s,elementIndex:a,onInputClicked:e.htmlElementClick,onInputValueChanges:e.onInputValueChanges,onUpdateModel:e.updateModel},null,40,["currentField","isReadOnly","fieldName","groupIndex","elementIndex","onInputClicked","onInputValueChanges","onUpdateModel"]))],4))],64)))),128))],8,M)],8,q)):(0,o.Q3)("",!0)],64)))),128))])):(0,o.Q3)("",!0)],64)):(0,o.Q3)("",!0)])])])])),separator:(0,o.k6)((()=>[(0,o.Lk)("div",R,[(0,o.bF)(de,{name:"drag_handle",size:"md",class:"icon-grey rotate-90"})])])),after:(0,o.k6)((()=>[(0,o.Lk)("div",D,[(0,o.Lk)("div",B,[(0,o.Lk)("div",O,[(0,o.Lk)("div",$,[(0,o.Lk)("div",V,[(0,o.bF)(de,{class:"up-arrow cursor-pointer",onClick:e.prevImage,name:"expand_less",size:"sm"},{default:(0,o.k6)((()=>[(0,o.bF)(me,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(e.$t("previous")),1)])),_:1})])),_:1},8,["onClick"]),(0,o.bF)(de,{class:"down-arrow cursor-pointer",onClick:e.nextImage,name:"expand_more",size:"sm"},{default:(0,o.k6)((()=>[(0,o.bF)(me,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(e.$t("next")),1)])),_:1})])),_:1},8,["onClick"]),(0,o.Lk)("span",z,(0,i.v_)(e.currentPage())+"/"+(0,i.v_)(e.images.length)+" "+(0,i.v_)(e.$t("page_number_text")),1)]),(0,o.Lk)("div",Q,[(0,o.Lk)("span",null,[e.record.status==e.in_review?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.eW)((0,i.v_)(e.$t("in_review")),1)],64)):e.second_approval?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)((0,i.v_)(e.$t("second_approval")),1)],64)):((0,o.uX)(),(0,o.CE)(o.FK,{key:2},[(0,o.eW)((0,i.v_)(e.$t("first_approval")),1)],64))])]),(0,o.Lk)("div",K,[(0,o.Lk)("span",{class:"cursor-pointer q-mr-md text-uppercase",onClick:t[3]||(t[3]=(...t)=>e.downloadFile&&e.downloadFile(...t))},(0,i.v_)(e.$t("download")),1),(0,o.Lk)("span",U,(0,i.v_)(e.record.filename),1)])])]),((0,o.uX)(),(0,o.CE)("div",{class:"full-width",key:e.refreshAnnotationView},[(0,o.Lk)("div",j,[(0,o.bF)(ge,{ref:"child_comp",enableEditing:e.enable_editing,cropUrl:e.image+"?"+e.tokenQueryParam,width:e.imageWidth,screenmode:e.screenmode,selectFont:e.selectFont,selectFontSize:e.selectFontSize,selectColor:e.selectColor},null,8,["enableEditing","cropUrl","width","screenmode","selectFont","selectFontSize","selectColor"])])]))]),(0,o.Lk)("div",H,[(0,o.Lk)("div",N,[(0,o.bF)(_e,{onBtnClicked:t[4]||(t[4]=t=>{e.showTaskPanel=!e.showTaskPanel,e.windowResize()})}),(0,o.bF)(ve,{class:"separator-space"})]),(0,o.Lk)("div",X,[(0,o.bF)(ve,{class:"q-mb-sm"}),(0,o.Lk)("div",W,[(0,o.bF)(pe,{icon:"img:images/pages.svg",flat:"",class:"validation-view-button"},{default:(0,o.k6)((()=>[(0,o.bF)(me,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(e.currentPage())+" / "+(0,i.v_)(e.images.length),1)])),_:1})])),_:1})]),(0,o.bF)(fe,{outlined:"",dense:"",modelValue:e.page,"onUpdate:modelValue":[t[5]||(t[5]=t=>e.page=t),t[6]||(t[6]=t=>{e.pageChanged(t)})],class:"validation-view-input",onBlur:e.validatePageNumber},null,8,["modelValue","onBlur"]),(0,o.Lk)("span",G,(0,i.v_)(e.images.length),1),(0,o.Lk)("div",null,[(0,o.bF)(pe,{disable:1==e.page,icon:"keyboard_arrow_up",flat:"",class:"validation-view-page-button icon-grey",onClick:e.prevImage},null,8,["disable","onClick"]),(0,o.bF)(pe,{disable:e.page==e.images.length,icon:"keyboard_arrow_down",flat:"",class:"validation-view-page-button icon-grey",onClick:e.nextImage},null,8,["disable","onClick"])])])])])])),_:1},8,["modelValue"])],2),e.showTaskPanel?((0,o.uX)(),(0,o.CE)("div",J,[(0,o.bF)(we,{onBtnClicked:t[9]||(t[9]=t=>{e.showTaskPanel=!e.showTaskPanel,e.windowResize()})})])):(0,o.Q3)("",!0)])],2),(0,o.bF)(be,{position:"bottom-right",offset:[8,8],class:"hidden small-only"},{default:(0,o.k6)((()=>[(0,o.bF)(pe,{fab:"",icon:"chat",color:"primary",padding:"sm",onClick:t[10]||(t[10]=t=>e.chatWindow=!0)})])),_:1})])),(0,o.bF)(Ae,{modelValue:e.chatWindow,"onUpdate:modelValue":t[11]||(t[11]=t=>e.chatWindow=t),position:"bottom"},{default:(0,o.k6)((()=>[(0,o.bF)(Ce,{class:"full-width"},{default:(0,o.k6)((()=>[(0,o.bF)(Le,{class:"bg-primary text-white"},{default:(0,o.k6)((()=>[Y,(0,o.bF)(ke),(0,o.bo)((0,o.bF)(pe,{dense:"",flat:"",icon:"close"},null,512),[[Me]])])),_:1}),(0,o.bF)(Fe,null,{default:(0,o.k6)((()=>[(0,o.Lk)("div",Z,[(0,o.bF)(ue,{docId:e.docId,list_data:e.doc_logs},null,8,["docId","list_data"])])])),_:1}),(0,o.bF)(Fe,{class:"q-pt-none"})])),_:1})])),_:1},8,["modelValue"]),(0,o.bF)(Ie),(0,o.bF)(Te,{class:"validation-status-bar back-white"},{default:(0,o.k6)((()=>[(0,o.bF)(Pe,{class:"row justify-start opened-right-padding"},{default:(0,o.k6)((()=>[(0,o.Lk)("span",ee,(0,i.v_)(e.record.filename),1),(0,o.bF)(pe,{size:"md",flat:"",dense:"",class:"q-ml-xs",onClick:e.downloadFile},{default:(0,o.k6)((()=>[(0,o.bF)(de,{name:"download",style:{color:"#8a8a8a"}})])),_:1},8,["onClick"]),(0,o.bF)(ve,{vertical:"",class:"q-mx-md"}),(0,o.Lk)("span",te,[e.second_approval?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.eW)((0,i.v_)(e.$t("second_approval")),1)],64)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)((0,i.v_)(e.$t("first_approval")),1)],64))]),(0,o.bF)(ve,{vertical:"",class:"q-mx-md"}),(0,o.Lk)("span",null,(0,i.v_)(e.pending_approval_doc_count)+" "+(0,i.v_)(e.$t("invoices_for_release")),1),(0,o.bF)(ve,{vertical:"",class:"q-mx-md"}),(0,o.bF)(ke),e.record.table_blocked?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.bF)(ve,{vertical:"",class:"q-mx-md"}),(0,o.bF)(de,{class:"text-blue",style:{"font-size":"22px"},name:"info"}),(0,o.Lk)("span",se,(0,i.v_)(e.$t("block_supplier_warning")),1)],64)):(0,o.Q3)("",!0),(0,o.bF)(pe,{dense:"",class:"q-mr-sm custom-border back-white",flat:"",size:"12px",onClick:t[12]||(t[12]=t=>{e.showStampMenu=!0,e.showFontMenu=!1,e.screenmode="stamp"})},{default:(0,o.k6)((()=>[(0,o.bF)(de,{name:"img:annotation/stamp_icon.svg",class:"icon-grey-svg"}),(0,o.bF)(me,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(e.$t("annotation.stamp_annotation")),1)])),_:1})])),_:1}),(0,o.bF)(pe,{size:"12px",dense:"",flat:"",class:"q-mr-sm custom-border back-white",onClick:t[13]||(t[13]=t=>{e.showFontMenu=!0,e.showStampMenu=!1,e.screenmode="annotate"})},{default:(0,o.k6)((()=>[(0,o.bF)(de,{name:"text_format",class:"icon-grey"}),(0,o.bF)(me,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(e.$t("annotation.text_annotation")),1)])),_:1})])),_:1}),(0,o.Lk)("div",null,[(0,o.bF)(pe,{size:"12px",flat:"",class:"back-white custom-border q-mr-sm",dense:"",onClick:t[14]||(t[14]=t=>{e.selectColor="#000000",this.$refs.child_comp.createAnnotationFromColorShortcut(e.selectColor)})},{default:(0,o.k6)((()=>[(0,o.bF)(de,{color:"black",name:"title"})])),_:1}),(0,o.bF)(pe,{flat:"",size:"12px",class:"back-white custom-border q-mr-sm",dense:"",onClick:t[15]||(t[15]=t=>{e.selectColor="#f44336",this.$refs.child_comp.createAnnotationFromColorShortcut(e.selectColor)})},{default:(0,o.k6)((()=>[(0,o.bF)(de,{color:"red",name:"title"})])),_:1}),(0,o.bF)(pe,{flat:"",size:"12px",class:"back-white custom-border q-mr-sm",dense:"",onClick:t[16]||(t[16]=t=>{e.selectColor="#4caf50",this.$refs.child_comp.createAnnotationFromColorShortcut(e.selectColor)})},{default:(0,o.k6)((()=>[(0,o.bF)(de,{color:"green",name:"title"})])),_:1}),(0,o.bF)(pe,{flat:"",size:"12px",class:"back-white custom-border q-mr-sm",dense:"",onClick:t[17]||(t[17]=t=>{e.selectColor="#2196f3",this.$refs.child_comp.createAnnotationFromColorShortcut(e.selectColor)})},{default:(0,o.k6)((()=>[(0,o.bF)(de,{color:"blue",name:"title"})])),_:1}),(0,o.bF)(pe,{flat:"",size:"12px",class:"back-white custom-border q-mr-sm",dense:"",onClick:t[18]||(t[18]=t=>{e.selectColor="#ffeb3b",this.$refs.child_comp.createAnnotationFromColorShortcut(e.selectColor)})},{default:(0,o.k6)((()=>[(0,o.bF)(de,{color:"yellow",name:"title"})])),_:1})]),e.showStampMenu?((0,o.uX)(),(0,o.CE)("div",oe,[(0,o.Lk)("div",ie,[(0,o.Lk)("img",{class:"q-px-sm",src:e.stamp_dir+e.selectedStamp+e.stamp_ext,style:{width:"100px"}},null,8,ae),(0,o.bF)(pe,{dense:"",flat:""},{default:(0,o.k6)((()=>[(0,o.bF)(de,{name:"expand_more",class:"icon-grey"}),(0,o.bF)(qe,null,{default:(0,o.k6)((()=>[(0,o.bF)(xe,{style:{"min-width":"80px"}},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.sortedStamps,(t=>(0,o.bo)(((0,o.uX)(),(0,o.Wv)(Ee,{key:t,clickable:""},{default:(0,o.k6)((()=>[(0,o.bF)(Se,{onClick:s=>e.selectedStamp=t},{default:(0,o.k6)((()=>[(0,o.Lk)("img",{width:"80",src:e.stamp_dir+t+e.stamp_ext},null,8,re)])),_:2},1032,["onClick"])])),_:2},1024)),[[Me]]))),128))])),_:1})])),_:1})])),_:1})]),(0,o.bF)(pe,{label:e.$t("doc2light.pages.add"),class:"q-ml-sm",color:"primary",unelevated:"",onClick:t[19]||(t[19]=t=>e.stampAddClicked())},null,8,["label"])])):(0,o.Q3)("",!0)])),_:1})])),_:1})],64)}var ne=s(82303),de=s(1659),ce=s(24622),he=s(38734),ue=s(46162),pe=s(96056),me=s(8420),ge=s(14907),_e=s(45022),ve=s(18505),fe=s(64775),ye=s(68450),we=s(61715),be=s(25891),ke=s(56579),Le=s(63923),Fe=s(12566),Ce=s(96075),Ae=s(60894),Ie=s(11470),Se=s(85487),Ee=s(62409),xe=s(99869),qe=s(6315),Pe=s(66933),Te=s(33865),Me=s(88432),Re=s(55133),De=s(15995),Be=s(23852),Oe=s(8903),$e=s(72099),Ve=s(94124),ze=s(76956),Qe=s(23537),Ke=function(e,t,s,o){function i(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,a){function r(e){try{n(o.next(e))}catch(t){a(t)}}function l(e){try{n(o["throw"](e))}catch(t){a(t)}}function n(e){e.done?s(e.value):i(e.value).then(r,l)}n((o=o.apply(e,t||[])).next())}))};const Ue=document.querySelector.bind(document),je=(0,o.pM)({el:"#app",mixins:[ve.A,ce.A,pe.A,be.A],components:{Loader:me.A,TaskBtn:Le.A,TaskList:ke.A,DocumentLogs:we.A,AnnotationView:qe.A,SecondApprover:Me.A,DocumentApprover:De.A,ErrorDocumentView:Fe.A,Label:Ee.A,Button:xe.A,TextInput:Te.A,BackToSettings:Ae.A,CorrectionButtons:Re.A,HorizontalSeparator:Be.A,ExtractedTableTabPanels:$e.A},watch:{doc_status:{deep:!0,handler:function(){this.checkValidStatus()}}},data(){return{default_stamp:Oe.EO,stamp_ext:Oe.K_,stamps:Oe.dA,stamp_dir:Oe.Ul,sortedStamps:[],docId:"",imageHeight:0,imageWidth:0,loading:!1,showArticlePage:!1,renderComponent:!1,chatWindow:(0,he.KR)(!1),enableExportButton:!1,in_review:ze.aH.in_review,allowedDoctypes:ze.Gk,filter_status:"validated_pending_approval",showActivityPanel:(0,he.KR)(!1),showTaskPanel:(0,he.KR)(!1),enable_editing:(0,he.KR)(!0),splitterModel:(0,he.KR)(50),refreshAnnotationView:(0,he.KR)(0)}},beforeRouteLeave:function(e,t,s){this.restoreBeforeLeave(),s()},mounted:function(){return Ke(this,void 0,void 0,(function*(){let e=_e.A.getItem("selected_language");e&&(this.locale=e);let t=this.$route.params.id;this.getDocAnnotations(t),yield this.getDocTypeSettings(),window.addEventListener("resize",this.windowResize),document.body.addEventListener("click",this.mouseClicked,!0),window.rda=this,this.init(),document.addEventListener("new_log",this.addNewLog),document.addEventListener("keydown",this.keyDownEvent);for(let s=1;s<=80;s++)this.fontSizes.push(s.toString()+"pt")}))},unmounted:function(){window.removeEventListener("resize",this.windowResize),document.removeEventListener("new_log",this.addNewLog),document.removeEventListener("keydown",this.keyDownEvent)},methods:{sortStampsByLanguage(){let e=this.$i18n.locale,t=[];"en-us"==e&&(e="en"),this.stamps.forEach((s=>{"de"!=e&&"en"!=e&&(e="en"),s.includes(e)&&t.push(s)})),this.selectedStamp=t[0],this.sortedStamps=t},init(){return Ke(this,void 0,void 0,(function*(){this.isSecondApproval(),this.$route.params.id||this.$router.push("/dashboard"),this.second_approval&&(this.filter_status=ze.aH.approved_pending_second_approval),this.docId=this.$route.params.id,yield this.getInvoiceDataByDocId(this.docId);let e=ze.L9.field_validation;this.record.status==ze.aH.validated_pending_approval?e=this.model[ze.WE]?ze.L9.approval_v2:ze.L9.approval:this.record.status==ze.aH.in_review?(e=ze.L9.review,this.filter_status=ze.aH.in_review):this.record.status==ze.aH.approved_pending_second_approval&&(e=ze.L9.recond_approval,this.filter_status=ze.aH.approved_pending_second_approval),this.renderDocumentLog(),this.renderPendingRecordsCountView(),this.renderNextPrevLinkBtns(),yield this.getLayoutTemplateID(e),yield this.getFormBuilderLayout(),this.renderComponent=!0,ze.B2.includes(this.record.status)&&(this.isReadOnly=!0),this.handleImageBaseURL(),this.image=this.baseUrl+"/"+(0,Ce.v)(this.record.images[0].path),this.images=(0,Ce.m)(this.record.images),this.sortStampsByLanguage(),this.windowResize()}))},isSecondApproval(){this.second_approval=!1,this.$route.params.second_approval&&"true"===this.$route.params.second_approval&&(this.second_approval=!0)},getInvoiceDataByDocId(e){return Ke(this,void 0,void 0,(function*(){try{if(this.showLoading(),yield this.getDocumentById(e),!this.record.doc_id)return void this.showErrorToast(this.$t("pages.messages.INVALID_DOCUMENT"))}catch(t){return void this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},fillFirstApprover(){let e={};return e=this.record.hasOwnProperty("first_approver")?this.createEmptyField("first_approver","",this.record.first_approver):this.createEmptyField("assigned_to","",this.record.assigned_to),e},createEmptyField(e,t="",s=""){return"checkbox"==t&&(s=!1),{confidence:0,name:e,value:s,formatted_value:s,content:s}},getAssignToUsers(){return Ke(this,void 0,void 0,(function*(){yield this.dropdownStore.prepareUsersDropdown(),this.usersList=this.dropdownStore.usersList,this.formBuilderModel["assigned_to"]=this.getUserFullName(this.record.assigned_to),this.setPreviousApprover()}))},setPreviousApprover(){this.second_approval&&this.record.first_approver&&(this.formBuilderModel["first_approver"]=this.getUserFullName(this.record.first_approver))},filterUserList(e,t,s){try{if(""===e)return void t((()=>{this.usersList=this.dropdownStore.usersList}));t((()=>{const t=e.toLowerCase();this.usersList=this.dropdownStore.usersList.filter((e=>e.label.toLowerCase().indexOf(t)>-1))}))}catch(o){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),s()}},getUserFullName(e){let t=this.dropdownStore.usersList.filter((t=>t.value==e));return t[0].label},isModelReady(){return 0!==(0,ye.Ns)(this.formBuilderConfigModel)},goHelp(){window.open("https://docs.cloudintegration.eu/")},keyDownEvent(e){"d"===e.key&&e.ctrlKey&&(this.showActivityPanel=!this.showActivityPanel)},htmlElementClick(e){this.formBuilderConfigModel[e].fieldType!==Pe.VV.BUTTON||this.handleButtons(e)},handleButtons(e){this.isReadOnly||(this.formBuilderConfigModel[e].type!=ze.aH.reject?this.formBuilderConfigModel[e].type!=ze.aH.save?this.formBuilderConfigModel[e].type!=ze.aH.request_release?this.formBuilderConfigModel[e].type!=ze.aH.in_review?this.formBuilderConfigModel[e].type!=ze.aH.restart_workflow?this.formBuilderConfigModel[e].type!=ze.aH.view_summery||this.goToSummery():this.goToFieldValidation():this.setInReview():this.acceptRequest():this.saveData():this.rejectRequest())},onInputValueChanges(e,t){this.updateLocalModel(e),this.updateImportJson(e)},updateLocalModel(e){this.formBuilderModel.hasOwnProperty(e)&&(this.formBuilderModel[e].value=this.formBuilderModel[e].formatted_value)},updateImportJson(e,t,s,o=""){try{const i=this.record.fields.find((t=>t.name===e));if(!i){this.record.fields.push({});const i=this.record.fields.length-1;return this.record.fields[i].name=e,this.record.fields[i].content=this.formBuilderModel[e].content,this.record.fields[i].formatted_value=this.formBuilderModel[e].formatted_value,this.record.fields[i].value=this.formBuilderModel[e].value,this.record.fields[i].original_value="",this.record.fields[i].validation_code="",this.record.fields[i].extraction_method=o,this.record.fields[i].is_validated=!0,this.record.fields[i].is_valid=!0,this.record.fields[i].color=ze.aH.success_border_left,!0===this.formBuilderModel[this.connectionId].multi_line?this.record.fields[i].multi_line=!0:this.record.fields[i].multi_line=!1,t&&(this.record.fields[i].coords=t),s&&(this.record.fields[i].page=s),void this.$emit("checkFieldInvalid",this.record.fields[i])}i.hasOwnProperty("original")||(i["original"]=Object.assign({},i)),i.hasOwnProperty("original_value")||(i["original_value"]=i.value),(t||null===t)&&(i.coords=t),s&&(i.page=s),o&&(i.extraction_method=o),i.is_valid=!0,i.is_validated=!0;let a=this.formBuilderModel[e];i.formatted_value=a.formatted_value,i.value=a.value?a.value:a.formatted_value,i.content=a.content,a.hasOwnProperty("api_save")&&a.api_save||(i.value=a.formatted_value),((0,ye.z)(i.formatted_value)||(0,ye.jw)(i.formatted_value))&&(i.content=i.formatted_value),this.formBuilderModel[this.connectionId]&&this.formBuilderModel[this.connectionId].hasOwnProperty("multi_line")&&!0===this.formBuilderModel[this.connectionId].multi_line?i.multi_line=!0:i.multi_line=!1,this.formBuilderModel[e].is_valid=i.is_valid,this.formBuilderModel[e].is_validated=i.is_validated,this.$emit("checkFieldInvalid",i)}catch(i){}},setApiData(e){this.record=e,this.$forceUpdate()},windowResize(){setTimeout((()=>{let e=Ue("#image_container");this.imageWidth=e.offsetWidth,this.imageHeight=e.offsetHeight,this.refreshAnnotationView++}),20)},currentPage(){return this.page},prevImage(){let e=this.page-1,t=this.getImagePath(e);this.updateImage(e,t)},nextImage(){let e=this.page+1,t=this.getImagePath(e);this.updateImage(e,t)},getImagePath(e){let t="";for(const[s,o]of Object.entries(this.images)){let s=o;s.pageNumber===e&&(t=s.path)}return t},updateImage(e,t){t&&""!==t&&(this.image=this.baseUrl+"/"+(0,Ce.v)(t),this.page=e)},handleImageBaseURL(){this.record.images[0]&&this.record.images[0].path.match(/doc2/g)&&(this.baseUrl=ue.VA)},updateApiData(e){e.detail&&(this.record=e.detail)},saveData(){return Ke(this,void 0,void 0,(function*(){if(!this.isReadOnly){if(!this.validateData())return!1;try{this.showLoading();const e=yield this.saveDocument(this.docId);if(!1===e.success)return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void this.showErrorToast(e.message);this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),this.assign_user_error=!1}catch(e){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}return!0}}))},validateData(){let e=!0;return(0,ye.z)(this.record.assigned_to)&&(0,ye.z)(this.record.assigned_to_group_id)&&(this.showErrorToast(this.$t("pages.messages.ASSIGN_USER_TO_PROCEED")),this.assign_user_error=!0,e=!1),e},setInReview(){return Ke(this,void 0,void 0,(function*(){try{if(this.isReadOnly)return;this.showLoading(),yield this.saveData(),yield this.setDocumnetStatus(ze.aH.in_review),this.$router.push("/dashboard")}catch(e){const t=fe.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.hideLoading()}}))},setDocumnetStatus(e){return Ke(this,void 0,void 0,(function*(){try{const t=yield Ie.M8.set_document_status(this.docId,{status:e});if(!1===t.success)throw{message:t.message};this.showSuccessToast(this.$t("pages.messages.MSG_SAVE"))}catch(t){const e=fe.t.getErrorMessage(t);this.showErrorToast(e)}}))},goToFieldValidation(){return Ke(this,void 0,void 0,(function*(){try{if(this.isReadOnly)return;this.showLoading(),yield this.saveData(),yield this.setDocumnetStatus(ze.aH.ready_for_validation),this.$router.push("/field_validation_v1/"+this.docId)}catch(e){const t=fe.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.hideLoading()}}))},goToSummery(){return Ke(this,void 0,void 0,(function*(){if(this.validateChargesData()){try{if(this.showLoading(),!(yield this.saveData()))return}catch(e){const t=fe.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.hideLoading()}this.$router.push("/summary/"+this.docId)}}))},acceptRequest(){if(!this.validateChargesData())return;let e=this.images.length,t=this.getImagePath(e);if(this.updateImage(e,t),this.page===this.images.length){let e="de"===this.locale?"approved_stamp_de":"approved_stamp_en";this.$refs.child_comp.addStampAnnotation(e)}this.record.first_approver=this.record.assigned_to,this.updateRequest("approve")},rejectRequest(){this.second_approval||delete this.record.first_approver,this.updateRequest("reject")},updateRequest(e){return Ke(this,void 0,void 0,(function*(){try{if(this.isReadOnly)return;if(!this.validateData())return;this.showLoading();const t={request_type:e},s=yield this.approveOrRejectDocument(this.docId,t);if(!1===s.success)throw{message:s.message};this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),this.$router.push("/dashboard")}catch(t){const e=fe.t.getErrorMessage(t);this.showErrorToast(e)}finally{this.hideLoading()}}))},addNewLog(e){e&&e.detail&&this.renderDocumentLog()},renderDocumentLog(){return Ke(this,void 0,void 0,(function*(){try{yield this.getDocumentLogs()}catch(e){}finally{this.hideLoading()}}))},getDocumentLogs(){return Ke(this,void 0,void 0,(function*(){let e;this.doc_logs={};let t=new FormData;t.append("action_type","message"),t.append("org_id",(0,Se.I)());let s=yield(0,ue.L3)();if(e=yield ne.A.post(ue.FH.get_document_log+this.docId,t,{headers:{Authorization:s}}),!e.data)throw{message:"no logs from server"};e.data.forEach((e=>{this.doc_logs[e.id.toString()+"_ID"]=e}))}))},downloadFile(){try{let e=ue.VA+"/resource/document/"+this.docId+"/"+this.docId+".pdf?"+this.tokenQueryParam;if(!e)return;fetch(e).then((e=>e.blob())).then((e=>{const t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=this.record.filename,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)})).catch((e=>{}))}catch(e){}},routeToListPendingApproval(){this.removeDashboardFilters(),this.$router.push("/dashboard")},renderPendingRecordsCountView(){return Ke(this,void 0,void 0,(function*(){try{let e,t="?filter=current-year&skip=0&limit=100&status="+this.filter_status,s=yield(0,ue.L3)();if(e=yield ne.A.get((0,Se.MV)(ue.FH.get_dashboard_data+t),{headers:{Authorization:s}}),!e.data.documents)throw{message:"no pending documents from server"};this.pending_approval_doc_count=e.data.documents.length,this.pending_approval_doc_count<0&&(this.pending_approval_doc_count=0)}catch(e){}finally{this.hideLoading()}}))},renderNextPrevLinkBtns(){return Ke(this,void 0,void 0,(function*(){try{let e,t=yield(0,ue.L3)();if(e=yield ne.A.get((0,Se.MV)(ue.FH.get_next_document+this.docId+"?doc_type="+this.record.doc_type+"&status="+this.filter_status+"&sort_attr=created_on"),{headers:{Authorization:t}}),!1===e.data.success)throw{message:"cannot get response related to next or prev record"};e.data.has_next&&e.data.next_id&&(this.next_record=e.data.next_id),e.data.has_previous&&e.data.previous_id&&(this.prev_record=e.data.previous_id)}catch(e){}finally{this.hideLoading()}}))},checkValidStatus(){(0,ye.jw)(this.doc_status)||this.doc_status!==this.filter_status&&this.doc_status!==ze.aH.in_review&&this.doc_status!==ze.aH.approved_pending_second_approval&&(this.error=!0,this.error_message="invalid_status")},routeTo(e){let t="ready-for-approval";this.second_approval&&(t="ready-for-second-approval"),"prev"===e&&this.prev_record&&this.$router.push({path:"/"+t+"/"+this.prev_record,replace:!0}),"next"===e&&this.next_record&&this.$router.push("/"+t+"/"+this.next_record)},updateValue(e,t){"font"==e?this.selectFont=t:"color"==e?this.selectColor=t:"size"==e&&(this.selectFontSize=t)},stampAddClicked(){this.$refs.child_comp.addTemplateAnnotation(this.selectedStamp)},getApprovalInfoObj(e){const t=e.lineFieldValue?e.lineFieldValue:0,s=e.poFieldValue?e.poFieldValue:0;let o=0,i=0;return e.status==ze.qS.approved&&(o=t,i=0),e.status==ze.qS.rejected&&(o=s,i=t-s),{approval_required:!0,approval_status:e.status,approved_or_rejected_by:e.currentUserId,approved_or_rejected_at:e.currentDateTime,approved_amount:o,rejected_amount:i}},makeModel(){return new Promise(((e,t)=>{let s={};if(void 0!==this.record){this.record.fields.forEach(((e,t)=>{s[e.name]=e})),s["first_approver"]=this.fillFirstApprover(),s["assigned_to"]=this.createEmptyField("assigned_to","",this.record.assigned_to);let e=this.getUpdatedFieldSettings();for(let[t,o]of this.formLayout.entries()){let t=o.hasOwnProperty("field_name")?o.field_name:o.name;e.hasOwnProperty(t)&&(o=Object.assign(o,this.cleanLayoutSettings(e[t]))),this.prepareModel(o,s[t],t)}this.$forceUpdate()}e("done")}))},makeModel_v2(){return new Promise(((e,t)=>{let s={};if(void 0!==this.record){this.record.fields.forEach(((e,t)=>{s[e.name]=e})),this.handleChargesGroupValidation(s),s["first_approver"]=this.fillFirstApprover(),s["assigned_to"]=this.createEmptyField("assigned_to","",this.record.assigned_to);let e=this.getUpdatedFieldSettings();for(let[t,o]of this.formLayout.entries())for(let i of o.rows){let t=i.hasOwnProperty("field_name")?i.field_name:i.name;e.hasOwnProperty(t)&&(i=Object.assign(i,this.cleanLayoutSettings(e[t]))),this.prepareModel(i,s[t],t)}this.$forceUpdate()}e("done")}))},handleChargesGroupValidation(e){for(let[t,s]of this.formLayout.entries())if(s.name==ze.P.charges){for(let t=0;t<s.rows.length;t+=3){let o=s.rows[t].field_name,i=s.rows[t+1].field_name;if(!e.hasOwnProperty(o)||!e.hasOwnProperty(i))continue;e[i].input_error="invalid-input";const a={status:ze.qS.pending,currentUserId:null,currentDateTime:null,lineFieldValue:Number(e[i].value),poFieldValue:Number(e[o].value)};e[i]["approval_info"]=this.getApprovalInfoObj(a)}break}},prepareModel(e,t,s){t||(t=this.createEmptyField(s,e.input_type));let o=e.input_type?e.input_type:e.fieldType;o&&(e.hasOwnProperty("tabIndex")&&!(0,ye.z)(e.tabIndex)||(e.tabIndex=0),this.formBuilderModel[s]={},this.formBuilderConfigModel[s]={},this.formBuilderModel[s]=Object.assign({},t),this.formBuilderConfigModel[s]=Object.assign({},e),t.hasOwnProperty("is_required")&&(this.formBuilderConfigModel[s].is_required=t.is_required),"first_approver"==s&&this.second_approval&&(this.formBuilderConfigModel[s].translation_key="first_approver"))},cleanLayoutSettings(e){return delete e.name,delete e.field,delete e.field_name,delete e.field_type,delete e.title,delete e.translation_key,delete e.is_readonly,e},getFormBuilderLayout(){return Ke(this,void 0,void 0,(function*(){let e;this.formLayout=[];try{if(!this.layout_template_id)return;e=yield Ie.H7.getDocumentLayoutTemplateById(this.layout_template_id);let t=JSON.parse(e.layout_json);t&&(this.formLayout=t.hasOwnProperty("layout")?t.layout:[],this.formLayout&&(this.model[ze.WE]?yield this.makeModel_v2():yield this.makeModel()))}catch(t){return void this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}}))},getUpdatedFieldSettings(){let e={},t=JSON.parse(JSON.stringify(this.record.layout.groups));return t.forEach(((t,s)=>{t.rows.forEach(((t,s)=>{t.forEach(((t,s)=>{let o=t.field_name;e[o]=t}))}))})),e},updateModel(e){},restoreBeforeLeave(){this.record={},this.error=!1,this.error_message="",this.doc_status="",this.page=1},getReadOnlyStatus(e){return!!e.startsWith("tab_panel_tables_")||this.isReadOnly},validateChargesData(){return this.validatePOMathAprrovalSatus()},validatePOMathAprrovalSatus(){let e=!1;if(!this.record.po_multi_matched||0==this.record.po_multi_matched.length)return!0;for(let[t,s]of this.record.po_multi_matched.entries())if(e=s.hasOwnProperty("sub_lines")?this.multiPoToOneLine(s):(s.hasOwnProperty("table_lines"),this.onePoToOneLine(s)),!e){this.showErrorToast(this.$t("pages.messages.VALIDATION_REQUIRED_FOR_TABLE"));break}return e},multiPoToOneLine(e){let t=!1;for(const s of e.sub_lines)if(t=this.onePoToOneLine(s),!t)break;return t},onePoToOneLine(e){let t=!0;if(e.approval_info&&Object.entries(e.approval_info).length>0)for(const[s,o]of Object.entries(e.approval_info))if(o.approval_required&&!o.approval_status){t=!1;break}if(!e.additional_charges||0==e.additional_charges.length)return t;for(let s of e.additional_charges)s.approval_info&&s.approval_info.approval_required&&!s.approval_info.approval_status&&(t=!1);return t},validatePageNumber(){this.page?(this.page>this.images.length&&(this.page=this.images.length),this.pageChanged(this.page)):this.page=1},pageChanged(e){!e||0==e||e>this.lastPageItem||this.updateImage(e,(0,Ce.v)(this.record.images[e-1].path))},goToDashboard(){this.$router.push("/dashboard")}},setup(){const e=(0,ge.A)();let t=[];const s=(0,Ve.cY)();let{locale:o}=(0,Qe.s9)({useScope:"global"});const i=(0,Ve.q3)(),{approveOrRejectDocument:a,getDocumentById:r,getDocAnnotations:l,saveDocument:n,getLayoutTemplateID:d}=i,{record:c,doc_status:h,error:u,error_message:p,page:m,layout_template_id:g}=(0,de.bP)(i),_=(0,Ve.fX)(),{removeSavedFilters:v,saveFilters:f}=_,y=(0,Ve._6)(),{tokenQueryParam:w}=(0,de.bP)(y);y.getTokenQueryParam();const b=(0,Ve.uL)(),{second_approval:k,formBuilderModel:L,formLayout:F,formBuilderConfigModel:C}=(0,de.bP)(b),A=(0,Ve.wt)(),{model:I}=(0,de.bP)(A),{getDocTypeSettings:S}=A;return{locale:(0,he.KR)(o),model:I,saveDocument:n,getDocumentById:r,getDocAnnotations:l,getDocTypeSettings:S,getLayoutTemplateID:d,savedDashboardFilters:f,removeDashboardFilters:v,approveOrRejectDocument:a,approve_before_export:ze.Lw,tokenQueryParam:w,doc_status:h,page:m,error:u,error_message:p,record:c,dropdownStore:s,image:"",images:t,baseUrl:ue.VA,isReadOnly:!1,usersList:(0,he.KR)([]),assign_user_error:(0,he.KR)(!1),doc_logs:(0,he.KR)({}),pending_approval_doc_count:(0,he.KR)(0),next_record:(0,he.KR)(""),prev_record:(0,he.KR)(""),second_approval:k,showNotification(t){e.notify({message:t,color:"primary",position:"top"})},showFontMenu:(0,he.KR)(!0),showStampMenu:(0,he.KR)(!1),selectColor:(0,he.KR)("#000000"),selectFont:(0,he.KR)("Helvetica"),fontlist:["Helvetica","Times New Roman","Arimo","Caladea","Carlito","Cousine","Liberation Serif","Arial"],selectFontSize:(0,he.KR)(20),fontSizes:[],showDoc:(0,he.KR)(!1),selectedStamp:(0,he.KR)(""),screenmode:(0,he.KR)("annotate"),formLayout:F,formBuilderModel:L,layout_template_id:g,formBuilderConfigModel:C}}});var He=s(12807),Ne=s(50492),Xe=s(56384),We=s(98072),Ge=s(97410),Je=s(10386),Ye=s(67837),Ze=s(13718),et=s(82156),tt=s(23316),st=s(18670),ot=s(93676),it=s(44189),at=s(57092),rt=s(36914),lt=s(84436),nt=s(53999),dt=s(90124),ct=s(25173),ht=s(1444),ut=s(67156),pt=s(42315),mt=s(88672),gt=s(98582),_t=s.n(gt);const vt=(0,He.A)(je,[["render",le],["__scopeId","data-v-e0b0af30"]]),ft=vt;_t()(je,"components",{QIcon:Ne.A,QBtn:Xe.A,QSplitter:We.A,QTooltip:Ge.A,QSeparator:Je.A,QInput:Ye.A,QPageSticky:Ze.A,QDialog:et.A,QCard:tt.A,QBar:st.A,QSpace:ot.A,QCardSection:it.A,QFooter:at.A,QToolbar:rt.A,QMenu:lt.A,QList:nt.A,QItem:dt.A,QItemSection:ct.A,QSlider:ht.A,QField:ut.A,QTable:pt.A}),_t()(je,"directives",{ClosePopup:mt.A})}}]);