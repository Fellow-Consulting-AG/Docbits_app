"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[6735],{16735:(e,t,o)=>{o.r(t),o.d(t,{default:()=>ms});var s=o(61758),l=o(58790);const i={class:"container page-height-limit"},a={style:{width:"100%"}},r={style:{"margin-top":"3px"}},n={style:{"margin-top":"3px"}},d={style:{"margin-top":"3px"}};function c(e,t,o,c,u,m){const p=(0,s.g2)("SubHeader"),_=(0,s.g2)("BackToSettings"),h=(0,s.g2)("q-separator"),g=(0,s.g2)("q-icon"),f=(0,s.g2)("q-space"),b=(0,s.g2)("PageRestriction"),v=(0,s.g2)("q-card-section"),k=(0,s.g2)("q-card"),y=(0,s.g2)("q-expansion-item"),w=(0,s.g2)("FtpImportList"),L=(0,s.g2)("EmailImportList"),E=(0,s.g2)("q-list");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(p,{name:"import_settings",label:e.$t("Import"),onSearch:!1},null,8,["label"]),(0,s.bF)(_),(0,s.Lk)("div",i,[(0,s.Lk)("div",a,[(0,s.Lk)("div",null,[(0,s.bF)(E,{bordered:"",class:"rounded-borders"},{default:(0,s.k6)((()=>[(0,s.bF)(y,{"expand-separator":"","header-class":"highlighted-back","default-opened":""},{header:(0,s.k6)((()=>[(0,s.bF)(g,{size:"25px",class:"q-mr-lg black_to_white",name:"img:settings/doc.svg"}),(0,s.Lk)("span",r,(0,l.v_)(e.$t("pages.import.email_import")),1),(0,s.bF)(f)])),default:(0,s.k6)((()=>[(0,s.bF)(h),(0,s.bF)(k,{class:"page-background"},{default:(0,s.k6)((()=>[(0,s.bF)(v,null,{default:(0,s.k6)((()=>[(0,s.bF)(b)])),_:1})])),_:1})])),_:1}),(0,s.bF)(y,{"expand-separator":"","header-class":"highlighted-back","default-opened":""},{header:(0,s.k6)((()=>[(0,s.bF)(g,{size:"25px",class:"q-mr-lg black_to_white",name:"img:settings/email-import.svg"}),(0,s.Lk)("span",n,(0,l.v_)(e.$t("ftp_import")),1),(0,s.bF)(f)])),default:(0,s.k6)((()=>[(0,s.bF)(h),(0,s.bF)(k,{class:"page-background"},{default:(0,s.k6)((()=>[(0,s.bF)(v,null,{default:(0,s.k6)((()=>[(0,s.bF)(w)])),_:1})])),_:1})])),_:1}),(0,s.bF)(y,{"expand-separator":"","header-class":"highlighted-back","default-opened":""},{header:(0,s.k6)((()=>[(0,s.bF)(g,{size:"25px",class:"q-mr-lg black_to_white",name:"img:settings/email-import.svg"}),(0,s.Lk)("span",d,(0,l.v_)(e.$t("pages.settings.email_import")),1),(0,s.bF)(f)])),default:(0,s.k6)((()=>[(0,s.bF)(h),(0,s.bF)(k,{class:"page-background"},{default:(0,s.k6)((()=>[(0,s.bF)(v,null,{default:(0,s.k6)((()=>[(0,s.bF)(L)])),_:1})])),_:1})])),_:1})])),_:1})])])])],64)}var u=o(91236),m=o(60894);const p={class:"import-container q-pa-xl"},_={class:"row"},h={style:{width:"30%",margin:"auto","padding-right":"5%"}},g={style:{width:"30%"}},f=(0,s.Lk)("div",{style:{width:"40%",margin:"auto","padding-left":"5%"}},null,-1),b={class:"row q-py-sm"},v={style:{width:"30%",margin:"auto","padding-right":"5%"}},k={style:{width:"30%"}},y=(0,s.Lk)("div",{style:{width:"40%"}},null,-1),w={class:"row"},L={style:{width:"30%",margin:"auto","padding-right":"5%"}},E={style:{width:"30%"}},F=(0,s.Lk)("div",{style:{width:"40%"}},null,-1);function C(e,t,o,i,a,r){const n=(0,s.g2)("q-tooltip"),d=(0,s.g2)("q-input"),c=(0,s.g2)("q-select");return(0,s.uX)(),(0,s.CE)("div",p,[(0,s.Lk)("div",_,[(0,s.Lk)("div",h,(0,l.v_)(e.$t("restrict_to_pages")),1),(0,s.Lk)("div",g,[(0,s.bF)(d,{outlined:"",dense:"","data-cy":"restrict_to_pages",tabindex:"0",type:"number",class:(0,l.C4)("full-width back-white"),modelValue:e.user_settings["RESTRICT_TO_PAGES"],"onUpdate:modelValue":[t[0]||(t[0]=t=>e.user_settings["RESTRICT_TO_PAGES"]=t),t[1]||(t[1]=t=>{e.saveSettings("RESTRICT_TO_PAGES",t)})]},{default:(0,s.k6)((()=>[(0,s.bF)(n,null,{default:(0,s.k6)((()=>[(0,s.eW)(" Only process given number of pages every further page will be ignored. ")])),_:1})])),_:1},8,["modelValue"])]),f]),(0,s.Lk)("div",b,[(0,s.Lk)("div",v,(0,l.v_)(e.$t("payment_terms_days")),1),(0,s.Lk)("div",k,[(0,s.bF)(d,{outlined:"",dense:"","data-cy":"payment_terms_days",tabindex:"0",type:"number",class:(0,l.C4)("full-width back-white"),modelValue:e.user_settings["PAYMENT_TERMS_DAYS"],"onUpdate:modelValue":[t[2]||(t[2]=t=>e.user_settings["PAYMENT_TERMS_DAYS"]=t),t[3]||(t[3]=t=>{e.saveSettings("PAYMENT_TERMS_DAYS",t)})]},null,8,["modelValue"])]),y]),(0,s.Lk)("div",w,[(0,s.Lk)("div",L,(0,l.v_)(e.$t("date_pattern")),1),(0,s.Lk)("div",E,[(0,s.bF)(c,{outlined:"",dense:"",class:"back-white","data-cy":"date_pattern",modelValue:e.user_settings["DATE_PATTERN"],"onUpdate:modelValue":[t[4]||(t[4]=t=>e.user_settings["DATE_PATTERN"]=t),t[5]||(t[5]=t=>{e.saveSettings("DATE_PATTERN",t)})],options:[{label:e.$t("select"),value:""},{label:"%d/%m/%Y",value:"%d/%m/%Y"},{label:"%d.%m.%Y",value:"%d.%m.%Y"},{label:"%m %d, %Y",value:"%m %d, %Y"},{label:"%Y %m, %d",value:"%Y %m, %d"}],"emit-value":"","map-options":"",label:e.$t("date_pattern")},null,8,["modelValue","options","label"])]),F])])}var A=o(1659),R=o(24622),D=o(38734),S=o(94124),q=o(18505),$=function(e,t,o,s){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,i){function a(e){try{n(s.next(e))}catch(t){i(t)}}function r(e){try{n(s["throw"](e))}catch(t){i(t)}}function n(e){e.done?o(e.value):l(e.value).then(a,r)}n((s=s.apply(e,t||[])).next())}))};const T=(0,s.pM)({mixins:[q.A,R.A],methods:{saveSettings(e,t){return $(this,void 0,void 0,(function*(){if(e){this.showLoading();try{yield this.updateSetting(e,t)}catch(o){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}}))}},setup(){const e=(0,S.Bu)(),{user_settings:t}=(0,A.bP)(e),{updateSetting:o}=e;return{user_settings:t,updateSetting:o}},data(){return{userDialog:(0,D.KR)(!1),api_key:""}}});var O=o(12807),V=o(67837),x=o(97410),I=o(94940),Q=o(98582),K=o.n(Q);const M=(0,O.A)(T,[["render",C]]),W=M;K()(T,"components",{QInput:V.A,QTooltip:x.A,QSelect:I.A});var P=o(29104);const X={class:"container q-pa-xl"},U={class:"row",style:{"margin-bottom":"15px"}},N={style:{width:"20%",margin:"auto"}},Y={style:{width:"80%"}},z={class:"row"},j={key:0,class:"cursor-default"},B={key:1},J={class:"row float-right"},G={class:"text-red-14"},H=(0,s.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1);function Z(e,t,o,i,a,r){const n=(0,s.g2)("f-btn"),d=(0,s.g2)("ImportLogs"),c=(0,s.g2)("q-th"),u=(0,s.g2)("q-tr"),m=(0,s.g2)("q-item-section"),p=(0,s.g2)("q-item"),_=(0,s.g2)("q-separator"),h=(0,s.g2)("q-list"),g=(0,s.g2)("q-menu"),f=(0,s.g2)("q-btn"),b=(0,s.g2)("q-td"),v=(0,s.g2)("q-table"),k=(0,s.g2)("q-inner-loading"),y=(0,s.g2)("EditCreate"),w=(0,s.g2)("q-dialog"),L=(0,s.g2)("ConnectionLogs");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",X,[(0,s.Lk)("div",U,[(0,s.Lk)("div",N,(0,l.v_)(e.$t("pages.import.email")),1),(0,s.Lk)("div",Y,[(0,s.eW)((0,l.v_)(e.$t("pages.import.email_info"))+" ",1),(0,s.Lk)("a",{onClick:t[0]||(t[0]=(...t)=>e.webSiteLink&&e.webSiteLink(...t)),class:"cursor-pointer color-primary",target:"_blank"},(0,l.v_)(e.$t("pages.import.email_link")),1)]),(0,s.bF)(n,{class:"q-ml-auto",icon:"add",label:e.$t("new"),onClick:e.createNewRecord},null,8,["label","onClick"]),(0,s.bF)(d,{setheight:"36px"})]),(0,s.Lk)("div",z,[(0,s.bF)(v,{"no-data-label":e.$t("pages.messages.no_record_found"),style:{width:"100%",height:"100%"},class:"dashboard-table-style back-white",rows:e.rows,columns:e.columns,"row-key":"name",flat:"","rows-per-page-options":[0],id:"email_import_table"},{header:(0,s.k6)((t=>[(0,s.bF)(u,{props:t},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.cols,((o,i)=>((0,s.uX)(),(0,s.Wv)(c,{key:o.name,props:t,"data-index":i,draggable:e.canDragDropColumn(o),dropzone:e.canDragDropColumn(o),direction:"horizontal",onDragstart:t=>e.onDragStart(t,e.columns,i),onDrop:(0,P.D$)((t=>e.handleDrop(t,i)),["prevent"]),onDragover:(0,P.D$)((t=>e.onDragOver(t,i)),["prevent"]),onDragenter:(0,P.D$)(e.onDragEnter,["prevent"]),onDragleave:(0,P.D$)(e.onDragLeave,["prevent"]),style:(0,l.Tr)({cursor:e.getIsDragging?"pointer":"move"})},{default:(0,s.k6)((()=>["action"==o.name?((0,s.uX)(),(0,s.CE)("span",j,(0,l.v_)(o.label),1)):((0,s.uX)(),(0,s.CE)("span",B,(0,l.v_)(o.label),1))])),_:2},1032,["props","data-index","draggable","dropzone","onDragstart","onDrop","onDragover","onDragenter","onDragleave","style"])))),128))])),_:2},1032,["props"])])),body:(0,s.k6)((o=>[(0,s.bF)(u,{props:o,id:o.key},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.cols,(i=>((0,s.uX)(),(0,s.CE)(s.FK,{key:i.name},["action"===i.name?((0,s.uX)(),(0,s.Wv)(b,{key:0,style:{width:"350px"}},{default:(0,s.k6)((()=>[(0,s.Lk)("div",J,[(0,s.bF)(f,{flat:"",dense:"",round:"",onClick:t[1]||(t[1]=(0,P.D$)((()=>{}),["stop","prevent"])),icon:"more_horiz"},{default:(0,s.k6)((()=>[(0,s.bF)(g,{"auto-close":"","transition-show":"jump-down","transition-hide":"jump-up",anchor:"bottom middle",self:"top middle"},{default:(0,s.k6)((()=>[(0,s.bF)(h,{dense:"",style:{"min-width":"100px"}},{default:(0,s.k6)((()=>["IMAP"===o.row.protocol||"POP3"===o.row.protocol?((0,s.uX)(),(0,s.Wv)(p,{key:0,clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(m,{onClick:t=>e.checkLogin(o.row)},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("test_connection")),1)])),_:2},1032,["onClick"])])),_:2},1024)):(0,s.Q3)("",!0),(0,s.bF)(p,{clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(m,{onClick:t=>e.showMailConnectionLogs(o.row.id)},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.import.connection_logs")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,s.bF)(_,{inset:""}),(0,s.bF)(p,{clickable:""},{default:(0,s.k6)((()=>[o.row.is_active?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(m,{key:0,onClick:t=>{o.row.is_active=!0,e.de_activateEmail(o.row)}},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("activate")),1)])),_:2},1032,["onClick"])),o.row.is_active?((0,s.uX)(),(0,s.Wv)(m,{key:1,onClick:t=>{o.row.is_active=!1,e.de_activateEmail(o.row)}},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("deactivate")),1)])),_:2},1032,["onClick"])):(0,s.Q3)("",!0)])),_:2},1024),(0,s.bF)(p,{clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(m,{onClick:t=>e.editRow(o.rowIndex,o.row)},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("edit")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,s.bF)(_,{inset:""}),(0,s.bF)(p,{clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(m,{onClick:t=>e.deleteClicked(o.rowIndex,o.row.id)},{default:(0,s.k6)((()=>[(0,s.Lk)("span",G,(0,l.v_)(e.$t("delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])])),_:2},1024)):"sub_org_id"===i.name?((0,s.uX)(),(0,s.Wv)(b,{key:1,class:(0,l.C4)(o.row.is_active?"":"email-import-deactive-column")},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.sub_orgs_flattened[o.row[i.name]]),1)])),_:2},1032,["class"])):((0,s.uX)(),(0,s.Wv)(b,{key:2,class:(0,l.C4)(1==o.row.is_active?"":"email-import-deactive-column")},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)("null"===o.row[i.name]?"":o.row[i.name]),1)])),_:2},1032,["class"]))],64)))),128))])),_:2},1032,["props","id"])])),_:1},8,["no-data-label","rows","columns"])])]),(0,s.bF)(k,{showing:e.loading,class:"z-index-1",style:{"z-index":"1000"}},{default:(0,s.k6)((()=>[H])),_:1},8,["showing"]),(0,s.bF)(w,{modelValue:e.show_edit_create,"onUpdate:modelValue":t[2]||(t[2]=t=>e.show_edit_create=t),persistent:"",onKeydown:t[3]||(t[3]=(0,P.jR)((t=>e.show_edit_create=!1),["esc"]))},{default:(0,s.k6)((()=>[(0,s.bF)(y,{selected_model:e.selected_row,api_key:e.api_key},null,8,["selected_model","api_key"])])),_:1},8,["modelValue"]),(0,s.bF)(w,{modelValue:e.show_connection_logs,"onUpdate:modelValue":t[4]||(t[4]=t=>e.show_connection_logs=t)},{default:(0,s.k6)((()=>[(0,s.bF)(L,{connection_id:e.connection_id,connection_type:e.connection_type},null,8,["connection_id","connection_type"])])),_:1},8,["modelValue"])],64)}var ee=o(10739),te=o(11470),oe=o(64775);const se={key:0,class:"text-weight-bold"},le={key:1,class:"text-weight-bold"},ie={class:"row q-mt-md"},ae={class:"col-2"},re={class:"col-7"},ne={class:"col-3"},de={class:"row q-mt-md"},ce={class:"col-2"},ue={class:"col-7"},me={class:"col-3"},pe={class:"row q-mt-md"},_e=(0,s.Lk)("div",{class:"col-2"},null,-1),he={class:"col-7"},ge={key:0,class:"col-3"},fe={style:{"margin-top":"8px"}},be={class:"row q-mt-md"},ve=(0,s.Lk)("div",{class:"col-2"},null,-1),ke={class:"col-7"},ye={class:"col-3"},we={class:"col-3"},Le={style:{"margin-top":"8px"}},Ee={class:"row q-mt-md"},Fe=(0,s.Lk)("div",{class:"col-2"},null,-1),Ce={class:"col-7"},Ae=(0,s.Lk)("div",{class:"col-3"},null,-1),Re={class:"row q-mt-md"},De=(0,s.Lk)("div",{class:"col-2"},null,-1),Se={class:"col-7"},qe=(0,s.Lk)("div",{class:"col-3"},null,-1),$e={class:"row q-mt-md"},Te={class:"col-2"},Oe={key:0,class:"col-7"},Ve={class:"col-3"},xe={class:"row q-mt-md"},Ie=(0,s.Lk)("div",{class:"col-2"},null,-1),Qe={class:"col-3"},Ke={class:"col-1"},Me=(0,s.Lk)("div",{class:"col-3"},null,-1),We={key:0,class:"row q-mt-md"},Pe=(0,s.Lk)("div",{class:"col-2"},null,-1),Xe={class:"col-7"},Ue={class:"row"},Ne={class:"col-4"},Ye={style:{"margin-top":"8px"}},ze={class:"col"},je=(0,s.Lk)("div",{class:"col-3"},null,-1),Be={key:1,class:"row q-mt-md"},Je=(0,s.Lk)("div",{class:"col-2"},null,-1),Ge={class:"col-7"},He={class:"row"},Ze={class:"col-4"},et={style:{"margin-top":"8px"}},tt={class:"col"},ot=(0,s.Lk)("div",{class:"col-3"},null,-1),st={key:2,class:"row q-mt-md"},lt=(0,s.Lk)("div",{class:"col-2"},null,-1),it={class:"col-7"},at={class:"row"},rt={class:"col-6"},nt={style:{"margin-top":"8px"}},dt={class:"col"},ct=(0,s.Lk)("div",{class:"col-3"},null,-1),ut={class:"row q-mt-md"},mt=(0,s.Lk)("div",{class:"col-2"},null,-1),pt=(0,s.Lk)("div",{class:"col-6"},null,-1),_t={class:"col-4"},ht=(0,s.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1);function gt(e,t,o,i,a,r){const n=(0,s.g2)("q-toolbar-title"),d=(0,s.g2)("q-btn"),c=(0,s.g2)("q-toolbar"),u=(0,s.g2)("q-tooltip"),m=(0,s.g2)("q-icon"),p=(0,s.g2)("q-select"),_=(0,s.g2)("q-input"),h=(0,s.g2)("q-toggle"),g=(0,s.g2)("q-card-section"),f=(0,s.g2)("f-btn"),b=(0,s.g2)("q-inner-loading"),v=(0,s.g2)("q-card"),k=(0,s.gN)("close-popup");return(0,s.uX)(),(0,s.Wv)(v,{style:{width:"1200px","max-width":"1200px",height:"600px"}},{default:(0,s.k6)((()=>[(0,s.Lk)("form",{onSubmit:t[26]||(t[26]=(0,P.D$)(((...t)=>e.submitFrom&&e.submitFrom(...t)),["prevent","stop"]))},[(0,s.bF)(c,{class:"text-white secondary-toolbar"},{default:(0,s.k6)((()=>[(0,s.bF)(n,null,{default:(0,s.k6)((()=>[e.row_id?((0,s.uX)(),(0,s.CE)("span",se,(0,l.v_)(e.$t("pages.settings.master_data_lookup.edit_row")),1)):((0,s.uX)(),(0,s.CE)("span",le,(0,l.v_)(e.$t("pages.settings.master_data_lookup.create_row")),1))])),_:1}),(0,s.bo)((0,s.bF)(d,{flat:"",round:"",dense:"",icon:"close"},null,512),[[k]])])),_:1}),e.Office365_selected?((0,s.uX)(),(0,s.Wv)(g,{key:1},{default:(0,s.k6)((()=>[(0,s.Lk)("div",$e,[(0,s.Lk)("div",Te,[(0,s.bF)(p,{modelValue:e.model["protocol"],"onUpdate:modelValue":[t[13]||(t[13]=t=>e.model["protocol"]=t),e.protocolUpdated],outlined:"",options:e.protocols,label:e.$t("pages.import.protocol")},{append:(0,s.k6)((()=>[e.errors["protocol"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","options","label","onUpdate:modelValue"])]),e.loading||1!=e.ms_is_authenticated?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Oe,[(0,s.bF)(p,{class:"full q-ml-sm",outlined:"",clearable:"",modelValue:e.model["sub_org_id"],"onUpdate:modelValue":t[14]||(t[14]=t=>e.model["sub_org_id"]=t),"use-input":"",options:e.filterSubOrgsList,onFilter:e.filterSubOrgslistEvent,label:e.$t("sub_organizations"),loading:e.sub_org_list_loading,"emit-value":"","map-options":""},null,8,["modelValue","options","onFilter","label","loading"])])),(0,s.Lk)("div",Ve,[0==e.ms_authenticate&&0==e.ms_is_authenticated?((0,s.uX)(),(0,s.Wv)(f,{key:0,class:"q-ml-sm",appearance:"secondary",label:e.$t("pages.import.authenticate"),onClick:t[15]||(t[15]=t=>e.submitFrom()),style:{height:"56px"}},null,8,["label"])):1==e.ms_authenticate&&0==e.ms_is_authenticated?((0,s.uX)(),(0,s.Wv)(f,{key:1,class:"q-ml-sm",style:{height:"56px"},label:e.$t("pages.import.finish_authentication"),onClick:t[16]||(t[16]=t=>e.msfinish())},null,8,["label"])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",xe,[Ie,(0,s.Lk)("div",Qe,[1==e.ms_authenticate&&0==e.ms_is_authenticated?((0,s.uX)(),(0,s.Wv)(_,{key:0,modelValue:e.ms_code,"onUpdate:modelValue":t[17]||(t[17]=t=>e.ms_code=t),label:e.$t("pages.import.microsoft_code"),outlined:"",readonly:"",onClick:e.copyText,id:"mscode",style:{"margin-left":"10px",width:"90%"}},null,8,["modelValue","label","onClick"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Ke,[1==e.ms_authenticate&&0==e.ms_is_authenticated?((0,s.uX)(),(0,s.Wv)(f,{key:0,style:{"margin-left":"4px","margin-top":"8px"},icon:"fas fa-copy",onClick:e.copyText},null,8,["onClick"])):(0,s.Q3)("",!0)]),Me]),e.loading||1!=e.ms_is_authenticated?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",We,[Pe,(0,s.Lk)("div",Xe,[(0,s.Lk)("div",Ue,[(0,s.Lk)("div",Ne,[(0,s.bF)(h,{modelValue:e.use_folder,"onUpdate:modelValue":t[18]||(t[18]=t=>e.use_folder=t)},null,8,["modelValue"]),(0,s.Lk)("span",Ye,(0,l.v_)(e.$t("Use Folder")),1)]),(0,s.Lk)("div",ze,[1==e.use_folder&&""!=e.row_id?((0,s.uX)(),(0,s.Wv)(p,{key:0,modelValue:e.model["folder"],"onUpdate:modelValue":t[19]||(t[19]=t=>e.model["folder"]=t),label:e.$t("pages.import.folder"),options:e.folder_list,outlined:"","data-cy":"folder",style:{"margin-left":"10px"}},null,8,["modelValue","label","options"])):(0,s.Q3)("",!0)])])]),je])),e.loading||1!=e.ms_is_authenticated?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Be,[Je,(0,s.Lk)("div",Ge,[(0,s.Lk)("div",He,[(0,s.Lk)("div",Ze,[(0,s.bF)(h,{modelValue:e.use_email,"onUpdate:modelValue":t[20]||(t[20]=t=>e.use_email=t)},null,8,["modelValue"]),(0,s.Lk)("span",et,(0,l.v_)(e.$t("Use shared Mailbox")),1),(0,s.bF)(m,{name:"help",style:{"margin-top":"-8px","margin-left":"2px"}},{default:(0,s.k6)((()=>[(0,s.bF)(u,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("Seperate, shared Email-Adress you want to import from.")),1)])),_:1})])),_:1})]),(0,s.Lk)("div",tt,[1==e.use_email?((0,s.uX)(),(0,s.Wv)(_,{key:0,modelValue:e.model["shared_email"],"onUpdate:modelValue":t[21]||(t[21]=t=>e.model["shared_email"]=t),label:e.$t("pages.import.shared_email"),outlined:"","data-cy":"shared_email",style:{"margin-left":"10px"}},null,8,["modelValue","label"])):(0,s.Q3)("",!0)])])]),ot])),e.loading||1!=e.ms_is_authenticated?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",st,[lt,(0,s.Lk)("div",it,[(0,s.Lk)("div",at,[(0,s.Lk)("div",rt,[(0,s.bF)(h,{dense:"",style:{"margin-left":"5px","margin-right":"5px"},modelValue:e.model["delete_after_import"],"onUpdate:modelValue":t[22]||(t[22]=t=>e.model["delete_after_import"]=t)},null,8,["modelValue"]),(0,s.Lk)("span",nt,(0,l.v_)(e.$t("Move Emails to other folder")),1)]),(0,s.Lk)("div",dt,[1==e.model["delete_after_import"]?((0,s.uX)(),(0,s.Wv)(p,{key:0,modelValue:e.model["move_to_folder"],"onUpdate:modelValue":t[23]||(t[23]=t=>e.model["move_to_folder"]=t),label:e.$t("pages.import.folder"),options:e.folder_list,outlined:"","data-cy":"folder"},null,8,["modelValue","label","options"])):(0,s.Q3)("",!0)])])]),ct]))])),_:1})):((0,s.uX)(),(0,s.Wv)(g,{key:0},{default:(0,s.k6)((()=>[(0,s.Lk)("div",ie,[(0,s.Lk)("div",ae,[(0,s.bF)(p,{modelValue:e.model["protocol"],"onUpdate:modelValue":[t[0]||(t[0]=t=>e.model["protocol"]=t),e.protocolUpdated],outlined:"",options:e.protocols,label:e.$t("pages.import.protocol")},{append:(0,s.k6)((()=>[e.errors["protocol"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","options","label","onUpdate:modelValue"])]),(0,s.Lk)("div",re,[(0,s.bF)(_,{modelValue:e.model["server"],"onUpdate:modelValue":t[1]||(t[1]=t=>e.model["server"]=t),label:e.$t("pages.import.server"),outlined:"",class:(0,l.C4)("full q-ml-sm")},{append:(0,s.k6)((()=>[e.errors["server"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),(0,s.Lk)("div",ne,[(0,s.bF)(_,{modelValue:e.model["port"],"onUpdate:modelValue":t[2]||(t[2]=t=>e.model["port"]=t),label:e.$t("pages.import.port"),outlined:"","data-cy":"port",class:(0,l.C4)("full q-ml-sm")},{append:(0,s.k6)((()=>[e.errors["port"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])])]),(0,s.Lk)("div",de,[(0,s.Lk)("div",ce,[(0,s.bF)(p,{modelValue:e.model["encryption"],"onUpdate:modelValue":t[3]||(t[3]=t=>e.model["encryption"]=t),outlined:"","data-cy":"encryption",options:e.encryptions,class:(0,l.C4)("full-width "),label:e.$t("pages.import.encryption")},{append:(0,s.k6)((()=>[e.errors["encryption"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","options","label"])]),(0,s.Lk)("div",ue,[(0,s.bF)(_,{modelValue:e.model["username"],"onUpdate:modelValue":t[4]||(t[4]=t=>e.model["username"]=t),class:(0,l.C4)(["full q-ml-sm","full q-ml-sm"]),label:e.$t("pages.import.username"),outlined:"","data-cy":"username"},{append:(0,s.k6)((()=>[e.errors["username"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),(0,s.Lk)("div",me,["IMAP"==e.model["protocol"]&&""!=e.row_id?((0,s.uX)(),(0,s.Wv)(p,{key:0,modelValue:e.model["folder"],"onUpdate:modelValue":t[5]||(t[5]=t=>e.model["folder"]=t),label:e.$t("pages.import.folder"),options:e.folder_list,outlined:"","data-cy":"folder",class:"full q-ml-sm"},null,8,["modelValue","label","options"])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",pe,[_e,(0,s.Lk)("div",he,[(0,s.bF)(_,{modelValue:e.model["email"],"onUpdate:modelValue":t[6]||(t[6]=t=>e.model["email"]=t),label:e.$t("pages.import.email"),outlined:"","data-cy":"email",class:(0,l.C4)("full q-ml-sm")},{append:(0,s.k6)((()=>[e.errors["email"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),e.row_id?((0,s.uX)(),(0,s.CE)("div",ge,[(0,s.bF)(h,{dense:"",style:{"margin-left":"5px","margin-right":"5px"},modelValue:e.model.delete_after_import,"onUpdate:modelValue":t[7]||(t[7]=t=>e.model.delete_after_import=t)},null,8,["modelValue"]),(0,s.Lk)("span",fe,(0,l.v_)(e.$t("Move Emails to other folder")),1),"IMAP"==e.model["protocol"]&&""!=e.row_id&&1==e.model["delete_after_import"]?((0,s.uX)(),(0,s.Wv)(p,{key:0,modelValue:e.model["move_to_folder"],"onUpdate:modelValue":t[8]||(t[8]=t=>e.model["move_to_folder"]=t),label:e.$t("pages.import.folder"),options:e.folder_list,outlined:"",dense:"","data-cy":"folder",class:"full q-ml-sm"},null,8,["modelValue","label","options"])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",be,[ve,(0,s.Lk)("div",ke,[(0,s.bF)(_,{modelValue:e.model["password"],"onUpdate:modelValue":t[9]||(t[9]=t=>e.model["password"]=t),type:"password",label:e.$t("pages.import.password"),outlined:"","data-cy":"password",class:(0,l.C4)("full q-ml-sm")},{append:(0,s.k6)((()=>[e.errors["password"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),(0,s.Lk)("div",ye,[(0,s.Lk)("div",we,[(0,s.bF)(h,{dense:"",style:{"margin-left":"5px","margin-right":"5px"},modelValue:e.model["merge_pdf_files"],"onUpdate:modelValue":t[10]||(t[10]=t=>e.model["merge_pdf_files"]=t)},null,8,["modelValue"]),(0,s.Lk)("span",Le,(0,l.v_)(e.$t("pages.import.merge_attached_documents")),1)])])]),(0,s.Lk)("div",Ee,[Fe,(0,s.Lk)("div",Ce,[(0,s.bF)(p,{class:"full q-ml-sm",outlined:"",clearable:"",modelValue:e.model["sub_org_id"],"onUpdate:modelValue":t[11]||(t[11]=t=>e.model["sub_org_id"]=t),"use-input":"",options:e.filterSubOrgsList,onFilter:e.filterSubOrgslistEvent,label:e.$t("sub_organizations"),loading:e.sub_org_list_loading,"emit-value":"","map-options":""},null,8,["modelValue","options","onFilter","label","loading"])]),Ae]),(0,s.Lk)("div",Re,[De,(0,s.Lk)("div",Se,[(0,s.bF)(_,{class:(0,l.C4)(["full q-ml-sm","bg-disable"]),id:"apiKey",outlined:"",modelValue:e.api_key_ref,"onUpdate:modelValue":t[12]||(t[12]=t=>e.api_key_ref=t),readonly:"",label:e.$t("pages.import.token")},null,8,["modelValue","label"])]),qe])])),_:1})),e.Office365_selected&&1!=e.ms_is_authenticated?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(g,{key:2,class:"p-t-0"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",ut,[mt,pt,(0,s.Lk)("div",_t,[e.Office365_selected?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(f,{key:0,type:"submit",class:"q-ml-sm float-right",label:e.$t("save")},null,8,["label"])),1==e.ms_is_authenticated?((0,s.uX)(),(0,s.Wv)(f,{key:1,class:"q-ml-sm float-right",label:e.$t("pages.import.save"),onClick:t[24]||(t[24]=t=>e.saveFolder())},null,8,["label"])):(0,s.Q3)("",!0),e.row_id?((0,s.uX)(),(0,s.Wv)(f,{key:2,appearance:"secondary",class:"q-ml-sm float-right",label:e.$t("pages.import.import"),onClick:t[25]||(t[25]=t=>e.manual_import())},null,8,["label"])):(0,s.Q3)("",!0),(0,s.bo)((0,s.bF)(f,{class:"float-right",appearance:"cancel",label:e.$t("cancel")},null,8,["label"]),[[k]])])])])),_:1}))],32),(0,s.bF)(b,{showing:e.loading,class:"z-index-1"},{default:(0,s.k6)((()=>[ht])),_:1},8,["showing"])])),_:1})}var ft=o(78652),bt=o(7813),vt=function(e,t,o,s){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,i){function a(e){try{n(s.next(e))}catch(t){i(t)}}function r(e){try{n(s["throw"](e))}catch(t){i(t)}}function n(e){e.done?o(e.value):l(e.value).then(a,r)}n((s=s.apply(e,t||[])).next())}))};const kt=(0,s.pM)({el:"#app",mixins:[q.A,R.A],props:{selected_model:{},api_key:{type:String,default:""}},components:{},data(){return{}},setup(){const e=(0,S.cY)(),{encryptions:t,protocols:o,subOrgList:s,sub_org_list_loading:l}=(0,A.bP)(e),i=(0,D.KR)(e.subOrgList);return{EMAIL_ENCRYPTION_KEY:(0,D.KR)(""),subOrgList:s,sub_org_list_loading:l,filterSubOrgsList:i,protocols:o,encryptions:t,loading:(0,D.KR)(!1),model:(0,D.KR)({}),row_id:(0,D.KR)(""),errors:(0,D.KR)({}),Office365_selected:(0,D.KR)(!1),use_folder:(0,D.KR)(!1),use_email:(0,D.KR)(!1),ms_url:(0,D.KR)("https://microsoft.com/devicelogin"),ms_code:(0,D.KR)(""),ms_authenticate:(0,D.KR)(!1),ms_is_authenticated:(0,D.KR)(!1),ms_message:(0,D.KR)("Microsoft o365 is authenticated already."),api_key_ref:(0,D.KR)(""),folder_list:(0,D.KR)([])}},mounted:function(){const e="thi5i5@very5ecurehardc0d3denCrIp";if(void 0==e)throw"Missing EMAIL_ENCRYPTION_KEY env - unable to load";this.EMAIL_ENCRYPTION_KEY=e,this.initView()},methods:{initView(){return vt(this,void 0,void 0,(function*(){this.api_key_ref=this.api_key,this.row_id=this.selected_model.hasOwnProperty("id")?this.selected_model.id:"",""!=this.row_id&&(yield this.getFolders()),this.folder_list,this.model=JSON.parse(JSON.stringify(this.selected_model));for(let[e,t]of Object.entries(this.model))(t||"merge_pdf_files"!=e)&&(t||"delete_after_import"!=e)&&(t||"is_active"!=e)?t||(this.model[e]=""):this.model[e]=!1;this.protocolUpdated(),"OAuth Office365"==this.model.protocol&&(this.ms_is_authenticated=!0,"null"!=this.model.shared_email&&null!=this.model.shared_email?this.use_email=!0:(this.model.shared_email="",this.use_email=!1)),this.model.hasOwnProperty("service_type")||(this.model.service_type="Other"),null!=this.model["password"]&&""!=this.model["password"]&&(this.model["password"]=this.decryptPassword(this.model["password"]).toString(bt.fk.Utf8)),this.row_id||this.resetForm()}))},resetForm(){this.model={active:!1,email:"",shared_email:"",username:"",password:"",server:"",port:"",folder:"",encryption:"",protocol:"",service_type:"Other",whole_email:!1,skip:!1,sub_org_id:"",delete_after_import:!1,merge_pdf_files:!1}},submitFrom(){return vt(this,void 0,void 0,(function*(){try{this.loading=!0,"OAuth Office365"==this.model.protocol&&this.updateModel();const e=yield te.D.AddUpdateEmail(this.prepareApiData());if(!e.success)throw e.message;if(this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),"OAuth Office365"!==this.model.protocol)return this.resetForm(),void this.updateEmailImportEvent();"OAuth Office365"==this.model.protocol&&e.hasOwnProperty("code")&&(this.model=e.data,this.row_id=this.model.id,this.ms_code=e.code,this.openMsPage(),this.ms_authenticate=!0);const t=new CustomEvent("record_saved",{detail:{}});document.dispatchEvent(t)}catch(e){const t=oe.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},prepareApiData(){let e=this.encryptPassword();return{email:this.model.email,shared_email:this.model.shared_email,password:e,username:this.model.username,server:this.model.server,port:this.model.port,encryption:this.model.encryption,protocol:this.model.protocol,whole_email:""!==this.model.whole_email&&this.model.whole_email,skip:""!==this.model.skip&&this.model.skip,api_key:this.api_key,sub_org_id:this.model.sub_org_id,id:this.row_id,folder:"SSL"!=this.model.encryption||"IMAP"!=this.model.protocol?"":this.model.folder,delete_after_import:this.model.delete_after_import,merge_pdf_files:this.model.merge_pdf_files,move_to_folder:1==this.model.delete_after_import?this.model.move_to_folder:""}},encryptPassword(){var e=bt.fk.Utf8.parse(this.EMAIL_ENCRYPTION_KEY),t=bt.c5.encrypt(this.model.password,e,{mode:bt.Mq.ECB,padding:bt.eV.PKCS7});return t},decryptPassword(e){var t=bt.fk.Utf8.parse(this.EMAIL_ENCRYPTION_KEY),o=bt.c5.decrypt(e,t,{mode:bt.Mq.ECB});return o},updateModel(){this.model.password="",this.model.username="",this.model.server="",this.model.port="",this.model.encryption="",this.model.folder="",this.model.shared_email=null,this.model.sub_org_id=null},copyText(){(0,ft.A)(this.ms_code).then((()=>{this.showSuccessToast("Copied!")}))},updateEmailImportEvent(){const e=new CustomEvent("email_import_updated",{});document.dispatchEvent(e)},openMsPage(){window.open(this.ms_url,"_blank")},protocolUpdated(){"OAuth Office365"==this.model.protocol?this.Office365_selected=!0:this.Office365_selected=!1},msfinish(){return vt(this,void 0,void 0,(function*(){try{this.loading=!0;const e=yield te.D.finishMsAuth(this.row_id);1==e.success&&(this.ms_is_authenticated=!0,this.showSuccessToast(this.$t("Authentication completed")))}catch(e){this.showErrorToast(this.$t("Something failed on the transmission. Please try again."))}finally{this.loading=!1}}))},manual_import(){return vt(this,void 0,void 0,(function*(){this.loading=!0,yield te.D.performManuelImportMail(this.row_id),this.loading=!1,this.showSuccessToast(this.$t("pages.messages.import_try")),this.$router.push("/dashboard")}))},validateLoginTest(){let e=!0;this.resetErrors();const t=["folder","whole_email","skip","active"];if("OAuth Office365"===this.model.protocol)return e=!1,this.showErrorToast(this.$t("service_type_not_supported")),e;for(const[o,s]of Object.entries(this.model))t.includes(o)||s&&0!=String(s).length||(e=!1,this.errors[o]=!0);return e},resetErrors(){for(const[e,t]of Object.entries(this.model))this.errors[e]=!1},saveFolder(){return vt(this,void 0,void 0,(function*(){try{this.loading=!0;const e={id:this.row_id,folder:1==this.use_folder?this.model.folder:"null",shared_email:1==this.use_email?this.model.shared_email:"null",sub_org_id:this.model.sub_org_id,delete_after_import:this.model.delete_after_import,move_to_folder:this.model.move_to_folder};let t=yield te.D.saveFolder(e);if(!t.success)throw t;this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),this.resetForm(),this.updateEmailImportEvent()}catch(e){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.loading=!1}}))},getFolders(){return vt(this,void 0,void 0,(function*(){try{this.loading=!0;let e=yield te.D.getFolders(this.row_id);if(!e.success)throw e;this.folder_list=e.data}catch(e){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.loading=!1}}))},filterSubOrgslistEvent(e,t,o){t(e?()=>{const t=e.toLowerCase();this.filterSubOrgsList=this.subOrgList.filter((e=>e.label.toLowerCase().indexOf(t)>-1))}:()=>{this.filterSubOrgsList=this.subOrgList})}}});var yt=o(23316),wt=o(36914),Lt=o(39150),Et=o(56384),Ft=o(44189),Ct=o(50492),At=o(66908),Rt=o(39035),Dt=o(88672);const St=(0,O.A)(kt,[["render",gt]]),qt=St;K()(kt,"components",{QCard:yt.A,QToolbar:wt.A,QToolbarTitle:Lt.A,QBtn:Et.A,QCardSection:Ft.A,QSelect:I.A,QIcon:Ct.A,QTooltip:x.A,QInput:V.A,QToggle:At.A,QInnerLoading:Rt.A}),K()(kt,"directives",{ClosePopup:Dt.A});const $t={class:"text-weight-bold primary-bg-text"},Tt={class:"q-pl-md q-pr-md q-pt-md"},Ot={class:"text-item"},Vt=(0,s.Lk)("div",{class:"row float-right"},null,-1),xt={key:0,style:{"text-wrap":"wrap"}},It={key:1},Qt={class:"q-mt-md row full-width"};function Kt(e,t,o,i,a,r){const n=(0,s.g2)("q-toolbar-title"),d=(0,s.g2)("q-btn"),c=(0,s.g2)("q-toolbar"),u=(0,s.g2)("q-th"),m=(0,s.g2)("q-tr"),p=(0,s.g2)("q-td"),_=(0,s.g2)("q-icon"),h=(0,s.g2)("q-table"),g=(0,s.g2)("q-pagination"),f=(0,s.g2)("q-card-section"),b=(0,s.g2)("q-card"),v=(0,s.gN)("close-popup");return(0,s.uX)(),(0,s.Wv)(b,{style:{width:"1060px","max-width":"1060px"}},{default:(0,s.k6)((()=>[(0,s.bF)(c,{class:"secondary-toolbar"},{default:(0,s.k6)((()=>[(0,s.bF)(n,null,{default:(0,s.k6)((()=>[(0,s.Lk)("span",$t,(0,l.v_)(e.$t("pages.import.connection_logs")),1)])),_:1}),(0,s.bo)((0,s.bF)(d,{flat:"",round:"",dense:"",class:"primary-bg-text",icon:"close",onClick:e.cleanupOnhide},null,8,["onClick"]),[[v]])])),_:1}),(0,s.bF)(f,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",Tt,[(0,s.bF)(h,{class:"dashboard-table-style dashboard-table-height back-white","rows-per-page-options":[0],rows:e.rows,columns:e.columns,"row-key":"id","hide-bottom":"",flat:"","table-header-class":"table-header-text back-white","no-data-label":e.$t("no_data_found"),"no-results-label":"The filter didn't uncover any results",style:{overflow:"auto",height:"550px"}},{header:(0,s.k6)((t=>[(0,s.bF)(m,{props:t},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.cols,((e,o)=>((0,s.uX)(),(0,s.Wv)(u,{key:e.name,props:t,"data-index":o},{default:(0,s.k6)((()=>[(0,s.Lk)("span",Ot,(0,l.v_)(e.label),1)])),_:2},1032,["props","data-index"])))),128))])),_:2},1032,["props"]),0==e.rows.length?((0,s.uX)(),(0,s.Wv)(m,{key:0},{default:(0,s.k6)((()=>[(0,s.bF)(p,{colspan:"20",class:"text-center"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("no_data_found")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),body:(0,s.k6)((e=>[(0,s.bF)(m,{props:e,id:e.key},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.cols,(t=>((0,s.uX)(),(0,s.CE)(s.FK,{key:t.name},["action"===t.name?((0,s.uX)(),(0,s.Wv)(p,{key:0},{default:(0,s.k6)((()=>[Vt])),_:1})):(0,s.Q3)("",!0),"success"===t.name?((0,s.uX)(),(0,s.Wv)(p,{key:1},{default:(0,s.k6)((()=>[(0,s.bF)(_,{name:!0===e.row[t.name]?"check_circle":"cancel",color:!0===e.row[t.name]?"green":"red",size:"20px"},null,8,["name","color"])])),_:2},1024)):((0,s.uX)(),(0,s.Wv)(p,{key:2},{default:(0,s.k6)((()=>["message"===t.name?((0,s.uX)(),(0,s.CE)("span",xt,(0,l.v_)(e.row[t.name]),1)):((0,s.uX)(),(0,s.CE)("span",It,(0,l.v_)(e.row[t.name]),1))])),_:2},1024))],64)))),128))])),_:2},1032,["props","id"])])),_:1},8,["rows","columns","no-data-label"]),(0,s.Lk)("div",Qt,[e.total_pages>1?((0,s.uX)(),(0,s.Wv)(g,{key:0,modelValue:e.current_page,"onUpdate:modelValue":t[0]||(t[0]=t=>e.current_page=t),max:3,"max-pages":3,"direction-links":"",unelevated:"",color:"black","active-color":"black",class:"doc2-pagination q-mb-md q-ml-auto q-mr-auto",onClick:t[1]||(t[1]=t=>e.nexPageClicked())},null,8,["modelValue"])):(0,s.Q3)("",!0)])])])),_:1})])),_:1})}var Mt=o(36246),Wt=function(e,t,o,s){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,i){function a(e){try{n(s.next(e))}catch(t){i(t)}}function r(e){try{n(s["throw"](e))}catch(t){i(t)}}function n(e){e.done?o(e.value):l(e.value).then(a,r)}n((s=s.apply(e,t||[])).next())}))};const Pt=(0,s.pM)({mixins:[R.A,q.A],props:{connection_id:{type:String,required:!0},connection_type:{type:String,required:!0}},components:{},watch:{},computed:{},mounted:function(){this.init(),this.checkConnectionLogs()},unmounted:function(){this.cleanupOnhide()},methods:{init(){this.prepareColumns()},checkConnectionLogs(){try{this.resetPagination(),this.getDataFromServer()}catch(e){const t=oe.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}},getDataFromServer(){return Wt(this,void 0,void 0,(function*(){try{this.loading=!0,this.request_params={},this.request_params["offset"]=this.offset,this.request_params["limit"]=10,this.request_params["connection_type"]=this.connection_type,this.request_params["connection_id"]=this.connection_id,this.request_params["order_by_direction"]="desc";const e=yield te.D.fetchConnectionLogs(this.request_params);if(!1===e.success)throw{message:e.message};this.total_records=e.total_records_count,this.setTotalPages(),this.prepareRows(e.elements)}catch(e){const t=oe.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},prepareRows(e){this.rows=[],Array.from(e).forEach((e=>{const t=e;this.addNewRow(t)}))},addNewRow(e){let t=Object.assign({},e);return t["created_on"]=this.formateDate(e["created_on"],"DD-MM-YYYY HH:mm:ss"),this.rows.push(t),this.rows.length.toString()},formateDate(e,t){return Mt.Ay.formatDate(e,t)},resetPagination(){this.offset=0,this.total_pages=0,this.current_page=1,this.total_records=0},setTotalPages(){this.total_pages=Math.ceil(this.total_records/this.page_size)},nexPageClicked(){return Wt(this,void 0,void 0,(function*(){try{this.calculateOffset(),yield this.getDataFromServer()}catch(e){const t=oe.t.getErrorMessage(e);this.showErrorToast(t)}}))},calculateOffset(){this.offset=10*(this.current_page-1)},prepareColumns(){this.columns=[],this.columns.push({name:"success",label:this.$t("status"),field:"status",align:"left"}),this.columns.push({name:"created_on",label:this.$t("pages.import.attempted_on"),field:"created_on",align:"left"}),this.columns.push({name:"message",label:this.$t("pages.support.message"),field:"message",align:"left"})},cleanupOnhide(){this.resetPagination()}},setup(){return{loading:(0,D.KR)(!1),request_params:(0,D.KR)({}),current_page:(0,D.KR)(1),total_pages:(0,D.KR)(0),offset:(0,D.KR)(0),page_size:(0,D.KR)(8),total_records:(0,D.KR)(0),columns:(0,D.KR)([]),rows:(0,D.KR)([])}}});var Xt=o(42315),Ut=o(44488),Nt=o(57722),Yt=o(45262),zt=o(54700);const jt=(0,O.A)(Pt,[["render",Kt]]),Bt=jt;K()(Pt,"components",{QCard:yt.A,QToolbar:wt.A,QToolbarTitle:Lt.A,QBtn:Et.A,QCardSection:Ft.A,QTable:Xt.A,QTr:Ut.A,QTh:Nt.A,QTd:Yt.A,QIcon:Ct.A,QPagination:zt.A,QInnerLoading:Rt.A}),K()(Pt,"directives",{ClosePopup:Dt.A});var Jt=o(49332),Gt=o(51476);const Ht="sub_app",Zt={methods:{async getSubscriptionFromServer(){try{const e=await te.jD.getSubscription();if(!e||!e||!Array.isArray(e)||0==e.length)return;(0,Gt._Y)(Ht,this.getDoc2AppSubscription(e))}catch(e){}},getDoc2AppSubscription(e){let t=!1,o={};for(let s of e){const e=s.apps;for(let l of e)if("FELLOW_DOC2"===l.app_key){t=!0,o=s;break}if(!0===t)break}return o},getRemainingDays(){let e=-1,t=this.getSubscription();if(!t)return null;let o=this.getDateFromServerDate(t.end_date);const s=(new Date).setHours(0,0,0,0);return e=this.datediff(s,o),e},datediff(e,t){return Math.round((t-e)/864e5)},getDateFromServerDate(e){var t=e.split(" ");return new Date(t[0]).setHours(0,0,0,0)},async getsubscriptionRemainingDays(){let e=0;try{e=this.getRemainingDays(),null==e&&(await this.getSubscriptionFromServer(),e=this.getRemainingDays())}catch(t){}return e},subscriptionAlertShowDays(){return 30},getSubscription(){let e=(0,Gt.KW)(Ht);return e&&e.hasOwnProperty("start_date")&&e.hasOwnProperty("end_date")?e:null}}};var eo=o(41498),to=o(45022),oo=function(e,t,o,s){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,i){function a(e){try{n(s.next(e))}catch(t){i(t)}}function r(e){try{n(s["throw"](e))}catch(t){i(t)}}function n(e){e.done?o(e.value):l(e.value).then(a,r)}n((s=s.apply(e,t||[])).next())}))};const so=(0,s.pM)({mixins:[q.A,R.A,Zt,ee.A],components:{EditCreate:qt,ConnectionLogs:Bt,ImportLogs:Jt.A},watch:{sub_org_list_loading(e,t){!1===e&&this.initView()}},mounted:function(){const e="thi5i5@very5ecurehardc0d3denCrIp";void 0!=e?(this.EMAIL_ENCRYPTION_KEY=e,this.initDragDropColumns("email_import_table","label",["action"]),document.addEventListener("email_import_table-column-drop",this.onDropColumns),document.addEventListener("email_import_updated",this.emailImportUpdated),this.handleSubOrgs()):this.showErrorToast("Missing an important value - unable to load email import")},unmounted:function(){document.removeEventListener("email_import_updated",this.emailImportUpdated),document.removeEventListener("email_import_table-column-drop",this.onDropColumns)},methods:{showMailConnectionLogs(e){this.connection_type="email_import",this.connection_id=e,this.show_connection_logs=!0},initView(){return oo(this,void 0,void 0,(function*(){try{this.loading=!0,this.prepareColumns(),yield this.getAppKey(),this.flattenSubOrgs(),this.getList()}catch(e){const t=oe.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},handleSubOrgs(){this.subOrgList.length>1&&this.initView(),this.sub_org_list_loading&&(this.loading=!0)},getList(){return oo(this,void 0,void 0,(function*(){try{this.loading=!0,this.prepareColumns();const e=yield te.D.getList();if(0==e.data.length)return;this.prepareRows(e.data)}catch(e){const t=oe.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},prepareRows(e){this.rows=[],Array.from(e).forEach((e=>{const t=e;this.addNewRow(t)}))},addNewRow(e){let t=Object.assign({},e);return this.rows.push(t),this.rows.length.toString()},createNewRecord(){this.selected_row={},this.show_edit_create=!0},emailImportUpdated(){this.show_edit_create=!1,this.getList()},editRow(e,t){this.selected_row=JSON.parse(JSON.stringify(t)),this.show_edit_create=!0},deleteClicked(e,t){return oo(this,void 0,void 0,(function*(){try{this.loading=!0;const o=yield te.D.deleteRecord(t);!0===o.success&&this.rows.splice(e,1),this.showSuccessToast(this.$t("success"))}catch(o){const e=oe.t.getErrorMessage(o);this.showErrorToast(e)}finally{this.loading=!1}}))},getAppKey(){return oo(this,void 0,void 0,(function*(){try{this.loading=!0;const e={app_key:"FELLOW_DOC2"},t=yield te.jD.getAppSubscription(e);this.api_key=t[0].token}catch(e){const t=oe.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},de_activateEmail(e){return oo(this,void 0,void 0,(function*(){try{this.loading=!0;const t=e.id,o=e.is_active;yield te.D.DeActivateEmail(t,o);this.showSuccessToast(this.$t("success"))}catch(t){const e=oe.t.getErrorMessage(t);this.showErrorToast(e)}finally{this.loading=!1}}))},checkLogin(e){return oo(this,void 0,void 0,(function*(){try{this.loading=!0;const t=yield te.D.testEmailLogin(String(e.id));if(!t||t.hasOwnProperty("success")&&!1===t.success)throw t;this.showSuccessToast(this.$t("check_login_success"))}catch(t){const e=oe.t.getErrorMessage(t);this.showErrorToast(e)}finally{this.loading=!1}}))},flattenSubOrgs(){this.subOrgList.forEach((e=>{this.sub_orgs_flattened[e.value]=e.label}))},prepareColumns(){this.columns=[],this.columns.push({name:"username",label:this.$t("username"),field:"username",align:"left"}),this.columns.push({name:"email",label:this.$t("email"),field:"email",align:"left"}),this.columns.push({name:"shared_email",label:this.$t("shared_email"),field:"shared_email",align:"left"}),this.columns.push({name:"protocol",label:this.$t("protocol"),field:"protocol",align:"left"}),this.columns.push({name:"encryption",label:this.$t("encryption"),field:"encryption",align:"left"}),this.columns.push({name:"sub_org_id",label:this.$t("sub_organizations"),field:"sub_org_id",align:"left"}),this.columns.push({name:"folder",label:this.$t("folder"),field:"folder",align:"left"}),this.columns.push({name:"action",label:this.$t("action"),field:"action",align:"right"});const e=to.A.getItem("EMAIL_IMPORT_SETTING_COLUMNS");this.columns=e&&""!=e?JSON.parse(e):this.columns},onDropColumns(){to.A.set("EMAIL_IMPORT_SETTING_COLUMNS",JSON.stringify(this.columns))},webSiteLink(){const e=(0,eo.TEc)("import_settings");e&&window.open(e)}},setup(){const e=(0,S.cY)(),{subOrgList:t,sub_org_list_loading:o}=(0,A.bP)(e);let s=(0,D.KR)({});const l=(0,D.KR)(null);return{sub_org_list_loading:o,subOrgList:t,myForm:l,import_email:s,errors:(0,D.KR)({}),show_connection_logs:(0,D.KR)(!1),connection_type:(0,D.KR)(""),connection_id:(0,D.KR)({}),sub_orgs_flattened:(0,D.KR)({}),processing:(0,D.KR)(!1),ms_url:(0,D.KR)("https://microsoft.com/devicelogin"),ms_code:(0,D.KR)(""),ms_authenticate:(0,D.KR)(!1),ms_is_authenticated:(0,D.KR)(!1),ms_message:(0,D.KR)("Microsoft o365 is authenticated already."),loading:(0,D.KR)(!1),userDialog:(0,D.KR)(!1),columns:(0,D.KR)([]),rows:(0,D.KR)([]),show_edit_create:(0,D.KR)(!1),selected_row:(0,D.KR)({}),api_key:(0,D.KR)(""),EMAIL_ENCRYPTION_KEY:(0,D.KR)("")}},data(){return{}}});var lo=o(84436),io=o(53999),ao=o(90124),ro=o(25173),no=o(10386),co=o(82156);const uo=(0,O.A)(so,[["render",Z]]),mo=uo;K()(so,"components",{QTable:Xt.A,QTr:Ut.A,QTh:Nt.A,QTd:Yt.A,QBtn:Et.A,QMenu:lo.A,QList:io.A,QItem:ao.A,QItemSection:ro.A,QSeparator:no.A,QTooltip:x.A,QInnerLoading:Rt.A,QDialog:co.A});const po={class:"container"},_o={class:"row mt-8 mb-25"},ho={class:"row"},go={key:0,class:"cursor-default"},fo={key:1},bo={class:"row float-right"},vo={class:"text-red-14"},ko=(0,s.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1);function yo(e,t,o,i,a,r){const n=(0,s.g2)("f-btn"),d=(0,s.g2)("q-th"),c=(0,s.g2)("q-tr"),u=(0,s.g2)("q-item-section"),m=(0,s.g2)("q-item"),p=(0,s.g2)("q-separator"),_=(0,s.g2)("q-list"),h=(0,s.g2)("q-menu"),g=(0,s.g2)("q-btn"),f=(0,s.g2)("q-td"),b=(0,s.g2)("q-table"),v=(0,s.g2)("q-inner-loading"),k=(0,s.g2)("EditCreate"),y=(0,s.g2)("q-dialog"),w=(0,s.g2)("ConnectionLogs");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",po,[(0,s.Lk)("div",_o,[(0,s.bF)(n,{class:"q-ml-auto float-right",icon:"add",label:e.$t("new"),id:"create_new_ftp",onClick:e.createNewRecord},null,8,["label","onClick"])]),(0,s.Lk)("div",ho,[(0,s.bF)(b,{style:{width:"100%",height:"100%"},class:"dashboard-table-style dashboard-table-height back-white",rows:e.rows,columns:e.columns,"row-key":"name",flat:"","no-data-label":e.$t("pages.messages.no_record_found"),"table-header-class":"table-header-text","rows-per-page-options":[0],id:"ftp_import_table"},{header:(0,s.k6)((t=>[(0,s.bF)(c,{props:t},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.cols,((o,i)=>((0,s.uX)(),(0,s.Wv)(d,{key:o.name,props:t,"data-index":i,draggable:e.canDragDropColumn(o),dropzone:e.canDragDropColumn(o),direction:"horizontal",onDragstart:t=>e.onDragStart(t,e.columns,i),onDrop:(0,P.D$)((t=>e.handleDrop(t,i)),["prevent"]),onDragover:(0,P.D$)((t=>e.onDragOver(t,i)),["prevent"]),onDragenter:(0,P.D$)(e.onDragEnter,["prevent"]),onDragleave:(0,P.D$)(e.onDragLeave,["prevent"]),style:(0,l.Tr)({cursor:e.getIsDragging?"pointer":"move"})},{default:(0,s.k6)((()=>["action"==o.name?((0,s.uX)(),(0,s.CE)("span",go,(0,l.v_)(o.label),1)):((0,s.uX)(),(0,s.CE)("span",fo,(0,l.v_)(o.label),1))])),_:2},1032,["props","data-index","draggable","dropzone","onDragstart","onDrop","onDragover","onDragenter","onDragleave","style"])))),128))])),_:2},1032,["props"])])),body:(0,s.k6)((o=>[(0,s.bF)(c,{props:o,id:o.key},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.cols,(i=>((0,s.uX)(),(0,s.CE)(s.FK,{key:i.name},["action"===i.name?((0,s.uX)(),(0,s.Wv)(f,{key:0,style:{width:"236px"}},{default:(0,s.k6)((()=>[(0,s.Lk)("div",bo,[(0,s.bF)(g,{flat:"",dense:"",round:"",onClick:t[0]||(t[0]=(0,P.D$)((()=>{}),["stop","prevent"])),icon:"more_horiz"},{default:(0,s.k6)((()=>[(0,s.bF)(h,{"auto-close":"","transition-show":"jump-down","transition-hide":"jump-up",anchor:"bottom middle",self:"top middle"},{default:(0,s.k6)((()=>[(0,s.bF)(_,{dense:"",style:{"min-width":"100px"}},{default:(0,s.k6)((()=>[(0,s.bF)(m,{clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(u,{onClick:t=>e.checkConnection(o.row.id)},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("test_connection")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,s.bF)(m,{clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(u,{onClick:t=>e.showFtpConnectionLogs(o.row.id)},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.import.connection_logs")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,s.bF)(p,{inset:""}),(0,s.bF)(m,{clickable:""},{default:(0,s.k6)((()=>[o.row.is_active?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(u,{key:0,onClick:t=>{o.row.is_active=!0,e.de_activate(o.row)}},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("activate")),1)])),_:2},1032,["onClick"])),o.row.is_active?((0,s.uX)(),(0,s.Wv)(u,{key:1,onClick:t=>{o.row.is_active=!1,e.de_activate(o.row)}},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("deactivate")),1)])),_:2},1032,["onClick"])):(0,s.Q3)("",!0)])),_:2},1024),(0,s.bF)(m,{clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(u,{onClick:t=>e.editRow(o.rowIndex,o.row)},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("edit")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,s.bF)(p,{inset:""}),(0,s.bF)(m,{clickable:""},{default:(0,s.k6)((()=>[(0,s.bF)(u,{onClick:t=>e.deleteClicked(o.rowIndex,o.row.id)},{default:(0,s.k6)((()=>[(0,s.Lk)("span",vo,(0,l.v_)(e.$t("delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])])),_:2},1024)):"sub_org_id"===i.name?((0,s.uX)(),(0,s.Wv)(f,{key:1,class:(0,l.C4)(o.row.is_active?"":"email-import-deactive-column")},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.sub_orgs_flattened[o.row[i.name]]),1)])),_:2},1032,["class"])):((0,s.uX)(),(0,s.Wv)(f,{key:2,class:(0,l.C4)(1==o.row.is_active?"":"email-import-deactive-column")},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)("null"===o.row[i.name]?"":o.row[i.name]),1)])),_:2},1032,["class"]))],64)))),128))])),_:2},1032,["props","id"])])),_:1},8,["rows","columns","no-data-label"])])]),(0,s.bF)(v,{showing:e.loading,class:"z-index-1",style:{"z-index":"1000"}},{default:(0,s.k6)((()=>[ko])),_:1},8,["showing"]),(0,s.bF)(y,{modelValue:e.show_edit_create,"onUpdate:modelValue":t[1]||(t[1]=t=>e.show_edit_create=t),persistent:"",onKeydown:t[2]||(t[2]=(0,P.jR)((t=>e.show_edit_create=!1),["esc"]))},{default:(0,s.k6)((()=>[(0,s.bF)(k,{selected_model:e.selected_row,api_key:e.api_key},null,8,["selected_model","api_key"])])),_:1},8,["modelValue"]),(0,s.bF)(y,{modelValue:e.show_connection_logs,"onUpdate:modelValue":t[3]||(t[3]=t=>e.show_connection_logs=t)},{default:(0,s.k6)((()=>[(0,s.bF)(w,{connection_id:e.connection_id,connection_type:"ftp_import"},null,8,["connection_id"])])),_:1},8,["modelValue"])],64)}const wo={key:0,class:"text-weight-bold"},Lo={key:1,class:"text-weight-bold"},Eo={class:"row q-mt-md"},Fo={class:"col-2"},Co={class:"col-7"},Ao={class:"col-3"},Ro={class:"row q-mt-md"},Do={class:"col-2"},So={class:"col-7"},qo=(0,s.Lk)("div",{class:"col-3"},null,-1),$o={class:"row q-mt-md"},To=(0,s.Lk)("div",{class:"col-2"},null,-1),Oo={class:"col-7"},Vo=(0,s.Lk)("div",{class:"col-3"},null,-1),xo={class:"row q-mt-md"},Io=(0,s.Lk)("div",{class:"col-2"},null,-1),Qo={class:"col-7"},Ko=(0,s.Lk)("div",{class:"col-3"},null,-1),Mo={class:"row q-mt-md"},Wo=(0,s.Lk)("div",{class:"col-2"},null,-1),Po={class:"col-7"},Xo=(0,s.Lk)("div",{class:"col-3"},null,-1),Uo={class:"row q-mt-md"},No=(0,s.Lk)("div",{class:"col-2"},null,-1),Yo={class:"col-7"},zo=(0,s.Lk)("div",{class:"col-3"},null,-1),jo={class:"row q-mt-md"},Bo=(0,s.Lk)("div",{class:"col-2"},null,-1),Jo={class:"col-7"},Go=(0,s.Lk)("div",{class:"col-3"},null,-1),Ho=(0,s.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1);function Zo(e,t,o,i,a,r){const n=(0,s.g2)("q-toolbar-title"),d=(0,s.g2)("q-btn"),c=(0,s.g2)("q-toolbar"),u=(0,s.g2)("q-tooltip"),m=(0,s.g2)("q-icon"),p=(0,s.g2)("q-select"),_=(0,s.g2)("q-input"),h=(0,s.g2)("q-card-section"),g=(0,s.g2)("q-inner-loading"),f=(0,s.g2)("q-card"),b=(0,s.gN)("close-popup");return(0,s.uX)(),(0,s.Wv)(f,{style:{width:"1200px","max-width":"1200px",height:"600px"}},{default:(0,s.k6)((()=>[(0,s.Lk)("form",{onSubmit:t[10]||(t[10]=(0,P.D$)(((...t)=>e.submitFrom&&e.submitFrom(...t)),["prevent","stop"]))},[(0,s.bF)(c,{class:"text-white secondary-toolbar"},{default:(0,s.k6)((()=>[(0,s.bF)(n,null,{default:(0,s.k6)((()=>[e.row_id?((0,s.uX)(),(0,s.CE)("span",wo,(0,l.v_)(e.$t("pages.settings.master_data_lookup.edit_row")),1)):((0,s.uX)(),(0,s.CE)("span",Lo,(0,l.v_)(e.$t("pages.settings.master_data_lookup.create_row")),1))])),_:1}),(0,s.bo)((0,s.bF)(d,{flat:"",round:"",dense:"",icon:"close"},null,512),[[b]])])),_:1}),(0,s.bF)(h,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",Eo,[(0,s.Lk)("div",Fo,[(0,s.bF)(p,{"data-cy":"ftp_type",modelValue:e.model["ftp_type"],"onUpdate:modelValue":t[0]||(t[0]=t=>e.model["ftp_type"]=t),outlined:"",options:e.ftp_types,label:e.$t("type")},{append:(0,s.k6)((()=>[e.errors["ftp_type"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","options","label"])]),(0,s.Lk)("div",Co,[(0,s.bF)(_,{"data-cy":"ftp_server",modelValue:e.model["server"],"onUpdate:modelValue":t[1]||(t[1]=t=>e.model["server"]=t),label:e.$t("pages.import.server"),outlined:"",class:(0,l.C4)("full q-ml-sm")},{append:(0,s.k6)((()=>[e.errors["server"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),(0,s.Lk)("div",Ao,[(0,s.bF)(_,{modelValue:e.model["default_directory"],"onUpdate:modelValue":t[2]||(t[2]=t=>e.model["default_directory"]=t),label:e.$t("default_directory"),outlined:"","data-cy":"ftp_default_directory",class:"full q-ml-sm"},null,8,["modelValue","label"])])]),(0,s.Lk)("div",Ro,[(0,s.Lk)("div",Do,[(0,s.bF)(_,{modelValue:e.model["port"],"onUpdate:modelValue":t[3]||(t[3]=t=>e.model["port"]=t),label:e.$t("pages.import.port"),outlined:"","data-cy":"ftp_port",class:(0,l.C4)("full")},{append:(0,s.k6)((()=>[e.errors["port"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),(0,s.Lk)("div",So,[(0,s.bF)(_,{modelValue:e.model["username"],"onUpdate:modelValue":t[4]||(t[4]=t=>e.model["username"]=t),class:(0,l.C4)(["full q-ml-sm","full q-ml-sm"]),label:e.$t("username"),outlined:"","data-cy":"ftp_username"},{append:(0,s.k6)((()=>[e.errors["username"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),qo]),(0,s.Lk)("div",$o,[To,(0,s.Lk)("div",Oo,[(0,s.bF)(_,{modelValue:e.model["password"],"onUpdate:modelValue":t[5]||(t[5]=t=>e.model["password"]=t),type:"password",label:e.$t("pages.import.password"),outlined:"","data-cy":"ftp_password",class:(0,l.C4)("full q-ml-sm")},{append:(0,s.k6)((()=>[e.errors["password"]?((0,s.uX)(),(0,s.Wv)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{class:"bg-red line-error-tooltip"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,s.Q3)("",!0)])),_:1},8,["modelValue","label"])]),Vo]),(0,s.Lk)("div",xo,[Io,(0,s.Lk)("div",Qo,[(0,s.bF)(_,{modelValue:e.model["file_name_matching_patterns"],"onUpdate:modelValue":t[6]||(t[6]=t=>e.model["file_name_matching_patterns"]=t),label:e.$t("file_name_matching_patterns"),outlined:"","data-cy":"ftp_file_name_matching_patterns",class:"full q-ml-sm"},null,8,["modelValue","label"])]),Ko]),(0,s.Lk)("div",Mo,[Wo,(0,s.Lk)("div",Po,[(0,s.bF)(p,{"data-cy":"ftp_sub_org",class:"full q-ml-sm",outlined:"",clearable:"",modelValue:e.model["sub_org_id"],"onUpdate:modelValue":t[7]||(t[7]=t=>e.model["sub_org_id"]=t),"use-input":"",options:e.filterSubOrgsList,onFilter:e.filterSubOrgslistEvent,label:e.$t("sub_organizations"),loading:e.sub_org_list_loading,"emit-value":"","map-options":""},null,8,["modelValue","options","onFilter","label","loading"])]),Xo]),(0,s.Lk)("div",Uo,[No,(0,s.Lk)("div",Yo,[(0,s.bF)(_,{class:(0,l.C4)(["full q-ml-sm","bg-disable"]),"data-cy":"ftp_apiKey",outlined:"",modelValue:e.api_key_ref,"onUpdate:modelValue":t[8]||(t[8]=t=>e.api_key_ref=t),readonly:"",label:e.$t("pages.import.token")},null,8,["modelValue","label"])]),zo])])),_:1}),(0,s.bF)(h,{class:"p-t-0"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",jo,[Bo,(0,s.Lk)("div",Jo,[(0,s.bF)(d,{type:"submit",color:"primary",class:"q-ml-sm float-right",id:"ftp_btn_save",label:e.$t("save")},null,8,["label"]),e.row_id?((0,s.uX)(),(0,s.Wv)(d,{key:0,class:"q-ml-sm float-right",color:"primary",label:e.$t("test_connection"),id:"ftp_btn_test_connection",onClick:t[9]||(t[9]=t=>e.checkConnection())},{default:(0,s.k6)((()=>[e.row_id?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(u,{key:0},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.$t("available_after_save")),1)])),_:1}))])),_:1},8,["label"])):(0,s.Q3)("",!0),(0,s.bo)((0,s.bF)(d,{id:"ftp_btn_cancel",class:"float-right highlighted-back",label:e.$t("cancel")},null,8,["label"]),[[b]])]),Go])])),_:1})],32),(0,s.bF)(g,{showing:e.loading,class:"z-index-1"},{default:(0,s.k6)((()=>[Ho])),_:1},8,["showing"])])),_:1})}var es=function(e,t,o,s){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,i){function a(e){try{n(s.next(e))}catch(t){i(t)}}function r(e){try{n(s["throw"](e))}catch(t){i(t)}}function n(e){e.done?o(e.value):l(e.value).then(a,r)}n((s=s.apply(e,t||[])).next())}))};const ts=(0,s.pM)({el:"#app",mixins:[q.A,R.A],props:{selected_model:{},api_key:{type:String,default:""}},components:{},data(){return{}},setup(){const e=(0,S.cY)(),{ftp_types:t,subOrgList:o,sub_org_list_loading:s}=(0,A.bP)(e),l=(0,D.KR)(e.subOrgList);return{EMAIL_ENCRYPTION_KEY:(0,D.KR)(""),subOrgList:o,sub_org_list_loading:s,filterSubOrgsList:l,ftp_types:t,loading:(0,D.KR)(!1),model:(0,D.KR)({}),row_id:(0,D.KR)(""),errors:(0,D.KR)({}),api_key_ref:(0,D.KR)("")}},mounted:function(){const e="thi5i5@very5ecurehardc0d3denCrIp";if(void 0==e)throw"Missing EMAIL_ENCRYPTION_KEY env - unable to load";this.EMAIL_ENCRYPTION_KEY=e,this.initView()},methods:{initView(){this.api_key_ref=this.api_key,this.row_id=this.selected_model.hasOwnProperty("id")?this.selected_model.id:"",this.model=JSON.parse(JSON.stringify(this.selected_model));for(let[e,t]of Object.entries(this.model))t||(this.model[e]="");this.model["server"]=this.model["server_url"],this.row_id||this.resetForm()},resetForm(){this.model={username:"",password:"",server:"",port:"22",default_directory:"",file_name_matching_patterns:"",ftp_type:"SFTP",sub_org_id:""}},submitFrom(){return es(this,void 0,void 0,(function*(){try{if(!this.validateForm())return;this.loading=!0;const e=yield te.D.ftpImportAddUpdate(this.prepareApiData());if(!e.success)throw e;e.data.hasOwnProperty("id")&&(this.row_id=e.data.id),this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),yield this.checkConnection();const t=new CustomEvent("ftp_import_updated",{detail:{}});document.dispatchEvent(t)}catch(e){const t=oe.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},validateForm(){let e=!0;this.resetErrors();const t=["default_directory","file_name_matching_patterns","sub_org_id"];for(const[o,s]of Object.entries(this.model))t.includes(o)||"is_active"===o||s&&0!=String(s).length||(e=!1,this.errors[o]=!0);return e},prepareApiData(){this.encryptPassword();return{password:this.model.password,username:this.model.username,server:this.model.server,port:this.model.port,ftp_type:this.model.ftp_type,file_name_matching_patterns:this.model.file_name_matching_patterns,api_key:this.api_key,sub_org_id:this.model.sub_org_id,id:this.row_id,default_directory:this.model.default_directory}},encryptPassword(){var e=bt.fk.Utf8.parse(this.EMAIL_ENCRYPTION_KEY),t=bt.c5.encrypt(this.model.password,e,{mode:bt.Mq.ECB,padding:bt.eV.PKCS7});return t},decryptPassword(e){var t=bt.fk.Utf8.parse(this.EMAIL_ENCRYPTION_KEY),o=bt.c5.decrypt(e,t,{mode:bt.Mq.ECB});return o},updateFTPImportEvent(){const e=new CustomEvent("email_import_updated",{});document.dispatchEvent(e)},checkConnection(){return es(this,void 0,void 0,(function*(){try{if(!this.row_id)return;this.loading=!0;const e=yield te.D.ftpConnectionTest(this.row_id);if(!e||e.hasOwnProperty("success")&&!1===e.success)throw e;this.showSuccessToast(this.$t("test_connection_success"))}catch(e){const t=oe.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},resetErrors(){for(const[e,t]of Object.entries(this.model))this.errors[e]=!1},filterSubOrgslistEvent(e,t,o){t(e?()=>{const t=e.toLowerCase();this.filterSubOrgsList=this.subOrgList.filter((e=>e.label.toLowerCase().indexOf(t)>-1))}:()=>{this.filterSubOrgsList=this.subOrgList})}}}),os=(0,O.A)(ts,[["render",Zo]]),ss=os;K()(ts,"components",{QCard:yt.A,QToolbar:wt.A,QToolbarTitle:Lt.A,QBtn:Et.A,QCardSection:Ft.A,QSelect:I.A,QIcon:Ct.A,QTooltip:x.A,QInput:V.A,QInnerLoading:Rt.A}),K()(ts,"directives",{ClosePopup:Dt.A});var ls=function(e,t,o,s){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,i){function a(e){try{n(s.next(e))}catch(t){i(t)}}function r(e){try{n(s["throw"](e))}catch(t){i(t)}}function n(e){e.done?o(e.value):l(e.value).then(a,r)}n((s=s.apply(e,t||[])).next())}))};const is=(0,s.pM)({mixins:[q.A,R.A,Zt,ee.A],components:{EditCreate:ss,ConnectionLogs:Bt},watch:{sub_org_list_loading(e,t){!1===e&&this.initView()}},mounted:function(){const e="thi5i5@very5ecurehardc0d3denCrIp";void 0!=e?(this.initDragDropColumns("ftp_import_table","label",["action"]),document.addEventListener("ftp_import_table-column-drop",this.onDropColumns),document.addEventListener("ftp_import_updated",this.emailImportUpdated),this.handleSubOrgs()):this.showErrorToast("Missing an important value - unable to load email import")},unmounted:function(){document.removeEventListener("ftp_import_updated",this.emailImportUpdated),document.removeEventListener("ftp_import_table-column-drop",this.onDropColumns)},methods:{showFtpConnectionLogs(e){this.connection_id=e,this.show_connection_logs=!0},initView(){return ls(this,void 0,void 0,(function*(){try{this.loading=!0,this.prepareColumns(),yield this.getAppKey(),this.flattenSubOrgs(),this.getList()}catch(e){const t=oe.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},handleSubOrgs(){this.subOrgList.length>1&&this.initView(),this.sub_org_list_loading&&(this.loading=!0)},getList(){return ls(this,void 0,void 0,(function*(){try{this.loading=!0,this.prepareColumns();const e=yield te.D.getFTPImport_List();if(0==e.data.length)return;this.prepareRows(e.data)}catch(e){const t=oe.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},prepareRows(e){this.rows=[],Array.from(e).forEach((e=>{const t=e;this.addNewRow(t)}))},addNewRow(e){let t=Object.assign({},e);return this.rows.push(t),this.rows.length.toString()},createNewRecord(){this.selected_row={},this.show_edit_create=!0},emailImportUpdated(){this.show_edit_create=!1,this.getList()},editRow(e,t){this.selected_row=JSON.parse(JSON.stringify(t)),this.show_edit_create=!0},deleteClicked(e,t){return ls(this,void 0,void 0,(function*(){try{this.loading=!0;const o=yield te.D.ftpImportDelete(t);!0===o.success&&this.rows.splice(e,1),this.showSuccessToast(this.$t("success"))}catch(o){const e=oe.t.getErrorMessage(o);this.showErrorToast(e)}finally{this.loading=!1}}))},checkConnection(e){return ls(this,void 0,void 0,(function*(){try{this.loading=!0;const t=yield te.D.ftpConnectionTest(e);if(!t||t.hasOwnProperty("success")&&!1===t.success)throw t;this.showSuccessToast(this.$t("test_connection_success"))}catch(t){const e=oe.t.getErrorMessage(t);this.showErrorToast(e)}finally{this.loading=!1}}))},getAppKey(){return ls(this,void 0,void 0,(function*(){try{this.loading=!0;const e={app_key:"FELLOW_DOC2"},t=yield te.jD.getAppSubscription(e);this.api_key=t[0].token}catch(e){const t=oe.t.getErrorMessage(e);this.showErrorToast(t)}finally{this.loading=!1}}))},de_activate(e){return ls(this,void 0,void 0,(function*(){try{this.loading=!0;const t=e.id,o=e.is_active;yield te.D.setFTPImportActiveDeactive(t,o);this.showSuccessToast(this.$t("success"))}catch(t){const e=oe.t.getErrorMessage(t);this.showErrorToast(e)}finally{this.loading=!1}}))},flattenSubOrgs(){this.subOrgList.forEach((e=>{this.sub_orgs_flattened[e.value]=e.label}))},prepareColumns(){this.columns=[],this.columns.push({name:"ftp_type",label:this.$t("type"),field:"ftp_type",align:"left"}),this.columns.push({name:"server_url",label:this.$t("server_url"),field:"server_url",align:"left"}),this.columns.push({name:"username",label:this.$t("username"),field:"username",align:"left"}),this.columns.push({name:"port",label:this.$t("port"),field:"port",align:"left"}),this.columns.push({name:"sub_org_id",label:this.$t("sub_organizations"),field:"sub_org_id",align:"left"}),this.columns.push({name:"default_directory",label:this.$t("default_directory"),field:"default_directory",align:"left"}),this.columns.push({name:"action",label:this.$t("action"),field:"action",align:"right"});const e=to.A.getItem("FTP_IMPORT_SETTING_COLUMNS");this.columns=e&&""!=e?JSON.parse(e):this.columns},onDropColumns(){to.A.set("FTP_IMPORT_SETTING_COLUMNS",JSON.stringify(this.columns))}},setup(){const e=(0,S.cY)(),{subOrgList:t,sub_org_list_loading:o}=(0,A.bP)(e);let s=(0,D.KR)({});const l=(0,D.KR)(null);return{sub_org_list_loading:o,subOrgList:t,myForm:l,import_email:s,show_connection_logs:(0,D.KR)(!1),connection_id:(0,D.KR)(""),errors:(0,D.KR)({}),sub_orgs_flattened:(0,D.KR)({}),processing:(0,D.KR)(!1),ms_url:(0,D.KR)("https://microsoft.com/devicelogin"),ms_code:(0,D.KR)(""),ms_authenticate:(0,D.KR)(!1),ms_is_authenticated:(0,D.KR)(!1),ms_message:(0,D.KR)("Microsoft o365 is authenticated already."),loading:(0,D.KR)(!1),userDialog:(0,D.KR)(!1),columns:(0,D.KR)([]),rows:(0,D.KR)([]),show_edit_create:(0,D.KR)(!1),selected_row:(0,D.KR)({}),api_key:(0,D.KR)("")}},data(){return{}}}),as=(0,O.A)(is,[["render",yo]]),rs=as;K()(is,"components",{QTable:Xt.A,QTr:Ut.A,QTh:Nt.A,QTd:Yt.A,QBtn:Et.A,QMenu:lo.A,QList:io.A,QItem:ao.A,QItemSection:ro.A,QSeparator:no.A,QTooltip:x.A,QInnerLoading:Rt.A,QDialog:co.A});const ns=(0,s.pM)({el:"#app",components:{SubHeader:u.A,BackToSettings:m.A,PageRestriction:W,EmailImportList:mo,FtpImportList:rs},mounted:function(){this.getSubOrgsList()},setup(){const e=(0,S.cY)(),{getSubOrgsList:t}=e;return{getSubOrgsList:t}}});var ds=o(88841),cs=o(93676);const us=(0,O.A)(ns,[["render",c]]),ms=us;K()(ns,"components",{QList:io.A,QExpansionItem:ds.A,QSeparator:no.A,QIcon:Ct.A,QSpace:cs.A,QCard:yt.A,QCardSection:Ft.A})}}]);