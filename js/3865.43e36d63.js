"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[3865],{43865:(e,t,l)=>{l.r(t),l.d(t,{default:()=>je});var i=l(61758),s=l(58790),a=l(29104);const n={class:"row"},o={class:"col-xs-6 col-sm-6 col-md-6 col-lg-6"},d={class:"col-xs-6 col-sm-6 col-md-6 col-lg-6"},u={class:"buttons-container q-pa-sm"},c={class:"row"},r={class:"row"},_={class:"col-sm-3 col-md-3 col-lg-3 q-pa-sm"},p={class:"col-sm-9 col-md-9 col-lg-9 q-pa-sm"},m={class:"add-criteria q-px-md q-pb-md q-pt-md"},h={class:"text-weight-bold text-primary font-size-16"},b={class:"row q-gutter-md"},g={class:"q-pt-lg"},v={class:"table-header-text"},k={style:{width:"100px"}},f=["onClick"],y={class:"text-red-14"},q={class:"q-pa-md"},$={class:"text-weight-bold text-primary font-size-16"},x={key:0,class:"back-white border-left-bdbdbd vw-30",id:"left_section"},V={class:"scroll-area-height q-ma-sm scrolle-y"},C={class:"row"};function R(e,t,l,R,L,F){const A=(0,i.g2)("SubHeader"),w=(0,i.g2)("BackToSettings"),D=(0,i.g2)("f-btn"),K=(0,i.g2)("q-input"),E=(0,i.g2)("q-select"),M=(0,i.g2)("q-checkbox"),T=(0,i.g2)("q-item-section"),I=(0,i.g2)("q-item"),U=(0,i.g2)("q-list"),Q=(0,i.g2)("q-menu"),S=(0,i.g2)("q-btn"),X=(0,i.g2)("q-markup-table"),j=(0,i.g2)("q-separator"),O=(0,i.g2)("MatchCriteria"),W=(0,i.g2)("Actions"),P=(0,i.g2)("prism-editor"),B=(0,i.g2)("q-splitter"),z=(0,i.g2)("JsonViewer"),J=(0,i.g2)("Loader");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.bF)(A,{name:"rule_management",label:e.isDefault?e.$t("view_template"):e.$t("edit_template")},null,8,["label"]),(0,i.Lk)("div",n,[(0,i.Lk)("div",o,[(0,i.bF)(w,{back_to_rotue:"/settings/toml-samples",label:e.$t("back")},null,8,["label"])]),(0,i.Lk)("div",d,[(0,i.Lk)("div",u,[(0,i.bF)(D,{disable:e.isDefault,label:e.$t("save"),onClick:t[0]||(t[0]=t=>e.updateTomlConfig()),class:"q-ml-sm q-mr-sm"},null,8,["disable","label"]),(0,i.bF)(D,{label:e.$t("test_export_json"),onClick:t[1]||(t[1]=t=>e.toggleMenu()),class:"q-mr-sm"},null,8,["label"])])])]),(0,i.Lk)("div",c,[(0,i.Lk)("div",{class:(0,s.C4)(["white-inputs",e.showExportPanel?"right_section-30vw":"full-width"]),id:"right_section"},[(0,i.bF)(B,{modelValue:e.splitterModel,"onUpdate:modelValue":t[11]||(t[11]=t=>e.splitterModel=t),class:"rule-management-height",limits:[35,80]},{before:(0,i.k6)((()=>[(0,i.Lk)("div",r,[(0,i.Lk)("div",_,[(0,i.bF)(K,{outlined:"",dense:"",label:e.$t("name"),modelValue:e.name,"onUpdate:modelValue":t[2]||(t[2]=t=>e.name=t),readonly:e.isDefault||!e.id},null,8,["label","modelValue","readonly"])]),(0,i.Lk)("div",p,[(0,i.bF)(K,{outlined:"",dense:"",label:e.$t("description"),modelValue:e.description,"onUpdate:modelValue":t[3]||(t[3]=t=>e.description=t),readonly:e.isDefault||!e.id},null,8,["label","modelValue","readonly"])])]),(0,i.Lk)("div",m,[(0,i.Lk)("p",h,(0,s.v_)(e.$t("add_rule")),1),(0,i.Lk)("div",b,[(0,i.bF)(K,{outlined:"",dense:"",disable:e.isDefault,label:e.$t("name"),modelValue:e.rule_name,"onUpdate:modelValue":t[4]||(t[4]=t=>e.rule_name=t),class:"rule-manage-select"},null,8,["disable","label","modelValue"]),(0,i.bF)(E,{outlined:"",dense:"","emit-value":"","map-options":"",disable:e.isDefault,class:"rule-manage-select",modelValue:e.sectionModel,"onUpdate:modelValue":t[5]||(t[5]=t=>e.sectionModel=t),options:e.section_options,label:e.$t("pages.rule_management.section")},null,8,["disable","modelValue","options","label"]),e.selectedIndex>=0?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.bF)(D,{disable:e.isDefault,label:e.$t("update_rule"),onClick:t[6]||(t[6]=t=>e.updateRule())},null,8,["disable","label"]),(0,i.bF)(D,{disable:e.isDefault,label:e.$t("cancel"),onClick:t[7]||(t[7]=t=>e.resetModel())},null,8,["disable","label"])],64)):((0,i.uX)(),(0,i.Wv)(D,{key:1,label:e.$t("add_rule"),onClick:t[8]||(t[8]=t=>e.addRule()),disable:e.isDefault},null,8,["label","disable"]))]),(0,i.Lk)("div",g,[(0,i.bF)(X,{flat:"",class:"dashboard-table-style dashboard-table-height back-white"},{default:(0,i.k6)((()=>[(0,i.Lk)("thead",null,[(0,i.Lk)("tr",v,[(0,i.Lk)("th",null,(0,s.v_)(e.$t("active")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("name")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("pages.rule_management.section")),1),(0,i.Lk)("th",k,(0,s.v_)(e.$t("actions")),1)])]),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.rules,((l,n)=>((0,i.uX)(),(0,i.CE)("tr",{key:n,onClick:t=>e.ruleClick(l,n),class:(0,s.C4)(["cursor-pointer",e.selectedIndex==n?"highlighted-back":""])},[(0,i.Lk)("td",null,[(0,i.bF)(M,{dense:"",modelValue:l["active"],"onUpdate:modelValue":e=>l["active"]=e,disable:e.isDefault},null,8,["modelValue","onUpdate:modelValue","disable"])]),(0,i.Lk)("td",null,(0,s.v_)(l.name),1),(0,i.Lk)("td",null,(0,s.v_)(e.$t(l.section)),1),(0,i.Lk)("td",null,[(0,i.bF)(S,{flat:"",dense:"",round:"",onClick:t[9]||(t[9]=(0,a.D$)((()=>{}),["stop","prevent"])),icon:"more_horiz"},{default:(0,i.k6)((()=>[(0,i.bF)(Q,{"auto-close":"","transition-show":"jump-down","transition-hide":"jump-up",anchor:"bottom middle",self:"top middle"},{default:(0,i.k6)((()=>[(0,i.bF)(U,{dense:"",style:{"min-width":"100px"}},{default:(0,i.k6)((()=>[(0,i.bF)(I,{clickable:"",onClick:t=>e.removeRule(n),disable:e.isDefault},{default:(0,i.k6)((()=>[(0,i.bF)(T,null,{default:(0,i.k6)((()=>[(0,i.Lk)("span",y,(0,s.v_)(e.$t("delete")),1)])),_:1})])),_:2},1032,["onClick","disable"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])],10,f)))),128))])])),_:1})])]),(0,i.bF)(j,{class:"q-my-md"}),(0,i.bF)(O,{isDefault:e.isDefault,onUpdateToml:e.updateToml},null,8,["isDefault","onUpdateToml"]),(0,i.bF)(W,{isDefault:e.isDefault,onUpdateToml:e.updateToml},null,8,["isDefault","onUpdateToml"])])),after:(0,i.k6)((()=>[(0,i.Lk)("div",q,[(0,i.Lk)("p",$,(0,s.v_)(e.$t("pages.rule_management.toml_file")),1),(0,i.bF)(P,{class:"special-rules-editor",modelValue:e.toml_rules,"onUpdate:modelValue":t[10]||(t[10]=t=>e.toml_rules=t),highlight:e.highlighter,"line-numbers":"",tabSize:4},null,8,["modelValue","highlight"])])])),_:1},8,["modelValue"])],2),e.showExportPanel?((0,i.uX)(),(0,i.CE)("div",x,[(0,i.Lk)("div",V,[(0,i.Lk)("div",C,[(0,i.bF)(K,{outlined:"",dense:"",label:"Document id...",modelValue:e.docId,"onUpdate:modelValue":t[12]||(t[12]=t=>e.docId=t),class:"width-320px"},null,8,["modelValue"]),(0,i.bF)(D,{disable:e.isDefault,label:e.$t("test"),onClick:t[13]||(t[13]=t=>e.loadExportJson()),class:"margin-left-auto"},null,8,["disable","label"])]),(0,i.bF)(z,{jsonData:e.exportJson},null,8,["jsonData"])])])):(0,i.Q3)("",!0)]),(0,i.bF)(J)],64)}var L=l(75036),F=l.n(L),A=l(1659);const w={key:1,class:"q-pa-md"},D={class:"full-width q-pa-sm"},K={class:"text-weight-bold text-primary font-size-16"},E={class:"row full-width"},M={class:"table-header-text"},T={style:{width:"100px"}},I=["onClick"],U={class:"text-red-14"};function Q(e,t,l,n,o,d){const u=(0,i.g2)("q-separator"),c=(0,i.g2)("q-toggle"),r=(0,i.g2)("q-item-section"),_=(0,i.g2)("q-item"),p=(0,i.g2)("q-list"),m=(0,i.g2)("q-menu"),h=(0,i.g2)("q-input"),b=(0,i.g2)("q-select"),g=(0,i.g2)("f-btn"),v=(0,i.g2)("q-btn"),k=(0,i.g2)("q-markup-table");return(0,i.uX)(),(0,i.CE)(i.FK,null,[e.selectedRule&&Object.keys(e.selectedRule).length>0&&e.selectedRule.actions?((0,i.uX)(),(0,i.Wv)(u,{key:0,class:"q-my-md"})):(0,i.Q3)("",!0),e.selectedRule&&Object.keys(e.selectedRule).length>0&&e.selectedRule.actions?((0,i.uX)(),(0,i.CE)("div",w,[(0,i.Lk)("div",D,[(0,i.Lk)("span",K,(0,s.v_)(e.$t("actions")),1),(0,i.bF)(c,{modelValue:e.addConditionExpression,"onUpdate:modelValue":t[0]||(t[0]=t=>e.addConditionExpression=t),label:e.$t("add_condition_expression"),class:"float-right"},null,8,["modelValue","label"])]),(0,i.Lk)("div",E,[e.addConditionExpression?((0,i.uX)(),(0,i.Wv)(h,{key:0,disable:e.isDefault,outlined:"",dense:"",modelValue:e.conditionExpression,"onUpdate:modelValue":t[1]||(t[1]=t=>e.conditionExpression=t),label:e.$t("condition_expression"),class:"full-width q-ma-sm"},{default:(0,i.k6)((()=>[(0,i.bF)(m,{anchor:"bottom left",self:"top left",fit:""},{default:(0,i.k6)((()=>[(0,i.bF)(p,null,{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.fieldsOptions,(t=>((0,i.uX)(),(0,i.Wv)(_,{key:t,clickable:"",onClick:l=>e.selectConditionExpression(t.value)},{default:(0,i.k6)((()=>[(0,i.bF)(r,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(t.label),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["disable","modelValue","label"])):(0,i.Q3)("",!0),(0,i.bF)(b,{disable:e.isDefault,outlined:"",dense:"","emit-value":"","map-options":"",class:"action-field-min-with q-ma-sm",modelValue:e.action_type_select,"onUpdate:modelValue":[t[2]||(t[2]=t=>e.action_type_select=t),t[3]||(t[3]=t=>e.resetModel(!1))],options:e.actionTypeOptions,label:e.$t("action_type")},null,8,["disable","modelValue","options","label"]),e.action_type_select.includes("line_charge")||e.action_type_select.includes("header_charge")?((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.bF)(b,{disable:e.isDefault,outlined:"",dense:"","emit-value":"","map-options":"",class:"action-field-min-with q-ma-sm",modelValue:e.costing_element,"onUpdate:modelValue":t[4]||(t[4]=t=>e.costing_element=t),options:e.costingElementOptions,label:e.$t("costing_element")},null,8,["disable","modelValue","options","label"]),"regex"==e.costing_element?((0,i.uX)(),(0,i.Wv)(h,{key:0,disable:e.isDefault,outlined:"",dense:"",modelValue:e.pattern,"onUpdate:modelValue":t[5]||(t[5]=t=>e.pattern=t),label:e.$t("pattern"),class:"action-field-min-with q-ma-sm"},null,8,["disable","modelValue","label"])):(0,i.Q3)("",!0),"custom"==e.costing_element||"regex"==e.costing_element?((0,i.uX)(),(0,i.Wv)(h,{key:1,disable:e.isDefault,outlined:"",dense:"",modelValue:e.value,"onUpdate:modelValue":t[6]||(t[6]=t=>e.value=t),label:e.$t("value"),class:"action-field-min-with q-ma-sm"},null,8,["disable","modelValue","label"])):(0,i.Q3)("",!0),(0,i.bF)(b,{disable:e.isDefault,outlined:"",dense:"","emit-value":"","map-options":"",class:"action-field-min-with q-ma-sm",modelValue:e.sequence,"onUpdate:modelValue":t[7]||(t[7]=t=>e.sequence=t),options:e.sequenceOptions,label:e.$t("sequence")},null,8,["disable","modelValue","options","label"]),"custom"==e.sequence?((0,i.uX)(),(0,i.Wv)(h,{key:2,disable:e.isDefault,outlined:"",dense:"",modelValue:e.customSequence,"onUpdate:modelValue":t[8]||(t[8]=t=>e.customSequence=t),label:e.$t("sequence"),class:"action-field-min-with q-ma-sm"},null,8,["disable","modelValue","label"])):(0,i.Q3)("",!0)],64)):(0,i.Q3)("",!0),e.action_type_select.includes("line_charge")||e.action_type_select.includes("receipt_line")?((0,i.uX)(),(0,i.CE)(i.FK,{key:2},[(0,i.bF)(h,{disable:e.isDefault,outlined:"",dense:"",modelValue:e.quantity_select,"onUpdate:modelValue":t[9]||(t[9]=t=>e.quantity_select=t),label:e.$t("quantity"),class:"q-ma-sm selectable-input-field"},{default:(0,i.k6)((()=>[(0,i.bF)(m,{anchor:"bottom left",self:"top left",fit:""},{default:(0,i.k6)((()=>[(0,i.bF)(p,null,{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.fieldsOptions,(t=>((0,i.uX)(),(0,i.Wv)(_,{key:t,clickable:"",onClick:l=>e.selectQuantity(t.value)},{default:(0,i.k6)((()=>[(0,i.bF)(r,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(t.label),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["disable","modelValue","label"]),(0,i.bF)(h,{disable:e.isDefault,outlined:"",dense:"",modelValue:e.unit_price_select,"onUpdate:modelValue":t[10]||(t[10]=t=>e.unit_price_select=t),label:e.$t("unit_price"),class:"q-ma-sm selectable-input-field"},{default:(0,i.k6)((()=>[(0,i.bF)(m,{anchor:"bottom left",self:"top left",fit:""},{default:(0,i.k6)((()=>[(0,i.bF)(p,null,{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.fieldsOptions,(t=>((0,i.uX)(),(0,i.Wv)(_,{key:t,clickable:"",onClick:l=>e.selectUnitPrice(t.value)},{default:(0,i.k6)((()=>[(0,i.bF)(r,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(t.label),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["disable","modelValue","label"])],64)):(0,i.Q3)("",!0),e.action_type_select.includes("header_charge")||e.action_type_select.includes("tax_line")||e.action_type_select.includes("cost_line")?((0,i.uX)(),(0,i.Wv)(h,{key:3,disable:e.isDefault,outlined:"",dense:"",modelValue:e.amount,"onUpdate:modelValue":t[11]||(t[11]=t=>e.amount=t),label:e.$t("amount"),class:"q-ma-sm selectable-input-field"},{default:(0,i.k6)((()=>[(0,i.bF)(m,{anchor:"bottom left",self:"top left",fit:""},{default:(0,i.k6)((()=>[(0,i.bF)(p,null,{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.fieldsOptions,(t=>((0,i.uX)(),(0,i.Wv)(_,{key:t,clickable:"",onClick:l=>e.selectAmount(t.value)},{default:(0,i.k6)((()=>[(0,i.bF)(r,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(t.label),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["disable","modelValue","label"])):(0,i.Q3)("",!0),e.action_type_select.includes("cost_line")?((0,i.uX)(),(0,i.CE)(i.FK,{key:4},[(0,i.bF)(h,{disable:e.isDefault,outlined:"",dense:"",modelValue:e.ledger_account,"onUpdate:modelValue":t[12]||(t[12]=t=>e.ledger_account=t),label:e.$t("ledger_account"),class:"action-field-min-with q-ma-sm"},null,8,["disable","modelValue","label"]),(0,i.bF)(h,{disable:e.isDefault,outlined:"",dense:"",modelValue:e.voucher_text,"onUpdate:modelValue":t[13]||(t[13]=t=>e.voucher_text=t),label:e.$t("voucher_text"),class:"action-field-min-with q-ma-sm"},null,8,["disable","modelValue","label"]),(0,i.bF)(h,{disable:e.isDefault,outlined:"",dense:"",modelValue:e.dimension_1,"onUpdate:modelValue":t[14]||(t[14]=t=>e.dimension_1=t),label:e.$t("dimension_1"),class:"action-field-min-with q-ma-sm"},null,8,["disable","modelValue","label"]),(0,i.bF)(h,{disable:e.isDefault,outlined:"",dense:"",modelValue:e.dimension_2,"onUpdate:modelValue":t[15]||(t[15]=t=>e.dimension_2=t),label:e.$t("dimension_2"),class:"action-field-min-with q-ma-sm"},null,8,["disable","modelValue","label"]),(0,i.bF)(h,{disable:e.isDefault,outlined:"",dense:"",modelValue:e.dimension_3,"onUpdate:modelValue":t[16]||(t[16]=t=>e.dimension_3=t),label:e.$t("dimension_3"),class:"action-field-min-with q-ma-sm"},null,8,["disable","modelValue","label"]),(0,i.bF)(h,{disable:e.isDefault,outlined:"",dense:"",modelValue:e.dimension_4,"onUpdate:modelValue":t[17]||(t[17]=t=>e.dimension_4=t),label:e.$t("dimension_4"),class:"action-field-min-with q-ma-sm"},null,8,["disable","modelValue","label"]),(0,i.bF)(h,{disable:e.isDefault,outlined:"",dense:"",modelValue:e.dimension_5,"onUpdate:modelValue":t[18]||(t[18]=t=>e.dimension_5=t),label:e.$t("dimension_5"),class:"action-field-min-with q-ma-sm"},null,8,["disable","modelValue","label"]),(0,i.bF)(h,{disable:e.isDefault,outlined:"",dense:"",modelValue:e.dimension_6,"onUpdate:modelValue":t[19]||(t[19]=t=>e.dimension_6=t),label:e.$t("dimension_6"),class:"action-field-min-with q-ma-sm"},null,8,["disable","modelValue","label"]),(0,i.bF)(h,{disable:e.isDefault,outlined:"",dense:"",modelValue:e.dimension_7,"onUpdate:modelValue":t[20]||(t[20]=t=>e.dimension_7=t),label:e.$t("dimension_7"),class:"action-field-min-with q-ma-sm"},null,8,["disable","modelValue","label"])],64)):(0,i.Q3)("",!0),e.selectedIndex>=0?((0,i.uX)(),(0,i.CE)(i.FK,{key:5},[(0,i.bF)(g,{disable:e.isDefault,label:e.$t("update"),onClick:t[21]||(t[21]=t=>e.updateActions()),class:"q-ma-sm"},null,8,["disable","label"]),(0,i.bF)(g,{disable:e.isDefault,label:e.$t("cancel"),onClick:t[22]||(t[22]=t=>e.resetAll()),class:"q-ma-sm"},null,8,["disable","label"])],64)):((0,i.uX)(),(0,i.Wv)(g,{key:6,disable:e.isDefault,label:e.$t("add_actions"),onClick:e.addActions,class:"q-ma-sm"},null,8,["disable","label","onClick"]))]),(0,i.bF)(k,{flat:"",class:"dashboard-table-style dashboard-table-height back-white q-mt-lg"},{default:(0,i.k6)((()=>[(0,i.Lk)("thead",null,[(0,i.Lk)("tr",M,[(0,i.Lk)("th",null,(0,s.v_)(e.$t("document_type")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("costing_element")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("sequence")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("quantity")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("unit_price")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("amount")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("ledger_account")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("voucher_text")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("dimension_1")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("dimension_2")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("dimension_3")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("dimension_4")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("dimension_5")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("dimension_6")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("dimension_7")),1),(0,i.Lk)("th",T,(0,s.v_)(e.$t("actions")),1)])]),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.selectedRule.actions,((l,n)=>((0,i.uX)(),(0,i.CE)("tr",{key:n,onClick:t=>e.setActiveAction(l,n),class:(0,s.C4)(["cursor-pointer",e.selectedIndex==n?"highlighted-back":""])},[(0,i.Lk)("td",null,(0,s.v_)(e.$t(l.type)),1),(0,i.Lk)("td",null,(0,s.v_)(l.mapping.costing_element),1),(0,i.Lk)("td",null,(0,s.v_)(l.mapping.sequence),1),(0,i.Lk)("td",null,(0,s.v_)(l.mapping.quantity),1),(0,i.Lk)("td",null,(0,s.v_)(l.mapping.unit_price),1),(0,i.Lk)("td",null,(0,s.v_)(l.mapping.amount),1),(0,i.Lk)("td",null,(0,s.v_)(l.mapping.ledger_account),1),(0,i.Lk)("td",null,(0,s.v_)(l.mapping.voucher_text),1),(0,i.Lk)("td",null,(0,s.v_)(l.mapping.dimension_1),1),(0,i.Lk)("td",null,(0,s.v_)(l.mapping.dimension_2),1),(0,i.Lk)("td",null,(0,s.v_)(l.mapping.dimension_3),1),(0,i.Lk)("td",null,(0,s.v_)(l.mapping.dimension_4),1),(0,i.Lk)("td",null,(0,s.v_)(l.mapping.dimension_5),1),(0,i.Lk)("td",null,(0,s.v_)(l.mapping.dimension_6),1),(0,i.Lk)("td",null,(0,s.v_)(l.mapping.dimension_7),1),(0,i.Lk)("td",null,[(0,i.bF)(v,{flat:"",dense:"",round:"",onClick:t[23]||(t[23]=(0,a.D$)((()=>{}),["stop","prevent"])),icon:"more_horiz"},{default:(0,i.k6)((()=>[(0,i.bF)(m,{"auto-close":"","transition-show":"jump-down","transition-hide":"jump-up",anchor:"bottom middle",self:"top middle"},{default:(0,i.k6)((()=>[(0,i.bF)(p,{dense:"",style:{"min-width":"100px"}},{default:(0,i.k6)((()=>[(0,i.bF)(_,{clickable:"",onClick:t=>e.removeActions(n),disable:e.isDefault},{default:(0,i.k6)((()=>[(0,i.bF)(r,null,{default:(0,i.k6)((()=>[(0,i.Lk)("span",U,(0,s.v_)(e.$t("delete")),1)])),_:1})])),_:2},1032,["onClick","disable"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])],10,I)))),128))])])),_:1})])):(0,i.Q3)("",!0)],64)}var S=l(24622),X=l(38734),j=l(18505),O=l(1595);const W=(0,i.pM)({name:"actions",mixins:[S.A,j.A],emits:["updateToml"],props:{isDefault:{type:Boolean,default:!1}},mounted(){this.initDropDowns()},methods:{resetModel(e){e&&(this.conditionExpression="",this.addConditionExpression=!1,this.action_type_select="receipt_line"),this.value="",this.amount="",this.pattern="",this.sequence="",this.dimension_1="",this.dimension_2="",this.dimension_3="",this.dimension_4="",this.dimension_5="",this.dimension_6="",this.dimension_7="",this.voucher_text="",this.ledger_account="",this.customSequence="",this.costing_element="",this.quantity_select="",this.unit_price_select="",(this.action_type_select.includes("line_charge")||this.action_type_select.includes("receipt_line"))&&(this.quantity_select="[po_quantity]",this.unit_price_select="[po_unit_price]"),(this.action_type_select.includes("line_charge")||this.action_type_select.includes("header_charge"))&&(this.sequence="original",this.costing_element="original")},resetAll(){this.resetModel(!0),this.selectedIndex=-1,this.selectedAction=null},addActions(){const e=this.prepareactionObj();this.selectedRule.actions.push(e),this.$emit("updateToml"),this.resetAll()},updateActions(){if(this.selectedIndex<0)return;const e=this.prepareactionObj();this.selectedRule.actions[this.selectedIndex]=e,this.$emit("updateToml"),this.resetAll()},prepareactionObj(){const e={};this.quantity_select&&(e["quantity"]=this.quantity_select),this.unit_price_select&&(e["unit_price"]=this.unit_price_select),this.getSequence()&&(e["sequence"]=this.getSequence()),this.getCostingElement()&&(e["costing_element"]=this.getCostingElement()),this.amount&&(e["amount"]=this.amount),this.ledger_account&&(e["ledger_account"]=this.ledger_account),this.voucher_text&&(e["voucher_text"]=this.voucher_text),this.dimension_1&&(e["dimension_1"]=this.dimension_1),this.dimension_2&&(e["dimension_2"]=this.dimension_2),this.dimension_3&&(e["dimension_3"]=this.dimension_3),this.dimension_4&&(e["dimension_4"]=this.dimension_4),this.dimension_5&&(e["dimension_5"]=this.dimension_5),this.dimension_6&&(e["dimension_6"]=this.dimension_6),this.dimension_7&&(e["dimension_7"]=this.dimension_7);const t={type:this.action_type_select,mapping:e};return this.conditionExpression&&(t["condition_expression"]=this.conditionExpression),t},getSequence(){return this.action_type_select.includes("line_charge")||this.action_type_select.includes("header_charge")?"custom"==this.sequence?this.customSequence:this.sequence:null},getCostingElement(){return this.action_type_select.includes("line_charge")||this.action_type_select.includes("header_charge")?"custom"==this.costing_element?this.value:"regex"==this.costing_element?this.costing_element+":"+this.pattern+":"+this.value:this.costing_element:null},setActiveAction(e,t){if(this.resetModel(!0),this.selectedIndex=t,this.selectedAction=e,this.selectedAction&&this.selectedAction.mapping){if(this.action_type_select=this.selectedAction.type,this.amount=this.selectedAction.mapping.amount,this.ledger_account=this.selectedAction.mapping.ledger_account,this.voucher_text=this.selectedAction.mapping.voucher_text,this.dimension_1=this.selectedAction.mapping.dimension_1,this.dimension_2=this.selectedAction.mapping.dimension_2,this.dimension_3=this.selectedAction.mapping.dimension_3,this.dimension_4=this.selectedAction.mapping.dimension_4,this.dimension_5=this.selectedAction.mapping.dimension_5,this.dimension_6=this.selectedAction.mapping.dimension_6,this.dimension_7=this.selectedAction.mapping.dimension_7,this.quantity_select=this.selectedAction.mapping.quantity,this.unit_price_select=this.selectedAction.mapping.unit_price,this.conditionExpression=this.selectedAction.condition_expression,this.conditionExpression&&(this.addConditionExpression=!0),this.selectedAction.mapping.sequence){this.sequence=this.selectedAction.mapping.sequence;const e=this.findField(this.sequence,this.sequenceOptions);e||(this.customSequence=this.selectedAction.mapping.sequence,this.sequence="custom")}if(this.selectedAction.mapping.costing_element){this.costing_element=this.selectedAction.mapping.costing_element;const e=this.findField(this.costing_element,this.costingElementOptions);if(!e)if(this.costing_element.includes(":")){let e=this.costing_element.split(":");e[0]&&(this.costing_element=e[0]),e[1]&&(this.pattern=e[1]),e[2]&&(this.value=e[1])}else this.value=this.selectedAction.mapping.costing_element,this.costing_element="custom"}}},findField(e,t){let l=!1;for(let i of t)i.value==e&&(l=!0);return l},removeActions(e){this.selectedRule.actions.splice(e,1),this.$emit("updateToml")},selectQuantity(e){this.quantity_select+=e},selectUnitPrice(e){this.unit_price_select+=e},selectConditionExpression(e){this.conditionExpression+=e},selectAmount(e){this.amount+=e},initDropDowns(){this.costingElementOptions=[{label:this.$t("original"),value:"original"},{label:this.$t("regex_replace"),value:"regex"},{label:this.$t("mapped"),value:"mapped"},{label:this.$t("custom"),value:"custom"}],this.sequenceOptions=[{label:this.$t("original"),value:"original"},{label:this.$t("increment"),value:"increment"},{label:this.$t("decrement"),value:"decrement"},{label:this.$t("mapped"),value:"mapped"},{label:this.$t("custom"),value:"custom"}],this.actionTypeOptions=[{label:this.$t("receipt_line"),value:"receipt_line"},{label:this.$t("cost_line"),value:"cost_line"},{label:this.$t("header_charge"),value:"header_charge"},{label:this.$t("line_charge"),value:"line_charge"},{label:this.$t("tax_line"),value:"tax_line"},{label:this.$t("debit_note_receipt_line"),value:"debit_note_receipt_line"},{label:this.$t("debit_note_cost_line"),value:"debit_note_cost_line"},{label:this.$t("debit_note_header_charge"),value:"debit_note_header_charge"},{label:this.$t("debit_note_line_charge"),value:"debit_note_line_charge"},{label:this.$t("debite_note_tax_line"),value:"debite_note_tax_line"},{label:this.$t("credit_note_receipt_line"),value:"credit_note_receipt_line"},{label:this.$t("credit_note_cost_line"),value:"credit_note_cost_line"},{label:this.$t("credit_note_header_charge"),value:"credit_note_header_charge"},{label:this.$t("credit_note_line_charge"),value:"credit_note_line_charge"},{label:this.$t("credit_note_tax_line"),value:"credit_note_tax_line"}],this.fieldsOptions=[{label:"po_unit_price",value:"[po_unit_price]"},{label:"invoice_unit_price",value:"[invoice_unit_price]"},{label:"approved_unit_price",value:"[approved_unit_price]"},{label:"rejected_unit_price",value:"[rejected_unit_price]"},{label:"po_quantity",value:"[po_quantity]"},{label:"invoice_quantity",value:"[invoice_quantity]"},{label:"approved_quantity",value:"[approved_quantity]"},{label:"rejected_quantity",value:"[rejected_quantity]"},{label:"po_amount",value:"[po_amount]"},{label:"invoice_amount",value:"[invoice_amount]"},{label:"expected_amount",value:"[expected_amount]"},{label:"approved_amount",value:"[approved_amount]"},{label:"po_charge_rate",value:"[po_charge_rate]"},{label:"invoice_charge_rate",value:"[invoice_charge_rate]"},{label:"approved_charge_rate",value:"[approved_charge_rate]"},{label:"po_charge_unit_price",value:"[po_charge_unit_price]"},{label:"invoice_charge_unit_price",value:"[invoice_charge_unit_price]"},{label:"approved_charge_unit_price",value:"[approved_charge_unit_price]"},{label:"po_charge_amount",value:"[po_charge_amount]"},{label:"expected_charge_amount",value:"[expected_charge_amount]"},{label:"invoice_charge_amount",value:"[invoice_charge_amount]"},{label:"approved_charge_amount",value:"[approved_charge_amount]"}]}},setup(){const e=(0,O.sk)(),{selectedRule:t}=(0,A.bP)(e);return{selectedRule:t,value:(0,X.KR)(""),amount:(0,X.KR)(""),pattern:(0,X.KR)(""),customSequence:(0,X.KR)(""),sequence:(0,X.KR)("original"),costing_element:(0,X.KR)("original"),quantity_select:(0,X.KR)("[po_quantity]"),quantitySelect:(0,X.KR)([]),action_type_select:(0,X.KR)("receipt_line"),unit_price_select:(0,X.KR)("[po_unit_price]"),ledger_account:(0,X.KR)(""),voucher_text:(0,X.KR)(""),dimension_1:(0,X.KR)(""),dimension_2:(0,X.KR)(""),dimension_3:(0,X.KR)(""),dimension_4:(0,X.KR)(""),dimension_5:(0,X.KR)(""),dimension_6:(0,X.KR)(""),dimension_7:(0,X.KR)(""),fieldsOptions:(0,X.KR)([]),sequenceOptions:(0,X.KR)([]),actionTypeOptions:(0,X.KR)([]),costingElementOptions:(0,X.KR)([]),addConditionExpression:(0,X.KR)(!1),conditionExpression:(0,X.KR)(""),selectedAction:(0,X.KR)({}),selectedIndex:(0,X.KR)(-1)}}});var P=l(12807),B=l(10386),z=l(66908),J=l(67837),N=l(84436),G=l(53999),Y=l(90124),H=l(25173),Z=l(94940),ee=l(857),te=l(56384),le=l(98582),ie=l.n(le);const se=(0,P.A)(W,[["render",Q],["__scopeId","data-v-67bc1e0c"]]),ae=se;ie()(W,"components",{QSeparator:B.A,QToggle:z.A,QInput:J.A,QMenu:N.A,QList:G.A,QItem:Y.A,QItemSection:H.A,QSelect:Z.A,QMarkupTable:ee.A,QBtn:te.A});var ne=l(6044),oe=l(100),de=l(8420),ue=l(11470);const ce={key:0,class:"q-pa-md"},re={class:"text-weight-bold text-primary font-size-16"},_e={class:"row q-gutter-md"},pe={class:"table-header-text"},me={style:{width:"100px"}},he=["onClick"],be={class:"text-red-14"},ge={key:2,class:"q-pa-md row"},ve={class:"col-6"},ke={class:"text-weight-bold text-primary font-size-16 q-pb-md"},fe={class:""},ye={class:"q-gutter-md"},qe={class:"col-6"},$e={class:"text-weight-bold text-primary font-size-16"},xe={class:"row"};function Ve(e,t,l,n,o,d){const u=(0,i.g2)("q-item-label"),c=(0,i.g2)("q-item-section"),r=(0,i.g2)("q-item"),_=(0,i.g2)("q-select"),p=(0,i.g2)("q-input"),m=(0,i.g2)("f-btn"),h=(0,i.g2)("q-checkbox"),b=(0,i.g2)("q-list"),g=(0,i.g2)("q-menu"),v=(0,i.g2)("q-btn"),k=(0,i.g2)("q-markup-table"),f=(0,i.g2)("q-separator");return(0,i.uX)(),(0,i.CE)(i.FK,null,[e.selectedRule&&Object.keys(e.selectedRule).length>0&&e.selectedRule.match_criteria?((0,i.uX)(),(0,i.CE)("div",ce,[(0,i.Lk)("p",re,(0,s.v_)(e.$t("criteria")),1),(0,i.Lk)("div",_e,[(0,i.bF)(_,{disable:e.isDefault,outlined:"",dense:"","emit-value":"","map-options":"",class:"criteria-select",modelValue:e.unit_price_select,"onUpdate:modelValue":t[0]||(t[0]=t=>e.unit_price_select=t),options:e.unit_price_options},{option:(0,i.k6)((t=>[(0,i.bF)(r,(0,s._B)((0,i.Ng)(t.itemProps)),{default:(0,i.k6)((()=>[(0,i.bF)(c,null,{default:(0,i.k6)((()=>[(0,i.bF)(u,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t(t.opt.label)),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),"selected-item":(0,i.k6)((t=>[(0,i.Lk)("div",null,(0,s.v_)(e.$t(t.opt.label)),1)])),_:1},8,["disable","modelValue","options"]),(0,i.bF)(_,{disable:e.isDefault,outlined:"",dense:"","emit-value":"","map-options":"",class:"criteria-select",modelValue:e.comparisonType,"onUpdate:modelValue":t[1]||(t[1]=t=>e.comparisonType=t),options:e.comparisonTypeList,label:e.$t("comparison_type")},null,8,["disable","modelValue","options","label"]),(0,i.bF)(_,{disable:e.isDefault,outlined:"",dense:"","emit-value":"","map-options":"",class:"criteria-select",modelValue:e.comparison_select,"onUpdate:modelValue":t[2]||(t[2]=t=>e.comparison_select=t),options:e.comparison_options,label:e.$t("comparison_operator")},null,8,["disable","modelValue","options","label"]),"outside_tolerance"!=e.comparison_select&&"within_tolerance"!=e.comparison_select?((0,i.uX)(),(0,i.Wv)(p,{key:0,disable:e.isDefault,label:e.$t("value"),type:"number",modelValue:e.value,"onUpdate:modelValue":t[3]||(t[3]=t=>e.value=t),modelModifiers:{number:!0},outlined:"",dense:"",class:"criteria-select"},null,8,["disable","label","modelValue"])):(0,i.Q3)("",!0),"outside_tolerance"==e.comparison_select?((0,i.uX)(),(0,i.Wv)(_,{key:1,disable:e.isDefault,outlined:"",dense:"","emit-value":"","map-options":"",class:"criteria-select",modelValue:e.status_select,"onUpdate:modelValue":t[4]||(t[4]=t=>e.status_select=t),options:e.status_options,label:e.$t("status")},null,8,["disable","modelValue","options","label"])):(0,i.Q3)("",!0),e.selectedIndex>=0?((0,i.uX)(),(0,i.CE)(i.FK,{key:2},[(0,i.bF)(m,{disable:e.isDefault,label:e.$t("update"),onClick:t[5]||(t[5]=t=>e.updateCriteria())},null,8,["disable","label"]),(0,i.bF)(m,{disable:e.isDefault,label:e.$t("cancel"),onClick:t[6]||(t[6]=t=>e.resetModel())},null,8,["disable","label"])],64)):((0,i.uX)(),(0,i.Wv)(m,{key:3,disable:e.isDefault,label:e.$t("add_criteria"),onClick:t[7]||(t[7]=t=>e.addCriteria())},null,8,["disable","label"]))]),(0,i.bF)(k,{flat:"",class:"dashboard-table-style dashboard-table-height back-white q-mt-lg"},{default:(0,i.k6)((()=>[(0,i.Lk)("thead",null,[(0,i.Lk)("tr",pe,[(0,i.Lk)("th",null,(0,s.v_)(e.$t("active")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("pages.rule_management.unit_price_quantity")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("comparison_type")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("comparison_operator")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("value")),1),(0,i.Lk)("th",null,(0,s.v_)(e.$t("approved")),1),(0,i.Lk)("th",me,(0,s.v_)(e.$t("actions")),1)])]),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.selectedRule.match_criteria,((l,n)=>((0,i.uX)(),(0,i.CE)("tr",{key:n,onClick:t=>e.criteriaClicked(l,n),class:(0,s.C4)(["cursor-pointer",e.selectedIndex==n?"highlighted-back":""])},[(0,i.Lk)("td",null,[(0,i.bF)(h,{dense:"",modelValue:l["active"],"onUpdate:modelValue":e=>l["active"]=e,disable:e.isDefault},null,8,["modelValue","onUpdate:modelValue","disable"])]),(0,i.Lk)("td",null,(0,s.v_)(e.$t(l.column)),1),(0,i.Lk)("td",null,(0,s.v_)(l.comparison_type?e.$t(l.comparison_type):""),1),(0,i.Lk)("td",null,(0,s.v_)(l.comparison_operator?e.$t(l.comparison_operator):""),1),(0,i.Lk)("td",null,(0,s.v_)(l.value),1),(0,i.Lk)("td",null,(0,s.v_)(l.approved),1),(0,i.Lk)("td",null,[(0,i.bF)(v,{flat:"",dense:"",round:"",onClick:t[8]||(t[8]=(0,a.D$)((()=>{}),["stop","prevent"])),icon:"more_horiz"},{default:(0,i.k6)((()=>[(0,i.bF)(g,{"auto-close":"","transition-show":"jump-down","transition-hide":"jump-up",anchor:"bottom middle",self:"top middle"},{default:(0,i.k6)((()=>[(0,i.bF)(b,{dense:"",style:{"min-width":"100px"}},{default:(0,i.k6)((()=>[(0,i.bF)(r,{clickable:"",onClick:t=>e.removeCriteria(n),disable:e.isDefault},{default:(0,i.k6)((()=>[(0,i.bF)(c,null,{default:(0,i.k6)((()=>[(0,i.Lk)("span",be,(0,s.v_)(e.$t("delete")),1)])),_:1})])),_:2},1032,["onClick","disable"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])],10,he)))),128))])])),_:1})])):(0,i.Q3)("",!0),e.showActionPanel?((0,i.uX)(),(0,i.Wv)(f,{key:1,class:"q-my-md"})):(0,i.Q3)("",!0),e.showActionPanel?((0,i.uX)(),(0,i.CE)("div",ge,[(0,i.Lk)("div",ve,[(0,i.Lk)("p",ke,(0,s.v_)(e.$t("pages.rule_management.test_rules")),1),(0,i.Lk)("div",fe,[(0,i.Lk)("div",ye,[(0,i.bF)(p,{disable:e.isDefault,label:e.$t("pages.rule_management.po_quantity"),modelValue:e.test_rules_input["po_quantity"],"onUpdate:modelValue":t[9]||(t[9]=t=>e.test_rules_input["po_quantity"]=t),outlined:"",dense:"",class:"test-rules-input"},null,8,["disable","label","modelValue"]),(0,i.bF)(p,{disable:e.isDefault,label:e.$t("po_unit_price"),modelValue:e.test_rules_input["po_unit_price"],"onUpdate:modelValue":t[10]||(t[10]=t=>e.test_rules_input["po_unit_price"]=t),outlined:"",dense:"",class:"test-rules-input"},null,8,["disable","label","modelValue"]),(0,i.bF)(p,{disable:e.isDefault,label:e.$t("pages.rule_management.invoice_quantity"),modelValue:e.test_rules_input["invoice_quantity"],"onUpdate:modelValue":t[11]||(t[11]=t=>e.test_rules_input["invoice_quantity"]=t),outlined:"",dense:"",class:"test-rules-input"},null,8,["disable","label","modelValue"]),(0,i.bF)(p,{disable:e.isDefault,label:e.$t("pages.rule_management.invoice_unit_price"),modelValue:e.test_rules_input["invouce_unit_price"],"onUpdate:modelValue":t[12]||(t[12]=t=>e.test_rules_input["invouce_unit_price"]=t),outlined:"",dense:"",class:"test-rules-input"},null,8,["disable","label","modelValue"]),(0,i.bF)(m,{label:e.$t("test"),onClick:e.testRules},null,8,["label","onClick"])])])]),(0,i.Lk)("div",qe,[(0,i.Lk)("p",$e,(0,s.v_)(e.$t("pages.rule_management.output")),1),(0,i.Lk)("div",xe,[(0,i.bF)(p,{disable:e.isDefault,modelValue:e.test_rules_output,"onUpdate:modelValue":t[13]||(t[13]=t=>e.test_rules_output=t),readonly:"",outlined:"",type:"textarea",class:"test-rules-input"},null,8,["disable","modelValue"])])])])):(0,i.Q3)("",!0)],64)}const Ce=(0,i.pM)({name:"MatchCriteria",mixins:[S.A,j.A],emits:["updateToml"],props:{isDefault:{type:Boolean,default:!1}},mounted(){this.initDropDowns()},methods:{addCriteria(){const e={column:this.unit_price_select,comparison_type:this.comparisonType,comparison_operator:this.comparison_select,approved:this.getApproved(),value:this.getValue(),active:!0};this.selectedRule.match_criteria.push(e),this.$emit("updateToml"),this.resetModel()},updateCriteria(){this.selectedIndex<0||(this.selectedRule.match_criteria[this.selectedIndex].column=this.unit_price_select,this.selectedRule.match_criteria[this.selectedIndex].comparison_type=this.comparisonType,this.selectedRule.match_criteria[this.selectedIndex].comparison_operator=this.comparison_select,this.selectedRule.match_criteria[this.selectedIndex].approved=this.getApproved(),this.selectedRule.match_criteria[this.selectedIndex].value=this.getValue(),this.$emit("updateToml"),this.resetModel())},resetModel(){this.value=null,this.status_select="true",this.comparison_select="equal",this.unit_price_select="quantity",this.comparisonType="difference",this.selectedCriteria=null,this.selectedIndex=-1},getValue(){return"outside_tolerance"==this.comparison_select||"within_tolerance"==this.comparison_select?null:this.value.toString()},getApproved(){return"outside_tolerance"==this.comparison_select?this.status_select:null},removeCriteria(e){this.selectedRule.match_criteria.splice(e,1),this.$emit("updateToml")},criteriaClicked(e,t){this.selectedCriteria=e,this.selectedIndex=t,this.preapreUpdateModel()},preapreUpdateModel(){this.selectedCriteria&&(this.value=this.selectedCriteria.value,this.status_select=this.selectedCriteria.approved,this.comparisonType=this.selectedCriteria.comparison_type,this.comparison_select=this.selectedCriteria.comparison_operator,this.unit_price_select=this.selectedCriteria.column)},testRules(){this.showSuccessToast("Test Rules")},initDropDowns(){this.comparisonTypeList=[{label:this.$t("difference"),value:"difference"},{label:this.$t("value"),value:"value"}],this.status_options=[{label:this.$t("approved"),value:"true"},{label:this.$t("rejected"),value:"false"}],this.comparison_options=[{label:this.$t("equal"),value:"equal"},{label:this.$t("greater_than"),value:"greater_than"},{label:this.$t("greater_than_or_equal_to"),value:"greater_than_or_equal_to"},{label:this.$t("less_than"),value:"less_than"},{label:this.$t("less_than_or_equal_to"),value:"less_than_or_equal_to"},{label:this.$t("within_tolerance"),value:"within_tolerance"},{label:this.$t("outside_tolerance"),value:"outside_tolerance"}]}},setup(){const e=(0,O.sk)(),{selectedRule:t}=(0,A.bP)(e);return{selectedRule:t,value:(0,X.KR)(),selectedCriteria:(0,X.KR)({}),selectedIndex:(0,X.KR)(-1),showActionPanel:(0,X.KR)(!1),status_select:(0,X.KR)("true"),comparison_select:(0,X.KR)("equal"),unit_price_select:(0,X.KR)("quantity"),test_rules_output:(0,X.KR)(""),test_rules_input:(0,X.KR)({po_quantity:"",po_unit_price:"",invoice_quantity:"",invouce_unit_price:""}),comparisonType:(0,X.KR)("difference"),comparisonTypeList:(0,X.KR)([]),status_options:(0,X.KR)([]),comparison_options:(0,X.KR)([]),unit_price_options:[{label:"quantity",value:"quantity"},{label:"unit_price",value:"unit_price"},{label:"charge_rate",value:"charge_rate"},{label:"charge_per_unit",value:"charge_per_unit"}]}}});var Re=l(13796),Le=l(80460);const Fe=(0,P.A)(Ce,[["render",Ve],["__scopeId","data-v-8e95fcf4"]]),Ae=Fe;ie()(Ce,"components",{QSelect:Z.A,QItem:Y.A,QItemSection:H.A,QItemLabel:Re.A,QInput:J.A,QMarkupTable:ee.A,QCheckbox:Le.A,QBtn:te.A,QMenu:N.A,QList:G.A,QSeparator:B.A});var we=l(64775),De=l(23018),Ke=l(76956),Ee=l(66693),Me=l(57706),Te=l(10828),Ie=(l(53749),l(75125),l(25773)),Ue=function(e,t,l,i){function s(e){return e instanceof l?e:new l((function(t){t(e)}))}return new(l||(l=Promise))((function(l,a){function n(e){try{d(i.next(e))}catch(t){a(t)}}function o(e){try{d(i["throw"](e))}catch(t){a(t)}}function d(e){e.done?l(e.value):s(e.value).then(n,o)}d((i=i.apply(e,t||[])).next())}))};const Qe=(0,i.pM)({name:"RuleManagement",mixins:[S.A,j.A,ne.A],components:{Loader:de.A,Actions:ae,SubHeader:Ee.A,JsonViewer:De.A,PrismEditor:Me.N,MatchCriteria:Ae,BackToSettings:Ie.A},data(){return{id:(0,X.KR)(""),name:(0,X.KR)(""),description:(0,X.KR)(""),docId:(0,X.KR)(""),isDefault:(0,X.KR)(!1)}},watch:{loading_settings:{handler:function(e,t){0==e&&1==t&&!1===this.user_settings["RULE_MANAGER_MODULES_SETTINGS"]&&this.$router.go(-1)}}},mounted(){this.init(),this.initDropDowns()},methods:{init(){return Ue(this,void 0,void 0,(function*(){if(this.inforM3TomlMappingId=this.$route.params.id,this.inforM3TomlMappingId)return void(yield this.getExportConfigurationMapping());const e=this.getDataFromSessionByKey(Ke.tn);e||this.$router.push("/settings/toml-samples"),this.prepareDataFromCache(e)}))},initDropDowns(){this.section_options=[{label:this.$t("cost_lines"),value:"cost_lines"},{label:this.$t("tax_lines"),value:"tax_lines"},{label:this.$t("receipt_lines"),value:"receipt_lines"},{label:this.$t("line_charges"),value:"line_charges"},{label:this.$t("header_charges"),value:"header_charges"}]},prepareDataFromCache(e){this.id=e.id,this.name=e.mapping_name,this.isDefault=e.isDefault,this.toml_rules=e.mapping_value,this.description=e.mapping_description,this.prepareRuleManagerData()},getExportConfigurationMapping(){return Ue(this,void 0,void 0,(function*(){try{this.showLoading();const e=yield ue.Y1.getExportConfigurationMapping(this.inforM3TomlMappingId);if(!e.success)throw{message:e.data.message};this.toml_rules=decodeURIComponent(e.data.mapping_value),this.prepareRuleManagerData()}catch(e){const t=we.t.getErrorMessage(e);this.showErrorToast(t),logError(e)}finally{this.hideLoading()}}))},updateTomlConfig(){return Ue(this,void 0,void 0,(function*(){try{if(this.isDefault)return;let e;if(this.showLoading(),this.inforM3TomlMappingId)e=yield ue.Y1.updateTomlConfig(this.inforM3TomlMappingId,this.toml_rules);else{const t=new FormData;t.append("type",Ke.FP),t.append("mapping_name",this.name),t.append("mapping_value",this.toml_rules),t.append("mapping_description",this.description),this.id&&t.append("mapping_id",this.id),e=yield ue.Y1.duplicateTomlMappingSamples(t),e.data&&e.data.id&&(this.id=e.data.id,this.updateCacheData())}if(!e.success)throw{message:e.data.message};this.showSuccessToast(this.$t("pages.messages.MSG_SAVE"))}catch(e){const t=we.t.getErrorMessage(e);this.showErrorToast(t),logError(e)}finally{this.hideLoading()}}))},updateCacheData(){const e=this.getDataFromSessionByKey(Ke.tn);e&&(e.id=this.id,e.mapping_name=this.name,e.mapping_value=this.toml_rules,e.mapping_description=this.description,this.setDataToSessionStorage(Ke.tn,e))},prepareRuleManagerData(){this.json_rules=F().parse(this.toml_rules),this.rules=this.json_rules.conflict_resolution.rule},updateToml(){this.toml_rules=oe.stringify(this.json_rules)},addExampleCode(){this.toml_rules="\n[[rules]]\n      "},highlighter(e){return(0,Te.highlight)(e,Te.languages.py,"py")},ruleClick(e,t){this.selectedRule=e,this.selectedIndex=t,this.selectedRule.match_criteria||(this.selectedRule.match_criteria=[]),this.selectedRule.actions||(this.selectedRule.actions=[]),this.preapreUpdateModel()},preapreUpdateModel(){this.rule_name=this.selectedRule.name,this.sectionModel=this.selectedRule.section},removeRule(e){this.rules.splice(e,1),this.updateToml()},addRule(){if(!this.rule_name)return void this.showErrorToast(this.$t("pages.rule_management.please_enter_rule_name"));const e={name:this.rule_name,section:this.sectionModel,active:!0,match_criteria:[],actions:[]};this.rules.push(e),this.updateToml(),this.resetModel()},updateRule(){this.selectedIndex&&(this.rules[this.selectedIndex].name=this.rule_name,this.rules[this.selectedIndex].section=this.sectionModel,this.updateToml(),this.resetModel())},resetModel(){this.rule_name="",this.sectionModel="cost_lines",this.selectedRule=null,this.selectedIndex=-1},changeAction(){!0===this.headerCheckbox?this.selectAllRows():this.resetAllSelectedRows()},resetAllSelectedRows(){this.selectionList=[],this.headerCheckbox=!1,this.rules.forEach((e=>{e["active"]=!1}))},selectAllRows(){this.rules.forEach((e=>{e["active"]=!0}))},toggleMenu(){this.showExportPanel=!this.showExportPanel},loadExportJson(){return Ue(this,void 0,void 0,(function*(){try{if(!this.docId)return;let e=yield ue.M8.getInforExportApiJson(this.docId);if(!e||!e.success)throw{message:e.message};this.exportJson=e.data}catch(e){return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void logError(e)}}))}},setup(){const e=(0,O.t8)(),{}=(0,A.bP)(e),{getTomlFile:t}=(0,O.t8)(),l=(0,O.Bu)(),{loading_settings:i,user_settings:s}=(0,A.bP)(l),a=(0,O.sk)();a.$reset();const{selectedRule:n}=(0,A.bP)(a);return{actions:(0,X.KR)([]),rule_name:(0,X.KR)(""),tolerance:(0,X.KR)(""),headerCheckbox:(0,X.KR)(!1),inforM3TomlMappingId:(0,X.KR)(""),sectionModel:(0,X.KR)("cost_lines"),action_type_options:(0,X.KR)([]),section_options:(0,X.KR)([]),rules:(0,X.KR)([]),showActivityPanel:(0,X.KR)(!0),splitterModel:(0,X.KR)(65),selectionList:(0,X.KR)([]),exportJson:(0,X.KR)([]),selectedIndex:(0,X.KR)(-1),toml_rules:(0,X.KR)(""),json_rules:(0,X.KR)({}),showExportPanel:(0,X.KR)(!1),loading_settings:i,user_settings:s,selectedRule:n,getTomlFile:t}}});var Se=l(98072);const Xe=(0,P.A)(Qe,[["render",R],["__scopeId","data-v-1e45140e"]]),je=Xe;ie()(Qe,"components",{QSplitter:Se.A,QInput:J.A,QSelect:Z.A,QMarkupTable:ee.A,QCheckbox:Le.A,QBtn:te.A,QMenu:N.A,QList:G.A,QItem:Y.A,QItemSection:H.A,QSeparator:B.A})}}]);