"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[2969],{82969:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Fo});var o=i(83673),a=i(62323),s=i(98880);const l=e=>((0,o.dD)("data-v-6ce54586"),e=e(),(0,o.Cn)(),e),r={class:"row q-pl-md q-pr-md highlighted-back"},n={class:"width-100-percent"},d=l((()=>(0,o._)("img",{width:"24",src:"back_new.svg"},null,-1))),c={style:{"vertical-align":"middle","margin-left":"10px","font-size":"20px",cursor:"pointer"}},h={key:1,class:"q-btn invisible",style:{"min-height":"1.572em"}},u={class:"align-right2"},m={class:"mode-banner"},g={key:0,class:"table-mode mode-on"},_={key:1,class:"column-mode mode-on"},p={key:2,class:"table-row-mode mode-on"},w={key:1,class:"row q-pl-md q-pr-md q-pb-md"},f={key:2,class:"text-center text-h3 q-pl-xl q-pr-md"},b={style:{"padding-left":"5px"}},v={key:3,class:"row q-pl-md q-pr-md q-pb-md"},y={class:"width-120 q-mt-sm",id:"left_section",ref:"left_section"},C={class:"full-width back-white full-height"},x={class:"row justify-center q-pl-md q-pr-md q-pt-md"},k={class:"secondary-c-text text-h6 text-weight-bold"},S={class:"full-width left-scroll-area-height scrolle-y q-pa-sm"},E=["data-id","src"],D={class:"right_section_2a q-pl-sm",id:"right_section",ref:"right_section"},I={class:"row"},O={class:"full-width"},A={class:"image_control_panel"},T={class:"row"},R={class:"panel-left col-sm-6 col-md-6 col-lg-6"},L={class:"row"},W={class:"panel-middle col-sm-1 col-md-1 col-lg-1 mt-8"},z={class:"page-numbers"},P={class:"panel-right col-sm-5 col-md-5 col-lg-5"},$=l((()=>(0,o._)("img",{src:"edit.svg",width:"20"},null,-1))),q=l((()=>(0,o._)("img",{src:"cancel.svg",width:"20"},null,-1))),N=l((()=>(0,o._)("img",{src:"save.svg",width:"20"},null,-1))),M=l((()=>(0,o._)("img",{src:"auto-detection.svg",width:"25"},null,-1))),H=l((()=>(0,o._)("img",{src:"restore_ext_cols.svg",width:"26"},null,-1))),U=l((()=>(0,o._)("img",{src:"all-columns.svg",width:"28"},null,-1))),F=l((()=>(0,o._)("img",{src:"column.svg",width:"24"},null,-1))),j=l((()=>(0,o._)("img",{src:"blocked_column2.svg",width:"24"},null,-1))),V=l((()=>(0,o._)("img",{src:"trash-bin-default.svg",width:"21"},null,-1))),Z=l((()=>(0,o._)("img",{width:"24",height:"24",src:"zoom_in.svg"},null,-1))),Y=l((()=>(0,o._)("img",{width:"24",height:"24",src:"zoom_out.svg"},null,-1))),B=l((()=>(0,o._)("img",{width:"24",height:"24",src:"ocr_icon.svg"},null,-1))),X={class:"float-right"},Q={class:"full-width table-extraction-view scroll-area-height-img scrolle-y",id:"image_container"},J={class:"full-width"},K={class:"image_control_panel"},G={class:"row"},ee={class:"col-sm-12 col-md-12 col-lg-12"},te={style:{display:"inline-table",position:"relative",top:"-1px"}},ie={class:"text-center"},oe=l((()=>(0,o._)("br",null,null,-1))),ae={class:"ai-indicator"},se={class:"text-center"},le=l((()=>(0,o._)("br",null,null,-1))),re={class:"ai-indicator"},ne={key:0,class:"text-center"},de=l((()=>(0,o._)("span",null," Training Mode ",-1))),ce=l((()=>(0,o._)("br",null,null,-1))),he={class:"switch-training-mode"},ue=l((()=>(0,o._)("span",{class:"slider"},null,-1))),me={class:"float-right p-t-0"},ge={class:"mode-toggle"},_e=l((()=>(0,o._)("img",{src:"refresh_dark.svg",width:"22"},null,-1))),pe=l((()=>(0,o._)("img",{src:"settings_dark.svg",width:"24"},null,-1))),we=l((()=>(0,o._)("img",{src:"column.svg",width:"24"},null,-1))),fe=l((()=>(0,o._)("img",{src:"blocked_column2.svg",width:"24"},null,-1))),be=l((()=>(0,o._)("img",{src:"plus_circle_black.svg",width:"24"},null,-1))),ve=l((()=>(0,o._)("img",{src:"trash-bin-default.svg",width:"22"},null,-1))),ye={key:0},Ce={class:"full-width",id:"change-locale"},xe=["innerHTML"],ke={class:"full-width back-white",id:"table"},Se={key:0,class:"row q-pt-xl full-width",style:{display:"flex"}},Ee={class:"q-ml-sm",style:{width:"30%"}},De={style:{width:"50%"},class:"q-ml-sm"},Ie={style:{width:"82%"},class:"q-ml-sm q-mt-sm"},Oe={key:1,class:"row q-pt-xl"},Ae={class:"q-ml-sm"},Te={class:"row q-mb-md"};function Re(e,t,i,l,Re,Le){const We=(0,o.up)("DocumentLock"),ze=(0,o.up)("MessageBanner"),Pe=(0,o.up)("q-icon"),$e=(0,o.up)("q-btn"),qe=(0,o.up)("ErrorDocumentView"),Ne=(0,o.up)("q-tooltip"),Me=(0,o.up)("autoTesting"),He=(0,o.up)("MultiSelectAreasImageTblV3"),Ue=(0,o.up)("AIDialGauge"),Fe=(0,o.up)("q-toggle"),je=(0,o.up)("IgnoreTableValidation"),Ve=(0,o.up)("scriptBtn"),Ze=(0,o.up)("Classification"),Ye=(0,o.up)("q-item-label"),Be=(0,o.up)("q-item-section"),Xe=(0,o.up)("q-item"),Qe=(0,o.up)("q-select"),Je=(0,o.up)("LineItemsTblExtV3"),Ke=(0,o.up)("DeleteRulesBtn"),Ge=(0,o.up)("invoice-save-export"),et=(0,o.up)("q-splitter"),tt=(0,o.up)("q-avatar"),it=(0,o.up)("q-card-section"),ot=(0,o.up)("q-card-actions"),at=(0,o.up)("q-card"),st=(0,o.up)("q-dialog"),lt=(0,o.up)("q-space"),rt=(0,o.up)("Loader"),nt=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(We,{document_version:e.document_version,trigger_document_lock:e.trigger_document_lock},null,8,["document_version","trigger_document_lock"]),""!==e.error_message?((0,o.wg)(),(0,o.j4)(ze,{key:0,back_route:!0,message:e.error_message,messageCategoryClass:e.error_class},null,8,["message","messageCategoryClass"])):(0,o.kq)("",!0),(0,o._)("div",r,[(0,o._)("div",n,[!1===e.table_train?((0,o.wg)(),(0,o.j4)($e,{key:0,flat:"",rounded:"",color:"primary",class:"secondary-c-text",onClick:e.back},{default:(0,o.w5)((()=>[(0,o.Wm)(Pe,{class:"text-red-13",size:"sm"},{default:(0,o.w5)((()=>[d])),_:1}),(0,o._)("label",c,(0,a.zw)(e.$t("back")),1)])),_:1},8,["onClick"])):((0,o.wg)(),(0,o.iD)("div",h)),(0,o._)("span",u,[(0,o._)("span",m,[e.enableEditing?((0,o.wg)(),(0,o.iD)("span",g,(0,a.zw)(e.$t("table_mode")),1)):(0,o.kq)("",!0),e.enableColumnEditing?((0,o.wg)(),(0,o.iD)("span",_,(0,a.zw)(e.$t("column_mode")),1)):(0,o.kq)("",!0),e.isRowMode?((0,o.wg)(),(0,o.iD)("span",p,(0,a.zw)(e.$t("row_mode_on")),1)):(0,o.kq)("",!0)]),(0,o.Wm)($e,{flat:"",rounded:"",class:"helpbtn",color:"#2388AE",icon:"help",onClick:t[0]||(t[0]=t=>e.goHelp()),label:e.$t("pages.screen2b.help"),target:"_blank"},null,8,["label"])])])]),e.doc_fetch_error?((0,o.wg)(),(0,o.iD)("div",w,[(0,o.Wm)(qe)])):e.account_block?((0,o.wg)(),(0,o.iD)("div",f,[(0,o.Wm)(Pe,{class:"text-blue",style:{"font-size":"32px"},name:"info"}),(0,o._)("span",b,(0,a.zw)(e.$t("block_supplier_warning")),1)])):((0,o.wg)(),(0,o.iD)("div",v,[(0,o._)("div",y,[(0,o._)("div",C,[(0,o._)("div",x,[(0,o._)("span",k,(0,a.zw)(e.$t("pages.screen2b.pages")),1)]),(0,o._)("div",S,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.images,((i,s)=>((0,o.wg)(),(0,o.iD)("img",{"data-id":s,key:s,src:e.baseUrl+"/"+i.path,class:(0,a.C_)(["q-pa-sm shadow-5 full-width q-ma-sm cursor-pointer",s===this.page-1?"active":""]),style:{height:"auto"},onClick:t[1]||(t[1]=(...t)=>e.imageClicked&&e.imageClicked(...t))},null,10,E)))),128))])])],512),(0,o._)("div",D,[(0,o._)("div",I,[(0,o.Wm)(et,{modelValue:e.splitterModel,"onUpdate:modelValue":[t[22]||(t[22]=t=>e.splitterModel=t),t[23]||(t[23]=t=>e.windowResize())],limits:[30,100],class:"scroll-area-height-table full-width"},{before:(0,o.w5)((()=>[(0,o._)("div",O,[(0,o._)("div",A,[(0,o._)("div",T,[(0,o._)("div",R,[(0,o._)("div",L,(0,a.zw)(e.record.filename),1)]),(0,o._)("div",W,[(0,o._)("span",z,(0,a.zw)(e.currentPage())+"/"+(0,a.zw)(e.images.length),1)]),(0,o._)("div",P,[e.training_mode?((0,o.wg)(),(0,o.j4)($e,{key:0,flat:"",class:"p-4 float-right",onClick:t[2]||(t[2]=t=>{t.stopPropagation(),e.enableDrawing()})},{default:(0,o.w5)((()=>[$,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("edit")),1)])),_:1})])),_:1})):(0,o.kq)("",!0),e.enableEditing&&e.training_mode?((0,o.wg)(),(0,o.j4)($e,{key:1,flat:"",class:"p-4 float-right",onClick:t[3]||(t[3]=t=>{t.stopPropagation(),e.restrictDrawing()})},{default:(0,o.w5)((()=>[q,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("cancel_edit")),1)])),_:1})])),_:1})):(0,o.kq)("",!0),(e.enableEditing||e.enableColumnEditing)&&e.training_mode?((0,o.wg)(),(0,o.j4)($e,{key:2,flat:"",class:"p-4 float-right",onClick:t[4]||(t[4]=t=>{t.stopPropagation(),e.saveTableCoordinates()})},{default:(0,o.w5)((()=>[N,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("save")),1)])),_:1})])),_:1})):(0,o.kq)("",!0),e.training_mode?((0,o.wg)(),(0,o.j4)($e,{key:3,flat:"",class:"p-4 float-right",onClick:e.autoDetectTables},{default:(0,o.w5)((()=>[M,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("autodetect_tables")),1)])),_:1})])),_:1},8,["onClick"])):(0,o.kq)("",!0),e.training_mode&&e.extracted_columns&&0!==Object.keys(e.extracted_columns).length?((0,o.wg)(),(0,o.j4)($e,{key:4,flat:"",class:"p-4 float-right",onClick:t[5]||(t[5]=t=>e.toggleExtractedColumnMode(!0))},{default:(0,o.w5)((()=>[H,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("restore_extracted_columns")),1)])),_:1})])),_:1})):(0,o.kq)("",!0),e.enableColumnEditing&&e.training_mode?((0,o.wg)(),(0,o.j4)($e,{key:5,flat:"",class:"p-4 float-right",onClick:e.addColumnForAll},{default:(0,o.w5)((()=>[U,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("use_same_column_for_all")),1)])),_:1})])),_:1},8,["onClick"])):(0,o.kq)("",!0),e.training_mode?((0,o.wg)(),(0,o.j4)($e,{key:6,flat:"",class:"p-4 float-right",onClick:e.addColumn},{default:(0,o.w5)((()=>[F,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("add_column")),1)])),_:1})])),_:1},8,["onClick"])):(0,o.kq)("",!0),e.isColumnSelectedForDelete()&&e.training_mode?((0,o.wg)(),(0,o.j4)($e,{key:7,flat:"",class:"p-4 float-right",onClick:e.removeSelectedColumn},{default:(0,o.w5)((()=>[j,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("delete_selected_column")),1)])),_:1})])),_:1},8,["onClick"])):(0,o.kq)("",!0),e.enableColumnEditing&&e.training_mode?((0,o.wg)(),(0,o.j4)($e,{key:8,flat:"",class:"p-4 float-right highlight-text",onClick:t[6]||(t[6]=t=>{t.stopPropagation(),e.removeAllColumns()})},{default:(0,o.w5)((()=>[V,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("remove_all_columns")),1)])),_:1})])),_:1})):(0,o.kq)("",!0),(0,o.Wm)($e,{flat:"",class:"p-4 float-right",onClick:e.zoomIn},{default:(0,o.w5)((()=>[Z,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("zoom_in")),1)])),_:1})])),_:1},8,["onClick"]),(0,o.Wm)($e,{flat:"",class:"p-4 float-right",onClick:e.zoomOut},{default:(0,o.w5)((()=>[Y,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("zoom_out")),1)])),_:1})])),_:1},8,["onClick"]),!1!==e.table_train||e.isReadOnly?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)($e,{key:9,flat:"",class:"float-right pr-6 pl-6",onClick:e.viewOCRDocument},{default:(0,o.w5)((()=>[B,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("ocr_view")),1)])),_:1})])),_:1},8,["onClick"])),(0,o._)("span",X,[(0,o.Wm)(Me,{onSetApiData:e.setApiData},null,8,["onSetApiData"])])])])])]),(0,o._)("div",Q,[(0,o.Wm)($e,{id:"menu_btn",round:"",icon:"chevron_left",size:"xs",class:"text-grey-6 toggler-right m-t-5",onClick:t[7]||(t[7]=t=>e.toggler())}),(0,o.Wm)(He,{"pos-correction":!1,width:e.imageWidth,cropUrl:e.image,enableEditing:e.enableEditing,tableAreas:e.tableAreasStr,isRowMode:e.isRowMode,onSaveColumnCoords:e.saveColumnCoords,onToggleExtractedColumnMode:e.toggleExtractedColumnMode},null,8,["width","cropUrl","enableEditing","tableAreas","isRowMode","onSaveColumnCoords","onToggleExtractedColumnMode"])])])),after:(0,o.w5)((()=>[(0,o._)("div",J,[(0,o._)("div",K,[(0,o._)("div",G,[(0,o._)("div",ee,[(0,o.Wm)(Ue),(0,o._)("table",te,[(0,o._)("tr",null,[(0,o._)("td",ie,[(0,o._)("span",null,(0,a.zw)(e.$t("ai_tables")),1),oe,(0,o._)("span",ae,(0,a.zw)(e.ai_tables),1)]),(0,o._)("td",se,[(0,o._)("span",null,(0,a.zw)(e.$t("ai_rules")),1),le,(0,o._)("span",re,(0,a.zw)(e.ai_rules),1)]),e.isReadOnly||!1===e.extractable?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("td",ne,[de,ce,(0,o._)("label",he,[(0,o.wy)((0,o._)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=t=>e.training_mode=t)},null,512),[[s.e8,e.training_mode]]),ue])]))])]),(0,o._)("span",me,[(0,o._)("span",ge,[this.record.tables&&null!=this.record.tables&&e.training_mode?((0,o.wg)(),(0,o.j4)(Fe,{key:0,modelValue:e.isRowMode,"onUpdate:modelValue":[t[9]||(t[9]=t=>e.isRowMode=t),t[10]||(t[10]=t=>e.setRowMode())],color:"primary"},{default:(0,o.w5)((()=>[(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("row_mode")),1)])),_:1})])),_:1},8,["modelValue"])):(0,o.kq)("",!0)]),this.record.tables&&null!=this.record.tables&&e.training_mode?((0,o.wg)(),(0,o.j4)($e,{key:0,flat:"",class:"p-4",color:"grey-8",onClick:t[11]||(t[11]=t=>{t.stopPropagation(),e.revertChanges()})},{default:(0,o.w5)((()=>[_e,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("revert_changes")),1)])),_:1})])),_:1})):(0,o.kq)("",!0),this.record.tables&&null!=this.record.tables&&e.training_mode?((0,o.wg)(),(0,o.j4)($e,{key:1,flat:"",class:"p-4",onClick:t[12]||(t[12]=t=>{t.stopPropagation(),e.openLineItemAdvanceSettings()})},{default:(0,o.w5)((()=>[pe,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("table_settings")),1)])),_:1})])),_:1})):(0,o.kq)("",!0),(0,o.Wm)(je),(0,o.Wm)(Ve),this.record.tables&&null!=this.record.tables&&e.training_mode?((0,o.wg)(),(0,o.j4)($e,{key:2,flat:"",class:"p-4",color:"primary",onClick:t[13]||(t[13]=t=>{t.stopPropagation(),e.addColumnInLineItems()})},{default:(0,o.w5)((()=>[we,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("add_new_table_column")),1)])),_:1})])),_:1})):(0,o.kq)("",!0),this.record.tables&&null!=this.record.tables&&!e.isReadOnly?((0,o.wg)(),(0,o.j4)($e,{key:3,flat:"",class:"p-4",color:"grey-6",onClick:t[14]||(t[14]=t=>e.disabledCustomColumnsDialog())},{default:(0,o.w5)((()=>[fe,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("diabled_custom_columns")),1)])),_:1})])),_:1})):(0,o.kq)("",!0),e.training_mode||!this.record.tables||null==this.record.tables||e.isReadOnly?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)($e,{key:4,flat:"",class:"p-4",color:"grey-6",onClick:t[15]||(t[15]=t=>e.addNewLineItem())},{default:(0,o.w5)((()=>[be,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("add_row")),1)])),_:1})])),_:1})),e.training_mode?((0,o.wg)(),(0,o.j4)($e,{key:5,flat:"",class:"p-4",color:"primary",onClick:t[16]||(t[16]=t=>{t.stopPropagation(),e.deleteAllExtractedData()})},{default:(0,o.w5)((()=>[ve,(0,o.Wm)(Ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("delete_all_data")),1)])),_:1})])),_:1})):(0,o.kq)("",!0),!1===e.table_train&&e.isOcrButtonEnabled()?((0,o.wg)(),(0,o.j4)(Ze,{key:6,show_btn:!e.isReadOnly,force_ocr:!0,language_origin:this.record.doc_origin,doctype:this.record.doc_type},null,8,["show_btn","language_origin","doctype"])):(0,o.kq)("",!0)])]),!0===e.is_debug?((0,o.wg)(),(0,o.iD)("div",ye,(0,a.zw)(e.record.filter_values&&Array.isArray(e.record.filter_values)&&e.record.filter_values.length>0?"FILTER VALUES: "+e.record.filter_values.join():"FILTER VALUES:  NOT FOUND"),1)):(0,o.kq)("",!0)])])]),(0,o._)("div",Ce,[!0===e.table_train?((0,o.wg)(),(0,o.j4)(Qe,{key:0,modelValue:e.languageOrigin,"onUpdate:modelValue":[t[17]||(t[17]=t=>e.languageOrigin=t),t[18]||(t[18]=t=>{e.changeOriginConfirmDialog=!0})],class:"q-pl-sm",options:e.language_origin_list,"emit-value":"","map-options":"",label:e.$t("update_amount_date_format"),disable:e.isReadOnly},{option:(0,o.w5)((e=>[(0,o.Wm)(Xe,(0,a.vs)((0,o.F4)(e.itemProps)),{default:(0,o.w5)((()=>[(0,o.Wm)(Be,null,{default:(0,o.w5)((()=>[(0,o.Wm)(Ye,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.opt.label),1)])),_:2},1024),e.opt.description?((0,o.wg)(),(0,o.j4)(Ne,{key:0},{default:(0,o.w5)((()=>[(0,o._)("span",{innerHTML:e.opt.description},null,8,xe)])),_:2},1024)):(0,o.kq)("",!0)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options","label","disable"])):(0,o.kq)("",!0)]),(0,o._)("div",ke,[(0,o.Wm)(Je,{apiDataProp:e.record,extractedData:e.extractedData,currentPageNo:e.page,isRowMode:e.isRowMode,isReadOnly:e.isReadOnly,onUpdateExtractionDataForSave:e.updateExtractionDataForSave,onLoadNewPageImage:e.loadNewPageImage,onSetTableRowCorrdinates:e.setTableRowCorrdinates,training_mode:e.training_mode},null,8,["apiDataProp","extractedData","currentPageNo","isRowMode","isReadOnly","onUpdateExtractionDataForSave","onLoadNewPageImage","onSetTableRowCorrdinates","training_mode"]),!0===e.table_train?((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[e.isReadOnly?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",Se,[(0,o._)("div",Ee,[(0,o.Wm)($e,{color:"primary",label:e.$t("save"),class:"full-width",onClick:t[19]||(t[19]=t=>e.saveDataForV3())},null,8,["label"])]),(0,o._)("div",De,[(0,o.Wm)($e,{color:"primary",label:e.$t("save_re_extract"),class:"full-width",onClick:t[20]||(t[20]=t=>e.saveDataForV3(!0))},null,8,["label"])]),(0,o._)("div",Ie,[(0,o.Wm)(Ke,{docId:e.record.doc_id,onAutoDetectTables:e.autoDetectTables,token:e.token},null,8,["docId","onAutoDetectTables","token"])])]))],64)):((0,o.wg)(),(0,o.iD)(o.HY,{key:1},[!e.isReadOnly&&e.doc2AppMode?((0,o.wg)(),(0,o.j4)(Ge,{key:0,enableExportButton:e.enableExportButton,onSetApiData:e.setFieldsData,onAutoDetectTables:e.autoDetectTables},null,8,["enableExportButton","onSetApiData","onAutoDetectTables"])):(0,o.kq)("",!0),e.doc2AppMode?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",Oe,[(0,o.Wm)($e,{color:"primary",label:e.$t("pages.screen2a.contact"),icon:"check",class:"full-width",onClick:t[21]||(t[21]=t=>e.goFormular())},null,8,["label"])]))],64))])])),_:1},8,["modelValue"])])],512)])),(0,o.Wm)(st,{modelValue:e.changeOriginConfirmDialog,"onUpdate:modelValue":t[26]||(t[26]=t=>e.changeOriginConfirmDialog=t),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(at,null,{default:(0,o.w5)((()=>[(0,o.Wm)(it,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,o.w5)((()=>[(0,o.Wm)(tt,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,o.Wm)(it,{class:"row items-center"},{default:(0,o.w5)((()=>[(0,o._)("span",Ae,(0,a.zw)(e.$t("split_text_confirm")),1)])),_:1}),(0,o.Wm)(ot,{align:"right"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)($e,{label:e.$t("cancel"),class:"bg-grey-3",onClick:t[24]||(t[24]=t=>e.setLanguage())},null,8,["label"]),[[nt]]),(0,o.Wm)($e,{label:e.$t("proceed"),class:"q-mr-sm",color:"primary",onClick:t[25]||(t[25]=t=>e.changeOrigin())},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(st,{modelValue:e.ai_table_warning,"onUpdate:modelValue":t[29]||(t[29]=t=>e.ai_table_warning=t),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(at,null,{default:(0,o.w5)((()=>[(0,o.Wm)(it,{class:"row items-center q-pb-none"},{default:(0,o.w5)((()=>[(0,o.Wm)(Pe,{name:"warning",size:"md",color:"warning","text-color":"white"}),(0,o.Wm)(lt)])),_:1}),(0,o.Wm)(it,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("ai_table_override_warning")),1)])),_:1}),(0,o._)("div",Te,[(0,o.Wm)(lt),(0,o.Wm)($e,{flat:"",color:"grey",label:e.$t("back"),onClick:t[27]||(t[27]=e=>this.$router.back())},null,8,["label"]),(0,o.Wm)($e,{flat:"",color:"primary",label:e.$t("continue"),onClick:t[28]||(t[28]=t=>e.doManualTraining())},null,8,["label"])])])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(rt)],64)}var Le=i(30052),We=i.n(Le),ze=i(54268),Pe=i(10321),$e=i(28741),qe=i(77378),Ne=i(98303),Me=i(61959),He=i(72113),Ue=i(45401),Fe=i(47253),je=i(88432),Ve=i(93033),Ze=i(56815),Ye=i(5029),Be=i(28239),Xe=i(37295),Qe=i(41891),Je=i(97570),Ke=i(88469),Ge=i(42691),et=i(7153),tt=i(49405);const it={key:0,class:"back-white"},ot={key:1},at={key:2},st={style:{"padding-left":"5px"}},lt={style:{"padding-left":"5px"}},rt={style:{"padding-left":"5px"}},nt={style:{"padding-left":"5px"}},dt={key:0,class:"q-pa-md q-gutter-sm"},ct={class:"text-weight-bold"},ht={class:"row items-center"},ut={style:{width:"40%",margin:"auto"}},mt={class:"input-text validation-icon",style:{width:"60%"}},gt={class:"row items-center q-mb-md"},_t={style:{width:"40%",margin:"auto"}},pt={style:{width:"60%"}},wt={class:"q-pa-md"},ft={class:"row items-center"},bt={style:{width:"40%",margin:"auto"}},vt={style:{width:"60%"}},yt={class:"row items-center"},Ct={style:{width:"40%",margin:"auto"}},xt={style:{width:"60%"}},kt={class:"row items-center"},St={style:{width:"40%",margin:"auto"}},Et={style:{width:"60%"}},Dt={class:"row items-center"},It={style:{width:"40%",margin:"auto"}},Ot={style:{width:"60%"}},At={class:"row items-center"},Tt={style:{width:"40%",margin:"auto"}},Rt={style:{width:"60%"}},Lt={key:0,class:"row items-center"},Wt={style:{width:"1000%",margin:"auto"}},zt={class:"bg-grey-3"},Pt={class:"text-h4 text-uppercase text-left"},$t={class:"text-h4 text-uppercase text-left"},qt={class:"text-h4 text-uppercase text-left"},Nt={class:"text-h4 text-uppercase text-left"},Mt=(0,o._)("img",{src:"trash-bin-default.svg",width:"20"},null,-1),Ht={class:"text-weight-bold"},Ut={style:{"margin-bottom":"20px"},class:"row full-width mb-10 mt-8"},Ft={style:{width:"50%"}},jt=(0,o._)("div",{style:{width:"50%"},class:"pl-20"},null,-1),Vt={style:{"margin-bottom":"20px"},class:"row full-width mb-10"},Zt={style:{width:"50%"}},Yt={style:{width:"50%"},class:"pl-20"},Bt={key:0,style:{"margin-bottom":"20px"},class:"row full-width mb-10"},Xt={style:{width:"100%"}},Qt={style:{"margin-bottom":"20px"},class:"row full-width mb-10"},Jt={style:{width:"100%"}},Kt={class:"q-ml-sm"},Gt={class:"q-ml-sm"},ei={class:"text-weight-bold"},ti={class:"q-ml-sm"},ii={class:"q-ml-sm"};function oi(e,t,i,l,r,n){const d=(0,o.up)("q-th"),c=(0,o.up)("q-tooltip"),h=(0,o.up)("q-fab-action"),u=(0,o.up)("q-fab"),m=(0,o.up)("q-item-label"),g=(0,o.up)("q-item-section"),_=(0,o.up)("q-item"),p=(0,o.up)("q-list"),w=(0,o.up)("q-btn-dropdown"),f=(0,o.up)("q-icon"),b=(0,o.up)("q-tr"),v=(0,o.up)("q-btn"),y=(0,o.up)("q-td"),C=(0,o.up)("q-input"),x=(0,o.up)("q-table"),k=(0,o.up)("q-spinner"),S=(0,o.up)("q-markup-table"),E=(0,o.up)("q-toolbar-title"),D=(0,o.up)("q-toolbar"),I=(0,o.up)("q-select"),O=(0,o.up)("q-separator"),A=(0,o.up)("q-checkbox"),T=(0,o.up)("q-expansion-item"),R=(0,o.up)("q-card-section"),L=(0,o.up)("q-card-actions"),W=(0,o.up)("q-card"),z=(0,o.up)("q-dialog"),P=(0,o.up)("q-avatar"),$=(0,o.up)("CreateCustomColumn"),q=(0,o.up)("BlockedColumns"),N=(0,o.up)("ManageRuleRegexes"),M=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)(o.HY,null,[((0,o.wg)(),(0,o.iD)("div",{class:"row q-pa-sm",key:e.renderKey},[e.hasLineItems()?((0,o.wg)(),(0,o.j4)(x,{key:0,rows:e.tableRows,columns:e.tableColumns,"no-data-label":e.$t("pages.messages.NO_RECORD_FOUND"),"row-key":"id","table-header-style":{backgroundColor:"#d4d4d4"},"hide-bottom":"",style:{overflow:"scroll",height:"auto","min-height":"180px","max-height":"500px"},"rows-per-page-options":[0],id:"line_item_table"},{header:(0,o.w5)((i=>[(0,o.Wm)(b,{props:i,class:"bg-grey-3"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.cols,((i,s)=>((0,o.wg)(),(0,o.iD)(o.HY,{key:i.name},[""===i.label?((0,o.wg)(),(0,o.j4)(d,{key:0})):((0,o.wg)(),(0,o.j4)(d,{key:1},{default:(0,o.w5)((()=>[e.isReadOnly?((0,o.wg)(),(0,o.iD)("span",{key:1,class:(0,a.C_)("gridHeader "+(i.error?"column-error-border":"")+(!0===e.hasOriginalIndex(i.org_index,i)?"non-extractable-column-text ":" extractable-column-text")),style:{width:"100%","box-shadow":"none",padding:"8px 40px 8px 2px"}},(0,a.zw)(i.label),3)):((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[e.hasOriginalIndex(i.org_index,i)?((0,o.wg)(),(0,o.j4)(u,{key:0,color:e.hasOriginalIndex(i.org_index,i)&&e.formatting_options.group_column===i.org_index?"primary":"grey-6",class:"column-fab",icon:"more_horiz",direction:"down",outline:""},{default:(0,o.w5)((()=>[e.hasOriginalIndex(i.org_index,i)?((0,o.wg)(),(0,o.j4)(h,{key:0,color:"grey-3","text-color":"black",onClick:t=>e.deleteLineItemColumn(i.org_index),width:"20",icon:"img:trash-bin-default.svg"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{anchor:"center left",self:"center right",offset:[10,10]},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("delete_column")),1)])),_:1})])),_:2},1032,["onClick"])):(0,o.kq)("",!0),e.hasOriginalIndex(i.org_index,i)&&e.formatting_options.group_column!==i.org_index?((0,o.wg)(),(0,o.j4)(h,{key:1,color:"grey-3","text-color":"black",onClick:t=>e.groupByColumn(i.org_index),width:"20",icon:"lar la-object-group"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{anchor:"center left",self:"center right",offset:[10,10]},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("group_rows")),1)])),_:1})])),_:2},1032,["onClick"])):(0,o.kq)("",!0),e.hasOriginalIndex(i.org_index,i)&&e.formatting_options.group_column===i.org_index?((0,o.wg)(),(0,o.j4)(h,{key:2,color:"grey-3","text-color":"black",onClick:t[0]||(t[0]=t=>e.resetFormating()),width:"20",icon:"lar la-object-ungroup"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{anchor:"center left",self:"center right",offset:[10,10]},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("reset_group_rows")),1)])),_:1})])),_:1})):(0,o.kq)("",!0),e.hasOriginalIndex(i.org_index,i)&&!i.is_mapped?((0,o.wg)(),(0,o.j4)(h,{key:3,color:"grey-3",onClick:t=>{e.prepareRegexData(i.name)},"text-color":"black",width:"20",icon:"las la-infinity"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{anchor:"center left",self:"center right",offset:[10,10]},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("regex")),1)])),_:1})])),_:2},1032,["onClick"])):(0,o.kq)("",!0)])),_:2},1032,["color"])):(0,o.kq)("",!0),e.hasOriginalIndex(i.org_index,i)?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(u,{key:1,color:"grey-6",class:"column-fab",icon:"more_horiz",direction:"down",outline:""},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{color:"grey-3","text-color":"black",onClick:t=>e.disableCustomColumn(i.name),width:"20",icon:"img:trash-bin-default.svg"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{anchor:"center left",self:"center right",offset:[10,10]},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("disable_column")),1)])),_:1})])),_:2},1032,["onClick"]),i.is_mapped?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(h,{key:0,color:"grey-3",onClick:t=>{e.prepareRegexData(i.name)},"text-color":"black",width:"20",icon:"las la-infinity"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{anchor:"center left",self:"center right",offset:[10,10]},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("regex")),1)])),_:1})])),_:2},1032,["onClick"]))])),_:2},1024)),(0,o.Wm)(w,{flat:"",disable:1!=e.hasOriginalIndex(i.org_index,i),id:"button_"+s,class:(0,a.C_)("gridHeader "+(i.error?"column-error-border":"")+(!0===e.hasOriginalIndex(i.org_index,i)?"non-extractable-column-text ":" extractable-column-text")),label:i.label},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{filter:e.filter},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.dropdownColumns,(t=>(0,o.wy)(((0,o.wg)(),(0,o.j4)(_,{key:t.techName,clickable:"",onClick:o=>e.swapColumn(t,i.org_index,i.name,"button_"+s)},{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(t.header),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])),[[M]]))),128))])),_:2},1032,["filter"])])),_:2},1032,["disable","id","class","label"])],64)),i.error?((0,o.wg)(),(0,o.j4)(f,{key:2,title:e.$t("pages.screen2b.in_valid_column_error"),name:"priority_high",class:"headerError"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("pages.screen2b.in_valid_column_error")),1)])),_:1})])),_:1},8,["title"])):(0,o.kq)("",!0)])),_:2},1024))],64)))),128))])),_:2},1032,["props"])])),body:(0,o.w5)((t=>[(0,o.Wm)(b,{props:t,id:"tbl_row_"+t.key},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.cols,(i=>((0,o.wg)(),(0,o.iD)(o.HY,{key:i.name},[""===i.label?((0,o.wg)(),(0,o.j4)(y,{key:0,class:"secondary-c-text"},{default:(0,o.w5)((()=>[e.isReadOnly||e.training_mode?((0,o.wg)(),(0,o.iD)(o.HY,{key:1},[],64)):((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[e.rowHasErrors(t.key)?((0,o.wg)(),(0,o.j4)(f,{key:0,title:e.$t("pages.screen2b.in_valid_column_error"),name:"priority_high",class:"headerError"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{class:"bg-red line-error-tooltip"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.lineItemsErrors[t.key],((e,t)=>((0,o.wg)(),(0,o.iD)("div",{key:t},(0,a.zw)(e),1)))),128))])),_:2},1024)])),_:2},1032,["title"])):(0,o.kq)("",!0),(0,o.Wm)(v,{flat:"",color:"primary",onClick:i=>e.removeLineItem(t.key),icon:"fa fa-times"},null,8,["onClick"])],64))])),_:2},1024)):e.isColumnVisible(i.org_index,i)?((0,o.wg)(),(0,o.j4)(y,{key:1,id:"input_"+i.name+"_"+t.key,onClick:o=>e.editColumnData(o,i.field,t.key),"data-score-description":e.getScoreDescription(e.lineDataObj[t.key]["columns"][i.name]),"data-column-value":e.lineDataObj[t.key]["columns"][i.name].formatted_value},{default:(0,o.w5)((()=>[(0,o.Wm)(C,{disable:e.isReadOnly,class:(0,a.C_)("input-field "+e.addExtractionMethodClass(e.lineDataObj[t.key]["columns"][i.name])),style:(0,a.j5)("background:"+e.getBackgroundColor(e.lineDataObj[t.key]["columns"][i.name])),borderless:"",onKeydown:e.inputKeyDown,onChange:o=>e.inputValueChanges(i.name,t.key),modelValue:e.lineDataObj[t.key]["columns"][i.name].formatted_value,"onUpdate:modelValue":o=>e.lineDataObj[t.key]["columns"][i.name].formatted_value=o},null,8,["disable","class","style","onKeydown","onChange","modelValue","onUpdate:modelValue"])])),_:2},1032,["id","onClick","data-score-description","data-column-value"])):(0,o.kq)("",!0)],64)))),128))])),_:2},1032,["props","id"])])),_:1},8,["rows","columns","no-data-label"])):((0,o.wg)(),(0,o.j4)(S,{key:1,class:"full-width"},{default:(0,o.w5)((()=>[(0,o._)("thead",null,[!1===e.lineItemsloading?((0,o.wg)(),(0,o.iD)("tr",it,[(0,o._)("th",null,(0,a.zw)(e.$t("no_line_items_found")),1)])):(0,o.kq)("",!0),!0===e.lineItemsloading?((0,o.wg)(),(0,o.iD)("tr",ot,[(0,o._)("th",null,[(0,o.Wm)(k,{color:"primary",size:"3em",thickness:10})])])):(0,o.kq)("",!0)])])),_:1})),e.hasLineItems()?((0,o.wg)(),(0,o.iD)("div",at,[(0,o._)("div",null,[(0,o.Wm)(f,{class:"non-extractable-column-text",style:{"font-size":"18px"},name:"rectangle"}),(0,o._)("span",st,(0,a.zw)(e.$t("non_extractable_column_text")),1)]),(0,o._)("div",null,[(0,o.Wm)(f,{class:"extractable-column-text",style:{"font-size":"18px"},name:"rectangle"}),(0,o._)("span",lt,(0,a.zw)(e.$t("extractable_column_text")),1)]),(0,o._)("div",null,[(0,o.Wm)(f,{style:(0,a.j5)({"font-size":"18px",color:e.is_auto_filled_color}),name:"rectangle"},null,8,["style"]),(0,o._)("span",rt,(0,a.zw)(e.$t("values_auto_filled")),1)]),(0,o._)("div",null,[(0,o.Wm)(f,{style:(0,a.j5)({"font-size":"18px",color:e.is_missing_color}),name:"rectangle"},null,8,["style"]),(0,o._)("span",nt,(0,a.zw)(e.$t("doc_cannot_be_extracted")),1)])])):(0,o.kq)("",!0)])),e.openAdvSettings?((0,o.wg)(),(0,o.iD)("div",dt,[(0,o.Wm)(z,{modelValue:e.openAdvSettings,"onUpdate:modelValue":t[9]||(t[9]=t=>e.openAdvSettings=t),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(W,{style:{width:"700px","max-width":"50vw"}},{default:(0,o.w5)((()=>[(0,o.Wm)(D,{class:"text-white secondary-toolbar"},{default:(0,o.w5)((()=>[(0,o.Wm)(E,null,{default:(0,o.w5)((()=>[(0,o._)("span",ct,(0,a.zw)(e.$t("layout.settings")),1)])),_:1}),(0,o.wy)((0,o.Wm)(v,{flat:"",round:"",dense:"",icon:"close"},null,512),[[M]])])),_:1}),(0,o.Wm)(R,{class:""},{default:(0,o.w5)((()=>[(0,o._)("div",ht,[(0,o._)("div",ut,[(0,o.Uk)((0,a.zw)(e.$t("pages.line_items.header_row_count_field"))+" ",1),(0,o.Wm)(f,{name:"help_outline",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("header_row_count")),1)])),_:1})])),_:1})]),(0,o._)("div",mt,[(0,o.Wm)(C,{outlined:"",type:"number",rules:e.headerRowCountRules,modelValue:e.header_rows_count,"onUpdate:modelValue":t[1]||(t[1]=t=>e.header_rows_count=t)},null,8,["rules","modelValue"])])]),(0,o._)("div",gt,[(0,o._)("div",_t,[(0,o.Uk)((0,a.zw)(e.$t("move_extra_rows_to"))+" ",1),(0,o.Wm)(f,{name:"help_outline",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("move_extra_rows_to_desc")),1)])),_:1})])),_:1})]),(0,o._)("div",pt,[(0,o.Wm)(I,{outlined:"",modelValue:e.move_extra_rows_to,"onUpdate:modelValue":t[2]||(t[2]=t=>e.move_extra_rows_to=t),options:e.advance_settings_columns,"emit-value":"","map-options":""},{option:(0,o.w5)((e=>[(0,o.Wm)(_,(0,a.vs)((0,o.F4)(e.itemProps)),{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,{class:(0,a.C_)("__trash__"===e.opt.value?"text-red text-weight-bold":"")},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.opt.label),1)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options"])])]),(0,o.Wm)(p,{bordered:"",class:"rounded-borders"},{default:(0,o.w5)((()=>[(0,o.Wm)(T,{"expand-separator":"",icon:"description",label:e.$t("pages.line_items.adv_settings_header"),"header-class":"panel-header","default-closed":""},{default:(0,o.w5)((()=>[(0,o.Wm)(O),(0,o._)("div",wt,[(0,o._)("div",ft,[(0,o._)("div",bt,[(0,o.Uk)((0,a.zw)(e.$t("pages.line_items.min_group_rows"))+" ",1),(0,o.Wm)(f,{name:"help_outline",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("minimum_grouped_rows")),1)])),_:1})])),_:1})]),(0,o._)("div",vt,[(0,o.Wm)(C,{class:"input-text validation-icon",outlined:"",type:"number",rules:e.headerRowCountRules,modelValue:e.min_group_rows,"onUpdate:modelValue":t[3]||(t[3]=t=>e.min_group_rows=t)},null,8,["rules","modelValue"])])]),(0,o._)("div",yt,[(0,o._)("div",Ct,[(0,o.Uk)((0,a.zw)(e.$t("pages.line_items.max_group_rows"))+" ",1),(0,o.Wm)(f,{name:"help_outline",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("maximum_grouped_rows")),1)])),_:1})])),_:1})]),(0,o._)("div",xt,[(0,o.Wm)(C,{class:"input-text validation-icon",outlined:"",type:"number",rules:e.headerRowCountRules,modelValue:e.max_group_rows,"onUpdate:modelValue":t[4]||(t[4]=t=>e.max_group_rows=t)},null,8,["rules","modelValue"])])]),(0,o._)("div",kt,[(0,o._)("div",St,[(0,o.Uk)((0,a.zw)(e.$t("pages.line_items.distinct_group_column"))+" ",1),(0,o.Wm)(f,{name:"help_outline",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("distinct_group_columns")),1)])),_:1})])),_:1})]),(0,o._)("div",Et,[(0,o.Wm)(A,{modelValue:e.distinct_group_column,"onUpdate:modelValue":t[5]||(t[5]=t=>e.distinct_group_column=t)},null,8,["modelValue"])])]),(0,o._)("div",Dt,[(0,o._)("div",It,[(0,o.Uk)((0,a.zw)(e.$t("pages.line_items.reverse_grouping"))+" ",1),(0,o.Wm)(f,{name:"help_outline",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("reverse_grouping")),1)])),_:1})])),_:1})]),(0,o._)("div",Ot,[(0,o.Wm)(A,{modelValue:e.reverse_grouping,"onUpdate:modelValue":t[6]||(t[6]=t=>e.reverse_grouping=t)},null,8,["modelValue"])])]),(0,o._)("div",At,[(0,o._)("div",Tt,[(0,o.Uk)((0,a.zw)(e.$t("split_text"))+" ",1),(0,o.Wm)(f,{name:"help_outline",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("split_text_desc")),1)])),_:1})])),_:1})]),(0,o._)("div",Rt,[(0,o.Wm)(A,{modelValue:e.split_text,"onUpdate:modelValue":t[7]||(t[7]=t=>e.split_text=t),onClick:t[8]||(t[8]=t=>e.split_text_confirm_dialog=!0)},null,8,["modelValue"])])]),e.extra_columns.length>0?((0,o.wg)(),(0,o.iD)("div",Lt,[(0,o._)("div",Wt,[(0,o.Wm)(S,null,{default:(0,o.w5)((()=>[(0,o._)("thead",null,[(0,o._)("tr",zt,[(0,o._)("th",Pt,(0,a.zw)(e.$t("field_key")),1),(0,o._)("th",$t,(0,a.zw)(e.$t("source_field")),1),(0,o._)("th",qt,(0,a.zw)(e.$t("pattern")),1),(0,o._)("th",Nt,(0,a.zw)(e.$t("actions")),1)])]),(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.extra_columns,((t,i)=>((0,o.wg)(),(0,o.iD)("tr",{key:t["key"]},[(0,o._)("td",null,(0,a.zw)(t["field_key"]),1),(0,o._)("td",null,(0,a.zw)(t["source_field"]),1),(0,o._)("td",null,(0,a.zw)(t["pattern"]),1),(0,o._)("td",null,[(0,o.Wm)(v,{flat:"",onClick:t=>{t.stopPropagation(),e.removeFieldFromSettings(i)}},{default:(0,o.w5)((()=>[Mt,(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("remove")),1)])),_:1})])),_:2},1032,["onClick"])])])))),128))])])),_:1})])])):(0,o.kq)("",!0)])])),_:1},8,["label"])])),_:1})])),_:1}),(0,o.Wm)(L,{align:"right"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(v,{class:"bg-grey-3",label:e.$t("cancel")},null,8,["label"]),[[M]]),(0,o.Wm)(v,{color:"primary",class:"q-mr-sm","data-cy":"setvatfield",label:e.$t("pages.line_items.proceed"),onClick:e.formatWthAdvSettings},null,8,["label","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(z,{modelValue:e.addFieldsDialog,"onUpdate:modelValue":t[18]||(t[18]=t=>e.addFieldsDialog=t),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)(W,{style:{width:"600px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(D,{class:"text-white secondary-toolbar"},{default:(0,o.w5)((()=>[(0,o.Wm)(E,null,{default:(0,o.w5)((()=>[(0,o._)("span",Ht,(0,a.zw)(e.$t("add_field_view_header")),1)])),_:1}),(0,o.wy)((0,o.Wm)(v,{flat:"",round:"",dense:"",icon:"close"},null,512),[[M]])])),_:1}),(0,o.Wm)(R,{class:"q-pt-none"},{default:(0,o.w5)((()=>[(0,o._)("div",Ut,[(0,o._)("div",Ft,[(0,o.Wm)(I,{modelValue:e.new_field_model["source"],"onUpdate:modelValue":t[11]||(t[11]=t=>e.new_field_model["source"]=t),class:"col-sm-6 col-md-6 col-lg-6",options:e.adv_column_options,label:"Field Source*","bottom-slots":"","error-message":"Field is required",error:e.new_field_model["source_invalid"],"emit-value":"","map-options":""},{append:(0,o.w5)((()=>[(0,o.Wm)(f,{name:"close",onClick:t[10]||(t[10]=(0,s.iM)((t=>e.new_field_model["source"]=""),["stop"])),class:"cursor-pointer"})])),option:(0,o.w5)((e=>[(0,o.Wm)(_,(0,a.vs)((0,o.F4)(e.itemProps)),{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.opt.label),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options","error"])]),jt]),(0,o._)("div",Vt,[(0,o._)("div",Zt,[(0,o.Wm)(C,{label:"Key*",modelValue:e.new_field_model["key"],"onUpdate:modelValue":t[12]||(t[12]=t=>e.new_field_model["key"]=t),outlined:"",class:"full-width","bottom-slots":"","error-message":"Field is required",error:e.new_field_model["key_invalid"]},null,8,["modelValue","error"])]),(0,o._)("div",Yt,[(0,o.Wm)(I,{modelValue:e.new_field_model["key_dropdown"],"onUpdate:modelValue":[t[14]||(t[14]=t=>e.new_field_model["key_dropdown"]=t),t[15]||(t[15]=t=>e.advSettingNewFieldColumnSelected("key","key_dropdown"))],class:"col-sm-6 col-md-6 col-lg-6",options:e.adv_column_options,label:e.$t("adv_column_options")},{append:(0,o.w5)((()=>[(0,o.Wm)(f,{name:"close",onClick:t[13]||(t[13]=(0,s.iM)((t=>{e.new_field_model["key_dropdown"]="",e.advSettingNewFieldColumnSelected("key","key_dropdown")}),["stop"])),class:"cursor-pointer"})])),option:(0,o.w5)((e=>[(0,o.Wm)(_,(0,a.vs)((0,o.F4)(e.itemProps)),{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.opt.label),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options","label"])])]),e.new_field_model["key_dropdown"]?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",Bt,[(0,o._)("div",Xt,[(0,o.Wm)(C,{label:"Label",modelValue:e.new_field_model["label"],"onUpdate:modelValue":t[16]||(t[16]=t=>e.new_field_model["label"]=t),outlined:"",class:"full-width"},null,8,["modelValue"])])])),(0,o._)("div",Qt,[(0,o._)("div",Jt,[(0,o.Wm)(C,{label:"Pattern*",modelValue:e.new_field_model["pattern"],"onUpdate:modelValue":t[17]||(t[17]=t=>e.new_field_model["pattern"]=t),outlined:"",class:"full-width","bottom-slots":"","error-message":"Invalid Regex Pattern",error:e.new_field_model["pattern_invalid"]},null,8,["modelValue","error"])])])])),_:1}),(0,o.Wm)(L,{align:"right"},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{color:"primary",class:"q-mr-sm","data-cy":"setvatfield",label:e.$t("pages.line_items.proceed"),onClick:e.saveNewFieldForAdvSettings},null,8,["label","onClick"]),(0,o.wy)((0,o.Wm)(v,{class:"bg-grey-3",label:e.$t("cancel")},null,8,["label"]),[[M]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(z,{modelValue:e.split_text_confirm_dialog,"onUpdate:modelValue":t[20]||(t[20]=t=>e.split_text_confirm_dialog=t),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(W,null,{default:(0,o.w5)((()=>[(0,o.Wm)(R,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,o.w5)((()=>[(0,o.Wm)(P,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,o.Wm)(R,{class:"row items-center"},{default:(0,o.w5)((()=>[(0,o._)("span",Kt,(0,a.zw)(e.$t("split_text_confirm")),1)])),_:1}),(0,o.Wm)(L,{align:"right"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(v,{label:e.$t("cancel"),class:"bg-grey-3"},null,8,["label"]),[[M]]),(0,o.Wm)(v,{label:e.$t("proceed"),class:"q-mr-sm",color:"primary",onClick:t[19]||(t[19]=t=>e.TriggerSplitText())},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])):(0,o.kq)("",!0),(0,o.Wm)(z,{modelValue:e.addColumnDialog,"onUpdate:modelValue":t[21]||(t[21]=t=>e.addColumnDialog=t),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)($,{is_table_training_doc:!!this.docStore.record.hasOwnProperty("is_table_training_doc"),table_name:this.docStore.record.tables&&this.docStore.record.tables.length>0?this.docStore.record.tables[0].name:"",tables:this.docStore.record.tables&&this.docStore.record.tables.length>0?this.docStore.record.tables[0]:{},columns_list:this.lineItemLayout,addColumnDialog:e.addColumnDialog},null,8,["is_table_training_doc","table_name","tables","columns_list","addColumnDialog"])])),_:1},8,["modelValue"]),(0,o.Wm)(z,{modelValue:e.poEditRestrictDialog,"onUpdate:modelValue":t[22]||(t[22]=t=>e.poEditRestrictDialog=t),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(W,null,{default:(0,o.w5)((()=>[(0,o.Wm)(R,{class:"row items-center"},{default:(0,o.w5)((()=>[(0,o._)("span",Gt,(0,a.zw)(e.poEditRestrictMessage),1)])),_:1}),(0,o.Wm)(L,{align:"right"},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{flat:"",label:e.$t("dashboard"),color:"primary",to:"/dashboard"},null,8,["label"]),(0,o.Wm)(v,{flat:"",label:e.$t("table_extraction_view"),color:"primary",to:"/tbl_ext_v3/"+e.docStore.record.doc_id},null,8,["label","to"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(z,{modelValue:e.openDisableColumnListView,"onUpdate:modelValue":t[23]||(t[23]=t=>e.openDisableColumnListView=t)},{default:(0,o.w5)((()=>[(0,o.Wm)(W,{style:{"min-width":"700px",width:"700px","max-width":"50vw"}},{default:(0,o.w5)((()=>[(0,o.Wm)(D,{class:"text-white secondary-toolbar"},{default:(0,o.w5)((()=>[(0,o.Wm)(E,null,{default:(0,o.w5)((()=>[(0,o._)("span",ei,(0,a.zw)(e.$t("diabled_custom_columns")),1)])),_:1}),(0,o.wy)((0,o.Wm)(v,{flat:"",round:"",dense:"",icon:"close"},null,512),[[M]])])),_:1}),(0,o.Wm)(q,{rows:e.disableColumnList},null,8,["rows"])])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(z,{modelValue:e.revert_changes_confirm_dialog,"onUpdate:modelValue":t[26]||(t[26]=t=>e.revert_changes_confirm_dialog=t),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(W,null,{default:(0,o.w5)((()=>[(0,o.Wm)(R,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,o.w5)((()=>[(0,o.Wm)(P,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,o.Wm)(R,{tag:"span",class:"row items-center",style:{"justify-content":"center",display:"flex"}},{default:(0,o.w5)((()=>[(0,o._)("span",ti,(0,a.zw)(e.$t("revert_changes_confirm")),1),(0,o._)("span",ii,(0,a.zw)(e.$t("revert_changes_confirm_2")),1)])),_:1}),(0,o.Wm)(L,{align:"right"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(v,{label:e.$t("cancel"),class:"bg-grey-3",onClick:t[24]||(t[24]=t=>e.revert_changes_confirm_dialog=!1)},null,8,["label"]),[[M]]),(0,o.Wm)(v,{label:e.$t("proceed"),class:"q-mr-sm",color:"primary",onClick:t[25]||(t[25]=t=>e.revertChanges(!0))},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(N,{showRegexDlg:e.showRegexDlg,onSetShowRegexDlg:e.setShowRegexDlg,onUpdateRegexByRule:e.updateRegexByRule},null,8,["showRegexDlg","onSetShowRegexDlg","onUpdateRegexByRule"])],64)}var ai=i(78564),si=i(77987),li=i(60727),ri=i(85985),ni=i(48825),di=i(55276),ci=i(75933),hi=i(89657),ui=i(2232),mi=i(93426),gi=i(58116),_i=i(29938),pi=i(86068),wi=function(e,t,i,o){function a(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,s){function l(e){try{n(o.next(e))}catch(t){s(t)}}function r(e){try{n(o["throw"](e))}catch(t){s(t)}}function n(e){e.done?i(e.value):a(e.value).then(l,r)}n((o=o.apply(e,t||[])).next())}))};let fi,bi=new Map;const vi=(0,o.aZ)({el:"#app",mixins:[Ue.Z,qe.Z,di.Z,ci.Z,ri.Z,ai.Z,mi.Z],props:{apiDataProp:{},extractedData:{type:String,default:""},currentPageNo:{type:Number,default:1},isRowMode:{type:Boolean,default:!1},training_mode:{type:Boolean,default:!1},isReadOnly:{type:Boolean,default:!1}},emits:["updateExtractionDataForSave","setTableRowCorrdinates","loadNewPageImage"],components:{BlockedColumns:ui.Z,ManageRuleRegexes:gi.Z,CreateCustomColumn:pi.Z},data(){return{docId:"",dropdownColumns:[],rows_to_delete:[],po_dragging:!1,dragging_data:{},coveredLineItem:[],validation_done:!0,connected_line_item:"",confirmDialog:(0,Me.iH)(!1),renderKey:0,is_po_view:!1,selectedColumn:(0,Me.iH)(""),showRegexDlg:(0,Me.iH)(!1),openAdvSettings:(0,Me.iH)(!1),oldSelectedColumnName:(0,Me.iH)(""),po_connected_line_items:{},is_auto_filled_color:"#c2dba6",is_missing_color:"#eed69e"}},mounted:function(){document.addEventListener("revert_changes",(()=>{this.revertChanges().then()})),document.addEventListener("add_new_row",this.createRowJson),document.addEventListener("add_new_column",this.addNewCustomColumn),document.addEventListener("reset_line_items",this.resetlintItems),document.addEventListener("init_line_items",this.lineItemDataLoaded),document.addEventListener("reload_line_items",this.reloadLineItemData),document.addEventListener("get_table_rows_areas",this.getTableRowsAreas),document.addEventListener("display_adv_settings_view",this.openAdvanceSettings),document.addEventListener("open_disabled_custom_columns_view",this.openDisabledCstmColumnsView),document.addEventListener("enable_custom_column",this.enableCustomColumn),document.addEventListener("custom_column_create",this.customColumnCreated),document.addEventListener("display_fields_errors",this.displayFieldErrors),this.isViewPo(),window.lineItemsV3=this},unmounted:function(){document.removeEventListener("revert_changes",(()=>{this.revertChanges().then()})),document.removeEventListener("add_new_row",this.createRowJson),document.removeEventListener("add_new_column",this.addNewCustomColumn),document.removeEventListener("reset_line_items",this.resetlintItems),document.removeEventListener("init_line_items",this.lineItemDataLoaded),document.removeEventListener("reload_line_items",this.reloadLineItemData),document.removeEventListener("get_table_rows_areas",this.getTableRowsAreas),document.removeEventListener("display_adv_settings_view",this.openAdvanceSettings),document.removeEventListener("open_disabled_custom_columns_view",this.openDisabledCstmColumnsView),document.removeEventListener("enable_custom_column",this.enableCustomColumn),document.removeEventListener("custom_column_create",this.customColumnCreated),document.removeEventListener("display_fields_errors",this.displayFieldErrors)},watch:{extractedData(e){fi.value=e,fi.parentElement.classList.remove("active"),fi=null},currentPageNo(e){this.highliteFirstRowOfCurrentPage()}},methods:{addExtractionMethodClass(e){let t="";return e&&e.hasOwnProperty("extraction_method")&&""!==e.extraction_method&&(t="extraction_method"),t},reloadLineItemData(e){if(!e||!e.detail)return;this.lineItemsloading=!1;let t=e.detail.apiData;this.resetRows(),this.docStore.record=t,this.docId=this.docStore.record&&this.docStore.record.doc_id?this.docStore.record.doc_id:"",this.refactorApiData();let i={rowId:e.detail.currentRowId,columnName:e.detail.currentColumnName,onlySelectedRow:!0};this.getTableRowsAreas({detail:i}),setTimeout((()=>{const t=new CustomEvent("enable_column_selection",{detail:e.detail.currentRowId});document.dispatchEvent(t)}),10)},lineItemDataLoaded(e){if(!e||!e.detail)return;this.lineItemsloading=!1;let t=e.detail;this.resetRows(),this.docStore.record=t,this.docId=this.docStore.record&&this.docStore.record.doc_id?this.docStore.record.doc_id:"",this.refactorApiData()},isViewEditable(){return!this.is_po_view&&(!!this.training_mode||(this.showErrorToast("Please select training mode"),!1))},getToken(){return wi(this,void 0,void 0,(function*(){let e=this.docStore.record.token&&null!=this.docStore.record.token&&""!=this.docStore.record.token?this.docStore.record.token:yield(0,ze.O_)();return e}))},groupByColumn(e){return wi(this,void 0,void 0,(function*(){""!==e&&void 0!=e&&null!=e&&(this.group_column=e,yield this.requestReformate())}))},getColumnMappingIndexes(){let e={};for(const t in this.column_mapping_indexes){let i=this.column_mapping_indexes[t];e[t]=i}return e},resetFormating(){return wi(this,void 0,void 0,(function*(){this.group_column="",yield this.requestReformate()}))},validateLineItemColumns(){let e=!1;if(this.docStore.record["table_has_error"]=!1,void 0===this.tableColumns)return;let t=[];for(const o of this.tableColumns){let i=this.isColumnNameValid(o);i||(this.docStore.record["table_has_error"]=!0,o.error=!0,e=!0,t.push(o.name))}let i=!e;this.is_line_item_validated=i,this.missing_mapping_column=t,this.validation_done!==i&&(this.validation_done,this.validation_done=i)},isColumnNameValid(e){let t=!(!this.column_mapping_indexes||null==this.column_mapping_indexes||!(0,_i.fg)(this.column_mapping_indexes)),i=!1;if("id"==e.name)return!0;for(const o of this.dropdownColumns)if(e.name===o.techName){i=!0;break}return i&&t&&!0===this.hasOriginalIndex(e.org_index,e)&&this.addInMapping(e.org_index,e.name),i},addInMapping(e,t){this.column_mapping_indexes[t]=Number(e)},updateLineItemsForApi(){this.isReadOnly||this.$emit("updateExtractionDataForSave","mapping",this.getColumnMappingIndexes())},isColumnGroupBy(e){let t="";return this.group_column&&(t=this.group_column),null===t&&(t=""),t==e},getColumnGroupBy(){let e="";return this.group_column&&(e=this.group_column),null===e&&(e=""),e},isColumnVisible(e,t){let i=!0;return e&&this.columns_to_hide&&0!=this.columns_to_hide.length?((this.columns_to_hide.includes(e)||"UUID"==t.name)&&(i=!1),i):i},isCustomColumnHidden(e){let t=!1;if(!this.custom_columns_to_hide||0==this.custom_columns_to_hide.length)return t;for(const i of this.custom_columns_to_hide)if(i===e){t=!0;break}return t},isRowDeleted(e){let t=this.getLineUuid(e);return!this.rows_to_delete.includes(t)},getLineUuid(e){let t="";for(let[i,o]of e.entries())if("UUID"==o.techName){t=o.value;break}return t},getLineItemRowsToHide(){if(this.rows_to_delete=[],this.docStore.record&&this.docStore.record.tables&&this.docStore.record.tables[0]&&this.docStore.record.tables[0].hasOwnProperty("extraction_info")){for(let[e,t]of Object.entries(this.docStore.record.tables[0].extraction_info))this.docStore.record.tables[0].extraction_info[e].hasOwnProperty("rows_to_delete")&&(this.rows_to_delete=this.docStore.record.tables[0].extraction_info[e].rows_to_delete);Array.isArray(this.rows_to_delete)&&this.rows_to_delete.length>0?this.rows_to_delete=this.rows_to_delete[0].split(" "):this.rows_to_delete=[]}},addToRowToDelete(e){for(let[t,i]of e.entries())if("UUID"==i.techName){this.rows_to_delete.push(i.value);break}},setRowToDeleteForApi(){if(!this.docStore.record.tables[0]||!this.docStore.record.tables[0].hasOwnProperty("extraction_info"))return;let e=[this.rows_to_delete.join(" ")];this.$emit("updateExtractionDataForSave","rows_to_delete",e)},inputKeyDown(e){if(this.training_mode)return e.preventDefault(),e.target.blur(),void this.showErrorToast(this.$t("manual_change"))},inputValueChanges(e,t){return wi(this,void 0,void 0,(function*(){const i=this.lineDataObj[t]["columns"][e].formatted_value;this.lineDataObj[t]["columns"][e].value=i;const o=this.docStore.record.amount_format_locale.split(".");"en_US"!=o[0]&&this.lineItemLayout.hasOwnProperty(e)&&"AMOUNT"===this.lineItemLayout[e].column_type&&(this.lineDataObj[t]["columns"][e].value=yield this.convertValueAccordingToLocale(i,o[0],"en_US"),this.lineDataObj[t]["columns"][e].content=i),this.updateJsonForLineItems(e,t)}))},updateJsonForLineItems(e,t){Array.from(this.docStore.record.tables[0].rows).forEach(((i,o)=>{t===i.id&&Array.from(i.columns).forEach(((t,a)=>{t.name!==e||(this.docStore.record.tables[0].rows[o].columns[a]=this.lineDataObj[i.id].columns[e])}))})),this.dispatchEventToSaveTableChanges()},setJsonForLineItems(){Array.from(this.docStore.record.tables[0].rows).forEach(((e,t)=>{const i=e.id,o=this.lineDataObj[i];this.docStore.record.tables[0].rows[t]=o})),this.dispatchEventToSaveTableChanges()},dispatchEventToSaveTableChanges(e=!1){this.docStore.confirmationForPoConnectionReset=!0;const t=new CustomEvent("update_table_data",{detail:{tables:this.docStore.record.tables,save_to_server:e}});document.dispatchEvent(t)},hasLineItems(){return!(!this.tableRows||0===Object.keys(this.tableRows).length||!this.is_manual_training_allowed)},openAdvanceSettings(){this.adv_column_options=[];for(const e of this.dropdownColumns)this.adv_column_options.push(Object.assign({},{value:e.techName,label:e.header}));this.setAdvSettings(),this.openAdvSettings=!0},setAdvSettings(){this.move_extra_rows_to="",this.header_rows_count=1,this.extra_columns=[],this.formatting_options&&(this.formatting_options.hasOwnProperty("merge_extra_lines_to")&&null!==this.formatting_options.merge_extra_lines_to&&(this.move_extra_rows_to=this.formatting_options.merge_extra_lines_to),this.formatting_options.hasOwnProperty("header_rows_count")&&null!==this.formatting_options.header_rows_count&&(this.header_rows_count=this.formatting_options.header_rows_count),this.formatting_options.hasOwnProperty("extra_cols")&&null!==this.formatting_options.extra_cols&&(this.extra_columns=this.formatting_options.extra_cols),this.formatting_options.hasOwnProperty("group_column")&&null!==this.formatting_options.group_column&&(this.group_column=this.formatting_options.group_column),this.formatting_options.hasOwnProperty("min_group_rows")&&null!==this.formatting_options.min_group_rows&&(this.min_group_rows=this.formatting_options.min_group_rows),this.formatting_options.hasOwnProperty("max_group_rows")&&null!==this.formatting_options.max_group_rows&&(this.max_group_rows=this.formatting_options.max_group_rows),this.formatting_options.hasOwnProperty("distinct_group_column")&&null!==this.formatting_options.distinct_group_column&&(this.distinct_group_column=this.formatting_options.distinct_group_column),this.formatting_options.hasOwnProperty("reverse_grouping")&&null!==this.formatting_options.reverse_grouping&&(this.reverse_grouping=this.formatting_options.reverse_grouping),this.formatting_options.hasOwnProperty("split_text")&&null!==this.formatting_options.split_text&&(this.split_text=this.formatting_options.split_text))},formatWthAdvSettings(){return wi(this,void 0,void 0,(function*(){yield this.requestReformate(),this.openAdvSettings=!1}))},advSettingNewFieldColumnSelected(e,t){this.new_field_model[t]?this.new_field_model[e]=this.new_field_model[t].value:this.new_field_model[e]=""},saveNewFieldForAdvSettings(){this.new_field_model["pattern_invalid"]=!1,this.new_field_model["key_invalid"]=!1,this.new_field_model["source_invalid"]=!1;let e=!0;if(this.new_field_model["pattern"]&&!(0,hi.nc)(this.new_field_model["pattern"])&&(this.new_field_model["pattern_invalid"]=!0,e=!1),this.new_field_model["key"]&&""!=this.new_field_model["key"]||(this.new_field_model["key_invalid"]=!0,e=!1),this.new_field_model["source"]&&""!=this.new_field_model["source"]||(this.new_field_model["source_invalid"]=!0,e=!1),!e)return;let t=this.new_field_model["label"];t||(t=this.new_field_model["key"].toUpperCase()),this.extra_columns||(this.extra_columns=[]),this.extra_columns.push({field_key:this.new_field_model["key"].toUpperCase(),source_field:this.new_field_model["source"].toUpperCase(),label:t,pattern:this.new_field_model["pattern"].toUpperCase()}),this.addFieldsDialog=!1},addFieldForAdvSettings(){this.addFieldsDialog=!0,this.new_field_model={}},removeFieldFromSettings(e){e=Number(e),e>-1&&this.extra_columns.splice(e,1)},revertChanges(e=!1){return wi(this,void 0,void 0,(function*(){!1!==e?(this.revert_changes_confirm_dialog=!1,this.resetFormatSettings(),yield this.requestReformate()):this.revert_changes_confirm_dialog=!0}))},isViewPo(){this.$route.fullPath.match(/po-matching/g)&&(this.is_po_view=!0)},refactorApiData(){this.resetFormatSettings(),this.setFormatOptions(),this.setAdvSettings(),this.prepareTableLayoutObj(),this.prepareTableColumn(),this.prepareTableRowsAndRowObj(),this.sortTableColumn(),this.validateLineItemColumns(),this.prepareDisabledCstmColumnsList(),setTimeout((()=>{let e=document.querySelector("#line_item_table");if(e){let t=e.querySelector("table");t&&this.resizableGrid(t)}}),1e3)},setFormatOptions(){this.formatting_options={},this.docStore.record.tables&&this.docStore.record.tables.length>0&&this.docStore.record.tables[0].hasOwnProperty("formatting_options")&&(this.formatting_options=this.docStore.record.tables[0].formatting_options),this.formatting_options.hasOwnProperty("mapping")&&null!==this.formatting_options.mapping&&(this.column_mapping_indexes=Object.assign({},this.formatting_options.mapping)),this.formatting_options.hasOwnProperty("columns_to_hide")&&null!==this.formatting_options.columns_to_hide&&(this.columns_to_hide=Object.assign([],this.formatting_options.columns_to_hide)),this.formatting_options.hasOwnProperty("custom_columns_to_hide")&&null!==this.formatting_options.custom_columns_to_hide&&(this.custom_columns_to_hide=Object.assign([],this.formatting_options.custom_columns_to_hide))},resetRows(){this.tableRows=[],this.lineDataObj=[],this.lineItemsErrors={}},resetFormatSettings(){this.move_extra_rows_to="",this.header_rows_count=1,this.extra_columns=[],this.group_column="",this.min_group_rows=1,this.max_group_rows=null,this.distinct_group_column=!1,this.reverse_grouping=!1,this.column_mapping_indexes={},this.columns_to_hide=[],this.custom_columns_to_hide=[],this.split_text=!1},setTableData(e){this.docStore.record.tables[0]=e},prepareTableRowsAndRowObj(){this.docStore.confirmationForPoConnectionReset=!0,this.tableRows=[],this.lineDataObj=[];let e={};if(this.lineItemsErrors={},this.tableRowsLocationsMap.clear(),!this.docStore.record.tables||0==this.docStore.record.tables.length||!this.docStore.record.tables[0].hasOwnProperty("rows")||0==this.docStore.record.tables[0].rows.length)return;this.docStore.record.tables[0].rows[0].id;Array.from(this.docStore.record.tables[0].rows).forEach((t=>{if(!1===t.is_deleted){let i={};e[t.id]=JSON.parse(JSON.stringify(t)),e[t.id].locations_list=[],t.locations_list&&Array.from(t.locations_list).forEach((i=>{e[t.id].locations_list["page_"+i.page]=i,this.tableRowsLocationsMap.has("page_"+i.page)||this.tableRowsLocationsMap.set("page_"+i.page,t.id)})),delete e[t.id].columns,e[t.id]["columns"]=[],Array.from(t.columns).forEach((o=>{e[t.id].columns[o.name]=JSON.parse(JSON.stringify(o)),e[t.id].columns[o.name].locations_list=[],o.locations_list&&Array.from(o.locations_list).forEach((i=>{e[t.id].columns[o.name].locations_list["page_"+i.page]=i})),t.id,(0,_i.Jp)(o.formatted_value)&&(o.formatted_value=""),i[o.name]=o.formatted_value,this.prepareMapOfColumnHavingData(o)})),this.addExtraColumnsInRow(e,i,t.id),i["id"]=t.id,t.id,this.tableRows.push(i),this.setRowErrors(t)}})),Object.assign(this.lineDataObj,e),this.addExtraColumnsInExportJson()},prepareMapOfColumnHavingData(e){bi.has(e.name)?!1===bi.get(e.name)&&e.formatted_value&&null!=e.formatted_value&&""!=e.formatted_value&&bi.set(e.name,!0):e.formatted_value&&null!=e.formatted_value&&""!=e.formatted_value?bi.set(e.name,!0):bi.set(e.name,!1)},addExtraColumnsInRow(e,t,i){for(let o of this.layoutExtraColumns){let a={name:o,value:"",content:"",locations:[],locations_list:[],formatted_value:"",isExtraColumn:!0};e[i].columns[o]=a,bi.set(o,!1),t[o]=""}},addExtraColumnsInExportJson(){let e=[];for(let t of this.layoutExtraColumns){let i={name:t,value:"",content:"",locations:[],locations_list:[],formatted_value:"",isExtraColumn:!0};e.push(i)}Array.from(this.docStore.record.tables[0].rows).forEach(((t,i)=>{for(let o of e)this.docStore.record.tables[0].rows[i].columns.push(o)}))},setRowErrors(e){if(this.lineItemsErrors[e.id]={},!e.messages||!Array.isArray(e.messages))return;let t={};for(const i in e.messages){let o=e.messages[i];"COLUMN_NOT_MAPPED"!=o.message_code&&(o.message&&""!=o.message&&(t[o.message_code]=o.message))}this.lineItemsErrors[e.id]=t},rowHasErrors(e){return!(!this.lineItemsErrors.hasOwnProperty(e)||null===this.lineItemsErrors[e]||(0,_i.fg)(this.lineItemsErrors[e]))},prepareTableLayoutObj(){this.dropdownColumns=[];let e={};this.lineItemLayout={},this.initStandardColumns(),this.docStore.record.tables&&this.docStore.record.tables.length>0&&this.docStore.record.tables[0].hasOwnProperty("layout")&&(Array.from(this.docStore.record.tables[0].layout).forEach((t=>{e.hasOwnProperty(t.column_name)||0!=t.is_hidden||this.isCustomColumnHidden(t.column_name)||(e[t.column_name]=!0,t["lbl_to_display"]=this.getLabelToDisplay(t),this.lineItemLayout[t.column_name]=t,this.addStandardColumns(t),this.dropdownColumns.push({header:t.lbl_to_display,techName:t.column_name}))})),this.sortMappingColumns())},sortMappingColumns(){this.dropdownColumns.length>0&&this.dropdownColumns.sort((function(e,t){return e.header<t.header?-1:e.header>t.header?1:0}))},initStandardColumns(){this.advance_settings_columns=[],this.advance_settings_columns.push(Object.assign({},{value:"",label:this.$t("select")})),this.advance_settings_columns.push(Object.assign({},{value:"__trash__",label:this.$t("trash")}))},addStandardColumns(e){this.advance_settings_columns.push(Object.assign({},{value:e.column_name,label:e.column_name}))},prepareTableColumn(){this.tableColumns=[];let e={};if(this.layoutExtraColumns=[],!(this.docStore.record.tables&&this.docStore.record.tables.length>0&&this.docStore.record.tables[0].hasOwnProperty("rows")&&this.docStore.record.tables[0].rows.length>0))return;let t={name:"id",field:"id",align:"left",label:"",is_mapped:!0,org_index:""};this.tableColumns.push(t);const i=this.docStore.record.tables[0].rows[0];if(!i)return;let o=JSON.parse(JSON.stringify(this.lineItemLayout));Array.from(i.columns).forEach((t=>{let a=this.isColumnHidden(i,t);if(a){let i=t.name;this.lineItemLayout.hasOwnProperty(t.name)&&(i=this.lineItemLayout[t.name].lbl_to_display,delete o[t.name]);let a="";null!=t.org_index&&void 0!=t.org_index&&(a=String(t.org_index));let s={name:t.name,field:t.name,align:"left",label:i,is_mapped:!!t.is_mapped&&t.is_mapped,org_index:a};t.hasOwnProperty("org_index")&&null!=t.org_index?this.tableColumns.push(s):e[t.name]=s}}));for(let[a,s]of Object.entries(e))this.tableColumns.push(Object.assign({},s));for(let a in o){const e=o[a];let t=!this.isCustomColumnHidden(e.name);if(!t){delete o[e.name];continue}let i={name:e.column_name,field:e.column_name,align:"left",label:e.lbl_to_display,is_mapped:!!e.is_mapped&&e.is_mapped,org_index:"",is_extra_column:!0};this.tableColumns.push(Object.assign({},i)),this.layoutExtraColumns.push(e.column_name)}},sortTableColumn(){let e=JSON.parse(JSON.stringify(this.tableColumns)),t=[];this.tableColumns=[],Array.from(e).forEach(((e,i)=>{1!=this.hasOriginalIndex(e.org_index,e)&&bi.has(e.name)&&!1===bi.get(e.name)?t.push(Object.assign({},e)):this.tableColumns.push(Object.assign({},e))})),t.sort(((e,t)=>{let i=e.field.toLowerCase(),o=t.field.toLowerCase();return i<o?-1:i>o?1:0})),Array.from(t).forEach(((e,t)=>{this.tableColumns.push(Object.assign({},e))}))},isColumnHidden(e,t){let i="";null!=t.org_index&&void 0!=t.org_index&&(i=String(t.org_index));let o=!0;return""!==i&&(o=this.isColumnVisible(i,t)),""===i&&(o=!this.isCustomColumnHidden(t.name)),o},deleteLineItemColumn(e){return wi(this,void 0,void 0,(function*(){this.columns_to_hide.push(e),null!=this.group_column&&this.group_column===e&&(this.group_column=""),yield this.requestReformate()}))},getColumnToHide(){return Array.isArray(this.columns_to_hide)?this.columns_to_hide.join():""},removeLineItem(e){Array.from(this.docStore.record.tables[0].rows).forEach((t=>{if(t.id===e)return t.is_deleted=!0,this.$forceUpdate(),void this.prepareTableRowsAndRowObj()})),this.dispatchEventToSaveTableChanges()},swapColumn(e,t,i,o){return wi(this,void 0,void 0,(function*(){if(!this.isViewEditable())return;if(this.selectedColumnHasData(e.techName))return void this.showErrorToast(this.$t("column_has_value"));let a=!1,s=!1,l=t;if(this.column_mapping_indexes)for(const t in this.column_mapping_indexes){let o=this.column_mapping_indexes[t];if(t==e.techName&&o!=l){a=!0;break}if(t==i&&o==l){s=!0;break}}a?this.showErrorToast(this.$t("pages.messages.COLUMN_ALREADY_MAPPED")):(s&&delete this.column_mapping_indexes[i],this.addInMapping(l,e.techName),yield this.requestReformate(),setTimeout((()=>{this.scrollInToViewCenter(document.getElementById(o))}),10))}))},selectedColumnHasData(e){let t=!1;for(const i in this.tableRows){const o=this.tableRows[i];if(o.hasOwnProperty(e)&&null!=o[e]&&void 0!=o[e]&&""!=o[e]){t=!0;break}}return t},getTableData(){return this.docStore.record.tables&&this.docStore.record.tables.length>0?this.docStore.record.tables[0]:{}},requestReformate(){return wi(this,void 0,void 0,(function*(){this.lineItemsloading=!0,this.resetRows();try{let e,t=new FormData;t.append("doc_id",this.docId),t.append("group_column",this.getColumnGroupBy()),t.append("min_group_rows",this.min_group_rows.toString()),t.append("max_group_rows",this.max_group_rows?this.max_group_rows.toString():""),t.append("header_rows_count",this.header_rows_count.toString()),t.append("distinct_group_column",this.distinct_group_column.toString()),t.append("reverse_grouping",this.reverse_grouping.toString()),t.append("column_mapping_indexes",JSON.stringify(this.getColumnMappingIndexes())),t.append("move_extra_rows_to",this.move_extra_rows_to),t.append("extra_columns",JSON.stringify(this.extra_columns)),t.append("columns_to_hide",this.getColumnToHide()),t.append("data",JSON.stringify(this.getTableData())),this.docStore.record.hasOwnProperty("is_table_training_doc")&&t.append("is_table_training_doc",(!0).toString());let i=yield this.getToken();if(e=yield We().post(ze.hi.reformat_table_table_v3,t,{headers:{Authorization:i}}),!1===e.data.success)throw e.data.message;this.setTableData(e.data),this.dispatchEventToSaveTableChanges(),this.refactorApiData(),this.lineItemsloading=!1}catch(e){return this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR")),void(this.lineItemsloading=!1)}this.renderKey++}))},addNewCustomColumn(e){this.addColumnDialog=!0},editColumnData(e,t,i){if(!this.lineDataObj[i].hasOwnProperty("custom_row"))if(!0===this.isRowMode){let o,a=10;this.clearOldSelection(),e.target.closest("label")&&e.target.closest("label").classList.add("active-border-2px"),o=this.lineDataObj[i].columns[t];let s=!0;if(o&&o.locations_list){let e=o.locations_list;if(e.hasOwnProperty("page_"+this.currentPageNo))s=!1;else if(0!=Object.entries(e).length){a=200;for(const t in e){s=!1;let i=+e[t].page-1;this.$emit("loadNewPageImage",i);break}}else this.loadAppropriatePage(i)}setTimeout((()=>{if(!1===s){let s={rowId:i,columnName:t};this.getTableRowsAreas({detail:s}),setTimeout((()=>{let i=(0,si.$)("#draw_"+t);if(i){i.querySelector(".select-areas--outline").style.opacity="0";let a=i.querySelector(".select-areas--background_area");a.style.border="2px",a.style.borderStyle="solid",a.style.borderColor="#8800ff",this.oldSelectedColumnName=t,this.scrollInToViewCenter(a),this.removeExistingConfirmationOverlays(),o&&""!==this.addExtractionMethodClass(o)&&setTimeout((()=>{let t=e.target.closest("td").dataset.columnValue,i=e.target.closest("td").dataset.scoreDescription,o={value:t,score:i,selection:a};const s=new CustomEvent("prepare_overlay",{detail:o});document.dispatchEvent(s)}),20)}}),a)}else{this.showNotification(this.$t("pages.messages.SELECT_AREA"));let e={rowId:i,columnName:t,onlySelectedRow:!0};this.getTableRowsAreas({detail:e}),setTimeout((()=>{const e=new CustomEvent("enable_column_selection",{detail:i});document.dispatchEvent(e)}),10)}}),10)}else this.loadAppropriatePage(i),setTimeout((()=>{let e={rowId:i,columnName:t,onlySelectedRow:!0};this.drawSelectedRow({detail:e}),setTimeout((()=>{let e=(0,si.$)("#draw_"+i);if(e){this.oldSelectedColumnName=t;let i=e.querySelector(".select-areas--background_area");this.scrollInToViewCenter(i)}}),40)}),100)},clearOldSelection(){if(""!=this.oldSelectedColumnName){let e=(0,si.$)("#draw_"+this.oldSelectedColumnName);if(e){let t=e.querySelector(".select-areas--background_area"),i=t.style.background.split("100%)");t.style.background=Qe.zb+i[1]}}let e=document.querySelector("#line_item_table").querySelectorAll("label.active-border-2px");Array.from(e).forEach((e=>{e.classList.remove("active-border-2px")}));let t=document.querySelector("#screenshot_container"),i=t.querySelectorAll("div.select-areas--outline");Array.from(i).forEach((e=>{e.style.opacity="0.2",e.nextSibling&&(e.nextSibling.style.border="unset")}))},loadAppropriatePage(e){let t=this.lineDataObj[e],i="";for(const o in t.locations_list){if(t.locations_list[o].page===this.currentPageNo){i=o;break}i=o}if(""!=i){let e=+t.locations_list[i].page-1;this.$emit("loadNewPageImage",e)}},drawSelectedRow(e){let t="",i=null;void 0!=e.detail&&e.detail.columnName&&(t=e.detail.rowId,i=e.detail.columnName);let o=[];if(this.lineDataObj[t]){this.lineDataObj[t].locations_list&&this.lineDataObj[t].locations_list["page_"+this.currentPageNo]&&o.push({id:t,type:"row",row_id:"",background:Qe.yY,opacity:"1",coord:this.lineDataObj[t].locations_list["page_"+this.currentPageNo].coords[0]});let a=this.lineDataObj[t].columns[i];a&&a.locations_list&&a.locations_list["page_"+this.currentPageNo]&&o.push({id:i,row_id:e.detail.rowId,type:"column",background:Qe.yY,opacity:"1",coord:a.locations_list["page_"+this.currentPageNo].coords[0]})}let a={columns:[],table_areas:[]};a.table_areas=o,et.Z.set("table_rows_data",JSON.stringify(a));const s=new CustomEvent("prepare_customized_areas");document.dispatchEvent(s)},getTableRowsAreas(e){let t="all_rows",i=null;void 0!=e.detail&&e.detail.columnName&&(t=e.detail.rowId,i=e.detail.columnName);let o=[];for(const a in this.lineDataObj)this.lineDataObj[a]&&this.lineDataObj[a].locations_list["page_"+this.currentPageNo]&&o.push({id:a,type:"row",row_id:"",background:void 0!=e.detail&&e.detail.rowId===a?"":"linear-gradient( rgba(211, 211, 211, 0.5) 100%, rgba(0, 0, 0, 0.5)100%),",opacity:(void 0!=e.detail&&e.detail.rowId,"1"),coord:this.lineDataObj[a].locations_list["page_"+this.currentPageNo].coords[0]});if(e.detail&&!e.detail.onlySelectedRow&&this.lineDataObj.hasOwnProperty(e.detail.rowId)){let t=this.lineDataObj[e.detail.rowId].columns;for(const i in t)t[i].locations_list&&t[i].locations_list.hasOwnProperty("page_"+this.currentPageNo)&&o.push({id:i,row_id:e.detail.rowId,type:"column",background:this.columnDefaultBackground(),opacity:1,coord:t[i].locations_list["page_"+this.currentPageNo].coords[0]})}this.$emit("setTableRowCorrdinates",JSON.stringify(o),i,t)},columnDefaultBackground(){return Qe.yY},hasOriginalIndex(e,t){let i=!1;return""!==e&&(i=!0),i},getScoreDescription(e){let t="";return e&&e.hasOwnProperty("score_description")&&""!==e.score_description&&null!=e.score_description&&(t=e.score_description),String(t)},TriggerSplitText(){this.split_text_confirm_dialog=!1,this.openAdvSettings=!1;const e=new CustomEvent("perform_split_text",{detail:this.split_text});document.dispatchEvent(e)},disableCustomColumn(e){this.formatting_options.hasOwnProperty("custom_columns_to_hide")&&null!==this.formatting_options.custom_columns_to_hide||(this.formatting_options.custom_columns_to_hide=Object.assign([])),this.formatting_options.custom_columns_to_hide.push(e),this.refactorApiData(),this.$forceUpdate(),this.dispatchEventToSaveTableChanges(!0)},getLabelToDisplay(e){let t=e.title;return this.$t("pages.line_items_columns."+e.translation_key.toUpperCase())!=="pages.line_items_columns."+e.translation_key.toUpperCase()&&(t=this.$t("pages.line_items_columns."+e.translation_key.toUpperCase())),t},prepareDisabledCstmColumnsList(){this.disableColumnList=[],this.docStore.record.tables&&this.docStore.record.tables.length>0&&this.docStore.record.tables[0].hasOwnProperty("layout")&&Array.from(this.docStore.record.tables[0].layout).forEach((e=>{if(!0===this.isCustomColumnHidden(e.column_name)){let t={};t["name"]=e.column_name,t["label"]=this.getLabelToDisplay(e),this.disableColumnList.push(t)}}))},openDisabledCstmColumnsView(){this.docStore.record.tables&&this.docStore.record.tables.length>0&&this.docStore.record.tables[0].hasOwnProperty("layout")&&(this.openDisableColumnListView=!0)},enableCustomColumn(e){if(e&&e.detail){var t=this.formatting_options.custom_columns_to_hide.indexOf(e.detail);-1!==t&&this.formatting_options.custom_columns_to_hide.splice(t,1),this.refactorApiData(),this.dispatchEventToSaveTableChanges(!0)}},customColumnCreated(e){e&&e.detail&&e.detail.tables&&(this.addColumnDialog=!1,this.setTableData(e.detail.tables),this.dispatchEventToSaveTableChanges(),this.refactorApiData())},createRowJson(){let e=JSON.parse(JSON.stringify(this.docStore.record.tables[0].rows[0]));e.id=Date.now(),e.ids=[],e.content="",e.locations=[],e.locations_list=[],e.is_deleted=!1,e.messages=[],e.custom_row=!0,Array.from(e.columns).forEach(((e,t)=>{e.content="",e.locations=[],e.locations_list=[],e.value="",e.formatted_value=""})),this.docStore.record.tables[0].rows.push(e),this.$forceUpdate(),this.prepareTableRowsAndRowObj()},prepareRegexData(e){this.docStore.regex.clear(),this.selectedColumn=e,Array.from(this.docStore.record.tables[0].rows).forEach(((t,i)=>{Array.from(t.columns).forEach(((t,i)=>{t.name===e&&t.hasOwnProperty("rule")&&t.hasOwnProperty("valuePattern")&&this.docStore.regex.set(t.rule,t.valuePattern)}))})),this.showRegexDlg=!0},updateRegexByRule(){this.showRegexDlg=!1,Array.from(this.docStore.record.tables[0].rows).forEach(((e,t)=>{Array.from(e.columns).forEach(((e,i)=>{e.name===this.selectedColumn&&e.hasOwnProperty("rule")&&e.hasOwnProperty("valuePattern")&&(this.docStore.record.tables[0].rows[t].columns[i].valuePattern=this.docStore.regex.get(e.rule))}))})),this.refactorApiData()},setShowRegexDlg(e){this.showRegexDlg=e},highliteFirstRowOfCurrentPage(){if(this.tableRowsLocationsMap.has("page_"+this.currentPageNo)){const e=this.tableRowsLocationsMap.get("page_"+this.currentPageNo),t=(0,si.$)("#tbl_row_"+e);t&&(this.scrollInToViewStart(t),setTimeout((()=>{t.classList.add("light-grey-with-effect"),setTimeout((()=>{t.classList.remove("light-grey-with-effect")}),1400)}),500))}},getBackgroundColor(e){let t="";return e.hasOwnProperty("is_auto_filled")&&1==e.is_auto_filled?t=this.is_auto_filled_color:e.hasOwnProperty("is_missing")&&1==e.is_missing&&(t=this.is_missing_color),t},displayFieldErrors(){this.refactorApiData()}},setup(){const e=(0,ni.Z)(),t=(0,li.H_)(),{is_manual_training_allowed:i}=(0,Pe.Jk)(t),o=(0,li.A)(),{validation_done:a,missing_mapping_column:s}=(0,Pe.Jk)(o);let l=[],r={};const n=(0,Me.iH)("");return{is_manual_training_allowed:i,is_line_item_validated:a,missing_mapping_column:s,filter:n,docStore:t,headers:(0,Me.iH)(),lineitems:(0,Me.iH)(),move_extra_rows_to:(0,Me.iH)(""),header_rows_count:(0,Me.iH)(1),min_group_rows:(0,Me.iH)(1),max_group_rows:(0,Me.iH)(),distinct_group_column:(0,Me.iH)(!1),reverse_grouping:(0,Me.iH)(!1),group_column:(0,Me.iH)(""),column_mapping_indexes:(0,Me.iH)(r),columns_to_hide:(0,Me.iH)(l),custom_columns_to_hide:(0,Me.iH)(l),addFieldsDialog:(0,Me.iH)(!1),extra_columns:(0,Me.iH)(l),poEditRestrictDialog:(0,Me.iH)(!1),poEditRestrictMessage:(0,Me.iH)(""),new_field_model:(0,Me.iH)(r),new_column_model:(0,Me.iH)(r),revert_changes_confirm_dialog:(0,Me.iH)(!1),adv_column_options:l,advance_settings_columns:(0,Me.iH)([]),headerRowCountRules:[e=>null!==e||"Please type number",e=>e>0&&e<100||"Please type number"],showNotification(t){e.notify({message:t,color:"primary",position:"bottom"})},lineDataObj:(0,Me.iH)(l),lineItemsErrors:(0,Me.iH)(r),lineItemLayout:(0,Me.iH)(l),tableColumns:(0,Me.iH)(l),tableRows:(0,Me.iH)(l),formatting_options:(0,Me.iH)(r),addColumnDialog:(0,Me.iH)(!1),headerKey:(0,Me.iH)(""),headerLable:(0,Me.iH)(""),lineItemsloading:(0,Me.iH)(!0),openDisableColumnListView:(0,Me.iH)(!1),disableColumnList:(0,Me.iH)(l),split_text:(0,Me.iH)(!1),split_text_confirm_dialog:(0,Me.iH)(!1),tableRowsLocationsMap:(0,Me.iH)(new Map),layoutExtraColumns:(0,Me.iH)([])}}});var yi=i(74260),Ci=i(17132),xi=i(18186),ki=i(92414),Si=i(39200),Ei=i(39975),Di=i(5363),Ii=i(82226),Oi=i(27011),Ai=i(83414),Ti=i(52035),Ri=i(2350),Li=i(24554),Wi=i(83884),zi=i(2165),Pi=i(64689),$i=i(30481),qi=i(6833),Ni=i(46778),Mi=i(10151),Hi=i(39570),Ui=i(13747),Fi=i(25589),ji=i(72448),Vi=i(60429),Zi=i(65869),Yi=i(65735),Bi=i(99367),Xi=i(75096),Qi=i(86115),Ji=i(20811),Ki=i(60677),Gi=i(7518),eo=i.n(Gi);const to=(0,yi.Z)(vi,[["render",oi]]),io=to;eo()(vi,"components",{QTable:Ci.Z,QTr:xi.Z,QTh:ki.Z,QFab:Si.Z,QFabAction:Ei.Z,QTooltip:Di.Z,QBtnDropdown:Ii.Z,QList:Oi.Z,QItem:Ai.Z,QItemSection:Ti.Z,QItemLabel:Ri.Z,QIcon:Li.Z,QTd:Wi.Z,QBtn:zi.Z,QInput:Pi.Z,QMarkupTable:$i.Z,QSpinner:qi.Z,QDialog:Ni.Z,QCard:Mi.Z,QToolbar:Hi.Z,QToolbarTitle:Ui.Z,QCardSection:Fi.Z,QSelect:ji.Z,QExpansionItem:Vi.Z,QSeparator:Zi.Z,QCheckbox:Yi.Z,QCardActions:Bi.Z,QAvatar:Xi.Z,QField:Qi.Z,QMenu:Ji.Z}),eo()(vi,"directives",{ClosePopup:Ki.Z});var oo=i(65864),ao=i(49566),so=i(57765);const lo=e=>((0,o.dD)("data-v-0259757a"),e=e(),(0,o.Cn)(),e),ro={class:"image-decorator",ref:"image-area",id:"image_area"},no={id:"screenshot_container"},co=["src","width"],ho=["onMousedown","onMousemove","id"],uo=["onClick"],mo=["onClick"],go=lo((()=>(0,o._)("div",{class:"select-areas--delete_area"},null,-1))),_o=[go],po=["id"],wo=["area-tag","area-type"],fo=["area-tag","area-type","onClick"],bo={class:"c-crop--hide_main"},vo=["src","width"],yo={class:"text-h6"};function Co(e,t,i,l,r,n){const d=(0,o.up)("Resizable"),c=(0,o.up)("q-card-section"),h=(0,o.up)("q-btn"),u=(0,o.up)("q-card-actions"),m=(0,o.up)("q-card"),g=(0,o.up)("q-dialog"),_=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)("div",ro,[(0,o._)("div",no,[e.url?((0,o.wg)(),(0,o.iD)("img",{key:0,onLoad:t[0]||(t[0]=(...t)=>e.prepareImageData&&e.prepareImageData(...t)),id:"screenshot",class:"original-image",src:e.url,alt:"Original Image",width:e.width},null,40,co)):(0,o.kq)("",!0),(0,o._)("div",{class:"select-areas--overlay",style:(0,a.j5)({opacity:e.opacityOverlay,position:"absolute",width:e.originImgSize.w+"px",height:e.originImgSize.h+"px",display:"block"})},null,4),!1===e.isRowMode?((0,o.wg)(),(0,o.iD)("div",{key:1,class:"pointer-events-none",id:"draw",style:(0,a.j5)({"background-color":"rgb(0, 0, 0)",opacity:0,position:"absolute",width:e.originImgSize.w+"px",height:e.originImgSize.h+"px"}),onMousedown:t[1]||(t[1]=(...t)=>e.mouseDown&&e.mouseDown(...t)),onMousemove:t[2]||(t[2]=(...t)=>e.mouseMove&&e.mouseMove(...t))},null,36)):((0,o.wg)(),(0,o.iD)("div",{key:2,class:"pointer-events-none",id:"draw",style:(0,a.j5)({"background-color":"rgb(0, 0, 0)",opacity:0,position:"absolute",width:e.originImgSize.w+"px",height:e.originImgSize.h+"px"})},null,4)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.areas,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id},[!1===e.isRowMode?((0,o.wg)(),(0,o.iD)("div",{key:0,onMousedown:(0,s.iM)((i=>e.startMove(t,i)),["stop","prevent"]),onMousemove:i=>e.doMove(t,i),id:"draw_"+t.areaTag},[(0,o._)("div",{class:"select-areas--outline",style:(0,a.j5)({opacity:"column"===t.areaType?"1":e.opacityOutline,position:"absolute",cursor:"default",width:t.width+4+"px",height:t.height+4+"px",left:e.areaDisplayPosX(t)-2+"px",top:e.areaDisplayPosY(t)-2+"px","z-index":"column"===t.areaType?"2":t.z})},null,4),(0,o._)("div",{class:"select-areas--background_area",style:(0,a.j5)({background:t.background+`#fff url('${e.url}') -${t.x}px -${t.y}px / ${e.originImgSize.w}px ${e.originImgSize.h}px no-repeat`,position:"absolute",cursor:!0===e.enableEditing?"move":"pointer",width:t.width+"px",height:t.height+"px",left:e.areaDisplayPosX(t)+"px",top:e.areaDisplayPosY(t)+"px","z-index":t.z+2}),onClick:i=>e.changeResizable(t.id)},null,12,uo),t.resizable&&!0===e.enableEditing?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"delete-area",style:(0,a.j5)({display:"block",left:e.areaDisplayPosX(t)+t.width+"px",top:e.areaDisplayPosY(t)-25+"px","z-index":t.z+2}),onClick:i=>e.deleteSelected(t.id)},_o,12,mo)):(0,o.kq)("",!0),!0===e.enableEditing?((0,o.wg)(),(0,o.j4)(d,{key:1,item:t,posImg:e.posImg,"pos-correction":e.posCorrection,onStartDrag:e.startDrag,onDoDrag:e.doDrag},null,8,["item","posImg","pos-correction","onStartDrag","onDoDrag"])):(0,o.kq)("",!0)],40,ho)):((0,o.wg)(),(0,o.iD)("div",{key:1,id:"draw_"+t.areaTag},[(0,o._)("div",{class:(0,a.C_)(["select-areas--outline","column"==t.areaType?"column_outline":"row_outline"]),"area-tag":t.areaTag+"_border","area-type":t.areaType+"_border",style:(0,a.j5)({opacity:.2,position:"absolute",cursor:"default",width:t.width+("column"==t.areaType?2:4)+"px",height:t.height+4+"px",left:e.areaDisplayPosX(t)-2+"px",top:e.areaDisplayPosY(t)-2+"px","z-index":"unset"})},null,14,wo),(0,o._)("div",{class:(0,a.C_)(["select-areas--background_area","column"==t.areaType?"column_background_area":"row_background_area"]),"area-tag":t.areaTag+"_area","area-type":t.areaType+"_area",onClick:i=>e.decideAction(t),style:(0,a.j5)({background:t.background+`#fff url('${e.url}') -${t.x}px -${t.y}px / ${e.originImgSize.w}px ${e.originImgSize.h}px no-repeat`,position:"absolute",cursor:"pointer",width:t.width-("column"==t.areaType?3:0)+"px",height:t.height+"px",left:e.areaDisplayPosX(t)+"px",top:e.areaDisplayPosY(t)+"px","z-index":"unset",opacity:t.opacity})},null,14,fo)],8,po))])))),128))]),(0,o._)("div",bo,[(0,o._)("img",{id:"c-crop--hide_img",src:e.url,alt:"",width:e.width},null,8,vo)]),(0,o.Wm)(g,{modelValue:e.correctionDialog,"onUpdate:modelValue":t[6]||(t[6]=t=>e.correctionDialog=t),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{class:"bg-teal text-white",style:{width:"300px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o._)("div",yo,(0,a.zw)(e.$t("pages.screen2a.confirmation")),1)])),_:1}),(0,o.Wm)(c,{class:"q-pt-none"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("isdrawcorrect")),1)])),_:1}),(0,o.Wm)(u,{align:"right",class:"bg-white text-teal"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(h,{flat:"",label:e.$t("pages.screen2a.cancel"),onClick:t[3]||(t[3]=t=>e.cancelAreaSelection())},null,8,["label"]),[[_]]),(0,o.wy)((0,o.Wm)(h,{flat:"","data-cy":"no",label:e.$t("pages.screen2a.no"),onClick:t[4]||(t[4]=t=>e.reSelectArea())},null,8,["label"]),[[_]]),(0,o.wy)((0,o.Wm)(h,{flat:"","data-cy":"yes",label:e.$t("pages.screen2a.yes"),onClick:t[5]||(t[5]=t=>e.saveSelectionResult())},null,8,["label"]),[[_]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],512)}var xo=i(98266),ko=function(e,t,i,o){function a(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,s){function l(e){try{n(o.next(e))}catch(t){s(t)}}function r(e){try{n(o["throw"](e))}catch(t){s(t)}}function n(e){e.done?i(e.value):a(e.value).then(l,r)}n((o=o.apply(e,t||[])).next())}))};let So,Eo,Do,Io={columns:[],table_areas:[]};const Oo=(0,o.aZ)({mixins:[di.Z,ri.Z],data(){return{mousedown:(0,Me.iH)(!1),originImgSize:{w:0,h:0,r:0},url:this.cropUrl,posImg:{top:0,left:0},areas:[{id:1,x:10,y:10,startX:10,startY:10,width:10,height:10,z:0,resizable:!1,opacity:"1",background:Qe.yY,areaTag:"table",areaType:"table",rowId:""}],currentSelectedItem:(0,Me.iH)(),latestAreaItem:{startX:0,startY:0,endX:0,endY:0},scrollLeft:0,scrollTop:0,moveTempX:0,moveTempY:0,moveCurrentX:0,moveCurrentY:0,temp:0,dragdown:!1,move:!1,imageHeight:0,imageWidth:0,correctionDialog:!1,numberOfAreas:0,oldArea:"",disableImageRowsClick:!1,delay:170,clicks:0,timer:(0,Me.iH)(),delay2:(0,Me.iH)(170),timer2:(0,Me.iH)()}},props:{cropUrl:{type:String,default:"https://dev.doc2api.cloudintegration.eu/resource/image/1b90b6d5-63b5-446b-92a4-a60d57dc0edd/1.png"},width:{type:Number,default:1500},opacityOutline:{type:Number,default:.2},opacityOverlay:{type:Number,default:.2},posCorrection:{type:Boolean,default:!0},tableAreas:{type:String,default:""},isRowMode:{type:Boolean,default:!1},enableEditing:{type:Boolean,default:!1}},components:{Resizable:xo.Z},emits:["saveColumnCoords","toggleExtractedColumnMode"],watch:{cropUrl(e){this.url=e,setTimeout((()=>{this.setSize()}),200)},tableAreas(e){this.prepareDataForAreas()},width(e){return ko(this,void 0,void 0,(function*(){yield this.setSize(),this.prepareImageData()}))}},methods:{areaDisplayPosX(e){return e.x+(this.posCorrection?this.posImg.left:0)},areaDisplayPosY(e){return e.y+(this.posCorrection?this.posImg.top:0)},mousePosX(e){return e.pageX-this.posImg.left},mousePosY(e){return e.pageY-this.posImg.top},setSize(){return ko(this,void 0,void 0,(function*(){if(!this.url)return;let e=yield this.getSize(this.url);this.originImgSize=e}))},getSize(e){let t=this.$el.querySelector("#c-crop--hide_img");return new Promise((i=>{e&&t?(t.onload=function(){const e=So.getSizeImg(t);i(e)},t.src=e):i({w:0,h:0,r:0})}))},getSizeImg(e){let t=e.width,i=e.height,o=0===t&&0===i?0:t/i;return{w:t,h:i,r:o}},calcPosOfBox(){let e=this.$refs["image-area"];this.scrollLeft=window.pageXOffset||document.documentElement.scrollLeft,this.scrollTop=window.pageYOffset||document.documentElement.scrollTop;let t=e.getBoundingClientRect().top,i=e.getBoundingClientRect().left;this.posImg.top=t+this.scrollTop,this.posImg.left=i+this.scrollLeft},manageEventsForColumns(e){this.clicks++,1===this.clicks?this.timer=setTimeout((()=>{this.clicks=0,this.mouseDown(e);let t=(0,si.$)("#draw_"+this.oldArea).querySelector(".select-areas--background_area");t.style.cursor="crosshair",t.addEventListener("mousemove",this.mouseMove)}),this.delay):(this.clicks=0,clearTimeout(this.timer),this.dblClickToSelect(e))},mouseDown(e){this.mousedown=!0;let t=null;if(t=this.areas.length>0?this.areas.slice(-1).pop().id+1:1,this.numberOfAreas=t,0!=this.latestAreaItem.startX&&0!=this.latestAreaItem.startY&&!1===this.isRowMode){let i=this.latestAreaItem.startX,o=this.latestAreaItem.startY,a=e.layerX,s=e.layerY,l=a-i,r=s-o;(l<0||r<0)&&(a=i,s=o,i=e.layerX,o=e.layerY,l=a-i,r=s-o);let n={id:t,x:i,y:o,startX:i,startY:o,width:l,height:r,z:0,resizable:!1,opacity:"1",background:this.isRowMode?Qe.yY:"",areaTag:this.isRowMode?"column":"table",areaType:this.isRowMode?"column":"table",rowId:""};return this.temp=n.id,this.areas.push(n),void(this.latestAreaItem={startX:0,startY:0,endX:0,endY:0})}if(t){let i={id:t,x:this.mousePosX(e),y:this.mousePosY(e),startX:this.mousePosX(e),startY:this.mousePosY(e),width:0,height:0,z:0,resizable:!1,opacity:"1",background:this.isRowMode?Qe.yY:"",areaTag:this.isRowMode?"column":"table",areaType:this.isRowMode?"column":"table",rowId:""};this.areas.push(i),this.temp=i.id,this.latestAreaItem.startX=this.mousePosX(e),this.latestAreaItem.startY=this.mousePosY(e),this.latestAreaItem.endX=0,this.latestAreaItem.endY=0}},mouseMove(e){this.mousedown&&(this.areas.filter((e=>e.id===this.temp)).map((t=>{let i=e.pageX-this.posImg.left,o=e.pageY-this.posImg.top,a=t.startX-i,s=t.startY-o;a<0&&(a*=-1,i-=a),s<0&&(s*=-1,o-=s),t.x=i,t.y=o,t.width=a,t.height=s})),this.latestAreaItem={startX:0,startY:0,endX:0,endY:0})},mouseUp(){!0===this.isRowMode&&!1===this.disableImageRowsClick||(this.timer2=setTimeout((()=>{this.mousedown=!1,this.areas=this.areas.filter((e=>e.width>=3&&e.height>=3)),this.endMove(),this.endDrag(),this.prepareTableArea(),!0===this.isRowMode&&!0===this.findAreaById(this.numberOfAreas)&&(this.correctionDialog=!0)}),this.delay2))},changeResizable(e){this.areas.filter((t=>t.id===e)).map((e=>{e.resizable=!0,e.z=100})),this.areas.filter((t=>t.id!==e)).map((e=>{e.resizable=!1,e.z=0}))},deleteSelected(e){this.areas=this.areas.filter((t=>t.id!==e)),this.prepareTableArea()},findAreaById(e){let t=!1;for(let i of this.areas)if(i.id===e){t=!0;break}return t},deleteSelectedColumn(e){const t=new CustomEvent("delete_select_area_column",{});document.dispatchEvent(t)},validateColumn(e){const t=new CustomEvent("validate_selected_column",{});document.dispatchEvent(t)},startDrag(){this.dragdown=!0},doDrag(e,t,i){if(this.dragdown)switch(t){case"w":i.pageX-this.posImg.left>=0&&(e.width=e.width+e.x-i.pageX+this.posImg.left,e.x=i.pageX-this.posImg.left),e.width<10&&(e.x=e.x-10,e.width=e.width+10);break;case"sw":i.pageX-this.posImg.left>=0&&(e.width=e.width+e.x-i.pageX+this.posImg.left,e.x=i.pageX-this.posImg.left),i.pageY-this.posImg.top<=this.originImgSize.h&&(e.height=i.pageY-this.posImg.top-e.y),e.width<10&&(e.x=e.x-10,e.width=e.width+10),e.height<10&&(e.height=e.height+10);break;case"s":i.pageY-this.posImg.top<=this.originImgSize.h&&(e.height=i.pageY-this.posImg.top-e.y),e.height<10&&(e.height=e.height+10);break;case"se":i.pageX-this.posImg.left<=this.originImgSize.w&&(e.width=i.pageX-this.posImg.left-e.x),i.pageY-this.posImg.top<=this.originImgSize.h&&(e.height=i.pageY-this.posImg.top-e.y),e.width<10&&(e.x=e.x-10,e.width=e.width+10),e.height<10&&(e.height=e.height+10);break;case"e":i.pageX-this.posImg.left<=this.originImgSize.w&&(e.width=i.pageX-this.posImg.left-e.x),e.width<10&&(e.x=e.x-10,e.width=e.width+10);break;case"ne":i.pageX-this.posImg.left<=this.originImgSize.w&&(e.width=i.pageX-this.posImg.left-e.x),i.pageY-this.posImg.top>=0&&(e.height=e.height+(e.y+this.posImg.top-i.pageY),e.y=i.pageY-this.posImg.top),e.width<10&&(e.x=e.x-10,e.width=e.width+10),e.height<10&&(e.height=e.height+10);break;case"n":i.pageY-this.posImg.top>=0&&(e.height=e.height+(e.y+this.posImg.top-i.pageY),e.y=i.pageY-this.posImg.top),e.height<10&&(e.height=e.height+10);break;case"nw":i.pageY-this.posImg.top>=0&&(e.height=e.height+(e.y+this.posImg.top-i.pageY),e.y=i.pageY-this.posImg.top),i.pageX-this.posImg.left>=0&&(e.width=e.width+e.x-i.pageX+this.posImg.left,e.x=i.pageX-this.posImg.left),e.width<10&&(e.x=e.x-10,e.width=e.width+10),e.height<10&&(e.height=e.height+10);break;default:break}},endDrag(){this.dragdown=!1},startMove(e,t){!0===this.enableEditing?(this.move=!0,this.moveTempX=t.clientX,this.moveTempY=t.clientY,this.moveCurrentX=e.x,this.moveCurrentY=e.y):this.move=!0},doMove(e,t){if(!1!==this.enableEditing&&this.move){let i=this.moveCurrentX+(t.clientX-this.moveTempX),o=this.moveCurrentY+(t.clientY-this.moveTempY),a=this.originImgSize.w-e.width,s=this.originImgSize.h-e.height;i>0&&o>0&&i<a&&o<s&&(e.x=i,e.y=o)}},endMove(){this.move=!1},creatReactangle(e,t,i,o,a,s,l,r,n){let d=null;if(d=this.areas.length>0?this.areas.slice(-1).pop().id+1:1,d){let c={id:d,x:e,y:t,startX:e,startY:t,width:i,height:o,z:0,resizable:!1,opacity:s,background:l,areaTag:a,areaType:n,rowId:r};this.areas.push(c),this.temp=c.id}},prepareImageData(){Do=(0,si.$)("#screenshot"),Do&&(this.imageWidth=Do.offsetWidth,this.imageHeight=Do.offsetHeight,this.prepareDataForAreas())},prepareDataForAreas(){this.removeExistingConfirmationOverlays(),this.areas=[],this.isRowMode?(this.delay2=170,this.disableImageRowsClick=!1,this.disableSelectionForRow(this.oldArea),this.prepareRowAreas()):(this.delay2=1,this.prepareTableAreas())},prepareCustomizedAreas(){this.areas=[],this.prepareTableAreas(),this.prepareRowAreas()},prepareRowAreas(){if(et.Z.has("table_rows_data")&&null!=et.Z.getItem("table_rows_data")&&""!=et.Z.getItem("table_rows_data")){let e=et.Z.getItem("table_rows_data");Io=JSON.parse(e)}else Io={columns:[],table_areas:[]};let e=[];Io&&Io.table_areas.length>0&&Array.from(Io.table_areas).forEach((t=>{e=t.coord.split(",");let i=Math.round(this.imageWidth*e[0]),o=Math.round(this.imageHeight*e[1]),a=Math.round(this.imageWidth*e[2]),s=Math.round(this.imageHeight*e[3]),l=a-i,r=s-o,n=t.id,d=t.opacity,c=t.background,h=t.type,u=t.row_id;this.creatReactangle(i,o,l,r,n,d,c,u,h)}))},prepareTableAreas(){if(et.Z.has("table_data")&&null!=et.Z.getItem("table_data")&&""!=et.Z.getItem("table_data")){let e=et.Z.getItem("table_data");Io=JSON.parse(e)}else Io={columns:[],table_areas:[]};let e=[];Io&&Io.table_areas.length>0&&Array.from(Io.table_areas).forEach((t=>{e=t.split(",");let i=this.getCoordinate(e[0]),o=this.getCoordinate(e[1]),a=this.getCoordinate(e[2]),s=this.getCoordinate(e[3]);i=Math.round(this.imageWidth*i),o=Math.round(this.imageHeight*o),a=Math.round(this.imageWidth*a),s=Math.round(this.imageHeight*s);let l=a-i,r=s-o;l<0&&(l*=-1,i-=l),r<0&&(r*=-1,o-=r);let n="table_"+Math.floor(1e5*Math.random());this.creatReactangle(i,o,l,r,n,"1","","","table")}))},getCoordinate(e){return e<0?0:e>1?1:e},getTableAreaAsString(e,t,i,o){let a=e/this.imageWidth,s=t/this.imageHeight,l=i/this.imageWidth,r=o/this.imageHeight;return a.toString()+","+s.toString()+","+l.toString()+","+r.toString()},prepareTableArea(){Io.table_areas=[],Array.from(this.areas).forEach((e=>{let t=e.width+e.x,i=e.height+e.y;Io.table_areas.push(this.getTableAreaAsString(e.x,e.y,t,i))})),!1===this.isRowMode&&et.Z.set("table_data",JSON.stringify(Io))},calculateLeftPosition(e){let t=this.areaDisplayPosX(e)+e.width;return t+50>=this.imageWidth&&(t=this.areaDisplayPosX(e)-60),t+"px"},calculatePositionFromTop(e){let t=this.areaDisplayPosY(e)-25;return t<0&&(t=this.areaDisplayPosY(e)),t+"px"},cancelAreaSelection(){this.deleteSelected(this.numberOfAreas),this.correctionDialog=!1,this.numberOfAreas=0,this.disableSelectionForRow(this.oldArea)},reSelectArea(){this.deleteSelected(this.numberOfAreas),this.correctionDialog=!1,this.numberOfAreas=0,setTimeout((()=>{let e=(0,si.$)("#draw_"+this.oldArea).querySelector(".select-areas--background_area");e.style.cursor="crosshair"}),10)},saveSelectionResult(){if(Io.table_areas.length>0){this.correctionDialog=!1,this.disableImageRowsClick=!1;let e,t=Io.table_areas[Io.table_areas.length-1];e=t.hasOwnProperty("coord")?t.coord:t,this.disableSelectionForRow(this.oldArea),this.numberOfAreas=0,this.$emit("saveColumnCoords",e)}},decideAction(e){let t=e.areaTag,i=e.areaType,o=e.rowId;if(this.currentSelectedItem=e,this.removeExistingConfirmationOverlays(),!0!==this.disableImageRowsClick)if(this.disableSelectionForRow(this.oldArea),"column"===i){this.numberOfAreas=0;let e=(0,si.$)("#screenshot_container"),i=e.querySelectorAll("div.column_background_area");Array.from(i).forEach((e=>{let t=e.style.background.split("100%)");e.style.background=Qe.zb+t[1]}));let a=e.querySelectorAll("div.column_outline");Array.from(a).forEach((e=>{e.style.opacity="0.2",e.nextSibling&&(e.nextSibling.style.border="unset")})),this.oldArea=o;let s=(0,si.$)("#input_"+t+"_"+o);if(s){let e=(0,si.$)("#draw_"+t),i=e.querySelector(".select-areas--outline");i.style.opacity="0";let o=document.querySelector("#line_item_table").querySelectorAll("label.active-border-2px");Array.from(o).forEach((e=>{e.classList.remove("active-border-2px")}));let a=e.querySelector(".select-areas--background_area");a.style.border="2px",a.style.borderStyle="solid",a.style.borderColor="#8800ff",s.scrollIntoView(),s.querySelector("label").classList.add("active-border-2px");let l=s.querySelector("label.extraction_method");if(null!=l){let e=s.dataset.columnValue,t=s.dataset.scoreDescription,i={value:e,score:t,selection:a};this.prepareOverlay({detail:i})}}}else{this.numberOfAreas=0;let e=document.getElementById(t);if(e.classList.add("active-table-row"),""!=this.oldArea){let e=document.getElementById(this.oldArea);e.classList.remove("active-table-row")}let i={rowId:t,columnName:null};const o=new CustomEvent("get_table_rows_areas",{detail:i});document.dispatchEvent(o),this.oldArea=t}},enableSelectionForRow(e){this.disableImageRowsClick=!0,this.disableSelectionForRow(this.oldArea);let t=e.detail;this.oldArea=e.detail;let i=(0,si.$)("#draw_"+t).querySelector(".select-areas--background_area");i.style.cursor="crosshair",i.addEventListener("mousedown",this.manageEventsForColumns)},disableSelectionForRow(e){if(""!=e&&(0,si.$)("#draw_"+e)){let t=(0,si.$)("#draw_"+e).querySelector(".select-areas--background_area");t.style.cursor="pointer",t.removeEventListener("mousedown",this.manageEventsForColumns),t.removeEventListener("mousemove",this.mouseMove)}},dblClickToSelect(e){this.disableSelectionForRow(this.oldArea);let t=this.getTableAreaAsString(this.mousePosX(e),this.mousePosY(e),this.mousePosX(e),this.mousePosY(e));this.$emit("saveColumnCoords",t)},prepareOverlay(e){let t=e.detail.value,i=e.detail.score,o=e.detail.selection,a=null;null!=i&&""!==i&&(a={score:i,background:this.getColor(Number(i))}),this.drawOverlay(String(t),o,a)},drawOverlay(e,t,i){var o,a,s;this.removeExistingConfirmationOverlays();const l=this.getOffset(t),r=document.createElement("div");r.setAttribute("id","confirmation_overlay"),r.style.position="absolute",r.style.zIndex="99999",r.style.left=l.left+"px",r.style.top=(+l.top+ +l.height+6).toString()+"px",r.style.background="#ffffff",r.style.color="#898989",r.style.minHeight="65px",r.style.minWidth="100px",r.style.maxWidth=.75*this.imageWidth+"px",r.style.textAlign="center",r.style.padding="5px 10px 5px 10px",r.style.letterSpacing="1px",r.style.borderRadius="7px",r.style.boxShadow="0 1px 2px rgba(0,0,0,0.07),\n      0 2px 4px rgba(0,0,0,0.07),\n      0 4px 8px rgba(0,0,0,0.07),\n      0 8px 16px rgba(0,0,0,0.07),\n      0 16px 32px rgba(0,0,0,0.07),\n      0 32px 64px rgba(0,0,0,0.07);",r.innerHTML=`<div>\n                    <div><b>${e}</b></div>\n                    <div>\n                    <span id='divOverlayWrong'>\n                      <i style='display: inline-block;border-radius: 50px;box-shadow: 0px 0px 2px #888;padding: 0.5em 0.6em;cursor:pointer;' class='fa fa-times'></i>\n                    </span>\n                    <span id='divOverlayCorrect'>\n                      <i style='display: inline-block;border-radius: 50px;box-shadow: 0px 0px 2px #888;padding: 0.5em 0.5em;cursor:pointer;' class='fas fa-check'></i>\n                    </span></div>\n                  </div>`,document.body.appendChild(r),null===(o=(0,si.$)("#divOverlayCorrect"))||void 0===o||o.addEventListener("click",(e=>{this.removeExistingConfirmationOverlays(),this.validateColumn(this.currentSelectedItem)})),null===(a=(0,si.$)("#divOverlayWrong"))||void 0===a||a.addEventListener("click",(e=>{this.removeExistingConfirmationOverlays(),this.deleteSelectedColumn(this.currentSelectedItem)}));try{const e=(0,si.$)("#confirmation_overlay"),o=null===(s=(0,si.$)("#confirmation_overlay"))||void 0===s?void 0:s.clientWidth,a=l.width,n=(+o-+a)/2;e.style.left=+l.left-+n+"px";let d=+t.getAttribute("width")+ +t.getAttribute("y")+e.offsetHeight;d>=Do.offsetHeight&&(r.style.top=(+l.top-6-+e.offsetHeight).toString()+"px"),i&&setTimeout((()=>{this.overlayForScore(e,i)}),10)}catch(n){}},overlayForScore(e,t){let i=t.score,o=t.background;const a=this.getOffset(e),s=document.createElement("div");s.setAttribute("id","score_overlay"),s.style.position="absolute",s.style.zIndex="99999",s.style.left=(+a.left+a.width+6).toString()+"px",s.style.top=(+a.top-15).toString()+"px",s.style.background=o,s.style.color="#898989",s.style.fontSize="14px",s.style.fontWeight="bold",s.style.letterSpacing="2px",s.style.cursor="pointer",s.style.padding="0.1em 0.6em",s.style.border="1px solid #f5f5f5",s.style.borderRadius="50px",s.innerHTML=`<div> <span  class='column-score-test' > ${i} </span> </div>`,document.body.appendChild(s)},getOffset(e){const t=e.getBoundingClientRect();return{left:t.left+window.pageXOffset,right:t.right+window.pageXOffset,top:t.top+window.pageYOffset,width:t.width||e.offsetWidth,height:t.height||e.offsetHeight}},handleScroll(){this.removeExistingConfirmationOverlays()}},mounted(){So=this,this.setSize(),Eo=(0,si.$)("#image_area"),Eo.addEventListener("mousemove",this.calcPosOfBox),Eo.addEventListener("scroll",this.calcPosOfBox),this.calcPosOfBox(),Eo.addEventListener("mouseup",this.mouseUp),document.addEventListener("prepare_overlay",this.prepareOverlay),document.addEventListener("reset_table_areas",this.prepareDataForAreas),document.addEventListener("enable_column_selection",this.enableSelectionForRow),document.addEventListener("prepare_customized_areas",this.prepareCustomizedAreas),(0,si.$)("#image_container").parentElement.addEventListener("scroll",this.handleScroll)},unmounted:function(){Eo.removeEventListener("mousemove",this.calcPosOfBox),Eo.removeEventListener("scroll",this.calcPosOfBox),Eo.removeEventListener("mouseup",this.mouseUp),document.removeEventListener("prepare_overlay",this.prepareOverlay),document.removeEventListener("reset_table_areas",this.prepareDataForAreas),document.removeEventListener("prepare_customized_areas",this.prepareCustomizedAreas),document.removeEventListener("enable_column_selection",this.enableSelectionForRow);let e=(0,si.$)("#image_container");if(e){let t=e.parentElement;t&&t.removeEventListener("scroll",this.handleScroll)}}}),Ao=(0,yi.Z)(Oo,[["render",Co],["__scopeId","data-v-0259757a"]]),To=Ao;eo()(Oo,"components",{QDialog:Ni.Z,QCard:Mi.Z,QCardSection:Fi.Z,QCardActions:Bi.Z,QBtn:zi.Z}),eo()(Oo,"directives",{ClosePopup:Ki.Z});var Ro=i(72272),Lo=function(e,t,i,o){function a(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,s){function l(e){try{n(o.next(e))}catch(t){s(t)}}function r(e){try{n(o["throw"](e))}catch(t){s(t)}}function n(e){e.done?i(e.value):a(e.value).then(l,r)}n((o=o.apply(e,t||[])).next())}))};let Wo=new Map,zo={columns:[],table_areas:[]};const Po=document.querySelector.bind(document);let $o;const qo=(0,o.aZ)({el:"#app",mixins:[Ue.Z,qe.Z,Xe.Z,$e.Z,ri.Z],components:{Loader:He.Z,invoiceSaveExport:Fe.Z,LineItemsTblExtV3:io,AIDialGauge:Ze.Z,autoTesting:Ye.Z,DocumentLock:Je.Z,MessageBanner:Ke.Z,Classification:je.Z,DeleteRulesBtn:Ge.Z,ErrorDocumentView:oo.Z,MultiSelectAreasImageTblV3:To,scriptBtn:so.Z,IgnoreTableValidation:Ro.Z},data(){return{draggingColumnEl:{},deleteColumnInfo:{},enableEditing:!1,enableColumnEditing:!1,imageHeight:0,imageWidth:0,viewBox:"0 0 0 0",enableExportButton:!1,purchaseOrderColumns:[],purchaseOrderData:[],closeEnough:6,dragTL:!1,dragBL:!1,dragTR:!1,dragBR:!1,rect:{},current_zoom:1,account_block:"",extractedData:"",currentColumnName:"",currentRowId:"",debounceAutoSaveFunc:{}}},watch:{training_mode(e){!1===e&&(this.persistTableAreas(),this.restrictDrawing(),this.setTableMode())},$route(e,t){if(!e.hasOwnProperty("path")||!t.hasOwnProperty("path"))return;const i=e.path.split("/"),o=t.path.split("/");i.length>2&&o.length>2&&i[1]===o[1]&&this.get_cached_data_id!=this.docId&&window.location.reload()}},mounted(){this.init(),this.isDebugFlagHandler(),document.addEventListener("update_table_data",this.updateTableDataForSave),document.addEventListener("delete_select_area_column",this.deleteColumnDataForReSelection),document.addEventListener("validate_selected_column",this.validateSelectedColumn),document.addEventListener("disable_all_modes",this.diableAllModes),document.addEventListener("rules_deleted",this.rulesDeleted),document.addEventListener("perform_split_text",this.callSplitTextAction),window.tblExtV3=this,this.debounceAutoSaveFunc=(0,tt.Z)((()=>{this.saveDataOnChanges()}),1e3)},unmounted:function(){window.removeEventListener("resize",this.windowResize),document.removeEventListener("update_table_data",this.updateTableDataForSave),document.removeEventListener("delete_select_area_column",this.deleteColumnDataForReSelection),document.removeEventListener("validate_selected_column",this.validateSelectedColumn),document.removeEventListener("disable_all_modes",this.diableAllModes),document.removeEventListener("rules_deleted",this.rulesDeleted),document.removeEventListener("rules_deleted",this.rulesDeleted),document.removeEventListener("perform_split_text",this.callSplitTextAction)},methods:{goHelp(){window.open("https://docs.fellowpro.com/DocBits/table-extraction/training-of-table-extraction/")},init(){return Lo(this,void 0,void 0,(function*(){this.isDocForTraining();const e=!0===this.table_train?String(this.$route.query.token):"";if(yield this.setAuthToken(e),!0===this.table_train){if(this.setDocLockStoreDisable(),this.docId=String(this.$route.query.id),this.doc2AppMode=!0,yield this.getTrainingData(),!this.record||0===Object.keys(this.record).length||!1===this.record.success)return void this.handleException()}else{this.docId=String(this.$route.params.id);const e=(!0).toString();if("true"===e.toLowerCase()&&(this.$route.params.id||this.$router.push("/dashboard"),this.doc2AppMode=!0),yield this.getInvoiceDataByDocId(),!this.record||0===Object.keys(this.record).length||!1===this.record.success)return void this.handleException();this.setTableTrainingFlag();const t=new CustomEvent("init_line_items",{detail:this.record});document.dispatchEvent(t)}this.handleBlockedSupplier(),this.account_block||(window.addEventListener("resize",this.windowResize),this.handleAiTableWarning(),this.handleReadOnly(),this.handleDocLockSubscribe(),this.isReadOnly?(this.error_message=this.$t("pages.messages.READ_ONLY_MSG"),this.error_class="error-banner",this.trigger_document_lock=!1):this.trigger_document_lock=!0,this.imageWidth=Po("#image_container").offsetWidth-15,et.Z.set("table_data",""),et.Z.set("table_rows_data",""),this.initPage())}))},handleAiTableWarning(){this.has_ai_table&&(this.ai_table_warning=!0)},handleException(){this.isReadOnly=!0,this.error_message=this.$t("pages.messages.INVALID_DOCUMENT"),this.error_class="error-banner"},doManualTraining(){this.ai_table_warning&&(this.ai_table_warning=!1,this.deleteAllExtractedData(),this.setManualTraining(!0))},handleDocLockSubscribe(){const e=(0,li.TB)();e.$subscribe(((e,t)=>{this.isReadOnly=!this.doc_lock.success,this.handleReadOnly()}))},handleReadOnly(){if(Qe.at.includes(this.record.status))return void(this.isReadOnly=!0);const e=Ne.W1.hasAccess("update");e||(this.isReadOnly=!0)},isDocForTraining(){this.$route.params.table_train&&"true"===this.$route.params.table_train&&(this.table_train=!0)},setTableTrainingFlag(){!0===this.table_train&&(this.record.is_table_training_doc=!0)},getToken(){return this.token},getTrainingData(){return Lo(this,void 0,void 0,(function*(){try{let e;if(e=yield this.getTrainingDataByDocId(),!e||!e.data)throw e;if(!1===e.data.success&&this.api_tries<1&&(this.api_tries++,e=yield this.getTrainingDataByDocId()),!1===e.data.success||!e.data.data||!e.data.data.doc_id)throw e;this.record=e.data.data,this.record.token=this.token,this.is_manual_training_allowed=!0,this.setTableTrainingFlag();const t=new CustomEvent("init_line_items",{detail:this.record});document.dispatchEvent(t)}catch(e){}finally{this.hideLoading()}}))},getTrainingDataByDocId(){return Lo(this,void 0,void 0,(function*(){let e;this.showLoading();try{let t=this.getToken();e=yield We().get(ze.hi.get_table_train_data+this.docId+"&version=v3",{headers:{Authorization:t}})}catch(t){}return e}))},getInvoiceDataByDocId(){return Lo(this,void 0,void 0,(function*(){try{if(this.record.doc_id==this.docId)return;this.showLoading(),this.record=[],this.clearSelectedSessionStorage();this.docId;yield this.getDocumentById(this.docId)}catch(e){this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}finally{this.hideLoading()}}))},initPage(){this.page=1,this.handleImageBaseURL(),this.image=this.baseUrl+"/"+(0,ao.Rl)(this.record.images[0].path),this.images=(0,ao.PN)(this.record.images),et.Z.set("table_data",""),Wo=new Map,this.record.tables&&this.record.tables[0]&&this.record.tables[0].locations_list&&this.record.tables[0].locations_list[0]&&this.prepareTableMap(this.record.tables[0].locations_list),this.document_version=this.record.document_version?this.record.document_version:1,window.addEventListener("keydown",(e=>{27===e.keyCode&&this.restrictDrawing()})),et.Z.has("enableExportButton")?this.enableExportButton=et.Z.getItem("enableExportButton"):this.enableExportButton=!1,this.$forceUpdate(),this.setTableVersion(),this.getAI_IndicatorData(),this.getExtractedColumns(),this.fetchLanguageOptions(),this.confirmationForPoConnectionReset=!1},setTableVersion(){let e=(0,Be.$8)("TBL_EXT_VERSION");this.record.tables&&0!=this.record.tables.length?(this.record.tables[0].hasOwnProperty("version")&&"v3"==this.record.tables[0].version&&(this.tb_version="v3"),this.setPoMatchingData()):void 0!==e&&""!=e&&"Version3"==e&&(this.tb_version="v3")},getAI_IndicatorData(){return Lo(this,void 0,void 0,(function*(){try{let e;if(this.setTableCountForAIIndicator(),!this.record.filter_values||!(this.record.filter_values.length>0)||!Array.isArray(this.record.filter_values))throw"getAI_IndicatorData () no filter_values or doc_type to proceed";let t="?doc_type="+this.record.doc_type+"&filter_values="+this.record.filter_values.join(),i=this.getToken();if(e=yield We().post(ze.hi.get_ai_score+t,new FormData,{headers:{Authorization:i}}),!1===e.data.success)throw e.data.message;if(!0===e.data.success){this.ai_rules=e.data.table_rules;const t=new CustomEvent("TE_gauge_calculation",{detail:e.data});document.dispatchEvent(t)}}catch(e){}}))},setTableCountForAIIndicator(){let e=0;this.record&&this.record.tables&&Array.isArray(this.record.tables)&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("rows")&&Array.isArray(this.record.tables[0].rows)&&this.record.tables[0].rows.length>0&&(e=1),this.ai_tables=e},setPoMatchingData(){let e=this.isPoSettingActivate()&&this.isPoIconAllowed(this.record.doc_type,this.record.status,this.tb_version);const t=new CustomEvent("po_info",{detail:{tb_version:this.tb_version,po_enable:e}});document.dispatchEvent(t)},handleBlockedSupplier(){this.account_block="",!this.record.hasOwnProperty("table_blocked")||1!=this.record.table_blocked&&"true"!=this.record.table_blocked||(this.account_block="table_blocked"),!this.record.hasOwnProperty("table_extraction_disabled")||1!=this.record.table_extraction_disabled&&"true"!=this.record.table_extraction_disabled||(this.account_block="table_extraction_disabled"),!this.record.hasOwnProperty("table_not_supported")||1!=this.record.table_not_supported&&"true"!=this.record.table_not_supported||(this.account_block="table_not_supported")},toggler(){this.toggleMenu(),this.windowResize()},back(){this.record.hasOwnProperty("has_layout")&&"true"===String(this.record.has_layout)?this.$router.push("/field_validation_v1/"+this.$route.params.id):this.$router.push("/2a/"+this.$route.params.id)},imageClicked(e){this.loadNewPageImage(e.target.dataset.id)},loadNewPageImage(e){this.persistTableAreas(),this.image=this.baseUrl+"/"+(0,ao.Rl)(this.record.images[e].path),this.page=parseInt(e)+1,!0===this.isRowMode?setTimeout((()=>{const e=new CustomEvent("get_table_rows_areas",{});document.dispatchEvent(e)}),10):(this.loadNewPageTableAreas(),this.isExtractedColumnMode),this.resizeSelectableColumns(),this.$forceUpdate()},persistTableAreas(){if(et.Z.has("table_data")&&null!=et.Z.getItem("table_data")&&""!=et.Z.getItem("table_data")){let e=et.Z.getItem("table_data");zo=JSON.parse(e),zo&&zo.table_areas&&zo.table_areas.length?Wo.set(this.page.toString(),JSON.stringify(zo)):Wo.delete(this.page.toString())}else Wo.delete(this.page.toString())},loadNewPageTableAreas(){zo=Wo.has(this.page.toString())?JSON.parse(Wo.get(this.page.toString())):{columns:[],table_areas:[]},this.tableAreasStr=JSON.stringify(zo),et.Z.set("table_data",this.tableAreasStr)},prepareTableMap(e){Wo=new Map,e&&Array.from(e).forEach((e=>{if(e){let t={columns:[],table_areas:e.coords};Wo.set(e.page.toString(),JSON.stringify(t))}})),this.loadNewPageTableAreas()},selectAreaToExtratctText(e=!1){this.enableDrawing()},enableDrawing(){this.enableEditing=!0;const e=Po("#draw");null===e||void 0===e||e.classList.add("cursor-crosshair"),null===e||void 0===e||e.classList.remove("pointer-events-none"),this.disableColumnEditing(),this.setTableMode()},restrictDrawing(){this.enableEditing=!1;const e=Po("#draw");null===e||void 0===e||e.classList.add("pointer-events-none"),null===e||void 0===e||e.classList.remove("cursor-crosshair")},windowResize(){this.persistTableAreas();let e=Po("#image_container");this.imageWidth=e.offsetWidth,setTimeout((()=>{$o=Po("#screenshot"),$o&&(this.imageHeight=$o.offsetHeight),this.$forceUpdate(),this.resizeSelectableColumns()}),10)},resizeSelectableColumns(){let e=document.querySelectorAll(".draggable-column");for(var t=0;t<e.length;t++){let i=e[t],o=i.dataset.normalized_value,a=+o*this.imageWidth;this.page==Number(i.dataset.page_no)||"all"==i.dataset.page_no?(i.style.display="block",i.style.left=a.toString()+"px",i.style.height=String(this.imageHeight)+"px"):i.style.display="none"}},addColumnForAll(e){e.stopPropagation();const t=document.querySelectorAll(".draggable-column");if(0!=t.length)for(var i=0;i<t.length;i++){let e=t[i];if(e.dataset.page_no!==this.page.toString()&&"all"!==e.dataset.page_no){e.remove();continue}let o=e.dataset.normalized_value,a=+o*this.imageWidth;e.style.left=a.toString()+"px",e.dataset.page_no="all",e.style.display="block"}else this.showErrorToast("No column detected")},disableColumnEditing(){this.enableColumnEditing=!1,this.draggingColumnEl=null,this.deleteColumnInfo=null,document.removeEventListener("pointermove",this.repositionColumn),document.removeEventListener("pointerup",this.columnStopDrag)},reDrawColumns(e,t){if(!e||e.length<1)return;this.deleteColumnInfo=null,this.persistTableAreas(),this.restrictDrawing(),this.setTableMode();let i=Po("#screenshot_container");$o=Po("#screenshot"),this.imageWidth=$o.offsetWidth,this.imageHeight=$o.offsetHeight,Array.from(e).forEach((e=>{let o=+e*this.imageWidth;var a=document.createElement("div");a.className="draggable-column",a.style.height=String(this.imageHeight)+"px",a.style.left=o.toString()+"px",a.dataset.parent_class="screenshot",a.dataset.page_no=t.toString(),a.dataset.normalized_value=e,i.appendChild(a),a.addEventListener("pointerdown",this.pointerDownDraggableColumn,!1)}))},addColumn(e){this.enableColumnEditing=!0,this.deleteColumnInfo=null,this.persistTableAreas(),this.restrictDrawing(),this.setTableMode(),e.stopPropagation();let t=Po("#screenshot_container");$o=Po("#screenshot"),this.imageWidth=$o.offsetWidth,this.imageHeight=$o.offsetHeight;let i=this.getNewColPosOffset(this.page);var o=document.createElement("div");o.className="draggable-column",o.style.height=String(this.imageHeight)+"px",o.style.left=i.toString()+"px",o.dataset.parent_class="screenshot",o.dataset.page_no=void 0!==e.page?e.page:this.page.toString(),o.dataset.normalized_value=(i/this.imageWidth).toString(),t.appendChild(o),o.addEventListener("pointerdown",this.pointerDownDraggableColumn,!1)},getNewColPosOffset(e){let t=0,i=0;const o=Po("#screenshot"),a=document.querySelectorAll(".draggable-column"),s=o.offsetWidth-o.offsetLeft;if(a.length){let i=null;for(var l=0;l<a.length;l++){let t=a[l];e!=Number(t.dataset.page_no)&&"all"!=t.dataset.page_no||(i=t)}i&&(t=parseInt(i.style.left))}return t+25>s&&(t=0),i=t+25,i},removeDraggableColumn(e){this.draggingColumnEl=null,this.deleteColumnInfo=null,e.target.remove()},pointerDownDraggableColumn(e){if(e.preventDefault(),e.target.clicks++,setTimeout((function(){e.target.clicks=0}),400),2===e.target.clicks)return this.removeDraggableColumn(e),void(e.target.clicks=0);this.columnDragStart(e)},columnDragStart(e){let t=e.target.offsetLeft,i=e.target.offsetTop,o=e.clientX,a=e.clientY;this.draggingColumnEl={el:e.target,initX:t,initY:i,mousePressX:o,mousePressY:a},this.deleteColumnInfo={event:e},document.addEventListener("pointermove",this.repositionColumn,!1),document.addEventListener("pointerup",this.columnStopDrag,!1)},columnStopDrag(e){this.draggingColumnEl=null;let t=Po("#image_container");if(!t)return;let i=t.querySelectorAll(".draggable-column");for(var o=0;o<i.length;o++){i[o].removeEventListener("pointermove",this.repositionColumn,!1);let e=i[o].style.left.replace("px","");i[o].dataset.normalized_value=(+e/this.imageWidth).toString()}},repositionColumn(e){if(!(this.draggingColumnEl&&this.draggingColumnEl.initX&&this.draggingColumnEl.mousePressX))return;let t=this.draggingColumnEl.el.dataset.parent_class,i=Po("#"+t);if(i){this.deleteColumnInfo=null;var o=i.getBoundingClientRect();e.clientX>=o.left?this.draggingColumnEl.el.style.left=this.draggingColumnEl.initX+e.clientX-this.draggingColumnEl.mousePressX+"px":this.draggingColumnEl.el.style.left=Math.floor(5*i.offsetWidth/100)+"px"}},removeAllColumns(){this.deleteColumnInfo=null,this.draggingColumnEl=null;const e=document.querySelectorAll(".draggable-column");if(0!=e.length)for(var t=0;t<e.length;t++)e[t].remove()},isColumnSelectedForDelete(){return!(!this.deleteColumnInfo||0===Object.keys(this.deleteColumnInfo).length||!this.deleteColumnInfo.event)},removeSelectedColumn(e){this.deleteColumnInfo&&0!==Object.keys(this.deleteColumnInfo).length&&this.deleteColumnInfo.event?(this.removeDraggableColumn(this.deleteColumnInfo.event),this.deleteColumnInfo=null):this.deleteColumnInfo=null},getExtractedColumns(){this.extracted_columns=[],this.record&&this.record.tables&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("extraction_info")&&this.record.tables[0].extraction_info.length>0&&Array.from(this.record.tables[0].extraction_info).forEach((e=>{if(e.hasOwnProperty("columns")){let t=[];Array.from(e.columns).forEach((e=>{t=t.concat(e.toString().split(","))})),this.extracted_columns["page_"+e.page]=t}}))},toggleExtractedColumnMode(e){this.isExtractedColumnMode=!0,this.enableColumnEditing=!0,this.showExtractedColumns(e),this.resizeSelectableColumns(),this.isExtractedColumnMode=!1},showExtractedColumns(e){if(this.extracted_columns&&0!==Object.keys(this.extracted_columns).length||!e){this.removeAllColumns();for(let e=0;e<=this.images.length;e++)this.extracted_columns.hasOwnProperty("page_"+e)&&this.reDrawColumns(this.extracted_columns["page_"+e],e.toString())}else this.showErrorToast(this.$t("pages.messages.NO_COLUMNS_FOUND"))},saveTableCoordinates(e=""){return Lo(this,void 0,void 0,(function*(){try{this.showLoading(),this.persistTableAreas(),this.setRulesForSelectableColumns();let t=[];Wo.forEach(((e,i)=>{e&&i&&(zo=JSON.parse(e),t.push(Object.assign({},{page:i,table_areas:zo.table_areas,columns:zo.columns})))}));let i=new FormData;i.append("doc_id",this.record.doc_id),i.append("table_extraction_data",JSON.stringify(t)),i.append("header_rows_count","1");let o,a=this.addMappingFlag();""!==a&&i.append("get_mapping_rules",a.toString()),"add_split_text"===e&&i.append("split_text",this.split_text.toString()),"doc_locale"===e&&i.append("doc_locale",this.languageOrigin),this.record.hasOwnProperty("is_table_training_doc")&&i.append("is_table_training_doc",(!0).toString()),this.force_ocr_table_train&&i.append("force_ocr",(!0).toString()),this.force_ocr_table_train=!1;let s=this.getToken();if(o=yield We().post(ze.hi.get_table_v3,i,{headers:{Authorization:s}}),!o.data||!Array.isArray(o.data)||0==o.data.length)throw{message:this.$t("CANNOT_EXECUTE_REQUEST")};if(!1===o.data[0].success)throw{message:o.data[0].message};this.setApiResponse(o)}catch(t){if(null!=t&&"object"==typeof t&&t.hasOwnProperty("message"))return void this.showErrorToast(t.message);this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}finally{this.hideLoading()}}))},setApiResponse(e){e.data&&e.data[0].hasOwnProperty("locations_list")&&(this.record.tables=e.data,this.setTableCountForAIIndicator(),this.prepareTableMap(this.record.tables[0].locations_list),this.getExtractedColumns(),this.restrictDrawing(),this.disableColumnEditing(),this.setTableMode(),this.resetLineItems())},setRulesForSelectableColumns(){let e=document.querySelectorAll(".draggable-column");if(!e)return;let t=Po("#screenshot");if(!t)return;let i=t.offsetWidth;for(var o=0;o<this.images.length;o++){let t=(o+1).toString(),s=[];for(var a=0;a<e.length;a++){let o=e[a];if(t==o.dataset.page_no||"all"==o.dataset.page_no){let e=o.style.left.replace("px","");s.push(+e/i)}}s.length>0&&(s=this.sortNumbericArray(s),this.addColumnsToTableMap(s,t))}},addColumnsToTableMap(e,t){let i={table_areas:[]};Wo.has(t)&&(i=JSON.parse(Wo.get(t))),i.columns=[e.toString()],Wo.set(t,JSON.stringify(i))},autoDetectTables(){return Lo(this,void 0,void 0,(function*(){this.showLoading();let e,t=new FormData;t.append("doc_id",this.record.doc_id),this.record.hasOwnProperty("is_table_training_doc")&&t.append("is_table_training_doc",(!0).toString());try{let i=this.getToken();e=yield We().post(ze.hi.get_auto_table_v3,t,{headers:{Authorization:i}})}catch(i){return this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR")),void this.hideLoading()}if(!1===e.data.success)return this.showErrorToast(e.data.message),void this.hideLoading();this.setApiResponse(e),this.hideLoading(),this.toggleExtractedColumnMode(!1)}))},handleScroll(){},deleteAllExtractedData(){this.isExtractedColumnMode=!1,this.extracted_columns=[],Wo=new Map,zo={columns:[],table_areas:[]},this.record.tables=null,this.setTableCountForAIIndicator(),this.restrictDrawing(),this.removeAllColumns(),zo={columns:[],table_areas:[]},this.tableAreasStr=JSON.stringify(zo),et.Z.set("table_data",this.tableAreasStr);const e=new CustomEvent("reset_table_areas",{detail:this.record});document.dispatchEvent(e),this.resetLineItems(),this.$forceUpdate()},currentPage(){return this.page},diableAllModes(){this.persistTableAreas(),this.restrictDrawing(),this.setTableMode()},updateExtractionDataForSave(e,t){if(this.record&&this.record.tables&&this.record.tables[0]&&this.record.tables[0].hasOwnProperty("extraction_info"))for(let[i,o]of Object.entries(this.record.tables[0].locations_list))this.record.tables[0].locations_list[i][e]=t},updateTableDataForSave(e){e&&e.detail&&this.record&&this.record.tables&&(this.record.tables=e.detail.tables,this.setTableCountForAIIndicator(),e.detail.save_to_server&&!0===e.detail.save_to_server&&this.debounceAutoSaveFunc())},resetLineItems(){const e=new CustomEvent("init_line_items",{detail:this.record});document.dispatchEvent(e)},viewPurchaseOrder(){et.Z.set("view_mod","edit"),this.$router.push("/po-matching/"+this.$route.params.id)},openLineItemAdvanceSettings(){this.restrictDrawing();const e=new CustomEvent("display_adv_settings_view",{});document.dispatchEvent(e)},addColumnInLineItems(){this.diableAllModes();const e=new CustomEvent("add_new_column",{});document.dispatchEvent(e)},setApiData(e){this.record=e,this.$forceUpdate()},setFieldsData(e){this.record.document_version=e.document_version,this.record.fields=e.fields,this.record.tables=e.tables,this.$forceUpdate()},revertChanges(){const e=new CustomEvent("revert_changes",{});document.dispatchEvent(e)},handleImageBaseURL(){this.record.images[0]&&this.record.images[0].path.match(/doc2/g)&&(this.baseUrl="https://fellowkv2.cloudintegration.eu")},zoomOut(){this.imageWidth>200&&(this.imageWidth=this.imageWidth-100,$o=Po("#screenshot"),setTimeout((()=>{this.imageHeight=$o.offsetHeight,this.resizeSelectableColumns()}),10))},zoomIn(){this.imageWidth=this.imageWidth+100,$o=Po("#screenshot"),setTimeout((()=>{this.imageHeight=$o.offsetHeight,this.resizeSelectableColumns()}),10)},getExtractedDataFromCordinates(e){return Lo(this,void 0,void 0,(function*(){const t=this.record;let i,o=new FormData,a=e.startX/this.imageWidth,s=e.startY/this.imageHeight,l=e.endX/this.imageWidth,r=e.endY/this.imageHeight;o.append("x0",a.toString()),o.append("y0",s.toString()),o.append("x1",l.toString()),o.append("y1",r.toString()),o.append("doc_id",t.doc_id),o.append("page",this.page.toString()),o.append("field_name",""),this.showLoading();try{this.record.hasOwnProperty("is_table_training_doc")&&o.append("is_table_training_doc",(!0).toString());let e=this.getToken();i=yield We().post(ze.hi.get_field_value,o,{headers:{Authorization:e}})}catch(d){return this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR")),void this.hideLoading()}let n=i.data;this.hideLoading(),n&&n.value?this.hideLoading():this.showErrorToast(this.$t("No Data"))}))},addNewLineItem(){const e=new CustomEvent("add_new_row",{});document.dispatchEvent(e)},setTableRowCorrdinates(e,t,i){zo={columns:[],table_areas:[]},this.currentRowId=i,this.currentColumnName=t,zo.table_areas=JSON.parse(e),this.tableAreasStr=JSON.stringify(zo),et.Z.set("table_rows_data",this.tableAreasStr),this.$forceUpdate()},setRowMode(){if(!0===this.isRowMode){this.persistTableAreas(),this.restrictDrawing(),this.disableColumnEditing();const e=new CustomEvent("get_table_rows_areas",{});document.dispatchEvent(e)}else this.setTableMode(!1)},setTableMode(e=!0){!0===e&&(this.isRowMode=!1),this.loadNewPageTableAreas()},saveColumnCoords(e){return Lo(this,void 0,void 0,(function*(){if(!this.currentColumnName||!e)return void this.showErrorToast(this.$t("Please Select Line Column and then try again"));this.showLoading();let t=[];t=e.split(",");let i,o=new FormData;o.append("x0",t[0].toString()),o.append("y0",t[1].toString()),o.append("x1",t[2].toString()),o.append("y1",t[3].toString()),o.append("doc_id",this.record.doc_id),o.append("page",this.page.toString()),o.append("column_name",this.currentColumnName),o.append("table_name",this.record.tables[0].name),this.record.hasOwnProperty("is_table_training_doc")&&o.append("is_table_training_doc",(!0).toString());try{let e=this.getToken();i=yield We().post(ze.hi.get_table_text,o,{headers:{Authorization:e}})}catch(l){return this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR")),void this.hideLoading()}const a=i.data.coords;if(!a||0===a[0].x&&0===a[0].y&&""===i.data.formatted_value)return this.showErrorToast(this.$t("pages.messages.EMPTY_MAPPING_NOT_ALLOWED")),void this.hideLoading();this.updateApiForTableColumn(i.data);const s=new CustomEvent("init_line_items",{detail:this.record});document.dispatchEvent(s),setTimeout((()=>{let e=Po("#input_"+this.currentColumnName+"_"+this.currentRowId);e&&(e.scrollIntoView(),e.querySelector("label").classList.add("active-border-2px"))}),30),this.$forceUpdate(),this.hideLoading()}))},updateApiForTableColumn(e){Array.from(this.record.tables[0].rows).forEach(((t,i)=>{t.id===this.currentRowId&&Array.from(t.columns).forEach(((t,o)=>{if(t.name===this.currentColumnName){let a="";a=e.location[0].coords.toString();let s={name:t.name,content:e.text,locations:e.location,locations_list:[{page:this.page,coords:[a]}],is_validated:!1,value:e.value,formatted_value:e.formatted_value,extraction_method:"AI"};return this.record.tables[0].rows[i].columns[o]=[],void(this.record.tables[0].rows[i].columns[o]=JSON.parse(JSON.stringify(s)))}}))})),this.$forceUpdate()},deleteColumnDataForReSelection(){Array.from(this.record.tables[0].rows).forEach(((e,t)=>{e.id===this.currentRowId&&Array.from(e.columns).forEach(((e,t)=>{if(e.name===this.currentColumnName)return e.locations=[],e.locations_list=[],e.formatted_value="",e.value="",void(e.content="")}))}));const e=new CustomEvent("reload_line_items",{detail:{apiData:this.record,currentRowId:this.currentRowId,currentColumnName:this.currentColumnName}});document.dispatchEvent(e)},validateSelectedColumn(){Array.from(this.record.tables[0].rows).forEach(((e,t)=>{e.id===this.currentRowId&&Array.from(e.columns).forEach(((e,t)=>{e.name!==this.currentColumnName||(e.is_validated=!0)}))}))},saveDataForV3(e=!1){return Lo(this,void 0,void 0,(function*(){const t=yield this.hasActionAcquiredLock();if(!t)return;let i=this.record;this.showLoading(),i.hasOwnProperty("table_data_copy")&&delete i["table_data_copy"];let o,a=new FormData;a.append("data",JSON.stringify(i));try{if(o=yield We().post(ze.hi.save_table_train_data+this.record.doc_id,a,{headers:{Authorization:"Bearer "+this.token}}),!1===o.data.success)throw{message:o.data.message};e&&this.autoDetectTables()}catch(s){if(null!=s&&"object"==typeof s&&s.hasOwnProperty("message"))return void this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"));this.showErrorToast(s)}finally{this.hideLoading()}}))},addMappingFlag(){let e="";return!this.$route.query||"true"!==this.$route.query.get_mapping_rules&&"false"!==this.$route.query.get_mapping_rules||(e=this.$route.query.get_mapping_rules),e},rulesDeleted(){this.ai_rules=0;const e=new CustomEvent("TE_gauge_calculation",{detail:{min_table_effective_weight:0}});document.dispatchEvent(e)},callSplitTextAction(e){this.performSplitText(e)},performSplitText(e){return Lo(this,void 0,void 0,(function*(){e&&this.record&&this.record.tables&&(this.split_text=!0===e.detail,this.prepareTableMap(this.record.tables[0].locations_list),this.addExtractedColumns(),yield this.saveTableCoordinates("add_split_text"))}))},addExtractedColumns(){if(this.extracted_columns&&0!==Object.keys(this.extracted_columns).length)for(let[e,t]of Object.entries(this.extracted_columns))t=this.sortNumbericArray(t),e=e.substring(5),this.addColumnsToTableMap(t,e)},saveDataOnChanges(){if(!0!==this.table_train){if(!this.isReadOnly){const e=new CustomEvent("save_data",{});document.dispatchEvent(e)}}else this.saveDataForV3()},disabledCustomColumnsDialog(){const e=new CustomEvent("open_disabled_custom_columns_view",{});document.dispatchEvent(e)},isDebugFlagHandler(){this.is_debug=!1,this.$route.query&&"true"===this.$route.query.is_debug&&(this.is_debug=!0)},viewOCRDocument(){let e=this.$router.resolve({path:"/ocr-document/"+this.docId+"/"+this.page});window.open(e.href,"_blank","location=yes,toolbar=yes,scrollbars=yes,resizable=yes,left=500,width=1500,height=1000")},changeOrigin(){this.saveTableCoordinates("doc_locale"),this.changeOriginConfirmDialog=!1},fetchLanguageOptions(){return Lo(this,void 0,void 0,(function*(){let e;try{let t=this.getToken();e=yield We().get(ze.hi.get_items_from_dictionary+"DOC_ORIGIN",{headers:{Authorization:t}})}catch(t){return void this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}if(e.data&&0!==Object.keys(e.data).length){this.language_origin_list=[];for(const t in e.data){let i=e.data[t],o=i.description?i.description:"";this.language_origin_list.push(Object.assign({},{value:i.value,label:i.label,description:o.replaceAll("\\n","<br />")}))}(0,Ve.w4)("language_origin_list",this.language_origin_list),this.setLanguage()}}))},setLanguage(){this.force_ocr_table_train=!1;const e=this.record.doc_origin;e&&(this.languageOrigin=e)},isOcrButtonEnabled(){let e=!0;if(this.record.time_logs){const t=this.record.time_logs.ocr,i=this.record.time_logs.ocr_document;(i||t)&&(e=!1)}return e}},beforeRouteLeave:function(e,t,i){this.removeAllNotifications(),this.releaseDocLock({doc_id:this.record.doc_id}),this.page=1,this.resetDocStore(e.fullPath),i()},setup(){const e=(0,li.H_)(),{record:t,notifications:i,error:o,confirmationForPoConnectionReset:a,get_cached_data_id:s,extractable:l,has_ai_table:r,is_manual_training_allowed:n}=(0,Pe.Jk)(e),{getDocumentById:d,setRecordFromCache:c,setDataToCache:h,removeCache:u,resetDocStore:m,setManualTraining:g}=e,_=(0,li.TB)(),{releaseDocLock:p,hasActionAcquiredLock:w,setDocLockStoreDisable:f}=_,{doc_lock:b}=(0,Pe.Jk)(_),v=(0,li.wX)(),{token:y}=(0,Pe.Jk)(v),{setAuthToken:C}=v;let x=[];return{is_manual_training_allowed:n,setManualTraining:g,has_ai_table:r,confirmationForPoConnectionReset:a,doc_fetch_error:(0,Me.iH)(o),notifications:i,record:t,get_cached_data_id:s,extractable:l,setDocLockStoreDisable:f,hasActionAcquiredLock:w,setRecordFromCache:c,getDocumentById:d,releaseDocLock:p,setDataToCache:h,resetDocStore:m,setAuthToken:C,removeCache:u,token:y,doc_lock:b,docId:(0,Me.iH)(""),page:(0,Me.iH)(1),image:(0,Me.iH)(""),images:(0,Me.iH)(x),doc2AppMode:!1,splitterModel:(0,Me.iH)(60),tableAreasStr:(0,Me.iH)(""),isReadOnly:(0,Me.iH)(!1),isRowMode:(0,Me.iH)(!1),baseUrl:"https://api.docbits.com",table_train:(0,Me.iH)(!1),tb_version:"default",training_mode:(0,Me.iH)(!1),ai_rules:(0,Me.iH)(0),ai_tables:(0,Me.iH)(0),extracted_columns:(0,Me.iH)({}),isExtractedColumnMode:(0,Me.iH)(!1),openCodeEditor:(0,Me.iH)(!1),split_text:(0,Me.iH)(!1),is_debug:(0,Me.iH)(!1),changeOriginConfirmDialog:(0,Me.iH)(!1),language_origin_list:x,languageOrigin:(0,Me.iH)(""),force_ocr_table_train:(0,Me.iH)(!1),trigger_document_lock:(0,Me.iH)(!1),document_version:(0,Me.iH)(0),api_tries:(0,Me.iH)(0),error_message:(0,Me.iH)(""),error_class:(0,Me.iH)("error-banner"),ai_table_warning:(0,Me.iH)(!1)}}});var No=i(80218),Mo=i(28886),Ho=i(62025);const Uo=(0,yi.Z)(qo,[["render",Re],["__scopeId","data-v-6ce54586"]]),Fo=Uo;eo()(qo,"components",{QBtn:zi.Z,QIcon:Li.Z,QSplitter:No.Z,QTooltip:Di.Z,QToggle:Mo.Z,QSelect:ji.Z,QItem:Ai.Z,QItemSection:Ti.Z,QItemLabel:Ri.Z,QDialog:Ni.Z,QCard:Mi.Z,QCardSection:Fi.Z,QAvatar:Xi.Z,QCardActions:Bi.Z,QSpace:Ho.Z}),eo()(qo,"directives",{ClosePopup:Ki.Z})}}]);