"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[2323],{22323:(e,t,o)=>{o.r(t),o.d(t,{default:()=>bt});var i=o(61758),s=o(58790);const a=e=>((0,i.Qi)("data-v-95a50820"),e=e(),(0,i.jt)(),e),l={class:"row q-pb-md"},n={class:"col-12 q-pl-sm q-mt-sm"},r={key:0,class:"row"},d={key:1,class:"full-width"},u={class:"row"},c={class:"po-nav-width q-pr-md row"},_={class:"q-mr-auto q-mt-sm"},m={style:{"vertical-align":"middle","margin-left":"10px","font-size":"20px",cursor:"pointer"}},h={class:"q-ml-auto q-mt-sm"},p={class:"h-m-r-10",id:"po-container-parrent",style:{"border-right":"1px solid #9f9d9d"}},g={class:"row ml-10 po-page-height scrolle-y"},f={class:"col-sm-12"},b={class:"full-width scrolle-y"},y={key:0,class:"row q-mt-md q-mb-md input-text-28px"},v={class:"row"},k={class:"col-sm-12 col-md-12 col-lg-12"},w={class:"col-sm-12 col-md-12 col-lg-12"},L={class:"full-width q-pt-md"},C={style:{"margin-left":"-13px",top:"10px"}},A={style:{"margin-left":"-5.5px",top:"40%"}},I={class:""},O={class:"po-right-container q-pr-md q-mt-sm",id:"po-image-container"},F=a((()=>(0,i.Lk)("img",{class:"loading-image",src:"images/loader.gif",alt:"Loading..."},null,-1)));function x(e,t,o,a,x,E){const D=(0,i.g2)("DocumentLock"),R=(0,i.g2)("MessageBanner"),S=(0,i.g2)("SubHeader"),T=(0,i.g2)("ErrorDocumentView"),P=(0,i.g2)("q-icon"),V=(0,i.g2)("q-btn"),q=(0,i.g2)("TaskBtn"),N=(0,i.g2)("CreateTaskBtn"),Q=(0,i.g2)("exportBtns"),U=(0,i.g2)("q-input"),K=(0,i.g2)("q-separator"),j=(0,i.g2)("LineItems"),W=(0,i.g2)("ImageComponent"),X=(0,i.g2)("q-splitter"),z=(0,i.g2)("q-inner-loading");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.bF)(D,{document_version:e.document_version,trigger_document_lock:e.trigger_document_lock,doc_id:e.docId},null,8,["document_version","trigger_document_lock","doc_id"]),e.is_view_readonly?((0,i.uX)(),(0,i.Wv)(R,{key:0,message:e.error_message,messageCategoryClass:"error-banner"},null,8,["message"])):(0,i.Q3)("",!0),(0,i.bF)(S,{name:"quote_details",label:e.$t("quote_details"),show_expiry_alert:!0,onSearch:!1},null,8,["label"]),(0,i.Lk)("div",l,[(0,i.Lk)("div",n,[e.doc_fetch_error?((0,i.uX)(),(0,i.CE)("div",r,[(0,i.bF)(T)])):((0,i.uX)(),(0,i.CE)("div",d,[(0,i.bF)(X,{limits:[30,100],modelValue:e.imageFieldSplitter,"onUpdate:modelValue":[t[2]||(t[2]=t=>e.imageFieldSplitter=t),t[3]||(t[3]=t=>e.splitterChanged())],class:"po-left-container"},{before:(0,i.k6)((()=>[(0,i.Lk)("div",u,[(0,i.Lk)("div",c,[(0,i.Lk)("div",_,[(0,i.bF)(V,{flat:"",rounded:"",color:"primary",onClick:t[0]||(t[0]=t=>e.routeToBack())},{default:(0,i.k6)((()=>[(0,i.bF)(P,{name:"fa-solid fa-circle-arrow-left",size:"sm"}),(0,i.Lk)("label",m,(0,s.v_)(e.$t("back")),1)])),_:1})]),(0,i.Lk)("div",h,[e.is_view_readonly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.bF)(q,{is_f_btn:!0}),(0,i.bF)(N,{is_icon_button:!0})],64)),e.is_view_readonly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(Q,{key:1}))])])]),(0,i.Lk)("div",p,[(0,i.Lk)("div",g,[(0,i.Lk)("div",f,[(0,i.Lk)("div",b,[e.documentFieldsConfig&&e.documentFieldsConfig.length>0?((0,i.uX)(),(0,i.CE)("div",y,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.documentFieldsConfig,((t,o)=>((0,i.uX)(),(0,i.CE)("div",{key:o,class:"col-sm-4 col-md-4 col-lg-4 q-pa-sm"},[(0,i.Lk)("div",v,[(0,i.Lk)("div",k,(0,s.v_)(e.getFieldLabelFromAllPrefixes(t)),1),(0,i.Lk)("div",w,[(0,i.bF)(U,{outlined:"",dense:"",modelValue:e.documentFields[t.field_name].formatted_value,"onUpdate:modelValue":o=>e.documentFields[t.field_name].formatted_value=o,disable:!0},null,8,["modelValue","onUpdate:modelValue"])])])])))),128))])):(0,i.Q3)("",!0),(0,i.bF)(K),(0,i.Lk)("div",L,[(0,i.bF)(j,{ref:"lineItemsPoV3",isReadOnly:e.is_view_readonly,defaultValues:e.defalutAttributes},null,8,["isReadOnly","defaultValues"])])])])])])])),separator:(0,i.k6)((()=>[(0,i.Lk)("div",C,[(0,i.bF)(V,{round:"",unelevated:"",size:"xs",icon:e.imageFieldSplitter>=90?"chevron_left":"chevron_right",class:"panel-expand-button highlighted-back shadow-2",onClick:t[1]||(t[1]=t=>e.toggleImageArea())},null,8,["icon"])]),(0,i.Lk)("div",A,[(0,i.bF)(P,{name:"drag_handle",size:"md",class:"icon-grey rotate-90"})])])),after:(0,i.k6)((()=>[(0,i.Lk)("div",I,[(0,i.Lk)("div",O,[(0,i.bF)(W,{renderOpenWindoIcon:!0,dynamicWidth:e.dynamicWidth,docName:e.record.filename,docImages:e.record.images},null,8,["dynamicWidth","docName","docImages"])])])])),_:1},8,["modelValue"])]))])]),(0,i.bF)(z,{class:"main-loader",showing:e.processing,style:{"z-index":"2"}},{default:(0,i.k6)((()=>[F])),_:1},8,["showing"])],64)}var E=o(1659),D=o(24622),R=o(60521),S=o(45938),T=o(38734),P=o(46162),V=o(76956),q=o(92162),N=o(94124),Q=o(51476),U=o(11470),K=o(48520),j=o(21984),W=o(25891),X=o(84857),z=o(18859),$=o(29104);const M=e=>((0,i.Qi)("data-v-b9720cd4"),e=e(),(0,i.jt)(),e),B={key:0,class:"full-width q-pa-sm back-white"},J=M((()=>(0,i.Lk)("img",{width:"20",src:"images/user_define_line.svg"},null,-1))),H=M((()=>(0,i.Lk)("img",{width:"20",src:"images/extracted_line.svg"},null,-1))),G={key:0},Y={key:1},Z={class:"row back-white q-mt-md"},ee={class:"col-sm-12 col-md-12 col-lg-12"},te={class:"col-sm-12 col-md-12 col-lg-12"},oe={class:"row items-center justify-end"},ie={key:0},se=["onClick"],ae={key:0,class:"col-sm-12 col-md-12 col-lg-12 q-pt-md"},le={class:"row float-right"},ne={class:"export-label"};function re(e,t,o,a,l,n){const r=(0,i.g2)("f-btn"),d=(0,i.g2)("q-tooltip"),u=(0,i.g2)("q-icon"),c=(0,i.g2)("q-th"),_=(0,i.g2)("q-tr"),m=(0,i.g2)("q-btn"),h=(0,i.g2)("q-td"),p=(0,i.g2)("q-table"),g=(0,i.g2)("q-spinner"),f=(0,i.g2)("q-markup-table"),b=(0,i.g2)("q-separator"),y=(0,i.g2)("q-date"),v=(0,i.g2)("q-popup-proxy"),k=(0,i.g2)("SelectAsDefault"),w=(0,i.g2)("q-input"),L=(0,i.g2)("q-select"),C=(0,i.g2)("q-spinner-ios"),A=(0,i.g2)("q-avatar"),I=(0,i.g2)("q-item-label"),O=(0,i.g2)("q-item-section"),F=(0,i.g2)("q-item"),x=(0,i.g2)("q-list"),E=(0,i.g2)("q-btn-dropdown"),D=(0,i.g2)("masterDataLookup"),R=(0,i.g2)("dialog-draggable"),S=(0,i.g2)("Loader"),T=(0,i.gN)("close-popup");return(0,i.uX)(),(0,i.CE)(i.FK,null,[e.hasLineItems()?((0,i.uX)(),(0,i.CE)("div",B,[e.isReadOnly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(r,{key:0,label:e.$t("add_line_row"),onClick:t[0]||(t[0]=t=>e.addLineRow()),class:"q-ma-xs float-right"},null,8,["label"]))])):(0,i.Q3)("",!0),((0,i.uX)(),(0,i.CE)("div",{class:"full-width q-pa-sm back-white",key:e.renderKey},[e.hasLineItems()?((0,i.uX)(),(0,i.Wv)(p,{key:0,rows:e.tableRows,columns:e.tableColumns,flat:"","row-key":"id","no-data-label":e.$t("pages.messages.no_record_found"),"rows-per-page-options":[0],id:"line_item_table",ref:"el",class:"text-uppercase sticky-header transparent-header table_height resizable",style:{"table-layout":"fixed !important",width:"100%"}},{header:(0,i.k6)((t=>[(0,i.bF)(_,{props:t},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(t.cols,((o,a)=>((0,i.uX)(),(0,i.Wv)(c,{key:o.name,props:t,class:"table-column-header",draggable:e.allowedColumnSorting(o),dropzone:e.allowedColumnSorting(o),"data-index":a,direction:"horizontal",onDragstart:t=>e.onDragStart(t,e.tableColumns,a),onDrop:(0,$.D$)((t=>e.handleDrop(t,a)),["prevent"]),onDragover:(0,$.D$)((t=>e.onDragOverWrapper(t,a,o.name)),["prevent"]),onDragenter:(0,$.D$)(e.onDragEnter,["prevent"]),onDragleave:(0,$.D$)(e.onDragLeave,["prevent"]),style:(0,s.Tr)({cursor:e.getIsDragging&&e.allowedColumnSorting(o)?"pointer":"move"})},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(o.label)+" ",1),o.error?((0,i.uX)(),(0,i.Wv)(u,{key:0,title:e.$t("pages.screen2b.in_valid_column_error"),name:"priority_high",class:"headerError"},{default:(0,i.k6)((()=>[(0,i.bF)(d,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("pages.screen2b.in_valid_column_error")),1)])),_:1})])),_:1},8,["title"])):(0,i.Q3)("",!0)])),_:2},1032,["props","draggable","dropzone","data-index","onDragstart","onDrop","onDragover","onDragenter","onDragleave","style"])))),128))])),_:2},1032,["props"])])),body:(0,i.k6)((t=>[(0,i.bF)(_,{props:t,"data-id":t.key,class:(0,s.C4)(["cursor-pointer",t.rowIndex%2==0?"":"alternative-row"]),onClick:o=>e.onRowClick(t.row,t.rowIndex)},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(t.cols,(o=>((0,i.uX)(),(0,i.Wv)(h,{key:o.name,"data-id":t.key},{default:(0,i.k6)((()=>[""===o.label?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[e.record.tables[0].rows[t.rowIndex].is_user_defined?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.bF)(u,{size:"sm",tabindex:"0",class:"cursor-pointer"},{default:(0,i.k6)((()=>[J,(0,i.bF)(d,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("custom_line")),1)])),_:1})])),_:1}),(0,i.bF)(m,{flat:"",tabindex:"0",color:"blue",icon:"fa fa-times",onClick:o=>{o.preventDefault(),e.removeLineItem(t.row.id,t.rowIndex)}},null,8,["onClick"])],64)):((0,i.uX)(),(0,i.Wv)(u,{key:1,size:"sm",tabindex:"0",class:"cursor-pointer"},{default:(0,i.k6)((()=>[H,(0,i.bF)(d,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("extracted_line")),1)])),_:1})])),_:1}))],64)):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.eW)((0,s.v_)(o.value),1)],64))])),_:2},1032,["data-id"])))),128))])),_:2},1032,["props","data-id","class","onClick"])])),_:1},8,["rows","columns","no-data-label"])):((0,i.uX)(),(0,i.Wv)(f,{key:1,style:{height:"'200px'"},class:"full-width"},{default:(0,i.k6)((()=>[(0,i.Lk)("thead",null,[!1===e.lineItemsloading?((0,i.uX)(),(0,i.CE)("tr",G,[(0,i.Lk)("th",null,(0,s.v_)(e.$t("no_line_items_found")),1)])):(0,i.Q3)("",!0),!0===e.lineItemsloading?((0,i.uX)(),(0,i.CE)("tr",Y,[(0,i.Lk)("th",null,[(0,i.bF)(g,{color:"primary",size:"3em",thickness:10})])])):(0,i.Q3)("",!0)])])),_:1}))])),e.selectedRow&&Object.entries(e.selectedRow).length>0?((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.bF)(b,{class:"q-mt-md"}),(0,i.Lk)("div",Z,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.tableColumns,((t,o)=>((0,i.uX)(),(0,i.CE)(i.FK,{key:o},["status"!=t.name&&e.lineItemLayout[t.name]?((0,i.uX)(),(0,i.CE)("div",{key:0,class:(0,s.C4)(["col-sm-"+e.getColSpan(t.name),"q-pa-sm"])},[(0,i.Lk)("div",{class:(0,s.C4)(["row",e.getType(t.name)?"":" input-text-28px"])},[(0,i.Lk)("div",ee,[(0,i.eW)((0,s.v_)(t.label)+" ",1),e.getUiPreference(t.name,"UI_DEFAULT_VALUE")?((0,i.uX)(),(0,i.Wv)(u,{key:0,name:"info",color:"primary"},{default:(0,i.k6)((()=>[(0,i.bF)(d,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("field_has_default_value")),1)])),_:1})])),_:1})):(0,i.Q3)("",!0)]),(0,i.Lk)("div",te,["DATE"==e.lineItemLayout[t.name].column_type?((0,i.uX)(),(0,i.Wv)(w,{key:0,outlined:"",dense:"",modelValue:e.selectedRow[t.name],"onUpdate:modelValue":[o=>e.selectedRow[t.name]=o,o=>{e.changeEvent(t.name,o)}],mask:"date",disable:e.isReadOnly||e.lineItemLayout[t.name].is_readonly,class:"p-b-0"},{append:(0,i.k6)((()=>[e.fieldErros[t.name]?((0,i.uX)(),(0,i.Wv)(u,{key:0,flat:"",dense:"",name:"error",size:"22px",color:"red"},{default:(0,i.k6)((()=>[(0,i.bF)(d,{class:"bg-red",anchor:"bottom left",self:"top left"},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.fieldErros[t.name]),1)])),_:2},1024)])),_:2},1024)):(0,i.Q3)("",!0),(0,i.bF)(u,{name:"event",class:"cursor-pointer"},{default:(0,i.k6)((()=>[(0,i.bF)(v,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,i.k6)((()=>[(0,i.bF)(y,{modelValue:e.selectedRow[t.name],"onUpdate:modelValue":o=>e.selectedRow[t.name]=o,mask:"YYYY-MM-DD"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",oe,[(0,i.bo)((0,i.bF)(m,{label:"Close",color:"primary",flat:""},null,512),[[T]])])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)])),default:(0,i.k6)((()=>[(0,i.bF)(k,{columnName:t.name,attributeValue:e.selectedRow[t.name],tableKey:e.record.tables[0].name,doctype:e.doctype},null,8,["columnName","attributeValue","tableKey","doctype"])])),_:2},1032,["modelValue","onUpdate:modelValue","disable"])):e.lovFields.hasOwnProperty(t.name)?((0,i.uX)(),(0,i.Wv)(L,{key:1,outlined:"",dense:"","emit-value":"","map-options":"",modelValue:e.selectedRow[t.name],"onUpdate:modelValue":[o=>e.selectedRow[t.name]=o,o=>{e.dropDownChange(t.name,o)}],options:e.lovFieldsList[e.getKey(t.name)],disable:e.isReadOnly||e.lineItemLayout[t.name].is_readonly},{append:(0,i.k6)((()=>[e.fieldErros[t.name]?((0,i.uX)(),(0,i.Wv)(u,{key:0,flat:"",dense:"",name:"error",size:"22px",color:"red"},{default:(0,i.k6)((()=>[(0,i.bF)(d,{class:"bg-red",anchor:"bottom left",self:"top left"},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.fieldErros[t.name]),1)])),_:2},1024)])),_:2},1024)):(0,i.Q3)("",!0)])),default:(0,i.k6)((()=>[(0,i.bF)(k,{columnName:t.name,attributeValue:e.selectedRow[t.name],tableKey:e.record.tables[0].name,doctype:e.doctype},null,8,["columnName","attributeValue","tableKey","doctype"])])),_:2},1032,["modelValue","onUpdate:modelValue","options","disable"])):((0,i.uX)(),(0,i.Wv)(w,{key:2,outlined:"",dense:"",modelValue:e.selectedRow[t.name],"onUpdate:modelValue":[o=>e.selectedRow[t.name]=o,o=>{e.changeEvent(t.name,o)}],maxlength:e.getFieldLength(t.name),counter:!!e.getFieldLength(t.name),type:e.getType(t.name)?"textarea":"input",disable:e.isReadOnly||e.lineItemLayout[t.name].is_readonly},{append:(0,i.k6)((()=>[e.lookup_loading_fields.hasOwnProperty(t.name)?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[e.lookup_loading_fields[t.name].lookup_loading?((0,i.uX)(),(0,i.CE)("div",ie,[(0,i.bF)(C,{color:"primary",size:"0.86em"})])):(0,i.Q3)("",!0),1==e.lookup_loading_fields[t.name].lookup_found?((0,i.uX)(),(0,i.Wv)(u,{key:1,flat:"",dense:"",name:"check_circle",size:"22px",class:"cursor-pointer text-light-green-8",tabindex:"0"},{default:(0,i.k6)((()=>[(0,i.bF)(d,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("lookup_record_found")),1)])),_:1})])),_:1})):(0,i.Q3)("",!0),0==e.lookup_loading_fields[t.name].lookup_found?((0,i.uX)(),(0,i.Wv)(u,{key:2,flat:"",dense:"",name:"warning",size:"22px",class:"cursor-pointer text-orange",tabindex:"0"},{default:(0,i.k6)((()=>[(0,i.bF)(d,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.interpolate(t.name,e.$t("no_lookup_record_found_for_list"))),1)])),_:2},1024)])),_:2},1024)):(0,i.Q3)("",!0)],64)):(0,i.Q3)("",!0),e.lookup_configurations.has(t.name)?((0,i.uX)(),(0,i.Wv)(A,{key:1,class:"cursor-pointer fuzzy-field",size:"18px"},{default:(0,i.k6)((()=>[(0,i.Lk)("img",{src:"images/fuzzy-search.svg",onClick:o=>{o.stopPropagation(),o.preventDefault(),e.masterDataSearchByField(e.selectedRow.id,e.lineDataObj[e.selectedRow.id]["columns"][t.name])}},null,8,se)])),_:2},1024)):(0,i.Q3)("",!0),e.fieldErros[t.name]?((0,i.uX)(),(0,i.Wv)(u,{key:2,flat:"",dense:"",name:"error",size:"22px",color:"red"},{default:(0,i.k6)((()=>[(0,i.bF)(d,{class:"bg-red",anchor:"bottom left",self:"top left"},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.fieldErros[t.name]),1)])),_:2},1024)])),_:2},1024)):(0,i.Q3)("",!0)])),default:(0,i.k6)((()=>[(0,i.bF)(k,{columnName:t.name,attributeValue:e.selectedRow[t.name],tableKey:e.record.tables[0].name,doctype:e.doctype},null,8,["columnName","attributeValue","tableKey","doctype"])])),_:2},1032,["modelValue","onUpdate:modelValue","maxlength","counter","type","disable"]))])],2)],2)):(0,i.Q3)("",!0)],64)))),128)),e.isReadOnly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",ae,[(0,i.Lk)("div",le,[e.isReadOnly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(r,{key:0,label:e.$t("cancel"),onClick:t[1]||(t[1]=t=>e.selectedRow={}),appearance:"cancel",class:"q-ma-xs"},null,8,["label"])),e.isReadOnly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(r,{key:1,label:e.$t("save"),onClick:t[2]||(t[2]=t=>e.saveChanges(!0,!0,!0)),class:"q-ma-xs"},null,8,["label"])),e.tableRows.length==e.selectedIndex+1||e.isReadOnly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(E,{key:2,split:"",unelevated:"",color:"primary",class:"export-btn q-ma-xs","no-caps":"",onClick:t[4]||(t[4]=t=>e.saveAndNext())},{label:(0,i.k6)((()=>[(0,i.Lk)("span",ne,(0,s.v_)(e.$t("save_and_next")),1)])),default:(0,i.k6)((()=>[(0,i.bF)(x,{class:"text-center"},{default:(0,i.k6)((()=>[(0,i.bo)(((0,i.uX)(),(0,i.Wv)(F,{id:"export_po_btn",clickable:"",onClick:t[3]||(t[3]=t=>e.saveAndNextCopyDefaults()),class:"border-bottom-bdbdbd min-height-38"},{default:(0,i.k6)((()=>[(0,i.bF)(O,null,{default:(0,i.k6)((()=>[(0,i.bF)(I,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("save_and_next_copy_defaults")),1)])),_:1})])),_:1})])),_:1})),[[T]])])),_:1})])),_:1}))])]))])],64)):(0,i.Q3)("",!0),(0,i.bF)(R,{modelValue:e.fuzzyDialog,"onUpdate:modelValue":t[5]||(t[5]=t=>e.fuzzyDialog=t),seamless:"","full-width":"",position:"left",persistent:"",onKeydown:(0,$.jR)(e.closeMsDialog,["esc"]),title:e.$t("pages.screen2a.validation"),onOnHide:e.closeMsDialog,isResizeAble:!0,draggable:e.isDraggle},{default:(0,i.k6)((()=>[(0,i.bF)(D)])),_:1},8,["modelValue","onKeydown","title","onOnHide","draggable"]),(0,i.bF)(S)],64)}var de=o(53500),ue=o(85192),ce=o(46736),_e=o(96056),me=o(8420),he=o(91298),pe=o(18505),ge=o(57366),fe=o(86633),be=o(10739),ye=o(68450),ve=o(36801),ke=o(82080);function we(e,t,o,a,l,n){const r=(0,i.g2)("q-item-section"),d=(0,i.g2)("q-item"),u=(0,i.g2)("q-separator"),c=(0,i.g2)("q-list"),_=(0,i.g2)("q-menu"),m=(0,i.gN)("close-popup");return(0,i.uX)(),(0,i.Wv)(_,{"touch-position":"","context-menu":""},{default:(0,i.k6)((()=>[(0,i.bF)(c,{dense:"",style:{"min-width":"100px"}},{default:(0,i.k6)((()=>[(0,i.bo)(((0,i.uX)(),(0,i.Wv)(d,{clickable:"",onClick:t[0]||(t[0]=t=>e.setValueAsDefault())},{default:(0,i.k6)((()=>[(0,i.bF)(r,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("set_as_default")),1)])),_:1})])),_:1})),[[m]]),(0,i.bF)(u),(0,i.bo)(((0,i.uX)(),(0,i.Wv)(d,{clickable:""},{default:(0,i.k6)((()=>[(0,i.bF)(r,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("close")),1)])),_:1})])),_:1})),[[m]])])),_:1})])),_:1})}var Le=function(e,t,o,i){function s(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function l(e){try{r(i.next(e))}catch(t){a(t)}}function n(e){try{r(i["throw"](e))}catch(t){a(t)}}function r(e){e.done?o(e.value):s(e.value).then(l,n)}r((i=i.apply(e,t||[])).next())}))};const Ce=(0,i.pM)({name:"select-as-default",mixins:[D.A],props:{tableKey:{type:String,default:""},columnName:{type:String,default:""},attributeValue:{type:String,default:""},doctype:{type:String,default:""}},methods:{setValueAsDefault(){return Le(this,void 0,void 0,(function*(){if(this.attributeValue)try{const e=new FormData;e.append("doc_type",this.doctype),e.append("table_key",this.tableKey),e.append("column_name",this.columnName),e.append("attribute_name","UI_DEFAULT_VALUE"),e.append("attribute_value",this.attributeValue),e.append("is_organization_default","true"),yield U.M8.setTableAdditionalAttribute(e)}catch(e){if(null!=e&&"object"==typeof e&&e.hasOwnProperty("message"))return void this.showErrorToast(e.message);this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}}))}}});var Ae=o(12807),Ie=o(84436),Oe=o(53999),Fe=o(90124),xe=o(25173),Ee=o(10386),De=o(88672),Re=o(98582),Se=o.n(Re);const Te=(0,Ae.A)(Ce,[["render",we]]),Pe=Te;Se()(Ce,"components",{QMenu:Ie.A,QList:Oe.A,QItem:Fe.A,QItemSection:xe.A,QSeparator:Ee.A}),Se()(Ce,"directives",{ClosePopup:De.A});var Ve=o(75224),qe=o(44723),Ne=function(e,t,o,i){function s(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function l(e){try{r(i.next(e))}catch(t){a(t)}}function n(e){try{r(i["throw"](e))}catch(t){a(t)}}function r(e){e.done?o(e.value):s(e.value).then(l,n)}r((i=i.apply(e,t||[])).next())}))};let Qe=new Map;const Ue=(0,i.pM)({el:"#app",mixins:[fe.A,pe.A,_e.A,D.A,ke.A,ge.A,W.A,ce.A,be.A],components:{Loader:me.A,masterDataLookup:qe.A,dialogDraggable:Ve.A,SelectAsDefault:Pe},watch:{populate_row_to_view:{handler:function(e,t){0!=e&&this.populateMSDataFromPopup()}}},updated(){let e=this.user_settings.LINE_ITEM_TABLE_SETTING,t=200;e&&(e=JSON.parse(e),t=e.height);const o=document.getElementById("line_item_table");o&&(t<200&&(t=200),o.style.height=t+"px")},props:{isReadOnly:{type:Boolean,default:!1},defaultValues:{type:Object,default:{}}},data(){return{docId:"",renderKey:0,validation_done:!0,dropdownColumns:[],lovFields:(0,T.KR)({}),AI_table_extraction_setting:V.N1,line_table_columns:V.iS,triggerSave:(0,T.KR)(!1)}},mounted:function(){document.addEventListener("init_line_items",this.lineItemDataLoaded),document.addEventListener("line_item_table-column-drop",this.savedSortedColumns),this.init(),this.initailizeDragColumnsById("line_item_table"),window.vlqd=this},unmounted:function(){document.removeEventListener("init_line_items",this.lineItemDataLoaded),document.removeEventListener("line_item_table-column-drop",this.savedSortedColumns)},methods:{init(){this.checkAITableSetting()},onDragOverWrapper(e,t,o){this.onDragOver(e,t)},allowedColumnSorting(e){return"id"!==e.name&&"action_column"!==e.name},lineItemDataLoaded(e){e&&e.detail&&(this.lineItemsloading=!1,this.resetRows(),this.docId=this.record&&this.record.doc_id?this.record.doc_id:"",this.refactorApiData(),this.triggerLineItemDataLoadedEvent(),this.createAutoTriggerDebounceFunc(),this.setupLookup())},triggerLineItemDataLoadedEvent(){const e=new CustomEvent("line_items_loaded",{});document.dispatchEvent(e)},savedSortedColumns(){const e=[];this.tableColumns.forEach(((t,o)=>{e[t.name]=t,e[t.name]&&(e[t.name]["org_index"]=o)})),this.updatedLineColumns(this.tableColumns)},updatedLineColumns(e){return Ne(this,void 0,void 0,(function*(){try{this.showLoading();let t=this.line_table_columns+"_"+this.doctype;yield this.updateSetting(t,JSON.stringify(e))}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur"))}finally{this.hideLoading()}}))},resetRows(){this.tableRows=[],this.lineDataObj={}},refactorApiData(){this.is_ai_table=this.isAI_TableExit(this.record),this.setFormatOptions(),this.table_name=this.record.tables&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("name")?this.record.tables[0].name:"",this.prepareTableLayoutObj(),this.prepareTableColumn(),this.prepareTableRowsAndRowObj(),this.validateLineItemColumns(),this.triggerSave&&this.saveChanges(!1,!1,!0)},setFormatOptions(){this.formatting_options={},this.record.tables[0]&&this.record.tables[0].hasOwnProperty("formatting_options")&&(this.formatting_options=this.record.tables[0].formatting_options),this.record.tables[0].formatting_options=this.formatting_options,this.formatting_options.hasOwnProperty("columns_to_hide")&&null!==this.formatting_options.columns_to_hide&&(this.columns_to_hide=Object.assign([],this.formatting_options.columns_to_hide)),this.formatting_options.hasOwnProperty("custom_columns_to_hide")&&null!==this.formatting_options.custom_columns_to_hide&&(this.custom_columns_to_hide=Object.assign([],this.formatting_options.custom_columns_to_hide)),this.formatting_options.hasOwnProperty("column_origins")&&!(0,ye.z)(this.formatting_options.column_origins)&&(0,ye.Gv)(this.formatting_options.column_origins)||(this.record.tables[0].formatting_options.column_origins={},this.formatting_options.column_origins={})},prepareTableLayoutObj(){this.dropdownColumns=[];let e={};this.lineItemLayout={},this.record.tables&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("layout")&&Array.from(this.record.tables[0].layout).forEach((t=>{e.hasOwnProperty(t.column_name)||(t["lbl_to_display"]=this.getLabelToDisplay(t),this.lineItemLayout[t.column_name]=t,0==t.is_hidden&&(e[t.column_name]=!0,this.dropdownColumns.push({header:t.lbl_to_display,techName:t.column_name})))}))},prepareTableRowsAndRowObj(){this.tableRows=[],this.lineDataObj={};let e={};this.record.tables&&0!=this.record.tables.length&&this.record.tables[0].hasOwnProperty("rows")&&0!=this.record.tables[0].rows.length&&(Array.from(this.record.tables[0].rows).forEach((t=>{if(!1===t.is_deleted){let o={};e[t.id]=JSON.parse(JSON.stringify(t)),e[t.id].locations_list=[],t.locations_list&&Array.from(t.locations_list).forEach((o=>{e[t.id].locations_list["page_"+o.page]=o})),delete e[t.id].columns,e[t.id]["columns"]=[],Array.from(t.columns).forEach((i=>{if(e[t.id].columns[i.name]=JSON.parse(JSON.stringify(i)),e[t.id].columns[i.name].locations_list=[],i.locations_list&&Array.from(i.locations_list).forEach((o=>{e[t.id].columns[i.name].locations_list["page_"+o.page]=o})),(0,ye.z)(i.formatted_value)||""==i.formatted_value){i.formatted_value="";const e=this.getUiPreference(i.name,"UI_DEFAULT_VALUE");e&&(i.value=e,i.formatted_value=e,i.extraction_method="UD",this.triggerSave=!0)}o[i.name]=i.formatted_value,this.prepareMapOfColumnHavingData(i)})),this.addExtraColumnsInRow(e,o,t.id),o["id"]=t.id,o["show_charges"]=!1;const i=t.hasOwnProperty("is_additional_cost")&&!0===t.is_additional_cost;i||this.tableRows.push(o)}})),Object.assign(this.lineDataObj,e))},prepareMapOfColumnHavingData(e){Qe.has(e.name)?!1===Qe.get(e.name)&&e.formatted_value&&null!=e.formatted_value&&""!=e.formatted_value&&Qe.set(e.name,!0):e.formatted_value&&null!=e.formatted_value&&""!=e.formatted_value?Qe.set(e.name,!0):Qe.set(e.name,!1)},addExtraColumnsInRow(e,t,o){for(let i of this.layoutExtraColumns){let s={name:i,value:"",content:"",locations:[],locations_list:[],formatted_value:"",is_extra_column:!0};e[o].columns[i]=s,Qe.set(i,!1),t[i]=""}},sortTableColumn(){this.tableColumns.sort(((e,t)=>e.sortOrder<t.sortOrder?-1:e.sortOrder>t.sortOrder?1:0))},prepareTableColumn(){this.tableColumns=[],this.tableColumns.push({name:"status",field:"status",align:"left",label:"",is_mapped:!0,org_index:""}),this.record.tables&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("rows")&&(this.is_ai_table?this.AI_TableColumns():this.normalTableColumns(),this.sortTableColumn())},normalTableColumns(){const e=this.record.tables[0].rows[0];if(!e)return;let t={},o=JSON.parse(JSON.stringify(this.lineItemLayout));Array.from(e.columns).forEach((i=>{let s=this.isColumnHidden(e,i);if(s){let e=i.name,s="",a=9999;this.lineItemLayout.hasOwnProperty(i.name)&&(e=this.lineItemLayout[i.name].lbl_to_display,s=this.lineItemLayout[i.name].column_type,a=this.lineItemLayout[i.name].sort_order,delete o[i.name]);let l="";null!=i.org_index&&void 0!=i.org_index&&(l=String(i.org_index));let n={name:i.name,field:i.name,align:"left",label:e,is_mapped:!!i.is_mapped&&i.is_mapped,org_index:l,col_origin:"auto",dataType:s?s.toLowerCase():"string",sortable:!0,sortOrder:a};n.col_origin=this.getColumnOrigin(this.record.tables[0],i.name),i.hasOwnProperty("org_index")&&null!=i.org_index?this.tableColumns.push(n):t[i.name]=n}}));for(let[i,s]of Object.entries(t))this.tableColumns.push(Object.assign({},s));for(let i in o){const e=o[i];let t=!this.isCustomColumnHidden(e.name);if(!t){delete o[e.name];continue}const s=this.lineItemLayout[e.column_name].column_type;let a={name:e.column_name,field:e.column_name,align:"left",label:e.lbl_to_display,is_mapped:!!e.is_mapped&&e.is_mapped,org_index:"",is_extra_column:!0,col_origin:"auto",dataType:s?s.toLowerCase():"string",sortable:!0};a.col_origin=this.getColumnOrigin(this.record.tables[0],e.column_name),this.tableColumns.push(Object.assign({},a)),this.layoutExtraColumns.push(e.column_name)}},getOrignalColumnName(e){return!e.hasOwnProperty("original_name")||(0,ye.z)(e.original_name)?"":String(e.original_name)},is_AI_ColumnVisible(e){let t=!0,o=this.getOrignalColumnName(e);return o&&this.formatting_options&&this.formatting_options.hasOwnProperty("columns_to_hide")&&this.formatting_options.columns_to_hide&&0!=this.formatting_options.columns_to_hide.length?((this.formatting_options.columns_to_hide.includes(o)||"UUID"==e.name)&&(t=!1),t):t},is_AI_isColumnHidden(e,t){let o="";null!=t.original_name&&void 0!=t.original_name&&(o=String(t.original_name));let i=!0;return""!==o&&(i=this.is_AI_ColumnVisible(t)),""===o&&(i=!this.isCustomColumnHidden(t.name)),i&&this.lineItemLayout[t.name]&&(i=!this.lineItemLayout[t.name].is_hidden),i},AI_TableColumns(){let e={},t=[];Array.from(this.record.tables[0].rows).forEach((o=>{Array.from(o.columns).forEach((i=>{let s=this.is_AI_isColumnHidden(o,i);if(s&&!e.hasOwnProperty(i.name)){e[i.name]=!0;let o=i.name,s="",a="",l="",n=9999;this.lineItemLayout.hasOwnProperty(i.name)&&(o=this.lineItemLayout[i.name].lbl_to_display,s=this.lineItemLayout[i.name].column_type,a=this.lineItemLayout[i.name].is_required,l=this.lineItemLayout[i.name].always_visible,n=this.lineItemLayout[i.name].sort_order);let r="";null!=i.org_index&&void 0!=i.org_index&&(r=String(i.org_index));let d={name:i.name,field:i.name,align:"left",label:o,is_mapped:!!i.is_mapped&&i.is_mapped,org_index:""!==r?r:"",dataType:s?s.toLowerCase():"string",sortable:!0,is_required:a,always_visible:l,is_extra_column:!!i.hasOwnProperty("is_extra_column")&&i.is_extra_column,original_name:this.getOrignalColumnName(i),sortOrder:n};const u=d.is_mapped||!this.remove_unmapped_columns&&!d.is_mapped;i.hasOwnProperty("org_index")&&null!=i.org_index&&u?this.tableColumns.push(d):t[i.name]=d}}))}));for(let[o,i]of Object.entries(t)){const e=i;(e.hasOwnProperty("is_extra_column")&&!0===e.is_extra_column||e.always_visible||e.is_required)&&this.tableColumns.push(e)}},isCustomColumnHidden(e){let t=!1;if(!this.custom_columns_to_hide||0==this.custom_columns_to_hide.length)return t;for(const o of this.custom_columns_to_hide)if(o===e){t=!0;break}return t},isColumnHidden(e,t){let o="";null!=t.org_index&&void 0!=t.org_index&&(o=String(t.org_index));let i=!0;return""!==o&&(i=this.isColumnVisible(o,t)),i&&this.lineItemLayout[t.name]&&(i=!this.lineItemLayout[t.name].is_hidden),i},isColumnVisible(e,t){if(this.is_ai_table)return this.is_AI_ColumnVisible(t);let o=!0;return e&&this.formatting_options&&this.formatting_options.hasOwnProperty("columns_to_hide")&&this.formatting_options.columns_to_hide&&0!=this.formatting_options.columns_to_hide.length?((this.formatting_options.columns_to_hide.includes(e)||"UUID"==t.name)&&(o=!1),o):o},validateLineItemColumns(){let e=!1;if(void 0===this.tableColumns)return;for(const o of this.tableColumns){let t=this.isColumnNameValid(o);t||(o.error=!0,e=!0)}let t=!e;this.validation_done!==t&&(this.validation_done=t)},isColumnNameValid(e){let t=!1;for(const o of this.dropdownColumns)if(e.name===o.techName||"status"==e.name||"action_column"==e.name){t=!0;break}return t},hasOriginalIndex(e,t){let o=!1;return""!==e&&(o=!0),o},hasLineItems(){return!(!this.tableRows||0===Object.keys(this.tableRows).length)},goTolineItemsPage(){this.removeCache(),this.is_ai_table?this.$router.push("/field_validation_v1/"+this.record.doc_id):this.$router.push("/tbl_ext_v3/"+this.record.doc_id)},goToDashboard(){this.$router.push("/dashboard")},checkAITableSetting(){this.ai_table_setting_flag=!1,this.user_settings[this.AI_table_extraction_setting]&&(this.ai_table_setting_flag=this.user_settings[this.AI_table_extraction_setting])},onRowClick(e,t){return Ne(this,void 0,void 0,(function*(){this.selectedRow=JSON.parse(JSON.stringify(e)),this.selectedIndex=t,yield this.triggerlookupLovs("",!0,"",!1),yield this.triggerlookupLovsHavingData()}))},saveAndNextCopyDefaults(){return Ne(this,void 0,void 0,(function*(){const e=JSON.parse(JSON.stringify(this.selectedRow));yield this.saveAndNext();for(let[t,o]of Object.entries(e))this.getUiPreference(t,"UI_DEFAULT_VALUE")&&(this.selectedRow[t]=o)}))},saveAndNext(){return Ne(this,void 0,void 0,(function*(){let e=yield this.saveChanges(!0,!0,!1);if(!e)return;this.selectedIndex++;const t=this.tableRows[this.selectedIndex];this.onRowClick(t,this.selectedIndex)}))},saveChanges(e,t,o){return Ne(this,void 0,void 0,(function*(){let i=!1;if(this.isReadOnly)return i;if(t&&!this.validateData())return i;try{e&&this.showLoading(),this.tableRows[this.selectedIndex]=this.selectedRow,this.updateJsonForLineItems();const t=yield this.saveDocument(this.docId);if(this.removeCache(),!1===t.success)return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void this.showErrorToast(t.message);if(t.data.tables[0].messages&&(i=this.getErros(t.data.tables[0].messages),!i))return o=!1,i;this.$forceUpdate(),this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),i=!0}catch(s){return this.showErrorToast(this.$t("pages.messages.error_internal_occur")),void(i=!1)}finally{this.hideLoading(),o&&(this.selectedRow={},this.selectedIndex=null)}return i}))},getErros(e){let t=[];for(const i of e)if(i.row_index==this.selectedIndex){let e=i.message;if(i.hasOwnProperty("col_name")){let t=this.$t(i.col_name);this.lineItemLayout.hasOwnProperty(i.col_name)&&(t=this.lineItemLayout[i.col_name].lbl_to_display),e=t+": "+e}t.push(e)}let o=0==t.length;return o||this.showErrorToast(t.join("<br> ")),o},updateJsonForLineItems(){Array.from(this.record.tables[0].rows).forEach(((e,t)=>{this.selectedRow.id===e.id&&Array.from(e.columns).forEach(((e,o)=>{this.record.tables[0].rows[t].columns[o].value=this.selectedRow[e.name],this.record.tables[0].rows[t].columns[o].content=this.selectedRow[e.name],this.record.tables[0].rows[t].columns[o].formatted_value=this.selectedRow[e.name]}))}))},validateData(){let e=!0;for(let[t,o]of Object.entries(this.selectedRow)){if(this.lineItemLayout[t]&&this.lineItemLayout[t].is_required&&!o){e=!1,this.fieldErros[t]=this.$t("field_required");continue}const i=this.getFieldLength(t);i&&String(o).length>i&&(e=!1,this.fieldErros[t]=this.$t("invalid_field_length"))}return e},getUiPreference(e,t){return this.defaultValues&&this.defaultValues.table&&this.defaultValues.table[e]&&this.defaultValues.table[e][t]?this.defaultValues.table[e][t]:null},getColSpan(e){const t=this.getUiPreference(e,"UI_COL_SPAN");let o=3;return t&&(o*=+t,(o>12||o<1)&&(o=3)),o},getType(e){return this.getUiPreference(e,"UI_TEXT_AREA")},addLineRow(){return Ne(this,void 0,void 0,(function*(){this.selectedIndex=this.record.tables[0].rows.length;let e=JSON.parse(JSON.stringify(this.record.tables[0].rows[this.selectedIndex-1]));e.id=(0,ue.A)(),e.coords=[],e.is_header_row=!1,e.is_user_defined=!0;for(let[o,i]of Object.entries(e.columns)){let e=i,t="";"POSITION"==e.name&&(t=(Number(e.formatted_value)+1).toString());const o=this.getUiPreference(e.name,"UI_DEFAULT_VALUE");o&&(t=o),e.value=t,e.content=t,e.org_index=e.org_index?e.org_index++:0,e.formatted_value=t,e.original_content=t,e.extraction_method="UD"}this.record.tables[0].rows.push(e),this.prepareTableRowsAndRowObj(),yield this.onRowClick(this.tableRows[this.selectedIndex],this.selectedIndex);const t=this.tableRows[this.selectedIndex-1];for(let[o,i]of Object.entries(t))this.getUiPreference(o,"UI_DEFAULT_VALUE")&&(this.selectedRow[o]=i)}))},dropDownChange(e,t){return Ne(this,void 0,void 0,(function*(){try{this.showLoading(),this.updateTableValues(e,t),yield this.triggerlookupLovs(e,!1,t,!0),t&&this.fieldErros[e]&&delete this.fieldErros[e]}catch(o){}finally{this.hideLoading()}}))},changeEvent(e,t){this.updateTableValues(e,t),this.handleLookupAutoTrigger(e),t&&this.fieldErros[e]&&delete this.fieldErros[e]},handleLookupAutoTrigger(e){if((0,ye.z)(e)||(0,ye.jw)(e))return;let t=this.get_lookup_type_for_changed_field(e);1==t&&(this.get_groups_to_change(),this.updateLookupFieldsStatusInGroups(),this.debounceLookupAutoTriggerFunc())},get_lookup_type_for_changed_field(e){this.changed_fields=[],this.groups_to_update=[];let t=!1;for(let o of this.record.tables[0].lookup_configurations)if(!(0,ye.z)(o.lookup_dataset_name)&&!(0,ye.jw)(o.lookup_dataset_name))for(let i in o.fields)if(o.fields[i].column_name==e){this.groups_to_update.push({group:o,field_name:e,lookup_field:o.fields[i].lookup_field});for(let e of o.fields)this.changed_fields.push(e);this.trigger_lookup_flow=o.lookup_dataset_name,t=!0}return t},createAutoTriggerDebounceFunc(){this.debounceLookupAutoTriggerFunc=(0,de.A)((()=>{null!=this.trigger_lookup_flow&&""!=this.trigger_lookup_flow&&this.preparing_group_change_call()}),3e3)},triggerlookupLovsHavingData(){return Ne(this,void 0,void 0,(function*(){const e=this.record.tables[0].lookup_lov_configurations;if(e)for(const[t,o]of Object.entries(this.selectedRow))if(this.lovFields.hasOwnProperty(t)){let e=this.lovFields[t].fields[0].column_name;e&&this.selectedRow[e]&&(yield this.triggerlookupLovs(e,!1,this.selectedRow[e],!1))}}))},triggerlookupLovs(e,t,o,i){return Ne(this,void 0,void 0,(function*(){const s=this.record.tables[0].lookup_lov_configurations;if(s)e:for(let a of s)if(a.fields&&0!=a.fields.length){this.lovFieldsList[a.column_name]||(this.lovFields[a.column_name]=a,this.lovFieldsList[a.column_name]=[]);for(let s of a.fields)if(t){if(null==s.column_name){let e=null;s.lookup_field&&(e=JSON.stringify({[s.lookup_field]:[s.filter_value]})),this.lovFieldsList[a.column_name]=yield U.SY.getLookupLov(a.id,e)}}else if(e==s.column_name){const e={[s["lookup_field"]]:o},t=a.column_name+"_"+o;this.lovFieldsList[t]=yield U.SY.getLookupLov(a.id,JSON.stringify(e)),i&&(this.selectedRow[a.column_name]="");break e}}}))},getKey(e){let t=e,o=this.lovFields[e].fields[0].column_name;return o&&this.selectedRow[o]&&(t=e+"_"+this.selectedRow[o]),t},getFieldLength(e){return this.getUiPreference(e,"UI_MAX_LENGTH")},removeLineItem(e,t){let o=t;for(const[i,s]of Object.entries(this.record.tables[0].rows))if(s.id===e){o=Number(i);break}this.record.tables[0].rows.splice(o,1),this.tableRows.splice(t,1),this.selectedRow={},this.selectedIndex=null},setupLookup(){try{if(this.lookup_configurations=new Map,!this.record.tables[0].lookup_configurations)return;for(const[e,t]of this.record.tables[0].lookup_configurations.entries())if(t.hasOwnProperty("fields")&&Array.isArray(t.fields))for(const[o,i]of t.fields.entries())i.is_searchable&&this.lookup_configurations.set(i.column_name,Object.assign(JSON.parse(JSON.stringify(i)),{lookup_dataset_name:t.lookup_dataset_name,fields:JSON.parse(JSON.stringify(t.fields))}));this.check_for_auto_trigger()}catch(e){}},check_for_auto_trigger(){this.fields_with_autotrigger=[];for(let e of this.record.tables[0].lookup_configurations)if(!(0,ye.z)(e.lookup_dataset_name)&&!(0,ye.jw)(e.lookup_dataset_name))for(let t in e.fields)!0!==e.fields[t].auto_trigger||this.fields_with_autotrigger.some((o=>o.field_name.toLowerCase()===e.fields[t].column_name.toLowerCase()&&o.lookup_field.toLowerCase()===e.fields[t].lookup_field.toLowerCase()&&o.group===e))||this.fields_with_autotrigger.push({field_name:e.fields[t].column_name,lookup_field:e.fields[t].lookup_field,group:e})},masterDataSearchByField(e,t){try{const o=t.name,i=this.lookup_configurations.get(o);if(!i)return;const s=(0,ue.A)(),a=Object.values(this.ms_advance_filters).find((e=>e.field_name===t.name));if(!a&&(this.ms_advance_filters[s]={fuzzy_field:i.lookup_field.toLowerCase(),search_text:t.formatted_value,field_name:o,primary:!0},this.master_lookup_type=i.lookup_dataset_name,this.master_data_fields_map=new Map,this.master_data_fields_map.set(this.master_lookup_type,i),this.master_data_popup_width=this.calculateWidthForMSPopuup(),i.parent_field_id&&""!=i.parent_field_id)){let t=null;for(const[e,o]of i.fields.entries())if(i.parent_field_id==o.field_id){t=o;break}if(t){const o=(0,ue.A)();this.ms_advance_filters[o]={fuzzy_field:t.lookup_field.toLowerCase(),search_text:this.lineDataObj[e]["columns"][t.field_name].formatted_value,field_name:t.field_name,primary:!1}}}this.fuzzyDialog=!0}catch(o){}},calculateWidthForMSPopuup(){let e="700";const t=document.querySelector(".field_validation");if(!t)return e;const o=document.querySelector("#field_scrolle");if(!o)return e;const i=o.offsetWidth;return i<=0?e:String(i)},closeMsDialog(){this.fuzzyDialog=!1,this.ms_advance_filters={}},get_changed_fields(e){const t=e.fields;for(let[o,i]of t.entries())this.changed_fields.push(i)},get_groups_to_change(){for(let e of this.fields_with_autotrigger)for(let t of this.changed_fields)t.column_name.toLowerCase()!=e.field_name.toLowerCase()&&t.lookup_field.toLowerCase()!=e.lookup_field.toLowerCase()||this.groups_to_update.some((o=>o.group===e.group&&o.field_name.toLowerCase()===t.column_name.toLowerCase()&&o.lookup_field.toLowerCase()===t.lookup_field.toLowerCase()))||this.groups_to_update.push({group:e.group,field_name:e.field_name,lookup_field:e.lookup_field})},removeCurrentSelectedGroup(e){this.groups_to_update=this.groups_to_update.filter((t=>t.group.lookup_dataset_name!==e))},updateLookupFieldsStatusInGroups(e=!0,t=!0){for(let o in this.groups_to_update){const i=this.groups_to_update[o].group;for(let[o,s]of i.fields.entries())this.handleLookupFieldStatus(s.column_name,e,t)}},handleLookupFieldStatus(e,t,o=!0){this.lineDataObj[this.selectedRow.id]["columns"].hasOwnProperty(e)&&(this.lookup_loading_fields.hasOwnProperty(e)||(this.lookup_loading_fields[e]={}),this.lookup_loading_fields[e].lookup_loading=t,o&&(this.lookup_loading_fields[e].lookup_found=null,this.lookup_loading_fields[e].lookup_found_name=null))},populateMSDataFromPopup(){this.changed_fields=[],this.groups_to_update=[];let e=this.master_data_fields_map.get(this.master_lookup_type);this.get_changed_fields(e),this.get_groups_to_change(),this.removeCurrentSelectedGroup(this.master_lookup_type),this.populateMasterDataFields(e,this.master_lookup_type,this.master_data_row),this.updateLookupFieldsStatusInGroups(),this.preparing_group_change_call()},preparing_group_change_call(){return Ne(this,void 0,void 0,(function*(){const e={};for(let t in this.groups_to_update){const o=this.groups_to_update[t].group;if((0,ye.z)(this.groups_to_update[t].group.lookup_dataset_name)||(0,ye.jw)(this.groups_to_update[t].group.lookup_dataset_name)||e.hasOwnProperty(this.groups_to_update[t].group.id))continue;const i=this.groups_to_update[t].group.lookup_dataset_name;e[this.groups_to_update[t].group.id]=!0;const s={},a=(0,ue.A)();let l=this.groups_to_update[t].field_name,n=this.groups_to_update[t].lookup_field;s[a]={field:{field:n},operator:this.getFieldOperator(l,this.groups_to_update[t]),search_text:this.lineDataObj[this.selectedRow.id]["columns"][l].formatted_value};let r=yield this.autoTriggerSearchByField(s,i);if(null!=r){const e=JSON.stringify(r.data[0]);this.populateMasterDataFields(o,i,e),this.lookup_loading_fields[l].lookup_found=!0}else this.lookup_loading_fields[l].lookup_found=!1,this.lookup_loading_fields[l].lookup_found_name=i}this.trigger_lookup_flow="",this.updateLookupFieldsStatusInGroups(!1,!1)}))},populateMasterDataFields(e,t,o){try{this.closeMsDialog(),this.showLoading(),this.freeze_fields_change_event=!0;let t=JSON.parse(o);const i=e.fields;for(let[e,o]of i.entries()){const e=o.column_name,i=o.lookup_field.toLowerCase();if(!this.lineDataObj[this.selectedRow.id]["columns"].hasOwnProperty(e))continue;if(0==t.hasOwnProperty(i)||null==t[i])continue;let s=t[i];t.hasOwnProperty(i+"_formatted_value")&&(s=t[i+"_formatted_value"]),this.updateTableValues(e,s)}this.resetMasterDataStore()}catch(i){}finally{this.hideLoading(),this.freeze_fields_change_event=!1}},updateTableValues(e,t){this.lineDataObj[this.selectedRow.id]["columns"][e].value=t,this.lineDataObj[this.selectedRow.id]["columns"][e].content=t,this.lineDataObj[this.selectedRow.id]["columns"][e].formatted_value=t,this.selectedRow[e]=t},getFieldOperator(e,t){for(let o of t.group.fields)if(o.column_name==e&&o.hasOwnProperty("search_operator")&&!(0,ye.z)(o.search_operator)&&!(0,ye.jw)(o.search_operator))return o.search_operator;return"contains"}},setup(){const e=(0,T.KR)(null);let t=[],o={};const i=(0,N.q3)(),{record:s,doctype:a,remove_unmapped_columns:l}=(0,E.bP)(i),{removeCache:n,isAI_TableExit:r,saveDocument:d,saveFieldsStateForAutotrigger:u}=i;(0,he.wYm)(e,(0,de.A)((e=>{const t=e[0];if(_.value.LINE_ITEM_TABLE_SETTING){const e=JSON.parse(_.value.LINE_ITEM_TABLE_SETTING);if(e&&e.height==t.contentRect.height)return}t.contentRect.width<20||t.contentRect.height<20||((0,ve.wd)("LINE_ITEM_TABLE_SETTING",JSON.stringify(t.contentRect)),(0,Q._Y)("LINE_ITEM_TABLE_SETTING",JSON.stringify(t.contentRect),!0),_.value["LINE_ITEM_TABLE_SETTING"]=JSON.stringify(t.contentRect))}),1e3));const c=(0,N.Bu)(),{user_settings:_}=(0,E.bP)(c),{updateSetting:m}=c,h=(0,N.vm)(),{searchByField:p,interpolate:g}=h,{lookup_loading_fields:f,trigger_lookup_flow:b}=(0,E.bP)(h),y=(0,N.Ox)(),{model:v,advance_filters:k,master_lookup_type:w,changed_fields:L,groups_to_update:C,fields_with_autotrigger:A,selected_row:I,populate_row_to_view:O,master_data_fields_map:F,isDraggle:x}=(0,E.bP)(y),{resetMasterDataStore:D,isContentChanged:R,isCurrentFieldPrimary:S}=y;return{saveDocument:d,user_settings:_,updateSetting:m,remove_unmapped_columns:l,ai_table_setting_flag:(0,T.KR)(!1),record:s,doctype:a,el:e,removeCache:n,isAI_TableExit:r,is_ai_table:(0,T.KR)(!1),lineItemsloading:(0,T.KR)(!0),tableColumns:(0,T.KR)(t),tableRows:(0,T.KR)(t),table_name:(0,T.KR)(""),lineDataObj:{},lovFieldsList:(0,T.KR)({}),lineItemLayout:(0,T.KR)(t),formatting_options:(0,T.KR)(o),custom_columns_to_hide:(0,T.KR)(t),columns_to_hide:(0,T.KR)(t),layoutExtraColumns:(0,T.KR)([]),selectedRow:(0,T.KR)({}),fieldErros:(0,T.KR)({}),selectedIndex:(0,T.KR)(),resetMasterDataStore:D,isDraggle:x,changed_fields:L,master_data_row:I,groups_to_update:C,master_lookup_type:w,ms_advance_filters:k,populate_row_to_view:O,master_data_fields_map:F,fields_with_autotrigger:A,interpolate:g,autoTriggerSearchByField:p,saveFieldsStateForAutotrigger:u,trigger_lookup_flow:b,lookup_loading_fields:f,debounceLookupAutoTriggerFunc:{},master_data_popup_width:(0,T.KR)("700"),lookup_configurations:new Map,fuzzyDialog:(0,T.KR)(!1),freeze_fields_change_event:!1}}});var Ke=o(42315),je=o(44488),We=o(57722),Xe=o(50492),ze=o(97410),$e=o(45262),Me=o(56384),Be=o(857),Je=o(58210),He=o(67837),Ge=o(48975),Ye=o(93692),Ze=o(94940),et=o(82157),tt=o(3952),ot=o(18301),it=o(13796),st=o(67156);const at=(0,Ae.A)(Ue,[["render",re],["__scopeId","data-v-b9720cd4"]]),lt=at;Se()(Ue,"components",{QTable:Ke.A,QTr:je.A,QTh:We.A,QIcon:Xe.A,QTooltip:ze.A,QTd:$e.A,QBtn:Me.A,QMarkupTable:Be.A,QSpinner:Je.A,QSeparator:Ee.A,QInput:He.A,QPopupProxy:Ge.A,QDate:Ye.A,QSelect:Ze.A,QSpinnerIos:et.A,QAvatar:tt.A,QBtnDropdown:ot.A,QList:Oe.A,QItem:Fe.A,QItemSection:xe.A,QItemLabel:it.A,QField:st.A}),Se()(Ue,"directives",{ClosePopup:De.A});var nt=o(94822),rt=o(63923),dt=o(91236),ut=o(12566),ct=o(76194),_t=function(e,t,o,i){function s(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function l(e){try{r(i.next(e))}catch(t){a(t)}}function n(e){try{r(i["throw"](e))}catch(t){a(t)}}function r(e){e.done?o(e.value):s(e.value).then(l,n)}r((i=i.apply(e,t||[])).next())}))};z.A.table.arrowUp="arrow_drop_down";const mt=(0,i.pM)({el:"#app",mixins:[D.A,R.A,W.A],components:{TaskBtn:rt.A,SubHeader:dt.A,LineItems:lt,exportBtns:ct.A,DocumentLock:j.A,CreateTaskBtn:K.A,MessageBanner:X.A,ImageComponent:nt["default"],ErrorDocumentView:ut.A},data(){return{docId:"",error_message:"",dynamicWidth:(0,T.KR)(0),imageFieldSplitter:(0,T.KR)(76),defalutAttributes:(0,T.KR)({})}},mounted(){this.docId=this.$route.params.id,this.record=[],this.init(),window.vqd=this},methods:{init(){return _t(this,void 0,void 0,(function*(){try{if(this.processing=!0,yield this.getDocumentById(this.docId),!this.record||0===Object.keys(this.record).length||!1===this.record.success)return;const e=yield U.M8.getAdditionalAttributes(this.doctype);e.success&&this.prepareDefaultVaueObj(e),this.makeModel(),this.handleReadOnly(),this.initPage()}catch(e){if(null!=e&&"object"==typeof e&&e.hasOwnProperty("message"))return void this.showErrorToast(e.message);this.showErrorToast("Error while displaying Page. Please reload again or contact admistrator")}finally{this.processing=!1}}))},prepareDefaultVaueObj(e){if(this.defalutAttributes["fields"]={},this.defalutAttributes["table"]={},e.field_attributes)for(const[t,o]of Object.entries(e.field_attributes)){this.defalutAttributes["fields"][t]=[];for(const[e,i]of Object.entries(o))this.defalutAttributes["fields"][t][e]=i}if(e.table_attributes)for(const[t,o]of Object.entries(e.table_attributes)){for(const[e,t]of Object.entries(o)){this.defalutAttributes["table"][e]=[];for(const[o,i]of Object.entries(t))this.defalutAttributes["table"][e][o]=i}break}},makeModel(){for(let t of this.record.fields)t.formatted_value&&(this.checkForDefaultValues(t),this.documentFields[t.name]=t);let e=this.record.layout.groups;e.forEach(((e,t)=>{e.rows.forEach(((e,t)=>{e.forEach(((e,t)=>{this.documentFields[e.field_name]&&this.documentFieldsConfig.push(e)}))}))}))},checkForDefaultValues(e){if(e.formatted_value)return;if(!this.defalutAttributes["fields"][e.name]&&!this.defalutAttributes["fields"][e.name]["UI_DEFAULT_VALUE"])return;const t=this.defalutAttributes["fields"][e.name]["UI_DEFAULT_VALUE"];t&&(e.value=t,e.formatted_value=t,e.extraction_method="UD")},splitterChanged(){let e=window.innerWidth,t=e*(100-this.imageFieldSplitter)/100;this.dynamicWidth=t},handleReadOnly(){if(this.record.status!=V.aH.ready_for_validation)return this.is_view_readonly=!0,this.trigger_document_lock=!1,void(this.error_message=this.$t("pages.messages.READ_ONLY_MSG"));this.trigger_document_lock=!0;const e=S.tH.hasAccess("update");e||(this.is_view_readonly=!0)},initLineItems(){const e=new CustomEvent("init_line_items",{detail:this.record});document.dispatchEvent(e)},initPage(){this.record&&this.record.fields&&(this.table_name=this.record.tables&&this.record.tables.length>0&&this.record.tables[0].hasOwnProperty("name")?this.record.tables[0].name:"",this.setDataToCache(),this.initLineItems())},getLineItemsPoV3Ref(){let e=this.$refs.lineItemsPoV3;return e&&Array.isArray(e)?e[0]:e},toggleImageArea(){this.imageFieldSplitter>=90?this.imageFieldSplitter=70:this.imageFieldSplitter=100},togglePoImage(){"chevron_left"===this.togglerIcon?this.togglerIcon="chevron_right":this.togglerIcon="chevron_left",(0,q.$)("#po-image-container").classList.toggle("hidden"),(0,q.$)("#po-container-parrent").classList.toggle("po-container-parrent"),(0,q.$)("#po-container-parrent").classList.toggle("po-container-parrent-full-width")},routeToBack(){try{if(history.state.back)return void this.$router.back();this.$router.push("/field_validation_v1/"+this.docId)}catch(e){this.$router.push("/field_validation_v1/"+this.docId)}}},setup(){const e=(0,N.q3)(),{record:t,error:o,processing:i,doctype:s,document_version:a}=(0,E.bP)(e),{getDocumentById:l,saveDocument:n,removeCache:r,setDataToCache:d}=e,u=(0,N.oI)(),{releaseDocLock:c}=u;return{removeCache:r,saveDocument:n,setWithExpiry:Q._Y,setDataToCache:d,getDocumentById:l,saveUserPrefToServer:ve.wd,releaseDocLock:c,record:t,doctype:s,processing:i,document_version:a,doc_fetch_error:(0,T.KR)(o),trigger_document_lock:(0,T.KR)(!1),is_view_readonly:(0,T.KR)(!1),documentFields:(0,T.KR)([]),documentFieldsConfig:(0,T.KR)([]),togglerIcon:(0,T.KR)("chevron_right"),baseUrl:P.VA,table_name:(0,T.KR)("")}}});var ht=o(98072),pt=o(39035),gt=o(71746);const ft=(0,Ae.A)(mt,[["render",x],["__scopeId","data-v-95a50820"]]),bt=ft;Se()(mt,"components",{QSplitter:ht.A,QBtn:Me.A,QIcon:Xe.A,QInput:He.A,QSeparator:Ee.A,QInnerLoading:pt.A,QField:st.A,QTabPanel:gt.A})}}]);