"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[2101],{52101:(e,t,s)=>{s.r(t),s.d(t,{default:()=>fs});var a=s(61758),i=s(58790);const o={key:0},n={key:0,class:"full-width"},r={class:"bg-grey-3"},l={class:"q-pa-lg flex flex-center"},c={key:0},d={class:"text-center",colspan:"10"},h={key:1,class:"dashboard-container dashboard-text-color dashboard-main-tasks"};function u(e,t,s,u,p,m){const g=(0,a.g2)("SubHeader"),k=(0,a.g2)("MobileGrid"),_=(0,a.g2)("q-markup-table"),v=(0,a.g2)("q-pagination"),b=(0,a.g2)("Header"),f=(0,a.g2)("q-separator"),y=(0,a.g2)("List"),w=(0,a.g2)("TaskBoard"),C=(0,a.g2)("Loader");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(g,{name:"tasks",label:e.$t("tasks"),show_expiry_alert:!0,onSearch:!1},null,8,["label"]),e.isMobile()?((0,a.uX)(),(0,a.CE)("div",o,[e.tasks&&e.tasks.length>0?((0,a.uX)(),(0,a.CE)("div",n,[(0,a.bF)(k,{onRowClick:e.rowClick},null,8,["onRowClick"])])):((0,a.uX)(),(0,a.Wv)(_,{key:1,class:"full-width"},{default:(0,a.k6)((()=>[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",r,[(0,a.Lk)("th",null,(0,i.v_)(e.$t("no_data_found")),1)])])])),_:1})),(0,a.Lk)("div",l,[e.total_pages>0?((0,a.uX)(),(0,a.CE)("tr",c,[(0,a.Lk)("td",d,[(0,a.bF)(v,{modelValue:e.current_page,"onUpdate:modelValue":t[0]||(t[0]=t=>e.current_page=t),color:"primary",max:e.total_pages,"max-pages":6,"boundary-links":"",onClick:t[1]||(t[1]=t=>e.nexPageClicked())},null,8,["modelValue","max"])])])):(0,a.Q3)("",!0)])])):((0,a.uX)(),(0,a.CE)("div",h,[(0,a.bF)(b),(0,a.bF)(f,{class:"seperator"}),e.getListMode()?((0,a.uX)(),(0,a.Wv)(y,{key:0})):((0,a.uX)(),(0,a.Wv)(w,{key:1}))])),(0,a.bF)(C)],64)}var p=s(46162),m=s(1659),g=s(24622);const k={class:"row q-mb-md"},_={style:{"margin-top":"40px"},class:"dashboard-title dark-readable"},v={class:"col"},b={class:"row justify-start"},f={class:"dashboard-search-box q-ml-md mt-20"},y={class:"dashboard-search-box q-ml-md mt-20"},w={class:"q-mt-sm"};function C(e,t,s,o,n,r){const l=(0,a.g2)("quickSearch"),c=(0,a.g2)("UserFilter"),d=(0,a.g2)("q-space"),h=(0,a.g2)("q-tooltip"),u=(0,a.g2)("f-btn"),p=(0,a.g2)("filterBadges");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",k,[(0,a.Lk)("div",_,(0,i.v_)(e.$t("all_tasks"))+" ("+(0,i.v_)(e.total_records)+")",1),(0,a.Lk)("div",v,[(0,a.Lk)("div",b,[(0,a.Lk)("div",f,[(0,a.bF)(l)]),(0,a.Lk)("div",y,[(0,a.bF)(c)]),(0,a.bF)(d),(0,a.bF)(u,{square:"",class:"q-mr-sm mt-20",icon:"img:images/refresh.svg",onClick:e.refreshFilters},{default:(0,a.k6)((()=>[(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("refresh_list")),1)])),_:1})])),_:1},8,["onClick"]),(0,a.bF)(u,{square:"",class:"q-mr-sm mt-20",icon:"dashboard",onClick:t[0]||(t[0]=t=>e.changeListMode())},{default:(0,a.k6)((()=>[(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("change_view")),1)])),_:1})])),_:1})])])]),(0,a.Lk)("div",w,[(0,a.bF)(p)])],64)}var E=s(83319),F=s(29104);const S={class:"q-pa-md"},L={class:"row q-my-sm"},D={style:{"margin-top":"10px"}},A={class:"row q-my-sm"},x={style:{"margin-top":"10px"}},I={class:"row q-my-sm"},T={style:{"margin-top":"10px"}},M={class:"row q-my-sm"},R={style:{"margin-top":"10px"}},P={class:"float-right q-ml-auto"};function q(e,t,s,o,n,r){const l=(0,a.g2)("q-space"),c=(0,a.g2)("StatusFilter"),d=(0,a.g2)("PriorityFilter"),h=(0,a.g2)("UserFilter"),u=(0,a.g2)("PaginationSettings"),p=(0,a.g2)("f-btn"),m=(0,a.g2)("q-menu"),g=(0,a.g2)("q-input");return(0,a.uX)(),(0,a.Wv)(g,{dense:"",modelValue:e.searchInput,"onUpdate:modelValue":[t[1]||(t[1]=t=>e.searchInput=t),t[2]||(t[2]=t=>e.inputValueChanges())],class:(0,i.C4)(["search-invoices",0===e.searchInput.length?"search-in-active":"search-active"]),autofocus:"",placeholder:e.$t("task_quick_search_placeholder"),outlined:"",onKeyup:(0,F.jR)(e.triggerSearchOnEnter,["enter"])},{append:(0,a.k6)((()=>[(0,a.bF)(p,{icon:"tune",appearance:"flat"},{default:(0,a.k6)((()=>[(0,a.bF)(m,{style:{width:"500px","min-height":"250px"},anchor:"bottom start",self:"top left",offset:[453,10]},{default:(0,a.k6)((()=>[(0,a.Lk)("div",S,[(0,a.Lk)("div",L,[(0,a.Lk)("span",D,(0,i.v_)(e.$t("status")),1),(0,a.bF)(l),(0,a.bF)(c)]),(0,a.Lk)("div",A,[(0,a.Lk)("span",x,(0,i.v_)(e.$t("priority")),1),(0,a.bF)(l),(0,a.bF)(d)]),(0,a.Lk)("div",I,[(0,a.Lk)("span",T,(0,i.v_)(e.$t("assigned_to")),1),(0,a.bF)(l),(0,a.bF)(h)]),(0,a.Lk)("div",M,[(0,a.Lk)("span",R,(0,i.v_)(e.$t("pagination_size")),1),(0,a.bF)(l),(0,a.bF)(u)]),(0,a.Lk)("div",P,[(0,a.bF)(p,{appearance:"secondary",class:"q-mr-sm mt-20 q-mb-md",label:e.$t("clear_filters"),onClick:t[0]||(t[0]=t=>e.resetFilters())},null,8,["label"])])])])),_:1})])),_:1})])),_:1},8,["modelValue","class","placeholder","onKeyup"])}var K=s(38734),$=s(53500);function O(e,t,s,i,o,n){const r=(0,a.g2)("q-select");return(0,a.uX)(),(0,a.Wv)(r,{outlined:"",dense:"",class:"q-mr-sm user-select",modelValue:e.page_size,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.page_size=t),t[1]||(t[1]=t=>{e.update(t)})],options:e.pagination_options,label:e.$t("pagination_size")},null,8,["modelValue","options","label"])}const W=(0,a.pM)({mixins:[],props:{},watch:{},methods:{update(e){this.setPaginationSize(e),this.triggerApplyFilters()},triggerApplyFilters(){const e=new CustomEvent("apply_filters",{});document.dispatchEvent(e)},validatePaginationSize(){this.page_size<=50||(this.page_size=50)}},mounted(){this.validatePaginationSize()},setup(){const e=(0,E.OP)(),{page_size:t}=(0,m.bP)(e),{setPaginationSize:s}=e;return{setPaginationSize:s,page_size:t,pagination_options:(0,K.KR)(["10","25","50"])}}});var X=s(12807),Q=s(94940),U=s(98582),B=s.n(U);const j=(0,X.A)(W,[["render",O]]),z=j;function V(e,t,s,o,n,r){const l=(0,a.g2)("q-checkbox"),c=(0,a.g2)("q-item-section"),d=(0,a.g2)("q-item"),h=(0,a.g2)("q-select");return(0,a.uX)(),(0,a.Wv)(h,{class:"q-mr-sm",dense:"",style:{width:"227px"},outlined:"",multiple:"",options:e.statusOptions,modelValue:e.selected_value,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.selected_value=t),t[1]||(t[1]=t=>{e.valueUpdated(t)})],label:e.$t("status")},{option:(0,a.k6)((({itemProps:t,selected:s,opt:o,toggleOption:n})=>[(0,a.bF)(d,(0,i._B)((0,a.Ng)(t)),{default:(0,a.k6)((()=>[(0,a.bF)(c,{side:""},{default:(0,a.k6)((()=>[(0,a.bF)(l,{"model-value":s,"onUpdate:modelValue":e=>n(o)},null,8,["model-value","onUpdate:modelValue"])])),_:2},1024),(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.Lk)("div",null,(0,i.v_)(e.$t(o.label)),1)])),_:2},1024)])),_:2},1040)])),_:1},8,["options","modelValue","label"])}B()(W,"components",{QSelect:Q.A});var H=s(68450),J=s(91486);const G=(0,a.pM)({mixins:[],props:{},watch:{taskfiltersMap:{deep:!0,handler:function(e,t){this.loadSavedFiler()}}},data(){return{}},mounted(){this.statusOptions=J.E.map((e=>({label:this.$t(e),value:e}))),this.loadSavedFiler()},unmounted:function(){},methods:{loadSavedFiler(){const e=this.taskfiltersMap.get("status");(0,H.z)(e)||""==e?this.selected_value=[]:this.selected_value=e},valueUpdated(e){logInfo("valueUpdated",e),this.selected_value=e,this.handleEmptyValue()||(this.setItemInFiltersMap("status",this.selected_value),this.triggerApplyFilters())},handleEmptyValue(){return!(!(0,H.z)(this.selected_value)&&0!=this.selected_value.length)&&(this.deleteItemInFiltersMap("status"),this.triggerApplyFilters(),!0)},triggerApplyFilters(){const e=new CustomEvent("apply_filters",{detail:{}});document.dispatchEvent(e)}},setup(){const e=(0,E.OP)(),{taskfiltersMap:t}=(0,m.bP)(e),{setItemInFiltersMap:s,deleteItemInFiltersMap:a}=e;return{selected_value:(0,K.KR)([]),statusOptions:(0,K.KR)([]),taskfiltersMap:t,setItemInFiltersMap:s,deleteItemInFiltersMap:a}}});var N=s(90124),Y=s(25173),Z=s(80460);const ee=(0,X.A)(G,[["render",V]]),te=ee;function se(e,t,s,i,o,n){const r=(0,a.g2)("q-select");return(0,a.uX)(),(0,a.Wv)(r,{class:"q-mr-sm",dense:"",style:{width:"227px"},outlined:"",options:e.priorityOptions,modelValue:e.selected_value,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.selected_value=t),t[1]||(t[1]=t=>{e.valueUpdated(t)})],label:e.$t("priority")},null,8,["options","modelValue","label"])}B()(G,"components",{QSelect:Q.A,QItem:N.A,QItemSection:Y.A,QCheckbox:Z.A});const ae=(0,a.pM)({mixins:[],props:{},watch:{taskfiltersMap:{deep:!0,handler:function(e,t){this.loadSavedFiler()}}},data(){return{}},mounted(){this.priorityOptions=J.G.map((e=>({label:this.$t(e),value:e}))),this.loadSavedFiler()},unmounted:function(){},methods:{loadSavedFiler(){const e=this.taskfiltersMap.get("priority");this.selected_value=e||""},valueUpdated(e){this.selected_value=e,this.handleEmptyValue()||(this.setItemInFiltersMap("priority",this.selected_value),this.triggerApplyFilters())},handleEmptyValue(){return!(""!==this.selected_value&&!(0,H.z)(this.selected_value))&&(this.deleteItemInFiltersMap("priority"),this.triggerApplyFilters(),!0)},triggerApplyFilters(){const e=new CustomEvent("apply_filters",{detail:{}});document.dispatchEvent(e)}},setup(){const e=(0,E.OP)(),{taskfiltersMap:t}=(0,m.bP)(e),{setItemInFiltersMap:s,deleteItemInFiltersMap:a}=e;return{selected_value:(0,K.KR)(""),priorityOptions:(0,K.KR)([]),taskfiltersMap:t,setItemInFiltersMap:s,deleteItemInFiltersMap:a}}}),ie=(0,X.A)(ae,[["render",se]]),oe=ie;B()(ae,"components",{QSelect:Q.A});const ne={class:"ellipsis"};function re(e,t,s,o,n,r){const l=(0,a.g2)("q-select");return(0,a.uX)(),(0,a.Wv)(l,{ref:"q-select",class:"q-mr-sm user-filter-select",dense:"",outlined:"",modelValue:e.selected_value,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.selected_value=t),t[1]||(t[1]=t=>{e.valueUpdated(t)})],options:e.user_options,label:e.$t("assigned_to")},{"selected-item":(0,a.k6)((e=>[(0,a.Lk)("div",ne,(0,i.v_)(e.opt.label),1)])),_:1},8,["modelValue","options","label"])}const le=(0,a.pM)({mixins:[],props:{},watch:{taskfiltersMap:{deep:!0,handler:function(e,t){this.loadFilters()}}},mounted(){this.setUserOptions(),this.loadFilters()},methods:{loadFilters(){const e=this.taskfiltersMap.get(this.filter_name);this.selected_value=e||""},triggerApplyFilters(){const e=new CustomEvent("apply_filters",{detail:{}});document.dispatchEvent(e)},valueUpdated(e){this.selected_value=e,this.handleEmptyValue()||(this.setItemInFiltersMap(this.filter_name,this.selected_value),this.triggerApplyFilters())},handleEmptyValue(){return!(""!==this.selected_value&&!(0,H.z)(this.selected_value))&&(this.deleteItemInFiltersMap(this.filter_name),this.triggerApplyFilters(),!0)},setUserOptions(){this.user_options=[{label:this.$t("all"),value:!1},{label:this.$t("assigned_to_me"),value:!0}]}},setup(){const e=(0,E.OP)(),{taskfiltersMap:t}=(0,m.bP)(e),{setItemInFiltersMap:s,deleteItemInFiltersMap:a}=e;return{setItemInFiltersMap:s,deleteItemInFiltersMap:a,taskfiltersMap:t,selected_value:(0,K.KR)(""),user_options:(0,K.KR)([]),filter_name:"only_for_current_user"}}}),ce=(0,X.A)(le,[["render",re]]),de=ce;B()(le,"components",{QSelect:Q.A});const he=(0,a.pM)({mixins:[],props:{},components:{StatusFilter:te,PaginationSettings:z,PriorityFilter:oe,UserFilter:de},watch:{taskfiltersMap:{deep:!0,handler:function(e,t){this.loadSavedFiler()}}},mounted(){this.debounceSearchInputFunc=(0,$.A)((()=>{this.triggerApplyFilters()}),1e3),document.addEventListener("delete_input_text",this.clearSearchInput)},methods:{clearSearchInput(){this.searchInput=""},resetFilters(){const e=new CustomEvent("reset_filters",{});document.dispatchEvent(e)},loadSavedFiler(){let e=this.taskfiltersMap.get("keyword");e||(e=""),this.searchInput=e},triggerSearchOnEnter(e){13===e.keyCode&&this.inputValueChanges()},inputValueChanges(){if(this.searchInput&&(this.searchInput=this.searchInput.trim()),0==this.searchInput.length)return this.deleteItemInFiltersMap("keyword"),void this.debounceSearchInputFunc();this.oldSearchInput=this.searchInput,this.setItemInFiltersMap("keyword",this.searchInput),this.debounceSearchInputFunc()},triggerApplyFilters(){const e=new CustomEvent("apply_filters",{detail:{reset_pagination:this.reset_pagination}});document.dispatchEvent(e)}},setup(){const e=(0,E.OP)(),{taskfiltersMap:t}=(0,m.bP)(e),{setItemInFiltersMap:s,deleteItemInFiltersMap:a}=e;return{deleteItemInFiltersMap:a,setItemInFiltersMap:s,searchInput:(0,K.KR)(""),oldSearchInput:(0,K.KR)(""),taskfiltersMap:t,debounceSearchInputFunc:{},reset_pagination:(0,K.KR)(!0)}}});var ue=s(67837),pe=s(84436),me=s(93676),ge=s(67156);const ke=(0,X.A)(he,[["render",q]]),_e=ke;B()(he,"components",{QInput:ue.A,QMenu:pe.A,QSpace:me.A,QField:ge.A});var ve=s(16588);const be={class:"filter-badges row q-ml-md q-mb-sm"},fe={key:0,class:"row"},ye={key:1},we={class:"row"},Ce={key:2},Ee={class:"row"};function Fe(e,t,s,o,n,r){const l=(0,a.g2)("q-icon"),c=(0,a.g2)("q-badge");return(0,a.uX)(),(0,a.CE)("div",be,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.taskfiltersMap,(t=>((0,a.uX)(),(0,a.CE)(a.FK,{key:t},["status"==t[0]?((0,a.uX)(),(0,a.CE)("div",fe,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t[1],((s,o)=>((0,a.uX)(),(0,a.CE)("div",{key:s},[(0,a.bF)(c,{rounded:"",color:"primary",class:"q-mr-sm capitalize"},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t(s.label))+" ",1),(0,a.bF)(l,{name:"close",color:"white",class:"q-ml-xs cursor-pointer",onClick:a=>e.removeFilterForArray(s,t[0],o)},null,8,["onClick"])])),_:2},1024)])))),128))])):"keyword"==t[0]?((0,a.uX)(),(0,a.CE)("div",ye,[(0,a.Lk)("div",we,[(0,a.bF)(c,{rounded:"",color:"primary",class:"q-mr-sm capitalize"},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(t[1])+" ",1),(0,a.bF)(l,{name:"close",color:"white",class:"q-ml-xs cursor-pointer",onClick:s=>e.removeFilter(t[0])},null,8,["onClick"])])),_:2},1024)])])):"priority"==t[0]?((0,a.uX)(),(0,a.CE)("div",Ce,[(0,a.Lk)("div",Ee,[(0,a.bF)(c,{rounded:"",color:"primary",class:"q-mr-sm capitalize"},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(t[1]["value"])+" ",1),(0,a.bF)(l,{name:"close",color:"white",class:"q-ml-xs cursor-pointer",onClick:s=>e.removeFilter(t[0])},null,8,["onClick"])])),_:2},1024)])])):(0,a.Q3)("",!0)],64)))),128))])}const Se=(0,a.pM)({props:{},mounted(){this.init()},unmounted:function(){},methods:{init(){},removeFilterForArray(e,t,s){const a=this.taskfiltersMap.get(t);Array.isArray(a)&&(a.splice(s,1),0==a.length&&this.removeFilter(t)),this.setItemInFiltersMap(t,a),this.triggerApplyFilters()},removeFilter(e,t){if(this.deleteItemInFiltersMap(e),"keyword"==e){const e=new CustomEvent("delete_input_text",{detail:{}});document.dispatchEvent(e)}this.triggerApplyFilters()},triggerApplyFilters(){const e=new CustomEvent("apply_filters",{detail:{}});document.dispatchEvent(e)}},setup(){const e=(0,E.OP)(),{taskfiltersMap:t,taskListSettingsMap:s}=(0,m.bP)(e),{deleteItemInFiltersMap:a,setItemInFiltersMap:i}=e;return{deleteItemInFiltersMap:a,setItemInFiltersMap:i,taskfiltersMap:t,taskListSettingsMap:s}}});var Le=s(23954),De=s(50492);const Ae=(0,X.A)(Se,[["render",Fe]]),xe=Ae;B()(Se,"components",{QBadge:Le.A,QIcon:De.A});const Ie=(0,a.pM)({mixins:[ve.A],props:{},watch:{},components:{quickSearch:_e,filterBadges:xe,UserFilter:de},mounted:function(){},unmounted:function(){},methods:{refreshFilters(){const e=new CustomEvent("refresh_view",{detail:{show_shimmer_loader:!0}});document.dispatchEvent(e)}},setup(){const e=(0,E.OP)(),{total_records:t,list_mode:s}=(0,m.bP)(e),{changeListMode:a}=e;return{total_records:t,changeListMode:a,list_mode:s}}});var Te=s(97410);const Me=(0,X.A)(Ie,[["render",C]]),Re=Me;B()(Ie,"components",{QSpace:me.A,QTooltip:Te.A});var Pe=s(96056),qe=s(89156);const Ke={class:"full-width q-pa-md text-grey-8"},$e={key:0,class:"row"},Oe={class:"col-11"},We=["onClick"],Xe={class:"col-1"},Qe={class:"col-4"},Ue={key:0,class:"q-pr-md"},Be={class:"col-8"},je=(0,a.Lk)("div",{class:"full-width border-bottom q-mt-sm q-mb-sm"},null,-1);function ze(e,t,s,o,n,r){const l=(0,a.g2)("q-icon");return(0,a.uX)(),(0,a.CE)("div",Ke,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.tasks,((t,s)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:s},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.table_columns,((s,o)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:o},["title"===s.name?((0,a.uX)(),(0,a.CE)("div",$e,[(0,a.Lk)("div",Oe,[(0,a.Lk)("div",{class:"text-primary ellipsify",onClick:a=>{e.$emit("rowClick",s.name,t)}},(0,i.v_)(t[s.name]),9,We)]),(0,a.Lk)("div",Xe,[(0,a.bF)(l,{name:"expand_more",size:"md",id:"expand_more_"+t["id"],onClick:s=>e.expand(t["id"])},null,8,["id","onClick"]),(0,a.bF)(l,{name:"expand_less",size:"md",class:"hidden",id:"expand_less_"+t["id"],onClick:s=>e.expand(t["id"])},null,8,["id","onClick"])])])):((0,a.uX)(),(0,a.CE)("div",{key:1,class:(0,i.C4)(["row",s.hidden?" hidden mark_hidden_"+t["id"]:""])},[(0,a.Lk)("div",Qe,[s.hasOwnProperty("label")?((0,a.uX)(),(0,a.CE)("span",Ue,(0,i.v_)(e.$t(s.label)),1)):((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.eW)((0,i.v_)(e.getLabelTranslation(s.translation_key)),1)],64))]),(0,a.Lk)("div",Be,(0,i.v_)(t[s.name]?t[s.name]:"-"),1)],2))],64)))),128)),je],64)))),128))])}var Ve=s(64233);const He={title:{name:"title",translation_key:"task",sortable:!0,order:0},document_name:{name:"document_name",translation_key:"document_name",order:1},supplier_name:{name:"supplier_name",translation_key:"supplier_name",order:2},supplier_id:{name:"supplier_id",translation_key:"supplier_id",order:3},priority:{name:"priority",translation_key:"priority",sortable:!0,order:4},status:{name:"status",translation_key:"status",sortable:!0,order:5},deadline:{name:"deadline",translation_key:"deadline",sortable:!0,order:6},assigned_to:{name:"assigned_to_user",translation_key:"assigned_to",sortable:!0,order:7},created_on:{name:"created_on",translation_key:"created_on",sortable:!0,order:8}},Je={title:{name:"title",translation_key:"task",hidden:!1},document_name:{name:"document_name",translation_key:"document_name",hidden:!1},priority:{name:"priority",translation_key:"priority",hidden:!1},status:{name:"status",translation_key:"status",hidden:!1},assigned_to:{name:"assigned_to_user",translation_key:"assigned_to",hidden:!0,marked_hidden:!0},created_on:{name:"created_on",translation_key:"created_on",hidden:!0,marked_hidden:!0}};var Ge=s(92162);const Ne=(0,a.pM)({mixins:[Ve.A],props:{},data(){return{mobile_table_columns:Je}},emits:["rowClick"],mounted:function(){this.handleTableColumns()},methods:{expand(e){const t=(0,Ge.$)("#expand_more_"+e),s=(0,Ge.$)("#expand_less_"+e);t&&t.classList.toggle("hidden"),s&&s.classList.toggle("hidden"),this.displayHiddenColumns(e)},displayHiddenColumns(e){const t=document.querySelectorAll(".mark_hidden_"+e);t&&t.forEach((e=>{e.classList.toggle("hidden")}))},handleTableColumns(e=!0){try{this.table_columns=[];for(const[e,t]of Object.entries(Je))this.table_columns.push(t);this.table_columns.sort(((e,t)=>e.order-t.order))}catch(t){logError(t)}}},setup(){const e=(0,E.OP)(),{tasks:t}=(0,m.bP)(e);return{tasks:t,table_columns:(0,K.KR)([])}}}),Ye=(0,X.A)(Ne,[["render",ze]]),Ze=Ye;B()(Ne,"components",{QIcon:De.A});var et=s(18505),tt=s(64775),st=s(10739),at=s(76956),it=s(11470),ot=s(77362),nt=s(36246),rt=s(45022);const lt=e=>((0,a.Qi)("data-v-72abd66c"),e=e(),(0,a.jt)(),e),ct={key:0,class:"full-width dashboard-list-area"},dt={class:"table-header-text back-white"},ht={class:"text-red"},ut=["props","draggable","dropzone","data-index","onDragstart","onDrop","onDragover"],pt={class:"",style:{width:"91px"}},mt=["data-index"],gt={class:"table-body",style:{width:"50px"}},kt={class:"row",style:{width:"50px"}},_t=["onClick"],vt={style:{padding:"2px"},class:"dashboard-status-text"},bt={class:""},ft={class:"text-red"},yt=lt((()=>(0,a.Lk)("div",{class:"box loading-shimmer"},null,-1))),wt=[yt],Ct={key:1},Et={class:"text-center",colspan:"12"},Ft={key:1,class:"back-white flex justify-end"},St={class:"row",style:{"margin-right":"0"}};function Lt(e,t,s,o,n,r){const l=(0,a.g2)("q-checkbox"),c=(0,a.g2)("q-separator"),d=(0,a.g2)("q-item-section"),h=(0,a.g2)("q-item"),u=(0,a.g2)("q-list"),p=(0,a.g2)("q-menu"),m=(0,a.g2)("q-btn"),g=(0,a.g2)("ColumnOrderBy"),k=(0,a.g2)("q-badge"),_=(0,a.g2)("q-tooltip"),v=(0,a.g2)("q-icon"),b=(0,a.g2)("q-markup-table"),f=(0,a.g2)("q-pagination");return e.list_mode?((0,a.uX)(),(0,a.CE)("div",ct,[e.table_columns.length>0?((0,a.uX)(),(0,a.Wv)(b,{key:0,flat:"",class:(0,i.C4)(["dashboard-table-style back-white dashboard-table-height dashboard-table-header-sticky",e.tasks.length>0?"dashboard-min-height":""]),id:"tasks-table"},{default:(0,a.k6)((()=>[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",dt,[(0,a.Lk)("th",null,[(0,a.bF)(l,{modelValue:e.headerCheckbox,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.headerCheckbox=t),t[1]||(t[1]=t=>e.changeAction())],dense:""},null,8,["modelValue"]),(0,a.bF)(m,{flat:"",dense:"",round:"",onClick:t[4]||(t[4]=(0,F.D$)((()=>{}),["stop","prevent"])),icon:"more_horiz",disable:0===this.selectionList.length},{default:(0,a.k6)((()=>[(0,a.bF)(p,{"auto-close":"","transition-show":"jump-down","transition-hide":"jump-up",anchor:"bottom middle",self:"top middle"},{default:(0,a.k6)((()=>[(0,a.bF)(u,{dense:"",style:{"min-width":"100px"}},{default:(0,a.k6)((()=>[(0,a.bF)(c,{inset:""}),(0,a.bF)(h,{clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(d,{onClick:e.deleteSelection},{default:(0,a.k6)((()=>[(0,a.Lk)("span",ht,(0,i.v_)(e.$t("delete")),1)])),_:1},8,["onClick"])])),_:1}),e.canBulkMarkAsDone?((0,a.uX)(),(0,a.Wv)(h,{key:0,clickable:e.canBulkMarkAsDone},{default:(0,a.k6)((()=>[(0,a.bF)(d,{onClick:t[2]||(t[2]=t=>e.bulkUpdateStatusTasks(e.selectionList,"done"))},{default:(0,a.k6)((()=>[(0,a.Lk)("span",null,(0,i.v_)(e.$t("mark_as_done")),1)])),_:1})])),_:1},8,["clickable"])):(0,a.Q3)("",!0),e.canBulkMarkAsUnDone?((0,a.uX)(),(0,a.Wv)(h,{key:1,clickable:e.canBulkMarkAsUnDone},{default:(0,a.k6)((()=>[(0,a.bF)(d,{onClick:t[3]||(t[3]=t=>e.bulkUpdateStatusTasks(e.selectionList,"open"))},{default:(0,a.k6)((()=>[(0,a.Lk)("span",null,(0,i.v_)(e.$t("mark_as_open")),1)])),_:1})])),_:1},8,["clickable"])):(0,a.Q3)("",!0)])),_:1})])),_:1})])),_:1},8,["disable"])]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.table_columns,((s,o)=>((0,a.uX)(),(0,a.CE)("th",{key:o,class:(0,i.C4)(["documnetCol",e.indexToMove==o?"dragging":""]),props:e.props,draggable:e.canDragDropColumn(s),dropzone:e.canDragDropColumn(s),"data-index":o,direction:"horizontal",onDragstart:t=>e.onDragStart(t,e.table_columns,o),onDrop:(0,F.D$)((t=>e.handleDrop(t,o)),["prevent"]),onDragover:(0,F.D$)((t=>e.onDragOver(t,o)),["prevent"]),onDragenter:t[5]||(t[5]=(0,F.D$)(((...t)=>e.onDragEnter&&e.onDragEnter(...t)),["prevent"])),onDragleave:t[6]||(t[6]=(0,F.D$)(((...t)=>e.onDragLeave&&e.onDragLeave(...t)),["prevent"])),style:(0,i.Tr)({cursor:e.getIsDragging?"pointer":"move"})},[(0,a.Lk)("span",null,(0,i.v_)(e.$t(s.translation_key)),1),s.sortable?((0,a.uX)(),(0,a.Wv)(g,{key:0,column_name:s.name},null,8,["column_name"])):(0,a.Q3)("",!0)],46,ut)))),128)),(0,a.Lk)("th",pt,(0,i.v_)(e.$t("actions")),1)])]),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.tasks,((s,o)=>((0,a.uX)(),(0,a.CE)("tr",{key:s["id"],class:(0,i.C4)(e.setRowStyle(s)),"data-index":o},[(0,a.Lk)("td",gt,[(0,a.Lk)("div",kt,[(0,a.bF)(l,{dense:"",modelValue:s["rowSelection"],"onUpdate:modelValue":[e=>s["rowSelection"]=e,t[7]||(t[7]=e=>this.checkRowExistance())]},null,8,["modelValue","onUpdate:modelValue"])])]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.table_columns,((t,o)=>((0,a.uX)(),(0,a.CE)("td",{key:o,onClick:a=>e.rowClick(t.name,s),class:(0,i.C4)([e.getClassesForColumn(t.name),"text-weight-regular TaskCol table-body"])},["status"===t.name?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.Lk)("span",null,[(0,a.bF)(k,{align:"middle",class:(0,i.C4)(e.getStatusClass(s["status"]))},{default:(0,a.k6)((()=>[(0,a.Lk)("span",vt,(0,i.v_)(e.getLabelTranslation(s["status"])),1)])),_:2},1032,["class"])]),(0,a.bF)(_,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.getLabelTranslation(s["status"])),1)])),_:2},1024)],64)):"deadline"===t.name||"created_on"===t.name?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.eW)((0,i.v_)(s[t.name]?e.formateDate(s[t.name])+" "+e.formateDate(s[t.name],"HH:mm:ss"):"-"),1)],64)):"assigned_to_user"===t.name?((0,a.uX)(),(0,a.CE)(a.FK,{key:2},[null!=s.assigned_to_group?((0,a.uX)(),(0,a.Wv)(v,{key:0,name:"img:settings/gruppen.svg"})):(0,a.Q3)("",!0),(0,a.eW)(" "+(0,i.v_)(s[t.name]?s[t.name]:s["assigned_to_group"]?s["assigned_to_group"]:"-"),1)],64)):((0,a.uX)(),(0,a.CE)(a.FK,{key:3},[(0,a.eW)((0,i.v_)(s[t.name]?e.$t(s[t.name]):"-")+" ",1),s[t.name]?((0,a.uX)(),(0,a.Wv)(_,{key:0},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t(s[t.name])),1)])),_:2},1024)):(0,a.Q3)("",!0)],64))],10,_t)))),128)),(0,a.Lk)("td",bt,[(0,a.bF)(m,{flat:"",dense:"",round:"",onClick:t[8]||(t[8]=(0,F.D$)((()=>{}),["stop","prevent"])),icon:"more_horiz"},{default:(0,a.k6)((()=>[(0,a.bF)(p,{"auto-close":"","transition-show":"jump-down","transition-hide":"jump-up",anchor:"bottom middle",self:"top middle"},{default:(0,a.k6)((()=>[(0,a.bF)(u,{dense:"",style:{"min-width":"100px"}},{default:(0,a.k6)((()=>[(0,a.bF)(h,{clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(d,{onClick:t=>e.bulkUpdateStatusTasks([s.id],"done"==s.status?"open":"done")},{default:(0,a.k6)((()=>[(0,a.Lk)("span",null,["done"==s.status?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.eW)((0,i.v_)(e.$t("mark_as_open")),1)],64)):((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.eW)((0,i.v_)(e.$t("mark_as_done")),1)],64))])])),_:2},1032,["onClick"])])),_:2},1024),(0,a.bF)(c,{inset:""}),(0,a.bF)(h,{clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(d,{onClick:t=>e.deleteRecord(s.id)},{default:(0,a.k6)((()=>[(0,a.Lk)("span",ft,(0,i.v_)(e.$t("delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])],10,mt)))),128)),!0===e.show_table_loader?((0,a.uX)(!0),(0,a.CE)(a.FK,{key:0},(0,a.pI)(e.page_size,(t=>((0,a.uX)(),(0,a.CE)("tr",{key:t},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.table_columns.length+2,(e=>((0,a.uX)(),(0,a.CE)("td",{key:e},wt)))),128))])))),128)):0===e.tasks.length&&!1===e.processing?((0,a.uX)(),(0,a.CE)("tr",Ct,[(0,a.Lk)("td",Et,(0,i.v_)(e.$t("no_document_found")),1)])):(0,a.Q3)("",!0)])])),_:1},8,["class"])):(0,a.Q3)("",!0),e.total_pages>0?((0,a.uX)(),(0,a.CE)("div",Ft,[(0,a.Lk)("div",St,[(0,a.bF)(f,{modelValue:e.current_page,"onUpdate:modelValue":[t[9]||(t[9]=t=>e.current_page=t),t[10]||(t[10]=t=>e.nexPageClicked())],color:"primary",max:e.total_pages,class:"q-py-xs q-mx-md","max-pages":6,input:"","boundary-links":""},null,8,["modelValue","max"])])])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)}const Dt={class:"orderByParentSpan arrow-color"},At=["data-name"],xt=["data-name"];function It(e,t,s,o,n,r){return(0,a.uX)(),(0,a.CE)("span",Dt,[(0,a.Lk)("span",{class:(0,i.C4)(["up-arrow orderBy absolute",e.sort_by==e.column_name&&"asc"==e.sort_order?"selected":""]),"data-name":e.column_name,"data-direction":"asc",onClick:t[0]||(t[0]=t=>e.OrderBy(e.column_name,"asc"))},null,10,At),(0,a.Lk)("span",{class:(0,i.C4)(["down-arrow orderBy absolute",e.sort_by==e.column_name&&"desc"==e.sort_order?"selected":""]),"data-name":e.column_name,"data-direction":"desc",onClick:t[1]||(t[1]=t=>e.OrderBy(e.column_name,"desc"))},null,10,xt)])}const Tt=(0,a.pM)({mixins:[],props:{column_name:{type:String,required:!0}},components:{},watch:{},mounted:function(){},unmounted:function(){},methods:{is_order_by_selected(e){return this.sort_by==this.column_name&&this.sort_order==e},resetFilters(){let e=document.getElementsByClassName("orderBy selected");Array.from(e).forEach((e=>{e.classList.remove("selected")}))},OrderBy(e,t){logInfo("OrderBy",e,t),this.setOrderBy(e,t),this.triggerApplyFilters()},triggerApplyFilters(){const e=new CustomEvent("apply_filters",{detail:{}});document.dispatchEvent(e)}},setup(){const e=(0,E.OP)(),{sort_by:t,sort_order:s}=(0,m.bP)(e),{setOrderBy:a}=e;return{sort_by:t,sort_order:s,setOrderBy:a,order_by_field:(0,K.KR)(""),order_by_direction:(0,K.KR)("")}}}),Mt=(0,X.A)(Tt,[["render",It],["__scopeId","data-v-a1a4328a"]]),Rt=Mt;var Pt=s(21279),qt=function(e,t,s,a){function i(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,o){function n(e){try{l(a.next(e))}catch(t){o(t)}}function r(e){try{l(a["throw"](e))}catch(t){o(t)}}function l(e){e.done?s(e.value):i(e.value).then(n,r)}l((a=a.apply(e,t||[])).next())}))};const Kt=(0,a.pM)({el:"#app",mixins:[et.A,g.A,Pe.A,Ve.A,st.A],components:{ColumnOrderBy:Rt},data(){return{InvoicesClearInterval:0}},mounted(){try{this.headerCheckbox=!1,this.handleTableColumns(!0),this.getSavedListSettings(),this.initDragDropColumns("tasks-table","translation_key"),document.addEventListener("tasks-table-column-drop",this.saveSortedColumns),this.prepareStatusList()}catch(e){logError(e)}},unmounted:function(){document.removeEventListener("apply_filters",this.applyFilterEvent),document.removeEventListener("reset_filters",this.resetFilters),document.removeEventListener("refresh_view",this.refreshFilters),document.removeEventListener("tasks-table-column-drop",this.saveSortedColumns)},computed:{},watch:{headerCheckbox(){!1===this.headerCheckbox&&(this.headerFabIcon=!1)},tasks:{handler:function(e,t){this.selectionList.forEach((e=>{const t=this.tasks.find((t=>t.id===e));t&&(t.rowSelection=!0)}))}},websocketHasError:{handler:function(e,t){1==e&&(this.use_websocket=!1)}}},methods:{getStatusClass(e){let t="bg-grey";const s=this.statusList.hasOwnProperty(e);return s&&(t=this.statusList[e]["class"]),t+=" dashboard-status-badge",t},prepareStatusList(){this.statusList["open"]=[],this.statusList["open"]["value"]="open",this.statusList["open"]["class"]="bg-blue-14",this.statusList["in_progress"]=[],this.statusList["in_progress"]["value"]="in_progress",this.statusList["in_progress"]["class"]="bg-amber-7",this.statusList["done"]=[],this.statusList["done"]["value"]="done",this.statusList["done"]["class"]="bg-light-green-6",this.statusList["rejected"]=[],this.statusList["rejected"]["value"]="rejected",this.statusList["rejected"]["class"]="bg-red-13"},saveSortedColumns(e){const t={};this.table_columns.forEach(((e,s)=>{t[e.name]={name:e.name,order:s,sortable:!!e.sortable,translation_key:e.translation_key}})),this.saveTaskColumns(t)},deleteSelection(){this.bulkDeleteRecords(this.selectionList);const e=new CustomEvent("refresh_view",{});document.dispatchEvent(e)},bulkUpdateStatusTasks(e,t){return qt(this,void 0,void 0,(function*(){try{this.processing=!0;const s=yield it.Hg.bulkUpdateStatusTasks(e,t);if(!1===s.success)throw s;const a=new CustomEvent("refreshTasks",{});document.dispatchEvent(a),e.forEach((e=>{const s=this.tasks.find((t=>t.id===e));s&&(s.status=t,s.rowSelection=!1)})),this.selectionList=[],this.showSuccessToast(this.$t("status_updated_successfully"))}catch(s){const e=tt.t.getErrorMessage(s);this.showErrorToast(e),logError(s)}finally{this.processing=!1}}))},formatTaskDate(e,t){const s=nt.Ay.formatDate(e,t);return s},formateDate(e,t=""){return this.isDate(e)?(t||(t=Pt.v.getFormat(this.getDocDateFormat())),nt.Ay.formatDate(e,t)):e},handleTableColumns(e=!0){try{let e=He,t=this.user_settings[this.columnKey];Object.keys(this.user_settings).length||(t=rt.A.getItem(this.columnKey)),t&&(t=JSON.parse(t)),t&&Object.keys(t).length==Object.keys(e).length&&(e=t),rt.A.set(this.columnKey,JSON.stringify(e)),this.processing=!0,this.table_columns=[];for(const[s,a]of Object.entries(e))this.table_columns.push(a);this.table_columns.sort(((e,t)=>e.order-t.order))}catch(t){logError(t)}finally{e&&(this.processing=!1)}},refreshFilters(e){this.tasks=[],this.selectionList=[],this.headerCheckbox=!1,this.fetchData()},fetchData(e=!0){return qt(this,void 0,void 0,(function*(){try{e&&(this.processing=!0,this.show_table_loader=!0),this.selectionList=[],this.headerCheckbox=!1;const t=this.getSavedFiltersAsJson();this.list_mode||(t["limit"]=100),t["document_fields"]="supplier_name,supplier_id",t["cache"]=!1;const s=yield this.getSubOrgId();if(s&&(t["sub_org_id"]=s),this.use_websocket){let e=yield this.getWebSocketDashboard();return void(1!=e&&setTimeout(this.handleWebsocketDelay,5e3))}yield this.getTasks(t),this.updateTableData(),setTimeout(this.turnOnWebSocket,5e3)}catch(t){const e=tt.t.getErrorMessage(t);this.showErrorToast(e),logError(t)}finally{this.processing=!1}}))},handleWebsocketDelay(){"received"!==this.data_status&&(logInfo("turning off websocket and switching to https",this.data_status),this.use_websocket=!1,this.fetchData(),setTimeout(this.turnOnWebSocket,5e3))},turnOnWebSocket(){this.websocketHasError||(this.use_websocket=!1)},updateTableData(){this.setPagination(),this.applyCustomFormatOnRows(),this.show_table_loader=!1,this.processing=!1},setPagination(){this.total_records>0&&this.setTotalPages()},resetPagination(){this.total_pages=0,this.current_page=1,this.total_records=0,this.offset=0},setTotalPages(){this.total_pages=Math.ceil(this.total_records/this.page_size)},calculateOffset(){this.offset=this.page_size*(this.current_page-1)},nexPageClicked(){this.calculateOffset(),this.fetchData()},applyCustomFormatOnRows(){this.tasks.forEach((e=>{e["fabAction"]=!1,e["rowSelection"]=!1;const{formatted_deadline:t}=this.getDisplayDeadline(e["deadline"]);e["deadline"]=t}))},bulkDeleteRecords(e){return qt(this,void 0,void 0,(function*(){try{this.processing=!0;const t=yield it.Hg.bulkDeleteTasks(e);if(!1===t.success)throw t;yield this.fetchData()}catch(t){const e=tt.t.getErrorMessage(t);this.showErrorToast(e),logError(t)}finally{this.processing=!1;const e=new CustomEvent("refresh_view",{});document.dispatchEvent(e)}}))},deleteRecord(e){return qt(this,void 0,void 0,(function*(){try{this.processing=!0;const t=yield it.Hg.deleteTask(e);if(!1===t.success)throw t;yield this.fetchData()}catch(t){const e=tt.t.getErrorMessage(t);this.showErrorToast(e),logError(t)}finally{this.processing=!1;const e=new CustomEvent("refresh_view",{});document.dispatchEvent(e)}}))},rowClick(e,t){if("title"!==e){if("document_name"===e&&t["document_id"]){let e=t["document_status"];return"validated_pending_approval"===e?void this.toPendingApprovalScreen(t):"approved_pending_second_approval"===e?void this.toPendingSecondApprovalScreen(t):"rejected"===e?void this.toRejectedScreen(t["document_id"]):"in_review"===e?void this.toInReviewScreen(t["document_id"],t):this.isStatusError(e)?void this.toDocumentErrorView(t):void this.$router.push("/field_validation_v1/"+t["document_id"])}}else this.$router.push("/task/"+t["id"])},isStatusError(e){return"error"===e||"export_error"===e},toPendingApprovalScreen(e){return this.model[at.WE]?void this.$router.push("/ready_for_approval_v3/"+e["document_id"]):void this.$router.push("/ready-for-approval-v2/"+e["document_id"])},toPendingSecondApprovalScreen(e){this.$router.push("/ready-for-second-approval-v2/"+e["document_id"])},toRejectedScreen(e){this.$router.push("/rejected/"+e)},toInReviewScreen(e,t){this.$router.push("/in_review/"+e)},toDocumentErrorView(e){this.$router.push("/document_error/"+e["id"])},getClassesForColumn(e){let t=" cursor-pointer ";const s=["document_name","title"];return t+=s.includes(e)?" text-primary ":"",t},changeAction(){!0===this.headerCheckbox?this.selectAllRows():this.resetAllSelectedRows(),this.checkRowExistance()},selectAllRows(){this.selectionList=[],this.tasks.forEach((e=>{e["rowSelection"]=!0,this.selectionList.push(e.id)}))},resetAllSelectedRows(){this.selectionList=[],this.headerCheckbox=!1,this.tasks.forEach((e=>{e["rowSelection"]=!1}))},checkRowExistance(){let e=0;this.selectionList=[],this.headerCheckbox=!1,this.is_any_checked=!1,this.canBulkMarkAsDone=!0,this.canBulkMarkAsUnDone=!0,this.tasks.forEach((t=>{!0===t["rowSelection"]&&(this.is_any_checked=!0,e++,this.selectionList.push(t.id),"done"===t.status&&(this.canBulkMarkAsDone=!1),"open"===t.status&&(this.canBulkMarkAsUnDone=!1))})),0===e?this.headerCheckbox=!1:this.tasks.length===e?this.headerCheckbox=!0:this.headerCheckbox=!1},setRowStyle(e){if(e.hasOwnProperty("export_data_fetched")&&!0===e["export_data_fetched"])return"exported-row"},deleteMultipalDocument(){return qt(this,void 0,void 0,(function*(){if(!this.selectionList)return;let e;this.processing=!0;try{let t=new Map;if(t.set("doc_ids",this.selectionList.join(",")),e=yield it.v1.deleteRequest(p.FH.delete_documents,t),!1===e.success)return void this.showErrorToast(e.data.message);this.headerCheckbox=!1,this.resetAllSelectedRows(),this.fetchData()}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(t)}finally{this.processing=!1;const e=new CustomEvent("refresh_view",{});document.dispatchEvent(e)}}))},handleWebSocketResult(e){e&&(this.use_websocket=!0,this.updateTableData())},getWebSocketDashboard(){return qt(this,void 0,void 0,(function*(){try{const e={type:"dashboard",data:{}};let t=this.queryParams;t=t.replace("?","");const s=t.split("&");s.forEach((t=>{t=t.split("="),2===t.length&&(e.data[t[0]]=t[1])})),this.data_status="fetching";yield this.sendMessageToSocket(e.type,e.data);return this.updateTableData(),this.processing=!1,!0}catch(e){this.handleWebsocketDelay()}}))}},setup(){const e=(0,E.G6)(),{dashboard_data:t,isConnected:s,hasError:a}=(0,m.bP)(e),i=(0,E.kH)(),{sub_org_id:o}=(0,m.bP)(i),{getSubOrgId:n}=i,r=(0,E.Bu)(),{user_settings:l}=(0,m.bP)(r),{subscribeToChannel:c,unsubscribeToChannel:d,sendMessageByType:h}=e,u=(0,E.OP)(),{tasks:p,total_records:g,data_fetched:k,list_mode:_,offset:v,page_size:b,taskListSettingsMap:f,processing:y,columnKey:w}=(0,m.bP)(u),{getTasks:C,getSavedListSettings:F,getSavedFiltersAsJson:S,setDefaultSettings:L,getDisplayDeadline:D,saveTaskColumns:A}=u,x=(0,E.wt)(),{getDocTypeSettings:I}=x,{model:T}=(0,m.bP)(x);return{taskListSettingsMap:f,user_settings:l,columnKey:w,getTasks:C,list_mode:_,tasks:p,total_records:g,current_page:(0,K.KR)(1),total_pages:(0,K.KR)(0),sub_org_id:o,offset:v,page_size:b,processing:y,getSubOrgId:n,getSavedListSettings:F,getSavedFiltersAsJson:S,setDefaultSettings:L,getDisplayDeadline:D,canBulkMarkAsDone:(0,K.KR)(!1),websocketHasError:a,sendMessageToSocket:h,isConnected:s,unsubscribeToChannel:d,subscribeToChannel:c,dashboard_data:t,table_columns:(0,K.KR)([]),queryParams:"",model:T,recordId:"",headerCheckbox:(0,K.KR)(!1),is_any_checked:(0,K.KR)(!1),headerFabIcon:(0,K.KR)(!1),selectionList:(0,K.KR)([]),canBulkMarkAsUnDone:(0,K.KR)(!1),use_websocket:(0,K.KR)(!1),show_table_loader:(0,K.KR)(!1),data_status:(0,K.KR)(""),saveTaskColumns:A,statusList:(0,K.KR)([]),getDocTypeSettings:I}}});var $t=s(857),Ot=s(56384),Wt=s(53999),Xt=s(10386),Qt=s(54700),Ut=s(42315);const Bt=(0,X.A)(Kt,[["render",Lt],["__scopeId","data-v-72abd66c"]]),jt=Bt;B()(Kt,"components",{QMarkupTable:$t.A,QCheckbox:Z.A,QBtn:Ot.A,QMenu:pe.A,QList:Wt.A,QSeparator:Xt.A,QItem:N.A,QItemSection:Y.A,QBadge:Le.A,QTooltip:Te.A,QIcon:De.A,QPagination:Qt.A,QTable:Ut.A});const zt={class:"full-width dashboard-list-area"},Vt={class:""},Ht={class:"row q-gutter-md"},Jt={class:"text-weight-bold text-lg q-mt-sm q-pb-md"};function Gt(e,t,s,o,n,r){const l=(0,a.g2)("task-card"),c=(0,a.g2)("draggable");return(0,a.uX)(),(0,a.CE)("div",zt,[(0,a.Lk)("div",Vt,[(0,a.Lk)("div",Ht,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.columns,(t=>((0,a.uX)(),(0,a.CE)("div",{key:t.title,class:"highlighted-back rounded-lg px-3 py-3 column-width rounded"},[(0,a.Lk)("p",Jt,(0,i.v_)(e.$t(t.title)),1),(0,a.bF)(c,{onChange:e.dragEnd,list:t.tasks,animation:200,"ghost-class":"ghost-card",group:"tasks",class:"task-board-height"},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.tasks,(t=>((0,a.uX)(),(0,a.Wv)(l,{onDeleteRecord:e.deleteRecord,onDocumentClick:e.documentClick,onCardClick:e.rowClick,onUpdateStatusTaskClick:e.updateStatusTaskClick,key:t.id,task:t,class:"q-mt-sm cursor-move"},null,8,["onDeleteRecord","onDocumentClick","onCardClick","onUpdateStatusTaskClick","task"])))),128))])),_:2},1032,["onChange","list"])])))),128))])])])}var Nt=s(39231);const Yt={class:"row justify-between"},Zt={class:"task-description text-weight-medium task-title"},es={class:"user-item-initials initials-text-color"},ts={class:"q-mt-sm full-width no-paragraph-space"},ss={key:0,class:"text-sm task-description"},as={class:"row mt-4 justify-between items-center"},is={class:"text-sm"},os={class:"hidden-child no-padding"},ns={class:"text-red"};function rs(e,t,s,o,n,r){const l=(0,a.g2)("q-tooltip"),c=(0,a.g2)("q-icon"),d=(0,a.g2)("q-avatar"),h=(0,a.g2)("q-item-section"),u=(0,a.g2)("q-item"),p=(0,a.g2)("q-separator"),m=(0,a.g2)("q-list"),g=(0,a.g2)("q-menu"),k=(0,a.g2)("q-btn");return(0,a.uX)(),(0,a.CE)("div",{class:"task-card back-white shadow-1 rounded px-3 pt-3 pb-3 gray-border border-white",onClick:t[4]||(t[4]=(...e)=>r.clickCard&&r.clickCard(...e))},[(0,a.Lk)("div",Yt,[(0,a.Lk)("span",Zt,(0,i.v_)(s.task.title),1),(0,a.Lk)("div",null,[s.task.status?((0,a.uX)(),(0,a.Wv)(c,{key:0,class:"on-left",name:"img:images/"+r.priorityIcon,size:"sm"},{default:(0,a.k6)((()=>[(0,a.bF)(l,{anchor:"top middle",self:"bottom middle"},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t(s.task.priority)),1)])),_:1})])),_:1},8,["name"])):(0,a.Q3)("",!0),s.task.assigned_to_user?((0,a.uX)(),(0,a.Wv)(d,{key:1,size:"24px",class:"user-avatar-background"},{default:(0,a.k6)((()=>[(0,a.Lk)("span",es,(0,i.v_)(r.getInitials(s.task.assigned_to_user)),1),(0,a.bF)(l,{anchor:"top middle",self:"bottom middle"},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(s.task.assigned_to_user),1)])),_:1})])),_:1})):s.task.assigned_to_group?((0,a.uX)(),(0,a.Wv)(d,{key:2,size:"24px",class:"user-avatar-background"},{default:(0,a.k6)((()=>[(0,a.bF)(c,{name:"group",class:"text-white"}),(0,a.bF)(l,{anchor:"top middle",self:"bottom middle"},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(s.task.assigned_to_group),1)])),_:1})])),_:1})):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",ts,[(0,a.Lk)("p",{class:"text-sm link task-document-link",onClick:[t[0]||(t[0]=(...e)=>r.clickDocument&&r.clickDocument(...e)),t[1]||(t[1]=(0,F.D$)((()=>{}),["stop","prevent"]))]},[(0,a.bF)(c,{name:"description",class:"q-mr-xs"}),(0,a.eW)(" "+(0,i.v_)(s.task.document_name)+" ",1),(0,a.bF)(l,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.$t("open_document")),1)])),_:1})]),s.task.description?((0,a.uX)(),(0,a.CE)("span",ss,(0,i.v_)(s.task.description),1)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",as,[(0,a.Lk)("span",is,(0,i.v_)(e.formatDateAccordingToPreference(s.task.created_on)),1),(0,a.Lk)("div",os,[(0,a.bF)(k,{flat:"",dense:"",round:"",onClick:t[3]||(t[3]=(0,F.D$)((()=>{}),["stop","prevent"])),icon:"more_horiz",size:"12px"},{default:(0,a.k6)((()=>[(0,a.bF)(g,{"auto-close":"","transition-show":"jump-down","transition-hide":"jump-up",anchor:"bottom middle",self:"top middle"},{default:(0,a.k6)((()=>[(0,a.bF)(m,{dense:"",style:{"min-width":"100px"}},{default:(0,a.k6)((()=>[(0,a.bF)(u,{clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(h,{onClick:r.clickUpdateStatus},{default:(0,a.k6)((()=>[(0,a.Lk)("span",null,["done"==s.task.status?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.eW)((0,i.v_)(e.$t("mark_as_open")),1)],64)):((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.eW)((0,i.v_)(e.$t("mark_as_done")),1)],64))])])),_:1},8,["onClick"])])),_:1}),(0,a.bF)(p,{inset:""}),(0,a.bF)(u,{clickable:""},{default:(0,a.k6)((()=>[(0,a.bF)(h,{onClick:t[2]||(t[2]=e=>r.clickRemove(s.task.id))},{default:(0,a.k6)((()=>[(0,a.Lk)("span",ns,(0,i.v_)(e.$t("delete")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])])])}var ls=s(46736);const cs={mixins:[ls.A],components:{},props:{task:{type:Object,default:()=>({})}},emits:["cardClick","documentClick","deleteRecord","updateStatusTaskClick"],methods:{getInitials(e){var t=e.split(" "),s=t[0].substring(0,1).toUpperCase();return t.length>1&&(s+=t[t.length-1].substring(0,1).toUpperCase()),s},clickCard(){this.$emit("cardClick",this.task)},clickDocument(){this.$emit("documentClick",this.task)},clickRemove(){this.$emit("deleteRecord",this.task.id)},clickUpdateStatus(){let e;e="done"==this.task.status?"open":"done",this.$emit("updateStatusTaskClick",[this.task.id],e)}},computed:{priorityIcon(){const e={medium:"priority_medium.svg",high:"priority_high.svg",low:"priority_low.svg"};return e[this.task.priority]||e.default}}};var ds=s(3952);const hs=(0,X.A)(cs,[["render",rs]]),us=hs;B()(cs,"components",{QIcon:De.A,QTooltip:Te.A,QAvatar:ds.A,QBtn:Ot.A,QMenu:pe.A,QList:Wt.A,QItem:N.A,QItemSection:Y.A,QSeparator:Xt.A});var ps=function(e,t,s,a){function i(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,o){function n(e){try{l(a.next(e))}catch(t){o(t)}}function r(e){try{l(a["throw"](e))}catch(t){o(t)}}function l(e){e.done?s(e.value):i(e.value).then(n,r)}l((a=a.apply(e,t||[])).next())}))};const ms=(0,a.pM)({el:"#app",mixins:[et.A,g.A,Pe.A,Ve.A,st.A],components:{draggable:Nt.H,TaskCard:us},data(){return{InvoicesClearInterval:0,debounceSearchInputFunc:{}}},beforeRouteLeave:function(e,t,s){this.intervalManager(!1),this.unsubscribeToChannel("dashboard"),s()},mounted(){try{this.showLoading(),this.debounceSearchInputFunc=(0,$.A)((()=>{this.applyFilter()}),1e3),this.prepareStatusList()}catch(e){logError(e)}finally{this.hideLoading()}},computed:{},watch:{headerCheckbox(){!1===this.headerCheckbox&&(this.headerFabIcon=!1)},tasks:{handler:function(e,t){this.selectionList.forEach((e=>{const t=this.tasks.find((t=>t.id===e));t&&(t.rowSelection=!0)}))}},processing:{handler:function(e,t){1==e?this.showLoading():this.hideLoading()}},websocketHasError:{handler:function(e,t){1==e&&(this.use_websocket=!1)}}},methods:{dragEnd(e,t){if(!e.added)return;const s=e.added.element.id,a=e.added.element;let i="";this.columns.forEach((e=>{e.tasks.forEach((t=>{t.id===s&&(i=e.title)}))})),this.updateTaskStatus(a,i)},updateTaskStatus(e,t){return ps(this,void 0,void 0,(function*(){try{if(logInfo("What do you have again? ",e),!e)return;e.status=t;const s=yield it.Hg.editTask(e.id,e);if(!1===s.success)throw s;const a=new CustomEvent("refresh_view",{detail:{show_shimmer_loader:!0}});document.dispatchEvent(a),this.showSuccessToast(this.$t("status_updated_successfully"))}catch(s){const e=tt.t.getErrorMessage(s);this.showErrorToast(e),logError(s)}}))},getStatusClass(e){let t="bg-grey";const s=this.statusList.hasOwnProperty(e);return s&&(t=this.statusList[e]["class"]),t+=" dashboard-status-badge",t},prepareStatusList(){this.statusList["open"]=[],this.statusList["open"]["value"]="open",this.statusList["open"]["class"]="bg-blue-14",this.statusList["in_progress"]=[],this.statusList["in_progress"]["value"]="in_progress",this.statusList["in_progress"]["class"]="bg-amber-7",this.statusList["done"]=[],this.statusList["done"]["value"]="done",this.statusList["done"]["class"]="bg-light-green-6",this.statusList["rejected"]=[],this.statusList["rejected"]["value"]="rejected",this.statusList["rejected"]["class"]="bg-red-13"},saveSortedColumns(e){const t={};this.table_columns.forEach(((e,s)=>{t[e.name]={name:e.name,order:s,sortable:!!e.sortable,translation_key:e.translation_key}})),this.saveTaskColumns(t)},deleteSelection(){this.bulkDeleteRecords(this.selectionList);const e=new CustomEvent("refresh_view",{});document.dispatchEvent(e)},bulkUpdateStatusTasks(e,t){return ps(this,void 0,void 0,(function*(){try{this.processing=!0;const s=yield it.Hg.bulkUpdateStatusTasks(e,t);if(!1===s.success)throw s;const a=new CustomEvent("refreshTasks",{});document.dispatchEvent(a),e.forEach((e=>{const s=this.tasks.find((t=>t.id===e));s&&(s.status=t,s.rowSelection=!1)})),this.selectionList=[],this.showSuccessToast(this.$t("status_updated_successfully"))}catch(s){const e=tt.t.getErrorMessage(s);this.showErrorToast(e),logError(s)}finally{this.processing=!1;const e=new CustomEvent("refresh_view",{});document.dispatchEvent(e)}}))},formatTaskDate(e,t){const s=nt.Ay.formatDate(e,t);return s},formateDate(e,t=""){return this.isDate(e)?(t||(t=Pt.v.getFormat(this.getDocDateFormat())),nt.Ay.formatDate(e,t)):e},applyFilterEvent(e){this.resetPagination(),this.applyFilter()},intervalManager(e){clearInterval(this.InvoicesClearInterval),!0===e&&(this.InvoicesClearInterval=setInterval((()=>{this.is_any_checked||this.fetchData(!1)}),6e4))},handleActions(e){return this.tasks.forEach(((t,s)=>{s!==e&&(t["fabAction"]=!1)})),!0},resetPages(){this.resetPagination(),this.fetchData()},applyFilter(){this.processing=!0,this.resetAllSelectedRows(),this.fetchData()},refreshFilters(e){this.tasks=[],this.selectionList=[],this.headerCheckbox=!1,this.fetchData()},fetchData(e=!0){return ps(this,void 0,void 0,(function*(){try{e&&(this.processing=!0,this.show_table_loader=!0),this.selectionList=[],this.headerCheckbox=!1;const t=this.getSavedFiltersAsJson();if(this.list_mode||(t["limit"]=100),t["document_fields"]="supplier_name,supplier_id",t["cache"]=!1,this.use_websocket){let e=yield this.getWebSocketDashboard();return void(1!=e&&setTimeout((()=>{this.handleWebsocketDelay}),5e3))}yield this.getTasks(t),this.formatTaskList(),setTimeout((()=>{this.turnOnWebSocket}),5e3)}catch(t){const e=tt.t.getErrorMessage(t);this.showErrorToast(e),logError(t)}finally{this.processing=!1}}))},handleWebsocketDelay(){"received"!==this.data_status&&(logInfo("turning off websocket and switching to https",this.data_status),this.use_websocket=!1,this.fetchData(),setTimeout((()=>{this.turnOnWebSocket}),5e3))},turnOnWebSocket(){this.websocketHasError||(this.use_websocket=!1)},updateTableData(){this.setPagination(),this.applyCustomFormatOnRows(),this.show_table_loader=!1,this.processing=!1},setPagination(){this.total_records>0&&this.setTotalPages()},resetPagination(){this.total_pages=0,this.current_page=1,this.total_records=0,this.offset=0},setTotalPages(){this.total_pages=Math.ceil(this.total_records/this.page_size)},calculateOffset(){this.offset=this.page_size*(this.current_page-1)},nexPageClicked(){this.calculateOffset(),this.fetchData()},applyCustomFormatOnRows(){this.tasks.forEach((e=>{e["fabAction"]=!1,e["rowSelection"]=!1;const{formatted_deadline:t}=this.getDisplayDeadline(e["deadline"]);e["deadline"]=t}))},loadData(){this.resetPagination(),this.applyFilter()},bulkDeleteRecords(e){return ps(this,void 0,void 0,(function*(){try{this.processing=!0;const t=yield it.Hg.bulkDeleteTasks(e);if(!1===t.success)throw t;yield this.fetchData()}catch(t){const e=tt.t.getErrorMessage(t);this.showErrorToast(e),logError(t)}finally{this.processing=!1;const e=new CustomEvent("refresh_view",{});document.dispatchEvent(e)}}))},deleteRecord(e){return ps(this,void 0,void 0,(function*(){try{this.processing=!0;const t=yield it.Hg.deleteTask(e);if(!1===t.success)throw t;yield this.fetchData()}catch(t){const e=tt.t.getErrorMessage(t);this.showErrorToast(e),logError(t)}finally{this.processing=!1;const e=new CustomEvent("refresh_view",{});document.dispatchEvent(e)}}))},rowClick(e){this.$router.push("/task/"+e["id"])},updateStatusTaskClick(e,t){return ps(this,void 0,void 0,(function*(){yield this.bulkUpdateStatusTasks(e,t)}))},documentClick(e){let t=e["document_status"];if("validated_pending_approval"===t)return void this.toPendingApprovalScreen(e);if("approved_pending_second_approval"===t)return void this.toPendingSecondApprovalScreen(e);if("rejected"===t)return void this.toRejectedScreen(e["document_id"]);if("in_review"===t)return void this.toInReviewScreen(e["document_id"],e);if(this.isStatusError(t))return void this.toDocumentErrorView(e);let s=this.$router.resolve({path:"/field_validation_v1/"+e["document_id"]});window.open(s.href,"_blank")},isStatusError(e){return"error"===e||"export_error"===e},toPendingApprovalScreen(e){if(this.model[at.WE]){let t=this.$router.resolve({path:"/ready_for_approval_v3/"+e["document_id"]});window.open(t.href,"_blank")}else{let t=this.$router.resolve({path:"/ready-for-approval-v2/"+e["document_id"]});window.open(t.href,"_blank")}},toPendingSecondApprovalScreen(e){let t=this.$router.resolve({path:"/ready-for-second-approval-v2/"+e["document_id"]});window.open(t.href,"_blank")},toRejectedScreen(e){let t=this.$router.resolve({path:"/rejected/"+e});window.open(t.href,"_blank")},toInReviewScreen(e,t){let s=this.$router.resolve({path:"/in_review/"+e});window.open(s.href,"_blank")},toDocumentErrorView(e){let t=this.$router.resolve({path:"/document_error/"+e["id"]});window.open(t.href,"_blank")},getClassesForColumn(e){let t=" cursor-pointer ";const s=["document_name","title"];return t+=s.includes(e)?" text-primary ":"",t},resetFilters(){this.resetPagination(),this.setDefaultSettings(),this.applyFilter()},changeAction(){!0===this.headerCheckbox?this.selectAllRows():this.resetAllSelectedRows(),this.checkRowExistance()},selectAllRows(){this.selectionList=[],this.tasks.forEach((e=>{e["rowSelection"]=!0,this.selectionList.push(e.id)}))},resetAllSelectedRows(){this.selectionList=[],this.headerCheckbox=!1,this.tasks.forEach((e=>{e["rowSelection"]=!1}))},checkRowExistance(){let e=0;this.selectionList=[],this.headerCheckbox=!1,this.is_any_checked=!1,this.canBulkMarkAsDone=!0,this.canBulkMarkAsUnDone=!0,this.tasks.forEach((t=>{!0===t["rowSelection"]&&(this.is_any_checked=!0,e++,this.selectionList.push(t.id),"done"===t.status&&(this.canBulkMarkAsDone=!1),"open"===t.status&&(this.canBulkMarkAsUnDone=!1))})),0===e?this.headerCheckbox=!1:this.tasks.length===e?this.headerCheckbox=!0:this.headerCheckbox=!1},setRowStyle(e){if(e.hasOwnProperty("export_data_fetched")&&!0===e["export_data_fetched"])return"exported-row"},deleteMultipalDocument(){return ps(this,void 0,void 0,(function*(){if(!this.selectionList)return;let e;this.processing=!0;try{let t=new Map;if(t.set("doc_ids",this.selectionList.join(",")),e=yield it.v1.deleteRequest(p.FH.delete_documents,t),!1===e.success)return void this.showErrorToast(e.data.message);this.headerCheckbox=!1,this.resetAllSelectedRows(),this.loadData()}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(t)}finally{this.processing=!1;const e=new CustomEvent("refresh_view",{});document.dispatchEvent(e)}}))},removeQuickFilter(e){this.taskListSettingsMap.delete(e),this.applyFilter()},handleWebSocketResult(e){e&&(this.use_websocket=!0,this.updateTableData())},getWebSocketDashboard(){return ps(this,void 0,void 0,(function*(){try{const e={type:"dashboard",data:{}};let t=this.queryParams;t=t.replace("?","");const s=t.split("&");s.forEach((t=>{t=t.split("="),2===t.length&&(e.data[t[0]]=t[1])})),this.data_status="fetching";yield this.sendMessageToSocket(e.type,e.data);return this.updateTableData(),this.processing=!1,!0}catch(e){this.handleWebsocketDelay()}}))}},setup(){const e=(0,E.G6)(),{dashboard_data:t,isConnected:s,hasError:a}=(0,m.bP)(e),i=(0,E.Bu)(),{user_settings:o}=(0,m.bP)(i),{subscribeToChannel:n,unsubscribeToChannel:r,sendMessageByType:l}=e,c=(0,E.OP)(),{tasks:d,total_records:h,columns:u,data_fetched:p,offset:g,page_size:k,taskListSettingsMap:_,processing:v,columnKey:b}=(0,m.bP)(c),{getTasks:f,formatTaskList:y,getSavedListSettings:w,getSavedFiltersAsJson:C,setDefaultSettings:F,getDisplayDeadline:S,saveTaskColumns:L}=c,D=(0,E.wt)(),{getDocTypeSettings:A}=D,{model:x}=(0,m.bP)(D);return{taskListSettingsMap:_,user_settings:o,columnKey:b,getTasks:f,formatTaskList:y,tasks:d,columns:u,total_records:h,current_page:(0,K.KR)(1),total_pages:(0,K.KR)(0),offset:g,page_size:k,processing:v,getSavedListSettings:w,getSavedFiltersAsJson:C,setDefaultSettings:F,getDisplayDeadline:S,canBulkMarkAsDone:(0,K.KR)(!1),websocketHasError:a,sendMessageToSocket:l,isConnected:s,unsubscribeToChannel:r,subscribeToChannel:n,dashboard_data:t,table_columns:(0,K.KR)([]),queryParams:"",model:x,recordId:"",headerCheckbox:(0,K.KR)(!1),is_any_checked:(0,K.KR)(!1),headerFabIcon:(0,K.KR)(!1),selectionList:(0,K.KR)([]),canBulkMarkAsUnDone:(0,K.KR)(!1),use_websocket:(0,K.KR)(!1),show_table_loader:(0,K.KR)(!1),data_status:(0,K.KR)(""),saveTaskColumns:L,statusList:(0,K.KR)([]),getDocTypeSettings:A}}}),gs=(0,X.A)(ms,[["render",Gt],["__scopeId","data-v-56f4f040"]]),ks=gs;B()(ms,"components",{QTable:Ut.A});var _s=function(e,t,s,a){function i(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,o){function n(e){try{l(a.next(e))}catch(t){o(t)}}function r(e){try{l(a["throw"](e))}catch(t){o(t)}}function l(e){e.done?s(e.value):i(e.value).then(n,r)}l((a=a.apply(e,t||[])).next())}))};const vs=(0,a.pM)({el:"#app",mixins:[et.A,g.A,Pe.A,Ve.A,st.A],components:{Header:Re,List:jt,MobileGrid:Ze,SubHeader:ot.A,Loader:qe.A,TaskBoard:ks},data(){return{InvoicesClearInterval:0,debounceSearchInputFunc:{}}},beforeRouteLeave:function(e,t,s){this.intervalManager(!1),this.unsubscribeToChannel("dashboard"),s()},mounted(){try{window.dash=this,this.headerCheckbox=!1,this.loadData(),this.intervalManager(!0),this.getDocTypeSettings(),this.handleTableColumns,document.addEventListener("apply_filters",this.applyFilterEvent),document.addEventListener("reset_filters",this.resetFilters),document.addEventListener("refresh_view",this.refreshFilters),this.debounceSearchInputFunc=(0,$.A)((()=>{this.applyFilter()}),1e3),document.addEventListener("tasks-table-column-drop",this.saveSortedColumns),this.prepareStatusList()}catch(e){logError(e)}},unmounted:function(){document.removeEventListener("apply_filters",this.applyFilterEvent),document.removeEventListener("reset_filters",this.resetFilters),document.removeEventListener("refresh_view",this.refreshFilters),document.removeEventListener("tasks-table-column-drop",this.saveSortedColumns)},computed:{},watch:{headerCheckbox(){!1===this.headerCheckbox&&(this.headerFabIcon=!1)},tasks:{handler:function(e,t){this.selectionList.forEach((e=>{const t=this.tasks.find((t=>t.id===e));t&&(t.rowSelection=!0)}))}},processing:{handler:function(e,t){1==e?this.showLoading():this.hideLoading()}},websocketHasError:{handler:function(e,t){1==e&&(this.use_websocket=!1)}}},methods:{getStatusClass(e){let t="bg-grey";const s=this.statusList.hasOwnProperty(e);return s&&(t=this.statusList[e]["class"]),t+=" dashboard-status-badge",t},prepareStatusList(){this.statusList["open"]=[],this.statusList["open"]["value"]="open",this.statusList["open"]["class"]="bg-blue-14",this.statusList["in_progress"]=[],this.statusList["in_progress"]["value"]="in_progress",this.statusList["in_progress"]["class"]="bg-amber-7",this.statusList["done"]=[],this.statusList["done"]["value"]="done",this.statusList["done"]["class"]="bg-light-green-6",this.statusList["rejected"]=[],this.statusList["rejected"]["value"]="rejected",this.statusList["rejected"]["class"]="bg-red-13"},saveSortedColumns(e){const t={};this.table_columns.forEach(((e,s)=>{t[e.name]={name:e.name,order:s,sortable:!!e.sortable,translation_key:e.translation_key}})),this.saveTaskColumns(t)},deleteSelection(){this.bulkDeleteRecords(this.selectionList);const e=new CustomEvent("refresh_view",{});document.dispatchEvent(e)},bulkUpdateStatusTasks(e,t){return _s(this,void 0,void 0,(function*(){try{this.processing=!0;const s=yield it.Hg.bulkUpdateStatusTasks(e,t);if(!1===s.success)throw s;const a=new CustomEvent("refreshTasks",{});document.dispatchEvent(a),e.forEach((e=>{const s=this.tasks.find((t=>t.id===e));s&&(s.status=t,s.rowSelection=!1)})),this.selectionList=[],this.showSuccessToast(this.$t("status_updated_successfully"))}catch(s){const e=tt.t.getErrorMessage(s);this.showErrorToast(e),logError(s)}finally{this.processing=!1}}))},formatTaskDate(e,t){const s=nt.Ay.formatDate(e,t);return s},formateDate(e,t=""){return this.isDate(e)?(t||(t=Pt.v.getFormat(this.getDocDateFormat())),nt.Ay.formatDate(e,t)):e},applyFilterEvent(e){this.resetPagination(),this.applyFilter()},handleTableColumns(e=!0){try{let e=He,t=this.user_settings[this.columnKey];Object.keys(this.user_settings).length||(t=rt.A.getItem(this.columnKey)),t&&(t=JSON.parse(t)),t&&Object.keys(t).length==Object.keys(e).length&&(e=t),rt.A.set(this.columnKey,JSON.stringify(e)),this.processing=!0,this.table_columns=[];for(const[s,a]of Object.entries(e))this.table_columns.push(a);this.table_columns.sort(((e,t)=>e.order-t.order))}catch(t){logError(t)}finally{e&&(this.processing=!1)}},intervalManager(e){clearInterval(this.InvoicesClearInterval),!0===e&&(this.InvoicesClearInterval=setInterval((()=>{this.is_any_checked||this.fetchData(!1)}),6e4))},handleActions(e){return this.tasks.forEach(((t,s)=>{s!==e&&(t["fabAction"]=!1)})),!0},resetPages(){this.resetPagination(),this.fetchData()},applyFilter(){this.processing=!0,this.resetAllSelectedRows(),this.fetchData()},refreshFilters(e){this.tasks=[],this.selectionList=[],this.headerCheckbox=!1,this.fetchData()},fetchData(e=!0){return _s(this,void 0,void 0,(function*(){try{e&&(this.processing=!0,this.show_table_loader=!0),this.selectionList=[],this.headerCheckbox=!1;const t=this.getSavedFiltersAsJson();this.getListMode()||(t["limit"]=100),t["document_fields"]="supplier_name,supplier_id",t["cache"]=!1;const s=yield this.getSubOrgId();if(s&&(t["sub_org_id"]=s),this.use_websocket){let e=yield this.getWebSocketDashboard();return void(1!=e&&setTimeout(this.handleWebsocketDelay,5e3))}yield this.getTasks(t),this.updateTableData(),this.formatTaskList(),setTimeout(this.turnOnWebSocket,5e3)}catch(t){const e=tt.t.getErrorMessage(t);this.showErrorToast(e),logError(t)}finally{this.processing=!1}}))},handleWebsocketDelay(){"received"!==this.data_status&&(logInfo("turning off websocket and switching to https",this.data_status),this.use_websocket=!1,this.fetchData(),setTimeout(this.turnOnWebSocket,5e3))},turnOnWebSocket(){this.websocketHasError||(this.use_websocket=!1)},updateTableData(){this.setPagination(),this.applyCustomFormatOnRows(),this.show_table_loader=!1,this.processing=!1},setPagination(){this.total_records>0&&this.setTotalPages()},resetPagination(){this.total_pages=0,this.current_page=1,this.total_records=0,this.offset=0},setTotalPages(){this.total_pages=Math.ceil(this.total_records/this.page_size)},calculateOffset(){this.offset=this.page_size*(this.current_page-1)},nexPageClicked(){this.calculateOffset(),this.fetchData()},applyCustomFormatOnRows(){this.tasks.forEach((e=>{e["fabAction"]=!1,e["rowSelection"]=!1;const{formatted_deadline:t}=this.getDisplayDeadline(e["deadline"]);e["deadline"]=t}))},loadData(){this.resetPagination(),this.applyFilter()},bulkDeleteRecords(e){return _s(this,void 0,void 0,(function*(){try{this.processing=!0;const t=yield it.Hg.bulkDeleteTasks(e);if(!1===t.success)throw t;yield this.fetchData()}catch(t){const e=tt.t.getErrorMessage(t);this.showErrorToast(e),logError(t)}finally{this.processing=!1;const e=new CustomEvent("refresh_view",{});document.dispatchEvent(e)}}))},deleteRecord(e){return _s(this,void 0,void 0,(function*(){try{this.processing=!0;const t=yield it.Hg.deleteTask(e);if(!1===t.success)throw t;yield this.fetchData()}catch(t){const e=tt.t.getErrorMessage(t);this.showErrorToast(e),logError(t)}finally{this.processing=!1;const e=new CustomEvent("refresh_view",{});document.dispatchEvent(e)}}))},rowClick(e,t){if("title"!==e){if("document_name"===e&&t["document_id"]){let e=t["document_status"];return"validated_pending_approval"===e?void this.toPendingApprovalScreen(t):"approved_pending_second_approval"===e?void this.toPendingSecondApprovalScreen(t):"rejected"===e?void this.toRejectedScreen(t["document_id"]):"in_review"===e?void this.toInReviewScreen(t["document_id"],t):this.isStatusError(e)?void this.toDocumentErrorView(t):void this.$router.push("/field_validation_v1/"+t["document_id"])}}else this.$router.push("/task/"+t["id"])},isStatusError(e){return"error"===e||"export_error"===e},toPendingApprovalScreen(e){return this.model[at.WE]?void this.$router.push("/ready_for_approval_v3/"+e["document_id"]):void this.$router.push("/ready-for-approval-v2/"+e["document_id"])},toPendingSecondApprovalScreen(e){this.$router.push("/ready-for-second-approval-v2/"+e["document_id"])},toRejectedScreen(e){this.$router.push("/rejected/"+e)},toInReviewScreen(e,t){this.$router.push("/in_review/"+e)},toDocumentErrorView(e){this.$router.push("/document_error/"+e["id"])},getClassesForColumn(e){let t=" cursor-pointer ";const s=["document_name","title"];return t+=s.includes(e)?" text-primary ":"",t},resetFilters(){this.resetPagination(),this.setDefaultSettings(),this.applyFilter()},changeAction(){!0===this.headerCheckbox?this.selectAllRows():this.resetAllSelectedRows(),this.checkRowExistance()},selectAllRows(){this.selectionList=[],this.tasks.forEach((e=>{e["rowSelection"]=!0,this.selectionList.push(e.id)}))},resetAllSelectedRows(){this.selectionList=[],this.headerCheckbox=!1,this.tasks.forEach((e=>{e["rowSelection"]=!1}))},checkRowExistance(){let e=0;this.selectionList=[],this.headerCheckbox=!1,this.is_any_checked=!1,this.canBulkMarkAsDone=!0,this.canBulkMarkAsUnDone=!0,this.tasks.forEach((t=>{!0===t["rowSelection"]&&(this.is_any_checked=!0,e++,this.selectionList.push(t.id),"done"===t.status&&(this.canBulkMarkAsDone=!1),"open"===t.status&&(this.canBulkMarkAsUnDone=!1))})),0===e?this.headerCheckbox=!1:this.tasks.length===e?this.headerCheckbox=!0:this.headerCheckbox=!1},setRowStyle(e){if(e.hasOwnProperty("export_data_fetched")&&!0===e["export_data_fetched"])return"exported-row"},deleteMultipalDocument(){return _s(this,void 0,void 0,(function*(){if(!this.selectionList)return;let e;this.processing=!0;try{let t=new Map;if(t.set("doc_ids",this.selectionList.join(",")),e=yield it.v1.deleteRequest(p.FH.delete_documents,t),!1===e.success)return void this.showErrorToast(e.data.message);this.headerCheckbox=!1,this.resetAllSelectedRows(),this.loadData()}catch(t){this.showErrorToast(this.$t("pages.messages.error_internal_occur")),logError(t)}finally{this.processing=!1;const e=new CustomEvent("refresh_view",{});document.dispatchEvent(e)}}))},removeQuickFilter(e){this.taskListSettingsMap.delete(e),this.applyFilter()},handleWebSocketResult(e){e&&(this.use_websocket=!0,this.updateTableData())},getWebSocketDashboard(){return _s(this,void 0,void 0,(function*(){try{const e={type:"dashboard",data:{}};let t=this.queryParams;t=t.replace("?","");const s=t.split("&");s.forEach((t=>{t=t.split("="),2===t.length&&(e.data[t[0]]=t[1])})),this.data_status="fetching";yield this.sendMessageToSocket(e.type,e.data);return this.updateTableData(),this.processing=!1,!0}catch(e){this.handleWebsocketDelay()}}))}},setup(){const e=(0,E.G6)(),{dashboard_data:t,isConnected:s,hasError:a}=(0,m.bP)(e),i=(0,E.kH)(),{sub_org_id:o}=(0,m.bP)(i),{getSubOrgId:n}=i,r=(0,E.Bu)(),{user_settings:l}=(0,m.bP)(r),{subscribeToChannel:c,unsubscribeToChannel:d,sendMessageByType:h}=e,u=(0,E.OP)(),{tasks:p,total_records:g,data_fetched:k,offset:_,page_size:v,taskListSettingsMap:b,processing:f,columnKey:y}=(0,m.bP)(u),{getTasks:w,getListMode:C,formatTaskList:F,getSavedListSettings:S,getSavedFiltersAsJson:L,setDefaultSettings:D,getDisplayDeadline:A,saveTaskColumns:x}=u,I=(0,E.wt)(),{getDocTypeSettings:T}=I,{model:M}=(0,m.bP)(I);return{taskListSettingsMap:b,getListMode:C,user_settings:l,columnKey:y,getTasks:w,formatTaskList:F,tasks:p,total_records:g,current_page:(0,K.KR)(1),total_pages:(0,K.KR)(0),sub_org_id:o,offset:_,page_size:v,processing:f,getSubOrgId:n,getSavedListSettings:S,getSavedFiltersAsJson:L,setDefaultSettings:D,getDisplayDeadline:A,canBulkMarkAsDone:(0,K.KR)(!1),websocketHasError:a,sendMessageToSocket:h,isConnected:s,unsubscribeToChannel:d,subscribeToChannel:c,dashboard_data:t,table_columns:(0,K.KR)([]),queryParams:"",model:M,recordId:"",headerCheckbox:(0,K.KR)(!1),is_any_checked:(0,K.KR)(!1),headerFabIcon:(0,K.KR)(!1),selectionList:(0,K.KR)([]),canBulkMarkAsUnDone:(0,K.KR)(!1),use_websocket:(0,K.KR)(!1),show_table_loader:(0,K.KR)(!1),data_status:(0,K.KR)(""),saveTaskColumns:x,statusList:(0,K.KR)([]),getDocTypeSettings:T}}}),bs=(0,X.A)(vs,[["render",u],["__scopeId","data-v-1987691f"]]),fs=bs;B()(vs,"components",{QMarkupTable:$t.A,QPagination:Qt.A,QSeparator:Xt.A,QTable:Ut.A})}}]);