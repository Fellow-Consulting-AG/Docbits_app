"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[285],{50285:(e,t,i)=>{i.r(t),i.d(t,{default:()=>be});var a=i(83673),s=i(62323);const o=e=>((0,a.dD)("data-v-47be2108"),e=e(),(0,a.Cn)(),e),n={class:"row q-pl-xl q-pr-md q-pb-md full-width"},r={class:"max-width-100",id:"left_section",ref:"left_section"},l={class:"full-width q-ma-sm scroll-area-height"},d={class:"row justify-center q-pl-md q-pr-md q-pt-md"},c={class:"secondary-c-text text-h6 text-weight-bold"},h={class:"full-width left-scroll-area-height scrolle-y q-pa-sm"},g=["data-id","src","onClick"],u={class:"right_section",id:"right_section",ref:"right_section"},m={class:"row full-height"},p={class:"col-xs-12 col-sm-12 col-md-12 col-lg-12 q-px-sm scroll-area-height"},_={class:"mb-4 image_control_panel"},f={class:"row full-height"},w={class:"panel-left col-sm-6 col-md-6 col-lg-6"},y={class:"row"},v={class:"panel-middle col-sm-1 col-md-1 col-lg-1 mt-8"},b={class:"page-numbers"},D={class:"panel-right col-sm-5 col-md-5 col-lg-5"},k=o((()=>(0,a._)("img",{width:"24",height:"24",src:"view-doc.svg"},null,-1))),x=o((()=>(0,a._)("img",{width:"24",height:"24",src:"ocr_icon.svg"},null,-1))),z=o((()=>(0,a._)("img",{width:"24",height:"24",src:"debug-on.svg"},null,-1))),I={class:"float-right table-mode mode-on"},O={class:"full-width full-height",id:"image_container"},P={class:"full-width full-height q-pa-sm scrolle-y",id:"image_scrolle",style:{position:"relative"}};function q(e,t,i,o,q,H){const S=(0,a.up)("q-btn"),L=(0,a.up)("q-tooltip"),T=(0,a.up)("OcrTokenAreas"),U=(0,a.up)("Loader");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",n,[(0,a._)("div",r,[(0,a._)("div",l,[(0,a._)("div",d,[(0,a._)("span",c,(0,s.zw)(e.$t("pages.screen2a.pages")),1)]),(0,a._)("div",h,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.images,((t,i)=>((0,a.wg)(),(0,a.iD)("img",{"data-id":i,key:i,src:e.baseUrl+"/"+t.path,class:(0,s.C_)(["q-pa-xs shadow-5 full-width q-ma-sm cursor-pointer",i===this.page_number-1?"active":""]),style:{height:"auto"},onClick:t=>e.imageclicked(i)},null,10,g)))),128))])])],512),(0,a._)("div",u,[(0,a._)("div",m,[(0,a._)("div",p,[(0,a._)("div",_,[(0,a._)("div",f,[(0,a._)("div",w,[(0,a._)("div",y,[(0,a.Wm)(S,{id:"menu_btn",round:"",icon:"chevron_left",size:"xs",class:"toggler-right p-t-40",onClick:t[0]||(t[0]=t=>e.toggleMenu())}),(0,a.Uk)(" "+(0,s.zw)(e.filename),1)])]),(0,a._)("div",v,[(0,a._)("span",b,(0,s.zw)(e.currentPage())+"/"+(0,s.zw)(e.images.length),1)]),(0,a._)("div",D,[e.doc_mode.includes(e.mode)?((0,a.wg)(),(0,a.j4)(S,{key:0,flat:"",onClick:t[1]||(t[1]=t=>e.mode="doc"),class:"float-right pr-6 pl-6"},{default:(0,a.w5)((()=>[k,(0,a.Wm)(L,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,s.zw)(e.$t("doc_view")),1)])),_:1})])),_:1})):(0,a.kq)("",!0),e.ocr_mode.includes(e.mode)?((0,a.wg)(),(0,a.j4)(S,{key:1,flat:"",onClick:t[2]||(t[2]=t=>e.mode="ocr"),class:"float-right pr-6 pl-6"},{default:(0,a.w5)((()=>[x,(0,a.Wm)(L,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,s.zw)(e.$t("ocr_view")),1)])),_:1})])),_:1})):(0,a.kq)("",!0),e.debug_on_mode.includes(e.mode)?((0,a.wg)(),(0,a.j4)(S,{key:2,flat:"",onClick:t[3]||(t[3]=t=>e.mode="debug_on"),class:"float-right pr-6 pl-6"},{default:(0,a.w5)((()=>[z,(0,a.Wm)(L,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,s.zw)(e.$t("debug_view")),1)])),_:1})])),_:1})):(0,a.kq)("",!0),(0,a._)("span",I,["doc"==e.mode?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a.Uk)((0,s.zw)(e.$t("doc_view"))+" : ON ",1)],64)):(0,a.kq)("",!0),"ocr"==e.mode?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a.Uk)((0,s.zw)(e.$t("ocr_view"))+" : ON ",1)],64)):(0,a.kq)("",!0),"debug_on"==e.mode?((0,a.wg)(),(0,a.iD)(a.HY,{key:2},[(0,a.Uk)((0,s.zw)(e.$t("debug_view"))+" : ON ",1)],64)):(0,a.kq)("",!0)])])])]),(0,a._)("div",O,[(0,a._)("div",P,[(0,a.Wm)(T,{"pos-correction":!1,width:e.imageWidth,tableAreas:e.tokens,height:e.imageHeight,cropUrl:e.image,mode:e.mode,token_len:e.tokens.length},null,8,["width","tableAreas","height","cropUrl","mode","token_len"])])])])])],512)]),(0,a.Wm)(U)],64)}var H=i(30052),S=i.n(H),L=i(61959),T=i(77378),U=i(45401),C=i(54268),Z=i(60727),Y=i(10321),$=i(7153),A=i(29938);function N(e){return"ocr_doc_"+e}function W(){return"doc_data"}function B(e,t,i){try{const a=N(i),s=X(i);(null==s||(0,A.fg)(s))&&E(e,t,i),s[t]=e,$.Z.set(a,s)}catch(a){return!1}}function E(e,t,i){const a=N(i),s=R();s[t]=e,$.Z.set(a,s)}function R(){return{}}function j(e){$.Z.remove(e)}function X(e){const t=N(e);return $.Z.has(t)?$.Z.getItem(t):R()}var M=i(49566);const F=e=>((0,a.dD)("data-v-32a25e2b"),e=e(),(0,a.Cn)(),e),Q=["src","width"],K=F((()=>(0,a._)("br",null,null,-1))),V={class:"c-crop--hide_main"},J=["src","width"];function G(e,t,i,o,n,r){const l=(0,a.up)("q-tooltip");return(0,a.wg)(),(0,a.iD)("div",{class:"image-decorator medi-selected-area-fields",ref:"image-area",id:"image_area",style:(0,s.j5)({width:e.width+"px"})},[e.url?((0,a.wg)(),(0,a.iD)("img",{key:0,onLoad:t[0]||(t[0]=(...t)=>e.prepareImageData&&e.prepareImageData(...t)),id:"screenshot2",class:"original-image",style:{},src:e.url+"?reload="+e.image_reload,alt:"Original Image",width:e.width},null,40,Q)):(0,a.kq)("",!0),(0,a._)("div",{class:"select-areas--overlay",style:(0,s.j5)({opacity:e.opacityOverlay,position:"absolute",width:e.originImgSize.w+"px",height:e.originImgSize.h+"px",display:"block"})},null,4),"debug_on"===e.mode?((0,a.wg)(!0),(0,a.iD)(a.HY,{key:1},(0,a.Ko)(e.areas,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t.id},[(0,a._)("div",null,[(0,a._)("div",{class:"select-areas--outline outline",style:(0,s.j5)({opacity:e.opacityOutline,position:"absolute",cursor:"default",width:t.width+2+"px",height:t.height+2+"px",left:e.areaDisplayPosX(t)+"px",top:e.areaDisplayPosY(t)+"px","z-index":t.z,"font-size":t.font_size+"px"})},null,4),(0,a._)("div",{class:"select-areas--background_area",style:(0,s.j5)({position:"absolute",cursor:"pointer",width:t.width+3+"px",height:t.height+"px",left:e.areaDisplayPosX(t)+"px",top:e.areaDisplayPosY(t)+"px","z-index":t.z+2,"font-size":t.font_size+"px"})},[(0,a.Uk)((0,s.zw)(t.text),1),(0,a.Wm)(l,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.fieldDef,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{key:t},[(0,a.Uk)((0,s.zw)(t)+" : "+(0,s.zw)(e),1),K])))),128))])),_:2},1024)],4)])])))),128)):"ocr"===e.mode?((0,a.wg)(!0),(0,a.iD)(a.HY,{key:2},(0,a.Ko)(e.areas,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t.id},[(0,a._)("div",null,[(0,a._)("div",{class:"select-areas--outline",style:(0,s.j5)({opacity:e.opacityOutline,position:"absolute",cursor:"default",width:t.width+2+"px",height:t.height+2+"px",left:e.areaDisplayPosX(t)+"px",top:e.areaDisplayPosY(t)+"px","z-index":t.z,"font-size":t.font_size+"px"})},null,4),(0,a._)("div",{class:"select-areas--background_area",style:(0,s.j5)({position:"absolute",cursor:"pointer",width:t.width+3+"px",height:t.height+"px",left:e.areaDisplayPosX(t)+"px",top:e.areaDisplayPosY(t)+"px","z-index":t.z+2,"font-size":t.font_size+"px"})},(0,s.zw)(t.text),5)])])))),128)):(0,a.kq)("",!0),(0,a._)("div",V,[(0,a._)("img",{id:"c-crop--hide_img",src:e.url,alt:"",width:e.width},null,8,J)])],4)}var ee=i(77987),te=i(49405),ie=function(e,t,i,a){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function n(e){try{l(a.next(e))}catch(t){o(t)}}function r(e){try{l(a["throw"](e))}catch(t){o(t)}}function l(e){e.done?i(e.value):s(e.value).then(n,r)}l((a=a.apply(e,t||[])).next())}))};let ae,se;const oe=(0,a.aZ)({mixins:[U.Z],data(){return{originImgSize:{w:0,h:0,r:0},url:this.cropUrl,posImg:{top:0,left:0},areas:[],scrollLeft:0,scrollTop:0,imageHeight:0,imageWidth:0,image_reload:1,item_loaded:!1,opacityOverlay:1}},props:{cropUrl:{type:String,default:"https://dev.doc2api.cloudintegration.eu/resource/image/1b90b6d5-63b5-446b-92a4-a60d57dc0edd/1.png"},width:{type:Number,default:1500},height:{type:Number,default:1500},opacityOutline:{type:Number,default:.2},posCorrection:{type:Boolean,default:!1},tableAreas:[],isReadOnly:{type:Boolean,default:!0},mode:{type:String,default:"ocr"},token_len:{type:String}},components:{},watch:{cropUrl(e){return ie(this,void 0,void 0,(function*(){this.url=e,yield this.setSize(),this.image_reload++}))},width(e){return ie(this,void 0,void 0,(function*(){yield this.setSize(),this.image_reload++}))},mode(e){this.opacityOverlay="doc"===e?0:1}},setup(){return{is_debug:(0,L.iH)(!0)}},updated:(0,te.Z)((()=>{ae.$nextTick((function(){let e=document.querySelectorAll(".select-areas--outline");e.length===ae.token_len&&1==ae.item_loaded&&(ae.hideLoading(),ae.item_loaded=!1)}))}),500),methods:{isDebugFlagHandler(){this.is_debug=!1,this.$route.query&&"true"===this.$route.query.is_debug&&(this.is_debug=!0)},areaDisplayPosX(e){return e.x+(this.posCorrection?this.posImg.left:0)},areaDisplayPosY(e){return e.y+(this.posCorrection?this.posImg.top:0)},mousePosX(e){return e.pageX-this.posImg.left},mousePosY(e){return e.pageY-this.posImg.top},setSize(){return ie(this,void 0,void 0,(function*(){if(!this.url)return;let e=yield this.getSize(this.url);this.originImgSize=e}))},getSize(e){let t=this.$el.querySelector("#c-crop--hide_img");return new Promise((i=>{e&&t?(t.onload=function(){const e=ae.getSizeImg(t);i(e)},t.src=e):i({w:0,h:0,r:0})}))},getSizeImg(e){let t=e.width,i=e.height,a=0===t&&0===i?0:t/i;return{w:t,h:i,r:a}},calcPosOfBox(){let e=this.$refs["image-area"];this.scrollLeft=window.pageXOffset||document.documentElement.scrollLeft,this.scrollTop=window.pageYOffset||document.documentElement.scrollTop;let t=e.getBoundingClientRect().top,i=e.getBoundingClientRect().left;this.posImg.top=t+this.scrollTop,this.posImg.left=i+this.scrollLeft},creatReactangle(e,t,i,a,s,o){let n=null;if(n=this.areas.length>0?this.areas.slice(-1).pop().id+1:1,n){let r=14;s.hasOwnProperty("font_size")&&(r=Math.floor(this.imageWidth*s.font_size));let l={id:n,x:e,y:t,width:i,height:a,z:0,resizable:!1,fieldDef:s,text:s.text,font_size:r,key:o};this.areas.push(l)}},prepareImageData(){let e=(0,ee.$)("#screenshot2");e&&(this.imageWidth=e.offsetWidth,this.imageHeight=e.offsetHeight,this.prepareDataForAreas())},prepareDataForAreas(){try{if(this.item_loaded=!0,this.showLoading(),this.areas=[],!this.tableAreas)return;for(const e in this.tableAreas){let t=this.tableAreas[e],i=Math.floor(this.imageWidth*t.normalizedX0),a=Math.floor(this.imageHeight*t.normalizedY0),s=Math.floor(this.imageWidth*t.normalizedX1),o=Math.floor(this.imageHeight*t.normalizedY1),n=s-i,r=o-a;this.creatReactangle(i,a,n,r,t,e)}}catch(e){}finally{this.hideLoading()}}},mounted(){ae=this,window.ocrAreas=this,this.setSize(),se=(0,ee.$)("#image_area"),se.addEventListener("scroll",this.calcPosOfBox),this.calcPosOfBox()},unmounted:function(){se.removeEventListener("scroll",this.calcPosOfBox)}});var ne=i(74260),re=i(5363),le=i(86115),de=i(7518),ce=i.n(de);const he=(0,ne.Z)(oe,[["render",G],["__scopeId","data-v-32a25e2b"]]),ge=he;ce()(oe,"components",{QTooltip:re.Z,QField:le.Z});var ue=i(72113),me=i(80589),pe=i(9262),_e=function(e,t,i,a){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function n(e){try{l(a.next(e))}catch(t){o(t)}}function r(e){try{l(a["throw"](e))}catch(t){o(t)}}function l(e){e.done?i(e.value):s(e.value).then(n,r)}l((a=a.apply(e,t||[])).next())}))};const fe=document.querySelector.bind(document),we=(0,a.aZ)({el:"#app",mixins:[U.Z,T.Z],props:{},components:{OcrTokenAreas:ge,Loader:ue.Z},data(){return{docId:"",doc_data_name:"",imageHeight:0,imageWidth:0,filename:"",ocr_mode:["doc","debug_on"],doc_mode:["ocr","debug_on"],debug_on_mode:["ocr","doc"]}},setup(){let{locale:e}=(0,pe.QT)({useScope:"global"}),t={},i=[];const a=(0,Z.H_)(),{getDocumentById:s}=a,{record:o}=(0,Y.Jk)(a);return{getDocumentById:s,record:o,locale:(0,L.iH)(e),apiData:(0,L.iH)(t),page_number:(0,L.iH)(""),images:(0,L.iH)(i),baseUrl:"https://api.docbits.com",image:(0,L.iH)(""),tokens:(0,L.iH)(i),alert_counts:(0,L.iH)(i),mode:(0,L.iH)("ocr")}},mounted(){let e=me.Z.getItem("selected_language");this.locale=e||"de",this.docId=this.$route.params.id,this.page_number=this.$route.params.page_number,this.init()},methods:{init(){return _e(this,void 0,void 0,(function*(){try{this.showLoading(),j(N(this.docId)),this.doc_data_name=W();let e=!1,t=X(this.docId);null!==t&&this.updateLocalData(t),this.isPageNumberOcrDataExist(this.page_number)||(e=!0),e&&(yield this.getDocumentOcrData()),this.apiData&&this.apiData.hasOwnProperty(this.doc_data_name)&&this.apiData[this.doc_data_name].hasOwnProperty("images")||(yield this.getInvoiceDataByDocId()),this.setImages(),this.filename=this.apiData[this.doc_data_name]&&this.apiData[this.doc_data_name].filename?this.apiData[this.doc_data_name].filename:"",this.renderView()}catch(e){this.showErrorToast("Something went wrong while loading data. Please try again."),this.hideLoading()}}))},updateLocalData(e,t="-1"){if("-1"!==t)return this.apiData[t]=e,void B(e,t,this.docId);this.apiData=e},isPageNumberOcrDataExist(e="0"){return!("0"===e||(0,A.fg)(this.apiData)||!this.apiData.hasOwnProperty(e)||(0,A.fg)(this.apiData[e])||!this.apiData[e].hasOwnProperty("tokens")||!Array.isArray(this.apiData[e].tokens)||0==this.apiData[e].tokens.length)},getDocumentOcrData(){return _e(this,void 0,void 0,(function*(){if(!this.page_number)throw{message:"Page Number is missing"};let e;this.page_number=this.page_number.toString();let t=new FormData;t.append("page_number",this.page_number),t.append("include_font_size",(!0).toString());let i=yield(0,C.O_)();if(e=yield S().post(C.hi.get_ocr_data+this.docId,t,{headers:{Authorization:i}}),!0!==e.data.success)throw{message:e.data.message};this.updateLocalData(e.data.data,this.page_number)}))},getInvoiceDataByDocId(){return _e(this,void 0,void 0,(function*(){try{this.docId;if(yield this.getDocumentById(this.docId),!this.record.doc_id)throw{message:this.$t("pages.messages.INVALID_DOCUMENT")};this.updateLocalData(this.record,this.doc_data_name)}catch(e){this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}}))},setImages(){const e=Number(this.page_number)-1;this.image=this.baseUrl+"/"+(0,M.Rl)(this.apiData[this.doc_data_name].images[e].path),this.images=(0,M.PN)(this.apiData[this.doc_data_name].images)},currentPage(){return this.page_number},setImageDimensions(){const e=fe("#image_container");e&&(this.imageWidth=e.offsetWidth,this.imageHeight=e.offsetHeight)},imageclicked(e){return _e(this,void 0,void 0,(function*(){try{this.showLoading(),this.image=this.baseUrl+"/"+(0,M.Rl)(this.apiData[this.doc_data_name].images[e].path),this.page_number=String(parseInt(e)+1),this.isPageNumberOcrDataExist(this.page_number)||(yield this.getDocumentOcrData()),this.renderView()}catch(t){this.showErrorToast("Something went wrong while loading data. Please try again."),this.hideLoading()}}))},renderView(){this.setImageDimensions(),this.setTokens()},windowResize(){setTimeout((()=>{this.setImageDimensions()}),0)},toggler(){this.windowResize()},setTokens(){this.isPageNumberOcrDataExist(this.page_number)&&(this.tokens=this.apiData[this.page_number].tokens)}}});var ye=i(2165);const ve=(0,ne.Z)(we,[["render",q],["__scopeId","data-v-47be2108"]]),be=ve;ce()(we,"components",{QBtn:ye.Z,QTooltip:re.Z})}}]);