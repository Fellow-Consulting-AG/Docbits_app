"use strict";(globalThis["webpackChunkfc_ocr_vue"]=globalThis["webpackChunkfc_ocr_vue"]||[]).push([[3900],{73900:(e,t,i)=>{i.r(t),i.d(t,{default:()=>bl});var n=i(59835),s=i(86970);const o=e=>((0,n.dD)("data-v-37d2aa7c"),e=e(),(0,n.Cn)(),e),l={class:"row q-pl-md q-pr-md"},a={class:"col-12 q-pl-sm q-pr-sm q-mt-sm"},r={key:0,class:"row"},d={key:1,class:"row accounting-area"},c={class:"col-12 highlighted-back"},u={class:"col-sm-4 col-md-4 col-lg-4"},m={class:"secondary-c-text text-h6"},_=o((()=>(0,n._)("img",{width:"24",src:"back_new.svg"},null,-1))),p={class:"primary-dashboard"},h={class:"q-mt-sm q-mb-sm q-mr-sm"},g={class:"header row"},w={class:"col-auto"},y={class:"col-auto"},v={class:"q-ml-auto"},f={key:0,class:"back-white border-left-bdbdbd vw-30",id:"left_section"},x={class:"left-area-height q-ma-sm scrolle-y"},I={class:"text-weight-bold primary-bg-text"},b={class:"q-ml-sm"},k={class:"row items-center full-width q-mt-md q-mb-lg"},q={class:"text-weight-bold primary-bg-text"};function A(e,t,i,o,A,D){const L=(0,n.up)("MessageBanner"),S=(0,n.up)("ErrorDocumentView"),Z=(0,n.up)("q-icon"),W=(0,n.up)("q-btn"),P=(0,n.up)("q-btn-toggle"),C=(0,n.up)("PredictionBtn"),T=(0,n.up)("DocumentAutoSaveNotify"),$=(0,n.up)("ProceedBtn"),V=(0,n.up)("SaveBtn"),z=(0,n.up)("q-tooltip"),E=(0,n.up)("ImageComponent"),O=(0,n.up)("q-splitter"),F=(0,n.up)("ExpertMode"),Q=(0,n.up)("q-toolbar-title"),M=(0,n.up)("q-toolbar"),U=(0,n.up)("q-input"),H=(0,n.up)("q-card-section"),B=(0,n.up)("q-card"),j=(0,n.up)("q-dialog"),K=(0,n.up)("SetupValidation"),Y=(0,n.up)("Loader"),J=(0,n.Q2)("close-popup");return(0,n.wg)(),(0,n.iD)(n.HY,null,[e.error_message?((0,n.wg)(),(0,n.j4)(L,{key:0,message:e.error_message,messageCategoryClass:e.messageCategoryClass?e.messageCategoryClass:"error-banner"},null,8,["message","messageCategoryClass"])):(0,n.kq)("",!0),(0,n._)("div",l,[(0,n._)("div",a,[e.has_fetch_error?((0,n.wg)(),(0,n.iD)("div",r,[(0,n.Wm)(S)])):((0,n.wg)(),(0,n.iD)("div",d,[(0,n._)("div",c,[(0,n._)("div",u,[(0,n._)("div",m,[(0,n.Wm)(W,{flat:"",rounded:"","data-cy":"dashboard",color:"primary",onClick:t[0]||(t[0]=e=>this.$router.back())},{default:(0,n.w5)((()=>[(0,n.Wm)(Z,{class:"text-red-13",size:"sm"},{default:(0,n.w5)((()=>[_])),_:1}),(0,n._)("label",p,(0,s.zw)(e.$t("back")),1)])),_:1})])])]),(0,n._)("div",{class:(0,s.C_)(["scroll-area-height-medi",e.expert_mode?"right_section":"full-width"]),id:"right_section"},[(0,n.Wm)(O,{modelValue:e.splitterModel,"onUpdate:modelValue":t[3]||(t[3]=t=>e.splitterModel=t),class:"accounting aa-splitter full-width right-content-height"},{before:(0,n.w5)((()=>[(0,n._)("div",h,[(0,n._)("div",g,[(0,n._)("div",w,[(0,n.Wm)(P,{tabindex:"1",modelValue:e.accounting_mode,"onUpdate:modelValue":[t[1]||(t[1]=t=>e.accounting_mode=t),e.handleMode],spread:"","no-caps":"","toggle-color":"primary",color:"white","text-color":"black",class:"accounting_model_toggle",options:e.accounting_mode_options,disable:e.is_view_readonly||!e.data_loaded||e.disable_mode},null,8,["modelValue","options","onUpdate:modelValue","disable"])]),(0,n._)("div",y,[(0,n.Wm)(C)]),(0,n._)("div",v,[(0,n.Wm)(T),(0,n.Wm)($),(0,n.Wm)(V),(0,n.Wm)(W,{style:{height:"34px"},square:"",class:"q-ml-sm",color:"primary",icon:"img:settings.svg",onClick:t[2]||(t[2]=t=>e.show_setup_validation=!e.show_setup_validation)},{default:(0,n.w5)((()=>[(0,n.Wm)(z,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("validate_setup")),1)])),_:1})])),_:1})])])]),""!==e.view_template?((0,n.wg)(),(0,n.j4)((0,n.LL)(e.view_template),{key:0,currentView:e.view_template},null,8,["currentView"])):(0,n.kq)("",!0)])),separator:(0,n.w5)((()=>[])),after:(0,n.w5)((()=>[(0,n.Wm)(E,{renderOpenWindoIcon:!0,docName:e.record.filename,docImages:e.record.images},{default:(0,n.w5)((()=>[(0,n.Wm)(W,{class:"float-right",icon:"tune",disabled:e.is_view_readonly,flat:"",dense:"",onClick:e.toggleMenu},null,8,["disabled","onClick"])])),_:1},8,["docName","docImages"])])),_:1},8,["modelValue"])],2),e.expert_mode&&!e.is_view_readonly?((0,n.wg)(),(0,n.iD)("div",f,[(0,n._)("div",x,[(0,n.Wm)(F)])])):(0,n.kq)("",!0)]))])]),(0,n.Wm)(j,{modelValue:e.empty_line_item,"onUpdate:modelValue":t[6]||(t[6]=t=>e.empty_line_item=t),persistent:""},{default:(0,n.w5)((()=>[(0,n.Wm)(B,null,{default:(0,n.w5)((()=>[(0,n.Wm)(M,{class:"secondary-toolbar"},{default:(0,n.w5)((()=>[(0,n.Wm)(Q,null,{default:(0,n.w5)((()=>[(0,n._)("span",I,(0,s.zw)(e.$t("error")),1)])),_:1}),(0,n.wy)((0,n.Wm)(W,{flat:"",round:"",dense:"",class:"primary-bg-text",icon:"close",onClick:t[4]||(t[4]=t=>e.empty_line_item=!1)},null,512),[[J]])])),_:1}),(0,n.Wm)(H,{class:"row items-center"},{default:(0,n.w5)((()=>[(0,n._)("span",b,(0,s.zw)(e.$t("please_share_document_with_admin")),1),(0,n._)("div",k,[(0,n.Wm)(U,{class:"accouting-input col-11",outlined:"",modelValue:e.doc_url,"onUpdate:modelValue":t[5]||(t[5]=t=>e.doc_url=t)},{append:(0,n.w5)((()=>[(0,n.Wm)(Z,{flat:"",dense:"",name:"fas fa-copy",size:"24px",color:"primary",onClick:e.copyURL},{default:(0,n.w5)((()=>[(0,n.Wm)(z,{anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("copy")),1)])),_:1})])),_:1},8,["onClick"])])),_:1},8,["modelValue"])])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,n.Wm)(j,{modelValue:e.show_setup_validation,"onUpdate:modelValue":t[8]||(t[8]=t=>e.show_setup_validation=t)},{default:(0,n.w5)((()=>[(0,n.Wm)(B,{style:{"min-width":"600px","min-height":"500px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(M,{class:"secondary-toolbar"},{default:(0,n.w5)((()=>[(0,n.Wm)(Q,null,{default:(0,n.w5)((()=>[(0,n._)("span",q,(0,s.zw)(e.$t("validate_setup")),1)])),_:1}),(0,n.wy)((0,n.Wm)(W,{flat:"",round:"",dense:"",class:"primary-bg-text",icon:"close",onClick:t[7]||(t[7]=t=>e.show_setup_validation=!1)},null,512),[[J]])])),_:1}),(0,n.Wm)(H,null,{default:(0,n.w5)((()=>[(0,n.Wm)(K)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,n.Wm)(Y)],64)}var D=i(50796),L=i(7363),S=i(49990),Z=i(92603),W=i(60499),P=i(9008),C=i(20334),T=i(73683),$=i(37446),V=i(33725),z=i(46624),E=i(65054),O=i(31921),F=i(70501);function Q(e,t,i,s,o,l){return(0,n.wg)(),(0,n.j4)((0,n.LL)(e.view_template),{currentView:e.view_template},null,8,["currentView"])}const M={class:"row full-width"},U={class:"col-12"},H={class:"validation-list"},B={class:"alert alert-success",role:"alert"},j={class:"alert alert-danger",role:"alert"},K={key:1,class:"container-svg"};function Y(e,t,i,o,l,a){const r=(0,n.up)("q-icon"),d=(0,n.up)("q-spinner-gears");return(0,n.wg)(),(0,n.iD)(n.HY,null,[e.validating?(0,n.kq)("",!0):((0,n.wg)(!0),(0,n.iD)(n.HY,{key:0},(0,n.Ko)(e.validation,((e,t)=>((0,n.wg)(),(0,n.iD)(n.HY,{key:t},[(0,n._)("div",M,[(0,n._)("div",U,(0,s.zw)(t),1)]),(0,n._)("ul",H,[e.success_steps.length>0?((0,n.wg)(!0),(0,n.iD)(n.HY,{key:0},(0,n.Ko)(e.success_steps,((e,t)=>((0,n.wg)(),(0,n.iD)("li",{key:t},[(0,n._)("div",B,[(0,n.Wm)(r,{name:"done",color:"green",size:"sm"}),(0,n.Uk)(" "+(0,s.zw)(e),1)])])))),128)):(0,n.kq)("",!0),e.errors.length>0?((0,n.wg)(!0),(0,n.iD)(n.HY,{key:1},(0,n.Ko)(e.errors,((e,t)=>((0,n.wg)(),(0,n.iD)("li",{key:t},[(0,n._)("div",j,[(0,n.Wm)(r,{name:"close",color:"red",size:"sm"}),(0,n.Uk)(" "+(0,s.zw)(e),1)])])))),128)):(0,n.kq)("",!0)])],64)))),128)),e.validating?((0,n.wg)(),(0,n.iD)("div",K,[(0,n.Wm)(d,{color:"primary",size:"10em"})])):(0,n.kq)("",!0)],64)}var J=function(e,t,i,n){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function l(e){try{r(n.next(e))}catch(t){o(t)}}function a(e){try{r(n["throw"](e))}catch(t){o(t)}}function r(e){e.done?i(e.value):s(e.value).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const N=(0,n.aZ)({mixins:[],props:{},components:{},mounted:function(){this.validate()},methods:{validate(){return J(this,void 0,void 0,(function*(){try{this.validating=!0,yield this.validateAccounts(),yield this.validateDimensions(),yield this.validateDimensionOptions()}catch(e){const t="Error";this.validation[t]={},this.validation[t].errors=[],this.validation[t].errors.push(e.message)}finally{this.validating=!1}}))},validateDimensionOptions(){return J(this,void 0,void 0,(function*(){const e="Dimensions Options";let t=[];this.validation[e]={},this.validation[e].errors=[],this.validation[e].success_steps=[];try{t=yield this.getDimensionDropdownsFromServer();const i=this.$t("list_exists").replace("%s",this.dimension_dropdowns_list_name);this.validation[e].success_steps.push(i)}catch(l){const t=this.$t("master_data_list_not_found").replace("%s",this.dimension_dropdowns_list_name);return void this.validation[e].errors.push(t)}if(0===t.length){const t=this.$t("please_check_if_master_data_list_has_data").replace("%s",this.dimension_dropdowns_list_name);return void this.validation[e].errors.push(t)}this.validation[e].success_steps.push(this.$t("list_has_data"));const i=Object.keys(t[0]),n=["id","name","dimensionid"],s=n.filter((e=>!i.includes(e)));if(0===s.length){const t=this.$t("list_has_all_columns")+" "+n.join(", ")+".";return void this.validation[e].success_steps.push(t)}if(s.length>0){const t=this.$t("list_has_missing_columns")+" "+s.join(", ")+".";this.validation[e].errors.push(t)}const o=n.filter((e=>i.includes(e)));if(o.length!==n.length){const t=this.$t("list_has_columns")+" "+o.join(", ")+".";this.validation[e].success_steps.push(t)}}))},validateDimensions(){return J(this,void 0,void 0,(function*(){const e="Dimensions";let t=[];this.validation[e]={},this.validation[e].errors=[],this.validation[e].success_steps=[];try{t=yield this.getDimensionsFromServer();const i=this.$t("list_exists").replace("%s",this.dimensions_list_name);this.validation[e].success_steps.push(i)}catch(l){const t=this.$t("master_data_list_not_found").replace("%s",this.dimensions_list_name);return void this.validation[e].errors.push(t)}if(0===t.length){const t=this.$t("please_check_if_master_data_list_has_data").replace("%s",this.dimensions_list_name);return void this.validation[e].errors.push(t)}this.validation[e].success_steps.push(this.$t("list_has_data"));const i=Object.keys(t[0]),n=["id","name"],s=n.filter((e=>!i.includes(e)));if(0===s.length){const t=this.$t("list_has_all_columns")+" "+n.join(", ")+".";return void this.validation[e].success_steps.push(t)}if(s.length>0){const t=this.$t("list_has_missing_columns")+" "+s.join(", ")+".";this.validation[e].errors.push(t)}const o=n.filter((e=>i.includes(e)));if(o.length!==n.length){const t=this.$t("list_has_columns")+" "+o.join(", ")+".";this.validation[e].success_steps.push(t)}}))},validateAccounts(){return J(this,void 0,void 0,(function*(){const e="Accounts";let t=[];this.validation[e]={},this.validation[e].errors=[],this.validation[e].success_steps=[];try{t=yield this.getAccountsFromServer();const i=this.$t("list_exists").replace("%s",this.accounts_list_name);this.validation[e].success_steps.push(i)}catch(l){const t=this.$t("master_data_list_not_found").replace("%s",this.accounts_list_name);return void this.validation[e].errors.push(t)}if(0===t.length){const t=this.$t("please_check_if_master_data_list_has_data").replace("%s",this.accounts_list_name);return void this.validation[e].errors.push(t)}this.validation[e].success_steps.push(this.$t("list_has_data"));const i=Object.keys(t[0]),n=["flexdimensions","nominalaccount","description"],s=n.filter((e=>!i.includes(e)));if(0===s.length){const t=this.$t("list_has_all_columns")+" "+n.join(", ")+".";return void this.validation[e].success_steps.push(t)}if(s.length>0){const t=this.$t("list_has_missing_columns")+" "+s.join(", ")+".";this.validation[e].errors.push(t)}const o=n.filter((e=>i.includes(e)));if(o.length!==n.length){const t=this.$t("list_has_columns")+" "+o.join(", ")+".";this.validation[e].success_steps.push(t)}}))}},setup(){const e=(0,z.f5)(),{getAccountsFromServer:t,getDimensionsFromServer:i,getDimensionDropdownsFromServer:n}=e,{accounts_list_name:s,dimensions_list_name:o,dimension_dropdowns_list_name:l}=(0,L.Jk)(e);return{dimension_dropdowns_list_name:l,dimensions_list_name:o,accounts_list_name:s,getDimensionDropdownsFromServer:n,getAccountsFromServer:t,getDimensionsFromServer:i,validation:(0,W.iH)({}),validating:(0,W.iH)(!1)}}});var R=i(7683),G=i(22857),X=i(9120),ee=i(69984),te=i.n(ee);const ie=(0,R.Z)(N,[["render",Y],["__scopeId","data-v-258da00d"]]),ne=ie;te()(N,"components",{QIcon:G.Z,QSpinnerGears:X.Z});const se={class:"row full-width"},oe={class:"col-12"},le={class:"validation-list"},ae={class:"alert alert-success",role:"alert"},re={class:"alert alert-danger",role:"alert"},de={key:1,class:"container-svg"};function ce(e,t,i,o,l,a){const r=(0,n.up)("q-icon"),d=(0,n.up)("q-spinner-gears");return(0,n.wg)(),(0,n.iD)(n.HY,null,[e.validating?(0,n.kq)("",!0):((0,n.wg)(!0),(0,n.iD)(n.HY,{key:0},(0,n.Ko)(e.validation,((e,t)=>((0,n.wg)(),(0,n.iD)(n.HY,{key:t},[(0,n._)("div",se,[(0,n._)("div",oe,(0,s.zw)(t),1)]),(0,n._)("ul",le,[e.success_steps.length>0?((0,n.wg)(!0),(0,n.iD)(n.HY,{key:0},(0,n.Ko)(e.success_steps,((e,t)=>((0,n.wg)(),(0,n.iD)("li",{key:t},[(0,n._)("div",ae,[(0,n.Wm)(r,{name:"done",color:"green",size:"sm"}),(0,n.Uk)(" "+(0,s.zw)(e),1)])])))),128)):(0,n.kq)("",!0),e.errors.length>0?((0,n.wg)(!0),(0,n.iD)(n.HY,{key:1},(0,n.Ko)(e.errors,((e,t)=>((0,n.wg)(),(0,n.iD)("li",{key:t},[(0,n._)("div",re,[(0,n.Wm)(r,{name:"close",color:"red",size:"sm"}),(0,n.Uk)(" "+(0,s.zw)(e),1)])])))),128)):(0,n.kq)("",!0)])],64)))),128)),e.validating?((0,n.wg)(),(0,n.iD)("div",de,[(0,n.Wm)(d,{color:"primary",size:"10em"})])):(0,n.kq)("",!0)],64)}var ue=function(e,t,i,n){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function l(e){try{r(n.next(e))}catch(t){o(t)}}function a(e){try{r(n["throw"](e))}catch(t){o(t)}}function r(e){e.done?i(e.value):s(e.value).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const me=(0,n.aZ)({mixins:[],props:{},components:{},mounted:function(){this.validate()},methods:{validate(){return ue(this,void 0,void 0,(function*(){try{if(this.validating=!0,this.hasPoMatchData())return void(yield this.validatePoAccounts());yield this.validateAccounts(),yield this.validateDimensions()}catch(e){const t="Error";this.validation[t]={},this.validation[t].errors=[],this.validation[t].errors.push(e.message)}finally{this.validating=!1}}))},validateDimensions(){return ue(this,void 0,void 0,(function*(){const e="Dimensions";let t=[];this.validation[e]={},this.validation[e].errors=[],this.validation[e].success_steps=[];try{t=yield this.getM3DimensionsFromServer();const i=this.$t("list_exists").replace("%s",this.dimensions_list_name.m3);this.validation[e].success_steps.push(i)}catch(l){const t=this.$t("master_data_list_not_found").replace("%s",this.dimensions_list_name.m3);return void this.validation[e].errors.push(t)}if(0===t.length){const t=this.$t("please_check_if_master_data_list_has_data").replace("%s",this.dimensions_list_name.m3);return void this.validation[e].errors.push(t)}this.validation[e].success_steps.push(this.$t("list_has_data"));const i=Object.keys(t[0]),n=["id","description","dimension","listid"],s=n.filter((e=>!i.includes(e)));if(0===s.length){const t=this.$t("list_has_all_columns")+" "+n.join(", ")+".";return void this.validation[e].success_steps.push(t)}if(s.length>0){const t=this.$t("list_has_missing_columns")+" "+s.join(", ")+".";this.validation[e].errors.push(t)}const o=n.filter((e=>i.includes(e)));if(o.length!==n.length){const t=this.$t("list_has_columns")+" "+o.join(", ")+".";this.validation[e].success_steps.push(t)}}))},validatePoAccounts(){return ue(this,void 0,void 0,(function*(){const e="Accounts";let t=[];this.validation[e]={},this.validation[e].errors=[],this.validation[e].success_steps=[];try{t=yield this.getM3POAccountsFromServer();const i=this.$t("list_exists").replace("%s",this.po_accounts_list_name.m3);this.validation[e].success_steps.push(i)}catch(l){const t=this.$t("master_data_list_not_found").replace("%s",this.po_accounts_list_name.m3);return void this.validation[e].errors.push(t)}if(0===t.length){const t=this.$t("please_check_if_master_data_list_has_data").replace("%s",this.po_accounts_list_name.m3);return void this.validation[e].errors.push(t)}this.validation[e].success_steps.push(this.$t("list_has_data"));const i=Object.keys(t[0]),n=["id","description"],s=n.filter((e=>!i.includes(e)));if(0===s.length){const t=this.$t("list_has_all_columns")+" "+n.join(", ")+".";return void this.validation[e].success_steps.push(t)}if(s.length>0){const t=this.$t("list_has_missing_columns")+" "+s.join(", ")+".";this.validation[e].errors.push(t)}const o=n.filter((e=>i.includes(e)));if(o.length!==n.length){const t=this.$t("list_has_columns")+" "+o.join(", ")+".";this.validation[e].success_steps.push(t)}}))},validateAccounts(){return ue(this,void 0,void 0,(function*(){const e="Accounts";let t=[];this.validation[e]={},this.validation[e].errors=[],this.validation[e].success_steps=[];try{t=yield this.getM3AccountsFromServer();const i=this.$t("list_exists").replace("%s",this.accounts_list_name.m3);this.validation[e].success_steps.push(i)}catch(l){const t=this.$t("master_data_list_not_found").replace("%s",this.accounts_list_name.m3);return void this.validation[e].errors.push(t)}if(0===t.length){const t=this.$t("please_check_if_master_data_list_has_data").replace("%s",this.accounts_list_name.m3);return void this.validation[e].errors.push(t)}this.validation[e].success_steps.push(this.$t("list_has_data"));const i=Object.keys(t[0]),n=["id","dimensionprofile","nominalaccount","description"],s=n.filter((e=>!i.includes(e)));if(0===s.length){const t=this.$t("list_has_all_columns")+" "+n.join(", ")+".";return void this.validation[e].success_steps.push(t)}if(s.length>0){const t=this.$t("list_has_missing_columns")+" "+s.join(", ")+".";this.validation[e].errors.push(t)}const o=n.filter((e=>i.includes(e)));if(o.length!==n.length){const t=this.$t("list_has_columns")+" "+o.join(", ")+".";this.validation[e].success_steps.push(t)}}))}},setup(){const e=(0,z.ZA)(),{getM3AccountsFromServer:t,getM3DimensionsFromServer:i,getM3POAccountsFromServer:n}=e,{dimensions_list_name:s,accounts_list_name:o,po_accounts_list_name:l}=(0,L.Jk)(e),a=(0,z.f5)(),{dimension_dropdowns_list_name:r}=(0,L.Jk)(a),d=(0,z.Yb)(),{hasPoMatchData:c}=d;return{hasPoMatchData:c,getM3AccountsFromServer:t,getM3DimensionsFromServer:i,getM3POAccountsFromServer:n,dimension_dropdowns_list_name:r,dimensions_list_name:s,accounts_list_name:o,po_accounts_list_name:l,validation:(0,W.iH)({}),validating:(0,W.iH)(!1)}}}),_e=(0,R.Z)(me,[["render",ce],["__scopeId","data-v-06252eb6"]]),pe=_e;te()(me,"components",{QIcon:G.Z,QSpinnerGears:X.Z});const he=(0,n.aZ)({mixins:[],props:{},components:{LN_VIEW:ne,M3_VIEW:pe},methods:{},setup(){const e=(0,z.ZA)(),{view_template:t}=(0,L.Jk)(e);return{view_template:t}}}),ge=(0,R.Z)(he,[["render",Q]]),we=ge;function ye(e,t,i,s,o,l){const a=(0,n.up)("q-btn"),r=(0,n.up)("export-dialog"),d=(0,n.up)("q-dialog");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(a,{unelevated:"",class:"bg-primary text-white",tabindex:"1",onClick:e.onProceed,label:e.$t("proceed"),disabled:e.is_view_readonly},null,8,["onClick","label","disabled"]),(0,n.Wm)(d,{modelValue:e.display_config_dialog,"onUpdate:modelValue":t[0]||(t[0]=t=>e.display_config_dialog=t),position:"top",class:"export-dialog",persistent:""},{default:(0,n.w5)((()=>[(0,n.Wm)(r)])),_:1},8,["modelValue"])],64)}var ve=i(15704),fe=i(43572),xe=i(37744),Ie=i(39981),be=i.n(Ie),ke=function(e,t,i,n){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function l(e){try{r(n.next(e))}catch(t){o(t)}}function a(e){try{r(n["throw"](e))}catch(t){o(t)}}function r(e){e.done?i(e.value):s(e.value).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const qe=(0,n.aZ)({mixins:[S.Z,F.Z],props:{},components:{ExportDialog:fe.Z},watch:{config_saved:{handler:function(e,t){!0===t&&!1===e||(this.display_config_dialog=!1)}}},computed:{},methods:{onProceed(){return ke(this,void 0,void 0,(function*(){try{if(this.is_view_readonly||!(yield this.validateForm()))return;this.processing=!0;const e=yield this.confirmExportConfiguration();if(!e)return void(this.display_config_dialog=!0);this.callExportApi()}catch(e){this.showErrorToast(this.$t("pages.messages.ERROR_INTERNAL_OCCUR"))}finally{this.processing=!1}}))},prepareJsonForSave(){this.record.accounting={mode:this.accounting_mode,line_items:this.lineItems}},validateForm(){return ke(this,void 0,void 0,(function*(){let e=!0;try{this.clearErrors(this.lineItems);const t=this.validateLineItemDimensions(this.lineItems),i=yield this.validateLineItemAmount(),n=this.validateAccounts();t&&i&&n||(e=!1,this.showErrorToast(this.$t("please_check_some_values_are_missing")))}catch(t){}return e}))},clearErrors(e){for(const[t,i]of e.entries())if(this.clearLineItemErrors(i),i.hasOwnProperty("split_items")&&i.split_items.length>0)for(const[e,n]of i.split_items.entries())this.clearErrors(i.split_items)},clearLineItemErrors(e){e.hasOwnProperty("account_error")&&(e.account_error=""),e.hasOwnProperty("amount_error")&&(e.amount_error=""),e.hasOwnProperty("error")&&(e.error="")},validateLineItemDimensions(e){let t=!0;for(const[i,n]of e.entries()){if(n.account||(n.dimensions=[]),n.dimensions&&n.dimensions.length>0){const e=this.validateDimensionForEach(n.dimensions);e||(t=!1)}if(n.hasOwnProperty("split_items")&&n.split_items.length>0){const e=this.validateLineItemDimensions(n.split_items);e||(t=!1)}}return t},validateDimensionForEach(e){let t=!0;return Array.from(e).forEach(((e,i)=>{e.error="","m"==e.rule.toLowerCase()&&0===e.value.trim().length&&(e.error=this.$t("required"),t=!1)})),t},validateAccounts(){const e=this.getSelectedModeLineItems();return this.validateLineItemsAccounts(e)},getSelectedModeLineItems(){if("total_line"===this.accounting_mode){const e=this.lineItems.filter((e=>"total_line_item"===e.type.toLowerCase()));return e}const e=this.lineItems.filter((e=>"line_item"===e.type.toLowerCase()));return e},validateLineItemsAccounts(e){let t=!0;return Array.from(e).forEach(((e,i)=>{if(e.hasOwnProperty("split_items")&&e.split_items.length>0){const i=this.validateLineItemsAccounts(e.split_items);i||(t=!1)}else e.account||(e.account_error=this.$t("required"),t=!1)})),t},validateLineItemAmount(){return ke(this,void 0,void 0,(function*(){let e=!0;yield this.calculateTotalByMode();const t=this.getTotalLineIndex();if(-1===t)return!1;const i=this.lineItems[t];if(parseFloat((0,ve.bI)(i.pending_amount))>0&&(e=!1,i.error=this.$t("total_amount_not_equal_to_line_items")),"total_line"===this.accounting_mode)return e;for(const[n,s]of this.lineItems.entries()){if("total_line_item"===s.type)continue;const t=yield this.checkTotalForEachLineItem(s);t||(e=!1,s.error=this.$t("line_item_total_not_equal_to_line_item_split_total"))}return e}))},confirmExportConfiguration(){return ke(this,void 0,void 0,(function*(){let e,t=new FormData;t.append("doc_type",this.record.doc_type);let i=yield(0,xe.O_)();const n=yield be().post(xe.hi.export_configuration_existence,t,{headers:{Authorization:i}});return e=n.data.valid,e}))},callExportApi(){return ke(this,void 0,void 0,(function*(){try{this.prepareJsonForSave(),this.processing=!0;const e=yield this.exportDocument(this.record.doc_id);if(!1===e.success)throw{message:e.message};if(this.showSuccessToast(this.$t("pages.messages.MSG_SAVE")),this.is_view_readonly=!0,!0===e.success)return void this.$router.push("/dashboard");this.showErrorToast(e.data.message),this.record=e.data}catch(e){const t=$.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.processing=!1}}))}},setup(){const e=(0,z.H_)(),{record:t,processing:i}=(0,L.Jk)(e),{saveDocument:n,exportDocument:s}=e,o=(0,z.f5)(),{lineItems:l,is_view_readonly:a,accounting_mode:r}=(0,L.Jk)(o),{calculateTotalByMode:d,getTotalLineIndex:c,checkTotalForEachLineItem:u}=o,m=(0,z.Fl)(),{clearStateForExportDialog:_,config_saved:p}=m,{display_config_dialog:h}=(0,L.Jk)(m);return{config_saved:p,exportDocument:s,display_config_dialog:h,getTotalLineIndex:c,calculateTotalByMode:d,saveDocument:n,checkTotalForEachLineItem:u,record:t,processing:i,lineItems:l,is_view_readonly:a,accounting_mode:r}}});var Ae=i(68879),De=i(32074);const Le=(0,R.Z)(qe,[["render",ye]]),Se=Le;function Ze(e,t,i,o,l,a){const r=(0,n.up)("q-tooltip"),d=(0,n.up)("q-btn");return(0,n.wg)(),(0,n.j4)(d,{style:{height:"34px"},square:"",class:"q-ml-sm",color:"primary",icon:"img:save-white.svg",onClick:e.onSave,disabled:e.is_view_readonly},{default:(0,n.w5)((()=>[(0,n.Wm)(r,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("save")),1)])),_:1})])),_:1},8,["onClick","disabled"])}te()(qe,"components",{QBtn:Ae.Z,QDialog:De.Z});var We=function(e,t,i,n){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function l(e){try{r(n.next(e))}catch(t){o(t)}}function a(e){try{r(n["throw"](e))}catch(t){o(t)}}function r(e){e.done?i(e.value):s(e.value).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const Pe=(0,n.aZ)({mixins:[S.Z,F.Z],props:{},components:{},watch:{},computed:{},methods:{onSave(){return We(this,void 0,void 0,(function*(){try{if(this.is_view_readonly)return;this.processing=!0,this.prepareJsonForSave();const e=yield this.saveDocument(this.record.doc_id);if(!1===e.success)throw{message:e.message};this.showSuccessToast(this.$t("pages.messages.MSG_SAVE"))}catch(e){const t=$.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.processing=!1}}))},prepareJsonForSave(){this.record.accounting={mode:this.accounting_mode,line_items:this.lineItems}}},setup(){const e=(0,z.H_)(),{record:t,processing:i}=(0,L.Jk)(e),{saveDocument:n}=e,s=(0,z.f5)(),{lineItems:o,is_view_readonly:l,accounting_mode:a}=(0,L.Jk)(s);return{saveDocument:n,record:t,processing:i,lineItems:o,is_view_readonly:l,accounting_mode:a}}});var Ce=i(46858);const Te=(0,R.Z)(Pe,[["render",Ze]]),$e=Te;te()(Pe,"components",{QBtn:Ae.Z,QTooltip:Ce.Z});var Ve=i(61957);function ze(e,t,i,o,l,a){const r=(0,n.up)("q-tooltip"),d=(0,n.up)("q-btn"),c=(0,n.up)("PredictionPopup"),u=(0,n.up)("q-dialog");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(d,{square:"",class:(0,s.C_)(["q-ml-sm",e.is_view_readonly?" disabled ":""]),color:"primary",icon:"img:auto-detection-white.svg","text-color":"white",onClick:e.showPredictions},{default:(0,n.w5)((()=>[(0,n.Wm)(r,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("show_predictions")),1)])),_:1})])),_:1},8,["class","onClick"]),(0,n.Wm)(u,{modelValue:e.show_popup,"onUpdate:modelValue":t[0]||(t[0]=t=>e.show_popup=t),onKeydown:(0,Ve.D2)(e.cleanupOnhide,["esc"]),onHide:e.cleanupOnhide},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{show_popup:e.show_popup,onCleanupOnhide:e.cleanupOnhide},null,8,["show_popup","onCleanupOnhide"])])),_:1},8,["modelValue","onKeydown","onHide"])],64)}const Ee={class:"text-weight-bold primary-bg-text"},Oe={class:"row items-center q-mb-sm"},Fe={class:"q-ml-auto q-mr-auto"},Qe=(0,n._)("img",{src:"Magier-active.svg"},null,-1),Me={class:"row q-pl-sm q-pt-sm q-pb-sm table-header"},Ue={class:"col-2 flex items-center justify-left"},He={class:"col-9 flex items-center justify-left"},Be=(0,n._)("div",{class:"col-1"},null,-1),je={key:0,class:"row q-pl-sm q-pt-sm total-line-item-area"},Ke={class:"col-12 flex flex-center"},Ye={class:"row q-pl-sm q-pt-sm"},Je={class:"col-12 flex items-center justify-left"},Ne={class:"row pl-20"},Re={class:"row"},Ge={class:"col-10 flex items-center justify-left"},Xe={class:"col-1"};function et(e,t,i,o,l,a){const r=(0,n.up)("q-toolbar-title"),d=(0,n.up)("q-btn"),c=(0,n.up)("q-toolbar"),u=(0,n.up)("q-avatar"),m=(0,n.up)("q-checkbox"),_=(0,n.up)("q-circular-progress"),p=(0,n.up)("q-separator"),h=(0,n.up)("q-card-section"),g=(0,n.up)("f-btn"),w=(0,n.up)("q-card-actions"),y=(0,n.up)("q-card");return(0,n.wg)(),(0,n.j4)(y,{style:{width:"800px","max-width":"1060px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{class:"secondary-toolbar"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,null,{default:(0,n.w5)((()=>[(0,n._)("span",Ee,(0,s.zw)(e.$t("accounts")),1)])),_:1}),(0,n.Wm)(d,{flat:"",round:"",dense:"",class:"primary-bg-text",icon:"close",onClick:e.closeDialog},null,8,["onClick"])])),_:1}),(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[(0,n._)("div",Oe,[(0,n._)("div",Fe,[(0,n.Wm)(u,{square:"",size:"80px"},{default:(0,n.w5)((()=>[Qe])),_:1})])]),(0,n._)("div",Me,[(0,n._)("div",Ue,(0,s.zw)(e.$t("pages.line_items_columns.POSITION")),1),(0,n._)("div",He,(0,s.zw)(e.$t("accounts")),1),Be]),0===e.predictions_by_mode.length?((0,n.wg)(),(0,n.iD)("div",je,[(0,n._)("div",Ke,(0,s.zw)(e.$t("no_predictions_found")),1)])):(0,n.kq)("",!0),((0,n.wg)(!0),(0,n.iD)(n.HY,{key:1},(0,n.Ko)(e.predictions_by_mode,((t,i)=>((0,n.wg)(),(0,n.iD)(n.HY,{key:i},[(0,n._)("div",Ye,[(0,n._)("div",Je,[(0,n._)("span",null,(0,s.zw)(i),1)])]),(0,n._)("div",Ne,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t,(t=>((0,n.wg)(),(0,n.iD)("div",{key:t,class:"col-6 q-mb-sm"},[(0,n._)("div",Re,[(0,n._)("div",Ge,[((0,n.wg)(),(0,n.j4)(m,{modelValue:t.checked,"onUpdate:modelValue":e=>t.checked=e,label:t.account_obj.label,key:e.index+"_"+t.account_obj.value},null,8,["modelValue","onUpdate:modelValue","label"]))]),(0,n._)("div",Xe,[(0,n.Wm)(_,{"show-value":"","font-size":"12px",value:t.percentage,size:"40px",thickness:.22,color:t.percentage>55?"primary":"red"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(t.percentage)+"% ",1)])),_:2},1032,["value","thickness","color"])])])])))),128))]),(0,n.Wm)(p,{class:"q-mt-sm"})],64)))),128))])),_:1}),(0,n.Wm)(w,{align:"right"},{default:(0,n.w5)((()=>[(0,n.Wm)(g,{appearance:"cancel",label:e.$t("cancel"),onClick:e.closeDialog},null,8,["label","onClick"]),(0,n.Wm)(g,{class:"float-right btns",label:e.$t("proceed"),onClick:t[0]||(t[0]=t=>e.proceed())},null,8,["label"])])),_:1})])),_:1})}const tt=(0,n.aZ)({mixins:[S.Z],props:{},components:{},watch:{},emits:["itemSelected","cleanupOnhide"],computed:{},mounted(){window.accp=this},methods:{proceed(){this.saveSelections(),this.closeDialog()},saveSelections(){for(let[e,t]of Object.entries(this.predictions_by_mode)){const t=this.predictions_by_mode[e];let i=[];for(const[e,s]of t.entries())s.checked&&(s.checked=!1,i.push(s));if(0===i.length)continue;const n=t[0].line_index;this.updateAccountInStore(n,null,{}),this.lineItems[n].split_items=[],1===i.length&&this.updateAccountInStore(n,null,i[0].account_obj),i.length>1&&this.makeSplittedLineItems(i,n)}},makeSplittedLineItems(e,t){for(const[i,n]of e.entries()){const e=this.baseSplitLineItem();e.percentage="0%",this.lineItems[t].split_items.push(e),this.updateAccountInStore(t,i,n.account_obj)}this.autFillEmptyLineItems(t)},closeDialog(){this.$emit("cleanupOnhide")}},setup(){const e=(0,z.f5)(),{total_line_predictions:t,line_items_line_predictions:i,accounting_mode:n,lineItems:s,predictions_by_mode:o,prediction_selections:l}=(0,L.Jk)(e),{updateAccount:a,hasTotalPredictions:r,hasLineItemsPredictions:d,getTotalLineIndex:c,baseSplitLineItem:u,autFillEmptyLineItems:m}=e;return{predictions_by_mode:o,updateAccountInStore:a,autFillEmptyLineItems:m,baseSplitLineItem:u,lineItems:s,getTotalLineIndex:c,hasTotalPredictions:r,hasLineItemsPredictions:d,accounting_mode:n,total_line_predictions:t,line_items_line_predictions:i,prediction_selections:l}}});var it=i(44458),nt=i(51663),st=i(81973),ot=i(63190),lt=i(61357),at=i(11221),rt=i(83302),dt=i(50926),ct=i(11821);const ut=(0,R.Z)(tt,[["render",et]]),mt=ut;te()(tt,"components",{QCard:it.Z,QToolbar:nt.Z,QToolbarTitle:st.Z,QBtn:Ae.Z,QCardSection:ot.Z,QAvatar:lt.Z,QCheckbox:at.Z,QCircularProgress:rt.Z,QSeparator:dt.Z,QCardActions:ct.Z});const _t=(0,n.aZ)({mixins:[S.Z],props:{},components:{PredictionPopup:mt},watch:{},computed:{},methods:{showPredictions(){this.show_popup=!0},cleanupOnhide(){this.show_popup=!1}},setup(){const e=(0,z.f5)(),{is_view_readonly:t}=(0,L.Jk)(e);return{is_view_readonly:t,show_popup:(0,W.iH)(!1)}}}),pt=(0,R.Z)(_t,[["render",ze]]),ht=pt;te()(_t,"components",{QBtn:Ae.Z,QTooltip:Ce.Z,QDialog:De.Z});const gt={key:0,class:"row full-width q-mb-sm"},wt={class:"col-4"},yt={class:"col-8"},vt={class:"fixed-height-div scrolle-y"},ft={class:"q-ml-sm"},xt={class:"q-ml-sm"};function It(e,t,i,o,l,a){const r=(0,n.up)("q-tooltip"),d=(0,n.up)("q-btn"),c=(0,n.up)("TrainingModel"),u=(0,n.up)("TestModel"),m=(0,n.up)("q-avatar"),_=(0,n.up)("q-card-section"),p=(0,n.up)("f-btn"),h=(0,n.up)("q-card-actions"),g=(0,n.up)("q-card"),w=(0,n.up)("q-dialog"),y=(0,n.Q2)("close-popup");return(0,n.wg)(),(0,n.iD)(n.HY,null,[e.is_view_readonly?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",gt,[(0,n._)("div",wt,[(0,n.Wm)(d,{class:"bg-primary text-white",unelevated:"",tabindex:"1",onClick:t[0]||(t[0]=t=>e.confirm_all_training_delete=!0),label:e.$t("Delete All"),disabled:e.is_view_readonly},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("delete_all_training_for_this_org")),1)])),_:1})])),_:1},8,["label","disabled"])]),(0,n._)("div",yt,[(0,n.Wm)(d,{class:"bg-primary text-white q-mr-sm",unelevated:"",tabindex:"1",onClick:t[1]||(t[1]=t=>e.confirm_supplier_training_delete=!0),label:e.$t("Delete Supplier Training"),disabled:e.is_view_readonly},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("delete_current_supplier_training")),1)])),_:1})])),_:1},8,["label","disabled"])])])),(0,n._)("div",vt,[(0,n.Wm)(c),(0,n.Wm)(u)]),(0,n.Wm)(w,{modelValue:e.confirm_all_training_delete,"onUpdate:modelValue":t[4]||(t[4]=t=>e.confirm_all_training_delete=t),onKeydown:t[5]||(t[5]=(0,Ve.D2)((t=>e.confirm_all_training_delete=!1),["esc"])),onHide:t[6]||(t[6]=t=>e.confirm_all_training_delete=!1)},{default:(0,n.w5)((()=>[(0,n.Wm)(g,null,{default:(0,n.w5)((()=>[(0,n.Wm)(_,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,n.w5)((()=>[(0,n.Wm)(m,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,n.Wm)(_,{class:"row items-center"},{default:(0,n.w5)((()=>[(0,n._)("span",ft,(0,s.zw)(e.$t("confirm_all_training_delete")),1)])),_:1}),(0,n.Wm)(h,{align:"right"},{default:(0,n.w5)((()=>[(0,n.wy)((0,n.Wm)(p,{appearance:"cancel",label:e.$t("cancel"),onClick:t[2]||(t[2]=t=>e.confirm_all_training_delete=!1)},null,8,["label"]),[[y]]),(0,n.Wm)(p,{label:e.$t("proceed"),class:"q-mr-sm",onClick:t[3]||(t[3]=t=>e.deleteAllTrainings())},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,n.Wm)(w,{modelValue:e.confirm_supplier_training_delete,"onUpdate:modelValue":t[9]||(t[9]=t=>e.confirm_supplier_training_delete=t),onKeydown:t[10]||(t[10]=(0,Ve.D2)((t=>e.confirm_supplier_training_delete=!1),["esc"])),onHide:t[11]||(t[11]=t=>e.confirm_supplier_training_delete=!1)},{default:(0,n.w5)((()=>[(0,n.Wm)(g,null,{default:(0,n.w5)((()=>[(0,n.Wm)(_,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,n.w5)((()=>[(0,n.Wm)(m,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,n.Wm)(_,{class:"row items-center"},{default:(0,n.w5)((()=>[(0,n._)("span",xt,(0,s.zw)(e.$t("confirm_supplier_training_delete")),1)])),_:1}),(0,n.Wm)(h,{align:"right"},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{appearance:"cancel",label:e.$t("cancel"),onClick:t[7]||(t[7]=t=>e.confirm_supplier_training_delete=!1)},null,8,["label"]),(0,n.Wm)(p,{label:e.$t("proceed"),class:"q-mr-sm",onClick:t[8]||(t[8]=t=>e.deleteCurrentSupplierTraining())},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var bt=i(49341);const kt={class:"border-left-bdbdbd border-bottom-bdbdbd border-right-bdbdbd border-top-bdbdbd"},qt={class:"row mb-10 mt-8 q-ml-sm full-width table-header"},At={key:0,class:"col-4"},Dt={class:"q-ml-sm"},Lt={class:"q-ml-sm"},St=(0,n._)("div",{class:"col-2"},null,-1),Zt={key:0,class:"col-4"},Wt={class:"ellipsis"},Pt={class:"col-2 flex-center"};function Ct(e,t,i,o,l,a){const r=(0,n.up)("q-space"),d=(0,n.up)("q-separator"),c=(0,n.up)("q-tooltip"),u=(0,n.up)("q-icon"),m=(0,n.up)("q-input"),_=(0,n.up)("q-select"),p=(0,n.up)("q-btn"),h=(0,n.up)("q-card-actions"),g=(0,n.up)("q-expansion-item");return(0,n.wg)(),(0,n.iD)("div",kt,[(0,n.Wm)(g,{"expand-separator":"","header-class":"highlighted-back"},{header:(0,n.w5)((()=>[(0,n._)("span",null,(0,s.zw)(e.$t("train_data")),1),(0,n.Wm)(r)])),default:(0,n.w5)((()=>[(0,n.Wm)(d),(0,n._)("div",qt,["total_line"!==e.accounting_mode?((0,n.wg)(),(0,n.iD)("div",At,[(0,n._)("span",Dt,(0,s.zw)(e.$t("description")),1)])):(0,n.kq)("",!0),(0,n._)("div",{class:(0,s.C_)("total_line"!==e.accounting_mode?"col-6":"col-10")},[(0,n._)("span",Lt,(0,s.zw)(e.$t("account")),1)],2),St]),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.training_data,((t,i)=>((0,n.wg)(),(0,n.iD)("div",{key:i,class:"row mb-10 mt-8 q-ml-sm full-width"},["total_line"!==e.accounting_mode?((0,n.wg)(),(0,n.iD)("div",Zt,[(0,n.Wm)(m,{readonly:!0,dense:"",outlined:"",modelValue:t["description"],"onUpdate:modelValue":e=>t["description"]=e,class:(0,s.C_)("q-pl-sm accouting-input ")},{append:(0,n.w5)((()=>[""!==e.errors[i]["description"]?((0,n.wg)(),(0,n.j4)(u,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,n.kq)("",!0)])),_:2},1032,["modelValue","onUpdate:modelValue"])])):(0,n.kq)("",!0),(0,n._)("div",{class:(0,s.C_)(["account-container","total_line"!==e.accounting_mode?"col-6":"col-10"])},[(0,n.Wm)(_,{dense:"",tabindex:"1",class:"q-mr-sm q-pl-sm accounting-select account-select",clearable:"","use-input":"",outlined:"",modelValue:t["ledger_account"],"onUpdate:modelValue":e=>t["ledger_account"]=e,loading:!e.accounts_loaded,options:e.filterAccounts,onFilter:e.filterAccountsEvent,disable:e.is_view_readonly,"emit-value":"","map-options":""},{"selected-item":(0,n.w5)((e=>[(0,n._)("div",Wt,(0,s.zw)(e.opt.label),1)])),append:(0,n.w5)((()=>[""!==e.errors[i]["ledger_account"]?((0,n.wg)(),(0,n.j4)(u,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("pages.api_user_messages.FIELD_REQUIRED")),1)])),_:1})])),_:1})):(0,n.kq)("",!0)])),_:2},1032,["modelValue","onUpdate:modelValue","loading","options","onFilter","disable"])],2),(0,n._)("div",Pt,[(0,n.Wm)(u,{tabindex:"1",name:"img:trash-bin-default.svg",size:"22px",onClick:t=>e.deleteRow(i),onKeydown:(0,Ve.D2)((t=>e.deleteRow(i)),["enter"]),class:(0,s.C_)(["cursor-pointer q-ml-sm mt-4",e.is_view_readonly?"disabled":""])},null,8,["onClick","onKeydown","class"])])])))),128)),(0,n.Wm)(h,{align:"right"},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{unelevated:"",color:"grey",class:"q-mr-sm",label:e.$t("refresh"),onClick:t[0]||(t[0]=t=>e.refresh())},null,8,["label"]),(0,n.Wm)(p,{unelevated:"",color:"primary",class:"q-mr-sm",label:e.$t("train"),onClick:e.trainModelProceed},null,8,["label","onClick"])])),_:1})])),_:1})])}var Tt=function(e,t,i,n){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function l(e){try{r(n.next(e))}catch(t){o(t)}}function a(e){try{r(n["throw"](e))}catch(t){o(t)}}function r(e){e.done?i(e.value):s(e.value).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const $t=(0,n.aZ)({mixins:[S.Z,F.Z],props:{},components:{},watch:{accounting_mode:{handler:function(e,t){e!==t&&this.init()}}},computed:{},mounted:function(){this.init()},methods:{init(){try{if(this.training_data=[],!this.supplier_name)return;for(const e of this.lineItems)"line_items"===this.accounting_mode&&"total_line_item"===e.type||"total_line"===this.accounting_mode&&"line_item"===e.type||this.addEmptyTrainingLine({description:e.description})}catch(e){}},refresh(){this.is_view_readonly||(this.supplier_name?this.init():this.showErrorToast(this.$t("missing_supplier_warning")))},addEmptyTrainingLine(e={}){const t={supplier_name:this.supplier_name,ledger_account:""},i=Object.assign(e,t);this.training_data.push(i);const n=Object.assign({},{ledger_account:"",description:""});this.errors.push(n)},renderTrainingData(){},deleteRow(e){this.training_data.splice(e,1),this.errors.splice(e,1)},filterAccountsEvent(e,t,i){t(e?()=>{this.filterAccounts=this.accountFilterByAnyValue(e)}:()=>{this.filterAccounts=this.accounts})},trainModelProceed(){return Tt(this,void 0,void 0,(function*(){try{if(this.is_view_readonly)return;if(!this.supplier_name)return void this.showErrorToast(this.$t("missing_supplier_warning"));if(this.validateTrainingData())return;this.showLoading();const e={line_items:JSON.stringify(this.training_data)},t=yield bt.mj.trainModel(e);if(!1===t.success)throw{message:t.data};this.training_data.map((e=>(delete e["ledger_account"],e)));const i=this.getLineItemsForPredictionAccount(),n={line_items:JSON.stringify(i)};this.getPredictions(n),this.showSuccessToast(this.$t("train_model_success_test"))}catch(e){const t=$.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.hideLoading()}}))},validateTrainingData(){let e=!1;for(const[t,i]of this.training_data.entries())this.errors[t]["supplier_name"]="",""===i["supplier_name"]&&(this.errors[t]["supplier_name"]="error",e=!0),this.errors[t]["ledger_account"]="",""===i["ledger_account"]&&(e=!0,this.errors[t]["ledger_account"]="error"),this.errors[t]["description"]="","line_items"===this.accounting_mode&&""===i["description"]&&(e=!0,this.errors[t]["description"]="error");return e}},setup(){const e=(0,z.f5)(),{accountFilterByAnyValue:t,is_view_readonly:i,supplier_name:n,accounts:s,accounts_loaded:o,accounting_mode:l,lineItems:a}=(0,L.Jk)(e),{getPredictions:r,getLineItemsForPredictionAccount:d}=e,c=(0,W.iH)(e.accounts);return{getLineItemsForPredictionAccount:d,lineItems:a,getPredictions:r,accounts_loaded:o,accounts:s,accountFilterByAnyValue:t,filterAccounts:c,accounting_mode:l,is_view_readonly:i,supplier_name:n,training_data:(0,W.iH)([]),errors:(0,W.iH)([])}}});var Vt=i(50651),zt=i(90136),Et=i(13119),Ot=i(32259);const Ft=(0,R.Z)($t,[["render",Ct]]),Qt=Ft;te()($t,"components",{QExpansionItem:Vt.Z,QSpace:zt.Z,QSeparator:dt.Z,QInput:Et.Z,QIcon:G.Z,QTooltip:Ce.Z,QSelect:Ot.Z,QCardActions:ct.Z,QBtn:Ae.Z});const Mt={class:"border-left-bdbdbd border-bottom-bdbdbd border-right-bdbdbd border-top-bdbdbd q-mt-sm"},Ut={key:0,class:"row q-pl-sm q-pt-sm total-line-item-area"},Ht={class:"col-12 flex flex-center"},Bt={class:"col-12 q-pl-sm text-weight-bold"},jt={class:"col-11 q-mt-sm q-pl-md"},Kt={class:"col-1"},Yt={class:"col-12 q-mb-sm q-mt-sm"},Jt={class:"q-ml-sm"};function Nt(e,t,i,o,l,a){const r=(0,n.up)("q-space"),d=(0,n.up)("q-separator"),c=(0,n.up)("q-circular-progress"),u=(0,n.up)("q-tooltip"),m=(0,n.up)("q-icon"),_=(0,n.up)("q-btn"),p=(0,n.up)("q-card-actions"),h=(0,n.up)("q-expansion-item"),g=(0,n.up)("q-avatar"),w=(0,n.up)("q-card-section"),y=(0,n.up)("f-btn"),v=(0,n.up)("q-card"),f=(0,n.up)("q-dialog");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",Mt,[(0,n.Wm)(h,{"expand-separator":"","header-class":"highlighted-back"},{header:(0,n.w5)((()=>[(0,n._)("span",null,(0,s.zw)(e.$t("test_data")),1),(0,n.Wm)(r)])),default:(0,n.w5)((()=>[(0,n.Wm)(d),e.test_clicked?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[0===e.has_predictions?((0,n.wg)(),(0,n.iD)("div",Ut,[(0,n._)("div",Ht,(0,s.zw)(e.$t("no_predictions_found")),1)])):(0,n.kq)("",!0),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.predictions_by_mode,((t,i)=>((0,n.wg)(),(0,n.iD)("div",{key:i,class:"row q-mt-sm"},[(0,n._)("div",Bt,(0,s.zw)(i),1),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t,((t,i)=>((0,n.wg)(),(0,n.iD)(n.HY,{key:i},[(0,n._)("div",jt,[(0,n.Wm)(c,{"show-value":"","font-size":"12px",value:t.percentage,size:"40px",thickness:.22,color:t.percentage>55?"primary":"red"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(t.percentage)+"% ",1)])),_:2},1032,["value","thickness","color"]),(0,n.Uk)(" "+(0,s.zw)(t.account_obj.label),1)]),(0,n._)("div",Kt,[(0,n.Wm)(m,{tabindex:"1",name:"img:trash-bin-default.svg",size:"22px",onClick:i=>e.deletePredictionData(t),onKeydown:(0,Ve.D2)((i=>e.deletePredictionData(t)),["enter"]),class:(0,s.C_)(["cursor-pointer q-ml-sm mt-4",e.is_view_readonly?"disabled":""])},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("delete_prediction_data_for_this_account")),1)])),_:1})])),_:2},1032,["onClick","onKeydown","class"])])],64)))),128)),(0,n._)("div",Yt,[(0,n.Wm)(d)])])))),128))],64)):(0,n.kq)("",!0),(0,n.Wm)(p,{align:"right"},{default:(0,n.w5)((()=>[(0,n.Wm)(_,{unelevated:"",color:"primary",class:"q-mr-sm",label:e.$t("test"),onClick:e.Proceed},null,8,["label","onClick"])])),_:1})])),_:1})]),(0,n.Wm)(f,{modelValue:e.confirm_ledger_account_delete,"onUpdate:modelValue":t[2]||(t[2]=t=>e.confirm_ledger_account_delete=t),onKeydown:t[3]||(t[3]=(0,Ve.D2)((t=>e.confirm_ledger_account_delete=!1),["esc"])),onHide:t[4]||(t[4]=t=>e.confirm_ledger_account_delete=!1)},{default:(0,n.w5)((()=>[(0,n.Wm)(v,null,{default:(0,n.w5)((()=>[(0,n.Wm)(w,{class:"row",style:{"justify-content":"center",display:"flex"}},{default:(0,n.w5)((()=>[(0,n.Wm)(g,{icon:"warning",color:"primary","text-color":"white"})])),_:1}),(0,n.Wm)(w,{class:"row items-center"},{default:(0,n.w5)((()=>[(0,n._)("span",Jt,(0,s.zw)(e.$t("confirm_ledger_account_delete")),1)])),_:1}),(0,n.Wm)(p,{align:"right"},{default:(0,n.w5)((()=>[(0,n.Wm)(y,{appearance:"cancel",label:e.$t("cancel"),onClick:t[0]||(t[0]=t=>e.confirm_ledger_account_delete=!1)},null,8,["label"]),(0,n.Wm)(y,{label:e.$t("proceed"),class:"q-mr-sm",onClick:t[1]||(t[1]=t=>e.deleteSupplierLedgerAccount())},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var Rt=i(96427),Gt=function(e,t,i,n){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function l(e){try{r(n.next(e))}catch(t){o(t)}}function a(e){try{r(n["throw"](e))}catch(t){o(t)}}function r(e){e.done?i(e.value):s(e.value).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const Xt=(0,n.aZ)({mixins:[S.Z,F.Z],props:{},components:{},watch:{accounting_mode:{handler:function(e,t){e!==t&&this.init()}}},computed:{has_predictions(){return"total_line"===this.accounting_mode?this.total_line_predictions.length>0:this.line_items_line_predictions.length>0}},mounted:function(){this.init(),window.tm=this},methods:{init(){try{if(this.is_view_readonly)return;this.testing_data=[],this.addEmptyLine()}catch(e){}},addEmptyLine(){const e={supplier_name:this.supplier_name};"total_line"!==this.accounting_mode&&(e["description"]=""),this.testing_data.push(e)},deleteRow(e){this.testing_data.splice(e,1)},Proceed(){return Gt(this,void 0,void 0,(function*(){try{if(this.is_view_readonly)return;if(!this.supplier_name)return void this.showErrorToast(this.$t("missing_supplier_warning"));this.showLoading();const e=this.getLineItemsForPredictionAccount(),t={line_items:JSON.stringify(e)};yield this.getPredictions(t),this.test_clicked=!0}catch(e){const t=$.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.hideLoading()}}))},deletePredictionData(e){this.is_view_readonly||(this.supplier_name?(this.deletionItem=e,this.confirm_ledger_account_delete=!0):this.showErrorToast(this.$t("missing_supplier_warning")))},deleteSupplierLedgerAccount(){return Gt(this,void 0,void 0,(function*(){try{if(this.is_view_readonly||0===(0,Rt.v7)(this.deletionItem))return;const e={supplier:this.supplier_name,ledger_account:this.deletionItem.account_obj.id};this.deletionItem.hasOwnProperty("description")&&(e["description"]=this.deletionItem.description),this.showLoading();const t=yield bt.mj.deleteTrainingData(e);if(!1===t.success)throw{message:t.message};yield this.Proceed(),this.showSuccessToast(this.$t("selected_training_deleted")),this.confirm_ledger_account_delete=!1}catch(e){const t=$.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.hideLoading()}}))}},setup(){const e=(0,z.f5)(),{total_line_predictions:t,line_items_line_predictions:i,is_view_readonly:n,supplier_name:s,accounting_mode:o,predictions_by_mode:l}=(0,L.Jk)(e),{getPredictions:a,getLineItemsForPredictionAccount:r}=e;return{predictions_by_mode:l,getLineItemsForPredictionAccount:r,total_line_predictions:t,line_items_line_predictions:i,getPredictions:a,accounting_mode:o,is_view_readonly:n,supplier_name:s,testing_data:(0,W.iH)([]),test_clicked:(0,W.iH)(!1),deletionItem:(0,W.iH)({}),confirm_ledger_account_delete:(0,W.iH)(!1)}}}),ei=(0,R.Z)(Xt,[["render",Nt]]),ti=ei;te()(Xt,"components",{QExpansionItem:Vt.Z,QSpace:zt.Z,QSeparator:dt.Z,QCircularProgress:rt.Z,QIcon:G.Z,QTooltip:Ce.Z,QCardActions:ct.Z,QBtn:Ae.Z,QDialog:De.Z,QCard:it.Z,QCardSection:ot.Z,QAvatar:lt.Z});var ii=function(e,t,i,n){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function l(e){try{r(n.next(e))}catch(t){o(t)}}function a(e){try{r(n["throw"](e))}catch(t){o(t)}}function r(e){e.done?i(e.value):s(e.value).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const ni=(0,n.aZ)({mixins:[S.Z,F.Z],props:{},components:{TrainingModel:Qt,TestModel:ti},watch:{},computed:{},mounted:function(){},methods:{deleteAllTrainings(){return ii(this,void 0,void 0,(function*(){try{this.showLoading();const e={all:!0},t=yield bt.mj.deleteTrainingData(e);if(!1===t.success)throw{message:t.message};this.clearPredictions(),this.showSuccessToast(this.$t("all_trainings_deleted")),this.confirm_all_training_delete=!1}catch(e){const t=$.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.hideLoading()}}))},deleteCurrentSupplierTraining(){return ii(this,void 0,void 0,(function*(){try{if(!this.supplier_name)throw{message:this.$t("supplier_not_found")};this.showLoading();const e={supplier:this.supplier_name},t=yield bt.mj.deleteTrainingData(e);if(!1===t.success)throw{message:t.message};this.clearPredictions(),this.showSuccessToast(this.$t("supplier_training_deleted")),this.confirm_supplier_training_delete=!1}catch(e){const t=$.w.getErrorMessage(e);this.showErrorToast(t)}finally{this.hideLoading()}}))}},setup(){const e=(0,z.f5)(),{is_view_readonly:t,supplier_name:i}=(0,L.Jk)(e),{clearPredictions:n}=e;return{clearPredictions:n,is_view_readonly:t,show_popup:(0,W.iH)(!1),supplier_name:i,confirm_all_training_delete:(0,W.iH)(!1),confirm_supplier_training_delete:(0,W.iH)(!1)}}});var si=i(62146);const oi=(0,R.Z)(ni,[["render",It],["__scopeId","data-v-12545fbf"]]),li=oi;te()(ni,"components",{QBtn:Ae.Z,QTooltip:Ce.Z,QDialog:De.Z,QCard:it.Z,QCardSection:ot.Z,QAvatar:lt.Z,QCardActions:ct.Z}),te()(ni,"directives",{ClosePopup:si.Z});const ai={key:0,class:"line-item-container ml-16 q-mr-sm"},ri={class:"lineItems"},di={class:"row items-center table-header"},ci={class:"",style:{width:"4%"}},ui={class:"header",style:{width:"8%"}},mi={class:"header",style:{width:"37%"}},_i={class:"header",style:{width:"36%"}},pi=(0,n._)("div",{class:"",style:{width:"15%"}},null,-1),hi={class:"row items-center q-mt-sm"},gi={style:{width:"3%"}},wi={class:"q-ma-sm bg-primary primary-bg-text",style:{width:"22px",display:"inline-block"}},yi=(0,n._)("div",{style:{width:"97%"}},null,-1);function vi(e,t,i,o,l,a){const r=(0,n.up)("q-fab"),d=(0,n.up)("TotalLineItem"),c=(0,n.up)("q-separator"),u=(0,n.up)("lineItem"),m=(0,n.up)("q-tooltip"),_=(0,n.up)("q-icon");return e.line_item_loaded&&e.accounts_loaded?((0,n.wg)(),(0,n.iD)("div",ai,[(0,n._)("div",ri,[(0,n._)("div",di,[(0,n._)("div",ci,[(0,n.Wm)(r,{square:"",flat:"",modelValue:e.fab1,"onUpdate:modelValue":t[0]||(t[0]=t=>e.fab1=t),icon:"keyboard_arrow_up",class:"multi-fab",direction:"down",padding:"xs","active-icon":"keyboard_arrow_down","label-class":"",style:{width:"40px"}},null,8,["modelValue"])]),(0,n._)("div",ui,(0,s.zw)(e.$t("pages.line_items_columns.POSITION")),1),(0,n._)("div",mi,(0,s.zw)(e.$t("accounts")),1),(0,n._)("div",_i,(0,s.zw)(e.$t("amount_title")),1),pi]),(0,n.Wm)(d),(0,n.Wm)(c),"line_items"===e.accounting_mode?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.lineItems,((e,t)=>((0,n.wg)(),(0,n.iD)(n.HY,{key:e},["line_item"===e.type?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n.Wm)(u,{index:t},null,8,["index"]),(0,n.Wm)(c,{class:"q-mt-sm"})],64)):(0,n.kq)("",!0)],64)))),128)),(0,n._)("div",hi,[(0,n._)("div",gi,[(0,n._)("div",wi,[(0,n.Wm)(_,{name:"add",size:"22px",onClick:e.addLineItem,onKeydown:(0,Ve.D2)(e.addLineItem,["enter"]),tabindex:"1",class:(0,s.C_)(["cursor-pointer",e.is_view_readonly?"disabled":""])},{default:(0,n.w5)((()=>[(0,n.Wm)(m,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("add_new_line_item")),1)])),_:1})])),_:1},8,["onClick","onKeydown","class"])])]),yi])],64)):(0,n.kq)("",!0)])])):(0,n.kq)("",!0)}const fi=["id","data-id"],xi=(0,n._)("div",{class:"",style:{width:"4%"}},null,-1),Ii={class:"",style:{width:"8%"}},bi={key:0},ki={class:"account-container",style:{width:"37%"}},qi={class:"dimensions",style:{"padding-right":"9px"}},Ai={style:{width:"51%"}},Di={class:"row"},Li={style:{width:"71%"}},Si={style:{width:"29%"}},Zi={class:"q-ml-sm bg-primary primary-bg-text",style:{width:"22px",display:"inline-block"}},Wi={class:"splitted-line-items",style:{width:"100%"}},Pi={key:0,class:"row q-pt-sm"},Ci=(0,n._)("div",{style:{width:"12%"}},null,-1),Ti={style:{width:"37%"}},$i={class:"float-right q-mr-md"},Vi={style:{width:"51%"}},zi={key:0,style:{"margin-left":"12px"}};function Ei(e,t,i,o,l,a){const r=(0,n.up)("Account"),d=(0,n.up)("Dimensions"),c=(0,n.up)("Amount"),u=(0,n.up)("SplitLineItemBtn"),m=(0,n.up)("UnSplitLineItemBtn"),_=(0,n.up)("AddChildLineItem"),p=(0,n.up)("SplitedLineItems"),h=(0,n.up)("q-tooltip"),g=(0,n.up)("q-icon");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",{class:"row q-mt-sm",id:e.lineItems[e.index].id,"data-id":e.lineItems[e.index].id},[xi,(0,n._)("div",Ii,[e.lineItems[e.index].hasOwnProperty("position")?((0,n.wg)(),(0,n.iD)("span",bi,(0,s.zw)(e.lineItems[e.index].position),1)):(0,n.kq)("",!0)]),(0,n._)("div",ki,[(0,n.Wm)(r,{readonly:e.lineItems[e.index].readonly,onUpdateAccount:e.updateAccount,item:e.lineItems[e.index],index:e.index},null,8,["readonly","onUpdateAccount","item","index"]),(0,n._)("div",qi,[(0,n.Wm)(d,{index:e.index},null,8,["index"])])]),(0,n._)("div",Ai,[(0,n._)("div",Di,[(0,n._)("div",Li,[(0,n.Wm)(c,{index:e.index},null,8,["index"])]),(0,n._)("div",Si,[(0,n.Wm)(u,{index:e.index},null,8,["index"]),(0,n.Wm)(m,{index:e.index},null,8,["index"]),(0,n._)("div",Zi,[(0,n.Wm)(_,{index:e.index},null,8,["index"])])])])])],8,fi),(0,n._)("div",Wi,[(0,n.Wm)(p,{index:e.index},null,8,["index"])]),e.lineItems[e.index].split_items.length>0?((0,n.wg)(),(0,n.iD)("div",Pi,[Ci,(0,n._)("div",Ti,[(0,n._)("span",$i,(0,s.zw)(e.$t("unsettled_amount"))+": ",1)]),(0,n._)("div",Vi,[e.lineItems[e.index].hasOwnProperty("pending_amount")?((0,n.wg)(),(0,n.iD)("span",zi,(0,s.zw)(e.lineItems[e.index].pending_amount),1)):(0,n.kq)("",!0),""!==e.lineItems[e.index].error?((0,n.wg)(),(0,n.j4)(g,{key:1,flat:"",dense:"",name:"error",size:"20px",color:"red",class:"q-ml-sm"},{default:(0,n.w5)((()=>[(0,n.Wm)(h,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.lineItems[e.index].error),1)])),_:1})])),_:1})):(0,n.kq)("",!0)])])):(0,n.kq)("",!0)],64)}const Oi=["id","data-id"],Fi=(0,n._)("div",{class:"",style:{width:"12%"}},null,-1),Qi={class:"account-container",style:{width:"37%"}},Mi={class:"dimensions",style:{"padding-right":"9px"}},Ui={style:{width:"36%"}},Hi={style:{width:"15%"}},Bi=(0,n._)("img",{width:"20",src:"trash-bin-default.svg"},null,-1);function ji(e,t,i,o,l,a){const r=(0,n.up)("Account"),d=(0,n.up)("Dimensions"),c=(0,n.up)("Amount"),u=(0,n.up)("Percent"),m=(0,n.up)("q-icon");return(0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.lineItems[e.index].split_items,((t,i)=>((0,n.wg)(),(0,n.iD)("div",{key:t,class:"row q-pt-sm",id:t.id,"data-id":t.id},[Fi,(0,n._)("div",Qi,[(0,n.Wm)(r,{readonly:t.readonly,onUpdateAccount:e.updateAccount,item:t,index:i},null,8,["readonly","onUpdateAccount","item","index"]),(0,n._)("div",Mi,[(0,n.Wm)(d,{line_item_index:e.index,split_line_index:i},null,8,["line_item_index","split_line_index"])])]),(0,n._)("div",Ui,[(0,n.Wm)(c,{line_item_index:e.index,split_line_index:i},null,8,["line_item_index","split_line_index"]),(0,n.Wm)(u,{line_item_index:e.index,split_line_index:i},null,8,["line_item_index","split_line_index"])]),(0,n._)("div",Hi,[(0,n.Wm)(m,{class:(0,s.C_)(["q-ml-sm cursor-pointer accounting-icon",e.is_view_readonly?"disabled":""]),tabindex:"1",color:"grey",size:"md",onClick:t=>e.deleteLineItem(i,e.index),onKeydown:(0,Ve.D2)((t=>e.deleteLineItem(i,e.index)),["enter"])},{default:(0,n.w5)((()=>[Bi])),_:2},1032,["onClick","onKeydown","class"])])],8,Oi)))),128)}function Ki(e,t,i,o,l,a){const r=(0,n.up)("q-tooltip"),d=(0,n.up)("q-icon"),c=(0,n.up)("q-input");return(0,n.wg)(),(0,n.j4)(c,{tabindex:"1",class:"accouting-input column inline",style:{width:"70%"},outlined:"",modelValue:e.lineItems[e.line_item_index].split_items[e.split_line_index].amount,"onUpdate:modelValue":t[0]||(t[0]=t=>e.lineItems[e.line_item_index].split_items[e.split_line_index].amount=t),onKeyup:t[1]||(t[1]=(0,Ve.D2)((t=>e.handleAmountEnter(e.lineItems[e.line_item_index].split_items[e.split_line_index])),["enter"])),disable:!!e.is_view_readonly},{append:(0,n.w5)((()=>[""!==e.lineItems[e.line_item_index].split_items[e.split_line_index]["amount_error"]?((0,n.wg)(),(0,n.j4)(d,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.lineItems[e.line_item_index].split_items[e.split_line_index]["amount_error"]),1)])),_:1})])),_:1})):(0,n.kq)("",!0)])),_:1},8,["modelValue","disable"])}var Yi=function(e,t,i,n){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function l(e){try{r(n.next(e))}catch(t){o(t)}}function a(e){try{r(n["throw"](e))}catch(t){o(t)}}function r(e){e.done?i(e.value):s(e.value).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const Ji=(0,n.aZ)({mixins:[],props:{line_item_index:{type:Number,required:!0},split_line_index:{type:Number,required:!0}},components:{},methods:{clearErrors(e){e.amount_error=""},validateAmountAndSetError(e,t){return t?!!(0,ve.hz)(t)||(e.amount_error=this.$t("amount_invalid"),!1):(e.amount_error=this.$t("amount_is_empty"),!1)},validateAmountUpdateAndSetError(e,t,i){return i?!(t>i)||(e.amount_error=this.$t("amount_cannot_be_greater_than_parent_amount"),!1):(e.amount_error=this.$t("parent_amount_is_empty"),!1)},handleAmountEnter(e){return Yi(this,void 0,void 0,(function*(){if(this.is_view_readonly)return;this.clearErrors(e);const t=e.amount;if(!this.validateAmountAndSetError(e,t))return;const i=this.lineItems[this.line_item_index].amount,n=[];n.push({key:t,value:t}),n.push({key:i,value:i});const s=yield this.formatMultiValues(n,this.amount_format_locale),o=this.searchValueByKey(t,s),l=parseFloat(o);if(!this.validateAmountAndSetError(e,l))return;e.amount_standard=l;const a=this.searchValueByKey(this.lineItems[this.line_item_index].amount,s),r=parseFloat(a);if(this.lineItems[this.line_item_index].amount_standard=r,!this.validateAmountUpdateAndSetError(e,l,r))return;const d=l/r*100;e.percentage=(yield this.formatValue(d.toFixed(2),"en_US",this.amount_format_locale))+"%",this.autFillEmptyLineItems(this.line_item_index)}))}},setup(){const e=(0,z.f5)(),{lineItems:t,amount_format_locale:i,is_view_readonly:n}=(0,L.Jk)(e),s=(0,z.V_)(),{formatMultiValues:o,formatValue:l}=s,{searchValueByKey:a,autFillEmptyLineItems:r}=e;return{autFillEmptyLineItems:r,searchValueByKey:a,is_view_readonly:n,formatMultiValues:o,formatValue:l,amount_format_locale:i,lineItems:t}}}),Ni=(0,R.Z)(Ji,[["render",Ki]]),Ri=Ni;function Gi(e,t,i,o,l,a){const r=(0,n.up)("q-tooltip"),d=(0,n.up)("q-icon"),c=(0,n.up)("q-input");return(0,n.wg)(),(0,n.j4)(c,{tabindex:"1",class:"accouting-input q-pl-sm column inline",style:{width:"30%"},outlined:"",modelValue:e.lineItems[e.line_item_index].split_items[e.split_line_index].percentage,"onUpdate:modelValue":t[0]||(t[0]=t=>e.lineItems[e.line_item_index].split_items[e.split_line_index].percentage=t),onKeyup:t[1]||(t[1]=(0,Ve.D2)((t=>e.handlePercdntEnter(e.lineItems[e.line_item_index].split_items[e.split_line_index])),["enter"])),disable:!!e.is_view_readonly},{append:(0,n.w5)((()=>[""!==e.lineItems[e.line_item_index].split_items[e.split_line_index]["percentage_error"]?((0,n.wg)(),(0,n.j4)(d,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.lineItems[e.line_item_index].split_items[e.split_line_index]["percentage_error"]),1)])),_:1})])),_:1})):(0,n.kq)("",!0)])),_:1},8,["modelValue","disable"])}te()(Ji,"components",{QInput:Et.Z,QIcon:G.Z,QTooltip:Ce.Z});var Xi=function(e,t,i,n){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function l(e){try{r(n.next(e))}catch(t){o(t)}}function a(e){try{r(n["throw"](e))}catch(t){o(t)}}function r(e){e.done?i(e.value):s(e.value).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const en=(0,n.aZ)({mixins:[],props:{line_item_index:{type:Number,required:!0},split_line_index:{type:Number,required:!0}},components:{},methods:{clearErrors(e){e.percentage_error=""},validateAmountAndSetError(e,t){return t?!!(0,ve.hz)(t)||(e.amount_error=this.$t("amount_invalid"),!1):(e.amount_error=this.$t("amount_is_empty"),!1)},validatePercentAndSetError(e,t){return t?!!(0,ve.hz)(t)||(e.percentage_error=this.$t("percentage_invalid"),!1):(e.percentage_error=this.$t("percentage_is_empty"),!1)},validatePercentUpdateAndSetError(e,t){return t?!(t>100)||(e.percentage_error=this.$t("percentage_cannot_be_greater_than_100"),!1):(e.percentage_error=this.$t("percentage_is_empty"),!1)},handlePercdntEnter(e){return Xi(this,void 0,void 0,(function*(){if(this.is_view_readonly)return;this.clearErrors(e);let t=this.lineItems[this.line_item_index].amount,i=e.percentage.replace("%","");if(!this.validateAmountAndSetError(e,t))return;const n=[];n.push({key:t,value:t}),n.push({key:i,value:i});const s=yield this.formatMultiValues(n,this.amount_format_locale),o=this.searchValueByKey(i,s),l=parseFloat(o);if(!this.validatePercentUpdateAndSetError(e,l))return;e.percent_float=l;const a=this.searchValueByKey(t,s),r=parseFloat(a);this.lineItems[this.line_item_index].amount_standard=r;const d=l/100*r,c=parseFloat(d.toFixed(2)),u=isNaN(c);u?e.amount="":(e.amount_standard=c,e.amount=yield this.formatValue(String(c),"en_US",this.amount_format_locale),this.autFillEmptyLineItems(this.line_item_index))}))}},setup(){const e=(0,z.f5)(),{lineItems:t,amount_format_locale:i,is_view_readonly:n}=(0,L.Jk)(e),{searchValueByKey:s,autFillEmptyLineItems:o}=e,l=(0,z.V_)(),{formatMultiValues:a,formatValue:r}=l;return{autFillEmptyLineItems:o,searchValueByKey:s,is_view_readonly:n,formatMultiValues:a,formatValue:r,amount_format_locale:i,lineItems:t}}}),tn=(0,R.Z)(en,[["render",Gi]]),nn=tn;te()(en,"components",{QInput:Et.Z,QIcon:G.Z,QTooltip:Ce.Z});const sn={class:"ellipsis"},on={class:"row full-width account-search-row q-mb-md back-white p-t-20"},ln={class:"grid account-categories"},an={class:"content"};function rn(e,t,i,o,l,a){const r=(0,n.up)("q-item-label"),d=(0,n.up)("q-item-section"),c=(0,n.up)("q-item"),u=(0,n.up)("q-tooltip"),m=(0,n.up)("q-icon"),_=(0,n.up)("q-select"),p=(0,n.up)("q-input"),h=(0,n.up)("DisplayAccounts"),g=(0,n.up)("q-card-section"),w=(0,n.up)("dialog-draggable");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(_,{tabindex:"1",class:"q-mr-sm accounting-select account-select",clearable:"","use-input":"",outlined:"",modelValue:e.localValue,"onUpdate:modelValue":t[1]||(t[1]=t=>e.localValue=t),loading:!e.accounts_loaded,options:e.filterAccounts,onFilter:e.filterAccountsEvent,disable:e.isReadOnly()},{"selected-item":(0,n.w5)((e=>[(0,n._)("div",sn,(0,s.zw)(e.opt.label),1)])),option:(0,n.w5)((e=>[(0,n.Wm)(c,(0,s.vs)((0,n.F4)(e.itemProps)),{default:(0,n.w5)((()=>[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[!1===e.opt.parent?((0,n.wg)(),(0,n.j4)(r,{key:0,class:(0,s.C_)("pl-20 ")},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.opt.label),1)])),_:2},1024)):((0,n.wg)(),(0,n.j4)(r,{key:1},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.opt.label),1)])),_:2},1024))])),_:2},1024)])),_:2},1040)])),append:(0,n.w5)((()=>[""!==e.account_error?((0,n.wg)(),(0,n.j4)(m,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.account_error),1)])),_:1})])),_:1})):(0,n.kq)("",!0),e.view_template===e.view_types.ln?((0,n.wg)(),(0,n.j4)(m,{key:1,flat:"",dense:"",size:"24px",class:"cursor-pointer",name:"list",onClick:t[0]||(t[0]=(0,Ve.iM)((t=>e.openAccountDialog()),["stop","prevent"]))},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("select_category_manually")),1)])),_:1})])),_:1})):(0,n.kq)("",!0)])),_:1},8,["modelValue","loading","options","onFilter","disable"]),(0,n.Wm)(w,{modelValue:e.display_accounts_dialog,"onUpdate:modelValue":t[3]||(t[3]=t=>e.display_accounts_dialog=t),"full-width":"",onKeydown:(0,Ve.D2)(e.closeDialog,["esc"]),title:e.$t("select_category_manually"),onOnHide:e.closeDialog,width:e.popup_width},{default:(0,n.w5)((()=>[(0,n.Wm)(g,{class:"account-container"},{default:(0,n.w5)((()=>[(0,n._)("div",on,[(0,n.Wm)(p,{modelValue:e.search_account,"onUpdate:modelValue":t[2]||(t[2]=t=>e.search_account=t),outlined:"",dense:"",class:"col-12",placeholder:e.$t("pages.user.search")+" ("+e.$t("after_typing_press_enter")+")",clearable:"",onClear:e.clearManualAccountsSearch,onKeyup:(0,Ve.D2)(e.searchAccounts,["enter"])},{append:(0,n.w5)((()=>[(0,n.Wm)(m,{name:"search",onClick:e.searchAccounts},null,8,["onClick"])])),_:1},8,["modelValue","placeholder","onClear","onKeyup"])]),(0,n._)("div",ln,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.dialogFilteredAccounts,((t,i)=>((0,n.wg)(),(0,n.iD)("div",{key:i,class:"item"},[(0,n._)("div",an,[(0,n.Wm)(h,{onAccountSelected:e.accountSelected,nodes:t},null,8,["onAccountSelected","nodes"])])])))),128))])])),_:1})])),_:1},8,["modelValue","onKeydown","title","onOnHide","width"])],64)}var dn=i(822);const cn={key:0,class:"childern account-categories-ul"};function un(e,t,i,o,l,a){const r=(0,n.up)("AccountCategory");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("span",{class:"account-link row cursor-pointer",onClick:t[0]||(t[0]=t=>e.accountSelected(e.nodes.value))},(0,s.zw)(e.nodes.label),1),e.nodes.children.length>0?((0,n.wg)(),(0,n.iD)("ul",cn,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.nodes.children,((t,i)=>((0,n.wg)(),(0,n.iD)("li",{key:i},[(0,n.Wm)(r,{onAccountSelected:e.accountSelected,nodes:t},null,8,["onAccountSelected","nodes"])])))),128))])):(0,n.kq)("",!0)],64)}const mn=(0,n.aZ)({name:"AccountCategory",props:{nodes:{type:Object,required:!0}},emits:["accountSelected"],methods:{accountSelected(e){this.$emit("accountSelected",e)}},setup(){return{}}}),_n=(0,R.Z)(mn,[["render",un]]),pn=_n,hn=(0,n.aZ)({mixins:[],props:{item:{type:Object,required:!0},readonly:{type:Boolean,default:!1},index:{type:Number,required:!0},child_index:{type:Number}},components:{dialogDraggable:dn.Z,DisplayAccounts:pn},emits:["update-account"],computed:{account_error:function(){return String(this.item.account_error)},show_auto_detect:function(){let e=!1;return this.hasTotalPredictions()&&(e=!0),this.hasLineItemsPredictions()&&(e=!0),e},localValue:{get(){return this.item.account},set(e){this.$emit("update-account",{index:this.index,value:e})}}},mounted(){this.popup_width=this.calculateWidthForPopuup(),window.addEventListener("resize",this.calculateWidthForPopuup)},unmounted:function(){window.removeEventListener("resize",this.calculateWidthForPopuup)},methods:{calculateWidthForPopuup(){let e="800";const t=document.querySelector(".accounting-area");if(!t)return e;const i=t.offsetWidth-300;return i<=0?e:String(i)},closeDialog(){this.dialogFilteredAccounts=this.categorized_accounts,this.display_accounts_dialog=!1},isReadOnly(){return!!this.is_view_readonly||(!!Boolean(this.item.readonly)||!!(this.item.hasOwnProperty("split_items")&&this.item.split_items.length>0))},filterAccountsEvent(e,t,i){t(e?()=>{this.filterAccounts=this.accountFilterByAnyValue(e)}:()=>{this.filterAccounts=this.accounts})},searchAccounts(){if(!this.search_account||0===this.search_account.length)return this.dialogFilteredAccounts=this.categorized_accounts,void this.afterAccountsRendered();const e=this.search_account.toLowerCase(),t=this.accounts.filter((t=>t.label.toLowerCase().indexOf(e)>-1));this.dialogFilteredAccounts=this.getAccountAsCategories(t),this.afterAccountsRendered()},openAccountDialog(){this.search_account="",this.display_accounts_dialog=!0,this.afterAccountsRendered()},afterAccountsRendered(){setTimeout((()=>{this.resizeAllGridItems()}),0)},clearManualAccountsSearch(){this.search_account="",this.dialogFilteredAccounts=this.categorized_accounts,this.afterAccountsRendered()},accountSelected(e){const t=this.accounts.filter((t=>t.value.toLowerCase().indexOf(e)>-1));t.length>0&&(this.localValue=t[0]),this.closeDialog()},resizeAllGridItems(){const e=document.getElementsByClassName("item");for(let t=0;t<e.length;t++)this.resizeGridItem(e[t])},resizeGridItem(e){const t=document.getElementsByClassName("grid")[0];if(!t)return;const i=parseInt(window.getComputedStyle(t).getPropertyValue("grid-auto-rows")),n=parseInt(window.getComputedStyle(t).getPropertyValue("grid-row-gap")),s=e.querySelector(".content").offsetHeight,o=Math.ceil((s+n)/(i+n));e.style.gridRowEnd="span "+o}},setup(){const e=(0,z.f5)(),{categorized_accounts:t,accounts:i,accounts_loaded:n,is_view_readonly:s,accountFilterByAnyValue:o,total_line_predictions:l,line_items_line_predictions:a,accounting_mode:r}=(0,L.Jk)(e),{hasTotalPredictions:d,hasLineItemsPredictions:c,getAccountAsCategories:u}=e,m=(0,W.iH)(e.accounts),_=(0,W.iH)(e.categorized_accounts),p=(0,z.ZA)(),{view_template:h,view_types:g}=(0,L.Jk)(p);return{view_types:g,view_template:h,getAccountAsCategories:u,categorized_accounts:t,hasTotalPredictions:d,hasLineItemsPredictions:c,accounting_mode:r,total_line_predictions:l,line_items_line_predictions:a,is_view_readonly:s,filterAccounts:m,dialogFilteredAccounts:_,accounts_loaded:n,accounts:i,accountFilterByAnyValue:o,display_accounts_dialog:(0,W.iH)(!1),popup_width:(0,W.iH)("800"),search_account:(0,W.iH)("")}}});var gn=i(490),wn=i(76749),yn=i(33115);const vn=(0,R.Z)(hn,[["render",rn],["__scopeId","data-v-3e07d698"]]),fn=vn;te()(hn,"components",{QSelect:Ot.Z,QItem:gn.Z,QItemSection:wn.Z,QItemLabel:yn.Z,QIcon:G.Z,QTooltip:Ce.Z,QCardSection:ot.Z,QInput:Et.Z});const xn={key:0,class:"row items-center q-mt-sm dimension-container"},In={key:0,class:"q-pr-sm text-container"};function bn(e,t,i,o,l,a){const r=(0,n.up)("Dimension");return(0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.lineItems[e.line_item_index].split_items[e.split_line_index].dimensions,((t,i)=>((0,n.wg)(),(0,n.iD)(n.HY,{key:i},["p"!==t.rule.toLowerCase()?((0,n.wg)(),(0,n.iD)("div",xn,[0===i?((0,n.wg)(),(0,n.iD)("div",In,(0,s.zw)(e.$t("dimensions"))+": ",1)):(0,n.kq)("",!0),(0,n._)("div",{class:(0,s.C_)(0===i?"input-container":" input-100 ")},[(0,n.Wm)(r,{onUpdateDimension:e.updateDimension,item:t,index:i},null,8,["onUpdateDimension","item","index"])],2)])):(0,n.kq)("",!0)],64)))),128)}const kn={key:0,class:"text-red"},qn={class:"ellipsis"},An={key:0,class:"text-red"};function Dn(e,t,i,o,l,a){const r=(0,n.up)("q-tooltip"),d=(0,n.up)("q-icon"),c=(0,n.up)("q-select"),u=(0,n.up)("q-input");return(0,n.wg)(),(0,n.iD)(n.HY,null,[e.hasList?((0,n.wg)(),(0,n.j4)(c,{key:0,tabindex:"1",class:"accounting-select dimension-select",clearable:"","use-input":"",outlined:"",modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=t=>e.localValue=t),loading:!e.accounts_loaded,options:e.dimension_options,onFilter:e.filterListEvent,"emit-value":"","map-options":"",disable:e.is_view_readonly||e.dimension_readonly,label:e.item.name+("m"===e.item.rule.toLowerCase()?" *":"")},{label:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.item.name)+" ",1),"m"===e.item.rule.toLowerCase()?((0,n.wg)(),(0,n.iD)("span",kn," *")):(0,n.kq)("",!0)])),"selected-item":(0,n.w5)((e=>[(0,n._)("div",qn,(0,s.zw)(e.opt.label),1)])),append:(0,n.w5)((()=>[""!==e.dimension_error?((0,n.wg)(),(0,n.j4)(d,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.dimension_error),1)])),_:1})])),_:1})):(0,n.kq)("",!0)])),_:1},8,["modelValue","loading","options","onFilter","disable","label"])):(0,n.kq)("",!0),e.hasList?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(u,{key:1,class:"accouting-input column inline full-width dimension-input",outlined:"",label:e.item.name+("m"===e.item.rule.toLowerCase()?"*":""),modelValue:e.localValue,"onUpdate:modelValue":t[1]||(t[1]=t=>e.localValue=t),disable:!!e.is_view_readonly},{label:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.item.name)+" ",1),"m"===e.item.rule.toLowerCase()?((0,n.wg)(),(0,n.iD)("span",An," *")):(0,n.kq)("",!0)])),append:(0,n.w5)((()=>[""!==e.dimension_error?((0,n.wg)(),(0,n.j4)(d,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.dimension_error),1)])),_:1})])),_:1})):(0,n.kq)("",!0)])),_:1},8,["label","modelValue","disable"]))],64)}const Ln=(0,n.aZ)({mixins:[],props:{item:{type:Object,required:!0},readonly:{type:Boolean,default:!1},index:{type:Number,required:!0}},watch:{dimension_dropdowns:{deep:!0,handler:function(e,t){this.setDropDownOptions()}}},components:{},computed:{dimension_error:function(){return String(this.item.error)},localValue:{get(){return String(this.item.value)},set(e){this.$emit("update-dimension",{index:this.index,value:e})}},hasList:function(){return!!(this.dimension_dropdowns.hasOwnProperty(this.item.id)&&this.dimension_dropdowns[this.item.id].length>0)}},mounted:function(){this.dimension_value=this.item.value,this.setDropDownOptions()},methods:{setDropDownOptions(){this.dimension_dropdowns.hasOwnProperty(this.item.id)&&this.dimension_dropdowns[this.item.id].length>0?this.dimension_options=this.dimension_dropdowns[this.item.id]:this.dimension_options=[]},filterListEvent(e,t,i){t(e?()=>{const t=e.toLowerCase();this.dimension_options=this.dimension_dropdowns[this.item.id].filter((e=>e.label.toLowerCase().indexOf(t)>-1))}:()=>{this.dimension_options=this.dimension_dropdowns[this.item.id]})}},setup(){const e=(0,z.f5)(),{dimension_dropdowns:t,accounts_loaded:i,is_view_readonly:n}=(0,L.Jk)(e);return{is_view_readonly:n,dimension_dropdowns:t,accounts_loaded:i,dimension_options:(0,W.iH)([]),dimension_value:(0,W.iH)("")}}}),Sn=(0,R.Z)(Ln,[["render",Dn]]),Zn=Sn;te()(Ln,"components",{QSelect:Ot.Z,QIcon:G.Z,QTooltip:Ce.Z,QInput:Et.Z});const Wn=(0,n.aZ)({mixins:[],props:{line_item_index:{type:Number,required:!0},split_line_index:{type:Number,required:!0}},computed:{hasDimensions:function(){return!(!this.lineItems[this.line_item_index].split_items[this.split_line_index].hasOwnProperty("dimensions")||void 0===this.lineItems[this.line_item_index].split_items[this.split_line_index].dimensions)}},components:{Dimension:Zn},methods:{updateDimension(e){if(!e.hasOwnProperty("index")||!e.hasOwnProperty("value"))return;let t=e.value;void 0!==t&&null!==t||(t=""),this.lineItems[this.line_item_index].split_items[this.split_line_index].dimensions[e.index].error="",this.lineItems[this.line_item_index].split_items[this.split_line_index].dimensions[e.index].value=t}},setup(){const e=(0,z.f5)(),{lineItems:t,dimensions:i,is_view_readonly:n}=(0,L.Jk)(e);return{is_view_readonly:n,dimensions:i,lineItems:t}}}),Pn=(0,R.Z)(Wn,[["render",bn],["__scopeId","data-v-14cf72fa"]]),Cn=Pn,Tn=(0,n.aZ)({mixins:[],props:{index:{type:Number,required:!0}},components:{Account:fn,Amount:Ri,Dimensions:Cn,Percent:nn},methods:{updateAccount(e){if(this.is_view_readonly)return;if(!e.hasOwnProperty("index")||!e.hasOwnProperty("value"))return;const t=e.index,i=e.value;this.updateAccountInStore(this.index,t,i)},validateAmountAndSetError(e,t){return t?!!(0,ve.hz)(t)||(e.amount_error=this.$t("amount_invalid"),!1):(e.amount_error=this.$t("amount_is_empty"),!1)},deleteLineItem(e,t){if(!this.is_view_readonly){try{this.lineItems[t].split_items.splice(e,1)}catch(i){}this.calculateTotalByMode()}}},setup(){const e=(0,z.f5)(),{lineItems:t,is_view_readonly:i}=(0,L.Jk)(e),{calculateTotalByMode:n,getDimensionsForAccount:s,validateLine:o,updateAccount:l}=e;return{updateAccountInStore:l,validateLine:o,calculateTotalByMode:n,is_view_readonly:i,lineItems:t,getDimensionsForAccount:s}}}),$n=(0,R.Z)(Tn,[["render",ji]]),Vn=$n;te()(Tn,"components",{QIcon:G.Z});const zn={key:0,class:"q-pr-sm text-container"};function En(e,t,i,o,l,a){const r=(0,n.up)("Dimension");return e.hasDimensions?((0,n.wg)(!0),(0,n.iD)(n.HY,{key:0},(0,n.Ko)(e.lineItems[e.index].dimensions,((t,i)=>((0,n.wg)(),(0,n.iD)(n.HY,{key:i},["p"!==t.rule.toLowerCase()?((0,n.wg)(),(0,n.iD)("div",{key:0,class:(0,s.C_)(["row items-center q-mt-sm dimension-container",e.expert_mode?"export-mode":""])},[0===i?((0,n.wg)(),(0,n.iD)("div",zn,(0,s.zw)(e.$t("dimensions"))+": ",1)):(0,n.kq)("",!0),(0,n._)("div",{class:(0,s.C_)(0===i?"input-container":" input-100 ")},[(0,n.Wm)(r,{readonly:e.lineItems[e.index].readonly,onUpdateDimension:e.updateDimension,item:t,index:i},null,8,["readonly","onUpdateDimension","item","index"])],2)],2)):(0,n.kq)("",!0)],64)))),128)):(0,n.kq)("",!0)}const On=(0,n.aZ)({mixins:[],props:{index:{type:Number,required:!0}},computed:{hasDimensions:function(){return!(!this.lineItems[this.index].hasOwnProperty("dimensions")||void 0===this.lineItems[this.index].dimensions)},dimensionHasList:function(e){return void 0!==e&&null!==e&&!!(this.dimension_dropdowns.hasOwnProperty(e)&&this.dimension_dropdowns[e].length>0)},setDimensionList(){return!0}},components:{Dimension:Zn},methods:{updateDimension(e){if(!e.hasOwnProperty("index")||!e.hasOwnProperty("value"))return;let t=e.value;void 0!==t&&null!==t||(t=""),this.lineItems[this.index].dimensions[e.index].error="",this.lineItems[this.index].dimensions[e.index].value=t}},setup(){const e=(0,z.f5)(),{lineItems:t,dimensions:i,dimension_dropdowns:n,is_view_readonly:s,accounts_loaded:o,expert_mode:l}=(0,L.Jk)(e);return{expert_mode:l,accounts_loaded:o,is_view_readonly:s,dimensions:i,lineItems:t,dimension_dropdowns:n}}}),Fn=(0,R.Z)(On,[["render",En],["__scopeId","data-v-28859f3d"]]),Qn=Fn;function Mn(e,t,i,o,l,a){const r=(0,n.up)("q-tooltip"),d=(0,n.up)("q-icon"),c=(0,n.up)("q-input");return(0,n.wg)(),(0,n.j4)(c,{tabindex:"1",class:"accouting-input amount-input",outlined:"",modelValue:e.lineItems[e.index].amount,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.lineItems[e.index].amount=t),t[1]||(t[1]=t=>{e.amountUpdated()})],disable:e.isReadOnly()},{append:(0,n.w5)((()=>[""!==e.lineItems[e.index]["amount_error"]?((0,n.wg)(),(0,n.j4)(d,{key:0,flat:"",dense:"",name:"error",size:"24px",color:"red"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.lineItems[e.index]["amount_error"]),1)])),_:1})])),_:1})):(0,n.kq)("",!0)])),_:1},8,["modelValue","disable"])}const Un=(0,n.aZ)({mixins:[],props:{index:{type:Number,required:!0}},components:{},methods:{isReadOnly(){return this.lineItems[this.index].split_items.length>0||(!(!this.lineItems[this.index].hasOwnProperty("amount_readonly")||!0!==this.lineItems[this.index].amount_readonly)||(!!Boolean(this.lineItems[this.index].readonly)||!!Boolean(this.is_view_readonly)))},clearlineItemAmountError(e){this.lineItems[e].amount_error=""},amountUpdated(){this.is_view_readonly||(this.clearlineItemAmountError(this.index),this.lineItems[this.index]||(this.lineItems[this.index].amount_error=this.$t("amount_is_empty")),(0,ve.hz)(this.lineItems[this.index].amount)?this.calculateTotalByMode():this.lineItems[this.index].amount_error=this.$t("amount_invalid"))}},setup(){const e=(0,z.f5)(),{lineItems:t,amount_format_locale:i,is_view_readonly:n}=(0,L.Jk)(e),{calculateTotalByMode:s}=e;return{calculateTotalByMode:s,is_view_readonly:n,amount_format_locale:i,lineItems:t}}}),Hn=(0,R.Z)(Un,[["render",Mn]]),Bn=Hn;function jn(e,t,i,o,l,a){const r=(0,n.up)("q-tooltip"),d=(0,n.up)("q-icon");return(0,n.wg)(),(0,n.j4)(d,{tabindex:"1",name:"add",size:"22px",onClick:e.addChildLineItem,onKeydown:(0,Ve.D2)(e.addChildLineItem,["enter"]),class:(0,s.C_)(["cursor-pointer",e.is_view_readonly||e.lineItems[e.index].readonly?"disabled":""])},{default:(0,n.w5)((()=>[(0,n.Wm)(r,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("split_line_item")),1)])),_:1})])),_:1},8,["onClick","onKeydown","class"])}te()(Un,"components",{QInput:Et.Z,QIcon:G.Z,QTooltip:Ce.Z});const Kn=(0,n.aZ)({mixins:[],props:{index:{type:Number,required:!0}},components:{},methods:{addChildLineItem(){if(this.is_view_readonly||!this.lineItems[this.index].amount||""===this.lineItems[this.index].amount||!0===this.lineItems[this.index].readonly)return;this.resetItem(this.index);const e=this.baseSplitLineItem();e.percentage="0%",this.lineItems[this.index].split_items.push(e),this.calculateTotalByMode()}},setup(){const e=(0,z.f5)(),{lineItems:t,is_view_readonly:i}=(0,L.Jk)(e),{baseSplitLineItem:n,calculateTotalByMode:s,resetItem:o}=e;return{resetItem:o,calculateTotalByMode:s,is_view_readonly:i,baseSplitLineItem:n,lineItems:t}}}),Yn=(0,R.Z)(Kn,[["render",jn]]),Jn=Yn;te()(Kn,"components",{QIcon:G.Z,QTooltip:Ce.Z});const Nn=(0,n._)("img",{width:"20",src:"split_accounting.svg"},null,-1);function Rn(e,t,i,o,l,a){const r=(0,n.up)("q-tooltip"),d=(0,n.up)("q-icon");return 0===e.lineItems[e.index].split_items.length?((0,n.wg)(),(0,n.j4)(d,{key:0,class:(0,s.C_)(["q-ml-sm cursor-pointer accounting-icon",e.is_view_readonly||e.lineItems[e.index].readonly?"disabled":""]),tabindex:"1",color:"grey",size:"md",onClick:e.splitLineItem,onKeydown:(0,Ve.D2)(e.splitLineItem,["enter"])},{default:(0,n.w5)((()=>[Nn,(0,n.Wm)(r,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("split_line_item")),1)])),_:1})])),_:1},8,["onClick","onKeydown","class"])):(0,n.kq)("",!0)}var Gn=function(e,t,i,n){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function l(e){try{r(n.next(e))}catch(t){o(t)}}function a(e){try{r(n["throw"](e))}catch(t){o(t)}}function r(e){e.done?i(e.value):s(e.value).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const Xn=(0,n.aZ)({mixins:[],props:{index:{type:Number,required:!0}},components:{},methods:{splitLineItem(){return Gn(this,void 0,void 0,(function*(){if(this.is_view_readonly||!this.lineItems[this.index].amount||""===this.lineItems[this.index].amount||!0===this.lineItems[this.index].readonly)return;this.resetItem(this.index);let e=yield this.formatValue(this.lineItems[this.index].amount,this.amount_format_locale);const t=parseFloat(e);let i=t/2;i=parseFloat(i.toFixed(2));let n=yield this.formatValue(String(i),"en_US",this.amount_format_locale);const s=this.baseSplitLineItem();s.percentage="50%",s.amount=n,this.lineItems[this.index].split_items.push(s);const o=this.baseSplitLineItem();o.percentage="50%",o.amount=n,this.lineItems[this.index].split_items.push(o),this.calculateTotalByMode()}))}},setup(){const e=(0,z.f5)(),{lineItems:t,amount_format_locale:i,is_view_readonly:n}=(0,L.Jk)(e),{baseSplitLineItem:s,calculateTotalByMode:o,resetItem:l}=e,a=(0,z.V_)(),{formatValue:r}=a;return{resetItem:l,calculateTotalByMode:o,baseSplitLineItem:s,is_view_readonly:n,amount_format_locale:i,formatValue:r,lineItems:t}}}),es=(0,R.Z)(Xn,[["render",Rn]]),ts=es;te()(Xn,"components",{QIcon:G.Z,QTooltip:Ce.Z});const is=(0,n._)("img",{width:"20",src:"split_done.svg"},null,-1);function ns(e,t,i,o,l,a){const r=(0,n.up)("q-tooltip"),d=(0,n.up)("q-icon");return e.lineItems[e.index].split_items.length>0?((0,n.wg)(),(0,n.j4)(d,{key:0,class:(0,s.C_)(["q-ml-sm cursor-pointer accounting-icon",e.is_view_readonly||e.lineItems[e.index].readonly?"disabled":""]),tabindex:"1",color:"grey",size:"md",onClick:e.un_splitLineItem,onKeydown:(0,Ve.D2)(e.un_splitLineItem,["enter"])},{default:(0,n.w5)((()=>[is,(0,n.Wm)(r,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("remove_line_item_split")),1)])),_:1})])),_:1},8,["onClick","onKeydown","class"])):(0,n.kq)("",!0)}const ss=(0,n.aZ)({mixins:[],props:{index:{type:Number,required:!0}},components:{},methods:{un_splitLineItem(){this.is_view_readonly||!0===this.lineItems[this.index].readonly||(this.lineItems[this.index].split_items=[],this.calculateTotalByMode())}},setup(){const e=(0,z.f5)(),{lineItems:t,is_view_readonly:i}=(0,L.Jk)(e),{calculateTotalByMode:n}=e;return{calculateTotalByMode:n,is_view_readonly:i,lineItems:t}}}),os=(0,R.Z)(ss,[["render",ns]]),ls=os;te()(ss,"components",{QIcon:G.Z,QTooltip:Ce.Z});const as=(0,n.aZ)({mixins:[],props:{index:{type:Number,required:!0}},components:{SplitedLineItems:Vn,Dimensions:Qn,Amount:Bn,Account:fn,AddChildLineItem:Jn,SplitLineItemBtn:ts,UnSplitLineItemBtn:ls},methods:{updateAccount(e){this.is_view_readonly||e.hasOwnProperty("index")&&e.hasOwnProperty("value")&&this.updateAccountInStore(this.index,null,e.value)},updateAmount(e){this.is_view_readonly||null===this.index||e.hasOwnProperty("index")&&e.hasOwnProperty("value")&&(this.lineItems[this.index].amount=e.value)}},setup(){const e=(0,z.f5)(),{lineItems:t,is_view_readonly:i}=(0,L.Jk)(e),{getDimensionsForAccount:n,validateLine:s,updateAccount:o}=e;return{updateAccountInStore:o,is_view_readonly:i,lineItems:t,getDimensionsForAccount:n,validateLine:s}}}),rs=(0,R.Z)(as,[["render",Ei]]),ds=rs;te()(as,"components",{QIcon:G.Z,QTooltip:Ce.Z});const cs=["id","data-id"],us=(0,n._)("div",{class:"",style:{width:"4%"}},null,-1),ms={class:"",style:{width:"8%"}},_s={class:"account-container",style:{width:"37%"}},ps={class:"dimensions",style:{"padding-right":"9px"}},hs={style:{width:"51%"}},gs={class:"row"},ws={style:{width:"71%"}},ys={style:{width:"29%"}},vs={class:"q-ml-sm bg-primary primary-bg-text",style:{width:"22px",display:"inline-block"}},fs={class:"splitted-line-items total-line-item-area",style:{width:"100%"}},xs={class:"row total-line-item-area q-pb-sm q-pt-md"},Is=(0,n._)("div",{style:{width:"12%"}},null,-1),bs={style:{width:"37%"}},ks={class:"float-right q-mr-md"},qs={style:{width:"51%"}},As={key:0,style:{"margin-left":"12px"}},Ds={class:"row total-line-item-area q-pb-sm"},Ls=(0,n._)("div",{style:{width:"12%"}},null,-1),Ss={style:{width:"37%"}},Zs={class:"float-right q-mr-md"},Ws={style:{width:"51%"}},Ps={key:0,style:{"margin-left":"12px"}};function Cs(e,t,i,o,l,a){const r=(0,n.up)("Account"),d=(0,n.up)("Dimensions"),c=(0,n.up)("Amount"),u=(0,n.up)("SplitLineItemBtn"),m=(0,n.up)("UnSplitLineItemBtn"),_=(0,n.up)("AddChildLineItem"),p=(0,n.up)("SplitedLineItems"),h=(0,n.up)("q-tooltip"),g=(0,n.up)("q-icon");return null!==e.header_index?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n._)("div",{class:"row q-pt-sm total-line-item-area",id:e.lineItems[e.header_index].id,"data-id":e.lineItems[e.header_index].id},[us,(0,n._)("div",ms,(0,s.zw)(e.$t("total")),1),(0,n._)("div",_s,[(0,n.Wm)(r,{readonly:e.lineItems[e.header_index].readonly,onUpdateAccount:e.updateAccount,item:e.lineItems[e.header_index],index:e.header_index},null,8,["readonly","onUpdateAccount","item","index"]),(0,n._)("div",ps,[(0,n.Wm)(d,{index:e.header_index},null,8,["index"])])]),(0,n._)("div",hs,[(0,n._)("div",gs,[(0,n._)("div",ws,[(0,n.Wm)(c,{index:e.header_index},null,8,["index"])]),(0,n._)("div",ys,[(0,n.Wm)(u,{index:e.header_index},null,8,["index"]),(0,n.Wm)(m,{index:e.header_index},null,8,["index"]),(0,n._)("div",vs,[(0,n.Wm)(_,{index:e.header_index},null,8,["index"])])])])])],8,cs),(0,n._)("div",fs,[(0,n.Wm)(p,{index:e.header_index},null,8,["index"])]),(0,n._)("div",xs,[Is,(0,n._)("div",bs,[(0,n._)("span",ks,(0,s.zw)(e.$t("recorded_bookings"))+": ",1)]),(0,n._)("div",qs,[e.lineItems[e.header_index].hasOwnProperty("lines_total_amount")?((0,n.wg)(),(0,n.iD)("span",As,(0,s.zw)(e.lineItems[e.header_index].lines_total_amount),1)):(0,n.kq)("",!0)])]),(0,n._)("div",Ds,[Ls,(0,n._)("div",Ss,[(0,n._)("span",Zs,(0,s.zw)(e.$t("unsettled_amount"))+": ",1)]),(0,n._)("div",Ws,[e.lineItems[e.header_index].hasOwnProperty("pending_amount")?((0,n.wg)(),(0,n.iD)("span",Ps,(0,s.zw)(e.lineItems[e.header_index].pending_amount),1)):(0,n.kq)("",!0),""!==e.lineItems[e.header_index].error?((0,n.wg)(),(0,n.j4)(g,{key:1,flat:"",dense:"",name:"error",size:"20px",color:"red",class:"q-ml-sm"},{default:(0,n.w5)((()=>[(0,n.Wm)(h,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.lineItems[e.header_index].error),1)])),_:1})])),_:1})):(0,n.kq)("",!0)])])],64)):(0,n.kq)("",!0)}const Ts=(0,n.aZ)({mixins:[],props:{},components:{SplitedLineItems:Vn,Dimensions:Qn,Amount:Bn,Account:fn,AddChildLineItem:Jn,SplitLineItemBtn:ts,UnSplitLineItemBtn:ls},mounted(){this.header_index=this.getTotalLineIndex()},methods:{updateAccount(e){this.is_view_readonly||null===this.header_index||e.hasOwnProperty("index")&&e.hasOwnProperty("value")&&(this.lineItems[this.header_index].account=e.value,this.lineItems[this.header_index].account_error="",this.updateAccountInStore(this.header_index,null,e.value))},updateAmount(e){this.is_view_readonly||null===this.header_index||e.hasOwnProperty("index")&&e.hasOwnProperty("value")&&(this.lineItems[this.header_index].amount=e.value)}},setup(){const e=(0,z.f5)(),{lineItems:t,getTotalLineIndex:i,is_view_readonly:n}=(0,L.Jk)(e),{getDimensionsForAccount:s,validateLine:o,updateAccount:l}=e;return{updateAccountInStore:l,getDimensionsForAccount:s,is_view_readonly:n,getTotalLineIndex:i,lineItems:t,header_index:(0,W.iH)(null),validateLine:o}}}),$s=(0,R.Z)(Ts,[["render",Cs]]),Vs=$s;te()(Ts,"components",{QIcon:G.Z,QTooltip:Ce.Z});var zs=function(e,t,i,n){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function l(e){try{r(n.next(e))}catch(t){o(t)}}function a(e){try{r(n["throw"](e))}catch(t){o(t)}}function r(e){e.done?i(e.value):s(e.value).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const Es=(0,n.aZ)({el:"#app",mixins:[S.Z,Z.Z,F.Z],components:{lineItem:ds,TotalLineItem:Vs},watch:{},mounted(){this.init()},unmounted:function(){},data(){return{}},methods:{init(){return zs(this,void 0,void 0,(function*(){try{yield this.getAccountsList()}catch(e){const t=$.w.getErrorMessage(e);this.showErrorToast(t),this.accounting_error=t}finally{this.resolveAccountLoadingPromise()}}))}},setup(){const e=(0,z.f5)(),{accounting_mode:t,lineItems:i,accounts_loaded:n,accounting_error:s}=(0,L.Jk)(e),{getAccountsList:o}=e,l=(0,z.ZA)(),{line_item_loaded:a}=(0,L.Jk)(l),{resolveAccountLoadingPromise:r}=l;return{accounting_error:s,accounts_loaded:n,resolveAccountLoadingPromise:r,lineItems:i,accounting_mode:t,getAccountsList:o,line_item_loaded:a,fab1:(0,W.iH)(!1)}}});var Os=i(19361);const Fs=(0,R.Z)(Es,[["render",vi]]),Qs=Fs;te()(Es,"components",{QFab:Os.Z,QSeparator:dt.Z,QIcon:G.Z,QTooltip:Ce.Z});const Ms={key:0,class:"line-item-container ml-16 q-mr-sm"},Us={class:"lineItems"},Hs={class:"row items-center table-header"},Bs={class:"",style:{width:"4%"}},js={class:"header",style:{width:"8%"}},Ks={class:"header",style:{width:"30%"}},Ys={class:"header",style:{width:"18%"}},Js={class:"header",style:{width:"30%"}},Ns=(0,n._)("div",{class:"",style:{width:"15%"}},null,-1),Rs={class:"row items-center q-mt-sm"},Gs={style:{width:"3%"}},Xs={class:"q-ma-sm bg-primary primary-bg-text",style:{width:"22px",display:"inline-block"}},eo=(0,n._)("div",{style:{width:"97%"}},null,-1);function to(e,t,i,o,l,a){const r=(0,n.up)("q-fab"),d=(0,n.up)("TotalLineItem"),c=(0,n.up)("q-separator"),u=(0,n.up)("lineItem"),m=(0,n.up)("q-tooltip"),_=(0,n.up)("q-icon");return e.line_item_loaded&&e.accounts_loaded?((0,n.wg)(),(0,n.iD)("div",Ms,[(0,n._)("div",Us,[(0,n._)("div",Hs,[(0,n._)("div",Bs,[(0,n.Wm)(r,{square:"",flat:"",modelValue:e.fab1,"onUpdate:modelValue":t[0]||(t[0]=t=>e.fab1=t),icon:"keyboard_arrow_up",class:"multi-fab",direction:"down",padding:"xs","active-icon":"keyboard_arrow_down","label-class":"",style:{width:"40px"}},null,8,["modelValue"])]),(0,n._)("div",js,(0,s.zw)(e.$t("pages.line_items_columns.POSITION")),1),(0,n._)("div",Ks,(0,s.zw)(e.$t("accounts")),1),(0,n._)("div",Ys,(0,s.zw)(e.$t("voucher_text")),1),(0,n._)("div",Js,(0,s.zw)(e.$t("amount_title")),1),Ns]),(0,n.Wm)(d),(0,n.Wm)(c),"line_items"===e.accounting_mode?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.lineItems,((e,t)=>((0,n.wg)(),(0,n.iD)(n.HY,{key:e},["line_item"===e.type?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n.Wm)(u,{index:t},null,8,["index"]),(0,n.Wm)(c,{class:"q-mt-sm"})],64)):(0,n.kq)("",!0)],64)))),128)),(0,n._)("div",Rs,[(0,n._)("div",Gs,[(0,n._)("div",Xs,[(0,n.Wm)(_,{name:"add",size:"22px",onClick:e.addLineItem,onKeydown:(0,Ve.D2)(e.addLineItem,["enter"]),tabindex:"1",class:(0,s.C_)(["cursor-pointer",e.is_view_readonly?"disabled":""])},{default:(0,n.w5)((()=>[(0,n.Wm)(m,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.$t("add_new_line_item")),1)])),_:1})])),_:1},8,["onClick","onKeydown","class"])])]),eo])],64)):(0,n.kq)("",!0)])])):(0,n.kq)("",!0)}const io=["id","data-id"],no=(0,n._)("div",{class:"",style:{width:"4%"}},null,-1),so={class:"",style:{width:"8%"}},oo={key:0},lo={class:"account-container",style:{width:"30%"}},ao={class:"dimensions",style:{"padding-right":"9px"}},ro={style:{width:"18%"},class:"q-pr-sm"},co={style:{width:"40%"}},uo={class:"row"},mo={style:{width:"70%"}},_o={style:{width:"29%"}},po={class:"q-ml-sm bg-primary primary-bg-text",style:{width:"22px",display:"inline-block"}},ho={class:"splitted-line-items",style:{width:"100%"}},go={key:0,class:"row q-pt-sm"},wo=(0,n._)("div",{style:{width:"12%"}},null,-1),yo={style:{width:"37%"}},vo={class:"float-right q-mr-md"},fo={style:{width:"51%"}},xo={key:0,style:{"margin-left":"12px"}};function Io(e,t,i,o,l,a){const r=(0,n.up)("Account"),d=(0,n.up)("Dimensions"),c=(0,n.up)("q-input"),u=(0,n.up)("Amount"),m=(0,n.up)("SplitLineItemBtn"),_=(0,n.up)("UnSplitLineItemBtn"),p=(0,n.up)("AddChildLineItem"),h=(0,n.up)("SplitedLineItems"),g=(0,n.up)("q-tooltip"),w=(0,n.up)("q-icon");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",{class:"row q-mt-sm",id:e.lineItems[e.index].id,"data-id":e.lineItems[e.index].id},[no,(0,n._)("div",so,[e.lineItems[e.index].hasOwnProperty("position")?((0,n.wg)(),(0,n.iD)("span",oo,(0,s.zw)(e.lineItems[e.index].position),1)):(0,n.kq)("",!0)]),(0,n._)("div",lo,[(0,n.Wm)(r,{readonly:e.lineItems[e.index].readonly,onUpdateAccount:e.updateAccount,item:e.lineItems[e.index],index:e.index},null,8,["readonly","onUpdateAccount","item","index"]),(0,n._)("div",ao,[(0,n.Wm)(d,{index:e.index},null,8,["index"])])]),(0,n._)("div",ro,[(0,n.Wm)(c,{class:"accouting-input column inline full-width",outlined:"",modelValue:e.lineItems[e.index].voucher_text,"onUpdate:modelValue":t[0]||(t[0]=t=>e.lineItems[e.index].voucher_text=t),disable:e.lineItems[e.index].split_items.length>0||e.is_view_readonly},null,8,["modelValue","disable"])]),(0,n._)("div",co,[(0,n._)("div",uo,[(0,n._)("div",mo,[(0,n.Wm)(u,{index:e.index},null,8,["index"])]),(0,n._)("div",_o,[(0,n.Wm)(m,{index:e.index},null,8,["index"]),(0,n.Wm)(_,{index:e.index},null,8,["index"]),(0,n._)("div",po,[(0,n.Wm)(p,{index:e.index},null,8,["index"])])])])])],8,io),(0,n._)("div",ho,[(0,n.Wm)(h,{index:e.index},null,8,["index"])]),e.lineItems[e.index].split_items.length>0?((0,n.wg)(),(0,n.iD)("div",go,[wo,(0,n._)("div",yo,[(0,n._)("span",vo,(0,s.zw)(e.$t("unsettled_amount"))+": ",1)]),(0,n._)("div",fo,[e.lineItems[e.index].hasOwnProperty("pending_amount")?((0,n.wg)(),(0,n.iD)("span",xo,(0,s.zw)(e.lineItems[e.index].pending_amount),1)):(0,n.kq)("",!0),""!==e.lineItems[e.index].error?((0,n.wg)(),(0,n.j4)(w,{key:1,flat:"",dense:"",name:"error",size:"20px",color:"red",class:"q-ml-sm"},{default:(0,n.w5)((()=>[(0,n.Wm)(g,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.lineItems[e.index].error),1)])),_:1})])),_:1})):(0,n.kq)("",!0)])])):(0,n.kq)("",!0)],64)}const bo=["id","data-id"],ko=(0,n._)("div",{class:"",style:{width:"12%"}},null,-1),qo={class:"account-container",style:{width:"30%"}},Ao={class:"dimensions",style:{"padding-right":"9px"}},Do={style:{width:"18%"},class:"q-pr-sm"},Lo={style:{width:"28%"}},So={style:{width:"12%"}},Zo=(0,n._)("img",{width:"20",src:"trash-bin-default.svg"},null,-1);function Wo(e,t,i,o,l,a){const r=(0,n.up)("Account"),d=(0,n.up)("Dimensions"),c=(0,n.up)("q-input"),u=(0,n.up)("Amount"),m=(0,n.up)("Percent"),_=(0,n.up)("q-icon");return(0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.lineItems[e.index].split_items,((t,i)=>((0,n.wg)(),(0,n.iD)("div",{key:t,class:"row q-pt-sm",id:t.id,"data-id":t.id},[ko,(0,n._)("div",qo,[(0,n.Wm)(r,{readonly:t.readonly,onUpdateAccount:e.updateAccount,item:t,index:i},null,8,["readonly","onUpdateAccount","item","index"]),(0,n._)("div",Ao,[(0,n.Wm)(d,{line_item_index:e.index,split_line_index:i},null,8,["line_item_index","split_line_index"])])]),(0,n._)("div",Do,[(0,n.Wm)(c,{class:"accouting-input column inline full-width",outlined:"",modelValue:t.voucher_text,"onUpdate:modelValue":e=>t.voucher_text=e,disable:!!e.is_view_readonly},null,8,["modelValue","onUpdate:modelValue","disable"])]),(0,n._)("div",Lo,[(0,n.Wm)(u,{line_item_index:e.index,split_line_index:i},null,8,["line_item_index","split_line_index"]),(0,n.Wm)(m,{line_item_index:e.index,split_line_index:i},null,8,["line_item_index","split_line_index"])]),(0,n._)("div",So,[(0,n.Wm)(_,{class:(0,s.C_)(["q-ml-sm cursor-pointer accounting-icon",e.is_view_readonly?"disabled":""]),tabindex:"1",color:"grey",size:"md",onClick:t=>e.deleteLineItem(i,e.index),onKeydown:(0,Ve.D2)((t=>e.deleteLineItem(i,e.index)),["enter"])},{default:(0,n.w5)((()=>[Zo])),_:2},1032,["onClick","onKeydown","class"])])],8,bo)))),128)}const Po=(0,n.aZ)({mixins:[],props:{index:{type:Number,required:!0}},components:{Account:fn,Amount:Ri,Dimensions:Cn,Percent:nn},methods:{updateAccount(e){if(this.is_view_readonly)return;if(!e.hasOwnProperty("index")||!e.hasOwnProperty("value"))return;const t=e.index,i=e.value;this.updateAccountInStore(this.index,t,i)},validateAmountAndSetError(e,t){return t?!!(0,ve.hz)(t)||(e.amount_error=this.$t("amount_invalid"),!1):(e.amount_error=this.$t("amount_is_empty"),!1)},deleteLineItem(e,t){if(!this.is_view_readonly){try{this.lineItems[t].split_items.splice(e,1)}catch(i){}this.calculateTotalByMode()}}},setup(){const e=(0,z.f5)(),{lineItems:t,is_view_readonly:i}=(0,L.Jk)(e),{calculateTotalByMode:n,getDimensionsForAccount:s,validateLine:o,updateAccount:l}=e;return{updateAccountInStore:l,validateLine:o,calculateTotalByMode:n,is_view_readonly:i,lineItems:t,getDimensionsForAccount:s}}}),Co=(0,R.Z)(Po,[["render",Wo]]),To=Co;te()(Po,"components",{QInput:Et.Z,QIcon:G.Z});const $o=(0,n.aZ)({mixins:[],props:{index:{type:Number,required:!0}},components:{SplitedLineItems:To,Dimensions:Qn,Amount:Bn,Account:fn,AddChildLineItem:Jn,SplitLineItemBtn:ts,UnSplitLineItemBtn:ls},methods:{updateAccount(e){this.is_view_readonly||e.hasOwnProperty("index")&&e.hasOwnProperty("value")&&this.updateAccountInStore(this.index,null,e.value)},updateAmount(e){this.is_view_readonly||null===this.index||e.hasOwnProperty("index")&&e.hasOwnProperty("value")&&(this.lineItems[this.index].amount=e.value)}},setup(){const e=(0,z.f5)(),{lineItems:t,is_view_readonly:i}=(0,L.Jk)(e),{getDimensionsForAccount:n,validateLine:s,updateAccount:o}=e;return{updateAccountInStore:o,is_view_readonly:i,lineItems:t,getDimensionsForAccount:n,validateLine:s}}}),Vo=(0,R.Z)($o,[["render",Io]]),zo=Vo;te()($o,"components",{QInput:Et.Z,QIcon:G.Z,QTooltip:Ce.Z});const Eo=["id","data-id"],Oo=(0,n._)("div",{class:"",style:{width:"4%"}},null,-1),Fo={class:"",style:{width:"8%"}},Qo={class:"account-container",style:{width:"30%"}},Mo={class:"dimensions",style:{"padding-right":"9px"}},Uo={style:{width:"18%"},class:"q-pr-sm"},Ho={style:{width:"40%"}},Bo={class:"row"},jo={style:{width:"70%"}},Ko={style:{width:"29%"}},Yo={class:"q-ml-sm bg-primary primary-bg-text",style:{width:"22px",display:"inline-block"}},Jo={class:"splitted-line-items total-line-item-area",style:{width:"100%"}},No={class:"row total-line-item-area q-pb-sm q-pt-md"},Ro=(0,n._)("div",{style:{width:"12%"}},null,-1),Go={style:{width:"37%"}},Xo={class:"float-right q-mr-md"},el={style:{width:"51%"}},tl={key:0,style:{"margin-left":"12px"}},il={class:"row total-line-item-area q-pb-sm"},nl=(0,n._)("div",{style:{width:"12%"}},null,-1),sl={style:{width:"37%"}},ol={class:"float-right q-mr-md"},ll={style:{width:"51%"}},al={key:0,style:{"margin-left":"12px"}};function rl(e,t,i,o,l,a){const r=(0,n.up)("Account"),d=(0,n.up)("Dimensions"),c=(0,n.up)("q-input"),u=(0,n.up)("Amount"),m=(0,n.up)("SplitLineItemBtn"),_=(0,n.up)("UnSplitLineItemBtn"),p=(0,n.up)("AddChildLineItem"),h=(0,n.up)("SplitedLineItems"),g=(0,n.up)("q-tooltip"),w=(0,n.up)("q-icon");return null!==e.header_index?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n._)("div",{class:"row q-pt-sm total-line-item-area",id:e.lineItems[e.header_index].id,"data-id":e.lineItems[e.header_index].id},[Oo,(0,n._)("div",Fo,(0,s.zw)(e.$t("total")),1),(0,n._)("div",Qo,[(0,n.Wm)(r,{readonly:e.lineItems[e.header_index].readonly,onUpdateAccount:e.updateAccount,item:e.lineItems[e.header_index],index:e.header_index},null,8,["readonly","onUpdateAccount","item","index"]),(0,n._)("div",Mo,[(0,n.Wm)(d,{index:e.header_index},null,8,["index"])])]),(0,n._)("div",Uo,[(0,n.Wm)(c,{class:"accouting-input column inline full-width",outlined:"",modelValue:e.lineItems[e.header_index].voucher_text,"onUpdate:modelValue":t[0]||(t[0]=t=>e.lineItems[e.header_index].voucher_text=t),disable:e.lineItems[e.header_index].split_items.length>0||e.is_view_readonly},null,8,["modelValue","disable"])]),(0,n._)("div",Ho,[(0,n._)("div",Bo,[(0,n._)("div",jo,[(0,n.Wm)(u,{index:e.header_index},null,8,["index"])]),(0,n._)("div",Ko,[(0,n.Wm)(m,{index:e.header_index},null,8,["index"]),(0,n.Wm)(_,{index:e.header_index},null,8,["index"]),(0,n._)("div",Yo,[(0,n.Wm)(p,{index:e.header_index},null,8,["index"])])])])])],8,Eo),(0,n._)("div",Jo,[(0,n.Wm)(h,{index:e.header_index},null,8,["index"])]),(0,n._)("div",No,[Ro,(0,n._)("div",Go,[(0,n._)("span",Xo,(0,s.zw)(e.$t("recorded_bookings"))+": ",1)]),(0,n._)("div",el,[e.lineItems[e.header_index].hasOwnProperty("lines_total_amount")?((0,n.wg)(),(0,n.iD)("span",tl,(0,s.zw)(e.lineItems[e.header_index].lines_total_amount),1)):(0,n.kq)("",!0)])]),(0,n._)("div",il,[nl,(0,n._)("div",sl,[(0,n._)("span",ol,(0,s.zw)(e.$t("unsettled_amount"))+": ",1)]),(0,n._)("div",ll,[e.lineItems[e.header_index].hasOwnProperty("pending_amount")?((0,n.wg)(),(0,n.iD)("span",al,(0,s.zw)(e.lineItems[e.header_index].pending_amount),1)):(0,n.kq)("",!0),""!==e.lineItems[e.header_index].error?((0,n.wg)(),(0,n.j4)(w,{key:1,flat:"",dense:"",name:"error",size:"20px",color:"red",class:"q-ml-sm"},{default:(0,n.w5)((()=>[(0,n.Wm)(g,{class:"bg-red",anchor:"bottom right",self:"top right"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.lineItems[e.header_index].error),1)])),_:1})])),_:1})):(0,n.kq)("",!0)])])],64)):(0,n.kq)("",!0)}const dl=(0,n.aZ)({mixins:[],props:{},components:{SplitedLineItems:To,Dimensions:Qn,Amount:Bn,Account:fn,AddChildLineItem:Jn,SplitLineItemBtn:ts,UnSplitLineItemBtn:ls},mounted(){this.header_index=this.getTotalLineIndex()},methods:{updateAccount(e){this.is_view_readonly||null===this.header_index||e.hasOwnProperty("index")&&e.hasOwnProperty("value")&&(this.lineItems[this.header_index].account=e.value,this.lineItems[this.header_index].account_error="",this.updateAccountInStore(this.header_index,null,e.value))},updateAmount(e){this.is_view_readonly||null===this.header_index||e.hasOwnProperty("index")&&e.hasOwnProperty("value")&&(this.lineItems[this.header_index].amount=e.value)}},setup(){const e=(0,z.f5)(),{lineItems:t,getTotalLineIndex:i,is_view_readonly:n}=(0,L.Jk)(e),{getDimensionsForAccount:s,validateLine:o,updateAccount:l}=e;return{updateAccountInStore:l,getDimensionsForAccount:s,is_view_readonly:n,getTotalLineIndex:i,lineItems:t,header_index:(0,W.iH)(null),validateLine:o}}}),cl=(0,R.Z)(dl,[["render",rl]]),ul=cl;te()(dl,"components",{QInput:Et.Z,QIcon:G.Z,QTooltip:Ce.Z});var ml=function(e,t,i,n){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function l(e){try{r(n.next(e))}catch(t){o(t)}}function a(e){try{r(n["throw"](e))}catch(t){o(t)}}function r(e){e.done?i(e.value):s(e.value).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const _l=(0,n.aZ)({el:"#app",mixins:[S.Z,Z.Z,F.Z],components:{lineItem:zo,TotalLineItem:ul},watch:{},mounted(){this.init()},unmounted:function(){},data(){return{}},methods:{init(){return ml(this,void 0,void 0,(function*(){try{yield this.populateAccunts()}catch(e){const t=$.w.getErrorMessage(e);this.showErrorToast(t),this.accounting_error=t}finally{this.resolveAccountLoadingPromise()}}))},populateAccunts(){return ml(this,void 0,void 0,(function*(){this.hasPoMatchData()?yield this.getPOM3AccountsList():yield this.getAccountsList()}))},getPOM3AccountsList(){return ml(this,void 0,void 0,(function*(){try{this.accounts_loaded=!1,this.accounts=[];const e=yield this.getM3POAccountsFromServer();if(0===e.length)throw{message:"No accounts found"};for(const[t,i]of e.entries()){if(!i.id)continue;const e=i.id+(i.description?" - "+i.description:"");this.accounts.push({value:i.id,id:i.id,flexdimensions:[],label:e})}this.accounts_loaded=!0}catch(e){throw e}}))},getAccountsList(){return ml(this,void 0,void 0,(function*(){try{this.accounts_loaded=!1,this.accounts=[];const e=yield this.getM3AccountsFromServer();if(0===e.length)throw{message:"No accounts found"};yield this.fetchDimensionDropdowns();for(const[t,i]of e.entries()){if(!i.id)continue;this.getDimensions(i);const e=i.id+(i.description?" - "+i.description:"");this.accounts.push({value:i.id,id:i.id,flexdimensions:this.dimensions,label:e})}this.accounts_loaded=!0}catch(e){throw e}}))},getDimensions(e){const t=["dimension1","dimensionprofile"];this.dimensions=[];for(const[i,n]of Object.entries(e))if(!t.includes(i)&&i.startsWith("dimension")){const t=i.split("dimension")[1];let s="o";const o="usage"+t;e.hasOwnProperty(o)&&"mandatory"===String(e[o]).toLowerCase()&&(s="m"),this.dimensions.push({rule:s,id:t,name:n,value:"",error:""})}this.dimensions.sort(((e,t)=>e.id-t.id))},fetchDimensionDropdowns(){return ml(this,void 0,void 0,(function*(){try{const e={},t=yield this.getM3DimensionsFromServer();if(0===t.length)return;Array.from(t).forEach(((t,i)=>{const n=t.dimension;n&&t.description&&(e.hasOwnProperty(n)||(e[n]=[]),e[n].push({value:t.id,label:t.description}))})),this.dimension_dropdowns={};for(const i in e){const t=e[i].sort(((e,t)=>e.label.localeCompare(t.label)));this.dimension_dropdowns[String(i)]=[...t]}}catch(e){throw e}}))}},setup(){const e=(0,z.f5)(),{accounting_mode:t,lineItems:i,accounts:n,accounts_loaded:s,dimensions:o,dimension_dropdowns:l,accounting_error:a}=(0,L.Jk)(e),r=(0,z.ZA)(),{line_item_loaded:d}=(0,L.Jk)(r),{getM3AccountsFromServer:c,getM3DimensionsFromServer:u,resolveAccountLoadingPromise:m,getM3POAccountsFromServer:_}=r,p=(0,z.Yb)(),{hasPoMatchData:h}=p;return{getM3POAccountsFromServer:_,hasPoMatchData:h,resolveAccountLoadingPromise:m,getM3DimensionsFromServer:u,getM3AccountsFromServer:c,dimension_dropdowns:l,dimensions:o,accounts_loaded:s,accounting_error:a,lineItems:i,accounting_mode:t,line_item_loaded:d,accounts:n,fab1:(0,W.iH)(!1)}}}),pl=(0,R.Z)(_l,[["render",to]]),hl=pl;te()(_l,"components",{QFab:Os.Z,QSeparator:dt.Z,QIcon:G.Z,QTooltip:Ce.Z});var gl=i(38126),wl=function(e,t,i,n){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function l(e){try{r(n.next(e))}catch(t){o(t)}}function a(e){try{r(n["throw"](e))}catch(t){o(t)}}function r(e){e.done?i(e.value):s(e.value).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const yl=(0,n.aZ)({el:"#app",mixins:[S.Z,Z.Z,F.Z],components:{MessageBanner:P.Z,ImageComponent:C["default"],ErrorDocumentView:T.Z,Loader:O.Z,SetupValidation:we,ExpertMode:li,ProceedBtn:Se,PredictionBtn:ht,LN_VIEW:Qs,M3_VIEW:hl,SaveBtn:$e},watch:{accounting_error:{handler:function(e,t){this.is_view_readonly=""!==e}},processing:{handler:function(e,t){1==e?this.showLoading():this.hideLoading()}},data_loaded:{handler:function(e,t){1==e?this.hideLoading():this.showLoading()}}},mounted(){this.init(),window.addEventListener("storage",this.storageChangeEvent)},unmounted:function(){window.removeEventListener("storage",this.storageChangeEvent)},data(){return{auto_accounting_types_setting:V.MY}},beforeRouteLeave:function(e,t,i){this.resetDocStore(e.fullPath),this.resetAccountingStore(),this.resetAccountingTypeStore();const n=(0,z.Yb)();n.$reset(),"function"===typeof this.missing_supplier_warning&&this.missing_supplier_warning(),i()},methods:{init(){return wl(this,void 0,void 0,(function*(){try{this.accounting_error="",window.acc=this,this.connect(),this.processing=!0,this.docId=this.$route.params.id,this.doc_url=window.location.href,gl.Z.remove("doc_info"),this.line_item_loaded=!1,this.setAccountingModeOptions(),yield this.getDocumentById(this.docId),this.handleReadOnlyView(),this.view_template=yield this.loadTemplateSettings(),this.setAccountingVariables(),yield this.startAccountAsyncOperation(),yield this.prepareDataForView(),this.handleMode(),this.data_loaded=!0}catch(e){const t=$.w.getErrorMessage(e);this.showErrorToast(t),this.accounting_error=t}finally{this.processing=!1}}))},storageChangeEvent(e){this.handleSessionStorageChange(e)},handleSessionStorageChange(e){return wl(this,void 0,void 0,(function*(){try{this.handleStorageEvent(e);const t=yield this.loadTemplateSettings();t!==this.view_template&&(this.processing=!0,this.view_template=t,yield this.prepareDataForView())}catch(t){}finally{this.processing=!1}}))},handleReadOnlyView(){this.is_view_readonly=!1,V.at.includes(this.record.status)&&(this.is_view_readonly=!0)},loadTemplateSettings(){return wl(this,void 0,void 0,(function*(){const e=yield this.getSettingWithExpiry(this.auto_accounting_types_setting,"ln");let t=this.view_types.ln;return"m3"===e&&(t=this.view_types.m3),t}))},prepareDataForView(){return wl(this,void 0,void 0,(function*(){this.line_item_loaded=!1,this.hasPoMatchData()&&(this.setPoTotalLineItem(),yield this.calculateMatchedTotal()),this.record.hasOwnProperty("accounting")&&(this.loadSavedData(),this.line_item_loaded=!0),this.line_item_loaded||this.prepareLineItems(),this.doAccountPredictions(),this.line_item_loaded=!0}))},prepareLineItems(){if(this.lineItems=[],this.hasPendingPoMatch())return this.setPendingPoTotalLineItem(),void(this.disable_mode=!0);this.setTotallineItem(),this.setlineItems()},doAccountPredictions(){return wl(this,void 0,void 0,(function*(){try{if(!this.supplier_name)return;const e=this.getLineItemsForPredictionAccount();if(0===e.length)return;const t={line_items:JSON.stringify(e),source_locale:this.amount_format_locale,doc_id:this.docId};yield this.getPredictions(t)}catch(e){}}))},setPendingPoTotalLineItem(){const e=this.getbaseTotalLineItem();e.amount=this.pending_amount,e.amount_standard=this.pending_amount_standard,this.lineItems.push(e)},hasPendingPoMatch(){try{let e=parseFloat(this.pending_amount.replace(/[^0-9]/g,""));return!!(this.pending_amount&&""!=this.pending_amount&&e>0)}catch(e){return!0}},loadSavedData(){const e=this.record.accounting.line_items;if(this.accounting_mode=this.record.accounting.mode,this.hasPendingPoMatch()&&(this.accounting_mode="total_line",this.disable_mode=!0),!Array.isArray(e)||0===e.length)return!1;for(const[t,i]of e.entries()){let e=this.baseLineItem();"total_line_item"===i.type&&(e=this.getbaseTotalLineItem());const t=Object.assign(e,i);if(i.split_items.length>0)for(const[i,n]of t.split_items.entries()){let e=this.baseSplitLineItem();const s=Object.assign(e,n);t.split_items[i]=s}this.lineItems.push(e)}},hasLineItems(){return!(!this.record.tables||0==this.record.tables.length||!this.record.tables[0].hasOwnProperty("rows")||0==this.record.tables[0].rows.length)},setlineItems(){this.hasLineItems()&&Array.from(this.record.tables[0].rows).forEach(((e,t)=>{if(!0===e.is_deleted||!e.id)return;const i=this.baseLineItem();i.id=e.id;const n=["POSITION","DESCRIPTION","ITEM_NUMBER"],s=new Map;s.set("NET_AMOUNT",""),s.set("TOTAL_AMOUNT","");const o={};Array.from(e.columns).forEach(((e,t)=>{n.includes(e.name)&&(i[e.name.toLowerCase()]=e.formatted_value),s.has(e.name)&&(s.set(e.name,e.formatted_value),o[e.name]=e.value)}));for(const[l,a]of s.entries())if(""!==a){i.amount=a,i.amount_standard=o[l];break}this.lineItems.push(i)}))},setTotallineItem(){const e=this.getbaseTotalLineItem();this.record.fields&&Array.isArray(this.record.fields)&&this.record.fields.length>0&&this.record.fields.forEach(((t,i)=>{"total_net_amount"===t.name&&(e.amount=t.formatted_value,e.amount_standard=t.value)})),this.lineItems.push(e)},addLineItem(){if(this.is_view_readonly)return;const e=this.baseLineItem();e.id=(0,D.Z)(),this.lineItems.push(e)},setAccountingVariables(){this.amount_format_locale=this.doc_amount_format_locale,this.setSupplier()},setSupplier(){this.supplier_name=this.supplier,this.supplier_name||(this.missing_supplier_warning=this.showWarningAlert(this.$t("missing_supplier_warning")))},emptyLineItems(){0===this.lineItems.length&&(this.empty_line_item=!0)},copyURL(){this.doc_url.trim().length>0&&(0,E.Z)(this.doc_url).then((()=>{this.showSuccessToast(this.$t("link_copied_to_clipboard"))}))},closeDialog(e){this.empty_line_item=!1},addDummyData(){this.supplier_name="Fellow Consulting AG"},handleMode(){let e="total_line_item";"total_line"===this.accounting_mode&&(e="line_item"),this.disableLineItems(e),this.calculateTotalByMode()},disableLineItems(e="line_item"){Array.from(this.lineItems).forEach(((t,i)=>{t.error="",t.type===e?(t.readonly=!0,t.split_items=[],t.dimensions=[]):t.readonly=!1}))},setAccountingModeOptions(){this.accounting_mode_options=[{label:this.$t("split_by_total"),value:"total_line"},{label:this.$t("line_items"),value:"line_items"}]},toggleMenu(){this.is_view_readonly||(this.expert_mode=!this.expert_mode)}},setup(){const e=(0,z.H_)(),{record:t,error:i,doc_loaded:n,processing:s,auto_saving:o,auto_saved_done:l,amount_format_locale:a,supplier:r}=(0,L.Jk)(e),{getDocumentById:d,saveDocument:c,resetDocStore:u}=e,m=(0,z.f5)(),{resetAccountingStore:_,calculateTotalByMode:p,getTotalLineIndex:h,checkTotalForEachLineItem:g,baseSplitLineItem:w,getPredictions:y,getLineItemsForPredictionAccount:v,getAccountsList:f}=m,{lineItems:x,amount_format_locale:I,is_view_readonly:b,accounting_mode:k,dimensions:q,accounts:A,dimension_dropdowns:D,supplier_name:S,categorized_accounts:Z,expert_mode:P,accounting_error:C}=(0,L.Jk)(m),T=(0,z.Yb)(),{calculateMatchedTotal:$,setTotallineItem:V,hasPoMatchData:E}=T,{total_net_amount:O,pending_amount:F,matched_total_amount:Q,pending_amount_standard:M}=(0,L.Jk)(T),U=(0,z.b8)(),{connect:H}=U,B=(0,z.VF)(),{getSettingWithExpiry:j,handleStorageEvent:K}=B,Y=(0,z.ZA)(),{view_template:J,view_types:N,line_item_loaded:R}=(0,L.Jk)(Y),{baseLineItem:G,getbaseTotalLineItem:X,startAccountAsyncOperation:ee,resetAccountingTypeStore:te}=Y;return{accounting_error:C,resetAccountingTypeStore:te,startAccountAsyncOperation:ee,pending_amount_standard:M,getAccountsList:f,line_item_loaded:R,handleStorageEvent:K,getbaseTotalLineItem:X,baseLineItem:G,getSettingWithExpiry:j,view_template:J,view_types:N,supplier:r,categorized_accounts:Z,getLineItemsForPredictionAccount:v,getPredictions:y,doc_amount_format_locale:a,baseSplitLineItem:w,hasPoMatchData:E,total_net_amount:O,pending_amount:F,matched_total_amount:Q,calculateMatchedTotal:$,setPoTotalLineItem:V,connect:H,dimensions:q,accounts:A,dimension_dropdowns:D,checkTotalForEachLineItem:g,getTotalLineIndex:h,accounting_mode:k,calculateTotalByMode:p,doc_loaded:n,is_view_readonly:b,resetAccountingStore:_,resetDocStore:u,amount_format_locale:I,saveDocument:c,lineItems:x,auto_saving:o,auto_saved_done:l,has_fetch_error:i,error_message:(0,W.iH)(""),getDocumentById:d,record:t,processing:s,docId:(0,W.iH)(""),splitterModel:(0,W.iH)(70),messageCategoryClass:(0,W.iH)("error-banner"),empty_line_item:(0,W.iH)(!1),doc_url:(0,W.iH)(""),data_loaded:(0,W.iH)(!1),accounting_mode_options:(0,W.iH)([]),show_setup_validation:(0,W.iH)(!1),disable_mode:(0,W.iH)(!1),supplier_name:S,expert_mode:P,missing_supplier_warning:{}}}});var vl=i(7498),fl=i(1389),xl=i(18149);const Il=(0,R.Z)(yl,[["render",A],["__scopeId","data-v-37d2aa7c"]]),bl=Il;te()(yl,"components",{QBtn:Ae.Z,QIcon:G.Z,QSplitter:vl.Z,QBtnToggle:fl.Z,QTooltip:Ce.Z,QDialog:De.Z,QCard:it.Z,QToolbar:nt.Z,QToolbarTitle:st.Z,QCardSection:ot.Z,QInput:Et.Z,QFab:Os.Z,QField:xl.Z}),te()(yl,"directives",{ClosePopup:si.Z})}}]);